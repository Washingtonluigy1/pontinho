import{s as u}from"./index-CEKQo3Ia.js";function g(t,e){const o=new Date(t).getTime(),r=(new Date(e).getTime()-o)/(1e3*60*60);return r<0?0:r}function v(t){return new Date(t).getDay()===0}async function S(t,e,o,i=8,r=30){const{data:c}=await u.from("time_entries").select("clock_in, clock_out, total_hours").eq("user_id",t).gte("clock_in",`${o}-${String(e).padStart(2,"0")}-01`).lt("clock_in",e===12?`${o+1}-01-01`:`${o}-${String(e+1).padStart(2,"0")}-01`).not("clock_out","is",null);if(!c||c.length===0)return await u.from("overtime_hours").upsert({user_id:t,month:e,year:o,overtime_hours:0,hour_bank:0,updated_at:new Date().toISOString()}),{overtime:0,hourBank:0};const n=new Map;let l=0;c.forEach(a=>{const s=g(a.clock_in,a.clock_out),h=new Date(a.clock_in).toLocaleDateString("pt-BR");v(a.clock_in)?l+=s:n.set(h,(n.get(h)||0)+s)});const k=n.size,p=Array.from(n.values()).reduce((a,s)=>a+s,0),f=k*i,m=Math.max(0,p-f)+l,_=Math.min(m,r),d=Math.max(0,m-r);return await u.from("overtime_hours").upsert({user_id:t,month:e,year:o,overtime_hours:_,hour_bank:d,updated_at:new Date().toISOString()}),{overtime:_,hourBank:d}}export{S as recalculateMonthlyOvertime};
