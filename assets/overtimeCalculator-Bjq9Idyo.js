import{s as _}from"./index-DgaOTsP6.js";async function f(s,e,o,d=8,c=30){const{data:a}=await _.from("time_entries").select("clock_in, clock_out, total_hours").eq("user_id",s).gte("clock_in",`${o}-${String(e).padStart(2,"0")}-01`).lt("clock_in",e===12?`${o+1}-01-01`:`${o}-${String(e+1).padStart(2,"0")}-01`).not("clock_out","is",null);if(!a||a.length===0)return{overtime:0,hourBank:0};const r=new Map;a.forEach(n=>{const t=new Date(n.clock_in).toLocaleDateString("pt-BR");r.has(t)||r.set(t,[]),r.get(t).push(n)});const h=r.size,k=a.reduce((n,t)=>n+(t.total_hours||0),0),p=h*d,i=Math.max(0,k-p),u=Math.min(i,c),l=Math.max(0,i-c);return await _.from("overtime_hours").upsert({user_id:s,month:e,year:o,overtime_hours:u,hour_bank:l,updated_at:new Date().toISOString()}),{overtime:u,hourBank:l}}export{f as recalculateMonthlyOvertime};
