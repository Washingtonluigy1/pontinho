(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))u(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const T of v.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&u(T)}).observe(document,{childList:!0,subtree:!0});function s(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerPolicy&&(v.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?v.credentials="include":m.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function u(m){if(m.ep)return;m.ep=!0;const v=s(m);fetch(m.href,v)}})();var va=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pN(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function mN(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var s=function u(){return this instanceof u?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};s.prototype=r.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var m=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(s,u,m.get?m:{enumerable:!0,get:function(){return t[u]}})}),s}var uk={exports:{}},l1={},hk={exports:{}},Xi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A_=Symbol.for("react.element"),gN=Symbol.for("react.portal"),_N=Symbol.for("react.fragment"),yN=Symbol.for("react.strict_mode"),xN=Symbol.for("react.profiler"),vN=Symbol.for("react.provider"),wN=Symbol.for("react.context"),bN=Symbol.for("react.forward_ref"),TN=Symbol.for("react.suspense"),SN=Symbol.for("react.memo"),EN=Symbol.for("react.lazy"),ZC=Symbol.iterator;function AN(t){return t===null||typeof t!="object"?null:(t=ZC&&t[ZC]||t["@@iterator"],typeof t=="function"?t:null)}var dk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fk=Object.assign,pk={};function pm(t,r,s){this.props=t,this.context=r,this.refs=pk,this.updater=s||dk}pm.prototype.isReactComponent={};pm.prototype.setState=function(t,r){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,r,"setState")};pm.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function mk(){}mk.prototype=pm.prototype;function OT(t,r,s){this.props=t,this.context=r,this.refs=pk,this.updater=s||dk}var LT=OT.prototype=new mk;LT.constructor=OT;fk(LT,pm.prototype);LT.isPureReactComponent=!0;var XC=Array.isArray,gk=Object.prototype.hasOwnProperty,FT={current:null},_k={key:!0,ref:!0,__self:!0,__source:!0};function yk(t,r,s){var u,m={},v=null,T=null;if(r!=null)for(u in r.ref!==void 0&&(T=r.ref),r.key!==void 0&&(v=""+r.key),r)gk.call(r,u)&&!_k.hasOwnProperty(u)&&(m[u]=r[u]);var a=arguments.length-2;if(a===1)m.children=s;else if(1<a){for(var R=Array(a),O=0;O<a;O++)R[O]=arguments[O+2];m.children=R}if(t&&t.defaultProps)for(u in a=t.defaultProps,a)m[u]===void 0&&(m[u]=a[u]);return{$$typeof:A_,type:t,key:v,ref:T,props:m,_owner:FT.current}}function IN(t,r){return{$$typeof:A_,type:t.type,key:r,ref:t.ref,props:t.props,_owner:t._owner}}function NT(t){return typeof t=="object"&&t!==null&&t.$$typeof===A_}function CN(t){var r={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return r[s]})}var KC=/\/+/g;function Fb(t,r){return typeof t=="object"&&t!==null&&t.key!=null?CN(""+t.key):r.toString(36)}function av(t,r,s,u,m){var v=typeof t;(v==="undefined"||v==="boolean")&&(t=null);var T=!1;if(t===null)T=!0;else switch(v){case"string":case"number":T=!0;break;case"object":switch(t.$$typeof){case A_:case gN:T=!0}}if(T)return T=t,m=m(T),t=u===""?"."+Fb(T,0):u,XC(m)?(s="",t!=null&&(s=t.replace(KC,"$&/")+"/"),av(m,r,s,"",function(O){return O})):m!=null&&(NT(m)&&(m=IN(m,s+(!m.key||T&&T.key===m.key?"":(""+m.key).replace(KC,"$&/")+"/")+t)),r.push(m)),1;if(T=0,u=u===""?".":u+":",XC(t))for(var a=0;a<t.length;a++){v=t[a];var R=u+Fb(v,a);T+=av(v,r,s,R,m)}else if(R=AN(t),typeof R=="function")for(t=R.call(t),a=0;!(v=t.next()).done;)v=v.value,R=u+Fb(v,a++),T+=av(v,r,s,R,m);else if(v==="object")throw r=String(t),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return T}function Mx(t,r,s){if(t==null)return t;var u=[],m=0;return av(t,u,"","",function(v){return r.call(s,v,m++)}),u}function PN(t){if(t._status===-1){var r=t._result;r=r(),r.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=r)}if(t._status===1)return t._result.default;throw t._result}var Fo={current:null},lv={transition:null},kN={ReactCurrentDispatcher:Fo,ReactCurrentBatchConfig:lv,ReactCurrentOwner:FT};function xk(){throw Error("act(...) is not supported in production builds of React.")}Xi.Children={map:Mx,forEach:function(t,r,s){Mx(t,function(){r.apply(this,arguments)},s)},count:function(t){var r=0;return Mx(t,function(){r++}),r},toArray:function(t){return Mx(t,function(r){return r})||[]},only:function(t){if(!NT(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Xi.Component=pm;Xi.Fragment=_N;Xi.Profiler=xN;Xi.PureComponent=OT;Xi.StrictMode=yN;Xi.Suspense=TN;Xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kN;Xi.act=xk;Xi.cloneElement=function(t,r,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var u=fk({},t.props),m=t.key,v=t.ref,T=t._owner;if(r!=null){if(r.ref!==void 0&&(v=r.ref,T=FT.current),r.key!==void 0&&(m=""+r.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(R in r)gk.call(r,R)&&!_k.hasOwnProperty(R)&&(u[R]=r[R]===void 0&&a!==void 0?a[R]:r[R])}var R=arguments.length-2;if(R===1)u.children=s;else if(1<R){a=Array(R);for(var O=0;O<R;O++)a[O]=arguments[O+2];u.children=a}return{$$typeof:A_,type:t.type,key:m,ref:v,props:u,_owner:T}};Xi.createContext=function(t){return t={$$typeof:wN,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vN,_context:t},t.Consumer=t};Xi.createElement=yk;Xi.createFactory=function(t){var r=yk.bind(null,t);return r.type=t,r};Xi.createRef=function(){return{current:null}};Xi.forwardRef=function(t){return{$$typeof:bN,render:t}};Xi.isValidElement=NT;Xi.lazy=function(t){return{$$typeof:EN,_payload:{_status:-1,_result:t},_init:PN}};Xi.memo=function(t,r){return{$$typeof:SN,type:t,compare:r===void 0?null:r}};Xi.startTransition=function(t){var r=lv.transition;lv.transition={};try{t()}finally{lv.transition=r}};Xi.unstable_act=xk;Xi.useCallback=function(t,r){return Fo.current.useCallback(t,r)};Xi.useContext=function(t){return Fo.current.useContext(t)};Xi.useDebugValue=function(){};Xi.useDeferredValue=function(t){return Fo.current.useDeferredValue(t)};Xi.useEffect=function(t,r){return Fo.current.useEffect(t,r)};Xi.useId=function(){return Fo.current.useId()};Xi.useImperativeHandle=function(t,r,s){return Fo.current.useImperativeHandle(t,r,s)};Xi.useInsertionEffect=function(t,r){return Fo.current.useInsertionEffect(t,r)};Xi.useLayoutEffect=function(t,r){return Fo.current.useLayoutEffect(t,r)};Xi.useMemo=function(t,r){return Fo.current.useMemo(t,r)};Xi.useReducer=function(t,r,s){return Fo.current.useReducer(t,r,s)};Xi.useRef=function(t){return Fo.current.useRef(t)};Xi.useState=function(t){return Fo.current.useState(t)};Xi.useSyncExternalStore=function(t,r,s){return Fo.current.useSyncExternalStore(t,r,s)};Xi.useTransition=function(){return Fo.current.useTransition()};Xi.version="18.3.1";hk.exports=Xi;var zt=hk.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RN=zt,MN=Symbol.for("react.element"),DN=Symbol.for("react.fragment"),ON=Object.prototype.hasOwnProperty,LN=RN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,FN={key:!0,ref:!0,__self:!0,__source:!0};function vk(t,r,s){var u,m={},v=null,T=null;s!==void 0&&(v=""+s),r.key!==void 0&&(v=""+r.key),r.ref!==void 0&&(T=r.ref);for(u in r)ON.call(r,u)&&!FN.hasOwnProperty(u)&&(m[u]=r[u]);if(t&&t.defaultProps)for(u in r=t.defaultProps,r)m[u]===void 0&&(m[u]=r[u]);return{$$typeof:MN,type:t,key:v,ref:T,props:m,_owner:LN.current}}l1.Fragment=DN;l1.jsx=vk;l1.jsxs=vk;uk.exports=l1;var L=uk.exports,wk={exports:{}},Ta={},bk={exports:{}},Tk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function r(sr,yr){var vr=sr.length;sr.push(yr);e:for(;0<vr;){var gr=vr-1>>>1,Ue=sr[gr];if(0<m(Ue,yr))sr[gr]=yr,sr[vr]=Ue,vr=gr;else break e}}function s(sr){return sr.length===0?null:sr[0]}function u(sr){if(sr.length===0)return null;var yr=sr[0],vr=sr.pop();if(vr!==yr){sr[0]=vr;e:for(var gr=0,Ue=sr.length,vt=Ue>>>1;gr<vt;){var ct=2*(gr+1)-1,ht=sr[ct],Pt=ct+1,dr=sr[Pt];if(0>m(ht,vr))Pt<Ue&&0>m(dr,ht)?(sr[gr]=dr,sr[Pt]=vr,gr=Pt):(sr[gr]=ht,sr[ct]=vr,gr=ct);else if(Pt<Ue&&0>m(dr,vr))sr[gr]=dr,sr[Pt]=vr,gr=Pt;else break e}}return yr}function m(sr,yr){var vr=sr.sortIndex-yr.sortIndex;return vr!==0?vr:sr.id-yr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;t.unstable_now=function(){return v.now()}}else{var T=Date,a=T.now();t.unstable_now=function(){return T.now()-a}}var R=[],O=[],B=1,H=null,q=3,ee=!1,re=!1,J=!1,_e=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(sr){for(var yr=s(O);yr!==null;){if(yr.callback===null)u(O);else if(yr.startTime<=sr)u(O),yr.sortIndex=yr.expirationTime,r(R,yr);else break;yr=s(O)}}function ke(sr){if(J=!1,ie(sr),!re)if(s(R)!==null)re=!0,Ir(at);else{var yr=s(O);yr!==null&&ei(ke,yr.startTime-sr)}}function at(sr,yr){re=!1,J&&(J=!1,pe(et),et=-1),ee=!0;var vr=q;try{for(ie(yr),H=s(R);H!==null&&(!(H.expirationTime>yr)||sr&&!tt());){var gr=H.callback;if(typeof gr=="function"){H.callback=null,q=H.priorityLevel;var Ue=gr(H.expirationTime<=yr);yr=t.unstable_now(),typeof Ue=="function"?H.callback=Ue:H===s(R)&&u(R),ie(yr)}else u(R);H=s(R)}if(H!==null)var vt=!0;else{var ct=s(O);ct!==null&&ei(ke,ct.startTime-yr),vt=!1}return vt}finally{H=null,q=vr,ee=!1}}var He=!1,De=null,et=-1,Ge=5,ft=-1;function tt(){return!(t.unstable_now()-ft<Ge)}function Ot(){if(De!==null){var sr=t.unstable_now();ft=sr;var yr=!0;try{yr=De(!0,sr)}finally{yr?Xt():(He=!1,De=null)}}else He=!1}var Xt;if(typeof ue=="function")Xt=function(){ue(Ot)};else if(typeof MessageChannel<"u"){var Dr=new MessageChannel,ir=Dr.port2;Dr.port1.onmessage=Ot,Xt=function(){ir.postMessage(null)}}else Xt=function(){_e(Ot,0)};function Ir(sr){De=sr,He||(He=!0,Xt())}function ei(sr,yr){et=_e(function(){sr(t.unstable_now())},yr)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(sr){sr.callback=null},t.unstable_continueExecution=function(){re||ee||(re=!0,Ir(at))},t.unstable_forceFrameRate=function(sr){0>sr||125<sr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ge=0<sr?Math.floor(1e3/sr):5},t.unstable_getCurrentPriorityLevel=function(){return q},t.unstable_getFirstCallbackNode=function(){return s(R)},t.unstable_next=function(sr){switch(q){case 1:case 2:case 3:var yr=3;break;default:yr=q}var vr=q;q=yr;try{return sr()}finally{q=vr}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(sr,yr){switch(sr){case 1:case 2:case 3:case 4:case 5:break;default:sr=3}var vr=q;q=sr;try{return yr()}finally{q=vr}},t.unstable_scheduleCallback=function(sr,yr,vr){var gr=t.unstable_now();switch(typeof vr=="object"&&vr!==null?(vr=vr.delay,vr=typeof vr=="number"&&0<vr?gr+vr:gr):vr=gr,sr){case 1:var Ue=-1;break;case 2:Ue=250;break;case 5:Ue=1073741823;break;case 4:Ue=1e4;break;default:Ue=5e3}return Ue=vr+Ue,sr={id:B++,callback:yr,priorityLevel:sr,startTime:vr,expirationTime:Ue,sortIndex:-1},vr>gr?(sr.sortIndex=vr,r(O,sr),s(R)===null&&sr===s(O)&&(J?(pe(et),et=-1):J=!0,ei(ke,vr-gr))):(sr.sortIndex=Ue,r(R,sr),re||ee||(re=!0,Ir(at))),sr},t.unstable_shouldYield=tt,t.unstable_wrapCallback=function(sr){var yr=q;return function(){var vr=q;q=yr;try{return sr.apply(this,arguments)}finally{q=vr}}}})(Tk);bk.exports=Tk;var NN=bk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zN=zt,wa=NN;function _r(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)r+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sk=new Set,Qg={};function Nd(t,r){sm(t,r),sm(t+"Capture",r)}function sm(t,r){for(Qg[t]=r,t=0;t<r.length;t++)Sk.add(r[t])}var Wc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S2=Object.prototype.hasOwnProperty,BN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,YC={},JC={};function jN(t){return S2.call(JC,t)?!0:S2.call(YC,t)?!1:BN.test(t)?JC[t]=!0:(YC[t]=!0,!1)}function UN(t,r,s,u){if(s!==null&&s.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return u?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function VN(t,r,s,u){if(r===null||typeof r>"u"||UN(t,r,s,u))return!0;if(u)return!1;if(s!==null)switch(s.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function No(t,r,s,u,m,v,T){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=u,this.attributeNamespace=m,this.mustUseProperty=s,this.propertyName=t,this.type=r,this.sanitizeURL=v,this.removeEmptyString=T}var eo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){eo[t]=new No(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];eo[r]=new No(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){eo[t]=new No(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){eo[t]=new No(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){eo[t]=new No(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){eo[t]=new No(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){eo[t]=new No(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){eo[t]=new No(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){eo[t]=new No(t,5,!1,t.toLowerCase(),null,!1,!1)});var zT=/[\-:]([a-z])/g;function BT(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(zT,BT);eo[r]=new No(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(zT,BT);eo[r]=new No(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(zT,BT);eo[r]=new No(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){eo[t]=new No(t,1,!1,t.toLowerCase(),null,!1,!1)});eo.xlinkHref=new No("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){eo[t]=new No(t,1,!1,t.toLowerCase(),null,!0,!0)});function jT(t,r,s,u){var m=eo.hasOwnProperty(r)?eo[r]:null;(m!==null?m.type!==0:u||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(VN(r,s,m,u)&&(s=null),u||m===null?jN(r)&&(s===null?t.removeAttribute(r):t.setAttribute(r,""+s)):m.mustUseProperty?t[m.propertyName]=s===null?m.type===3?!1:"":s:(r=m.attributeName,u=m.attributeNamespace,s===null?t.removeAttribute(r):(m=m.type,s=m===3||m===4&&s===!0?"":""+s,u?t.setAttributeNS(u,r,s):t.setAttribute(r,s))))}var Qc=zN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Dx=Symbol.for("react.element"),Lp=Symbol.for("react.portal"),Fp=Symbol.for("react.fragment"),UT=Symbol.for("react.strict_mode"),E2=Symbol.for("react.profiler"),Ek=Symbol.for("react.provider"),Ak=Symbol.for("react.context"),VT=Symbol.for("react.forward_ref"),A2=Symbol.for("react.suspense"),I2=Symbol.for("react.suspense_list"),$T=Symbol.for("react.memo"),Xu=Symbol.for("react.lazy"),Ik=Symbol.for("react.offscreen"),QC=Symbol.iterator;function _g(t){return t===null||typeof t!="object"?null:(t=QC&&t[QC]||t["@@iterator"],typeof t=="function"?t:null)}var es=Object.assign,Nb;function Cg(t){if(Nb===void 0)try{throw Error()}catch(s){var r=s.stack.trim().match(/\n( *(at )?)/);Nb=r&&r[1]||""}return`
`+Nb+t}var zb=!1;function Bb(t,r){if(!t||zb)return"";zb=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(O){var u=O}Reflect.construct(t,[],r)}else{try{r.call()}catch(O){u=O}t.call(r.prototype)}else{try{throw Error()}catch(O){u=O}t()}}catch(O){if(O&&u&&typeof O.stack=="string"){for(var m=O.stack.split(`
`),v=u.stack.split(`
`),T=m.length-1,a=v.length-1;1<=T&&0<=a&&m[T]!==v[a];)a--;for(;1<=T&&0<=a;T--,a--)if(m[T]!==v[a]){if(T!==1||a!==1)do if(T--,a--,0>a||m[T]!==v[a]){var R=`
`+m[T].replace(" at new "," at ");return t.displayName&&R.includes("<anonymous>")&&(R=R.replace("<anonymous>",t.displayName)),R}while(1<=T&&0<=a);break}}}finally{zb=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?Cg(t):""}function $N(t){switch(t.tag){case 5:return Cg(t.type);case 16:return Cg("Lazy");case 13:return Cg("Suspense");case 19:return Cg("SuspenseList");case 0:case 2:case 15:return t=Bb(t.type,!1),t;case 11:return t=Bb(t.type.render,!1),t;case 1:return t=Bb(t.type,!0),t;default:return""}}function C2(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fp:return"Fragment";case Lp:return"Portal";case E2:return"Profiler";case UT:return"StrictMode";case A2:return"Suspense";case I2:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Ak:return(t.displayName||"Context")+".Consumer";case Ek:return(t._context.displayName||"Context")+".Provider";case VT:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $T:return r=t.displayName||null,r!==null?r:C2(t.type)||"Memo";case Xu:r=t._payload,t=t._init;try{return C2(t(r))}catch{}}return null}function GN(t){var r=t.type;switch(t.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=r.render,t=t.displayName||t.name||"",r.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return C2(r);case 8:return r===UT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function dh(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Ck(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function HN(t){var r=Ck(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),u=""+t[r];if(!t.hasOwnProperty(r)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var m=s.get,v=s.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return m.call(this)},set:function(T){u=""+T,v.call(this,T)}}),Object.defineProperty(t,r,{enumerable:s.enumerable}),{getValue:function(){return u},setValue:function(T){u=""+T},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function Ox(t){t._valueTracker||(t._valueTracker=HN(t))}function Pk(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var s=r.getValue(),u="";return t&&(u=Ck(t)?t.checked?"true":"false":t.value),t=u,t!==s?(r.setValue(t),!0):!1}function vv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function P2(t,r){var s=r.checked;return es({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function eP(t,r){var s=r.defaultValue==null?"":r.defaultValue,u=r.checked!=null?r.checked:r.defaultChecked;s=dh(r.value!=null?r.value:s),t._wrapperState={initialChecked:u,initialValue:s,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function kk(t,r){r=r.checked,r!=null&&jT(t,"checked",r,!1)}function k2(t,r){kk(t,r);var s=dh(r.value),u=r.type;if(s!=null)u==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(u==="submit"||u==="reset"){t.removeAttribute("value");return}r.hasOwnProperty("value")?R2(t,r.type,s):r.hasOwnProperty("defaultValue")&&R2(t,r.type,dh(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(t.defaultChecked=!!r.defaultChecked)}function tP(t,r,s){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var u=r.type;if(!(u!=="submit"&&u!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+t._wrapperState.initialValue,s||r===t.value||(t.value=r),t.defaultValue=r}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function R2(t,r,s){(r!=="number"||vv(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var Pg=Array.isArray;function Xp(t,r,s,u){if(t=t.options,r){r={};for(var m=0;m<s.length;m++)r["$"+s[m]]=!0;for(s=0;s<t.length;s++)m=r.hasOwnProperty("$"+t[s].value),t[s].selected!==m&&(t[s].selected=m),m&&u&&(t[s].defaultSelected=!0)}else{for(s=""+dh(s),r=null,m=0;m<t.length;m++){if(t[m].value===s){t[m].selected=!0,u&&(t[m].defaultSelected=!0);return}r!==null||t[m].disabled||(r=t[m])}r!==null&&(r.selected=!0)}}function M2(t,r){if(r.dangerouslySetInnerHTML!=null)throw Error(_r(91));return es({},r,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rP(t,r){var s=r.value;if(s==null){if(s=r.children,r=r.defaultValue,s!=null){if(r!=null)throw Error(_r(92));if(Pg(s)){if(1<s.length)throw Error(_r(93));s=s[0]}r=s}r==null&&(r=""),s=r}t._wrapperState={initialValue:dh(s)}}function Rk(t,r){var s=dh(r.value),u=dh(r.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),r.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),u!=null&&(t.defaultValue=""+u)}function iP(t){var r=t.textContent;r===t._wrapperState.initialValue&&r!==""&&r!==null&&(t.value=r)}function Mk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function D2(t,r){return t==null||t==="http://www.w3.org/1999/xhtml"?Mk(r):t==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Lx,Dk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,s,u,m){MSApp.execUnsafeLocalFunction(function(){return t(r,s,u,m)})}:t}(function(t,r){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=r;else{for(Lx=Lx||document.createElement("div"),Lx.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Lx.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;r.firstChild;)t.appendChild(r.firstChild)}});function e_(t,r){if(r){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=r;return}}t.textContent=r}var Lg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},WN=["Webkit","ms","Moz","O"];Object.keys(Lg).forEach(function(t){WN.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),Lg[r]=Lg[t]})});function Ok(t,r,s){return r==null||typeof r=="boolean"||r===""?"":s||typeof r!="number"||r===0||Lg.hasOwnProperty(t)&&Lg[t]?(""+r).trim():r+"px"}function Lk(t,r){t=t.style;for(var s in r)if(r.hasOwnProperty(s)){var u=s.indexOf("--")===0,m=Ok(s,r[s],u);s==="float"&&(s="cssFloat"),u?t.setProperty(s,m):t[s]=m}}var qN=es({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function O2(t,r){if(r){if(qN[t]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(_r(137,t));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(_r(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(_r(61))}if(r.style!=null&&typeof r.style!="object")throw Error(_r(62))}}function L2(t,r){if(t.indexOf("-")===-1)return typeof r.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var F2=null;function GT(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var N2=null,Kp=null,Yp=null;function nP(t){if(t=P_(t)){if(typeof N2!="function")throw Error(_r(280));var r=t.stateNode;r&&(r=f1(r),N2(t.stateNode,t.type,r))}}function Fk(t){Kp?Yp?Yp.push(t):Yp=[t]:Kp=t}function Nk(){if(Kp){var t=Kp,r=Yp;if(Yp=Kp=null,nP(t),r)for(t=0;t<r.length;t++)nP(r[t])}}function zk(t,r){return t(r)}function Bk(){}var jb=!1;function jk(t,r,s){if(jb)return t(r,s);jb=!0;try{return zk(t,r,s)}finally{jb=!1,(Kp!==null||Yp!==null)&&(Bk(),Nk())}}function t_(t,r){var s=t.stateNode;if(s===null)return null;var u=f1(s);if(u===null)return null;s=u[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(t=t.type,u=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!u;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(_r(231,r,typeof s));return s}var z2=!1;if(Wc)try{var yg={};Object.defineProperty(yg,"passive",{get:function(){z2=!0}}),window.addEventListener("test",yg,yg),window.removeEventListener("test",yg,yg)}catch{z2=!1}function ZN(t,r,s,u,m,v,T,a,R){var O=Array.prototype.slice.call(arguments,3);try{r.apply(s,O)}catch(B){this.onError(B)}}var Fg=!1,wv=null,bv=!1,B2=null,XN={onError:function(t){Fg=!0,wv=t}};function KN(t,r,s,u,m,v,T,a,R){Fg=!1,wv=null,ZN.apply(XN,arguments)}function YN(t,r,s,u,m,v,T,a,R){if(KN.apply(this,arguments),Fg){if(Fg){var O=wv;Fg=!1,wv=null}else throw Error(_r(198));bv||(bv=!0,B2=O)}}function zd(t){var r=t,s=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,r.flags&4098&&(s=r.return),t=r.return;while(t)}return r.tag===3?s:null}function Uk(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function sP(t){if(zd(t)!==t)throw Error(_r(188))}function JN(t){var r=t.alternate;if(!r){if(r=zd(t),r===null)throw Error(_r(188));return r!==t?null:t}for(var s=t,u=r;;){var m=s.return;if(m===null)break;var v=m.alternate;if(v===null){if(u=m.return,u!==null){s=u;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===s)return sP(m),t;if(v===u)return sP(m),r;v=v.sibling}throw Error(_r(188))}if(s.return!==u.return)s=m,u=v;else{for(var T=!1,a=m.child;a;){if(a===s){T=!0,s=m,u=v;break}if(a===u){T=!0,u=m,s=v;break}a=a.sibling}if(!T){for(a=v.child;a;){if(a===s){T=!0,s=v,u=m;break}if(a===u){T=!0,u=v,s=m;break}a=a.sibling}if(!T)throw Error(_r(189))}}if(s.alternate!==u)throw Error(_r(190))}if(s.tag!==3)throw Error(_r(188));return s.stateNode.current===s?t:r}function Vk(t){return t=JN(t),t!==null?$k(t):null}function $k(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var r=$k(t);if(r!==null)return r;t=t.sibling}return null}var Gk=wa.unstable_scheduleCallback,oP=wa.unstable_cancelCallback,QN=wa.unstable_shouldYield,ez=wa.unstable_requestPaint,us=wa.unstable_now,tz=wa.unstable_getCurrentPriorityLevel,HT=wa.unstable_ImmediatePriority,Hk=wa.unstable_UserBlockingPriority,Tv=wa.unstable_NormalPriority,rz=wa.unstable_LowPriority,Wk=wa.unstable_IdlePriority,c1=null,ic=null;function iz(t){if(ic&&typeof ic.onCommitFiberRoot=="function")try{ic.onCommitFiberRoot(c1,t,void 0,(t.current.flags&128)===128)}catch{}}var _l=Math.clz32?Math.clz32:oz,nz=Math.log,sz=Math.LN2;function oz(t){return t>>>=0,t===0?32:31-(nz(t)/sz|0)|0}var Fx=64,Nx=4194304;function kg(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Sv(t,r){var s=t.pendingLanes;if(s===0)return 0;var u=0,m=t.suspendedLanes,v=t.pingedLanes,T=s&268435455;if(T!==0){var a=T&~m;a!==0?u=kg(a):(v&=T,v!==0&&(u=kg(v)))}else T=s&~m,T!==0?u=kg(T):v!==0&&(u=kg(v));if(u===0)return 0;if(r!==0&&r!==u&&!(r&m)&&(m=u&-u,v=r&-r,m>=v||m===16&&(v&4194240)!==0))return r;if(u&4&&(u|=s&16),r=t.entangledLanes,r!==0)for(t=t.entanglements,r&=u;0<r;)s=31-_l(r),m=1<<s,u|=t[s],r&=~m;return u}function az(t,r){switch(t){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lz(t,r){for(var s=t.suspendedLanes,u=t.pingedLanes,m=t.expirationTimes,v=t.pendingLanes;0<v;){var T=31-_l(v),a=1<<T,R=m[T];R===-1?(!(a&s)||a&u)&&(m[T]=az(a,r)):R<=r&&(t.expiredLanes|=a),v&=~a}}function j2(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function qk(){var t=Fx;return Fx<<=1,!(Fx&4194240)&&(Fx=64),t}function Ub(t){for(var r=[],s=0;31>s;s++)r.push(t);return r}function I_(t,r,s){t.pendingLanes|=r,r!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,r=31-_l(r),t[r]=s}function cz(t,r){var s=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;var u=t.eventTimes;for(t=t.expirationTimes;0<s;){var m=31-_l(s),v=1<<m;r[m]=0,u[m]=-1,t[m]=-1,s&=~v}}function WT(t,r){var s=t.entangledLanes|=r;for(t=t.entanglements;s;){var u=31-_l(s),m=1<<u;m&r|t[u]&r&&(t[u]|=r),s&=~m}}var xn=0;function Zk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Xk,qT,Kk,Yk,Jk,U2=!1,zx=[],nh=null,sh=null,oh=null,r_=new Map,i_=new Map,Yu=[],uz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aP(t,r){switch(t){case"focusin":case"focusout":nh=null;break;case"dragenter":case"dragleave":sh=null;break;case"mouseover":case"mouseout":oh=null;break;case"pointerover":case"pointerout":r_.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":i_.delete(r.pointerId)}}function xg(t,r,s,u,m,v){return t===null||t.nativeEvent!==v?(t={blockedOn:r,domEventName:s,eventSystemFlags:u,nativeEvent:v,targetContainers:[m]},r!==null&&(r=P_(r),r!==null&&qT(r)),t):(t.eventSystemFlags|=u,r=t.targetContainers,m!==null&&r.indexOf(m)===-1&&r.push(m),t)}function hz(t,r,s,u,m){switch(r){case"focusin":return nh=xg(nh,t,r,s,u,m),!0;case"dragenter":return sh=xg(sh,t,r,s,u,m),!0;case"mouseover":return oh=xg(oh,t,r,s,u,m),!0;case"pointerover":var v=m.pointerId;return r_.set(v,xg(r_.get(v)||null,t,r,s,u,m)),!0;case"gotpointercapture":return v=m.pointerId,i_.set(v,xg(i_.get(v)||null,t,r,s,u,m)),!0}return!1}function Qk(t){var r=bd(t.target);if(r!==null){var s=zd(r);if(s!==null){if(r=s.tag,r===13){if(r=Uk(s),r!==null){t.blockedOn=r,Jk(t.priority,function(){Kk(s)});return}}else if(r===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function cv(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var s=V2(t.domEventName,t.eventSystemFlags,r[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var u=new s.constructor(s.type,s);F2=u,s.target.dispatchEvent(u),F2=null}else return r=P_(s),r!==null&&qT(r),t.blockedOn=s,!1;r.shift()}return!0}function lP(t,r,s){cv(t)&&s.delete(r)}function dz(){U2=!1,nh!==null&&cv(nh)&&(nh=null),sh!==null&&cv(sh)&&(sh=null),oh!==null&&cv(oh)&&(oh=null),r_.forEach(lP),i_.forEach(lP)}function vg(t,r){t.blockedOn===r&&(t.blockedOn=null,U2||(U2=!0,wa.unstable_scheduleCallback(wa.unstable_NormalPriority,dz)))}function n_(t){function r(m){return vg(m,t)}if(0<zx.length){vg(zx[0],t);for(var s=1;s<zx.length;s++){var u=zx[s];u.blockedOn===t&&(u.blockedOn=null)}}for(nh!==null&&vg(nh,t),sh!==null&&vg(sh,t),oh!==null&&vg(oh,t),r_.forEach(r),i_.forEach(r),s=0;s<Yu.length;s++)u=Yu[s],u.blockedOn===t&&(u.blockedOn=null);for(;0<Yu.length&&(s=Yu[0],s.blockedOn===null);)Qk(s),s.blockedOn===null&&Yu.shift()}var Jp=Qc.ReactCurrentBatchConfig,Ev=!0;function fz(t,r,s,u){var m=xn,v=Jp.transition;Jp.transition=null;try{xn=1,ZT(t,r,s,u)}finally{xn=m,Jp.transition=v}}function pz(t,r,s,u){var m=xn,v=Jp.transition;Jp.transition=null;try{xn=4,ZT(t,r,s,u)}finally{xn=m,Jp.transition=v}}function ZT(t,r,s,u){if(Ev){var m=V2(t,r,s,u);if(m===null)Yb(t,r,u,Av,s),aP(t,u);else if(hz(m,t,r,s,u))u.stopPropagation();else if(aP(t,u),r&4&&-1<uz.indexOf(t)){for(;m!==null;){var v=P_(m);if(v!==null&&Xk(v),v=V2(t,r,s,u),v===null&&Yb(t,r,u,Av,s),v===m)break;m=v}m!==null&&u.stopPropagation()}else Yb(t,r,u,null,s)}}var Av=null;function V2(t,r,s,u){if(Av=null,t=GT(u),t=bd(t),t!==null)if(r=zd(t),r===null)t=null;else if(s=r.tag,s===13){if(t=Uk(r),t!==null)return t;t=null}else if(s===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null);return Av=t,null}function eR(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tz()){case HT:return 1;case Hk:return 4;case Tv:case rz:return 16;case Wk:return 536870912;default:return 16}default:return 16}}var eh=null,XT=null,uv=null;function tR(){if(uv)return uv;var t,r=XT,s=r.length,u,m="value"in eh?eh.value:eh.textContent,v=m.length;for(t=0;t<s&&r[t]===m[t];t++);var T=s-t;for(u=1;u<=T&&r[s-u]===m[v-u];u++);return uv=m.slice(t,1<u?1-u:void 0)}function hv(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Bx(){return!0}function cP(){return!1}function Sa(t){function r(s,u,m,v,T){this._reactName=s,this._targetInst=m,this.type=u,this.nativeEvent=v,this.target=T,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(s=t[a],this[a]=s?s(v):v[a]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Bx:cP,this.isPropagationStopped=cP,this}return es(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Bx)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Bx)},persist:function(){},isPersistent:Bx}),r}var mm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},KT=Sa(mm),C_=es({},mm,{view:0,detail:0}),mz=Sa(C_),Vb,$b,wg,u1=es({},C_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:YT,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==wg&&(wg&&t.type==="mousemove"?(Vb=t.screenX-wg.screenX,$b=t.screenY-wg.screenY):$b=Vb=0,wg=t),Vb)},movementY:function(t){return"movementY"in t?t.movementY:$b}}),uP=Sa(u1),gz=es({},u1,{dataTransfer:0}),_z=Sa(gz),yz=es({},C_,{relatedTarget:0}),Gb=Sa(yz),xz=es({},mm,{animationName:0,elapsedTime:0,pseudoElement:0}),vz=Sa(xz),wz=es({},mm,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bz=Sa(wz),Tz=es({},mm,{data:0}),hP=Sa(Tz),Sz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ez={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Az={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Iz(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=Az[t])?!!r[t]:!1}function YT(){return Iz}var Cz=es({},C_,{key:function(t){if(t.key){var r=Sz[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=hv(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ez[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:YT,charCode:function(t){return t.type==="keypress"?hv(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?hv(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Pz=Sa(Cz),kz=es({},u1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dP=Sa(kz),Rz=es({},C_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:YT}),Mz=Sa(Rz),Dz=es({},mm,{propertyName:0,elapsedTime:0,pseudoElement:0}),Oz=Sa(Dz),Lz=es({},u1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Fz=Sa(Lz),Nz=[9,13,27,32],JT=Wc&&"CompositionEvent"in window,Ng=null;Wc&&"documentMode"in document&&(Ng=document.documentMode);var zz=Wc&&"TextEvent"in window&&!Ng,rR=Wc&&(!JT||Ng&&8<Ng&&11>=Ng),fP=" ",pP=!1;function iR(t,r){switch(t){case"keyup":return Nz.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nR(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Np=!1;function Bz(t,r){switch(t){case"compositionend":return nR(r);case"keypress":return r.which!==32?null:(pP=!0,fP);case"textInput":return t=r.data,t===fP&&pP?null:t;default:return null}}function jz(t,r){if(Np)return t==="compositionend"||!JT&&iR(t,r)?(t=tR(),uv=XT=eh=null,Np=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return rR&&r.locale!=="ko"?null:r.data;default:return null}}var Uz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mP(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!Uz[t.type]:r==="textarea"}function sR(t,r,s,u){Fk(u),r=Iv(r,"onChange"),0<r.length&&(s=new KT("onChange","change",null,s,u),t.push({event:s,listeners:r}))}var zg=null,s_=null;function Vz(t){gR(t,0)}function h1(t){var r=jp(t);if(Pk(r))return t}function $z(t,r){if(t==="change")return r}var oR=!1;if(Wc){var Hb;if(Wc){var Wb="oninput"in document;if(!Wb){var gP=document.createElement("div");gP.setAttribute("oninput","return;"),Wb=typeof gP.oninput=="function"}Hb=Wb}else Hb=!1;oR=Hb&&(!document.documentMode||9<document.documentMode)}function _P(){zg&&(zg.detachEvent("onpropertychange",aR),s_=zg=null)}function aR(t){if(t.propertyName==="value"&&h1(s_)){var r=[];sR(r,s_,t,GT(t)),jk(Vz,r)}}function Gz(t,r,s){t==="focusin"?(_P(),zg=r,s_=s,zg.attachEvent("onpropertychange",aR)):t==="focusout"&&_P()}function Hz(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return h1(s_)}function Wz(t,r){if(t==="click")return h1(r)}function qz(t,r){if(t==="input"||t==="change")return h1(r)}function Zz(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var vl=typeof Object.is=="function"?Object.is:Zz;function o_(t,r){if(vl(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var s=Object.keys(t),u=Object.keys(r);if(s.length!==u.length)return!1;for(u=0;u<s.length;u++){var m=s[u];if(!S2.call(r,m)||!vl(t[m],r[m]))return!1}return!0}function yP(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function xP(t,r){var s=yP(t);t=0;for(var u;s;){if(s.nodeType===3){if(u=t+s.textContent.length,t<=r&&u>=r)return{node:s,offset:r-t};t=u}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=yP(s)}}function lR(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?lR(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function cR(){for(var t=window,r=vv();r instanceof t.HTMLIFrameElement;){try{var s=typeof r.contentWindow.location.href=="string"}catch{s=!1}if(s)t=r.contentWindow;else break;r=vv(t.document)}return r}function QT(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}function Xz(t){var r=cR(),s=t.focusedElem,u=t.selectionRange;if(r!==s&&s&&s.ownerDocument&&lR(s.ownerDocument.documentElement,s)){if(u!==null&&QT(s)){if(r=u.start,t=u.end,t===void 0&&(t=r),"selectionStart"in s)s.selectionStart=r,s.selectionEnd=Math.min(t,s.value.length);else if(t=(r=s.ownerDocument||document)&&r.defaultView||window,t.getSelection){t=t.getSelection();var m=s.textContent.length,v=Math.min(u.start,m);u=u.end===void 0?v:Math.min(u.end,m),!t.extend&&v>u&&(m=u,u=v,v=m),m=xP(s,v);var T=xP(s,u);m&&T&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==T.node||t.focusOffset!==T.offset)&&(r=r.createRange(),r.setStart(m.node,m.offset),t.removeAllRanges(),v>u?(t.addRange(r),t.extend(T.node,T.offset)):(r.setEnd(T.node,T.offset),t.addRange(r)))}}for(r=[],t=s;t=t.parentNode;)t.nodeType===1&&r.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<r.length;s++)t=r[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Kz=Wc&&"documentMode"in document&&11>=document.documentMode,zp=null,$2=null,Bg=null,G2=!1;function vP(t,r,s){var u=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;G2||zp==null||zp!==vv(u)||(u=zp,"selectionStart"in u&&QT(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Bg&&o_(Bg,u)||(Bg=u,u=Iv($2,"onSelect"),0<u.length&&(r=new KT("onSelect","select",null,r,s),t.push({event:r,listeners:u}),r.target=zp)))}function jx(t,r){var s={};return s[t.toLowerCase()]=r.toLowerCase(),s["Webkit"+t]="webkit"+r,s["Moz"+t]="moz"+r,s}var Bp={animationend:jx("Animation","AnimationEnd"),animationiteration:jx("Animation","AnimationIteration"),animationstart:jx("Animation","AnimationStart"),transitionend:jx("Transition","TransitionEnd")},qb={},uR={};Wc&&(uR=document.createElement("div").style,"AnimationEvent"in window||(delete Bp.animationend.animation,delete Bp.animationiteration.animation,delete Bp.animationstart.animation),"TransitionEvent"in window||delete Bp.transitionend.transition);function d1(t){if(qb[t])return qb[t];if(!Bp[t])return t;var r=Bp[t],s;for(s in r)if(r.hasOwnProperty(s)&&s in uR)return qb[t]=r[s];return t}var hR=d1("animationend"),dR=d1("animationiteration"),fR=d1("animationstart"),pR=d1("transitionend"),mR=new Map,wP="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _h(t,r){mR.set(t,r),Nd(r,[t])}for(var Zb=0;Zb<wP.length;Zb++){var Xb=wP[Zb],Yz=Xb.toLowerCase(),Jz=Xb[0].toUpperCase()+Xb.slice(1);_h(Yz,"on"+Jz)}_h(hR,"onAnimationEnd");_h(dR,"onAnimationIteration");_h(fR,"onAnimationStart");_h("dblclick","onDoubleClick");_h("focusin","onFocus");_h("focusout","onBlur");_h(pR,"onTransitionEnd");sm("onMouseEnter",["mouseout","mouseover"]);sm("onMouseLeave",["mouseout","mouseover"]);sm("onPointerEnter",["pointerout","pointerover"]);sm("onPointerLeave",["pointerout","pointerover"]);Nd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nd("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qz=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rg));function bP(t,r,s){var u=t.type||"unknown-event";t.currentTarget=s,YN(u,r,void 0,t),t.currentTarget=null}function gR(t,r){r=(r&4)!==0;for(var s=0;s<t.length;s++){var u=t[s],m=u.event;u=u.listeners;e:{var v=void 0;if(r)for(var T=u.length-1;0<=T;T--){var a=u[T],R=a.instance,O=a.currentTarget;if(a=a.listener,R!==v&&m.isPropagationStopped())break e;bP(m,a,O),v=R}else for(T=0;T<u.length;T++){if(a=u[T],R=a.instance,O=a.currentTarget,a=a.listener,R!==v&&m.isPropagationStopped())break e;bP(m,a,O),v=R}}}if(bv)throw t=B2,bv=!1,B2=null,t}function Bn(t,r){var s=r[X2];s===void 0&&(s=r[X2]=new Set);var u=t+"__bubble";s.has(u)||(_R(r,t,2,!1),s.add(u))}function Kb(t,r,s){var u=0;r&&(u|=4),_R(s,t,u,r)}var Ux="_reactListening"+Math.random().toString(36).slice(2);function a_(t){if(!t[Ux]){t[Ux]=!0,Sk.forEach(function(s){s!=="selectionchange"&&(Qz.has(s)||Kb(s,!1,t),Kb(s,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[Ux]||(r[Ux]=!0,Kb("selectionchange",!1,r))}}function _R(t,r,s,u){switch(eR(r)){case 1:var m=fz;break;case 4:m=pz;break;default:m=ZT}s=m.bind(null,r,s,t),m=void 0,!z2||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(m=!0),u?m!==void 0?t.addEventListener(r,s,{capture:!0,passive:m}):t.addEventListener(r,s,!0):m!==void 0?t.addEventListener(r,s,{passive:m}):t.addEventListener(r,s,!1)}function Yb(t,r,s,u,m){var v=u;if(!(r&1)&&!(r&2)&&u!==null)e:for(;;){if(u===null)return;var T=u.tag;if(T===3||T===4){var a=u.stateNode.containerInfo;if(a===m||a.nodeType===8&&a.parentNode===m)break;if(T===4)for(T=u.return;T!==null;){var R=T.tag;if((R===3||R===4)&&(R=T.stateNode.containerInfo,R===m||R.nodeType===8&&R.parentNode===m))return;T=T.return}for(;a!==null;){if(T=bd(a),T===null)return;if(R=T.tag,R===5||R===6){u=v=T;continue e}a=a.parentNode}}u=u.return}jk(function(){var O=v,B=GT(s),H=[];e:{var q=mR.get(t);if(q!==void 0){var ee=KT,re=t;switch(t){case"keypress":if(hv(s)===0)break e;case"keydown":case"keyup":ee=Pz;break;case"focusin":re="focus",ee=Gb;break;case"focusout":re="blur",ee=Gb;break;case"beforeblur":case"afterblur":ee=Gb;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ee=uP;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ee=_z;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ee=Mz;break;case hR:case dR:case fR:ee=vz;break;case pR:ee=Oz;break;case"scroll":ee=mz;break;case"wheel":ee=Fz;break;case"copy":case"cut":case"paste":ee=bz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ee=dP}var J=(r&4)!==0,_e=!J&&t==="scroll",pe=J?q!==null?q+"Capture":null:q;J=[];for(var ue=O,ie;ue!==null;){ie=ue;var ke=ie.stateNode;if(ie.tag===5&&ke!==null&&(ie=ke,pe!==null&&(ke=t_(ue,pe),ke!=null&&J.push(l_(ue,ke,ie)))),_e)break;ue=ue.return}0<J.length&&(q=new ee(q,re,null,s,B),H.push({event:q,listeners:J}))}}if(!(r&7)){e:{if(q=t==="mouseover"||t==="pointerover",ee=t==="mouseout"||t==="pointerout",q&&s!==F2&&(re=s.relatedTarget||s.fromElement)&&(bd(re)||re[qc]))break e;if((ee||q)&&(q=B.window===B?B:(q=B.ownerDocument)?q.defaultView||q.parentWindow:window,ee?(re=s.relatedTarget||s.toElement,ee=O,re=re?bd(re):null,re!==null&&(_e=zd(re),re!==_e||re.tag!==5&&re.tag!==6)&&(re=null)):(ee=null,re=O),ee!==re)){if(J=uP,ke="onMouseLeave",pe="onMouseEnter",ue="mouse",(t==="pointerout"||t==="pointerover")&&(J=dP,ke="onPointerLeave",pe="onPointerEnter",ue="pointer"),_e=ee==null?q:jp(ee),ie=re==null?q:jp(re),q=new J(ke,ue+"leave",ee,s,B),q.target=_e,q.relatedTarget=ie,ke=null,bd(B)===O&&(J=new J(pe,ue+"enter",re,s,B),J.target=ie,J.relatedTarget=_e,ke=J),_e=ke,ee&&re)t:{for(J=ee,pe=re,ue=0,ie=J;ie;ie=Tp(ie))ue++;for(ie=0,ke=pe;ke;ke=Tp(ke))ie++;for(;0<ue-ie;)J=Tp(J),ue--;for(;0<ie-ue;)pe=Tp(pe),ie--;for(;ue--;){if(J===pe||pe!==null&&J===pe.alternate)break t;J=Tp(J),pe=Tp(pe)}J=null}else J=null;ee!==null&&TP(H,q,ee,J,!1),re!==null&&_e!==null&&TP(H,_e,re,J,!0)}}e:{if(q=O?jp(O):window,ee=q.nodeName&&q.nodeName.toLowerCase(),ee==="select"||ee==="input"&&q.type==="file")var at=$z;else if(mP(q))if(oR)at=qz;else{at=Hz;var He=Gz}else(ee=q.nodeName)&&ee.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(at=Wz);if(at&&(at=at(t,O))){sR(H,at,s,B);break e}He&&He(t,q,O),t==="focusout"&&(He=q._wrapperState)&&He.controlled&&q.type==="number"&&R2(q,"number",q.value)}switch(He=O?jp(O):window,t){case"focusin":(mP(He)||He.contentEditable==="true")&&(zp=He,$2=O,Bg=null);break;case"focusout":Bg=$2=zp=null;break;case"mousedown":G2=!0;break;case"contextmenu":case"mouseup":case"dragend":G2=!1,vP(H,s,B);break;case"selectionchange":if(Kz)break;case"keydown":case"keyup":vP(H,s,B)}var De;if(JT)e:{switch(t){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else Np?iR(t,s)&&(et="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(et="onCompositionStart");et&&(rR&&s.locale!=="ko"&&(Np||et!=="onCompositionStart"?et==="onCompositionEnd"&&Np&&(De=tR()):(eh=B,XT="value"in eh?eh.value:eh.textContent,Np=!0)),He=Iv(O,et),0<He.length&&(et=new hP(et,t,null,s,B),H.push({event:et,listeners:He}),De?et.data=De:(De=nR(s),De!==null&&(et.data=De)))),(De=zz?Bz(t,s):jz(t,s))&&(O=Iv(O,"onBeforeInput"),0<O.length&&(B=new hP("onBeforeInput","beforeinput",null,s,B),H.push({event:B,listeners:O}),B.data=De))}gR(H,r)})}function l_(t,r,s){return{instance:t,listener:r,currentTarget:s}}function Iv(t,r){for(var s=r+"Capture",u=[];t!==null;){var m=t,v=m.stateNode;m.tag===5&&v!==null&&(m=v,v=t_(t,s),v!=null&&u.unshift(l_(t,v,m)),v=t_(t,r),v!=null&&u.push(l_(t,v,m))),t=t.return}return u}function Tp(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function TP(t,r,s,u,m){for(var v=r._reactName,T=[];s!==null&&s!==u;){var a=s,R=a.alternate,O=a.stateNode;if(R!==null&&R===u)break;a.tag===5&&O!==null&&(a=O,m?(R=t_(s,v),R!=null&&T.unshift(l_(s,R,a))):m||(R=t_(s,v),R!=null&&T.push(l_(s,R,a)))),s=s.return}T.length!==0&&t.push({event:r,listeners:T})}var eB=/\r\n?/g,tB=/\u0000|\uFFFD/g;function SP(t){return(typeof t=="string"?t:""+t).replace(eB,`
`).replace(tB,"")}function Vx(t,r,s){if(r=SP(r),SP(t)!==r&&s)throw Error(_r(425))}function Cv(){}var H2=null,W2=null;function q2(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Z2=typeof setTimeout=="function"?setTimeout:void 0,rB=typeof clearTimeout=="function"?clearTimeout:void 0,EP=typeof Promise=="function"?Promise:void 0,iB=typeof queueMicrotask=="function"?queueMicrotask:typeof EP<"u"?function(t){return EP.resolve(null).then(t).catch(nB)}:Z2;function nB(t){setTimeout(function(){throw t})}function Jb(t,r){var s=r,u=0;do{var m=s.nextSibling;if(t.removeChild(s),m&&m.nodeType===8)if(s=m.data,s==="/$"){if(u===0){t.removeChild(m),n_(r);return}u--}else s!=="$"&&s!=="$?"&&s!=="$!"||u++;s=m}while(s);n_(r)}function ah(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return t}function AP(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(r===0)return t;r--}else s==="/$"&&r++}t=t.previousSibling}return null}var gm=Math.random().toString(36).slice(2),rc="__reactFiber$"+gm,c_="__reactProps$"+gm,qc="__reactContainer$"+gm,X2="__reactEvents$"+gm,sB="__reactListeners$"+gm,oB="__reactHandles$"+gm;function bd(t){var r=t[rc];if(r)return r;for(var s=t.parentNode;s;){if(r=s[qc]||s[rc]){if(s=r.alternate,r.child!==null||s!==null&&s.child!==null)for(t=AP(t);t!==null;){if(s=t[rc])return s;t=AP(t)}return r}t=s,s=t.parentNode}return null}function P_(t){return t=t[rc]||t[qc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function jp(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(_r(33))}function f1(t){return t[c_]||null}var K2=[],Up=-1;function yh(t){return{current:t}}function jn(t){0>Up||(t.current=K2[Up],K2[Up]=null,Up--)}function On(t,r){Up++,K2[Up]=t.current,t.current=r}var fh={},po=yh(fh),Ho=yh(!1),Cd=fh;function om(t,r){var s=t.type.contextTypes;if(!s)return fh;var u=t.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===r)return u.__reactInternalMemoizedMaskedChildContext;var m={},v;for(v in s)m[v]=r[v];return u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=m),m}function Wo(t){return t=t.childContextTypes,t!=null}function Pv(){jn(Ho),jn(po)}function IP(t,r,s){if(po.current!==fh)throw Error(_r(168));On(po,r),On(Ho,s)}function yR(t,r,s){var u=t.stateNode;if(r=r.childContextTypes,typeof u.getChildContext!="function")return s;u=u.getChildContext();for(var m in u)if(!(m in r))throw Error(_r(108,GN(t)||"Unknown",m));return es({},s,u)}function kv(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fh,Cd=po.current,On(po,t),On(Ho,Ho.current),!0}function CP(t,r,s){var u=t.stateNode;if(!u)throw Error(_r(169));s?(t=yR(t,r,Cd),u.__reactInternalMemoizedMergedChildContext=t,jn(Ho),jn(po),On(po,t)):jn(Ho),On(Ho,s)}var zc=null,p1=!1,Qb=!1;function xR(t){zc===null?zc=[t]:zc.push(t)}function aB(t){p1=!0,xR(t)}function xh(){if(!Qb&&zc!==null){Qb=!0;var t=0,r=xn;try{var s=zc;for(xn=1;t<s.length;t++){var u=s[t];do u=u(!0);while(u!==null)}zc=null,p1=!1}catch(m){throw zc!==null&&(zc=zc.slice(t+1)),Gk(HT,xh),m}finally{xn=r,Qb=!1}}return null}var Vp=[],$p=0,Rv=null,Mv=0,Ba=[],ja=0,Pd=null,Bc=1,jc="";function gd(t,r){Vp[$p++]=Mv,Vp[$p++]=Rv,Rv=t,Mv=r}function vR(t,r,s){Ba[ja++]=Bc,Ba[ja++]=jc,Ba[ja++]=Pd,Pd=t;var u=Bc;t=jc;var m=32-_l(u)-1;u&=~(1<<m),s+=1;var v=32-_l(r)+m;if(30<v){var T=m-m%5;v=(u&(1<<T)-1).toString(32),u>>=T,m-=T,Bc=1<<32-_l(r)+m|s<<m|u,jc=v+t}else Bc=1<<v|s<<m|u,jc=t}function eS(t){t.return!==null&&(gd(t,1),vR(t,1,0))}function tS(t){for(;t===Rv;)Rv=Vp[--$p],Vp[$p]=null,Mv=Vp[--$p],Vp[$p]=null;for(;t===Pd;)Pd=Ba[--ja],Ba[ja]=null,jc=Ba[--ja],Ba[ja]=null,Bc=Ba[--ja],Ba[ja]=null}var xa=null,ya=null,Zn=!1,pl=null;function wR(t,r){var s=Ua(5,null,null,0);s.elementType="DELETED",s.stateNode=r,s.return=t,r=t.deletions,r===null?(t.deletions=[s],t.flags|=16):r.push(s)}function PP(t,r){switch(t.tag){case 5:var s=t.type;return r=r.nodeType!==1||s.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(t.stateNode=r,xa=t,ya=ah(r.firstChild),!0):!1;case 6:return r=t.pendingProps===""||r.nodeType!==3?null:r,r!==null?(t.stateNode=r,xa=t,ya=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(s=Pd!==null?{id:Bc,overflow:jc}:null,t.memoizedState={dehydrated:r,treeContext:s,retryLane:1073741824},s=Ua(18,null,null,0),s.stateNode=r,s.return=t,t.child=s,xa=t,ya=null,!0):!1;default:return!1}}function Y2(t){return(t.mode&1)!==0&&(t.flags&128)===0}function J2(t){if(Zn){var r=ya;if(r){var s=r;if(!PP(t,r)){if(Y2(t))throw Error(_r(418));r=ah(s.nextSibling);var u=xa;r&&PP(t,r)?wR(u,s):(t.flags=t.flags&-4097|2,Zn=!1,xa=t)}}else{if(Y2(t))throw Error(_r(418));t.flags=t.flags&-4097|2,Zn=!1,xa=t}}}function kP(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;xa=t}function $x(t){if(t!==xa)return!1;if(!Zn)return kP(t),Zn=!0,!1;var r;if((r=t.tag!==3)&&!(r=t.tag!==5)&&(r=t.type,r=r!=="head"&&r!=="body"&&!q2(t.type,t.memoizedProps)),r&&(r=ya)){if(Y2(t))throw bR(),Error(_r(418));for(;r;)wR(t,r),r=ah(r.nextSibling)}if(kP(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(_r(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(r===0){ya=ah(t.nextSibling);break e}r--}else s!=="$"&&s!=="$!"&&s!=="$?"||r++}t=t.nextSibling}ya=null}}else ya=xa?ah(t.stateNode.nextSibling):null;return!0}function bR(){for(var t=ya;t;)t=ah(t.nextSibling)}function am(){ya=xa=null,Zn=!1}function rS(t){pl===null?pl=[t]:pl.push(t)}var lB=Qc.ReactCurrentBatchConfig;function bg(t,r,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(_r(309));var u=s.stateNode}if(!u)throw Error(_r(147,t));var m=u,v=""+t;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===v?r.ref:(r=function(T){var a=m.refs;T===null?delete a[v]:a[v]=T},r._stringRef=v,r)}if(typeof t!="string")throw Error(_r(284));if(!s._owner)throw Error(_r(290,t))}return t}function Gx(t,r){throw t=Object.prototype.toString.call(r),Error(_r(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t))}function RP(t){var r=t._init;return r(t._payload)}function TR(t){function r(pe,ue){if(t){var ie=pe.deletions;ie===null?(pe.deletions=[ue],pe.flags|=16):ie.push(ue)}}function s(pe,ue){if(!t)return null;for(;ue!==null;)r(pe,ue),ue=ue.sibling;return null}function u(pe,ue){for(pe=new Map;ue!==null;)ue.key!==null?pe.set(ue.key,ue):pe.set(ue.index,ue),ue=ue.sibling;return pe}function m(pe,ue){return pe=hh(pe,ue),pe.index=0,pe.sibling=null,pe}function v(pe,ue,ie){return pe.index=ie,t?(ie=pe.alternate,ie!==null?(ie=ie.index,ie<ue?(pe.flags|=2,ue):ie):(pe.flags|=2,ue)):(pe.flags|=1048576,ue)}function T(pe){return t&&pe.alternate===null&&(pe.flags|=2),pe}function a(pe,ue,ie,ke){return ue===null||ue.tag!==6?(ue=o2(ie,pe.mode,ke),ue.return=pe,ue):(ue=m(ue,ie),ue.return=pe,ue)}function R(pe,ue,ie,ke){var at=ie.type;return at===Fp?B(pe,ue,ie.props.children,ke,ie.key):ue!==null&&(ue.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===Xu&&RP(at)===ue.type)?(ke=m(ue,ie.props),ke.ref=bg(pe,ue,ie),ke.return=pe,ke):(ke=yv(ie.type,ie.key,ie.props,null,pe.mode,ke),ke.ref=bg(pe,ue,ie),ke.return=pe,ke)}function O(pe,ue,ie,ke){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==ie.containerInfo||ue.stateNode.implementation!==ie.implementation?(ue=a2(ie,pe.mode,ke),ue.return=pe,ue):(ue=m(ue,ie.children||[]),ue.return=pe,ue)}function B(pe,ue,ie,ke,at){return ue===null||ue.tag!==7?(ue=Ad(ie,pe.mode,ke,at),ue.return=pe,ue):(ue=m(ue,ie),ue.return=pe,ue)}function H(pe,ue,ie){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ue=o2(""+ue,pe.mode,ie),ue.return=pe,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Dx:return ie=yv(ue.type,ue.key,ue.props,null,pe.mode,ie),ie.ref=bg(pe,null,ue),ie.return=pe,ie;case Lp:return ue=a2(ue,pe.mode,ie),ue.return=pe,ue;case Xu:var ke=ue._init;return H(pe,ke(ue._payload),ie)}if(Pg(ue)||_g(ue))return ue=Ad(ue,pe.mode,ie,null),ue.return=pe,ue;Gx(pe,ue)}return null}function q(pe,ue,ie,ke){var at=ue!==null?ue.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number")return at!==null?null:a(pe,ue,""+ie,ke);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case Dx:return ie.key===at?R(pe,ue,ie,ke):null;case Lp:return ie.key===at?O(pe,ue,ie,ke):null;case Xu:return at=ie._init,q(pe,ue,at(ie._payload),ke)}if(Pg(ie)||_g(ie))return at!==null?null:B(pe,ue,ie,ke,null);Gx(pe,ie)}return null}function ee(pe,ue,ie,ke,at){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return pe=pe.get(ie)||null,a(ue,pe,""+ke,at);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case Dx:return pe=pe.get(ke.key===null?ie:ke.key)||null,R(ue,pe,ke,at);case Lp:return pe=pe.get(ke.key===null?ie:ke.key)||null,O(ue,pe,ke,at);case Xu:var He=ke._init;return ee(pe,ue,ie,He(ke._payload),at)}if(Pg(ke)||_g(ke))return pe=pe.get(ie)||null,B(ue,pe,ke,at,null);Gx(ue,ke)}return null}function re(pe,ue,ie,ke){for(var at=null,He=null,De=ue,et=ue=0,Ge=null;De!==null&&et<ie.length;et++){De.index>et?(Ge=De,De=null):Ge=De.sibling;var ft=q(pe,De,ie[et],ke);if(ft===null){De===null&&(De=Ge);break}t&&De&&ft.alternate===null&&r(pe,De),ue=v(ft,ue,et),He===null?at=ft:He.sibling=ft,He=ft,De=Ge}if(et===ie.length)return s(pe,De),Zn&&gd(pe,et),at;if(De===null){for(;et<ie.length;et++)De=H(pe,ie[et],ke),De!==null&&(ue=v(De,ue,et),He===null?at=De:He.sibling=De,He=De);return Zn&&gd(pe,et),at}for(De=u(pe,De);et<ie.length;et++)Ge=ee(De,pe,et,ie[et],ke),Ge!==null&&(t&&Ge.alternate!==null&&De.delete(Ge.key===null?et:Ge.key),ue=v(Ge,ue,et),He===null?at=Ge:He.sibling=Ge,He=Ge);return t&&De.forEach(function(tt){return r(pe,tt)}),Zn&&gd(pe,et),at}function J(pe,ue,ie,ke){var at=_g(ie);if(typeof at!="function")throw Error(_r(150));if(ie=at.call(ie),ie==null)throw Error(_r(151));for(var He=at=null,De=ue,et=ue=0,Ge=null,ft=ie.next();De!==null&&!ft.done;et++,ft=ie.next()){De.index>et?(Ge=De,De=null):Ge=De.sibling;var tt=q(pe,De,ft.value,ke);if(tt===null){De===null&&(De=Ge);break}t&&De&&tt.alternate===null&&r(pe,De),ue=v(tt,ue,et),He===null?at=tt:He.sibling=tt,He=tt,De=Ge}if(ft.done)return s(pe,De),Zn&&gd(pe,et),at;if(De===null){for(;!ft.done;et++,ft=ie.next())ft=H(pe,ft.value,ke),ft!==null&&(ue=v(ft,ue,et),He===null?at=ft:He.sibling=ft,He=ft);return Zn&&gd(pe,et),at}for(De=u(pe,De);!ft.done;et++,ft=ie.next())ft=ee(De,pe,et,ft.value,ke),ft!==null&&(t&&ft.alternate!==null&&De.delete(ft.key===null?et:ft.key),ue=v(ft,ue,et),He===null?at=ft:He.sibling=ft,He=ft);return t&&De.forEach(function(Ot){return r(pe,Ot)}),Zn&&gd(pe,et),at}function _e(pe,ue,ie,ke){if(typeof ie=="object"&&ie!==null&&ie.type===Fp&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case Dx:e:{for(var at=ie.key,He=ue;He!==null;){if(He.key===at){if(at=ie.type,at===Fp){if(He.tag===7){s(pe,He.sibling),ue=m(He,ie.props.children),ue.return=pe,pe=ue;break e}}else if(He.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===Xu&&RP(at)===He.type){s(pe,He.sibling),ue=m(He,ie.props),ue.ref=bg(pe,He,ie),ue.return=pe,pe=ue;break e}s(pe,He);break}else r(pe,He);He=He.sibling}ie.type===Fp?(ue=Ad(ie.props.children,pe.mode,ke,ie.key),ue.return=pe,pe=ue):(ke=yv(ie.type,ie.key,ie.props,null,pe.mode,ke),ke.ref=bg(pe,ue,ie),ke.return=pe,pe=ke)}return T(pe);case Lp:e:{for(He=ie.key;ue!==null;){if(ue.key===He)if(ue.tag===4&&ue.stateNode.containerInfo===ie.containerInfo&&ue.stateNode.implementation===ie.implementation){s(pe,ue.sibling),ue=m(ue,ie.children||[]),ue.return=pe,pe=ue;break e}else{s(pe,ue);break}else r(pe,ue);ue=ue.sibling}ue=a2(ie,pe.mode,ke),ue.return=pe,pe=ue}return T(pe);case Xu:return He=ie._init,_e(pe,ue,He(ie._payload),ke)}if(Pg(ie))return re(pe,ue,ie,ke);if(_g(ie))return J(pe,ue,ie,ke);Gx(pe,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"?(ie=""+ie,ue!==null&&ue.tag===6?(s(pe,ue.sibling),ue=m(ue,ie),ue.return=pe,pe=ue):(s(pe,ue),ue=o2(ie,pe.mode,ke),ue.return=pe,pe=ue),T(pe)):s(pe,ue)}return _e}var lm=TR(!0),SR=TR(!1),Dv=yh(null),Ov=null,Gp=null,iS=null;function nS(){iS=Gp=Ov=null}function sS(t){var r=Dv.current;jn(Dv),t._currentValue=r}function Q2(t,r,s){for(;t!==null;){var u=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,u!==null&&(u.childLanes|=r)):u!==null&&(u.childLanes&r)!==r&&(u.childLanes|=r),t===s)break;t=t.return}}function Qp(t,r){Ov=t,iS=Gp=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&r&&(Go=!0),t.firstContext=null)}function $a(t){var r=t._currentValue;if(iS!==t)if(t={context:t,memoizedValue:r,next:null},Gp===null){if(Ov===null)throw Error(_r(308));Gp=t,Ov.dependencies={lanes:0,firstContext:t}}else Gp=Gp.next=t;return r}var Td=null;function oS(t){Td===null?Td=[t]:Td.push(t)}function ER(t,r,s,u){var m=r.interleaved;return m===null?(s.next=s,oS(r)):(s.next=m.next,m.next=s),r.interleaved=s,Zc(t,u)}function Zc(t,r){t.lanes|=r;var s=t.alternate;for(s!==null&&(s.lanes|=r),s=t,t=t.return;t!==null;)t.childLanes|=r,s=t.alternate,s!==null&&(s.childLanes|=r),s=t,t=t.return;return s.tag===3?s.stateNode:null}var Ku=!1;function aS(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AR(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Uc(t,r){return{eventTime:t,lane:r,tag:0,payload:null,callback:null,next:null}}function lh(t,r,s){var u=t.updateQueue;if(u===null)return null;if(u=u.shared,on&2){var m=u.pending;return m===null?r.next=r:(r.next=m.next,m.next=r),u.pending=r,Zc(t,s)}return m=u.interleaved,m===null?(r.next=r,oS(u)):(r.next=m.next,m.next=r),u.interleaved=r,Zc(t,s)}function dv(t,r,s){if(r=r.updateQueue,r!==null&&(r=r.shared,(s&4194240)!==0)){var u=r.lanes;u&=t.pendingLanes,s|=u,r.lanes=s,WT(t,s)}}function MP(t,r){var s=t.updateQueue,u=t.alternate;if(u!==null&&(u=u.updateQueue,s===u)){var m=null,v=null;if(s=s.firstBaseUpdate,s!==null){do{var T={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};v===null?m=v=T:v=v.next=T,s=s.next}while(s!==null);v===null?m=v=r:v=v.next=r}else m=v=r;s={baseState:u.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:u.shared,effects:u.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=r:t.next=r,s.lastBaseUpdate=r}function Lv(t,r,s,u){var m=t.updateQueue;Ku=!1;var v=m.firstBaseUpdate,T=m.lastBaseUpdate,a=m.shared.pending;if(a!==null){m.shared.pending=null;var R=a,O=R.next;R.next=null,T===null?v=O:T.next=O,T=R;var B=t.alternate;B!==null&&(B=B.updateQueue,a=B.lastBaseUpdate,a!==T&&(a===null?B.firstBaseUpdate=O:a.next=O,B.lastBaseUpdate=R))}if(v!==null){var H=m.baseState;T=0,B=O=R=null,a=v;do{var q=a.lane,ee=a.eventTime;if((u&q)===q){B!==null&&(B=B.next={eventTime:ee,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var re=t,J=a;switch(q=r,ee=s,J.tag){case 1:if(re=J.payload,typeof re=="function"){H=re.call(ee,H,q);break e}H=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=J.payload,q=typeof re=="function"?re.call(ee,H,q):re,q==null)break e;H=es({},H,q);break e;case 2:Ku=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,q=m.effects,q===null?m.effects=[a]:q.push(a))}else ee={eventTime:ee,lane:q,tag:a.tag,payload:a.payload,callback:a.callback,next:null},B===null?(O=B=ee,R=H):B=B.next=ee,T|=q;if(a=a.next,a===null){if(a=m.shared.pending,a===null)break;q=a,a=q.next,q.next=null,m.lastBaseUpdate=q,m.shared.pending=null}}while(!0);if(B===null&&(R=H),m.baseState=R,m.firstBaseUpdate=O,m.lastBaseUpdate=B,r=m.shared.interleaved,r!==null){m=r;do T|=m.lane,m=m.next;while(m!==r)}else v===null&&(m.shared.lanes=0);Rd|=T,t.lanes=T,t.memoizedState=H}}function DP(t,r,s){if(t=r.effects,r.effects=null,t!==null)for(r=0;r<t.length;r++){var u=t[r],m=u.callback;if(m!==null){if(u.callback=null,u=s,typeof m!="function")throw Error(_r(191,m));m.call(u)}}}var k_={},nc=yh(k_),u_=yh(k_),h_=yh(k_);function Sd(t){if(t===k_)throw Error(_r(174));return t}function lS(t,r){switch(On(h_,r),On(u_,t),On(nc,k_),t=r.nodeType,t){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:D2(null,"");break;default:t=t===8?r.parentNode:r,r=t.namespaceURI||null,t=t.tagName,r=D2(r,t)}jn(nc),On(nc,r)}function cm(){jn(nc),jn(u_),jn(h_)}function IR(t){Sd(h_.current);var r=Sd(nc.current),s=D2(r,t.type);r!==s&&(On(u_,t),On(nc,s))}function cS(t){u_.current===t&&(jn(nc),jn(u_))}var Jn=yh(0);function Fv(t){for(var r=t;r!==null;){if(r.tag===13){var s=r.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var e2=[];function uS(){for(var t=0;t<e2.length;t++)e2[t]._workInProgressVersionPrimary=null;e2.length=0}var fv=Qc.ReactCurrentDispatcher,t2=Qc.ReactCurrentBatchConfig,kd=0,Qn=null,Cs=null,zs=null,Nv=!1,jg=!1,d_=0,cB=0;function lo(){throw Error(_r(321))}function hS(t,r){if(r===null)return!1;for(var s=0;s<r.length&&s<t.length;s++)if(!vl(t[s],r[s]))return!1;return!0}function dS(t,r,s,u,m,v){if(kd=v,Qn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,fv.current=t===null||t.memoizedState===null?fB:pB,t=s(u,m),jg){v=0;do{if(jg=!1,d_=0,25<=v)throw Error(_r(301));v+=1,zs=Cs=null,r.updateQueue=null,fv.current=mB,t=s(u,m)}while(jg)}if(fv.current=zv,r=Cs!==null&&Cs.next!==null,kd=0,zs=Cs=Qn=null,Nv=!1,r)throw Error(_r(300));return t}function fS(){var t=d_!==0;return d_=0,t}function ec(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zs===null?Qn.memoizedState=zs=t:zs=zs.next=t,zs}function Ga(){if(Cs===null){var t=Qn.alternate;t=t!==null?t.memoizedState:null}else t=Cs.next;var r=zs===null?Qn.memoizedState:zs.next;if(r!==null)zs=r,Cs=t;else{if(t===null)throw Error(_r(310));Cs=t,t={memoizedState:Cs.memoizedState,baseState:Cs.baseState,baseQueue:Cs.baseQueue,queue:Cs.queue,next:null},zs===null?Qn.memoizedState=zs=t:zs=zs.next=t}return zs}function f_(t,r){return typeof r=="function"?r(t):r}function r2(t){var r=Ga(),s=r.queue;if(s===null)throw Error(_r(311));s.lastRenderedReducer=t;var u=Cs,m=u.baseQueue,v=s.pending;if(v!==null){if(m!==null){var T=m.next;m.next=v.next,v.next=T}u.baseQueue=m=v,s.pending=null}if(m!==null){v=m.next,u=u.baseState;var a=T=null,R=null,O=v;do{var B=O.lane;if((kd&B)===B)R!==null&&(R=R.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),u=O.hasEagerState?O.eagerState:t(u,O.action);else{var H={lane:B,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};R===null?(a=R=H,T=u):R=R.next=H,Qn.lanes|=B,Rd|=B}O=O.next}while(O!==null&&O!==v);R===null?T=u:R.next=a,vl(u,r.memoizedState)||(Go=!0),r.memoizedState=u,r.baseState=T,r.baseQueue=R,s.lastRenderedState=u}if(t=s.interleaved,t!==null){m=t;do v=m.lane,Qn.lanes|=v,Rd|=v,m=m.next;while(m!==t)}else m===null&&(s.lanes=0);return[r.memoizedState,s.dispatch]}function i2(t){var r=Ga(),s=r.queue;if(s===null)throw Error(_r(311));s.lastRenderedReducer=t;var u=s.dispatch,m=s.pending,v=r.memoizedState;if(m!==null){s.pending=null;var T=m=m.next;do v=t(v,T.action),T=T.next;while(T!==m);vl(v,r.memoizedState)||(Go=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),s.lastRenderedState=v}return[v,u]}function CR(){}function PR(t,r){var s=Qn,u=Ga(),m=r(),v=!vl(u.memoizedState,m);if(v&&(u.memoizedState=m,Go=!0),u=u.queue,pS(MR.bind(null,s,u,t),[t]),u.getSnapshot!==r||v||zs!==null&&zs.memoizedState.tag&1){if(s.flags|=2048,p_(9,RR.bind(null,s,u,m,r),void 0,null),Vs===null)throw Error(_r(349));kd&30||kR(s,r,m)}return m}function kR(t,r,s){t.flags|=16384,t={getSnapshot:r,value:s},r=Qn.updateQueue,r===null?(r={lastEffect:null,stores:null},Qn.updateQueue=r,r.stores=[t]):(s=r.stores,s===null?r.stores=[t]:s.push(t))}function RR(t,r,s,u){r.value=s,r.getSnapshot=u,DR(r)&&OR(t)}function MR(t,r,s){return s(function(){DR(r)&&OR(t)})}function DR(t){var r=t.getSnapshot;t=t.value;try{var s=r();return!vl(t,s)}catch{return!0}}function OR(t){var r=Zc(t,1);r!==null&&yl(r,t,1,-1)}function OP(t){var r=ec();return typeof t=="function"&&(t=t()),r.memoizedState=r.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f_,lastRenderedState:t},r.queue=t,t=t.dispatch=dB.bind(null,Qn,t),[r.memoizedState,t]}function p_(t,r,s,u){return t={tag:t,create:r,destroy:s,deps:u,next:null},r=Qn.updateQueue,r===null?(r={lastEffect:null,stores:null},Qn.updateQueue=r,r.lastEffect=t.next=t):(s=r.lastEffect,s===null?r.lastEffect=t.next=t:(u=s.next,s.next=t,t.next=u,r.lastEffect=t)),t}function LR(){return Ga().memoizedState}function pv(t,r,s,u){var m=ec();Qn.flags|=t,m.memoizedState=p_(1|r,s,void 0,u===void 0?null:u)}function m1(t,r,s,u){var m=Ga();u=u===void 0?null:u;var v=void 0;if(Cs!==null){var T=Cs.memoizedState;if(v=T.destroy,u!==null&&hS(u,T.deps)){m.memoizedState=p_(r,s,v,u);return}}Qn.flags|=t,m.memoizedState=p_(1|r,s,v,u)}function LP(t,r){return pv(8390656,8,t,r)}function pS(t,r){return m1(2048,8,t,r)}function FR(t,r){return m1(4,2,t,r)}function NR(t,r){return m1(4,4,t,r)}function zR(t,r){if(typeof r=="function")return t=t(),r(t),function(){r(null)};if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function BR(t,r,s){return s=s!=null?s.concat([t]):null,m1(4,4,zR.bind(null,r,t),s)}function mS(){}function jR(t,r){var s=Ga();r=r===void 0?null:r;var u=s.memoizedState;return u!==null&&r!==null&&hS(r,u[1])?u[0]:(s.memoizedState=[t,r],t)}function UR(t,r){var s=Ga();r=r===void 0?null:r;var u=s.memoizedState;return u!==null&&r!==null&&hS(r,u[1])?u[0]:(t=t(),s.memoizedState=[t,r],t)}function VR(t,r,s){return kd&21?(vl(s,r)||(s=qk(),Qn.lanes|=s,Rd|=s,t.baseState=!0),r):(t.baseState&&(t.baseState=!1,Go=!0),t.memoizedState=s)}function uB(t,r){var s=xn;xn=s!==0&&4>s?s:4,t(!0);var u=t2.transition;t2.transition={};try{t(!1),r()}finally{xn=s,t2.transition=u}}function $R(){return Ga().memoizedState}function hB(t,r,s){var u=uh(t);if(s={lane:u,action:s,hasEagerState:!1,eagerState:null,next:null},GR(t))HR(r,s);else if(s=ER(t,r,s,u),s!==null){var m=Oo();yl(s,t,u,m),WR(s,r,u)}}function dB(t,r,s){var u=uh(t),m={lane:u,action:s,hasEagerState:!1,eagerState:null,next:null};if(GR(t))HR(r,m);else{var v=t.alternate;if(t.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var T=r.lastRenderedState,a=v(T,s);if(m.hasEagerState=!0,m.eagerState=a,vl(a,T)){var R=r.interleaved;R===null?(m.next=m,oS(r)):(m.next=R.next,R.next=m),r.interleaved=m;return}}catch{}finally{}s=ER(t,r,m,u),s!==null&&(m=Oo(),yl(s,t,u,m),WR(s,r,u))}}function GR(t){var r=t.alternate;return t===Qn||r!==null&&r===Qn}function HR(t,r){jg=Nv=!0;var s=t.pending;s===null?r.next=r:(r.next=s.next,s.next=r),t.pending=r}function WR(t,r,s){if(s&4194240){var u=r.lanes;u&=t.pendingLanes,s|=u,r.lanes=s,WT(t,s)}}var zv={readContext:$a,useCallback:lo,useContext:lo,useEffect:lo,useImperativeHandle:lo,useInsertionEffect:lo,useLayoutEffect:lo,useMemo:lo,useReducer:lo,useRef:lo,useState:lo,useDebugValue:lo,useDeferredValue:lo,useTransition:lo,useMutableSource:lo,useSyncExternalStore:lo,useId:lo,unstable_isNewReconciler:!1},fB={readContext:$a,useCallback:function(t,r){return ec().memoizedState=[t,r===void 0?null:r],t},useContext:$a,useEffect:LP,useImperativeHandle:function(t,r,s){return s=s!=null?s.concat([t]):null,pv(4194308,4,zR.bind(null,r,t),s)},useLayoutEffect:function(t,r){return pv(4194308,4,t,r)},useInsertionEffect:function(t,r){return pv(4,2,t,r)},useMemo:function(t,r){var s=ec();return r=r===void 0?null:r,t=t(),s.memoizedState=[t,r],t},useReducer:function(t,r,s){var u=ec();return r=s!==void 0?s(r):r,u.memoizedState=u.baseState=r,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},u.queue=t,t=t.dispatch=hB.bind(null,Qn,t),[u.memoizedState,t]},useRef:function(t){var r=ec();return t={current:t},r.memoizedState=t},useState:OP,useDebugValue:mS,useDeferredValue:function(t){return ec().memoizedState=t},useTransition:function(){var t=OP(!1),r=t[0];return t=uB.bind(null,t[1]),ec().memoizedState=t,[r,t]},useMutableSource:function(){},useSyncExternalStore:function(t,r,s){var u=Qn,m=ec();if(Zn){if(s===void 0)throw Error(_r(407));s=s()}else{if(s=r(),Vs===null)throw Error(_r(349));kd&30||kR(u,r,s)}m.memoizedState=s;var v={value:s,getSnapshot:r};return m.queue=v,LP(MR.bind(null,u,v,t),[t]),u.flags|=2048,p_(9,RR.bind(null,u,v,s,r),void 0,null),s},useId:function(){var t=ec(),r=Vs.identifierPrefix;if(Zn){var s=jc,u=Bc;s=(u&~(1<<32-_l(u)-1)).toString(32)+s,r=":"+r+"R"+s,s=d_++,0<s&&(r+="H"+s.toString(32)),r+=":"}else s=cB++,r=":"+r+"r"+s.toString(32)+":";return t.memoizedState=r},unstable_isNewReconciler:!1},pB={readContext:$a,useCallback:jR,useContext:$a,useEffect:pS,useImperativeHandle:BR,useInsertionEffect:FR,useLayoutEffect:NR,useMemo:UR,useReducer:r2,useRef:LR,useState:function(){return r2(f_)},useDebugValue:mS,useDeferredValue:function(t){var r=Ga();return VR(r,Cs.memoizedState,t)},useTransition:function(){var t=r2(f_)[0],r=Ga().memoizedState;return[t,r]},useMutableSource:CR,useSyncExternalStore:PR,useId:$R,unstable_isNewReconciler:!1},mB={readContext:$a,useCallback:jR,useContext:$a,useEffect:pS,useImperativeHandle:BR,useInsertionEffect:FR,useLayoutEffect:NR,useMemo:UR,useReducer:i2,useRef:LR,useState:function(){return i2(f_)},useDebugValue:mS,useDeferredValue:function(t){var r=Ga();return Cs===null?r.memoizedState=t:VR(r,Cs.memoizedState,t)},useTransition:function(){var t=i2(f_)[0],r=Ga().memoizedState;return[t,r]},useMutableSource:CR,useSyncExternalStore:PR,useId:$R,unstable_isNewReconciler:!1};function hl(t,r){if(t&&t.defaultProps){r=es({},r),t=t.defaultProps;for(var s in t)r[s]===void 0&&(r[s]=t[s]);return r}return r}function eT(t,r,s,u){r=t.memoizedState,s=s(u,r),s=s==null?r:es({},r,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var g1={isMounted:function(t){return(t=t._reactInternals)?zd(t)===t:!1},enqueueSetState:function(t,r,s){t=t._reactInternals;var u=Oo(),m=uh(t),v=Uc(u,m);v.payload=r,s!=null&&(v.callback=s),r=lh(t,v,m),r!==null&&(yl(r,t,m,u),dv(r,t,m))},enqueueReplaceState:function(t,r,s){t=t._reactInternals;var u=Oo(),m=uh(t),v=Uc(u,m);v.tag=1,v.payload=r,s!=null&&(v.callback=s),r=lh(t,v,m),r!==null&&(yl(r,t,m,u),dv(r,t,m))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var s=Oo(),u=uh(t),m=Uc(s,u);m.tag=2,r!=null&&(m.callback=r),r=lh(t,m,u),r!==null&&(yl(r,t,u,s),dv(r,t,u))}};function FP(t,r,s,u,m,v,T){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(u,v,T):r.prototype&&r.prototype.isPureReactComponent?!o_(s,u)||!o_(m,v):!0}function qR(t,r,s){var u=!1,m=fh,v=r.contextType;return typeof v=="object"&&v!==null?v=$a(v):(m=Wo(r)?Cd:po.current,u=r.contextTypes,v=(u=u!=null)?om(t,m):fh),r=new r(s,v),t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=g1,t.stateNode=r,r._reactInternals=t,u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=v),r}function NP(t,r,s,u){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(s,u),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(s,u),r.state!==t&&g1.enqueueReplaceState(r,r.state,null)}function tT(t,r,s,u){var m=t.stateNode;m.props=s,m.state=t.memoizedState,m.refs={},aS(t);var v=r.contextType;typeof v=="object"&&v!==null?m.context=$a(v):(v=Wo(r)?Cd:po.current,m.context=om(t,v)),m.state=t.memoizedState,v=r.getDerivedStateFromProps,typeof v=="function"&&(eT(t,r,v,s),m.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(r=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),r!==m.state&&g1.enqueueReplaceState(m,m.state,null),Lv(t,s,m,u),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function um(t,r){try{var s="",u=r;do s+=$N(u),u=u.return;while(u);var m=s}catch(v){m=`
Error generating stack: `+v.message+`
`+v.stack}return{value:t,source:r,stack:m,digest:null}}function n2(t,r,s){return{value:t,source:null,stack:s??null,digest:r??null}}function rT(t,r){try{console.error(r.value)}catch(s){setTimeout(function(){throw s})}}var gB=typeof WeakMap=="function"?WeakMap:Map;function ZR(t,r,s){s=Uc(-1,s),s.tag=3,s.payload={element:null};var u=r.value;return s.callback=function(){jv||(jv=!0,dT=u),rT(t,r)},s}function XR(t,r,s){s=Uc(-1,s),s.tag=3;var u=t.type.getDerivedStateFromError;if(typeof u=="function"){var m=r.value;s.payload=function(){return u(m)},s.callback=function(){rT(t,r)}}var v=t.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(s.callback=function(){rT(t,r),typeof u!="function"&&(ch===null?ch=new Set([this]):ch.add(this));var T=r.stack;this.componentDidCatch(r.value,{componentStack:T!==null?T:""})}),s}function zP(t,r,s){var u=t.pingCache;if(u===null){u=t.pingCache=new gB;var m=new Set;u.set(r,m)}else m=u.get(r),m===void 0&&(m=new Set,u.set(r,m));m.has(s)||(m.add(s),t=kB.bind(null,t,r,s),r.then(t,t))}function BP(t){do{var r;if((r=t.tag===13)&&(r=t.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return t;t=t.return}while(t!==null);return null}function jP(t,r,s,u,m){return t.mode&1?(t.flags|=65536,t.lanes=m,t):(t===r?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(r=Uc(-1,1),r.tag=2,lh(s,r,1))),s.lanes|=1),t)}var _B=Qc.ReactCurrentOwner,Go=!1;function Ro(t,r,s,u){r.child=t===null?SR(r,null,s,u):lm(r,t.child,s,u)}function UP(t,r,s,u,m){s=s.render;var v=r.ref;return Qp(r,m),u=dS(t,r,s,u,v,m),s=fS(),t!==null&&!Go?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~m,Xc(t,r,m)):(Zn&&s&&eS(r),r.flags|=1,Ro(t,r,u,m),r.child)}function VP(t,r,s,u,m){if(t===null){var v=s.type;return typeof v=="function"&&!TS(v)&&v.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(r.tag=15,r.type=v,KR(t,r,v,u,m)):(t=yv(s.type,null,u,r,r.mode,m),t.ref=r.ref,t.return=r,r.child=t)}if(v=t.child,!(t.lanes&m)){var T=v.memoizedProps;if(s=s.compare,s=s!==null?s:o_,s(T,u)&&t.ref===r.ref)return Xc(t,r,m)}return r.flags|=1,t=hh(v,u),t.ref=r.ref,t.return=r,r.child=t}function KR(t,r,s,u,m){if(t!==null){var v=t.memoizedProps;if(o_(v,u)&&t.ref===r.ref)if(Go=!1,r.pendingProps=u=v,(t.lanes&m)!==0)t.flags&131072&&(Go=!0);else return r.lanes=t.lanes,Xc(t,r,m)}return iT(t,r,s,u,m)}function YR(t,r,s){var u=r.pendingProps,m=u.children,v=t!==null?t.memoizedState:null;if(u.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},On(Wp,pa),pa|=s;else{if(!(s&1073741824))return t=v!==null?v.baseLanes|s:s,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:t,cachePool:null,transitions:null},r.updateQueue=null,On(Wp,pa),pa|=t,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=v!==null?v.baseLanes:s,On(Wp,pa),pa|=u}else v!==null?(u=v.baseLanes|s,r.memoizedState=null):u=s,On(Wp,pa),pa|=u;return Ro(t,r,m,s),r.child}function JR(t,r){var s=r.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(r.flags|=512,r.flags|=2097152)}function iT(t,r,s,u,m){var v=Wo(s)?Cd:po.current;return v=om(r,v),Qp(r,m),s=dS(t,r,s,u,v,m),u=fS(),t!==null&&!Go?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~m,Xc(t,r,m)):(Zn&&u&&eS(r),r.flags|=1,Ro(t,r,s,m),r.child)}function $P(t,r,s,u,m){if(Wo(s)){var v=!0;kv(r)}else v=!1;if(Qp(r,m),r.stateNode===null)mv(t,r),qR(r,s,u),tT(r,s,u,m),u=!0;else if(t===null){var T=r.stateNode,a=r.memoizedProps;T.props=a;var R=T.context,O=s.contextType;typeof O=="object"&&O!==null?O=$a(O):(O=Wo(s)?Cd:po.current,O=om(r,O));var B=s.getDerivedStateFromProps,H=typeof B=="function"||typeof T.getSnapshotBeforeUpdate=="function";H||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(a!==u||R!==O)&&NP(r,T,u,O),Ku=!1;var q=r.memoizedState;T.state=q,Lv(r,u,T,m),R=r.memoizedState,a!==u||q!==R||Ho.current||Ku?(typeof B=="function"&&(eT(r,s,B,u),R=r.memoizedState),(a=Ku||FP(r,s,a,u,q,R,O))?(H||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(r.flags|=4194308)):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=u,r.memoizedState=R),T.props=u,T.state=R,T.context=O,u=a):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),u=!1)}else{T=r.stateNode,AR(t,r),a=r.memoizedProps,O=r.type===r.elementType?a:hl(r.type,a),T.props=O,H=r.pendingProps,q=T.context,R=s.contextType,typeof R=="object"&&R!==null?R=$a(R):(R=Wo(s)?Cd:po.current,R=om(r,R));var ee=s.getDerivedStateFromProps;(B=typeof ee=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(a!==H||q!==R)&&NP(r,T,u,R),Ku=!1,q=r.memoizedState,T.state=q,Lv(r,u,T,m);var re=r.memoizedState;a!==H||q!==re||Ho.current||Ku?(typeof ee=="function"&&(eT(r,s,ee,u),re=r.memoizedState),(O=Ku||FP(r,s,O,u,q,re,R)||!1)?(B||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(u,re,R),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(u,re,R)),typeof T.componentDidUpdate=="function"&&(r.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof T.componentDidUpdate!="function"||a===t.memoizedProps&&q===t.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&q===t.memoizedState||(r.flags|=1024),r.memoizedProps=u,r.memoizedState=re),T.props=u,T.state=re,T.context=R,u=O):(typeof T.componentDidUpdate!="function"||a===t.memoizedProps&&q===t.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&q===t.memoizedState||(r.flags|=1024),u=!1)}return nT(t,r,s,u,v,m)}function nT(t,r,s,u,m,v){JR(t,r);var T=(r.flags&128)!==0;if(!u&&!T)return m&&CP(r,s,!1),Xc(t,r,v);u=r.stateNode,_B.current=r;var a=T&&typeof s.getDerivedStateFromError!="function"?null:u.render();return r.flags|=1,t!==null&&T?(r.child=lm(r,t.child,null,v),r.child=lm(r,null,a,v)):Ro(t,r,a,v),r.memoizedState=u.state,m&&CP(r,s,!0),r.child}function QR(t){var r=t.stateNode;r.pendingContext?IP(t,r.pendingContext,r.pendingContext!==r.context):r.context&&IP(t,r.context,!1),lS(t,r.containerInfo)}function GP(t,r,s,u,m){return am(),rS(m),r.flags|=256,Ro(t,r,s,u),r.child}var sT={dehydrated:null,treeContext:null,retryLane:0};function oT(t){return{baseLanes:t,cachePool:null,transitions:null}}function eM(t,r,s){var u=r.pendingProps,m=Jn.current,v=!1,T=(r.flags&128)!==0,a;if((a=T)||(a=t!==null&&t.memoizedState===null?!1:(m&2)!==0),a?(v=!0,r.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),On(Jn,m&1),t===null)return J2(r),t=r.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(r.mode&1?t.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(T=u.children,t=u.fallback,v?(u=r.mode,v=r.child,T={mode:"hidden",children:T},!(u&1)&&v!==null?(v.childLanes=0,v.pendingProps=T):v=x1(T,u,0,null),t=Ad(t,u,s,null),v.return=r,t.return=r,v.sibling=t,r.child=v,r.child.memoizedState=oT(s),r.memoizedState=sT,t):gS(r,T));if(m=t.memoizedState,m!==null&&(a=m.dehydrated,a!==null))return yB(t,r,T,u,a,m,s);if(v){v=u.fallback,T=r.mode,m=t.child,a=m.sibling;var R={mode:"hidden",children:u.children};return!(T&1)&&r.child!==m?(u=r.child,u.childLanes=0,u.pendingProps=R,r.deletions=null):(u=hh(m,R),u.subtreeFlags=m.subtreeFlags&14680064),a!==null?v=hh(a,v):(v=Ad(v,T,s,null),v.flags|=2),v.return=r,u.return=r,u.sibling=v,r.child=u,u=v,v=r.child,T=t.child.memoizedState,T=T===null?oT(s):{baseLanes:T.baseLanes|s,cachePool:null,transitions:T.transitions},v.memoizedState=T,v.childLanes=t.childLanes&~s,r.memoizedState=sT,u}return v=t.child,t=v.sibling,u=hh(v,{mode:"visible",children:u.children}),!(r.mode&1)&&(u.lanes=s),u.return=r,u.sibling=null,t!==null&&(s=r.deletions,s===null?(r.deletions=[t],r.flags|=16):s.push(t)),r.child=u,r.memoizedState=null,u}function gS(t,r){return r=x1({mode:"visible",children:r},t.mode,0,null),r.return=t,t.child=r}function Hx(t,r,s,u){return u!==null&&rS(u),lm(r,t.child,null,s),t=gS(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function yB(t,r,s,u,m,v,T){if(s)return r.flags&256?(r.flags&=-257,u=n2(Error(_r(422))),Hx(t,r,T,u)):r.memoizedState!==null?(r.child=t.child,r.flags|=128,null):(v=u.fallback,m=r.mode,u=x1({mode:"visible",children:u.children},m,0,null),v=Ad(v,m,T,null),v.flags|=2,u.return=r,v.return=r,u.sibling=v,r.child=u,r.mode&1&&lm(r,t.child,null,T),r.child.memoizedState=oT(T),r.memoizedState=sT,v);if(!(r.mode&1))return Hx(t,r,T,null);if(m.data==="$!"){if(u=m.nextSibling&&m.nextSibling.dataset,u)var a=u.dgst;return u=a,v=Error(_r(419)),u=n2(v,u,void 0),Hx(t,r,T,u)}if(a=(T&t.childLanes)!==0,Go||a){if(u=Vs,u!==null){switch(T&-T){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(u.suspendedLanes|T)?0:m,m!==0&&m!==v.retryLane&&(v.retryLane=m,Zc(t,m),yl(u,t,m,-1))}return bS(),u=n2(Error(_r(421))),Hx(t,r,T,u)}return m.data==="$?"?(r.flags|=128,r.child=t.child,r=RB.bind(null,t),m._reactRetry=r,null):(t=v.treeContext,ya=ah(m.nextSibling),xa=r,Zn=!0,pl=null,t!==null&&(Ba[ja++]=Bc,Ba[ja++]=jc,Ba[ja++]=Pd,Bc=t.id,jc=t.overflow,Pd=r),r=gS(r,u.children),r.flags|=4096,r)}function HP(t,r,s){t.lanes|=r;var u=t.alternate;u!==null&&(u.lanes|=r),Q2(t.return,r,s)}function s2(t,r,s,u,m){var v=t.memoizedState;v===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:u,tail:s,tailMode:m}:(v.isBackwards=r,v.rendering=null,v.renderingStartTime=0,v.last=u,v.tail=s,v.tailMode=m)}function tM(t,r,s){var u=r.pendingProps,m=u.revealOrder,v=u.tail;if(Ro(t,r,u.children,s),u=Jn.current,u&2)u=u&1|2,r.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&HP(t,s,r);else if(t.tag===19)HP(t,s,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}u&=1}if(On(Jn,u),!(r.mode&1))r.memoizedState=null;else switch(m){case"forwards":for(s=r.child,m=null;s!==null;)t=s.alternate,t!==null&&Fv(t)===null&&(m=s),s=s.sibling;s=m,s===null?(m=r.child,r.child=null):(m=s.sibling,s.sibling=null),s2(r,!1,m,s,v);break;case"backwards":for(s=null,m=r.child,r.child=null;m!==null;){if(t=m.alternate,t!==null&&Fv(t)===null){r.child=m;break}t=m.sibling,m.sibling=s,s=m,m=t}s2(r,!0,s,null,v);break;case"together":s2(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function mv(t,r){!(r.mode&1)&&t!==null&&(t.alternate=null,r.alternate=null,r.flags|=2)}function Xc(t,r,s){if(t!==null&&(r.dependencies=t.dependencies),Rd|=r.lanes,!(s&r.childLanes))return null;if(t!==null&&r.child!==t.child)throw Error(_r(153));if(r.child!==null){for(t=r.child,s=hh(t,t.pendingProps),r.child=s,s.return=r;t.sibling!==null;)t=t.sibling,s=s.sibling=hh(t,t.pendingProps),s.return=r;s.sibling=null}return r.child}function xB(t,r,s){switch(r.tag){case 3:QR(r),am();break;case 5:IR(r);break;case 1:Wo(r.type)&&kv(r);break;case 4:lS(r,r.stateNode.containerInfo);break;case 10:var u=r.type._context,m=r.memoizedProps.value;On(Dv,u._currentValue),u._currentValue=m;break;case 13:if(u=r.memoizedState,u!==null)return u.dehydrated!==null?(On(Jn,Jn.current&1),r.flags|=128,null):s&r.child.childLanes?eM(t,r,s):(On(Jn,Jn.current&1),t=Xc(t,r,s),t!==null?t.sibling:null);On(Jn,Jn.current&1);break;case 19:if(u=(s&r.childLanes)!==0,t.flags&128){if(u)return tM(t,r,s);r.flags|=128}if(m=r.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),On(Jn,Jn.current),u)break;return null;case 22:case 23:return r.lanes=0,YR(t,r,s)}return Xc(t,r,s)}var rM,aT,iM,nM;rM=function(t,r){for(var s=r.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};aT=function(){};iM=function(t,r,s,u){var m=t.memoizedProps;if(m!==u){t=r.stateNode,Sd(nc.current);var v=null;switch(s){case"input":m=P2(t,m),u=P2(t,u),v=[];break;case"select":m=es({},m,{value:void 0}),u=es({},u,{value:void 0}),v=[];break;case"textarea":m=M2(t,m),u=M2(t,u),v=[];break;default:typeof m.onClick!="function"&&typeof u.onClick=="function"&&(t.onclick=Cv)}O2(s,u);var T;s=null;for(O in m)if(!u.hasOwnProperty(O)&&m.hasOwnProperty(O)&&m[O]!=null)if(O==="style"){var a=m[O];for(T in a)a.hasOwnProperty(T)&&(s||(s={}),s[T]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(Qg.hasOwnProperty(O)?v||(v=[]):(v=v||[]).push(O,null));for(O in u){var R=u[O];if(a=m!=null?m[O]:void 0,u.hasOwnProperty(O)&&R!==a&&(R!=null||a!=null))if(O==="style")if(a){for(T in a)!a.hasOwnProperty(T)||R&&R.hasOwnProperty(T)||(s||(s={}),s[T]="");for(T in R)R.hasOwnProperty(T)&&a[T]!==R[T]&&(s||(s={}),s[T]=R[T])}else s||(v||(v=[]),v.push(O,s)),s=R;else O==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,a=a?a.__html:void 0,R!=null&&a!==R&&(v=v||[]).push(O,R)):O==="children"?typeof R!="string"&&typeof R!="number"||(v=v||[]).push(O,""+R):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(Qg.hasOwnProperty(O)?(R!=null&&O==="onScroll"&&Bn("scroll",t),v||a===R||(v=[])):(v=v||[]).push(O,R))}s&&(v=v||[]).push("style",s);var O=v;(r.updateQueue=O)&&(r.flags|=4)}};nM=function(t,r,s,u){s!==u&&(r.flags|=4)};function Tg(t,r){if(!Zn)switch(t.tailMode){case"hidden":r=t.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:u.sibling=null}}function co(t){var r=t.alternate!==null&&t.alternate.child===t.child,s=0,u=0;if(r)for(var m=t.child;m!==null;)s|=m.lanes|m.childLanes,u|=m.subtreeFlags&14680064,u|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)s|=m.lanes|m.childLanes,u|=m.subtreeFlags,u|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=u,t.childLanes=s,r}function vB(t,r,s){var u=r.pendingProps;switch(tS(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return co(r),null;case 1:return Wo(r.type)&&Pv(),co(r),null;case 3:return u=r.stateNode,cm(),jn(Ho),jn(po),uS(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(t===null||t.child===null)&&($x(r)?r.flags|=4:t===null||t.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,pl!==null&&(mT(pl),pl=null))),aT(t,r),co(r),null;case 5:cS(r);var m=Sd(h_.current);if(s=r.type,t!==null&&r.stateNode!=null)iM(t,r,s,u,m),t.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!u){if(r.stateNode===null)throw Error(_r(166));return co(r),null}if(t=Sd(nc.current),$x(r)){u=r.stateNode,s=r.type;var v=r.memoizedProps;switch(u[rc]=r,u[c_]=v,t=(r.mode&1)!==0,s){case"dialog":Bn("cancel",u),Bn("close",u);break;case"iframe":case"object":case"embed":Bn("load",u);break;case"video":case"audio":for(m=0;m<Rg.length;m++)Bn(Rg[m],u);break;case"source":Bn("error",u);break;case"img":case"image":case"link":Bn("error",u),Bn("load",u);break;case"details":Bn("toggle",u);break;case"input":eP(u,v),Bn("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!v.multiple},Bn("invalid",u);break;case"textarea":rP(u,v),Bn("invalid",u)}O2(s,v),m=null;for(var T in v)if(v.hasOwnProperty(T)){var a=v[T];T==="children"?typeof a=="string"?u.textContent!==a&&(v.suppressHydrationWarning!==!0&&Vx(u.textContent,a,t),m=["children",a]):typeof a=="number"&&u.textContent!==""+a&&(v.suppressHydrationWarning!==!0&&Vx(u.textContent,a,t),m=["children",""+a]):Qg.hasOwnProperty(T)&&a!=null&&T==="onScroll"&&Bn("scroll",u)}switch(s){case"input":Ox(u),tP(u,v,!0);break;case"textarea":Ox(u),iP(u);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(u.onclick=Cv)}u=m,r.updateQueue=u,u!==null&&(r.flags|=4)}else{T=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Mk(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=T.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof u.is=="string"?t=T.createElement(s,{is:u.is}):(t=T.createElement(s),s==="select"&&(T=t,u.multiple?T.multiple=!0:u.size&&(T.size=u.size))):t=T.createElementNS(t,s),t[rc]=r,t[c_]=u,rM(t,r,!1,!1),r.stateNode=t;e:{switch(T=L2(s,u),s){case"dialog":Bn("cancel",t),Bn("close",t),m=u;break;case"iframe":case"object":case"embed":Bn("load",t),m=u;break;case"video":case"audio":for(m=0;m<Rg.length;m++)Bn(Rg[m],t);m=u;break;case"source":Bn("error",t),m=u;break;case"img":case"image":case"link":Bn("error",t),Bn("load",t),m=u;break;case"details":Bn("toggle",t),m=u;break;case"input":eP(t,u),m=P2(t,u),Bn("invalid",t);break;case"option":m=u;break;case"select":t._wrapperState={wasMultiple:!!u.multiple},m=es({},u,{value:void 0}),Bn("invalid",t);break;case"textarea":rP(t,u),m=M2(t,u),Bn("invalid",t);break;default:m=u}O2(s,m),a=m;for(v in a)if(a.hasOwnProperty(v)){var R=a[v];v==="style"?Lk(t,R):v==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,R!=null&&Dk(t,R)):v==="children"?typeof R=="string"?(s!=="textarea"||R!=="")&&e_(t,R):typeof R=="number"&&e_(t,""+R):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Qg.hasOwnProperty(v)?R!=null&&v==="onScroll"&&Bn("scroll",t):R!=null&&jT(t,v,R,T))}switch(s){case"input":Ox(t),tP(t,u,!1);break;case"textarea":Ox(t),iP(t);break;case"option":u.value!=null&&t.setAttribute("value",""+dh(u.value));break;case"select":t.multiple=!!u.multiple,v=u.value,v!=null?Xp(t,!!u.multiple,v,!1):u.defaultValue!=null&&Xp(t,!!u.multiple,u.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Cv)}switch(s){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return co(r),null;case 6:if(t&&r.stateNode!=null)nM(t,r,t.memoizedProps,u);else{if(typeof u!="string"&&r.stateNode===null)throw Error(_r(166));if(s=Sd(h_.current),Sd(nc.current),$x(r)){if(u=r.stateNode,s=r.memoizedProps,u[rc]=r,(v=u.nodeValue!==s)&&(t=xa,t!==null))switch(t.tag){case 3:Vx(u.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Vx(u.nodeValue,s,(t.mode&1)!==0)}v&&(r.flags|=4)}else u=(s.nodeType===9?s:s.ownerDocument).createTextNode(u),u[rc]=r,r.stateNode=u}return co(r),null;case 13:if(jn(Jn),u=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Zn&&ya!==null&&r.mode&1&&!(r.flags&128))bR(),am(),r.flags|=98560,v=!1;else if(v=$x(r),u!==null&&u.dehydrated!==null){if(t===null){if(!v)throw Error(_r(318));if(v=r.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(_r(317));v[rc]=r}else am(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;co(r),v=!1}else pl!==null&&(mT(pl),pl=null),v=!0;if(!v)return r.flags&65536?r:null}return r.flags&128?(r.lanes=s,r):(u=u!==null,u!==(t!==null&&t.memoizedState!==null)&&u&&(r.child.flags|=8192,r.mode&1&&(t===null||Jn.current&1?Ps===0&&(Ps=3):bS())),r.updateQueue!==null&&(r.flags|=4),co(r),null);case 4:return cm(),aT(t,r),t===null&&a_(r.stateNode.containerInfo),co(r),null;case 10:return sS(r.type._context),co(r),null;case 17:return Wo(r.type)&&Pv(),co(r),null;case 19:if(jn(Jn),v=r.memoizedState,v===null)return co(r),null;if(u=(r.flags&128)!==0,T=v.rendering,T===null)if(u)Tg(v,!1);else{if(Ps!==0||t!==null&&t.flags&128)for(t=r.child;t!==null;){if(T=Fv(t),T!==null){for(r.flags|=128,Tg(v,!1),u=T.updateQueue,u!==null&&(r.updateQueue=u,r.flags|=4),r.subtreeFlags=0,u=s,s=r.child;s!==null;)v=s,t=u,v.flags&=14680066,T=v.alternate,T===null?(v.childLanes=0,v.lanes=t,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=T.childLanes,v.lanes=T.lanes,v.child=T.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=T.memoizedProps,v.memoizedState=T.memoizedState,v.updateQueue=T.updateQueue,v.type=T.type,t=T.dependencies,v.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return On(Jn,Jn.current&1|2),r.child}t=t.sibling}v.tail!==null&&us()>hm&&(r.flags|=128,u=!0,Tg(v,!1),r.lanes=4194304)}else{if(!u)if(t=Fv(T),t!==null){if(r.flags|=128,u=!0,s=t.updateQueue,s!==null&&(r.updateQueue=s,r.flags|=4),Tg(v,!0),v.tail===null&&v.tailMode==="hidden"&&!T.alternate&&!Zn)return co(r),null}else 2*us()-v.renderingStartTime>hm&&s!==1073741824&&(r.flags|=128,u=!0,Tg(v,!1),r.lanes=4194304);v.isBackwards?(T.sibling=r.child,r.child=T):(s=v.last,s!==null?s.sibling=T:r.child=T,v.last=T)}return v.tail!==null?(r=v.tail,v.rendering=r,v.tail=r.sibling,v.renderingStartTime=us(),r.sibling=null,s=Jn.current,On(Jn,u?s&1|2:s&1),r):(co(r),null);case 22:case 23:return wS(),u=r.memoizedState!==null,t!==null&&t.memoizedState!==null!==u&&(r.flags|=8192),u&&r.mode&1?pa&1073741824&&(co(r),r.subtreeFlags&6&&(r.flags|=8192)):co(r),null;case 24:return null;case 25:return null}throw Error(_r(156,r.tag))}function wB(t,r){switch(tS(r),r.tag){case 1:return Wo(r.type)&&Pv(),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return cm(),jn(Ho),jn(po),uS(),t=r.flags,t&65536&&!(t&128)?(r.flags=t&-65537|128,r):null;case 5:return cS(r),null;case 13:if(jn(Jn),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(_r(340));am()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return jn(Jn),null;case 4:return cm(),null;case 10:return sS(r.type._context),null;case 22:case 23:return wS(),null;case 24:return null;default:return null}}var Wx=!1,uo=!1,bB=typeof WeakSet=="function"?WeakSet:Set,Jr=null;function Hp(t,r){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(u){is(t,r,u)}else s.current=null}function lT(t,r,s){try{s()}catch(u){is(t,r,u)}}var WP=!1;function TB(t,r){if(H2=Ev,t=cR(),QT(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var u=s.getSelection&&s.getSelection();if(u&&u.rangeCount!==0){s=u.anchorNode;var m=u.anchorOffset,v=u.focusNode;u=u.focusOffset;try{s.nodeType,v.nodeType}catch{s=null;break e}var T=0,a=-1,R=-1,O=0,B=0,H=t,q=null;t:for(;;){for(var ee;H!==s||m!==0&&H.nodeType!==3||(a=T+m),H!==v||u!==0&&H.nodeType!==3||(R=T+u),H.nodeType===3&&(T+=H.nodeValue.length),(ee=H.firstChild)!==null;)q=H,H=ee;for(;;){if(H===t)break t;if(q===s&&++O===m&&(a=T),q===v&&++B===u&&(R=T),(ee=H.nextSibling)!==null)break;H=q,q=H.parentNode}H=ee}s=a===-1||R===-1?null:{start:a,end:R}}else s=null}s=s||{start:0,end:0}}else s=null;for(W2={focusedElem:t,selectionRange:s},Ev=!1,Jr=r;Jr!==null;)if(r=Jr,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,Jr=t;else for(;Jr!==null;){r=Jr;try{var re=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(re!==null){var J=re.memoizedProps,_e=re.memoizedState,pe=r.stateNode,ue=pe.getSnapshotBeforeUpdate(r.elementType===r.type?J:hl(r.type,J),_e);pe.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:var ie=r.stateNode.containerInfo;ie.nodeType===1?ie.textContent="":ie.nodeType===9&&ie.documentElement&&ie.removeChild(ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_r(163))}}catch(ke){is(r,r.return,ke)}if(t=r.sibling,t!==null){t.return=r.return,Jr=t;break}Jr=r.return}return re=WP,WP=!1,re}function Ug(t,r,s){var u=r.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var m=u=u.next;do{if((m.tag&t)===t){var v=m.destroy;m.destroy=void 0,v!==void 0&&lT(r,s,v)}m=m.next}while(m!==u)}}function _1(t,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var u=s.create;s.destroy=u()}s=s.next}while(s!==r)}}function cT(t){var r=t.ref;if(r!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof r=="function"?r(t):r.current=t}}function sM(t){var r=t.alternate;r!==null&&(t.alternate=null,sM(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&(delete r[rc],delete r[c_],delete r[X2],delete r[sB],delete r[oB])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function oM(t){return t.tag===5||t.tag===3||t.tag===4}function qP(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||oM(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function uT(t,r,s){var u=t.tag;if(u===5||u===6)t=t.stateNode,r?s.nodeType===8?s.parentNode.insertBefore(t,r):s.insertBefore(t,r):(s.nodeType===8?(r=s.parentNode,r.insertBefore(t,s)):(r=s,r.appendChild(t)),s=s._reactRootContainer,s!=null||r.onclick!==null||(r.onclick=Cv));else if(u!==4&&(t=t.child,t!==null))for(uT(t,r,s),t=t.sibling;t!==null;)uT(t,r,s),t=t.sibling}function hT(t,r,s){var u=t.tag;if(u===5||u===6)t=t.stateNode,r?s.insertBefore(t,r):s.appendChild(t);else if(u!==4&&(t=t.child,t!==null))for(hT(t,r,s),t=t.sibling;t!==null;)hT(t,r,s),t=t.sibling}var Zs=null,dl=!1;function Hu(t,r,s){for(s=s.child;s!==null;)aM(t,r,s),s=s.sibling}function aM(t,r,s){if(ic&&typeof ic.onCommitFiberUnmount=="function")try{ic.onCommitFiberUnmount(c1,s)}catch{}switch(s.tag){case 5:uo||Hp(s,r);case 6:var u=Zs,m=dl;Zs=null,Hu(t,r,s),Zs=u,dl=m,Zs!==null&&(dl?(t=Zs,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Zs.removeChild(s.stateNode));break;case 18:Zs!==null&&(dl?(t=Zs,s=s.stateNode,t.nodeType===8?Jb(t.parentNode,s):t.nodeType===1&&Jb(t,s),n_(t)):Jb(Zs,s.stateNode));break;case 4:u=Zs,m=dl,Zs=s.stateNode.containerInfo,dl=!0,Hu(t,r,s),Zs=u,dl=m;break;case 0:case 11:case 14:case 15:if(!uo&&(u=s.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){m=u=u.next;do{var v=m,T=v.destroy;v=v.tag,T!==void 0&&(v&2||v&4)&&lT(s,r,T),m=m.next}while(m!==u)}Hu(t,r,s);break;case 1:if(!uo&&(Hp(s,r),u=s.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=s.memoizedProps,u.state=s.memoizedState,u.componentWillUnmount()}catch(a){is(s,r,a)}Hu(t,r,s);break;case 21:Hu(t,r,s);break;case 22:s.mode&1?(uo=(u=uo)||s.memoizedState!==null,Hu(t,r,s),uo=u):Hu(t,r,s);break;default:Hu(t,r,s)}}function ZP(t){var r=t.updateQueue;if(r!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new bB),r.forEach(function(u){var m=MB.bind(null,t,u);s.has(u)||(s.add(u),u.then(m,m))})}}function al(t,r){var s=r.deletions;if(s!==null)for(var u=0;u<s.length;u++){var m=s[u];try{var v=t,T=r,a=T;e:for(;a!==null;){switch(a.tag){case 5:Zs=a.stateNode,dl=!1;break e;case 3:Zs=a.stateNode.containerInfo,dl=!0;break e;case 4:Zs=a.stateNode.containerInfo,dl=!0;break e}a=a.return}if(Zs===null)throw Error(_r(160));aM(v,T,m),Zs=null,dl=!1;var R=m.alternate;R!==null&&(R.return=null),m.return=null}catch(O){is(m,r,O)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)lM(r,t),r=r.sibling}function lM(t,r){var s=t.alternate,u=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(al(r,t),Kl(t),u&4){try{Ug(3,t,t.return),_1(3,t)}catch(J){is(t,t.return,J)}try{Ug(5,t,t.return)}catch(J){is(t,t.return,J)}}break;case 1:al(r,t),Kl(t),u&512&&s!==null&&Hp(s,s.return);break;case 5:if(al(r,t),Kl(t),u&512&&s!==null&&Hp(s,s.return),t.flags&32){var m=t.stateNode;try{e_(m,"")}catch(J){is(t,t.return,J)}}if(u&4&&(m=t.stateNode,m!=null)){var v=t.memoizedProps,T=s!==null?s.memoizedProps:v,a=t.type,R=t.updateQueue;if(t.updateQueue=null,R!==null)try{a==="input"&&v.type==="radio"&&v.name!=null&&kk(m,v),L2(a,T);var O=L2(a,v);for(T=0;T<R.length;T+=2){var B=R[T],H=R[T+1];B==="style"?Lk(m,H):B==="dangerouslySetInnerHTML"?Dk(m,H):B==="children"?e_(m,H):jT(m,B,H,O)}switch(a){case"input":k2(m,v);break;case"textarea":Rk(m,v);break;case"select":var q=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!v.multiple;var ee=v.value;ee!=null?Xp(m,!!v.multiple,ee,!1):q!==!!v.multiple&&(v.defaultValue!=null?Xp(m,!!v.multiple,v.defaultValue,!0):Xp(m,!!v.multiple,v.multiple?[]:"",!1))}m[c_]=v}catch(J){is(t,t.return,J)}}break;case 6:if(al(r,t),Kl(t),u&4){if(t.stateNode===null)throw Error(_r(162));m=t.stateNode,v=t.memoizedProps;try{m.nodeValue=v}catch(J){is(t,t.return,J)}}break;case 3:if(al(r,t),Kl(t),u&4&&s!==null&&s.memoizedState.isDehydrated)try{n_(r.containerInfo)}catch(J){is(t,t.return,J)}break;case 4:al(r,t),Kl(t);break;case 13:al(r,t),Kl(t),m=t.child,m.flags&8192&&(v=m.memoizedState!==null,m.stateNode.isHidden=v,!v||m.alternate!==null&&m.alternate.memoizedState!==null||(xS=us())),u&4&&ZP(t);break;case 22:if(B=s!==null&&s.memoizedState!==null,t.mode&1?(uo=(O=uo)||B,al(r,t),uo=O):al(r,t),Kl(t),u&8192){if(O=t.memoizedState!==null,(t.stateNode.isHidden=O)&&!B&&t.mode&1)for(Jr=t,B=t.child;B!==null;){for(H=Jr=B;Jr!==null;){switch(q=Jr,ee=q.child,q.tag){case 0:case 11:case 14:case 15:Ug(4,q,q.return);break;case 1:Hp(q,q.return);var re=q.stateNode;if(typeof re.componentWillUnmount=="function"){u=q,s=q.return;try{r=u,re.props=r.memoizedProps,re.state=r.memoizedState,re.componentWillUnmount()}catch(J){is(u,s,J)}}break;case 5:Hp(q,q.return);break;case 22:if(q.memoizedState!==null){KP(H);continue}}ee!==null?(ee.return=q,Jr=ee):KP(H)}B=B.sibling}e:for(B=null,H=t;;){if(H.tag===5){if(B===null){B=H;try{m=H.stateNode,O?(v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(a=H.stateNode,R=H.memoizedProps.style,T=R!=null&&R.hasOwnProperty("display")?R.display:null,a.style.display=Ok("display",T))}catch(J){is(t,t.return,J)}}}else if(H.tag===6){if(B===null)try{H.stateNode.nodeValue=O?"":H.memoizedProps}catch(J){is(t,t.return,J)}}else if((H.tag!==22&&H.tag!==23||H.memoizedState===null||H===t)&&H.child!==null){H.child.return=H,H=H.child;continue}if(H===t)break e;for(;H.sibling===null;){if(H.return===null||H.return===t)break e;B===H&&(B=null),H=H.return}B===H&&(B=null),H.sibling.return=H.return,H=H.sibling}}break;case 19:al(r,t),Kl(t),u&4&&ZP(t);break;case 21:break;default:al(r,t),Kl(t)}}function Kl(t){var r=t.flags;if(r&2){try{e:{for(var s=t.return;s!==null;){if(oM(s)){var u=s;break e}s=s.return}throw Error(_r(160))}switch(u.tag){case 5:var m=u.stateNode;u.flags&32&&(e_(m,""),u.flags&=-33);var v=qP(t);hT(t,v,m);break;case 3:case 4:var T=u.stateNode.containerInfo,a=qP(t);uT(t,a,T);break;default:throw Error(_r(161))}}catch(R){is(t,t.return,R)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function SB(t,r,s){Jr=t,cM(t)}function cM(t,r,s){for(var u=(t.mode&1)!==0;Jr!==null;){var m=Jr,v=m.child;if(m.tag===22&&u){var T=m.memoizedState!==null||Wx;if(!T){var a=m.alternate,R=a!==null&&a.memoizedState!==null||uo;a=Wx;var O=uo;if(Wx=T,(uo=R)&&!O)for(Jr=m;Jr!==null;)T=Jr,R=T.child,T.tag===22&&T.memoizedState!==null?YP(m):R!==null?(R.return=T,Jr=R):YP(m);for(;v!==null;)Jr=v,cM(v),v=v.sibling;Jr=m,Wx=a,uo=O}XP(t)}else m.subtreeFlags&8772&&v!==null?(v.return=m,Jr=v):XP(t)}}function XP(t){for(;Jr!==null;){var r=Jr;if(r.flags&8772){var s=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:uo||_1(5,r);break;case 1:var u=r.stateNode;if(r.flags&4&&!uo)if(s===null)u.componentDidMount();else{var m=r.elementType===r.type?s.memoizedProps:hl(r.type,s.memoizedProps);u.componentDidUpdate(m,s.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var v=r.updateQueue;v!==null&&DP(r,v,u);break;case 3:var T=r.updateQueue;if(T!==null){if(s=null,r.child!==null)switch(r.child.tag){case 5:s=r.child.stateNode;break;case 1:s=r.child.stateNode}DP(r,T,s)}break;case 5:var a=r.stateNode;if(s===null&&r.flags&4){s=a;var R=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":R.autoFocus&&s.focus();break;case"img":R.src&&(s.src=R.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var O=r.alternate;if(O!==null){var B=O.memoizedState;if(B!==null){var H=B.dehydrated;H!==null&&n_(H)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_r(163))}uo||r.flags&512&&cT(r)}catch(q){is(r,r.return,q)}}if(r===t){Jr=null;break}if(s=r.sibling,s!==null){s.return=r.return,Jr=s;break}Jr=r.return}}function KP(t){for(;Jr!==null;){var r=Jr;if(r===t){Jr=null;break}var s=r.sibling;if(s!==null){s.return=r.return,Jr=s;break}Jr=r.return}}function YP(t){for(;Jr!==null;){var r=Jr;try{switch(r.tag){case 0:case 11:case 15:var s=r.return;try{_1(4,r)}catch(R){is(r,s,R)}break;case 1:var u=r.stateNode;if(typeof u.componentDidMount=="function"){var m=r.return;try{u.componentDidMount()}catch(R){is(r,m,R)}}var v=r.return;try{cT(r)}catch(R){is(r,v,R)}break;case 5:var T=r.return;try{cT(r)}catch(R){is(r,T,R)}}}catch(R){is(r,r.return,R)}if(r===t){Jr=null;break}var a=r.sibling;if(a!==null){a.return=r.return,Jr=a;break}Jr=r.return}}var EB=Math.ceil,Bv=Qc.ReactCurrentDispatcher,_S=Qc.ReactCurrentOwner,Va=Qc.ReactCurrentBatchConfig,on=0,Vs=null,gs=null,Js=0,pa=0,Wp=yh(0),Ps=0,m_=null,Rd=0,y1=0,yS=0,Vg=null,Vo=null,xS=0,hm=1/0,Fc=null,jv=!1,dT=null,ch=null,qx=!1,th=null,Uv=0,$g=0,fT=null,gv=-1,_v=0;function Oo(){return on&6?us():gv!==-1?gv:gv=us()}function uh(t){return t.mode&1?on&2&&Js!==0?Js&-Js:lB.transition!==null?(_v===0&&(_v=qk()),_v):(t=xn,t!==0||(t=window.event,t=t===void 0?16:eR(t.type)),t):1}function yl(t,r,s,u){if(50<$g)throw $g=0,fT=null,Error(_r(185));I_(t,s,u),(!(on&2)||t!==Vs)&&(t===Vs&&(!(on&2)&&(y1|=s),Ps===4&&Ju(t,Js)),qo(t,u),s===1&&on===0&&!(r.mode&1)&&(hm=us()+500,p1&&xh()))}function qo(t,r){var s=t.callbackNode;lz(t,r);var u=Sv(t,t===Vs?Js:0);if(u===0)s!==null&&oP(s),t.callbackNode=null,t.callbackPriority=0;else if(r=u&-u,t.callbackPriority!==r){if(s!=null&&oP(s),r===1)t.tag===0?aB(JP.bind(null,t)):xR(JP.bind(null,t)),iB(function(){!(on&6)&&xh()}),s=null;else{switch(Zk(u)){case 1:s=HT;break;case 4:s=Hk;break;case 16:s=Tv;break;case 536870912:s=Wk;break;default:s=Tv}s=_M(s,uM.bind(null,t))}t.callbackPriority=r,t.callbackNode=s}}function uM(t,r){if(gv=-1,_v=0,on&6)throw Error(_r(327));var s=t.callbackNode;if(em()&&t.callbackNode!==s)return null;var u=Sv(t,t===Vs?Js:0);if(u===0)return null;if(u&30||u&t.expiredLanes||r)r=Vv(t,u);else{r=u;var m=on;on|=2;var v=dM();(Vs!==t||Js!==r)&&(Fc=null,hm=us()+500,Ed(t,r));do try{CB();break}catch(a){hM(t,a)}while(!0);nS(),Bv.current=v,on=m,gs!==null?r=0:(Vs=null,Js=0,r=Ps)}if(r!==0){if(r===2&&(m=j2(t),m!==0&&(u=m,r=pT(t,m))),r===1)throw s=m_,Ed(t,0),Ju(t,u),qo(t,us()),s;if(r===6)Ju(t,u);else{if(m=t.current.alternate,!(u&30)&&!AB(m)&&(r=Vv(t,u),r===2&&(v=j2(t),v!==0&&(u=v,r=pT(t,v))),r===1))throw s=m_,Ed(t,0),Ju(t,u),qo(t,us()),s;switch(t.finishedWork=m,t.finishedLanes=u,r){case 0:case 1:throw Error(_r(345));case 2:_d(t,Vo,Fc);break;case 3:if(Ju(t,u),(u&130023424)===u&&(r=xS+500-us(),10<r)){if(Sv(t,0)!==0)break;if(m=t.suspendedLanes,(m&u)!==u){Oo(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=Z2(_d.bind(null,t,Vo,Fc),r);break}_d(t,Vo,Fc);break;case 4:if(Ju(t,u),(u&4194240)===u)break;for(r=t.eventTimes,m=-1;0<u;){var T=31-_l(u);v=1<<T,T=r[T],T>m&&(m=T),u&=~v}if(u=m,u=us()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*EB(u/1960))-u,10<u){t.timeoutHandle=Z2(_d.bind(null,t,Vo,Fc),u);break}_d(t,Vo,Fc);break;case 5:_d(t,Vo,Fc);break;default:throw Error(_r(329))}}}return qo(t,us()),t.callbackNode===s?uM.bind(null,t):null}function pT(t,r){var s=Vg;return t.current.memoizedState.isDehydrated&&(Ed(t,r).flags|=256),t=Vv(t,r),t!==2&&(r=Vo,Vo=s,r!==null&&mT(r)),t}function mT(t){Vo===null?Vo=t:Vo.push.apply(Vo,t)}function AB(t){for(var r=t;;){if(r.flags&16384){var s=r.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var u=0;u<s.length;u++){var m=s[u],v=m.getSnapshot;m=m.value;try{if(!vl(v(),m))return!1}catch{return!1}}}if(s=r.child,r.subtreeFlags&16384&&s!==null)s.return=r,r=s;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Ju(t,r){for(r&=~yS,r&=~y1,t.suspendedLanes|=r,t.pingedLanes&=~r,t=t.expirationTimes;0<r;){var s=31-_l(r),u=1<<s;t[s]=-1,r&=~u}}function JP(t){if(on&6)throw Error(_r(327));em();var r=Sv(t,0);if(!(r&1))return qo(t,us()),null;var s=Vv(t,r);if(t.tag!==0&&s===2){var u=j2(t);u!==0&&(r=u,s=pT(t,u))}if(s===1)throw s=m_,Ed(t,0),Ju(t,r),qo(t,us()),s;if(s===6)throw Error(_r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=r,_d(t,Vo,Fc),qo(t,us()),null}function vS(t,r){var s=on;on|=1;try{return t(r)}finally{on=s,on===0&&(hm=us()+500,p1&&xh())}}function Md(t){th!==null&&th.tag===0&&!(on&6)&&em();var r=on;on|=1;var s=Va.transition,u=xn;try{if(Va.transition=null,xn=1,t)return t()}finally{xn=u,Va.transition=s,on=r,!(on&6)&&xh()}}function wS(){pa=Wp.current,jn(Wp)}function Ed(t,r){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,rB(s)),gs!==null)for(s=gs.return;s!==null;){var u=s;switch(tS(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&Pv();break;case 3:cm(),jn(Ho),jn(po),uS();break;case 5:cS(u);break;case 4:cm();break;case 13:jn(Jn);break;case 19:jn(Jn);break;case 10:sS(u.type._context);break;case 22:case 23:wS()}s=s.return}if(Vs=t,gs=t=hh(t.current,null),Js=pa=r,Ps=0,m_=null,yS=y1=Rd=0,Vo=Vg=null,Td!==null){for(r=0;r<Td.length;r++)if(s=Td[r],u=s.interleaved,u!==null){s.interleaved=null;var m=u.next,v=s.pending;if(v!==null){var T=v.next;v.next=m,u.next=T}s.pending=u}Td=null}return t}function hM(t,r){do{var s=gs;try{if(nS(),fv.current=zv,Nv){for(var u=Qn.memoizedState;u!==null;){var m=u.queue;m!==null&&(m.pending=null),u=u.next}Nv=!1}if(kd=0,zs=Cs=Qn=null,jg=!1,d_=0,_S.current=null,s===null||s.return===null){Ps=1,m_=r,gs=null;break}e:{var v=t,T=s.return,a=s,R=r;if(r=Js,a.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){var O=R,B=a,H=B.tag;if(!(B.mode&1)&&(H===0||H===11||H===15)){var q=B.alternate;q?(B.updateQueue=q.updateQueue,B.memoizedState=q.memoizedState,B.lanes=q.lanes):(B.updateQueue=null,B.memoizedState=null)}var ee=BP(T);if(ee!==null){ee.flags&=-257,jP(ee,T,a,v,r),ee.mode&1&&zP(v,O,r),r=ee,R=O;var re=r.updateQueue;if(re===null){var J=new Set;J.add(R),r.updateQueue=J}else re.add(R);break e}else{if(!(r&1)){zP(v,O,r),bS();break e}R=Error(_r(426))}}else if(Zn&&a.mode&1){var _e=BP(T);if(_e!==null){!(_e.flags&65536)&&(_e.flags|=256),jP(_e,T,a,v,r),rS(um(R,a));break e}}v=R=um(R,a),Ps!==4&&(Ps=2),Vg===null?Vg=[v]:Vg.push(v),v=T;do{switch(v.tag){case 3:v.flags|=65536,r&=-r,v.lanes|=r;var pe=ZR(v,R,r);MP(v,pe);break e;case 1:a=R;var ue=v.type,ie=v.stateNode;if(!(v.flags&128)&&(typeof ue.getDerivedStateFromError=="function"||ie!==null&&typeof ie.componentDidCatch=="function"&&(ch===null||!ch.has(ie)))){v.flags|=65536,r&=-r,v.lanes|=r;var ke=XR(v,a,r);MP(v,ke);break e}}v=v.return}while(v!==null)}pM(s)}catch(at){r=at,gs===s&&s!==null&&(gs=s=s.return);continue}break}while(!0)}function dM(){var t=Bv.current;return Bv.current=zv,t===null?zv:t}function bS(){(Ps===0||Ps===3||Ps===2)&&(Ps=4),Vs===null||!(Rd&268435455)&&!(y1&268435455)||Ju(Vs,Js)}function Vv(t,r){var s=on;on|=2;var u=dM();(Vs!==t||Js!==r)&&(Fc=null,Ed(t,r));do try{IB();break}catch(m){hM(t,m)}while(!0);if(nS(),on=s,Bv.current=u,gs!==null)throw Error(_r(261));return Vs=null,Js=0,Ps}function IB(){for(;gs!==null;)fM(gs)}function CB(){for(;gs!==null&&!QN();)fM(gs)}function fM(t){var r=gM(t.alternate,t,pa);t.memoizedProps=t.pendingProps,r===null?pM(t):gs=r,_S.current=null}function pM(t){var r=t;do{var s=r.alternate;if(t=r.return,r.flags&32768){if(s=wB(s,r),s!==null){s.flags&=32767,gs=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ps=6,gs=null;return}}else if(s=vB(s,r,pa),s!==null){gs=s;return}if(r=r.sibling,r!==null){gs=r;return}gs=r=t}while(r!==null);Ps===0&&(Ps=5)}function _d(t,r,s){var u=xn,m=Va.transition;try{Va.transition=null,xn=1,PB(t,r,s,u)}finally{Va.transition=m,xn=u}return null}function PB(t,r,s,u){do em();while(th!==null);if(on&6)throw Error(_r(327));s=t.finishedWork;var m=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(_r(177));t.callbackNode=null,t.callbackPriority=0;var v=s.lanes|s.childLanes;if(cz(t,v),t===Vs&&(gs=Vs=null,Js=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||qx||(qx=!0,_M(Tv,function(){return em(),null})),v=(s.flags&15990)!==0,s.subtreeFlags&15990||v){v=Va.transition,Va.transition=null;var T=xn;xn=1;var a=on;on|=4,_S.current=null,TB(t,s),lM(s,t),Xz(W2),Ev=!!H2,W2=H2=null,t.current=s,SB(s),ez(),on=a,xn=T,Va.transition=v}else t.current=s;if(qx&&(qx=!1,th=t,Uv=m),v=t.pendingLanes,v===0&&(ch=null),iz(s.stateNode),qo(t,us()),r!==null)for(u=t.onRecoverableError,s=0;s<r.length;s++)m=r[s],u(m.value,{componentStack:m.stack,digest:m.digest});if(jv)throw jv=!1,t=dT,dT=null,t;return Uv&1&&t.tag!==0&&em(),v=t.pendingLanes,v&1?t===fT?$g++:($g=0,fT=t):$g=0,xh(),null}function em(){if(th!==null){var t=Zk(Uv),r=Va.transition,s=xn;try{if(Va.transition=null,xn=16>t?16:t,th===null)var u=!1;else{if(t=th,th=null,Uv=0,on&6)throw Error(_r(331));var m=on;for(on|=4,Jr=t.current;Jr!==null;){var v=Jr,T=v.child;if(Jr.flags&16){var a=v.deletions;if(a!==null){for(var R=0;R<a.length;R++){var O=a[R];for(Jr=O;Jr!==null;){var B=Jr;switch(B.tag){case 0:case 11:case 15:Ug(8,B,v)}var H=B.child;if(H!==null)H.return=B,Jr=H;else for(;Jr!==null;){B=Jr;var q=B.sibling,ee=B.return;if(sM(B),B===O){Jr=null;break}if(q!==null){q.return=ee,Jr=q;break}Jr=ee}}}var re=v.alternate;if(re!==null){var J=re.child;if(J!==null){re.child=null;do{var _e=J.sibling;J.sibling=null,J=_e}while(J!==null)}}Jr=v}}if(v.subtreeFlags&2064&&T!==null)T.return=v,Jr=T;else e:for(;Jr!==null;){if(v=Jr,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Ug(9,v,v.return)}var pe=v.sibling;if(pe!==null){pe.return=v.return,Jr=pe;break e}Jr=v.return}}var ue=t.current;for(Jr=ue;Jr!==null;){T=Jr;var ie=T.child;if(T.subtreeFlags&2064&&ie!==null)ie.return=T,Jr=ie;else e:for(T=ue;Jr!==null;){if(a=Jr,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_1(9,a)}}catch(at){is(a,a.return,at)}if(a===T){Jr=null;break e}var ke=a.sibling;if(ke!==null){ke.return=a.return,Jr=ke;break e}Jr=a.return}}if(on=m,xh(),ic&&typeof ic.onPostCommitFiberRoot=="function")try{ic.onPostCommitFiberRoot(c1,t)}catch{}u=!0}return u}finally{xn=s,Va.transition=r}}return!1}function QP(t,r,s){r=um(s,r),r=ZR(t,r,1),t=lh(t,r,1),r=Oo(),t!==null&&(I_(t,1,r),qo(t,r))}function is(t,r,s){if(t.tag===3)QP(t,t,s);else for(;r!==null;){if(r.tag===3){QP(r,t,s);break}else if(r.tag===1){var u=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(ch===null||!ch.has(u))){t=um(s,t),t=XR(r,t,1),r=lh(r,t,1),t=Oo(),r!==null&&(I_(r,1,t),qo(r,t));break}}r=r.return}}function kB(t,r,s){var u=t.pingCache;u!==null&&u.delete(r),r=Oo(),t.pingedLanes|=t.suspendedLanes&s,Vs===t&&(Js&s)===s&&(Ps===4||Ps===3&&(Js&130023424)===Js&&500>us()-xS?Ed(t,0):yS|=s),qo(t,r)}function mM(t,r){r===0&&(t.mode&1?(r=Nx,Nx<<=1,!(Nx&130023424)&&(Nx=4194304)):r=1);var s=Oo();t=Zc(t,r),t!==null&&(I_(t,r,s),qo(t,s))}function RB(t){var r=t.memoizedState,s=0;r!==null&&(s=r.retryLane),mM(t,s)}function MB(t,r){var s=0;switch(t.tag){case 13:var u=t.stateNode,m=t.memoizedState;m!==null&&(s=m.retryLane);break;case 19:u=t.stateNode;break;default:throw Error(_r(314))}u!==null&&u.delete(r),mM(t,s)}var gM;gM=function(t,r,s){if(t!==null)if(t.memoizedProps!==r.pendingProps||Ho.current)Go=!0;else{if(!(t.lanes&s)&&!(r.flags&128))return Go=!1,xB(t,r,s);Go=!!(t.flags&131072)}else Go=!1,Zn&&r.flags&1048576&&vR(r,Mv,r.index);switch(r.lanes=0,r.tag){case 2:var u=r.type;mv(t,r),t=r.pendingProps;var m=om(r,po.current);Qp(r,s),m=dS(null,r,u,t,m,s);var v=fS();return r.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Wo(u)?(v=!0,kv(r)):v=!1,r.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,aS(r),m.updater=g1,r.stateNode=m,m._reactInternals=r,tT(r,u,t,s),r=nT(null,r,u,!0,v,s)):(r.tag=0,Zn&&v&&eS(r),Ro(null,r,m,s),r=r.child),r;case 16:u=r.elementType;e:{switch(mv(t,r),t=r.pendingProps,m=u._init,u=m(u._payload),r.type=u,m=r.tag=OB(u),t=hl(u,t),m){case 0:r=iT(null,r,u,t,s);break e;case 1:r=$P(null,r,u,t,s);break e;case 11:r=UP(null,r,u,t,s);break e;case 14:r=VP(null,r,u,hl(u.type,t),s);break e}throw Error(_r(306,u,""))}return r;case 0:return u=r.type,m=r.pendingProps,m=r.elementType===u?m:hl(u,m),iT(t,r,u,m,s);case 1:return u=r.type,m=r.pendingProps,m=r.elementType===u?m:hl(u,m),$P(t,r,u,m,s);case 3:e:{if(QR(r),t===null)throw Error(_r(387));u=r.pendingProps,v=r.memoizedState,m=v.element,AR(t,r),Lv(r,u,null,s);var T=r.memoizedState;if(u=T.element,v.isDehydrated)if(v={element:u,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){m=um(Error(_r(423)),r),r=GP(t,r,u,s,m);break e}else if(u!==m){m=um(Error(_r(424)),r),r=GP(t,r,u,s,m);break e}else for(ya=ah(r.stateNode.containerInfo.firstChild),xa=r,Zn=!0,pl=null,s=SR(r,null,u,s),r.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(am(),u===m){r=Xc(t,r,s);break e}Ro(t,r,u,s)}r=r.child}return r;case 5:return IR(r),t===null&&J2(r),u=r.type,m=r.pendingProps,v=t!==null?t.memoizedProps:null,T=m.children,q2(u,m)?T=null:v!==null&&q2(u,v)&&(r.flags|=32),JR(t,r),Ro(t,r,T,s),r.child;case 6:return t===null&&J2(r),null;case 13:return eM(t,r,s);case 4:return lS(r,r.stateNode.containerInfo),u=r.pendingProps,t===null?r.child=lm(r,null,u,s):Ro(t,r,u,s),r.child;case 11:return u=r.type,m=r.pendingProps,m=r.elementType===u?m:hl(u,m),UP(t,r,u,m,s);case 7:return Ro(t,r,r.pendingProps,s),r.child;case 8:return Ro(t,r,r.pendingProps.children,s),r.child;case 12:return Ro(t,r,r.pendingProps.children,s),r.child;case 10:e:{if(u=r.type._context,m=r.pendingProps,v=r.memoizedProps,T=m.value,On(Dv,u._currentValue),u._currentValue=T,v!==null)if(vl(v.value,T)){if(v.children===m.children&&!Ho.current){r=Xc(t,r,s);break e}}else for(v=r.child,v!==null&&(v.return=r);v!==null;){var a=v.dependencies;if(a!==null){T=v.child;for(var R=a.firstContext;R!==null;){if(R.context===u){if(v.tag===1){R=Uc(-1,s&-s),R.tag=2;var O=v.updateQueue;if(O!==null){O=O.shared;var B=O.pending;B===null?R.next=R:(R.next=B.next,B.next=R),O.pending=R}}v.lanes|=s,R=v.alternate,R!==null&&(R.lanes|=s),Q2(v.return,s,r),a.lanes|=s;break}R=R.next}}else if(v.tag===10)T=v.type===r.type?null:v.child;else if(v.tag===18){if(T=v.return,T===null)throw Error(_r(341));T.lanes|=s,a=T.alternate,a!==null&&(a.lanes|=s),Q2(T,s,r),T=v.sibling}else T=v.child;if(T!==null)T.return=v;else for(T=v;T!==null;){if(T===r){T=null;break}if(v=T.sibling,v!==null){v.return=T.return,T=v;break}T=T.return}v=T}Ro(t,r,m.children,s),r=r.child}return r;case 9:return m=r.type,u=r.pendingProps.children,Qp(r,s),m=$a(m),u=u(m),r.flags|=1,Ro(t,r,u,s),r.child;case 14:return u=r.type,m=hl(u,r.pendingProps),m=hl(u.type,m),VP(t,r,u,m,s);case 15:return KR(t,r,r.type,r.pendingProps,s);case 17:return u=r.type,m=r.pendingProps,m=r.elementType===u?m:hl(u,m),mv(t,r),r.tag=1,Wo(u)?(t=!0,kv(r)):t=!1,Qp(r,s),qR(r,u,m),tT(r,u,m,s),nT(null,r,u,!0,t,s);case 19:return tM(t,r,s);case 22:return YR(t,r,s)}throw Error(_r(156,r.tag))};function _M(t,r){return Gk(t,r)}function DB(t,r,s,u){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ua(t,r,s,u){return new DB(t,r,s,u)}function TS(t){return t=t.prototype,!(!t||!t.isReactComponent)}function OB(t){if(typeof t=="function")return TS(t)?1:0;if(t!=null){if(t=t.$$typeof,t===VT)return 11;if(t===$T)return 14}return 2}function hh(t,r){var s=t.alternate;return s===null?(s=Ua(t.tag,r,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=r,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,r=t.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function yv(t,r,s,u,m,v){var T=2;if(u=t,typeof t=="function")TS(t)&&(T=1);else if(typeof t=="string")T=5;else e:switch(t){case Fp:return Ad(s.children,m,v,r);case UT:T=8,m|=8;break;case E2:return t=Ua(12,s,r,m|2),t.elementType=E2,t.lanes=v,t;case A2:return t=Ua(13,s,r,m),t.elementType=A2,t.lanes=v,t;case I2:return t=Ua(19,s,r,m),t.elementType=I2,t.lanes=v,t;case Ik:return x1(s,m,v,r);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ek:T=10;break e;case Ak:T=9;break e;case VT:T=11;break e;case $T:T=14;break e;case Xu:T=16,u=null;break e}throw Error(_r(130,t==null?t:typeof t,""))}return r=Ua(T,s,r,m),r.elementType=t,r.type=u,r.lanes=v,r}function Ad(t,r,s,u){return t=Ua(7,t,u,r),t.lanes=s,t}function x1(t,r,s,u){return t=Ua(22,t,u,r),t.elementType=Ik,t.lanes=s,t.stateNode={isHidden:!1},t}function o2(t,r,s){return t=Ua(6,t,null,r),t.lanes=s,t}function a2(t,r,s){return r=Ua(4,t.children!==null?t.children:[],t.key,r),r.lanes=s,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}function LB(t,r,s,u,m){this.tag=r,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ub(0),this.expirationTimes=Ub(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ub(0),this.identifierPrefix=u,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function SS(t,r,s,u,m,v,T,a,R){return t=new LB(t,r,s,a,R),r===1?(r=1,v===!0&&(r|=8)):r=0,v=Ua(3,null,null,r),t.current=v,v.stateNode=t,v.memoizedState={element:u,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},aS(v),t}function FB(t,r,s){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lp,key:u==null?null:""+u,children:t,containerInfo:r,implementation:s}}function yM(t){if(!t)return fh;t=t._reactInternals;e:{if(zd(t)!==t||t.tag!==1)throw Error(_r(170));var r=t;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Wo(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(_r(171))}if(t.tag===1){var s=t.type;if(Wo(s))return yR(t,s,r)}return r}function xM(t,r,s,u,m,v,T,a,R){return t=SS(s,u,!0,t,m,v,T,a,R),t.context=yM(null),s=t.current,u=Oo(),m=uh(s),v=Uc(u,m),v.callback=r??null,lh(s,v,m),t.current.lanes=m,I_(t,m,u),qo(t,u),t}function v1(t,r,s,u){var m=r.current,v=Oo(),T=uh(m);return s=yM(s),r.context===null?r.context=s:r.pendingContext=s,r=Uc(v,T),r.payload={element:t},u=u===void 0?null:u,u!==null&&(r.callback=u),t=lh(m,r,T),t!==null&&(yl(t,m,T,v),dv(t,m,T)),T}function $v(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function e3(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<r?s:r}}function ES(t,r){e3(t,r),(t=t.alternate)&&e3(t,r)}function NB(){return null}var vM=typeof reportError=="function"?reportError:function(t){console.error(t)};function AS(t){this._internalRoot=t}w1.prototype.render=AS.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(_r(409));v1(t,r,null,null)};w1.prototype.unmount=AS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;Md(function(){v1(null,t,null,null)}),r[qc]=null}};function w1(t){this._internalRoot=t}w1.prototype.unstable_scheduleHydration=function(t){if(t){var r=Yk();t={blockedOn:null,target:t,priority:r};for(var s=0;s<Yu.length&&r!==0&&r<Yu[s].priority;s++);Yu.splice(s,0,t),s===0&&Qk(t)}};function IS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function b1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function t3(){}function zB(t,r,s,u,m){if(m){if(typeof u=="function"){var v=u;u=function(){var O=$v(T);v.call(O)}}var T=xM(r,u,t,0,null,!1,!1,"",t3);return t._reactRootContainer=T,t[qc]=T.current,a_(t.nodeType===8?t.parentNode:t),Md(),T}for(;m=t.lastChild;)t.removeChild(m);if(typeof u=="function"){var a=u;u=function(){var O=$v(R);a.call(O)}}var R=SS(t,0,!1,null,null,!1,!1,"",t3);return t._reactRootContainer=R,t[qc]=R.current,a_(t.nodeType===8?t.parentNode:t),Md(function(){v1(r,R,s,u)}),R}function T1(t,r,s,u,m){var v=s._reactRootContainer;if(v){var T=v;if(typeof m=="function"){var a=m;m=function(){var R=$v(T);a.call(R)}}v1(r,T,t,m)}else T=zB(s,r,t,m,u);return $v(T)}Xk=function(t){switch(t.tag){case 3:var r=t.stateNode;if(r.current.memoizedState.isDehydrated){var s=kg(r.pendingLanes);s!==0&&(WT(r,s|1),qo(r,us()),!(on&6)&&(hm=us()+500,xh()))}break;case 13:Md(function(){var u=Zc(t,1);if(u!==null){var m=Oo();yl(u,t,1,m)}}),ES(t,1)}};qT=function(t){if(t.tag===13){var r=Zc(t,134217728);if(r!==null){var s=Oo();yl(r,t,134217728,s)}ES(t,134217728)}};Kk=function(t){if(t.tag===13){var r=uh(t),s=Zc(t,r);if(s!==null){var u=Oo();yl(s,t,r,u)}ES(t,r)}};Yk=function(){return xn};Jk=function(t,r){var s=xn;try{return xn=t,r()}finally{xn=s}};N2=function(t,r,s){switch(r){case"input":if(k2(t,s),r=s.name,s.type==="radio"&&r!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<s.length;r++){var u=s[r];if(u!==t&&u.form===t.form){var m=f1(u);if(!m)throw Error(_r(90));Pk(u),k2(u,m)}}}break;case"textarea":Rk(t,s);break;case"select":r=s.value,r!=null&&Xp(t,!!s.multiple,r,!1)}};zk=vS;Bk=Md;var BB={usingClientEntryPoint:!1,Events:[P_,jp,f1,Fk,Nk,vS]},Sg={findFiberByHostInstance:bd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jB={bundleType:Sg.bundleType,version:Sg.version,rendererPackageName:Sg.rendererPackageName,rendererConfig:Sg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Vk(t),t===null?null:t.stateNode},findFiberByHostInstance:Sg.findFiberByHostInstance||NB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zx.isDisabled&&Zx.supportsFiber)try{c1=Zx.inject(jB),ic=Zx}catch{}}Ta.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BB;Ta.createPortal=function(t,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!IS(r))throw Error(_r(200));return FB(t,r,null,s)};Ta.createRoot=function(t,r){if(!IS(t))throw Error(_r(299));var s=!1,u="",m=vM;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onRecoverableError!==void 0&&(m=r.onRecoverableError)),r=SS(t,1,!1,null,null,s,!1,u,m),t[qc]=r.current,a_(t.nodeType===8?t.parentNode:t),new AS(r)};Ta.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(_r(188)):(t=Object.keys(t).join(","),Error(_r(268,t)));return t=Vk(r),t=t===null?null:t.stateNode,t};Ta.flushSync=function(t){return Md(t)};Ta.hydrate=function(t,r,s){if(!b1(r))throw Error(_r(200));return T1(null,t,r,!0,s)};Ta.hydrateRoot=function(t,r,s){if(!IS(t))throw Error(_r(405));var u=s!=null&&s.hydratedSources||null,m=!1,v="",T=vM;if(s!=null&&(s.unstable_strictMode===!0&&(m=!0),s.identifierPrefix!==void 0&&(v=s.identifierPrefix),s.onRecoverableError!==void 0&&(T=s.onRecoverableError)),r=xM(r,null,t,1,s??null,m,!1,v,T),t[qc]=r.current,a_(t),u)for(t=0;t<u.length;t++)s=u[t],m=s._getVersion,m=m(s._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[s,m]:r.mutableSourceEagerHydrationData.push(s,m);return new w1(r)};Ta.render=function(t,r,s){if(!b1(r))throw Error(_r(200));return T1(null,t,r,!1,s)};Ta.unmountComponentAtNode=function(t){if(!b1(t))throw Error(_r(40));return t._reactRootContainer?(Md(function(){T1(null,null,t,!1,function(){t._reactRootContainer=null,t[qc]=null})}),!0):!1};Ta.unstable_batchedUpdates=vS;Ta.unstable_renderSubtreeIntoContainer=function(t,r,s,u){if(!b1(s))throw Error(_r(200));if(t==null||t._reactInternals===void 0)throw Error(_r(38));return T1(t,r,s,!1,u)};Ta.version="18.3.1-next-f1338f8080-20240426";function wM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wM)}catch(t){console.error(t)}}wM(),wk.exports=Ta;var UB=wk.exports,bM,r3=UB;bM=r3.createRoot,r3.hydrateRoot;const VB="modulepreload",$B=function(t){return"/"+t},i3={},Bd=function(r,s,u){let m=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const T=document.querySelector("meta[property=csp-nonce]"),a=(T==null?void 0:T.nonce)||(T==null?void 0:T.getAttribute("nonce"));m=Promise.allSettled(s.map(R=>{if(R=$B(R),R in i3)return;i3[R]=!0;const O=R.endsWith(".css"),B=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${R}"]${B}`))return;const H=document.createElement("link");if(H.rel=O?"stylesheet":VB,O||(H.as="script"),H.crossOrigin="",H.href=R,a&&H.setAttribute("nonce",a),document.head.appendChild(H),O)return new Promise((q,ee)=>{H.addEventListener("load",q),H.addEventListener("error",()=>ee(new Error(`Unable to preload CSS for ${R}`)))})}))}function v(T){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=T,window.dispatchEvent(a),!a.defaultPrevented)throw T}return m.then(T=>{for(const a of T||[])a.status==="rejected"&&v(a.reason);return r().catch(v)})},GB=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Bd(async()=>{const{default:u}=await Promise.resolve().then(()=>_m);return{default:u}},void 0).then(({default:u})=>u(...s)):r=fetch,(...s)=>r(...s)};class CS extends Error{constructor(r,s="FunctionsError",u){super(r),this.name=s,this.context=u}}class HB extends CS{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class n3 extends CS{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class s3 extends CS{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var gT;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(gT||(gT={}));var WB=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};class qB{constructor(r,{headers:s={},customFetch:u,region:m=gT.Any}={}){this.url=r,this.headers=s,this.region=m,this.fetch=GB(u)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,s={}){var u;return WB(this,void 0,void 0,function*(){try{const{headers:m,method:v,body:T}=s;let a={},{region:R}=s;R||(R=this.region);const O=new URL(`${this.url}/${r}`);R&&R!=="any"&&(a["x-region"]=R,O.searchParams.set("forceFunctionRegion",R));let B;T&&(m&&!Object.prototype.hasOwnProperty.call(m,"Content-Type")||!m)&&(typeof Blob<"u"&&T instanceof Blob||T instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",B=T):typeof T=="string"?(a["Content-Type"]="text/plain",B=T):typeof FormData<"u"&&T instanceof FormData?B=T:(a["Content-Type"]="application/json",B=JSON.stringify(T)));const H=yield this.fetch(O.toString(),{method:v||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),m),body:B}).catch(J=>{throw new HB(J)}),q=H.headers.get("x-relay-error");if(q&&q==="true")throw new n3(H);if(!H.ok)throw new s3(H);let ee=((u=H.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),re;return ee==="application/json"?re=yield H.json():ee==="application/octet-stream"?re=yield H.blob():ee==="text/event-stream"?re=H:ee==="multipart/form-data"?re=yield H.formData():re=yield H.text(),{data:re,error:null,response:H}}catch(m){return{data:null,error:m,response:m instanceof s3||m instanceof n3?m.context:void 0}}})}}var $o={},PS={},S1={},R_={},E1={},A1={},ZB=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},dm=ZB();const XB=dm.fetch,TM=dm.fetch.bind(dm),SM=dm.Headers,KB=dm.Request,YB=dm.Response,_m=Object.freeze(Object.defineProperty({__proto__:null,Headers:SM,Request:KB,Response:YB,default:TM,fetch:XB},Symbol.toStringTag,{value:"Module"})),JB=mN(_m);var I1={};Object.defineProperty(I1,"__esModule",{value:!0});let QB=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}};I1.default=QB;var EM=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(A1,"__esModule",{value:!0});const e5=EM(JB),t5=EM(I1);let r5=class{constructor(r){var s,u;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(s=r.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=r.signal,this.isMaybeSingle=(u=r.isMaybeSingle)!==null&&u!==void 0?u:!1,r.fetch?this.fetch=r.fetch:typeof fetch>"u"?this.fetch=e5.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,s){return this.headers=new Headers(this.headers),this.headers.set(r,s),this}then(r,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const u=this.fetch;let m=u(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var T,a,R,O;let B=null,H=null,q=null,ee=v.status,re=v.statusText;if(v.ok){if(this.method!=="HEAD"){const ue=await v.text();ue===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((T=this.headers.get("Accept"))===null||T===void 0)&&T.includes("application/vnd.pgrst.plan+text"))?H=ue:H=JSON.parse(ue))}const _e=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),pe=(R=v.headers.get("content-range"))===null||R===void 0?void 0:R.split("/");_e&&pe&&pe.length>1&&(q=parseInt(pe[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(H)&&(H.length>1?(B={code:"PGRST116",details:`Results contain ${H.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},H=null,q=null,ee=406,re="Not Acceptable"):H.length===1?H=H[0]:H=null)}else{const _e=await v.text();try{B=JSON.parse(_e),Array.isArray(B)&&v.status===404&&(H=[],B=null,ee=200,re="OK")}catch{v.status===404&&_e===""?(ee=204,re="No Content"):B={message:_e}}if(B&&this.isMaybeSingle&&(!((O=B==null?void 0:B.details)===null||O===void 0)&&O.includes("0 rows"))&&(B=null,ee=200,re="OK"),B&&this.shouldThrowOnError)throw new t5.default(B)}return{error:B,data:H,count:q,status:ee,statusText:re}});return this.shouldThrowOnError||(m=m.catch(v=>{var T,a,R;return{error:{message:`${(T=v==null?void 0:v.name)!==null&&T!==void 0?T:"FetchError"}: ${v==null?void 0:v.message}`,details:`${(a=v==null?void 0:v.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(R=v==null?void 0:v.code)!==null&&R!==void 0?R:""}`},data:null,count:null,status:0,statusText:""}})),m.then(r,s)}returns(){return this}overrideTypes(){return this}};A1.default=r5;var i5=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(E1,"__esModule",{value:!0});const n5=i5(A1);let s5=class extends n5.default{select(r){let s=!1;const u=(r??"*").split("").map(m=>/\s/.test(m)&&!s?"":(m==='"'&&(s=!s),m)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:s=!0,nullsFirst:u,foreignTable:m,referencedTable:v=m}={}){const T=v?`${v}.order`:"order",a=this.url.searchParams.get(T);return this.url.searchParams.set(T,`${a?`${a},`:""}${r}.${s?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:s,referencedTable:u=s}={}){const m=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(m,`${r}`),this}range(r,s,{foreignTable:u,referencedTable:m=u}={}){const v=typeof m>"u"?"offset":`${m}.offset`,T=typeof m>"u"?"limit":`${m}.limit`;return this.url.searchParams.set(v,`${r}`),this.url.searchParams.set(T,`${s-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:s=!1,settings:u=!1,buffers:m=!1,wal:v=!1,format:T="text"}={}){var a;const R=[r?"analyze":null,s?"verbose":null,u?"settings":null,m?"buffers":null,v?"wal":null].filter(Boolean).join("|"),O=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${T}; for="${O}"; options=${R};`),T==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};E1.default=s5;var o5=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(R_,"__esModule",{value:!0});const a5=o5(E1);let l5=class extends a5.default{eq(r,s){return this.url.searchParams.append(r,`eq.${s}`),this}neq(r,s){return this.url.searchParams.append(r,`neq.${s}`),this}gt(r,s){return this.url.searchParams.append(r,`gt.${s}`),this}gte(r,s){return this.url.searchParams.append(r,`gte.${s}`),this}lt(r,s){return this.url.searchParams.append(r,`lt.${s}`),this}lte(r,s){return this.url.searchParams.append(r,`lte.${s}`),this}like(r,s){return this.url.searchParams.append(r,`like.${s}`),this}likeAllOf(r,s){return this.url.searchParams.append(r,`like(all).{${s.join(",")}}`),this}likeAnyOf(r,s){return this.url.searchParams.append(r,`like(any).{${s.join(",")}}`),this}ilike(r,s){return this.url.searchParams.append(r,`ilike.${s}`),this}ilikeAllOf(r,s){return this.url.searchParams.append(r,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(r,s){return this.url.searchParams.append(r,`ilike(any).{${s.join(",")}}`),this}is(r,s){return this.url.searchParams.append(r,`is.${s}`),this}in(r,s){const u=Array.from(new Set(s)).map(m=>typeof m=="string"&&new RegExp("[,()]").test(m)?`"${m}"`:`${m}`).join(",");return this.url.searchParams.append(r,`in.(${u})`),this}contains(r,s){return typeof s=="string"?this.url.searchParams.append(r,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(r,`cs.{${s.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(s)}`),this}containedBy(r,s){return typeof s=="string"?this.url.searchParams.append(r,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(r,`cd.{${s.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(s)}`),this}rangeGt(r,s){return this.url.searchParams.append(r,`sr.${s}`),this}rangeGte(r,s){return this.url.searchParams.append(r,`nxl.${s}`),this}rangeLt(r,s){return this.url.searchParams.append(r,`sl.${s}`),this}rangeLte(r,s){return this.url.searchParams.append(r,`nxr.${s}`),this}rangeAdjacent(r,s){return this.url.searchParams.append(r,`adj.${s}`),this}overlaps(r,s){return typeof s=="string"?this.url.searchParams.append(r,`ov.${s}`):this.url.searchParams.append(r,`ov.{${s.join(",")}}`),this}textSearch(r,s,{config:u,type:m}={}){let v="";m==="plain"?v="pl":m==="phrase"?v="ph":m==="websearch"&&(v="w");const T=u===void 0?"":`(${u})`;return this.url.searchParams.append(r,`${v}fts${T}.${s}`),this}match(r){return Object.entries(r).forEach(([s,u])=>{this.url.searchParams.append(s,`eq.${u}`)}),this}not(r,s,u){return this.url.searchParams.append(r,`not.${s}.${u}`),this}or(r,{foreignTable:s,referencedTable:u=s}={}){const m=u?`${u}.or`:"or";return this.url.searchParams.append(m,`(${r})`),this}filter(r,s,u){return this.url.searchParams.append(r,`${s}.${u}`),this}};R_.default=l5;var c5=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(S1,"__esModule",{value:!0});const Eg=c5(R_);let u5=class{constructor(r,{headers:s={},schema:u,fetch:m}){this.url=r,this.headers=new Headers(s),this.schema=u,this.fetch=m}select(r,{head:s=!1,count:u}={}){const m=s?"HEAD":"GET";let v=!1;const T=(r??"*").split("").map(a=>/\s/.test(a)&&!v?"":(a==='"'&&(v=!v),a)).join("");return this.url.searchParams.set("select",T),u&&this.headers.append("Prefer",`count=${u}`),new Eg.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(r,{count:s,defaultToNull:u=!0}={}){var m;const v="POST";if(s&&this.headers.append("Prefer",`count=${s}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const T=r.reduce((a,R)=>a.concat(Object.keys(R)),[]);if(T.length>0){const a=[...new Set(T)].map(R=>`"${R}"`);this.url.searchParams.set("columns",a.join(","))}}return new Eg.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}upsert(r,{onConflict:s,ignoreDuplicates:u=!1,count:m,defaultToNull:v=!0}={}){var T;const a="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),m&&this.headers.append("Prefer",`count=${m}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const R=r.reduce((O,B)=>O.concat(Object.keys(B)),[]);if(R.length>0){const O=[...new Set(R)].map(B=>`"${B}"`);this.url.searchParams.set("columns",O.join(","))}}return new Eg.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch})}update(r,{count:s}={}){var u;const m="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new Eg.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:r}={}){var s;const u="DELETE";return r&&this.headers.append("Prefer",`count=${r}`),new Eg.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};S1.default=u5;var AM=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(PS,"__esModule",{value:!0});const h5=AM(S1),d5=AM(R_);let f5=class IM{constructor(r,{headers:s={},schema:u,fetch:m}={}){this.url=r,this.headers=new Headers(s),this.schemaName=u,this.fetch=m}from(r){const s=new URL(`${this.url}/${r}`);return new h5.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new IM(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,s={},{head:u=!1,get:m=!1,count:v}={}){var T;let a;const R=new URL(`${this.url}/rpc/${r}`);let O;u||m?(a=u?"HEAD":"GET",Object.entries(s).filter(([H,q])=>q!==void 0).map(([H,q])=>[H,Array.isArray(q)?`{${q.join(",")}}`:`${q}`]).forEach(([H,q])=>{R.searchParams.append(H,q)})):(a="POST",O=s);const B=new Headers(this.headers);return v&&B.set("Prefer",`count=${v}`),new d5.default({method:a,url:R,headers:B,schema:this.schemaName,body:O,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch})}};PS.default=f5;var ym=va&&va.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty($o,"__esModule",{value:!0});$o.PostgrestError=$o.PostgrestBuilder=$o.PostgrestTransformBuilder=$o.PostgrestFilterBuilder=$o.PostgrestQueryBuilder=$o.PostgrestClient=void 0;const CM=ym(PS);$o.PostgrestClient=CM.default;const PM=ym(S1);$o.PostgrestQueryBuilder=PM.default;const kM=ym(R_);$o.PostgrestFilterBuilder=kM.default;const RM=ym(E1);$o.PostgrestTransformBuilder=RM.default;const MM=ym(A1);$o.PostgrestBuilder=MM.default;const DM=ym(I1);$o.PostgrestError=DM.default;var p5=$o.default={PostgrestClient:CM.default,PostgrestQueryBuilder:PM.default,PostgrestFilterBuilder:kM.default,PostgrestTransformBuilder:RM.default,PostgrestBuilder:MM.default,PostgrestError:DM.default};const{PostgrestClient:m5,PostgrestQueryBuilder:$H,PostgrestFilterBuilder:GH,PostgrestTransformBuilder:HH,PostgrestBuilder:WH,PostgrestError:qH}=p5;class g5{static detectEnvironment(){var r;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((r=navigator.userAgent)===null||r===void 0)&&r.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const u=s.node,m=parseInt(u.replace(/^v/,"").split(".")[0]);return m>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${m} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${m} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const r=this.detectEnvironment();if(r.constructor)return r.constructor;let s=r.error||"WebSocket not supported in this environment.";throw r.workaround&&(s+=`

Suggested solution: ${r.workaround}`),new Error(s)}static createWebSocket(r,s){const u=this.getWebSocketConstructor();return new u(r,s)}static isWebSocketSupported(){try{const r=this.detectEnvironment();return r.type==="native"||r.type==="ws"}catch{return!1}}}const _5="2.15.5",y5=`realtime-js/${_5}`,x5="1.0.0",_T=1e4,v5=1e3,w5=100;var Gg;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Gg||(Gg={}));var Es;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Es||(Es={}));var fl;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(fl||(fl={}));var yT;(function(t){t.websocket="websocket"})(yT||(yT={}));var xd;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(xd||(xd={}));class b5{constructor(){this.HEADER_LENGTH=1}decode(r,s){return r.constructor===ArrayBuffer?s(this._binaryDecode(r)):s(typeof r=="string"?JSON.parse(r):{})}_binaryDecode(r){const s=new DataView(r),u=new TextDecoder;return this._decodeBroadcast(r,s,u)}_decodeBroadcast(r,s,u){const m=s.getUint8(1),v=s.getUint8(2);let T=this.HEADER_LENGTH+2;const a=u.decode(r.slice(T,T+m));T=T+m;const R=u.decode(r.slice(T,T+v));T=T+v;const O=JSON.parse(u.decode(r.slice(T,r.byteLength)));return{ref:null,topic:a,event:R,payload:O}}}class OM{constructor(r,s){this.callback=r,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Dn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Dn||(Dn={}));const o3=(t,r,s={})=>{var u;const m=(u=s.skipTypes)!==null&&u!==void 0?u:[];return Object.keys(r).reduce((v,T)=>(v[T]=T5(T,t,r,m),v),{})},T5=(t,r,s,u)=>{const m=r.find(a=>a.name===t),v=m==null?void 0:m.type,T=s[t];return v&&!u.includes(v)?LM(v,T):xT(T)},LM=(t,r)=>{if(t.charAt(0)==="_"){const s=t.slice(1,t.length);return I5(r,s)}switch(t){case Dn.bool:return S5(r);case Dn.float4:case Dn.float8:case Dn.int2:case Dn.int4:case Dn.int8:case Dn.numeric:case Dn.oid:return E5(r);case Dn.json:case Dn.jsonb:return A5(r);case Dn.timestamp:return C5(r);case Dn.abstime:case Dn.date:case Dn.daterange:case Dn.int4range:case Dn.int8range:case Dn.money:case Dn.reltime:case Dn.text:case Dn.time:case Dn.timestamptz:case Dn.timetz:case Dn.tsrange:case Dn.tstzrange:return xT(r);default:return xT(r)}},xT=t=>t,S5=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},E5=t=>{if(typeof t=="string"){const r=parseFloat(t);if(!Number.isNaN(r))return r}return t},A5=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(r){return console.log(`JSON parse error: ${r}`),t}return t},I5=(t,r)=>{if(typeof t!="string")return t;const s=t.length-1,u=t[s];if(t[0]==="{"&&u==="}"){let v;const T=t.slice(1,s);try{v=JSON.parse("["+T+"]")}catch{v=T?T.split(","):[]}return v.map(a=>LM(r,a))}return t},C5=t=>typeof t=="string"?t.replace(" ","T"):t,FM=t=>{let r=t;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")+"/api/broadcast"};class l2{constructor(r,s,u={},m=_T){this.channel=r,this.event=s,this.payload=u,this.timeout=m,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,s){var u;return this._hasReceived(r)&&s((u=this.receivedResp)===null||u===void 0?void 0:u.response),this.recHooks.push({status:r,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const r=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},r),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(r,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:s}){this.recHooks.filter(u=>u.status===r).forEach(u=>u.callback(s))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}var a3;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(a3||(a3={}));class Hg{constructor(r,s){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const u=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(u.state,{},m=>{const{onJoin:v,onLeave:T,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Hg.syncState(this.state,m,v,T),this.pendingDiffs.forEach(R=>{this.state=Hg.syncDiff(this.state,R,v,T)}),this.pendingDiffs=[],a()}),this.channel._on(u.diff,{},m=>{const{onJoin:v,onLeave:T,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(m):(this.state=Hg.syncDiff(this.state,m,v,T),a())}),this.onJoin((m,v,T)=>{this.channel._trigger("presence",{event:"join",key:m,currentPresences:v,newPresences:T})}),this.onLeave((m,v,T)=>{this.channel._trigger("presence",{event:"leave",key:m,currentPresences:v,leftPresences:T})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,s,u,m){const v=this.cloneDeep(r),T=this.transformState(s),a={},R={};return this.map(v,(O,B)=>{T[O]||(R[O]=B)}),this.map(T,(O,B)=>{const H=v[O];if(H){const q=B.map(_e=>_e.presence_ref),ee=H.map(_e=>_e.presence_ref),re=B.filter(_e=>ee.indexOf(_e.presence_ref)<0),J=H.filter(_e=>q.indexOf(_e.presence_ref)<0);re.length>0&&(a[O]=re),J.length>0&&(R[O]=J)}else a[O]=B}),this.syncDiff(v,{joins:a,leaves:R},u,m)}static syncDiff(r,s,u,m){const{joins:v,leaves:T}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return u||(u=()=>{}),m||(m=()=>{}),this.map(v,(a,R)=>{var O;const B=(O=r[a])!==null&&O!==void 0?O:[];if(r[a]=this.cloneDeep(R),B.length>0){const H=r[a].map(ee=>ee.presence_ref),q=B.filter(ee=>H.indexOf(ee.presence_ref)<0);r[a].unshift(...q)}u(a,B,R)}),this.map(T,(a,R)=>{let O=r[a];if(!O)return;const B=R.map(H=>H.presence_ref);O=O.filter(H=>B.indexOf(H.presence_ref)<0),r[a]=O,m(a,O,R),O.length===0&&delete r[a]}),r}static map(r,s){return Object.getOwnPropertyNames(r).map(u=>s(u,r[u]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((s,u)=>{const m=r[u];return"metas"in m?s[u]=m.metas.map(v=>(v.presence_ref=v.phx_ref,delete v.phx_ref,delete v.phx_ref_prev,v)):s[u]=m,s},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var l3;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(l3||(l3={}));var Wg;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Wg||(Wg={}));var Nc;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Nc||(Nc={}));class kS{constructor(r,s={config:{}},u){this.topic=r,this.params=s,this.socket=u,this.bindings={},this.state=Es.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new l2(this,fl.join,this.params,this.timeout),this.rejoinTimer=new OM(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Es.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(m=>m.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Es.closed,this.socket._remove(this)}),this._onError(m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Es.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Es.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Es.errored,this.rejoinTimer.scheduleTimeout())}),this._on(fl.reply,{},(m,v)=>{this._trigger(this._replyEventName(v),m)}),this.presence=new Hg(this),this.broadcastEndpointURL=FM(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(r,s=this.timeout){var u,m,v;if(this.socket.isConnected()||this.socket.connect(),this.state==Es.closed){const{config:{broadcast:T,presence:a,private:R}}=this.params,O=(m=(u=this.bindings.postgres_changes)===null||u===void 0?void 0:u.map(ee=>ee.filter))!==null&&m!==void 0?m:[],B=!!this.bindings[Wg.PRESENCE]&&this.bindings[Wg.PRESENCE].length>0||((v=this.params.config.presence)===null||v===void 0?void 0:v.enabled)===!0,H={},q={broadcast:T,presence:Object.assign(Object.assign({},a),{enabled:B}),postgres_changes:O,private:R};this.socket.accessTokenValue&&(H.access_token=this.socket.accessTokenValue),this._onError(ee=>r==null?void 0:r(Nc.CHANNEL_ERROR,ee)),this._onClose(()=>r==null?void 0:r(Nc.CLOSED)),this.updateJoinPayload(Object.assign({config:q},H)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:ee})=>{var re;if(this.socket.setAuth(),ee===void 0){r==null||r(Nc.SUBSCRIBED);return}else{const J=this.bindings.postgres_changes,_e=(re=J==null?void 0:J.length)!==null&&re!==void 0?re:0,pe=[];for(let ue=0;ue<_e;ue++){const ie=J[ue],{filter:{event:ke,schema:at,table:He,filter:De}}=ie,et=ee&&ee[ue];if(et&&et.event===ke&&et.schema===at&&et.table===He&&et.filter===De)pe.push(Object.assign(Object.assign({},ie),{id:et.id}));else{this.unsubscribe(),this.state=Es.errored,r==null||r(Nc.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=pe,r&&r(Nc.SUBSCRIBED);return}}).receive("error",ee=>{this.state=Es.errored,r==null||r(Nc.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(ee).join(", ")||"error")))}).receive("timeout",()=>{r==null||r(Nc.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(r,s={}){return await this.send({type:"presence",event:"track",payload:r},s.timeout||this.timeout)}async untrack(r={}){return await this.send({type:"presence",event:"untrack"},r)}on(r,s,u){return this.state===Es.joined&&r===Wg.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(r,s,u)}async send(r,s={}){var u,m;if(!this._canPush()&&r.type==="broadcast"){const{event:v,payload:T}=r,R={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:v,payload:T,private:this.private}]})};try{const O=await this._fetchWithTimeout(this.broadcastEndpointURL,R,(u=s.timeout)!==null&&u!==void 0?u:this.timeout);return await((m=O.body)===null||m===void 0?void 0:m.cancel()),O.ok?"ok":"error"}catch(O){return O.name==="AbortError"?"timed out":"error"}}else return new Promise(v=>{var T,a,R;const O=this._push(r.type,r,s.timeout||this.timeout);r.type==="broadcast"&&!(!((R=(a=(T=this.params)===null||T===void 0?void 0:T.config)===null||a===void 0?void 0:a.broadcast)===null||R===void 0)&&R.ack)&&v("ok"),O.receive("ok",()=>v("ok")),O.receive("error",()=>v("error")),O.receive("timeout",()=>v("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=Es.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(fl.close,"leave",this._joinRef())};this.joinPush.destroy();let u=null;return new Promise(m=>{u=new l2(this,fl.leave,{},r),u.receive("ok",()=>{s(),m("ok")}).receive("timeout",()=>{s(),m("timed out")}).receive("error",()=>{m("error")}),u.send(),this._canPush()||u.trigger("ok",{})}).finally(()=>{u==null||u.destroy()})}teardown(){this.pushBuffer.forEach(r=>r.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Es.closed,this.bindings={}}async _fetchWithTimeout(r,s,u){const m=new AbortController,v=setTimeout(()=>m.abort(),u),T=await this.socket.fetch(r,Object.assign(Object.assign({},s),{signal:m.signal}));return clearTimeout(v),T}_push(r,s,u=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let m=new l2(this,r,s,u);return this._canPush()?m.send():this._addToPushBuffer(m),m}_addToPushBuffer(r){if(r.startTimeout(),this.pushBuffer.push(r),this.pushBuffer.length>w5){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(r,s,u){return s}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,s,u){var m,v;const T=r.toLocaleLowerCase(),{close:a,error:R,leave:O,join:B}=fl;if(u&&[a,R,O,B].indexOf(T)>=0&&u!==this._joinRef())return;let q=this._onMessage(T,s,u);if(s&&!q)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(T)?(m=this.bindings.postgres_changes)===null||m===void 0||m.filter(ee=>{var re,J,_e;return((re=ee.filter)===null||re===void 0?void 0:re.event)==="*"||((_e=(J=ee.filter)===null||J===void 0?void 0:J.event)===null||_e===void 0?void 0:_e.toLocaleLowerCase())===T}).map(ee=>ee.callback(q,u)):(v=this.bindings[T])===null||v===void 0||v.filter(ee=>{var re,J,_e,pe,ue,ie;if(["broadcast","presence","postgres_changes"].includes(T))if("id"in ee){const ke=ee.id,at=(re=ee.filter)===null||re===void 0?void 0:re.event;return ke&&((J=s.ids)===null||J===void 0?void 0:J.includes(ke))&&(at==="*"||(at==null?void 0:at.toLocaleLowerCase())===((_e=s.data)===null||_e===void 0?void 0:_e.type.toLocaleLowerCase()))}else{const ke=(ue=(pe=ee==null?void 0:ee.filter)===null||pe===void 0?void 0:pe.event)===null||ue===void 0?void 0:ue.toLocaleLowerCase();return ke==="*"||ke===((ie=s==null?void 0:s.event)===null||ie===void 0?void 0:ie.toLocaleLowerCase())}else return ee.type.toLocaleLowerCase()===T}).map(ee=>{if(typeof q=="object"&&"ids"in q){const re=q.data,{schema:J,table:_e,commit_timestamp:pe,type:ue,errors:ie}=re;q=Object.assign(Object.assign({},{schema:J,table:_e,commit_timestamp:pe,eventType:ue,new:{},old:{},errors:ie}),this._getPayloadRecords(re))}ee.callback(q,u)})}_isClosed(){return this.state===Es.closed}_isJoined(){return this.state===Es.joined}_isJoining(){return this.state===Es.joining}_isLeaving(){return this.state===Es.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,s,u){const m=r.toLocaleLowerCase(),v={type:m,filter:s,callback:u};return this.bindings[m]?this.bindings[m].push(v):this.bindings[m]=[v],this}_off(r,s){const u=r.toLocaleLowerCase();return this.bindings[u]&&(this.bindings[u]=this.bindings[u].filter(m=>{var v;return!(((v=m.type)===null||v===void 0?void 0:v.toLocaleLowerCase())===u&&kS.isEqual(m.filter,s))})),this}static isEqual(r,s){if(Object.keys(r).length!==Object.keys(s).length)return!1;for(const u in r)if(r[u]!==s[u])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(fl.close,{},r)}_onError(r){this._on(fl.error,{},s=>r(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Es.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const s={new:{},old:{}};return(r.type==="INSERT"||r.type==="UPDATE")&&(s.new=o3(r.columns,r.record)),(r.type==="UPDATE"||r.type==="DELETE")&&(s.old=o3(r.columns,r.old_record)),s}}const c2=()=>{},Xx={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},P5=[1e3,2e3,5e3,1e4],k5=1e4,R5=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class M5{constructor(r,s){var u;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_T,this.transport=null,this.heartbeatIntervalMs=Xx.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=c2,this.ref=0,this.reconnectTimer=null,this.logger=c2,this.conn=null,this.sendBuffer=[],this.serializer=new b5,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=m=>{let v;return m?v=m:typeof fetch>"u"?v=(...T)=>Bd(async()=>{const{default:a}=await Promise.resolve().then(()=>_m);return{default:a}},void 0).then(({default:a})=>a(...T)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):v=fetch,(...T)=>v(...T)},!(!((u=s==null?void 0:s.params)===null||u===void 0)&&u.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${r}/${yT.websocket}`,this.httpEndpoint=FM(r),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=g5.createWebSocket(this.endpointURL())}catch(r){this._setConnectionState("disconnected");const s=r.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:x5}))}disconnect(r,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const u=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(u),this._setConnectionState("disconnected")},r?this.conn.close(r,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(r){const s=await r.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const r=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),r}log(r,s,u){this.logger(r,s,u)}connectionState(){switch(this.conn&&this.conn.readyState){case Gg.connecting:return xd.Connecting;case Gg.open:return xd.Open;case Gg.closing:return xd.Closing;default:return xd.Closed}}isConnected(){return this.connectionState()===xd.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(r,s={config:{}}){const u=`realtime:${r}`,m=this.getChannels().find(v=>v.topic===u);if(m)return m;{const v=new kS(`realtime:${r}`,s,this);return this.channels.push(v),v}}push(r){const{topic:s,event:u,payload:m,ref:v}=r,T=()=>{this.encode(r,a=>{var R;(R=this.conn)===null||R===void 0||R.send(a)})};this.log("push",`${s} ${u} (${v})`,m),this.isConnected()?T():this.sendBuffer.push(T)}async setAuth(r=null){this._authPromise=this._performAuth(r);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var r;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(r=this.conn)===null||r===void 0||r.close(v5,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Xx.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(r){this.heartbeatCallback=r}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return r===this.ref?this.ref=0:this.ref=r,this.ref.toString()}_leaveOpenTopic(r){let s=this.channels.find(u=>u.topic===r&&(u._isJoined()||u._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${r}"`),s.unsubscribe())}_remove(r){this.channels=this.channels.filter(s=>s.topic!==r.topic)}_onConnMessage(r){this.decode(r.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(O){this.log("error","error in heartbeat callback",O)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:u,event:m,payload:v,ref:T}=s,a=T?`(${T})`:"",R=v.status||"";this.log("receive",`${R} ${u} ${m} ${a}`.trim(),v),this.channels.filter(O=>O._isMember(u)).forEach(O=>O._trigger(m,v,T)),this._triggerStateCallbacks("message",s)})}_clearTimer(r){var s;r==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):r==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(r=>r.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const r=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(r),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(r){var s;this._setConnectionState("disconnected"),this.log("transport","close",r),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",r)}_onConnError(r){this._setConnectionState("disconnected"),this.log("transport",`${r}`),this._triggerChanError(),this._triggerStateCallbacks("error",r)}_triggerChanError(){this.channels.forEach(r=>r._trigger(fl.error))}_appendParams(r,s){if(Object.keys(s).length===0)return r;const u=r.match(/\?/)?"&":"?",m=new URLSearchParams(s);return`${r}${u}${m}`}_workerObjectUrl(r){let s;if(r)s=r;else{const u=new Blob([R5],{type:"application/javascript"});s=URL.createObjectURL(u)}return s}_setConnectionState(r,s=!1){this._connectionState=r,r==="connecting"?this._wasManualDisconnect=!1:r==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(r=null){let s;r?s=r:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(u=>{const m={access_token:s,version:y5};s&&u.updateJoinPayload(m),u.joinedOnce&&u._isJoined()&&u._push(fl.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(r="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${r}`,s)})}_triggerStateCallbacks(r,s){try{this.stateChangeCallbacks[r].forEach(u=>{try{u(s)}catch(m){this.log("error",`error in ${r} callback`,m)}})}catch(u){this.log("error",`error triggering ${r} callbacks`,u)}}_setupReconnectionTimer(){this.reconnectTimer=new OM(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Xx.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(r){var s,u,m,v,T,a,R,O,B;if(this.transport=(s=r==null?void 0:r.transport)!==null&&s!==void 0?s:null,this.timeout=(u=r==null?void 0:r.timeout)!==null&&u!==void 0?u:_T,this.heartbeatIntervalMs=(m=r==null?void 0:r.heartbeatIntervalMs)!==null&&m!==void 0?m:Xx.HEARTBEAT_INTERVAL,this.worker=(v=r==null?void 0:r.worker)!==null&&v!==void 0?v:!1,this.accessToken=(T=r==null?void 0:r.accessToken)!==null&&T!==void 0?T:null,this.heartbeatCallback=(a=r==null?void 0:r.heartbeatCallback)!==null&&a!==void 0?a:c2,r!=null&&r.params&&(this.params=r.params),r!=null&&r.logger&&(this.logger=r.logger),(r!=null&&r.logLevel||r!=null&&r.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(R=r==null?void 0:r.reconnectAfterMs)!==null&&R!==void 0?R:H=>P5[H-1]||k5,this.encode=(O=r==null?void 0:r.encode)!==null&&O!==void 0?O:(H,q)=>q(JSON.stringify(H)),this.decode=(B=r==null?void 0:r.decode)!==null&&B!==void 0?B:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=r==null?void 0:r.workerUrl}}}class RS extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function Is(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class D5 extends RS{constructor(r,s,u){super(r),this.name="StorageApiError",this.status=s,this.statusCode=u}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class vT extends RS{constructor(r,s){super(r),this.name="StorageUnknownError",this.originalError=s}}var O5=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};const NM=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Bd(async()=>{const{default:u}=await Promise.resolve().then(()=>_m);return{default:u}},void 0).then(({default:u})=>u(...s)):r=fetch,(...s)=>r(...s)},L5=()=>O5(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Bd(()=>Promise.resolve().then(()=>_m),void 0)).Response:Response}),wT=t=>{if(Array.isArray(t))return t.map(s=>wT(s));if(typeof t=="function"||t!==Object(t))return t;const r={};return Object.entries(t).forEach(([s,u])=>{const m=s.replace(/([-_][a-z])/gi,v=>v.toUpperCase().replace(/[-_]/g,""));r[m]=wT(u)}),r},F5=t=>{if(typeof t!="object"||t===null)return!1;const r=Object.getPrototypeOf(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var jd=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};const u2=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),N5=(t,r,s)=>jd(void 0,void 0,void 0,function*(){const u=yield L5();t instanceof u&&!(s!=null&&s.noResolveJson)?t.json().then(m=>{const v=t.status||500,T=(m==null?void 0:m.statusCode)||v+"";r(new D5(u2(m),v,T))}).catch(m=>{r(new vT(u2(m),m))}):r(new vT(u2(t),t))}),z5=(t,r,s,u)=>{const m={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"||!u?m:(F5(u)?(m.headers=Object.assign({"Content-Type":"application/json"},r==null?void 0:r.headers),m.body=JSON.stringify(u)):m.body=u,r!=null&&r.duplex&&(m.duplex=r.duplex),Object.assign(Object.assign({},m),s))};function M_(t,r,s,u,m,v){return jd(this,void 0,void 0,function*(){return new Promise((T,a)=>{t(s,z5(r,u,m,v)).then(R=>{if(!R.ok)throw R;return u!=null&&u.noResolveJson?R:R.json()}).then(R=>T(R)).catch(R=>N5(R,a,u))})})}function Gv(t,r,s,u){return jd(this,void 0,void 0,function*(){return M_(t,"GET",r,s,u)})}function tc(t,r,s,u,m){return jd(this,void 0,void 0,function*(){return M_(t,"POST",r,u,m,s)})}function bT(t,r,s,u,m){return jd(this,void 0,void 0,function*(){return M_(t,"PUT",r,u,m,s)})}function B5(t,r,s,u){return jd(this,void 0,void 0,function*(){return M_(t,"HEAD",r,Object.assign(Object.assign({},s),{noResolveJson:!0}),u)})}function zM(t,r,s,u,m){return jd(this,void 0,void 0,function*(){return M_(t,"DELETE",r,u,m,s)})}var ko=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};const j5={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},c3={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class U5{constructor(r,s={},u,m){this.shouldThrowOnError=!1,this.url=r,this.headers=s,this.bucketId=u,this.fetch=NM(m)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(r,s,u,m){return ko(this,void 0,void 0,function*(){try{let v;const T=Object.assign(Object.assign({},c3),m);let a=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(T.upsert)});const R=T.metadata;typeof Blob<"u"&&u instanceof Blob?(v=new FormData,v.append("cacheControl",T.cacheControl),R&&v.append("metadata",this.encodeMetadata(R)),v.append("",u)):typeof FormData<"u"&&u instanceof FormData?(v=u,v.append("cacheControl",T.cacheControl),R&&v.append("metadata",this.encodeMetadata(R))):(v=u,a["cache-control"]=`max-age=${T.cacheControl}`,a["content-type"]=T.contentType,R&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(R)))),m!=null&&m.headers&&(a=Object.assign(Object.assign({},a),m.headers));const O=this._removeEmptyFolders(s),B=this._getFinalPath(O),H=yield(r=="PUT"?bT:tc)(this.fetch,`${this.url}/object/${B}`,v,Object.assign({headers:a},T!=null&&T.duplex?{duplex:T.duplex}:{}));return{data:{path:O,id:H.Id,fullPath:H.Key},error:null}}catch(v){if(this.shouldThrowOnError)throw v;if(Is(v))return{data:null,error:v};throw v}})}upload(r,s,u){return ko(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,s,u)})}uploadToSignedUrl(r,s,u,m){return ko(this,void 0,void 0,function*(){const v=this._removeEmptyFolders(r),T=this._getFinalPath(v),a=new URL(this.url+`/object/upload/sign/${T}`);a.searchParams.set("token",s);try{let R;const O=Object.assign({upsert:c3.upsert},m),B=Object.assign(Object.assign({},this.headers),{"x-upsert":String(O.upsert)});typeof Blob<"u"&&u instanceof Blob?(R=new FormData,R.append("cacheControl",O.cacheControl),R.append("",u)):typeof FormData<"u"&&u instanceof FormData?(R=u,R.append("cacheControl",O.cacheControl)):(R=u,B["cache-control"]=`max-age=${O.cacheControl}`,B["content-type"]=O.contentType);const H=yield bT(this.fetch,a.toString(),R,{headers:B});return{data:{path:v,fullPath:H.Key},error:null}}catch(R){if(this.shouldThrowOnError)throw R;if(Is(R))return{data:null,error:R};throw R}})}createSignedUploadUrl(r,s){return ko(this,void 0,void 0,function*(){try{let u=this._getFinalPath(r);const m=Object.assign({},this.headers);s!=null&&s.upsert&&(m["x-upsert"]="true");const v=yield tc(this.fetch,`${this.url}/object/upload/sign/${u}`,{},{headers:m}),T=new URL(this.url+v.url),a=T.searchParams.get("token");if(!a)throw new RS("No token returned by API");return{data:{signedUrl:T.toString(),path:r,token:a},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u))return{data:null,error:u};throw u}})}update(r,s,u){return ko(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,s,u)})}move(r,s,u){return ko(this,void 0,void 0,function*(){try{return{data:yield tc(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:s,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers}),error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Is(m))return{data:null,error:m};throw m}})}copy(r,s,u){return ko(this,void 0,void 0,function*(){try{return{data:{path:(yield tc(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:s,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers})).Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Is(m))return{data:null,error:m};throw m}})}createSignedUrl(r,s,u){return ko(this,void 0,void 0,function*(){try{let m=this._getFinalPath(r),v=yield tc(this.fetch,`${this.url}/object/sign/${m}`,Object.assign({expiresIn:s},u!=null&&u.transform?{transform:u.transform}:{}),{headers:this.headers});const T=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return v={signedUrl:encodeURI(`${this.url}${v.signedURL}${T}`)},{data:v,error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Is(m))return{data:null,error:m};throw m}})}createSignedUrls(r,s,u){return ko(this,void 0,void 0,function*(){try{const m=yield tc(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:r},{headers:this.headers}),v=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return{data:m.map(T=>Object.assign(Object.assign({},T),{signedUrl:T.signedURL?encodeURI(`${this.url}${T.signedURL}${v}`):null})),error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Is(m))return{data:null,error:m};throw m}})}download(r,s){return ko(this,void 0,void 0,function*(){const m=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",v=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),T=v?`?${v}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield Gv(this.fetch,`${this.url}/${m}/${a}${T}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Is(a))return{data:null,error:a};throw a}})}info(r){return ko(this,void 0,void 0,function*(){const s=this._getFinalPath(r);try{const u=yield Gv(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:wT(u),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u))return{data:null,error:u};throw u}})}exists(r){return ko(this,void 0,void 0,function*(){const s=this._getFinalPath(r);try{return yield B5(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u)&&u instanceof vT){const m=u.originalError;if([400,404].includes(m==null?void 0:m.status))return{data:!1,error:u}}throw u}})}getPublicUrl(r,s){const u=this._getFinalPath(r),m=[],v=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";v!==""&&m.push(v);const a=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",R=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});R!==""&&m.push(R);let O=m.join("&");return O!==""&&(O=`?${O}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${u}${O}`)}}}remove(r){return ko(this,void 0,void 0,function*(){try{return{data:yield zM(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Is(s))return{data:null,error:s};throw s}})}list(r,s,u){return ko(this,void 0,void 0,function*(){try{const m=Object.assign(Object.assign(Object.assign({},j5),s),{prefix:r||""});return{data:yield tc(this.fetch,`${this.url}/object/list/${this.bucketId}`,m,{headers:this.headers},u),error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Is(m))return{data:null,error:m};throw m}})}listV2(r,s){return ko(this,void 0,void 0,function*(){try{const u=Object.assign({},r);return{data:yield tc(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,u,{headers:this.headers},s),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u))return{data:null,error:u};throw u}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const s=[];return r.width&&s.push(`width=${r.width}`),r.height&&s.push(`height=${r.height}`),r.resize&&s.push(`resize=${r.resize}`),r.format&&s.push(`format=${r.format}`),r.quality&&s.push(`quality=${r.quality}`),s.join("&")}}const V5="2.12.1",$5={"X-Client-Info":`storage-js/${V5}`};var Sp=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};class G5{constructor(r,s={},u,m){this.shouldThrowOnError=!1;const v=new URL(r);m!=null&&m.useNewHostname&&/supabase\.(co|in|red)$/.test(v.hostname)&&!v.hostname.includes("storage.supabase.")&&(v.hostname=v.hostname.replace("supabase.","storage.supabase.")),this.url=v.href,this.headers=Object.assign(Object.assign({},$5),s),this.fetch=NM(u)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Sp(this,void 0,void 0,function*(){try{return{data:yield Gv(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Is(r))return{data:null,error:r};throw r}})}getBucket(r){return Sp(this,void 0,void 0,function*(){try{return{data:yield Gv(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Is(s))return{data:null,error:s};throw s}})}createBucket(r,s={public:!1}){return Sp(this,void 0,void 0,function*(){try{return{data:yield tc(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u))return{data:null,error:u};throw u}})}updateBucket(r,s){return Sp(this,void 0,void 0,function*(){try{return{data:yield bT(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Is(u))return{data:null,error:u};throw u}})}emptyBucket(r){return Sp(this,void 0,void 0,function*(){try{return{data:yield tc(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Is(s))return{data:null,error:s};throw s}})}deleteBucket(r){return Sp(this,void 0,void 0,function*(){try{return{data:yield zM(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Is(s))return{data:null,error:s};throw s}})}}class H5 extends G5{constructor(r,s={},u,m){super(r,s,u,m)}from(r){return new U5(this.url,this.headers,r,this.fetch)}}const W5="2.57.4";let Mg="";typeof Deno<"u"?Mg="deno":typeof document<"u"?Mg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Mg="react-native":Mg="node";const q5={"X-Client-Info":`supabase-js-${Mg}/${W5}`},Z5={headers:q5},X5={schema:"public"},K5={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Y5={};var J5=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};const Q5=t=>{let r;return t?r=t:typeof fetch>"u"?r=TM:r=fetch,(...s)=>r(...s)},e6=()=>typeof Headers>"u"?SM:Headers,t6=(t,r,s)=>{const u=Q5(s),m=e6();return(v,T)=>J5(void 0,void 0,void 0,function*(){var a;const R=(a=yield r())!==null&&a!==void 0?a:t;let O=new m(T==null?void 0:T.headers);return O.has("apikey")||O.set("apikey",t),O.has("Authorization")||O.set("Authorization",`Bearer ${R}`),u(v,Object.assign(Object.assign({},T),{headers:O}))})};var r6=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};function i6(t){return t.endsWith("/")?t:t+"/"}function n6(t,r){var s,u;const{db:m,auth:v,realtime:T,global:a}=t,{db:R,auth:O,realtime:B,global:H}=r,q={db:Object.assign(Object.assign({},R),m),auth:Object.assign(Object.assign({},O),v),realtime:Object.assign(Object.assign({},B),T),storage:{},global:Object.assign(Object.assign(Object.assign({},H),a),{headers:Object.assign(Object.assign({},(s=H==null?void 0:H.headers)!==null&&s!==void 0?s:{}),(u=a==null?void 0:a.headers)!==null&&u!==void 0?u:{})}),accessToken:()=>r6(this,void 0,void 0,function*(){return""})};return t.accessToken?q.accessToken=t.accessToken:delete q.accessToken,q}function s6(t){const r=t==null?void 0:t.trim();if(!r)throw new Error("supabaseUrl is required.");if(!r.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(i6(r))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const BM="2.71.1",Mp=30*1e3,TT=3,h2=TT*Mp,o6="http://localhost:9999",a6="supabase.auth.token",l6={"X-Client-Info":`gotrue-js/${BM}`},ST="X-Supabase-Api-Version",jM={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},c6=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,u6=10*60*1e3;class MS extends Error{constructor(r,s,u){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=u}}function Ri(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class h6 extends MS{constructor(r,s,u){super(r,s,u),this.name="AuthApiError",this.status=s,this.code=u}}function d6(t){return Ri(t)&&t.name==="AuthApiError"}class UM extends MS{constructor(r,s){super(r),this.name="AuthUnknownError",this.originalError=s}}class vh extends MS{constructor(r,s,u,m){super(r,u,m),this.name=s,this.status=u}}class Zu extends vh{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function f6(t){return Ri(t)&&t.name==="AuthSessionMissingError"}class Kx extends vh{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Yx extends vh{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class Jx extends vh{constructor(r,s=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function p6(t){return Ri(t)&&t.name==="AuthImplicitGrantRedirectError"}class u3 extends vh{constructor(r,s=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ET extends vh{constructor(r,s){super(r,"AuthRetryableFetchError",s,void 0)}}function d2(t){return Ri(t)&&t.name==="AuthRetryableFetchError"}class h3 extends vh{constructor(r,s,u){super(r,"AuthWeakPasswordError",s,"weak_password"),this.reasons=u}}class AT extends vh{constructor(r){super(r,"AuthInvalidJwtError",400,"invalid_jwt")}}const Hv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),d3=` 	
\r=`.split(""),m6=(()=>{const t=new Array(128);for(let r=0;r<t.length;r+=1)t[r]=-1;for(let r=0;r<d3.length;r+=1)t[d3[r].charCodeAt(0)]=-2;for(let r=0;r<Hv.length;r+=1)t[Hv[r].charCodeAt(0)]=r;return t})();function f3(t,r,s){if(t!==null)for(r.queue=r.queue<<8|t,r.queuedBits+=8;r.queuedBits>=6;){const u=r.queue>>r.queuedBits-6&63;s(Hv[u]),r.queuedBits-=6}else if(r.queuedBits>0)for(r.queue=r.queue<<6-r.queuedBits,r.queuedBits=6;r.queuedBits>=6;){const u=r.queue>>r.queuedBits-6&63;s(Hv[u]),r.queuedBits-=6}}function VM(t,r,s){const u=m6[t];if(u>-1)for(r.queue=r.queue<<6|u,r.queuedBits+=6;r.queuedBits>=8;)s(r.queue>>r.queuedBits-8&255),r.queuedBits-=8;else{if(u===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function p3(t){const r=[],s=T=>{r.push(String.fromCodePoint(T))},u={utf8seq:0,codepoint:0},m={queue:0,queuedBits:0},v=T=>{y6(T,u,s)};for(let T=0;T<t.length;T+=1)VM(t.charCodeAt(T),m,v);return r.join("")}function g6(t,r){if(t<=127){r(t);return}else if(t<=2047){r(192|t>>6),r(128|t&63);return}else if(t<=65535){r(224|t>>12),r(128|t>>6&63),r(128|t&63);return}else if(t<=1114111){r(240|t>>18),r(128|t>>12&63),r(128|t>>6&63),r(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function _6(t,r){for(let s=0;s<t.length;s+=1){let u=t.charCodeAt(s);if(u>55295&&u<=56319){const m=(u-55296)*1024&65535;u=(t.charCodeAt(s+1)-56320&65535|m)+65536,s+=1}g6(u,r)}}function y6(t,r,s){if(r.utf8seq===0){if(t<=127){s(t);return}for(let u=1;u<6;u+=1)if(!(t>>7-u&1)){r.utf8seq=u;break}if(r.utf8seq===2)r.codepoint=t&31;else if(r.utf8seq===3)r.codepoint=t&15;else if(r.utf8seq===4)r.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");r.utf8seq-=1}else if(r.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");r.codepoint=r.codepoint<<6|t&63,r.utf8seq-=1,r.utf8seq===0&&s(r.codepoint)}}function x6(t){const r=[],s={queue:0,queuedBits:0},u=m=>{r.push(m)};for(let m=0;m<t.length;m+=1)VM(t.charCodeAt(m),s,u);return new Uint8Array(r)}function v6(t){const r=[];return _6(t,s=>r.push(s)),new Uint8Array(r)}function w6(t){const r=[],s={queue:0,queuedBits:0},u=m=>{r.push(m)};return t.forEach(m=>f3(m,s,u)),f3(null,s,u),r.join("")}function b6(t){return Math.round(Date.now()/1e3)+t}function T6(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=Math.random()*16|0;return(t=="x"?r:r&3|8).toString(16)})}const ul=()=>typeof window<"u"&&typeof document<"u",pd={tested:!1,writable:!1},$M=()=>{if(!ul())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(pd.tested)return pd.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),pd.tested=!0,pd.writable=!0}catch{pd.tested=!0,pd.writable=!1}return pd.writable};function S6(t){const r={},s=new URL(t);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((m,v)=>{r[v]=m})}catch{}return s.searchParams.forEach((u,m)=>{r[m]=u}),r}const GM=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Bd(async()=>{const{default:u}=await Promise.resolve().then(()=>_m);return{default:u}},void 0).then(({default:u})=>u(...s)):r=fetch,(...s)=>r(...s)},E6=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Dp=async(t,r,s)=>{await t.setItem(r,JSON.stringify(s))},md=async(t,r)=>{const s=await t.getItem(r);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Wu=async(t,r)=>{await t.removeItem(r)};class C1{constructor(){this.promise=new C1.promiseConstructor((r,s)=>{this.resolve=r,this.reject=s})}}C1.promiseConstructor=Promise;function f2(t){const r=t.split(".");if(r.length!==3)throw new AT("Invalid JWT structure");for(let u=0;u<r.length;u++)if(!c6.test(r[u]))throw new AT("JWT not in base64url format");return{header:JSON.parse(p3(r[0])),payload:JSON.parse(p3(r[1])),signature:x6(r[2]),raw:{header:r[0],payload:r[1]}}}async function A6(t){return await new Promise(r=>{setTimeout(()=>r(null),t)})}function I6(t,r){return new Promise((u,m)=>{(async()=>{for(let v=0;v<1/0;v++)try{const T=await t(v);if(!r(v,null,T)){u(T);return}}catch(T){if(!r(v,T)){m(T);return}}})()})}function C6(t){return("0"+t.toString(16)).substr(-2)}function P6(){const r=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",u=s.length;let m="";for(let v=0;v<56;v++)m+=s.charAt(Math.floor(Math.random()*u));return m}return crypto.getRandomValues(r),Array.from(r,C6).join("")}async function k6(t){const s=new TextEncoder().encode(t),u=await crypto.subtle.digest("SHA-256",s),m=new Uint8Array(u);return Array.from(m).map(v=>String.fromCharCode(v)).join("")}async function R6(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=await k6(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ep(t,r,s=!1){const u=P6();let m=u;s&&(m+="/PASSWORD_RECOVERY"),await Dp(t,`${r}-code-verifier`,m);const v=await R6(u);return[v,u===v?"plain":"s256"]}const M6=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function D6(t){const r=t.headers.get(ST);if(!r||!r.match(M6))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}function O6(t){if(!t)throw new Error("Missing exp claim");const r=Math.floor(Date.now()/1e3);if(t<=r)throw new Error("JWT has expired")}function L6(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const F6=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ap(t){if(!F6.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function p2(){const t={};return new Proxy(t,{get:(r,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const u=s.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(r,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(r,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function m3(t){return JSON.parse(JSON.stringify(t))}var N6=function(t,r){var s={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&r.indexOf(u)<0&&(s[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,u=Object.getOwnPropertySymbols(t);m<u.length;m++)r.indexOf(u[m])<0&&Object.prototype.propertyIsEnumerable.call(t,u[m])&&(s[u[m]]=t[u[m]]);return s};const yd=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),z6=[502,503,504];async function g3(t){var r;if(!E6(t))throw new ET(yd(t),0);if(z6.includes(t.status))throw new ET(yd(t),t.status);let s;try{s=await t.json()}catch(v){throw new UM(yd(v),v)}let u;const m=D6(t);if(m&&m.getTime()>=jM["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?u=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(u=s.error_code),u){if(u==="weak_password")throw new h3(yd(s),t.status,((r=s.weak_password)===null||r===void 0?void 0:r.reasons)||[]);if(u==="session_not_found")throw new Zu}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((v,T)=>v&&typeof T=="string",!0))throw new h3(yd(s),t.status,s.weak_password.reasons);throw new h6(yd(s),t.status||500,u)}const B6=(t,r,s,u)=>{const m={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"?m:(m.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},r==null?void 0:r.headers),m.body=JSON.stringify(u),Object.assign(Object.assign({},m),s))};async function Zi(t,r,s,u){var m;const v=Object.assign({},u==null?void 0:u.headers);v[ST]||(v[ST]=jM["2024-01-01"].name),u!=null&&u.jwt&&(v.Authorization=`Bearer ${u.jwt}`);const T=(m=u==null?void 0:u.query)!==null&&m!==void 0?m:{};u!=null&&u.redirectTo&&(T.redirect_to=u.redirectTo);const a=Object.keys(T).length?"?"+new URLSearchParams(T).toString():"",R=await j6(t,r,s+a,{headers:v,noResolveJson:u==null?void 0:u.noResolveJson},{},u==null?void 0:u.body);return u!=null&&u.xform?u==null?void 0:u.xform(R):{data:Object.assign({},R),error:null}}async function j6(t,r,s,u,m,v){const T=B6(r,u,m,v);let a;try{a=await t(s,Object.assign({},T))}catch(R){throw console.error(R),new ET(yd(R),0)}if(a.ok||await g3(a),u!=null&&u.noResolveJson)return a;try{return await a.json()}catch(R){await g3(R)}}function Lc(t){var r;let s=null;G6(t)&&(s=Object.assign({},t),t.expires_at||(s.expires_at=b6(t.expires_in)));const u=(r=t.user)!==null&&r!==void 0?r:t;return{data:{session:s,user:u},error:null}}function _3(t){const r=Lc(t);return!r.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((s,u)=>s&&typeof u=="string",!0)&&(r.data.weak_password=t.weak_password),r}function Qu(t){var r;return{data:{user:(r=t.user)!==null&&r!==void 0?r:t},error:null}}function U6(t){return{data:t,error:null}}function V6(t){const{action_link:r,email_otp:s,hashed_token:u,redirect_to:m,verification_type:v}=t,T=N6(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:r,email_otp:s,hashed_token:u,redirect_to:m,verification_type:v},R=Object.assign({},T);return{data:{properties:a,user:R},error:null}}function $6(t){return t}function G6(t){return t.access_token&&t.refresh_token&&t.expires_in}const m2=["global","local","others"];var H6=function(t,r){var s={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&r.indexOf(u)<0&&(s[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,u=Object.getOwnPropertySymbols(t);m<u.length;m++)r.indexOf(u[m])<0&&Object.prototype.propertyIsEnumerable.call(t,u[m])&&(s[u[m]]=t[u[m]]);return s};class W6{constructor({url:r="",headers:s={},fetch:u}){this.url=r,this.headers=s,this.fetch=GM(u),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(r,s=m2[0]){if(m2.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${m2.join(", ")}`);try{return await Zi(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(u){if(Ri(u))return{data:null,error:u};throw u}}async inviteUserByEmail(r,s={}){try{return await Zi(this.fetch,"POST",`${this.url}/invite`,{body:{email:r,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Qu})}catch(u){if(Ri(u))return{data:{user:null},error:u};throw u}}async generateLink(r){try{const{options:s}=r,u=H6(r,["options"]),m=Object.assign(Object.assign({},u),s);return"newEmail"in u&&(m.new_email=u==null?void 0:u.newEmail,delete m.newEmail),await Zi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:m,headers:this.headers,xform:V6,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(Ri(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(r){try{return await Zi(this.fetch,"POST",`${this.url}/admin/users`,{body:r,headers:this.headers,xform:Qu})}catch(s){if(Ri(s))return{data:{user:null},error:s};throw s}}async listUsers(r){var s,u,m,v,T,a,R;try{const O={nextPage:null,lastPage:0,total:0},B=await Zi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(u=(s=r==null?void 0:r.page)===null||s===void 0?void 0:s.toString())!==null&&u!==void 0?u:"",per_page:(v=(m=r==null?void 0:r.perPage)===null||m===void 0?void 0:m.toString())!==null&&v!==void 0?v:""},xform:$6});if(B.error)throw B.error;const H=await B.json(),q=(T=B.headers.get("x-total-count"))!==null&&T!==void 0?T:0,ee=(R=(a=B.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&R!==void 0?R:[];return ee.length>0&&(ee.forEach(re=>{const J=parseInt(re.split(";")[0].split("=")[1].substring(0,1)),_e=JSON.parse(re.split(";")[1].split("=")[1]);O[`${_e}Page`]=J}),O.total=parseInt(q)),{data:Object.assign(Object.assign({},H),O),error:null}}catch(O){if(Ri(O))return{data:{users:[]},error:O};throw O}}async getUserById(r){Ap(r);try{return await Zi(this.fetch,"GET",`${this.url}/admin/users/${r}`,{headers:this.headers,xform:Qu})}catch(s){if(Ri(s))return{data:{user:null},error:s};throw s}}async updateUserById(r,s){Ap(r);try{return await Zi(this.fetch,"PUT",`${this.url}/admin/users/${r}`,{body:s,headers:this.headers,xform:Qu})}catch(u){if(Ri(u))return{data:{user:null},error:u};throw u}}async deleteUser(r,s=!1){Ap(r);try{return await Zi(this.fetch,"DELETE",`${this.url}/admin/users/${r}`,{headers:this.headers,body:{should_soft_delete:s},xform:Qu})}catch(u){if(Ri(u))return{data:{user:null},error:u};throw u}}async _listFactors(r){Ap(r.userId);try{const{data:s,error:u}=await Zi(this.fetch,"GET",`${this.url}/admin/users/${r.userId}/factors`,{headers:this.headers,xform:m=>({data:{factors:m},error:null})});return{data:s,error:u}}catch(s){if(Ri(s))return{data:null,error:s};throw s}}async _deleteFactor(r){Ap(r.userId),Ap(r.id);try{return{data:await Zi(this.fetch,"DELETE",`${this.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:this.headers}),error:null}}catch(s){if(Ri(s))return{data:null,error:s};throw s}}}function y3(t={}){return{getItem:r=>t[r]||null,setItem:(r,s)=>{t[r]=s},removeItem:r=>{delete t[r]}}}function q6(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ip={debug:!!(globalThis&&$M()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class HM extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class Z6 extends HM{}async function X6(t,r,s){Ip.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,r);const u=new globalThis.AbortController;return r>0&&setTimeout(()=>{u.abort(),Ip.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},r),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,r===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:u.signal},async m=>{if(m){Ip.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,m.name);try{return await s()}finally{Ip.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,m.name)}}else{if(r===0)throw Ip.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Z6(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Ip.debug)try{const v=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(v,null,"  "))}catch(v){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",v)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}q6();const K6={url:o6,storageKey:a6,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:l6,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function x3(t,r,s){return await s()}const Cp={};class g_{constructor(r){var s,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=g_.nextInstanceID,g_.nextInstanceID+=1,this.instanceID>0&&ul()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const m=Object.assign(Object.assign({},K6),r);if(this.logDebugMessages=!!m.debug,typeof m.debug=="function"&&(this.logger=m.debug),this.persistSession=m.persistSession,this.storageKey=m.storageKey,this.autoRefreshToken=m.autoRefreshToken,this.admin=new W6({url:m.url,headers:m.headers,fetch:m.fetch}),this.url=m.url,this.headers=m.headers,this.fetch=GM(m.fetch),this.lock=m.lock||x3,this.detectSessionInUrl=m.detectSessionInUrl,this.flowType=m.flowType,this.hasCustomAuthorizationHeader=m.hasCustomAuthorizationHeader,m.lock?this.lock=m.lock:ul()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=X6:this.lock=x3,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(m.storage?this.storage=m.storage:$M()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=y3(this.memoryStorage)),m.userStorage&&(this.userStorage=m.userStorage)):(this.memoryStorage={},this.storage=y3(this.memoryStorage)),ul()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(v){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",v)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async v=>{this._debug("received broadcast notification from other tab or client",v),await this._notifyAllSubscribers(v.data.event,v.data.session,!1)})}this.initialize()}get jwks(){var r,s;return(s=(r=Cp[this.storageKey])===null||r===void 0?void 0:r.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(r){Cp[this.storageKey]=Object.assign(Object.assign({},Cp[this.storageKey]),{jwks:r})}get jwks_cached_at(){var r,s;return(s=(r=Cp[this.storageKey])===null||r===void 0?void 0:r.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(r){Cp[this.storageKey]=Object.assign(Object.assign({},Cp[this.storageKey]),{cachedAt:r})}_debug(...r){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${BM}) ${new Date().toISOString()}`,...r),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var r;try{const s=S6(window.location.href);let u="none";if(this._isImplicitGrantCallback(s)?u="implicit":await this._isPKCECallback(s)&&(u="pkce"),ul()&&this.detectSessionInUrl&&u!=="none"){const{data:m,error:v}=await this._getSessionFromURL(s,u);if(v){if(this._debug("#_initialize()","error detecting session from URL",v),p6(v)){const R=(r=v.details)===null||r===void 0?void 0:r.code;if(R==="identity_already_exists"||R==="identity_not_found"||R==="single_identity_not_deletable")return{error:v}}return await this._removeSession(),{error:v}}const{session:T,redirectType:a}=m;return this._debug("#_initialize()","detected session in URL",T,"redirect type",a),await this._saveSession(T),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",T):await this._notifyAllSubscribers("SIGNED_IN",T)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Ri(s)?{error:s}:{error:new UM("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(r){var s,u,m;try{const v=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(u=(s=r==null?void 0:r.options)===null||s===void 0?void 0:s.data)!==null&&u!==void 0?u:{},gotrue_meta_security:{captcha_token:(m=r==null?void 0:r.options)===null||m===void 0?void 0:m.captchaToken}},xform:Lc}),{data:T,error:a}=v;if(a||!T)return{data:{user:null,session:null},error:a};const R=T.session,O=T.user;return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",R)),{data:{user:O,session:R},error:null}}catch(v){if(Ri(v))return{data:{user:null,session:null},error:v};throw v}}async signUp(r){var s,u,m;try{let v;if("email"in r){const{email:B,password:H,options:q}=r;let ee=null,re=null;this.flowType==="pkce"&&([ee,re]=await Ep(this.storage,this.storageKey)),v=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:q==null?void 0:q.emailRedirectTo,body:{email:B,password:H,data:(s=q==null?void 0:q.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:q==null?void 0:q.captchaToken},code_challenge:ee,code_challenge_method:re},xform:Lc})}else if("phone"in r){const{phone:B,password:H,options:q}=r;v=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:B,password:H,data:(u=q==null?void 0:q.data)!==null&&u!==void 0?u:{},channel:(m=q==null?void 0:q.channel)!==null&&m!==void 0?m:"sms",gotrue_meta_security:{captcha_token:q==null?void 0:q.captchaToken}},xform:Lc})}else throw new Yx("You must provide either an email or phone number and a password");const{data:T,error:a}=v;if(a||!T)return{data:{user:null,session:null},error:a};const R=T.session,O=T.user;return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",R)),{data:{user:O,session:R},error:null}}catch(v){if(Ri(v))return{data:{user:null,session:null},error:v};throw v}}async signInWithPassword(r){try{let s;if("email"in r){const{email:v,password:T,options:a}=r;s=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:v,password:T,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:_3})}else if("phone"in r){const{phone:v,password:T,options:a}=r;s=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:v,password:T,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:_3})}else throw new Yx("You must provide either an email or phone number and a password");const{data:u,error:m}=s;return m?{data:{user:null,session:null},error:m}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new Kx}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:Object.assign({user:u.user,session:u.session},u.weak_password?{weakPassword:u.weak_password}:null),error:m})}catch(s){if(Ri(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(r){var s,u,m,v;return await this._handleProviderSignIn(r.provider,{redirectTo:(s=r.options)===null||s===void 0?void 0:s.redirectTo,scopes:(u=r.options)===null||u===void 0?void 0:u.scopes,queryParams:(m=r.options)===null||m===void 0?void 0:m.queryParams,skipBrowserRedirect:(v=r.options)===null||v===void 0?void 0:v.skipBrowserRedirect})}async exchangeCodeForSession(r){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(r))}async signInWithWeb3(r){const{chain:s}=r;if(s==="solana")return await this.signInWithSolana(r);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(r){var s,u,m,v,T,a,R,O,B,H,q,ee;let re,J;if("message"in r)re=r.message,J=r.signature;else{const{chain:_e,wallet:pe,statement:ue,options:ie}=r;let ke;if(ul())if(typeof pe=="object")ke=pe;else{const He=window;if("solana"in He&&typeof He.solana=="object"&&("signIn"in He.solana&&typeof He.solana.signIn=="function"||"signMessage"in He.solana&&typeof He.solana.signMessage=="function"))ke=He.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof pe!="object"||!(ie!=null&&ie.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ke=pe}const at=new URL((s=ie==null?void 0:ie.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in ke&&ke.signIn){const He=await ke.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},ie==null?void 0:ie.signInWithSolana),{version:"1",domain:at.host,uri:at.href}),ue?{statement:ue}:null));let De;if(Array.isArray(He)&&He[0]&&typeof He[0]=="object")De=He[0];else if(He&&typeof He=="object"&&"signedMessage"in He&&"signature"in He)De=He;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in De&&"signature"in De&&(typeof De.signedMessage=="string"||De.signedMessage instanceof Uint8Array)&&De.signature instanceof Uint8Array)re=typeof De.signedMessage=="string"?De.signedMessage:new TextDecoder().decode(De.signedMessage),J=De.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ke)||typeof ke.signMessage!="function"||!("publicKey"in ke)||typeof ke!="object"||!ke.publicKey||!("toBase58"in ke.publicKey)||typeof ke.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");re=[`${at.host} wants you to sign in with your Solana account:`,ke.publicKey.toBase58(),...ue?["",ue,""]:[""],"Version: 1",`URI: ${at.href}`,`Issued At: ${(m=(u=ie==null?void 0:ie.signInWithSolana)===null||u===void 0?void 0:u.issuedAt)!==null&&m!==void 0?m:new Date().toISOString()}`,...!((v=ie==null?void 0:ie.signInWithSolana)===null||v===void 0)&&v.notBefore?[`Not Before: ${ie.signInWithSolana.notBefore}`]:[],...!((T=ie==null?void 0:ie.signInWithSolana)===null||T===void 0)&&T.expirationTime?[`Expiration Time: ${ie.signInWithSolana.expirationTime}`]:[],...!((a=ie==null?void 0:ie.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${ie.signInWithSolana.chainId}`]:[],...!((R=ie==null?void 0:ie.signInWithSolana)===null||R===void 0)&&R.nonce?[`Nonce: ${ie.signInWithSolana.nonce}`]:[],...!((O=ie==null?void 0:ie.signInWithSolana)===null||O===void 0)&&O.requestId?[`Request ID: ${ie.signInWithSolana.requestId}`]:[],...!((H=(B=ie==null?void 0:ie.signInWithSolana)===null||B===void 0?void 0:B.resources)===null||H===void 0)&&H.length?["Resources",...ie.signInWithSolana.resources.map(De=>`- ${De}`)]:[]].join(`
`);const He=await ke.signMessage(new TextEncoder().encode(re),"utf8");if(!He||!(He instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");J=He}}try{const{data:_e,error:pe}=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:re,signature:w6(J)},!((q=r.options)===null||q===void 0)&&q.captchaToken?{gotrue_meta_security:{captcha_token:(ee=r.options)===null||ee===void 0?void 0:ee.captchaToken}}:null),xform:Lc});if(pe)throw pe;return!_e||!_e.session||!_e.user?{data:{user:null,session:null},error:new Kx}:(_e.session&&(await this._saveSession(_e.session),await this._notifyAllSubscribers("SIGNED_IN",_e.session)),{data:Object.assign({},_e),error:pe})}catch(_e){if(Ri(_e))return{data:{user:null,session:null},error:_e};throw _e}}async _exchangeCodeForSession(r){const s=await md(this.storage,`${this.storageKey}-code-verifier`),[u,m]=(s??"").split("/");try{const{data:v,error:T}=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:r,code_verifier:u},xform:Lc});if(await Wu(this.storage,`${this.storageKey}-code-verifier`),T)throw T;return!v||!v.session||!v.user?{data:{user:null,session:null,redirectType:null},error:new Kx}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign(Object.assign({},v),{redirectType:m??null}),error:T})}catch(v){if(Ri(v))return{data:{user:null,session:null,redirectType:null},error:v};throw v}}async signInWithIdToken(r){try{const{options:s,provider:u,token:m,access_token:v,nonce:T}=r,a=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:u,id_token:m,access_token:v,nonce:T,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Lc}),{data:R,error:O}=a;return O?{data:{user:null,session:null},error:O}:!R||!R.session||!R.user?{data:{user:null,session:null},error:new Kx}:(R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),{data:R,error:O})}catch(s){if(Ri(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(r){var s,u,m,v,T;try{if("email"in r){const{email:a,options:R}=r;let O=null,B=null;this.flowType==="pkce"&&([O,B]=await Ep(this.storage,this.storageKey));const{error:H}=await Zi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(s=R==null?void 0:R.data)!==null&&s!==void 0?s:{},create_user:(u=R==null?void 0:R.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},code_challenge:O,code_challenge_method:B},redirectTo:R==null?void 0:R.emailRedirectTo});return{data:{user:null,session:null},error:H}}if("phone"in r){const{phone:a,options:R}=r,{data:O,error:B}=await Zi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(m=R==null?void 0:R.data)!==null&&m!==void 0?m:{},create_user:(v=R==null?void 0:R.shouldCreateUser)!==null&&v!==void 0?v:!0,gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},channel:(T=R==null?void 0:R.channel)!==null&&T!==void 0?T:"sms"}});return{data:{user:null,session:null,messageId:O==null?void 0:O.message_id},error:B}}throw new Yx("You must provide either an email or phone number.")}catch(a){if(Ri(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(r){var s,u;try{let m,v;"options"in r&&(m=(s=r.options)===null||s===void 0?void 0:s.redirectTo,v=(u=r.options)===null||u===void 0?void 0:u.captchaToken);const{data:T,error:a}=await Zi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},r),{gotrue_meta_security:{captcha_token:v}}),redirectTo:m,xform:Lc});if(a)throw a;if(!T)throw new Error("An error occurred on token verification.");const R=T.session,O=T.user;return R!=null&&R.access_token&&(await this._saveSession(R),await this._notifyAllSubscribers(r.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",R)),{data:{user:O,session:R},error:null}}catch(m){if(Ri(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithSSO(r){var s,u,m;try{let v=null,T=null;return this.flowType==="pkce"&&([v,T]=await Ep(this.storage,this.storageKey)),await Zi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in r?{provider_id:r.providerId}:null),"domain"in r?{domain:r.domain}:null),{redirect_to:(u=(s=r.options)===null||s===void 0?void 0:s.redirectTo)!==null&&u!==void 0?u:void 0}),!((m=r==null?void 0:r.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:r.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:v,code_challenge_method:T}),headers:this.headers,xform:U6})}catch(v){if(Ri(v))return{data:null,error:v};throw v}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async r=>{const{data:{session:s},error:u}=r;if(u)throw u;if(!s)throw new Zu;const{error:m}=await Zi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:m}})}catch(r){if(Ri(r))return{data:{user:null,session:null},error:r};throw r}}async resend(r){try{const s=`${this.url}/resend`;if("email"in r){const{email:u,type:m,options:v}=r,{error:T}=await Zi(this.fetch,"POST",s,{headers:this.headers,body:{email:u,type:m,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},redirectTo:v==null?void 0:v.emailRedirectTo});return{data:{user:null,session:null},error:T}}else if("phone"in r){const{phone:u,type:m,options:v}=r,{data:T,error:a}=await Zi(this.fetch,"POST",s,{headers:this.headers,body:{phone:u,type:m,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}}});return{data:{user:null,session:null,messageId:T==null?void 0:T.message_id},error:a}}throw new Yx("You must provide either an email or phone number and a type")}catch(s){if(Ri(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(r,s){this._debug("#_acquireLock","begin",r);try{if(this.lockAcquired){const u=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),m=(async()=>(await u,await s()))();return this.pendingInLock.push((async()=>{try{await m}catch{}})()),m}return await this.lock(`lock:${this.storageKey}`,r,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const u=s();for(this.pendingInLock.push((async()=>{try{await u}catch{}})()),await u;this.pendingInLock.length;){const m=[...this.pendingInLock];await Promise.all(m),this.pendingInLock.splice(0,m.length)}return await u}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(r){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await r(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let r=null;const s=await md(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?r=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!r)return{data:{session:null},error:null};const u=r.expires_at?r.expires_at*1e3-Date.now()<h2:!1;if(this._debug("#__loadSession()",`session has${u?"":" not"} expired`,"expires_at",r.expires_at),!u){if(this.userStorage){const T=await md(this.userStorage,this.storageKey+"-user");T!=null&&T.user?r.user=T.user:r.user=p2()}if(this.storage.isServer&&r.user){let T=this.suppressGetSessionWarning;r=new Proxy(r,{get:(R,O,B)=>(!T&&O==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),T=!0,this.suppressGetSessionWarning=!0),Reflect.get(R,O,B))})}return{data:{session:r},error:null}}const{session:m,error:v}=await this._callRefreshToken(r.refresh_token);return v?{data:{session:null},error:v}:{data:{session:m},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(r){return r?await this._getUser(r):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(r){try{return r?await Zi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:r,xform:Qu}):await this._useSession(async s=>{var u,m,v;const{data:T,error:a}=s;if(a)throw a;return!(!((u=T.session)===null||u===void 0)&&u.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Zu}:await Zi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(v=(m=T.session)===null||m===void 0?void 0:m.access_token)!==null&&v!==void 0?v:void 0,xform:Qu})})}catch(s){if(Ri(s))return f6(s)&&(await this._removeSession(),await Wu(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(r,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(r,s))}async _updateUser(r,s={}){try{return await this._useSession(async u=>{const{data:m,error:v}=u;if(v)throw v;if(!m.session)throw new Zu;const T=m.session;let a=null,R=null;this.flowType==="pkce"&&r.email!=null&&([a,R]=await Ep(this.storage,this.storageKey));const{data:O,error:B}=await Zi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},r),{code_challenge:a,code_challenge_method:R}),jwt:T.access_token,xform:Qu});if(B)throw B;return T.user=O.user,await this._saveSession(T),await this._notifyAllSubscribers("USER_UPDATED",T),{data:{user:T.user},error:null}})}catch(u){if(Ri(u))return{data:{user:null},error:u};throw u}}async setSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(r))}async _setSession(r){try{if(!r.access_token||!r.refresh_token)throw new Zu;const s=Date.now()/1e3;let u=s,m=!0,v=null;const{payload:T}=f2(r.access_token);if(T.exp&&(u=T.exp,m=u<=s),m){const{session:a,error:R}=await this._callRefreshToken(r.refresh_token);if(R)return{data:{user:null,session:null},error:R};if(!a)return{data:{user:null,session:null},error:null};v=a}else{const{data:a,error:R}=await this._getUser(r.access_token);if(R)throw R;v={access_token:r.access_token,refresh_token:r.refresh_token,user:a.user,token_type:"bearer",expires_in:u-s,expires_at:u},await this._saveSession(v),await this._notifyAllSubscribers("SIGNED_IN",v)}return{data:{user:v.user,session:v},error:null}}catch(s){if(Ri(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(r))}async _refreshSession(r){try{return await this._useSession(async s=>{var u;if(!r){const{data:T,error:a}=s;if(a)throw a;r=(u=T.session)!==null&&u!==void 0?u:void 0}if(!(r!=null&&r.refresh_token))throw new Zu;const{session:m,error:v}=await this._callRefreshToken(r.refresh_token);return v?{data:{user:null,session:null},error:v}:m?{data:{user:m.user,session:m},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(Ri(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(r,s){try{if(!ul())throw new Jx("No browser detected.");if(r.error||r.error_description||r.error_code)throw new Jx(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new u3("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Jx("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!r.code)throw new u3("No code detected.");const{data:ue,error:ie}=await this._exchangeCodeForSession(r.code);if(ie)throw ie;const ke=new URL(window.location.href);return ke.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ke.toString()),{data:{session:ue.session,redirectType:null},error:null}}const{provider_token:u,provider_refresh_token:m,access_token:v,refresh_token:T,expires_in:a,expires_at:R,token_type:O}=r;if(!v||!a||!T||!O)throw new Jx("No session defined in URL");const B=Math.round(Date.now()/1e3),H=parseInt(a);let q=B+H;R&&(q=parseInt(R));const ee=q-B;ee*1e3<=Mp&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${ee}s, should have been closer to ${H}s`);const re=q-H;B-re>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",re,q,B):B-re<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",re,q,B);const{data:J,error:_e}=await this._getUser(v);if(_e)throw _e;const pe={provider_token:u,provider_refresh_token:m,access_token:v,expires_in:H,expires_at:q,refresh_token:T,token_type:O,user:J.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:pe,redirectType:r.type},error:null}}catch(u){if(Ri(u))return{data:{session:null,redirectType:null},error:u};throw u}}_isImplicitGrantCallback(r){return!!(r.access_token||r.error_description)}async _isPKCECallback(r){const s=await md(this.storage,`${this.storageKey}-code-verifier`);return!!(r.code&&s)}async signOut(r={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(r))}async _signOut({scope:r}={scope:"global"}){return await this._useSession(async s=>{var u;const{data:m,error:v}=s;if(v)return{error:v};const T=(u=m.session)===null||u===void 0?void 0:u.access_token;if(T){const{error:a}=await this.admin.signOut(T,r);if(a&&!(d6(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return r!=="others"&&(await this._removeSession(),await Wu(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(r){const s=T6(),u={id:s,callback:r,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,u),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:u}}}async _emitInitialSession(r){return await this._useSession(async s=>{var u,m;try{const{data:{session:v},error:T}=s;if(T)throw T;await((u=this.stateChangeEmitters.get(r))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",v)),this._debug("INITIAL_SESSION","callback id",r,"session",v)}catch(v){await((m=this.stateChangeEmitters.get(r))===null||m===void 0?void 0:m.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",r,"error",v),console.error(v)}})}async resetPasswordForEmail(r,s={}){let u=null,m=null;this.flowType==="pkce"&&([u,m]=await Ep(this.storage,this.storageKey,!0));try{return await Zi(this.fetch,"POST",`${this.url}/recover`,{body:{email:r,code_challenge:u,code_challenge_method:m,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(v){if(Ri(v))return{data:null,error:v};throw v}}async getUserIdentities(){var r;try{const{data:s,error:u}=await this.getUser();if(u)throw u;return{data:{identities:(r=s.user.identities)!==null&&r!==void 0?r:[]},error:null}}catch(s){if(Ri(s))return{data:null,error:s};throw s}}async linkIdentity(r){var s;try{const{data:u,error:m}=await this._useSession(async v=>{var T,a,R,O,B;const{data:H,error:q}=v;if(q)throw q;const ee=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,r.provider,{redirectTo:(T=r.options)===null||T===void 0?void 0:T.redirectTo,scopes:(a=r.options)===null||a===void 0?void 0:a.scopes,queryParams:(R=r.options)===null||R===void 0?void 0:R.queryParams,skipBrowserRedirect:!0});return await Zi(this.fetch,"GET",ee,{headers:this.headers,jwt:(B=(O=H.session)===null||O===void 0?void 0:O.access_token)!==null&&B!==void 0?B:void 0})});if(m)throw m;return ul()&&!(!((s=r.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(u==null?void 0:u.url),{data:{provider:r.provider,url:u==null?void 0:u.url},error:null}}catch(u){if(Ri(u))return{data:{provider:r.provider,url:null},error:u};throw u}}async unlinkIdentity(r){try{return await this._useSession(async s=>{var u,m;const{data:v,error:T}=s;if(T)throw T;return await Zi(this.fetch,"DELETE",`${this.url}/user/identities/${r.identity_id}`,{headers:this.headers,jwt:(m=(u=v.session)===null||u===void 0?void 0:u.access_token)!==null&&m!==void 0?m:void 0})})}catch(s){if(Ri(s))return{data:null,error:s};throw s}}async _refreshAccessToken(r){const s=`#_refreshAccessToken(${r.substring(0,5)}...)`;this._debug(s,"begin");try{const u=Date.now();return await I6(async m=>(m>0&&await A6(200*Math.pow(2,m-1)),this._debug(s,"refreshing attempt",m),await Zi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:r},headers:this.headers,xform:Lc})),(m,v)=>{const T=200*Math.pow(2,m);return v&&d2(v)&&Date.now()+T-u<Mp})}catch(u){if(this._debug(s,"error",u),Ri(u))return{data:{session:null,user:null},error:u};throw u}finally{this._debug(s,"end")}}_isValidSession(r){return typeof r=="object"&&r!==null&&"access_token"in r&&"refresh_token"in r&&"expires_at"in r}async _handleProviderSignIn(r,s){const u=await this._getUrlForProvider(`${this.url}/authorize`,r,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",r,"options",s,"url",u),ul()&&!s.skipBrowserRedirect&&window.location.assign(u),{data:{provider:r,url:u},error:null}}async _recoverAndRefresh(){var r,s;const u="#_recoverAndRefresh()";this._debug(u,"begin");try{const m=await md(this.storage,this.storageKey);if(m&&this.userStorage){let T=await md(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!T&&(T={user:m.user},await Dp(this.userStorage,this.storageKey+"-user",T)),m.user=(r=T==null?void 0:T.user)!==null&&r!==void 0?r:p2()}else if(m&&!m.user&&!m.user){const T=await md(this.storage,this.storageKey+"-user");T&&(T!=null&&T.user)?(m.user=T.user,await Wu(this.storage,this.storageKey+"-user"),await Dp(this.storage,this.storageKey,m)):m.user=p2()}if(this._debug(u,"session from storage",m),!this._isValidSession(m)){this._debug(u,"session is not valid"),m!==null&&await this._removeSession();return}const v=((s=m.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<h2;if(this._debug(u,`session has${v?"":" not"} expired with margin of ${h2}s`),v){if(this.autoRefreshToken&&m.refresh_token){const{error:T}=await this._callRefreshToken(m.refresh_token);T&&(console.error(T),d2(T)||(this._debug(u,"refresh failed with a non-retryable error, removing the session",T),await this._removeSession()))}}else if(m.user&&m.user.__isUserNotAvailableProxy===!0)try{const{data:T,error:a}=await this._getUser(m.access_token);!a&&(T!=null&&T.user)?(m.user=T.user,await this._saveSession(m),await this._notifyAllSubscribers("SIGNED_IN",m)):this._debug(u,"could not get user data, skipping SIGNED_IN notification")}catch(T){console.error("Error getting user data:",T),this._debug(u,"error getting user data, skipping SIGNED_IN notification",T)}else await this._notifyAllSubscribers("SIGNED_IN",m)}catch(m){this._debug(u,"error",m),console.error(m);return}finally{this._debug(u,"end")}}async _callRefreshToken(r){var s,u;if(!r)throw new Zu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const m=`#_callRefreshToken(${r.substring(0,5)}...)`;this._debug(m,"begin");try{this.refreshingDeferred=new C1;const{data:v,error:T}=await this._refreshAccessToken(r);if(T)throw T;if(!v.session)throw new Zu;await this._saveSession(v.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",v.session);const a={session:v.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(v){if(this._debug(m,"error",v),Ri(v)){const T={session:null,error:v};return d2(v)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(T),T}throw(u=this.refreshingDeferred)===null||u===void 0||u.reject(v),v}finally{this.refreshingDeferred=null,this._debug(m,"end")}}async _notifyAllSubscribers(r,s,u=!0){const m=`#_notifyAllSubscribers(${r})`;this._debug(m,"begin",s,`broadcast = ${u}`);try{this.broadcastChannel&&u&&this.broadcastChannel.postMessage({event:r,session:s});const v=[],T=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(r,s)}catch(R){v.push(R)}});if(await Promise.all(T),v.length>0){for(let a=0;a<v.length;a+=1)console.error(v[a]);throw v[0]}}finally{this._debug(m,"end")}}async _saveSession(r){this._debug("#_saveSession()",r),this.suppressGetSessionWarning=!0;const s=Object.assign({},r),u=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!u&&s.user&&await Dp(this.userStorage,this.storageKey+"-user",{user:s.user});const m=Object.assign({},s);delete m.user;const v=m3(m);await Dp(this.storage,this.storageKey,v)}else{const m=m3(s);await Dp(this.storage,this.storageKey,m)}}async _removeSession(){this._debug("#_removeSession()"),await Wu(this.storage,this.storageKey),await Wu(this.storage,this.storageKey+"-code-verifier"),await Wu(this.storage,this.storageKey+"-user"),this.userStorage&&await Wu(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const r=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{r&&ul()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",r)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const r=setInterval(()=>this._autoRefreshTokenTick(),Mp);this.autoRefreshTicker=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const r=this.autoRefreshTicker;this.autoRefreshTicker=null,r&&clearInterval(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const r=Date.now();try{return await this._useSession(async s=>{const{data:{session:u}}=s;if(!u||!u.refresh_token||!u.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const m=Math.floor((u.expires_at*1e3-r)/Mp);this._debug("#_autoRefreshTokenTick()",`access token expires in ${m} ticks, a tick lasts ${Mp}ms, refresh threshold is ${TT} ticks`),m<=TT&&await this._callRefreshToken(u.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(r){if(r.isAcquireTimeout||r instanceof HM)this._debug("auto refresh token tick lock not available");else throw r}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ul()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(r){console.error("_handleVisibilityChange",r)}}async _onVisibilityChanged(r){const s=`#_onVisibilityChanged(${r})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),r||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(r,s,u){const m=[`provider=${encodeURIComponent(s)}`];if(u!=null&&u.redirectTo&&m.push(`redirect_to=${encodeURIComponent(u.redirectTo)}`),u!=null&&u.scopes&&m.push(`scopes=${encodeURIComponent(u.scopes)}`),this.flowType==="pkce"){const[v,T]=await Ep(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(v)}`,code_challenge_method:`${encodeURIComponent(T)}`});m.push(a.toString())}if(u!=null&&u.queryParams){const v=new URLSearchParams(u.queryParams);m.push(v.toString())}return u!=null&&u.skipBrowserRedirect&&m.push(`skip_http_redirect=${u.skipBrowserRedirect}`),`${r}?${m.join("&")}`}async _unenroll(r){try{return await this._useSession(async s=>{var u;const{data:m,error:v}=s;return v?{data:null,error:v}:await Zi(this.fetch,"DELETE",`${this.url}/factors/${r.factorId}`,{headers:this.headers,jwt:(u=m==null?void 0:m.session)===null||u===void 0?void 0:u.access_token})})}catch(s){if(Ri(s))return{data:null,error:s};throw s}}async _enroll(r){try{return await this._useSession(async s=>{var u,m;const{data:v,error:T}=s;if(T)return{data:null,error:T};const a=Object.assign({friendly_name:r.friendlyName,factor_type:r.factorType},r.factorType==="phone"?{phone:r.phone}:{issuer:r.issuer}),{data:R,error:O}=await Zi(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(u=v==null?void 0:v.session)===null||u===void 0?void 0:u.access_token});return O?{data:null,error:O}:(r.factorType==="totp"&&(!((m=R==null?void 0:R.totp)===null||m===void 0)&&m.qr_code)&&(R.totp.qr_code=`data:image/svg+xml;utf-8,${R.totp.qr_code}`),{data:R,error:null})})}catch(s){if(Ri(s))return{data:null,error:s};throw s}}async _verify(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var u;const{data:m,error:v}=s;if(v)return{data:null,error:v};const{data:T,error:a}=await Zi(this.fetch,"POST",`${this.url}/factors/${r.factorId}/verify`,{body:{code:r.code,challenge_id:r.challengeId},headers:this.headers,jwt:(u=m==null?void 0:m.session)===null||u===void 0?void 0:u.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+T.expires_in},T)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",T),{data:T,error:a})})}catch(s){if(Ri(s))return{data:null,error:s};throw s}})}async _challenge(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var u;const{data:m,error:v}=s;return v?{data:null,error:v}:await Zi(this.fetch,"POST",`${this.url}/factors/${r.factorId}/challenge`,{body:{channel:r.channel},headers:this.headers,jwt:(u=m==null?void 0:m.session)===null||u===void 0?void 0:u.access_token})})}catch(s){if(Ri(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(r){const{data:s,error:u}=await this._challenge({factorId:r.factorId});return u?{data:null,error:u}:await this._verify({factorId:r.factorId,challengeId:s.id,code:r.code})}async _listFactors(){const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const u=(r==null?void 0:r.factors)||[],m=u.filter(T=>T.factor_type==="totp"&&T.status==="verified"),v=u.filter(T=>T.factor_type==="phone"&&T.status==="verified");return{data:{all:u,totp:m,phone:v},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async r=>{var s,u;const{data:{session:m},error:v}=r;if(v)return{data:null,error:v};if(!m)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:T}=f2(m.access_token);let a=null;T.aal&&(a=T.aal);let R=a;((u=(s=m.user.factors)===null||s===void 0?void 0:s.filter(H=>H.status==="verified"))!==null&&u!==void 0?u:[]).length>0&&(R="aal2");const B=T.amr||[];return{data:{currentLevel:a,nextLevel:R,currentAuthenticationMethods:B},error:null}}))}async fetchJwk(r,s={keys:[]}){let u=s.keys.find(a=>a.kid===r);if(u)return u;const m=Date.now();if(u=this.jwks.keys.find(a=>a.kid===r),u&&this.jwks_cached_at+u6>m)return u;const{data:v,error:T}=await Zi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(T)throw T;return!v.keys||v.keys.length===0||(this.jwks=v,this.jwks_cached_at=m,u=v.keys.find(a=>a.kid===r),!u)?null:u}async getClaims(r,s={}){try{let u=r;if(!u){const{data:ee,error:re}=await this.getSession();if(re||!ee.session)return{data:null,error:re};u=ee.session.access_token}const{header:m,payload:v,signature:T,raw:{header:a,payload:R}}=f2(u);s!=null&&s.allowExpired||O6(v.exp);const O=!m.alg||m.alg.startsWith("HS")||!m.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(m.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!O){const{error:ee}=await this.getUser(u);if(ee)throw ee;return{data:{claims:v,header:m,signature:T},error:null}}const B=L6(m.alg),H=await crypto.subtle.importKey("jwk",O,B,!0,["verify"]);if(!await crypto.subtle.verify(B,H,T,v6(`${a}.${R}`)))throw new AT("Invalid JWT signature");return{data:{claims:v,header:m,signature:T},error:null}}catch(u){if(Ri(u))return{data:null,error:u};throw u}}}g_.nextInstanceID=0;const Y6=g_;class J6 extends Y6{constructor(r){super(r)}}var Q6=function(t,r,s,u){function m(v){return v instanceof s?v:new s(function(T){T(v)})}return new(s||(s=Promise))(function(v,T){function a(B){try{O(u.next(B))}catch(H){T(H)}}function R(B){try{O(u.throw(B))}catch(H){T(H)}}function O(B){B.done?v(B.value):m(B.value).then(a,R)}O((u=u.apply(t,r||[])).next())})};class ej{constructor(r,s,u){var m,v,T;this.supabaseUrl=r,this.supabaseKey=s;const a=s6(r);if(!s)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const R=`sb-${a.hostname.split(".")[0]}-auth-token`,O={db:X5,realtime:Y5,auth:Object.assign(Object.assign({},K5),{storageKey:R}),global:Z5},B=n6(u??{},O);this.storageKey=(m=B.auth.storageKey)!==null&&m!==void 0?m:"",this.headers=(v=B.global.headers)!==null&&v!==void 0?v:{},B.accessToken?(this.accessToken=B.accessToken,this.auth=new Proxy({},{get:(H,q)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(q)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((T=B.auth)!==null&&T!==void 0?T:{},this.headers,B.global.fetch),this.fetch=t6(s,this._getAccessToken.bind(this),B.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},B.realtime)),this.rest=new m5(new URL("rest/v1",a).href,{headers:this.headers,schema:B.db.schema,fetch:this.fetch}),this.storage=new H5(this.storageUrl.href,this.headers,this.fetch,u==null?void 0:u.storage),B.accessToken||this._listenForAuthEvents()}get functions(){return new qB(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,s={},u={}){return this.rest.rpc(r,s,u)}channel(r,s={config:{}}){return this.realtime.channel(r,s)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,s;return Q6(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:u}=yield this.auth.getSession();return(s=(r=u.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:s,detectSessionInUrl:u,storage:m,userStorage:v,storageKey:T,flowType:a,lock:R,debug:O},B,H){const q={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new J6({url:this.authUrl.href,headers:Object.assign(Object.assign({},q),B),storageKey:T,autoRefreshToken:r,persistSession:s,detectSessionInUrl:u,storage:m,userStorage:v,flowType:a,lock:R,debug:O,fetch:H,hasCustomAuthorizationHeader:Object.keys(this.headers).some(ee=>ee.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new M5(this.realtimeUrl.href,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,u)=>{this._handleTokenChanged(s,"CLIENT",u==null?void 0:u.access_token)})}_handleTokenChanged(r,s,u){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==u?this.changedAccessToken=u:r==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const tj=(t,r,s)=>new ej(t,r,s);function rj(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const r=t.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}rj()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ij="https://ahpdojlajtfejmtjtwvr.supabase.co",nj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFocGRvamxhanRmZWptdGp0d3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4OTQ2MjgsImV4cCI6MjA4MzQ3MDYyOH0.3EHVvsPFnDLm3AZVAm8AdpLIaW9IxLJ5at6VQNT82qk",sj=()=>{if(typeof window<"u"&&window.localStorage)return window.localStorage},Qr=tj(ij,nj,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,storageKey:"ponto-digital-auth",storage:sj()}}),WM=zt.createContext(void 0);function oj({children:t}){const[r,s]=zt.useState(null),[u,m]=zt.useState(null),[v,T]=zt.useState(!0);zt.useEffect(()=>{Qr.auth.getSession().then(({data:{session:H}})=>{s((H==null?void 0:H.user)??null),H!=null&&H.user?a(H.user.id):T(!1)});const{data:{subscription:B}}=Qr.auth.onAuthStateChange((H,q)=>{s((q==null?void 0:q.user)??null),q!=null&&q.user?a(q.user.id):(m(null),T(!1))});return()=>B.unsubscribe()},[]);const a=async B=>{try{const H=localStorage.getItem(`profile-${B}`);H&&(m(JSON.parse(H)),T(!1));const{data:q,error:ee}=await Qr.from("profiles").select("*").eq("id",B).maybeSingle();if(ee)throw ee;q&&(m(q),localStorage.setItem(`profile-${B}`,JSON.stringify(q)))}catch(H){console.error("Error loading profile:",H);const q=localStorage.getItem(`profile-${B}`);q&&!u&&m(JSON.parse(q))}finally{T(!1)}},R=async(B,H)=>{let q;for(let ee=1;ee<=3;ee++)try{const{error:re}=await Qr.auth.signInWithPassword({email:B,password:H});if(re)throw re;return}catch(re){q=re,console.error(`SignIn attempt ${ee} failed:`,re),ee<3&&await new Promise(J=>setTimeout(J,1e3*ee))}throw q},O=async()=>{const{error:B}=await Qr.auth.signOut();if(B)throw B};return L.jsx(WM.Provider,{value:{user:r,profile:u,loading:v,signIn:R,signOut:O},children:t})}function Ud(){const t=zt.useContext(WM);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var aj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lj=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ji=(t,r)=>{const s=zt.forwardRef(({color:u="currentColor",size:m=24,strokeWidth:v=2,absoluteStrokeWidth:T,className:a="",children:R,...O},B)=>zt.createElement("svg",{ref:B,...aj,width:m,height:m,stroke:u,strokeWidth:T?Number(v)*24/Number(m):v,className:["lucide",`lucide-${lj(t)}`,a].join(" "),...O},[...r.map(([H,q])=>zt.createElement(H,q)),...Array.isArray(R)?R:[R]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cj=Ji("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=Ji("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v3=Ji("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xv=Ji("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=Ji("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=Ji("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=Ji("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uj=Ji("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hj=Ji("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dj=Ji("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dd=Ji("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fj=Ji("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=Ji("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZM=Ji("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=Ji("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pj=Ji("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mj=Ji("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gj=Ji("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XM=Ji("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=Ji("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KM=Ji("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _j=Ji("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yj=Ji("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xj=Ji("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=Ji("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YM=Ji("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vj=Ji("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=Ji("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OS=Ji("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bj=Ji("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vc=Ji("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=Ji("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=Ji("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=Ji("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=Ji("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=Ji("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Aj(){const[t,r]=zt.useState(""),[s,u]=zt.useState(""),[m,v]=zt.useState(""),[T,a]=zt.useState(!1),{signIn:R}=Ud(),O=async B=>{B.preventDefault(),v(""),a(!0);try{await R(t,s)}catch(H){console.error("Login error:",H);const q=H.message||JSON.stringify(H);q.includes("Invalid login credentials")||q.includes("invalid")?v("Email ou senha incorretos."):q.includes("Network")||q.includes("fetch")||q.includes("TIMEOUT")||q.includes("timeout")?v("Erro de conexo. Verifique sua internet e tente novamente em alguns segundos."):q.includes("user_not_found")?v("Usurio no encontrado."):v("Erro ao fazer login. Tente novamente.")}finally{a(!1)}};return L.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4",children:L.jsx("div",{className:"w-full max-w-md",children:L.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[L.jsxs("div",{className:"flex flex-col items-center mb-8",children:[L.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 p-4 rounded-full mb-4",children:L.jsx(OS,{className:"w-12 h-12 text-white"})}),L.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Ponto Digital"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema de Controle de Ponto"})]}),L.jsxs("form",{onSubmit:O,className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),L.jsx("input",{type:"email",value:t,onChange:B=>r(B.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),L.jsx("input",{type:"password",value:s,onChange:B=>u(B.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"",required:!0})]}),m&&L.jsx("div",{className:"bg-red-50 text-red-600 px-4 py-3 rounded-lg text-sm",children:m}),L.jsx("button",{type:"submit",disabled:T,className:"w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 rounded-lg font-semibold hover:from-amber-600 hover:to-orange-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:T?"Entrando...":"Entrar"})]})]})})})}function w3(){const[t,r]=zt.useState({activeUsers:0,totalEmployees:0,todayEntries:0,avgWorkHours:0}),[s,u]=zt.useState([]),[m,v]=zt.useState([]),[T,a]=zt.useState(!0);zt.useEffect(()=>{R();const O=setInterval(R,3e4);return()=>clearInterval(O)},[]);const R=async()=>{var O,B,H;try{const q=new Date().toISOString().split("T")[0],[ee,re,J,_e]=await Promise.all([Qr.from("active_sessions").select("*, profile:profiles(*)"),Qr.from("profiles").select("count",{count:"exact",head:!0}).eq("role","employee"),Qr.from("time_entries").select("total_hours").gte("created_at",q),Qr.from("time_entries").select("user_id, total_hours, profiles!inner(full_name)").not("total_hours","is",null).gte("created_at",q)]),pe=ee.data||[],ue=re.count||0,ie=((O=J.data)==null?void 0:O.length)||0,ke=((B=J.data)==null?void 0:B.reduce((De,et)=>De+Number(et.total_hours),0))/(ie||1);r({activeUsers:pe.length,totalEmployees:ue,todayEntries:ie,avgWorkHours:Math.round(ke*10)/10}),u(pe);const at=new Map;(H=_e.data)==null||H.forEach(De=>{const et=at.get(De.user_id)||{name:De.profiles.full_name,hours:0};et.hours+=Number(De.total_hours||0),at.set(De.user_id,et)});const He=Array.from(at.entries()).map(([De,et])=>({employee_id:De,full_name:et.name,total_hours:Math.round(et.hours*10)/10})).sort((De,et)=>et.total_hours-De.total_hours).slice(0,10);v(He)}catch(q){console.error("Error loading dashboard data:",q)}finally{a(!1)}};return T?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Dashboard"}),L.jsx("p",{className:"text-gray-600",children:"Viso geral do sistema de ponto"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[L.jsx("div",{className:"bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-6 text-white shadow-lg",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Usurios Ativos"}),L.jsx("p",{className:"text-3xl font-bold mt-2",children:t.activeUsers})]}),L.jsx(cj,{className:"w-12 h-12 text-green-100 opacity-80"})]})}),L.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl p-6 text-white shadow-lg",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-amber-100 text-sm font-medium",children:"Total Colaboradores"}),L.jsx("p",{className:"text-3xl font-bold mt-2",children:t.totalEmployees})]}),L.jsx(JM,{className:"w-12 h-12 text-amber-100 opacity-80"})]})}),L.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-6 text-white shadow-lg",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Registros Hoje"}),L.jsx("p",{className:"text-3xl font-bold mt-2",children:t.todayEntries})]}),L.jsx(Dd,{className:"w-12 h-12 text-blue-100 opacity-80"})]})}),L.jsx("div",{className:"bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl p-6 text-white shadow-lg",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-teal-100 text-sm font-medium",children:"Mdia Horas Hoje"}),L.jsxs("p",{className:"text-3xl font-bold mt-2",children:[t.avgWorkHours,"h"]})]}),L.jsx(Vc,{className:"w-12 h-12 text-teal-100 opacity-80"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Horas Trabalhadas Hoje"}),m.length===0?L.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhum registro de horas hoje"}):L.jsx("div",{className:"space-y-3",children:m.map(O=>{const B=Math.max(...m.map(q=>q.total_hours)),H=O.total_hours/B*100;return L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("p",{className:"font-semibold text-gray-800 text-sm",children:O.full_name}),L.jsxs("p",{className:"text-sm font-bold text-amber-600",children:[O.total_hours,"h"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:L.jsx("div",{className:"h-full bg-gradient-to-r from-amber-500 to-orange-600 rounded-full transition-all duration-500",style:{width:`${H}%`}})})]},O.employee_id)})})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Colaboradores Ativos Agora"}),s.length===0?L.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhum colaborador ativo no momento"}):L.jsx("div",{className:"space-y-3",children:s.map(O=>{var B,H,q,ee;return L.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold",children:(H=(B=O.profile)==null?void 0:B.full_name)==null?void 0:H.charAt(0).toUpperCase()}),L.jsxs("div",{children:[L.jsx("p",{className:"font-semibold text-gray-800",children:(q=O.profile)==null?void 0:q.full_name}),L.jsx("p",{className:"text-sm text-gray-600",children:(ee=O.profile)==null?void 0:ee.job_position})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["Entrada: ",new Date(O.clock_in_time).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),L.jsxs("p",{className:"text-xs text-green-600 flex items-center justify-end mt-1",children:[L.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),"Ativo"]})]})]},O.id)})})]})]})]})}var QM={exports:{}};(function(t,r){(function(s,u){t.exports=u()})(va,function(){var s,u,m;function v(a,R){if(!s)s=R;else if(!u)u=R;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",B={};s(B),m=R(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}v(["exports"],function(a){var R=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;function B(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=n*p-h*c;return g?(o[0]=p*(g=1/g),o[1]=-c*g,o[2]=-h*g,o[3]=n*g,o):null}function H(){var o=new O(9);return O!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function q(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=e[4],x=e[5],b=e[6],E=e[7],I=e[8];return o[0]=g*I-x*E,o[1]=h*E-c*I,o[2]=c*x-h*g,o[3]=x*b-p*I,o[4]=n*I-h*b,o[5]=h*p-n*x,o[6]=p*E-g*b,o[7]=c*b-n*E,o[8]=n*g-c*p,o}function ee(o,e,n){var c=e[0],h=e[1],p=e[2],g=e[3],x=e[4],b=e[5],E=e[6],I=e[7],C=e[8],k=n[0],F=n[1],N=n[2],W=n[3],Z=n[4],X=n[5],le=n[6],ce=n[7],de=n[8];return o[0]=k*c+F*g+N*E,o[1]=k*h+F*x+N*I,o[2]=k*p+F*b+N*C,o[3]=W*c+Z*g+X*E,o[4]=W*h+Z*x+X*I,o[5]=W*p+Z*b+X*C,o[6]=le*c+ce*g+de*E,o[7]=le*h+ce*x+de*I,o[8]=le*p+ce*b+de*C,o}function re(){var o=new O(16);return O!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function J(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function _e(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=e[4],x=e[5],b=e[6],E=e[7],I=e[8],C=e[9],k=e[10],F=e[11],N=e[12],W=e[13],Z=e[14],X=e[15],le=n*x-c*g,ce=n*b-h*g,de=n*E-p*g,Ie=c*b-h*x,Ce=c*E-p*x,Re=h*E-p*b,Le=I*W-C*N,Fe=I*Z-k*N,dt=I*X-F*N,je=C*Z-k*W,pt=C*X-F*W,wt=k*X-F*Z,mt=le*wt-ce*pt+de*je+Ie*dt-Ce*Fe+Re*Le;return mt?(o[0]=(x*wt-b*pt+E*je)*(mt=1/mt),o[1]=(h*pt-c*wt-p*je)*mt,o[2]=(W*Re-Z*Ce+X*Ie)*mt,o[3]=(k*Ce-C*Re-F*Ie)*mt,o[4]=(b*dt-g*wt-E*Fe)*mt,o[5]=(n*wt-h*dt+p*Fe)*mt,o[6]=(Z*de-N*Re-X*ce)*mt,o[7]=(I*Re-k*de+F*ce)*mt,o[8]=(g*pt-x*dt+E*Le)*mt,o[9]=(c*dt-n*pt-p*Le)*mt,o[10]=(N*Ce-W*de+X*le)*mt,o[11]=(C*de-I*Ce-F*le)*mt,o[12]=(x*Fe-g*je-b*Le)*mt,o[13]=(n*je-c*Fe+h*Le)*mt,o[14]=(W*ce-N*Ie-Z*le)*mt,o[15]=(I*Ie-C*ce+k*le)*mt,o):null}function pe(o,e,n){var c=e[0],h=e[1],p=e[2],g=e[3],x=e[4],b=e[5],E=e[6],I=e[7],C=e[8],k=e[9],F=e[10],N=e[11],W=e[12],Z=e[13],X=e[14],le=e[15],ce=n[0],de=n[1],Ie=n[2],Ce=n[3];return o[0]=ce*c+de*x+Ie*C+Ce*W,o[1]=ce*h+de*b+Ie*k+Ce*Z,o[2]=ce*p+de*E+Ie*F+Ce*X,o[3]=ce*g+de*I+Ie*N+Ce*le,o[4]=(ce=n[4])*c+(de=n[5])*x+(Ie=n[6])*C+(Ce=n[7])*W,o[5]=ce*h+de*b+Ie*k+Ce*Z,o[6]=ce*p+de*E+Ie*F+Ce*X,o[7]=ce*g+de*I+Ie*N+Ce*le,o[8]=(ce=n[8])*c+(de=n[9])*x+(Ie=n[10])*C+(Ce=n[11])*W,o[9]=ce*h+de*b+Ie*k+Ce*Z,o[10]=ce*p+de*E+Ie*F+Ce*X,o[11]=ce*g+de*I+Ie*N+Ce*le,o[12]=(ce=n[12])*c+(de=n[13])*x+(Ie=n[14])*C+(Ce=n[15])*W,o[13]=ce*h+de*b+Ie*k+Ce*Z,o[14]=ce*p+de*E+Ie*F+Ce*X,o[15]=ce*g+de*I+Ie*N+Ce*le,o}function ue(o,e,n){var c,h,p,g,x,b,E,I,C,k,F,N,W=n[0],Z=n[1],X=n[2];return e===o?(o[12]=e[0]*W+e[4]*Z+e[8]*X+e[12],o[13]=e[1]*W+e[5]*Z+e[9]*X+e[13],o[14]=e[2]*W+e[6]*Z+e[10]*X+e[14],o[15]=e[3]*W+e[7]*Z+e[11]*X+e[15]):(h=e[1],p=e[2],g=e[3],x=e[4],b=e[5],E=e[6],I=e[7],C=e[8],k=e[9],F=e[10],N=e[11],o[0]=c=e[0],o[1]=h,o[2]=p,o[3]=g,o[4]=x,o[5]=b,o[6]=E,o[7]=I,o[8]=C,o[9]=k,o[10]=F,o[11]=N,o[12]=c*W+x*Z+C*X+e[12],o[13]=h*W+b*Z+k*X+e[13],o[14]=p*W+E*Z+F*X+e[14],o[15]=g*W+I*Z+N*X+e[15]),o}function ie(o,e,n){var c=n[0],h=n[1],p=n[2];return o[0]=e[0]*c,o[1]=e[1]*c,o[2]=e[2]*c,o[3]=e[3]*c,o[4]=e[4]*h,o[5]=e[5]*h,o[6]=e[6]*h,o[7]=e[7]*h,o[8]=e[8]*p,o[9]=e[9]*p,o[10]=e[10]*p,o[11]=e[11]*p,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function ke(o,e,n){var c=Math.sin(n),h=Math.cos(n),p=e[4],g=e[5],x=e[6],b=e[7],E=e[8],I=e[9],C=e[10],k=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=p*h+E*c,o[5]=g*h+I*c,o[6]=x*h+C*c,o[7]=b*h+k*c,o[8]=E*h-p*c,o[9]=I*h-g*c,o[10]=C*h-x*c,o[11]=k*h-b*c,o}function at(o,e,n){var c=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],x=e[2],b=e[3],E=e[8],I=e[9],C=e[10],k=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*h-E*c,o[1]=g*h-I*c,o[2]=x*h-C*c,o[3]=b*h-k*c,o[8]=p*c+E*h,o[9]=g*c+I*h,o[10]=x*c+C*h,o[11]=b*c+k*h,o}function He(o,e,n){var c=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],x=e[2],b=e[3],E=e[4],I=e[5],C=e[6],k=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*h+E*c,o[1]=g*h+I*c,o[2]=x*h+C*c,o[3]=b*h+k*c,o[4]=E*h-p*c,o[5]=I*h-g*c,o[6]=C*h-x*c,o[7]=k*h-b*c,o}function De(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function et(o,e,n){var c,h,p,g=n[0],x=n[1],b=n[2],E=Math.sqrt(g*g+x*x+b*b);return E<R?null:(g*=E=1/E,x*=E,b*=E,c=Math.sin(e),h=Math.cos(e),o[0]=g*g*(p=1-h)+h,o[1]=x*g*p+b*c,o[2]=b*g*p-x*c,o[3]=0,o[4]=g*x*p-b*c,o[5]=x*x*p+h,o[6]=b*x*p+g*c,o[7]=0,o[8]=g*b*p+x*c,o[9]=x*b*p-g*c,o[10]=b*b*p+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function Ge(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=n+n,x=c+c,b=h+h,E=n*g,I=c*g,C=c*x,k=h*g,F=h*x,N=h*b,W=p*g,Z=p*x,X=p*b;return o[0]=1-C-N,o[1]=I+X,o[2]=k-Z,o[3]=0,o[4]=I-X,o[5]=1-E-N,o[6]=F+W,o[7]=0,o[8]=k+Z,o[9]=F-W,o[10]=1-E-C,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var ft=pe;function tt(){var o=new O(3);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Ot(o){var e=new O(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function Xt(o){var e=o[0],n=o[1],c=o[2];return Math.sqrt(e*e+n*n+c*c)}function Dr(o,e,n){var c=new O(3);return c[0]=o,c[1]=e,c[2]=n,c}function ir(o,e,n,c){return o[0]=e,o[1]=n,o[2]=c,o}function Ir(o,e,n){return o[0]=e[0]+n[0],o[1]=e[1]+n[1],o[2]=e[2]+n[2],o}function ei(o,e,n){return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],o}function sr(o,e,n){return o[0]=e[0]*n[0],o[1]=e[1]*n[1],o[2]=e[2]*n[2],o}function yr(o,e,n){return o[0]=Math.min(e[0],n[0]),o[1]=Math.min(e[1],n[1]),o[2]=Math.min(e[2],n[2]),o}function vr(o,e,n){return o[0]=Math.max(e[0],n[0]),o[1]=Math.max(e[1],n[1]),o[2]=Math.max(e[2],n[2]),o}function gr(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o[2]=e[2]*n,o}function Ue(o,e,n,c){return o[0]=e[0]+n[0]*c,o[1]=e[1]+n[1]*c,o[2]=e[2]+n[2]*c,o}function vt(o,e){var n=e[0]-o[0],c=e[1]-o[1],h=e[2]-o[2];return n*n+c*c+h*h}function ct(o){var e=o[0],n=o[1],c=o[2];return e*e+n*n+c*c}function ht(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function Pt(o,e){var n=e[0],c=e[1],h=e[2],p=n*n+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),o[0]=e[0]*p,o[1]=e[1]*p,o[2]=e[2]*p,o}function dr(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function br(o,e,n){var c=e[0],h=e[1],p=e[2],g=n[0],x=n[1],b=n[2];return o[0]=h*b-p*x,o[1]=p*g-c*b,o[2]=c*x-h*g,o}function ar(o,e,n,c){var h=e[0],p=e[1],g=e[2];return o[0]=h+c*(n[0]-h),o[1]=p+c*(n[1]-p),o[2]=g+c*(n[2]-g),o}function Qt(o,e,n){var c=e[0],h=e[1],p=e[2],g=n[3]*c+n[7]*h+n[11]*p+n[15];return o[0]=(n[0]*c+n[4]*h+n[8]*p+n[12])/(g=g||1),o[1]=(n[1]*c+n[5]*h+n[9]*p+n[13])/g,o[2]=(n[2]*c+n[6]*h+n[10]*p+n[14])/g,o}function Ci(o,e,n){var c=e[0],h=e[1],p=e[2];return o[0]=c*n[0]+h*n[3]+p*n[6],o[1]=c*n[1]+h*n[4]+p*n[7],o[2]=c*n[2]+h*n[5]+p*n[8],o}function bi(o,e,n){var c=n[0],h=n[1],p=n[2],g=n[3],x=e[0],b=e[1],E=e[2],I=h*E-p*b,C=p*x-c*E,k=c*b-h*x;return o[0]=x+g*(I+=I)+h*(k+=k)-p*(C+=C),o[1]=b+g*C+p*I-c*k,o[2]=E+g*k+c*C-h*I,o}function Ln(o){return o[0]=0,o[1]=0,o[2]=0,o}function gi(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var Pi=ei,fr=sr,Ut=Xt;function ti(){var o=new O(4);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function si(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o[2]=e[2]*n,o[3]=e[3]*n,o}function cn(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=n*n+c*c+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=n*g,o[1]=c*g,o[2]=h*g,o[3]=p*g,o}function un(o,e,n){var c=e[0],h=e[1],p=e[2],g=e[3];return o[0]=n[0]*c+n[4]*h+n[8]*p+n[12]*g,o[1]=n[1]*c+n[5]*h+n[9]*p+n[13]*g,o[2]=n[2]*c+n[6]*h+n[10]*p+n[14]*g,o[3]=n[3]*c+n[7]*h+n[11]*p+n[15]*g,o}function Xn(){var o=new O(4);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Vn(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Kn(o,e,n){n*=.5;var c=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(n),b=Math.cos(n);return o[0]=c*b+g*x,o[1]=h*b+p*x,o[2]=p*b-h*x,o[3]=g*b-c*x,o}function ks(o,e,n){n*=.5;var c=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(n),b=Math.cos(n);return o[0]=c*b-p*x,o[1]=h*b+g*x,o[2]=p*b+c*x,o[3]=g*b-h*x,o}tt(),ti();var $n,os,$s,mo=cn,Yo=($n=tt(),os=Dr(1,0,0),$s=Dr(0,1,0),function(o,e,n){var c=dr(e,n);return c<-.999999?(br($n,os,e),Ut($n)<1e-6&&br($n,$s,e),Pt($n,$n),function(h,p,g){g*=.5;var x=Math.sin(g);h[0]=x*p[0],h[1]=x*p[1],h[2]=x*p[2],h[3]=Math.cos(g)}(o,$n,Math.PI),o):c>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(br($n,e,n),o[0]=$n[0],o[1]=$n[1],o[2]=$n[2],o[3]=1+c,mo(o,o))});function An(){var o=new O(2);return O!=Float32Array&&(o[0]=0,o[1]=0),o}function xs(o,e){var n=new O(2);return n[0]=o,n[1]=e,n}function zo(o,e,n){return o[0]=e,o[1]=n,o}function Jo(o,e,n){return o[0]=e[0]+n[0],o[1]=e[1]+n[1],o}function go(o,e,n){return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o}function Qo(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o}function Wa(o){var e=o[0],n=o[1];return Math.sqrt(e*e+n*n)}function Gi(o,e){var n=e[0],c=e[1],h=n*n+c*c;return h>0&&(h=1/Math.sqrt(h)),o[0]=e[0]*h,o[1]=e[1]*h,o}function Fn(o,e){return o[0]*e[0]+o[1]*e[1]}Xn(),Xn(),H();var wl,qa,_o=go;function Ea(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}An();var oc=function(){if(qa)return wl;function o(e,n,c,h){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=c,this.p2y=h}return qa=1,wl=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,h=0;h<8;h++){var p=this.sampleCurveX(c)-e;if(Math.abs(p)<n)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=p/g}var x=0,b=1;for(c=e,h=0;h<20&&(p=this.sampleCurveX(c),!(Math.abs(p-e)<n));h++)e>p?x=c:b=c,c=.5*(b-x)+x;return c},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},wl}(),tu=Ea(oc);function bt(o,e){this.x=o,this.y=e}function ea(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(!ea(o[n],e[n]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const n in o)if(!ea(o[n],e[n]))return!1;return!0}return o===e}bt.prototype={clone(){return new bt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,n=o.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),n=Math.sin(o),c=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=c,this},_rotateAround(o,e){const n=Math.cos(o),c=Math.sin(o),h=e.y+c*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-c*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:bt},bt.convert=function(o){if(o instanceof bt)return o;if(Array.isArray(o))return new bt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new bt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const bh=Math.PI/180,bl=180/Math.PI;function ze(o){return o*bh}function Y(o){return o*bl}const se=[[0,0],[1,0],[1,1],[0,1]];function ve(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,n=e*o;return 4*(o<.5?n:3*(o-e)+n-.75)}function Me(o,e,n,c){const h=new tu(o,e,n,c);return function(p){return h.solve(p)}}const Pe=Me(.25,.1,.25,1);function U(o,e,n){return Math.min(n,Math.max(e,o))}function ae(o,e,n){return(n=U((n-o)/(e-o),0,1))*n*(3-2*n)}function Q(o,e,n){const c=n-e,h=((o-e)%c+c)%c+e;return h===e?n:h}function ne(o,e,n){if(!o.length)return n(null,[]);let c=o.length;const h=new Array(o.length);let p=null;o.forEach((g,x)=>{e(g,(b,E)=>{b&&(p=b),h[x]=E,--c==0&&n(p,h)})})}let me=1;function fe(){return me++}function Ve(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function nt(o,e){o.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ye(o,e,n){const c={};for(const h in o)c[h]=e.call(this,o[h],h,o);return c}function st(o,e,n){const c={};for(const h in o)e.call(this,o[h],h,o)&&(c[h]=o[h]);return c}function it(o){return Array.isArray(o)?o.map(it):typeof o=="object"&&o?Ye(o,it):o}function Mt(o,e){for(let n=0;n<o.length;n++)if(e.indexOf(o[n])>=0)return!0;return!1}const Zt={};function $t(o){Zt[o]||(typeof console<"u"&&console.warn(o),Zt[o]=!0)}function Kt(o,e,n){return(n.y-o.y)*(e.x-o.x)>(e.y-o.y)*(n.x-o.x)}function mr(o){let e=0;for(let n,c,h=0,p=o.length,g=p-1;h<p;g=h++)n=o[h],c=o[g],e+=(c.x-n.x)*(n.y+c.y);return e}function Vr([o,e,n]){const c=ze(e+90),h=ze(n);return{x:o*Math.cos(c)*Math.sin(h),y:o*Math.sin(c)*Math.sin(h),z:o*Math.cos(h),azimuthal:e,polar:n}}function Xr(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function zr(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,h,p)=>{const g=h||p;return e[c]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let di=null;function ji(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Ai(o,e,n,c){for(;e<n;){const h=e+n>>1;o[h]<c?e=h+1:n=h}return e}function Sn(o,e,n,c){for(;e<n;){const h=e+n>>1;o[h]<=c?e=h+1:n=h}return e}function In(o){return o>0?1/(1.001-o):1+o}function vs(o){return o>0?1-1/(1.001-o):-o}function as(o,e,n){return(o-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const ws={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ws.API_URL)return null;try{const o=new URL(ws.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ru(o){return ws.API_URL_REGEX.test(o)}function B_(o){return ws.API_SPRITE_REGEX.test(o)}let Tl,iu,Th,Sh,Sl,Eh;function Tm(){return Tl==null&&(Tl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Tl}const Aa={now:()=>Sh!==void 0?Sh:performance.now(),setNow(o){Sh=o},restoreNow(){Sh=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:n,height:c}=o;Sl||(Sl=document.createElement("canvas"));const h=Sl.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>Sl.width||c>Sl.height)&&(Sl.width=n,Sl.height=c),h.clearRect(-e,-e,n+2*e,c+2*e),h.drawImage(o,0,0,n,c),h.getImageData(-e,-e,n+2*e,c+2*e)},resolveURL:o=>(iu||(iu=document.createElement("a")),iu.href=o,iu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Th==null&&(Th=window.matchMedia("(prefers-reduced-motion: reduce)")),Th.matches)},hasCanvasFingerprintNoise(){if(Eh!==void 0)return Eh;if(!Tm())return Eh=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let n=0;for(let h=0;h<o.width;++h)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(h,0,1,1);const c=e.getImageData(0,0,o.width,o.height);n=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&n++!==c.data[h])return Eh=!0,!0;return Eh=!1,!1}};function Sm(o,e){const n=o.indexOf("?");if(n<0)return`${o}?${new URLSearchParams(e).toString()}`;const c=new URLSearchParams(o.slice(n));for(const h in e)c.set(h,e[h]);return`${o.slice(0,n)}?${c.toString()}`}function qd(o,e={persistentParams:[]}){const n=o.indexOf("?");if(n<0)return o;const c=new URLSearchParams,h=new URLSearchParams(o.slice(n));for(const g of e.persistentParams){const x=h.get(g);x&&c.set(g,x)}const p=c.toString();return`${o.slice(0,n)}${p.length>0?`?${p}`:""}`}const yo="mapbox-tiles";let ta=500,Za=50;const ra=["language","worldview","jobid"];let Rs,ac;function Em(){try{return caches}catch{}}function Ah(){const o=Em();o&&Rs==null&&(Rs=o.open(yo))}let El=1/0;const Ih={supported:!1,testSupport:function(o){!xo&&nu&&(Am?su(o):Ch=o)}};let Ch,nu,xo=!1,Am=!1;const Zd=typeof self<"u"?self:{};function su(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,nu),o.isContextLost())return;Ih.supported=!0}catch{}o.deleteTexture(e),xo=!0}Zd.document&&(nu=Zd.document.createElement("img"),nu.onload=function(){Ch&&su(Ch),Ch=null,Am=!0},nu.onerror=function(){xo=!0,Ch=null},nu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Xd);class Im extends Error{constructor(e,n,c){n===401&&ru(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kd=Xr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,oi=function(o,e){if(!(/^file:/.test(n=o.url)||/^file:/.test(Kd())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){const p=new AbortController,g=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Kd(),referrerPolicy:c.referrerPolicy,signal:p.signal});let x=!1,b=!1;const E=(I=g.url).indexOf("sku=")>0&&ru(I);var I;c.type==="json"&&g.headers.set("Accept","application/json");const C=(F,N,W)=>{if(b)return;if(F&&F.message!=="SecurityError"&&$t(F.toString()),N&&W)return k(N);const Z=Date.now();fetch(g).then(X=>{if(X.ok){const le=E?X.clone():null;return k(X,le,Z)}return h(new Im(X.statusText,X.status,c.url))}).catch(X=>{X.name!=="AbortError"&&h(new Error(`${X.message} ${c.url}`))})},k=(F,N,W)=>{(c.type==="arrayBuffer"?F.arrayBuffer():c.type==="json"?F.json():F.text()).then(Z=>{b||(N&&W&&function(X,le,ce){if(Ah(),Rs==null)return;const de=zr(le.headers.get("Cache-Control")||"");if(de["no-store"])return;const Ie={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Le,Fe)=>Ie.headers.set(Fe,Le)),de["max-age"]&&Ie.headers.set("Expires",new Date(ce+1e3*de["max-age"]).toUTCString());const Ce=Ie.headers.get("Expires");if(!Ce||new Date(Ce).getTime()-ce<42e4)return;let Re=qd(X.url,{persistentParams:ra});if(le.status===206){const Le=X.headers.get("Range");if(!Le)return;Ie.status=200,Re=Sm(Re,{range:Le})}(function(Le,Fe){if(ac===void 0)try{new Response(new ReadableStream),ac=!0}catch{ac=!1}ac?Fe(Le.body):Le.blob().then(Fe).catch(dt=>$t(dt.message))})(le,Le=>{const Fe=new Response((dt=le.status)!==200&&dt!==404&&[101,103,204,205,304].includes(dt)?null:Le,Ie);var dt;Ah(),Rs!=null&&Rs.then(je=>je.put(Re,Fe)).catch(je=>$t(je.message))})}(g,N,W),x=!0,h(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{b||h(new Error(Z.message))})};return E?function(F,N){if(Ah(),Rs==null)return N(null);Rs.then(W=>{let Z=qd(F.url,{persistentParams:ra});const X=F.headers.get("Range");X&&(Z=Sm(Z,{range:X})),W.match(Z).then(le=>{const ce=function(de){if(!de)return!1;const Ie=new Date(de.headers.get("Expires")||0),Ce=zr(de.headers.get("Cache-Control")||"");return Number(Ie)>Date.now()&&!Ce["no-cache"]}(le);W.delete(Z).catch(N),ce&&W.put(Z,le.clone()).catch(N),N(null,le,ce)}).catch(N)}).catch(N)}(g,C):C(null,null),{cancel:()=>{b=!0,x||p.abort()}}}(o,e);if(Xr(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var n;return function(c,h){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in c.headers)p.setRequestHeader(g,c.headers[g]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(c.type==="json")try{g=JSON.parse(p.response)}catch(x){return h(x)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Im(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(o,e)},ou=function(o,e){return oi(Object.assign(o,{type:"arrayBuffer"}),e)};function j_(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const U_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yd,Al;Yd=[],Al=0;const au=function(o,e){if(Ih.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Al>=ws.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yd.push(p),p}Al++;let n=!1;const c=()=>{if(!n)for(n=!0,Al--;Yd.length&&Al<ws.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Yd.shift(),{requestParameters:g,callback:x,cancelled:b}=p;b||(p.cancel=au(g,x).cancel)}},h=ou(o,(p,g,x,b)=>{c(),p?e(p):g&&(self.createImageBitmap?function(E,I){const C=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(C).then(k=>{I(null,k)}).catch(k=>{I(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,I)=>e(E,I,x,b)):function(E,I){const C=new Image;C.onload=()=>{I(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=U_})},C.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(E)],{type:"image/png"});C.src=E.byteLength?URL.createObjectURL(k):U_}(g,(E,I)=>e(E,I,x,b)))});return{cancel:()=>{h.cancel(),c()}}};var Ph,Jd,V_,lc={exports:{}},$_={exports:{}},Cm={exports:{}},lu=function(){if(V_)return lc.exports;V_=1;var o=(Ph||(Ph=1,$_.exports=function(n,c){var h,p,g,x,b,E,I,C;for(p=n.length-(h=3&n.length),g=c,b=3432918353,E=461845907,C=0;C<p;)I=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&n.charCodeAt(C+2))<<16;case 2:I^=(255&n.charCodeAt(C+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(C)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),$_.exports),e=(Jd||(Jd=1,Cm.exports=function(n,c){for(var h,p=n.length,g=c^p,x=0;p>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(x)|(255&n.charCodeAt(++x))<<8|(255&n.charCodeAt(++x))<<16|(255&n.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&n.charCodeAt(x+2))<<16;case 2:g^=(255&n.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Cm.exports);return lc.exports=o,lc.exports.murmur3=o,lc.exports.murmur2=e,lc.exports}(),Qd=Ea(lu);class ia{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class kh extends ia{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function ef(o,e,n){n[o]&&n[o].indexOf(e)!==-1||(n[o]=n[o]||[],n[o].push(e))}function vo(o,e,n){if(n&&n[o]){const c=n[o].indexOf(e);c!==-1&&n[o].splice(c,1)}}class cc{on(e,n){return this._listeners=this._listeners||{},ef(e,n,this._listeners),this}off(e,n){return vo(e,n,this._listeners),vo(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ef(e,n,this._oneTimeListeners),this):new Promise(c=>{this.once(e,c)})}fire(e,n){const c=typeof e=="string"?new ia(e,n):e,h=c.type;if(this.listens(h)){c.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of p)b.call(this,c);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of g)vo(h,b,this._oneTimeListeners),b.call(this,c);const x=this._eventedParent;if(x){const b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(c,b),x.fire(c)}}else c instanceof kh&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class wo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new wo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,c]=e.split("");return new wo({name:n,iconsetId:c})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return wo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Pm,tf={},km=function(){if(Pm)return tf;Pm=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function n(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function c(p){return(g=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:g>1?1:g;var g}function h(p,g,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(g-p)*x*6:2*x<1?g:3*x<2?p+(g-p)*(2/3-x)*6:p}try{tf.parseCSSColor=function(p){var g,x=p.replace(/ /g,"").toLowerCase();if(x in o)return o[x].slice();if(x[0]==="#")return x.length===4?(g=parseInt(x.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:x.length===7&&(g=parseInt(x.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var b=x.indexOf("("),E=x.indexOf(")");if(b!==-1&&E+1===x.length){var I=x.substr(0,b),C=x.substr(b+1,E-(b+1)).split(","),k=1;switch(I){case"rgba":if(C.length!==4)return null;k=c(C.pop());case"rgb":return C.length!==3?null:[n(C[0]),n(C[1]),n(C[2]),k];case"hsla":if(C.length!==4)return null;k=c(C.pop());case"hsl":if(C.length!==3)return null;var F=(parseFloat(C[0])%360+360)%360/360,N=c(C[1]),W=c(C[2]),Z=W<=.5?W*(N+1):W+N-W*N,X=2*W-Z;return[e(255*h(X,Z,F+1/3)),e(255*h(X,Z,F)),e(255*h(X,Z,F-1/3)),k];default:return null}}return null}}catch{}return tf}();class _i{constructor(e,n,c,h=1){this.r=e,this.g=n,this.b=c,this.a=h}static parse(e){if(!e)return;if(e instanceof _i)return e;if(typeof e!="string")return;const n=km.parseCSSColor(e);return n?new _i(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,c,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*c)},${h})`}toNonPremultipliedRenderColor(e){const{r:n,g:c,b:h,a:p}=this;return new G_(e,n,c,h,p)}toPremultipliedRenderColor(e){const{r:n,g:c,b:h,a:p}=this;return new rf(e,n*p,c*p,h*p,p)}clone(){return new _i(this.r,this.g,this.b,this.a)}}class Rm{constructor(e,n,c,h,p,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const x=e.image.height,b=x*x;this.premultiplied?(n=p===0?0:n/p*(x-1),c=p===0?0:c/p*(x-1),h=p===0?0:h/p*(x-1)):(n*=x-1,c*=x-1,h*=x-1);const E=Math.floor(n),I=Math.floor(c),C=Math.floor(h),k=Math.ceil(n),F=Math.ceil(c),N=Math.ceil(h),W=n-E,Z=c-I,X=h-C,le=e.image.data,ce=4*(E+I*b+C*x),de=4*(E+I*b+N*x),Ie=4*(E+F*b+C*x),Ce=4*(E+F*b+N*x),Re=4*(k+I*b+C*x),Le=4*(k+I*b+N*x),Fe=4*(k+F*b+C*x),dt=4*(k+F*b+N*x);if(ce<0||dt>=le.length)throw new Error("out of range");this.r=wr(wr(wr(le[ce],le[de],X),wr(le[Ie],le[Ce],X),Z),wr(wr(le[Re],le[Le],X),wr(le[Fe],le[dt],X),Z),W)/255*(this.premultiplied?p:1),this.g=wr(wr(wr(le[ce+1],le[de+1],X),wr(le[Ie+1],le[Ce+1],X),Z),wr(wr(le[Re+1],le[Le+1],X),wr(le[Fe+1],le[dt+1],X),Z),W)/255*(this.premultiplied?p:1),this.b=wr(wr(wr(le[ce+2],le[de+2],X),wr(le[Ie+2],le[Ce+2],X),Z),wr(wr(le[Re+2],le[Le+2],X),wr(le[Fe+2],le[dt+2],X),Z),W)/255*(this.premultiplied?p:1),this.a=p}else this.r=n,this.g=c,this.b=h,this.a=p}toArray(){const{r:e,g:n,b:c,a:h}=this;return[255*e,255*n,255*c,h]}toHslaArray(){let{r:e,g:n,b:c,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const N=1/h;e*=N,n*=N,c*=N}const p=Math.min(Math.max(e,0),1),g=Math.min(Math.max(n,0),1),x=Math.min(Math.max(c,0),1),b=Math.min(p,g,x),E=Math.max(p,g,x),I=E-b,C=.5*(b+E);if(I===0)return[0,0,100*C,h];const k=C>.5?I/(2-E-b):I/(E+b);let F;switch(E){case p:F=60*((g-x)/I+(g<x?6:0));break;case g:F=60*((x-p)/I+2);break;default:F=60*((p-g)/I+4)}return[F,100*k,100*C,h]}toArray01(){const{r:e,g:n,b:c,a:h}=this;return[e,n,c,h]}toArray01Scaled(e){const{r:n,g:c,b:h}=this;return[n*e,c*e,h*e]}toArray01Linear(){const{r:e,g:n,b:c,a:h}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(c,2.2),h]}}class G_ extends Rm{constructor(e,n,c,h,p){super(e,n,c,h,p,!1)}}class rf extends Rm{constructor(e,n,c,h,p){super(e,n,c,h,p,!0)}}function wr(o,e,n){return o*(1-n)+e*n}function Mm(o,e,n){return o.map((c,h)=>wr(c,e[h],n))}_i.black=new _i(0,0,0,1),_i.white=new _i(1,1,1,1),_i.transparent=new _i(0,0,0,0),_i.red=new _i(1,0,0,1),_i.blue=new _i(0,0,1,1);var bo=Object.freeze({__proto__:null,array:Mm,color:function(o,e,n){return new _i(wr(o.r,e.r,n),wr(o.g,e.g,n),wr(o.b,e.b,n),wr(o.a,e.a,n))},number:wr});class na extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class nf{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[c,h]of n)this.bindings[c]=h}concat(e){return new nf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ia={kind:"null"},ur={kind:"number"},yi={kind:"string"},Ti={kind:"boolean"},ro={kind:"color"},uc={kind:"object"},fi={kind:"value"},sf={kind:"collator"},Il={kind:"formatted"},Rh={kind:"resolvedImage"};function bs(o,e){return{kind:"array",itemType:o,N:e}}function Cn(o){if(o.kind==="array"){const e=Cn(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const N1=[Ia,ur,yi,Ti,ro,Il,uc,bs(fi),Rh];function Mh(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Mh(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const n of N1)if(!Mh(n,e))return null}}return`Expected ${Cn(o)} but found ${Cn(e)} instead.`}function Dm(o,e){return e.some(n=>n.kind===o.kind)}function Dh(o,e){return e.some(n=>n==="null"?o===null:n==="array"?Array.isArray(o):n==="object"?o&&!Array.isArray(o)&&typeof o=="object":n===typeof o)}function Oh(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&Oh(o.itemType,e.itemType):o.kind===e.kind}class Cl{constructor(e,n,c){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class of{constructor(e,n,c,h,p){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=c,this.fontStack=h,this.textColor=p}}class Ms{constructor(e){this.sections=e}static fromString(e){return new Ms([new of(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ms?e:Ms.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const h=n.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(n.text);const c={};n.fontStack&&(c["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(c["font-scale"]=n.scale),n.textColor&&(c["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(c)}return e}}class sa{constructor(e,n={}){if(this.id=wo.from(e),this.options=Object.assign({},n),n.transform){const{a:c,b:h,c:p,d:g,e:x,f:b}=n.transform;this.options.transform=new DOMMatrix([c,h,p,g,x,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:n,c,d:h,e:p,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:n,c,d:h,e:p,f:g}})}static parse(e){let n,c,h,p;try{({name:n,iconsetId:c,params:h,transform:p}=JSON.parse(e)||{})}catch{return null}if(!n)return null;const{a:g,b:x,c:b,d:E,e:I,f:C}=p||{};return new sa({name:n,iconsetId:c},{params:h,transform:new DOMMatrix([g,x,b,E,I,C])})}scaleSelf(e,n){return this.options.transform.scaleSelf(e,n),this}}class Gs{constructor(e,n,c,h,p=!1){this.primaryId=wo.from(e),this.primaryOptions=n,c&&(this.secondaryId=wo.from(c)),this.secondaryOptions=h,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new sa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new sa(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Gs.build({name:e}):e}static build(e,n,c,h){return!e||typeof e=="object"&&!("name"in e)?null:new Gs(e,c,n,h)}}function H_(o,e,n,c){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,e,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,e,n,c]:[o,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cu(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof _i||o instanceof Cl||o instanceof Ms||o instanceof Gs)return!0;if(Array.isArray(o)){for(const e of o)if(!cu(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!cu(o[e]))return!1;return!0}return!1}function Gn(o){if(o===null)return Ia;if(typeof o=="string")return yi;if(typeof o=="boolean")return Ti;if(typeof o=="number")return ur;if(o instanceof _i)return ro;if(o instanceof Cl)return sf;if(o instanceof Ms)return Il;if(o instanceof Gs)return Rh;if(Array.isArray(o)){const e=o.length;let n;for(const c of o){const h=Gn(c);if(n){if(n===h)continue;n=fi;break}n=h}return bs(n||fi,e)}return uc}function Hs(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Ms||o instanceof Gs||o instanceof _i?o.toString():JSON.stringify(o)}class Ur{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cu(e[1]))return n.error("invalid value");const c=e[1];let h=Gn(c);const p=n.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ur(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _i?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ms?this.value.serialize():this.value}}class Ht{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Lh={string:yi,number:ur,boolean:Ti,object:uc};class Sr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let c,h=1;const p=e[0];if(p==="array"){let x,b;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Lh)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Lh[E],h++}else x=fi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}c=bs(x,b)}else c=Lh[p];const g=[];for(;h<e.length;h++){const x=n.parse(e[h],h,fi);if(!x)return null;g.push(x)}return new Sr(c,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(e);if(!Mh(this.type,Gn(c)))return c;if(n===this.args.length-1)throw new Ht(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Cn(Gn(c))} but was expected to be of type ${Cn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){n.push(c.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(c=>c.serialize()))}}class hc{constructor(e){this.type=Il,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let b=null;if(x["font-scale"]&&(b=n.parseObjectValue(x["font-scale"],g,"font-scale",ur),!b))return null;let E=null;if(x["text-font"]&&(E=n.parseObjectValue(x["text-font"],g,"text-font",bs(yi)),!E))return null;let I=null;if(x["text-color"]&&(I=n.parseObjectValue(x["text-color"],g,"text-color",ro),!I))return null;const C=h[h.length-1];C.scale=b,C.font=E,C.textColor=I}else{const b=n.parse(e[g],g,fi);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new hc(h)}evaluate(e){return new Ms(this.sections.map(n=>{const c=n.content.evaluate(e);return Oh(Gn(c),Rh)?new of("",c,null,null,null):new of(Hs(c),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const c={};n.scale&&(c["font-scale"]=n.scale.serialize()),n.font&&(c["text-font"]=n.font.serialize()),n.textColor&&(c["text-color"]=n.textColor.serialize()),e.push(c)}return e}}class uu{constructor(e,n,c,h){this._imageWarnHistory={},this.type=Rh,this.namePrimary=e,this.nameSecondary=n,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let c=1;const h=[];function p(){if(c<e.length){const x=n.parse(e[c],c++,yi);return x?(h.push({image:x,options:{}}),!0):(n.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(c<e.length){const b=e[c];if((x=b)===null||typeof x!="object"||Array.isArray(x))return!0;const E=b.params,I=b.iconset,C=n.concat(c);if(!E&&!I)return c++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const k={},F=C.concat(void 0,"params");for(const N in E){if(!N)return F.error("Image parameter name should be non-empty"),!1;const W=F.concat(void 0,N).parse(E[N],void 0,ro,void 0,{typeAnnotation:"coerce"});if(!W)return!1;k[N]=W}h[h.length-1].options.params=k}if(I){if(typeof I!="object"||I.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!I.id)return C.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=I}return c++,!0}var x;return!0}for(let x=0;x<2;x++)if(!p()||!g())return;return new uu(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,n){const c={};if(n){for(const h in n)if(n[h])try{c[h]=n[h].evaluate(e)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=Gs.build(n,c,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const p=h.getPrimary().id;if(h.available=e.availableImages.some(g=>wo.isEqual(g,p)),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=e.availableImages.some(x=>wo.isEqual(x,g)))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const c={};if(n&&(c.iconset={id:n}),e){c.params={};for(const h in e)e[h]&&(c.params[h]=e[h].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Pr(o){return Fh(o)?"string":Nh(o)?"number":Lm(o)?"boolean":Array.isArray(o)?"array":o===null?"null":Om(o)?"object":typeof o}function Om(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function Fh(o){return typeof o=="string"||o instanceof String}function Nh(o){return typeof o=="number"||o instanceof Number}function Lm(o){return typeof o=="boolean"||o instanceof Boolean}const af={"to-boolean":Ti,"to-color":ro,"to-number":ur,"to-string":yi};class wn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[0],h=[];let p=Ia;if(c==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);p=bs(n.expectedType.itemType,g)}else{if(!(g>0&&cu(e[1][0])))return null;p=bs(Gn(e[1][0]),g)}for(let x=0;x<g;x++){const b=e[1][x];let E;if(Array.isArray(b))E=n.parse(b,void 0,p.itemType);else{const I=Pr(b);if(I!==p.itemType.kind)return n.error(`Expected ${p.itemType.kind} but found ${I}.`);E=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!E)return null;h.push(E)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return n.error("Expected one argument.");p=af[c];for(let g=1;g<e.length;g++){const x=n.parse(e[g],g,fi);if(!x)return null;h.push(x)}}return new wn(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,c;for(const h of this.args){if(n=h.evaluate(e),c=null,n instanceof _i)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:H_(n[0],n[1],n[2],n[3]),!c))return new _i(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ht(c||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const c of this.args){if(n=c.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Ht(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Ms.fromString(Hs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Gs.build(Hs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Hs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new hc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Fm=["Unknown","Point","LineString","Polygon"];class Xa{constructor(e,n,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*n-e[0])+this.featureDistanceData.bearing[1]*(h*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=_i.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Ds{constructor(e,n,c,h,p){this.name=e,this.type=n,this._evaluate=c,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const n=Ds.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const c=e[0],h=Ds.definitions[c];if(!h)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let b=null,E=-1;for(const[I,C]of g){if(Array.isArray(I)&&I.length!==e.length-1)continue;x.push(I),E++,b=new bf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const k=[];let F=!1;for(let N=1;N<e.length;N++){const W=e[N],Z=Array.isArray(I)?I[N-1]:I.type,X=b.parse(W,1+k.length,Z);if(!X){F=!0;break}k.push(X)}if(!F)if(Array.isArray(I)&&I.length!==k.length)b.error(`Expected ${I.length} arguments, but found ${k.length} instead.`);else{for(let N=0;N<k.length;N++){const W=Array.isArray(I)?I[N]:I.type,Z=k[N];b.concat(N+1).checkSubtype(W,Z.type)}if(b.errors.length===0)return new Ds(c,p,C,k,E)}}if(x.length===1)n.errors.push(...b.errors);else{const I=(x.length?x:g.map(([k])=>k)).map(Pl).join(" | "),C=[];for(let k=1;k<e.length;k++){const F=n.parse(e[k],1+C.length);if(!F)return null;C.push(Cn(F.type))}n.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){Ds.definitions=n;for(const c in n)e[c]=Ds}}function Pl(o){return Array.isArray(o)?`(${o.map(Cn).join(", ")})`:`(${Cn(o.type)}...)`}class ls{constructor(e,n,c){this.type=sf,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const h=c["case-sensitive"]===void 0?n.parse(!1,1,Ti):n.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Ti);if(!h)return null;const p=c["diacritic-sensitive"]===void 0?n.parse(!1,1,Ti):n.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Ti);if(!p)return null;let g=null;return c.locale&&(g=n.parseObjectValue(c.locale,1,"locale",yi),!g)?null:new ls(h,p,g)}evaluate(e){return new Cl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function W_(o,e,n=0,c=o.length-1,h=z1){for(;c>n;){if(c-n>600){const b=c-n+1,E=e-n+1,I=Math.log(b),C=.5*Math.exp(2*I/3),k=.5*Math.sqrt(I*C*(b-C)/b)*(E-b/2<0?-1:1);W_(o,e,Math.max(n,Math.floor(e-E*C/b+k)),Math.min(c,Math.floor(e+(b-E)*C/b+k)),h)}const p=o[e];let g=n,x=c;for(zh(o,n,e),h(o[c],p)>0&&zh(o,n,c);g<x;){for(zh(o,g,x),g++,x--;h(o[g],p)<0;)g++;for(;h(o[x],p)>0;)x--}h(o[n],p)===0?zh(o,n,x):(x++,zh(o,x,c)),x<=e&&(n=x+1),e<=x&&(c=x-1)}}function zh(o,e,n){const c=o[e];o[e]=o[n],o[n]=c}function z1(o,e){return o<e?-1:o>e?1:0}function lf(o){let e=0;for(let n,c,h=0,p=o.length,g=p-1;h<p;g=h++)n=o[h],c=o[g],e+=(c.x-n.x)*(n.y+c.y);return e}function hu(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function oa(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function B1(o,e,n){const c=o[0]-e[0],h=o[1]-e[1],p=o[0]-n[0],g=o[1]-n[1];return c*g-p*h==0&&c*p<=0&&h*g<=0}function du(o,e,n=!1){let c=!1;for(let x=0,b=e.length;x<b;x++){const E=e[x];for(let I=0,C=E.length,k=C-1;I<C;k=I++){const F=E[k],N=E[I];if(B1(o,F,N))return n;(p=F)[1]>(h=o)[1]!=(g=N)[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(c=!c)}}var h,p,g;return c}function q_(o,e,n,c){const h=c[0]-n[0],p=c[1]-n[1],g=(o[0]-n[0])*p-h*(o[1]-n[1]),x=(e[0]-n[0])*p-h*(e[1]-n[1]);return g>0&&x<0||g<0&&x>0}function cf(o,e,n,c){return(h=[c[0]-n[0],c[1]-n[1]])[0]*(p=[e[0]-o[0],e[1]-o[1]])[1]-h[1]*p[0]!=0&&!(!q_(o,e,n,c)||!q_(n,c,o,e));var h,p}function uf(o){const e=new bt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new bt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of o[0])e.x>c.x&&(e.x=c.x),e.y>c.y&&(e.y=c.y),n.x<c.x&&(n.x=c.x),n.y<c.y&&(n.y=c.y);return{min:e,max:n}}const kl=8192;function dc(o,e){const n=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*kl),Math.round(c*h*kl)]}function j1(o,e){for(let n=0;n<e.length;n++)if(du(o,e[n]))return!0;return!1}function U1(o,e,n){for(const c of n)for(let h=0,p=c.length,g=p-1;h<p;g=h++)if(cf(o,e,c[g],c[h]))return!0;return!1}function hf(o,e){for(let n=0;n<o.length;++n)if(!du(o[n],e))return!1;for(let n=0;n<o.length-1;++n)if(U1(o[n],o[n+1],e))return!1;return!0}function Z_(o,e){for(let n=0;n<e.length;n++)if(hf(o,e[n]))return!0;return!1}function df(o,e,n){const c=[];for(let h=0;h<o.length;h++){const p=[];for(let g=0;g<o[h].length;g++){const x=dc(o[h][g],n);hu(e,x),p.push(x)}c.push(p)}return c}function Bo(o,e,n){const c=[];for(let h=0;h<o.length;h++){const p=df(o[h],e,n);c.push(p)}return c}function X_(o,e,n,c){if(o[0]<n[0]||o[0]>n[2]){const h=.5*c;let p=o[0]-n[0]>h?-c:n[0]-o[0]>h?c:0;p===0&&(p=o[0]-n[2]>h?-c:n[2]-o[0]>h?c:0),o[0]+=p}hu(e,o)}function K_(o,e,n,c){const h=Math.pow(2,c.z)*kl,p=[c.x*kl,c.y*kl],g=[];if(!o)return g;for(const x of o)for(const b of x){const E=[b.x+p[0],b.y+p[1]];X_(E,e,n,h),g.push(E)}return g}function Y_(o,e,n,c){const h=Math.pow(2,c.z)*kl,p=[c.x*kl,c.y*kl],g=[];if(!o)return g;for(const b of o){const E=[];for(const I of b){const C=[I.x+p[0],I.y+p[1]];hu(e,C),E.push(C)}g.push(E)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of g)for(const E of b)X_(E,e,n,h)}var x;return g}class fc{constructor(e,n){this.type=Ti,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cu(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new fc(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new fc(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new fc(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const x=df(c.coordinates,p,g),b=K_(n.geometry(),h,p,g);if(!oa(h,p))return!1;for(const E of b)if(!du(E,x))return!1}if(c.type==="MultiPolygon"){const x=Bo(c.coordinates,p,g),b=K_(n.geometry(),h,p,g);if(!oa(h,p))return!1;for(const E of b)if(!j1(E,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const x=df(c.coordinates,p,g),b=Y_(n.geometry(),h,p,g);if(!oa(h,p))return!1;for(const E of b)if(!hf(E,x))return!1}if(c.type==="MultiPolygon"){const x=Bo(c.coordinates,p,g),b=Y_(n.geometry(),h,p,g);if(!oa(h,p))return!1;for(const E of b)if(!Z_(E,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Bh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Nm=1/298.257223563,zm=Nm*(2-Nm),fu=Math.PI/180;class pu{static fromTile(e,n,c){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/fu;return new pu(p,c)}static get units(){return Bh}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Bh[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Bh).join(", ")}`);const c=6378.137*fu*(n?Bh[n]:1),h=Math.cos(e*fu),p=1/(1-zm*(1-h*h)),g=Math.sqrt(p);this.kx=c*g*h,this.ky=c*g*p*(1-zm)}distance(e,n){const c=To(e[0]-n[0])*this.kx,h=(e[1]-n[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(e,n){const c=To(n[0]-e[0])*this.kx;return Math.atan2(c,(n[1]-e[1])*this.ky)/fu}destination(e,n,c){const h=c*fu;return this.offset(e,Math.sin(h)*n,Math.cos(h)*n)}offset(e,n,c){return[e[0]+n/this.kx,e[1]+c/this.ky]}lineDistance(e){let n=0;for(let c=0;c<e.length-1;c++)n+=this.distance(e[c],e[c+1]);return n}area(e){let n=0;for(let c=0;c<e.length;c++){const h=e[c];for(let p=0,g=h.length,x=g-1;p<g;x=p++)n+=To(h[p][0]-h[x][0])*(h[p][1]+h[x][1])*(c?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let c=0;if(n<=0)return e[0];for(let h=0;h<e.length-1;h++){const p=e[h],g=e[h+1],x=this.distance(p,g);if(c+=x,c>n)return ff(p,g,(n-(c-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,n,c){let[h,p]=n,g=To(c[0]-h)*this.kx,x=(c[1]-p)*this.ky;if(g!==0||x!==0){const b=(To(e[0]-h)*this.kx*g+(e[1]-p)*this.ky*x)/(g*g+x*x);b>1?(h=c[0],p=c[1]):b>0&&(h+=g/this.kx*b,p+=x/this.ky*b)}return g=To(e[0]-h)*this.kx,x=(e[1]-p)*this.ky,Math.sqrt(g*g+x*x)}pointOnLine(e,n){let c=1/0,h=e[0][0],p=e[0][1],g=0,x=0;for(let b=0;b<e.length-1;b++){let E=e[b][0],I=e[b][1],C=To(e[b+1][0]-E)*this.kx,k=(e[b+1][1]-I)*this.ky,F=0;C===0&&k===0||(F=(To(n[0]-E)*this.kx*C+(n[1]-I)*this.ky*k)/(C*C+k*k),F>1?(E=e[b+1][0],I=e[b+1][1]):F>0&&(E+=C/this.kx*F,I+=k/this.ky*F)),C=To(n[0]-E)*this.kx,k=(n[1]-I)*this.ky;const N=C*C+k*k;N<c&&(c=N,h=E,p=I,g=b,x=F)}return{point:[h,p],index:g,t:Math.max(0,Math.min(1,x))}}lineSlice(e,n,c){let h=this.pointOnLine(c,e),p=this.pointOnLine(c,n);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const g=[h.point],x=h.index+1,b=p.index;!Bm(c[x],g[0])&&x<=b&&g.push(c[x]);for(let E=x+1;E<=b;E++)g.push(c[E]);return Bm(c[b],p.point)||g.push(p.point),g}lineSliceAlong(e,n,c){let h=0;const p=[];for(let g=0;g<c.length-1;g++){const x=c[g],b=c[g+1],E=this.distance(x,b);if(h+=E,h>e&&p.length===0&&p.push(ff(x,b,(e-(h-E))/E)),h>=n)return p.push(ff(x,b,(n-(h-E))/E)),p;h>e&&p.push(b)}return p}bufferPoint(e,n){const c=n/this.ky,h=n/this.kx;return[e[0]-h,e[1]-c,e[0]+h,e[1]+c]}bufferBBox(e,n){const c=n/this.ky,h=n/this.kx;return[e[0]-h,e[1]-c,e[2]+h,e[3]+c]}insideBBox(e,n){return To(e[0]-n[0])>=0&&To(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Bm(o,e){return o[0]===e[0]&&o[1]===e[1]}function ff(o,e,n){const c=To(e[0]-o[0]);return[o[0]+c*n,o[1]+(e[1]-o[1])*n]}function To(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class pf{constructor(e=[],n=(c,h)=>c<h?-1:c>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:c}=this,h=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(c(h,g)>=0)break;n[e]=g,e=p}n[e]=h}_down(e){const{data:n,compare:c}=this,h=this.length>>1,p=n[e];for(;e<h;){let g=1+(e<<1);const x=g+1;if(x<this.length&&c(n[x],n[g])<0&&(g=x),c(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}var Dt=8192;function jm(o,e){return e.dist-o.dist}const mu=100,gu=50;function jh(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;return!0}function Uh(o){return o[1]-o[0]+1}function Ca(o,e){const n=o[1]>=o[0]&&o[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function mf(o,e){if(o[0]>o[1])return[null,null];const n=Uh(o);if(e){if(n===2)return[o,null];const c=Math.floor(n/2);return[[o[0],o[0]+c],[o[0]+c,o[1]]]}{if(n===1)return[o,null];const c=Math.floor(n/2)-1;return[[o[0],o[0]+c],[o[0]+c+1,o[1]]]}}function jo(o,e){const n=[1/0,1/0,-1/0,-1/0];if(!Ca(e,o.length))return n;for(let c=e[0];c<=e[1];++c)hu(n,o[c]);return n}function ri(o){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<o.length;++n)for(let c=0;c<o[n].length;++c)hu(e,o[n][c]);return e}function _u(o,e,n){if(jh(o)||jh(e))return NaN;let c=0,h=0;return o[2]<e[0]&&(c=e[0]-o[2]),o[0]>e[2]&&(c=o[0]-e[2]),o[1]>e[3]&&(h=o[1]-e[3]),o[3]<e[1]&&(h=e[1]-o[3]),n.distance([0,0],[c,h])}function V1(o){return 360*o-180}function $1(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function gf(o,e){const n=Math.pow(2,e.z),c=(o.y/Dt+e.y)/n;return[V1((o.x/Dt+e.x)/n),$1(c)]}function G1(o,e){const n=[];for(let c=0;c<o.length;++c)n.push(gf(o[c],e));return n}function Qi(o,e,n){const c=n.pointOnLine(e,o).point;return n.distance(o,c)}function J_(o,e,n,c,h){const p=n.slice(c[0],c[1]+1);let g=1/0;for(let x=e[0];x<=e[1];++x)if((g=Math.min(g,Qi(o[x],p,h)))===0)return 0;return g}function Um(o,e,n,c,h){const p=Math.min(h.pointToSegmentDistance(o,n,c),h.pointToSegmentDistance(e,n,c)),g=Math.min(h.pointToSegmentDistance(n,o,e),h.pointToSegmentDistance(c,o,e));return Math.min(p,g)}function H1(o,e,n,c,h){if(!Ca(e,o.length)||!Ca(c,n.length))return NaN;let p=1/0;for(let g=e[0];g<e[1];++g)for(let x=c[0];x<c[1];++x){if(cf(o[g],o[g+1],n[x],n[x+1]))return 0;p=Math.min(p,Um(o[g],o[g+1],n[x],n[x+1],h))}return p}function W1(o,e,n,c,h){if(!Ca(e,o.length)||!Ca(c,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let x=c[0];x<=c[1];++x)if((p=Math.min(p,h.distance(o[g],n[x])))===0)return p;return p}function q1(o,e,n){if(du(o,e,!0))return 0;let c=1/0;for(const h of e){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(c=Math.min(c,n.pointToSegmentDistance(o,h[p-1],h[0])))===0||(c=Math.min(c,Qi(o,h,n)))===0)return c}return c}function Z1(o,e,n,c){if(!Ca(e,o.length))return NaN;for(let p=e[0];p<=e[1];++p)if(du(o[p],n,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(const g of n)for(let x=0,b=g.length,E=b-1;x<b;E=x++){if(cf(o[p],o[p+1],g[E],g[x]))return 0;h=Math.min(h,Um(o[p],o[p+1],g[E],g[x],c))}return h}function Q_(o,e){for(const n of o)for(let c=0;c<=n.length-1;++c)if(du(n[c],e,!0))return!0;return!1}function X1(o,e,n,c=1/0){const h=ri(o),p=ri(e);if(c!==1/0&&_u(h,p,n)>=c)return c;if(oa(h,p)){if(Q_(o,e))return 0}else if(Q_(e,o))return 0;let g=c;for(const x of o)for(let b=0,E=x.length,I=E-1;b<E;I=b++)for(const C of e)for(let k=0,F=C.length,N=F-1;k<F;N=k++){if(cf(x[I],x[b],C[N],C[k]))return 0;g=Math.min(g,Um(x[I],x[b],C[N],C[k],n))}return g}function _f(o,e,n,c,h,p,g){if(p===null||g===null)return;const x=_u(jo(c,p),jo(h,g),n);x<e&&o.push({dist:x,range1:p,range2:g})}function K1(o,e,n,c,h=1/0){let p=Math.min(c.distance(o[0],n[0][0]),h);if(p===0)return p;const g=new pf([{dist:0,range1:[0,o.length-1],range2:[0,0]}],jm),x=e?gu:mu,b=ri(n);for(;g.length;){const E=g.pop();if(E.dist>=p)continue;const I=E.range1;if(Uh(I)<=x){if(!Ca(I,o.length))return NaN;if(e){const C=Z1(o,I,n,c);if((p=Math.min(p,C))===0)return p}else for(let C=I[0];C<=I[1];++C){const k=q1(o[C],n,c);if((p=Math.min(p,k))===0)return p}}else{const C=mf(I,e);if(C[0]!==null){const k=_u(jo(o,C[0]),b,c);k<p&&g.push({dist:k,range1:C[0],range2:[0,0]})}if(C[1]!==null){const k=_u(jo(o,C[1]),b,c);k<p&&g.push({dist:k,range1:C[1],range2:[0,0]})}}}return p}function ey(o,e,n,c,h,p=1/0){let g=Math.min(p,h.distance(o[0],n[0]));if(g===0)return g;const x=new pf([{dist:0,range1:[0,o.length-1],range2:[0,n.length-1]}],jm),b=e?gu:mu,E=c?gu:mu;for(;x.length;){const I=x.pop();if(I.dist>=g)continue;const C=I.range1,k=I.range2;if(Uh(C)<=b&&Uh(k)<=E){if(!Ca(C,o.length)||!Ca(k,n.length))return NaN;if(e&&c?g=Math.min(g,H1(o,C,n,k,h)):e||c?e&&!c?g=Math.min(g,J_(n,k,o,C,h)):!e&&c&&(g=Math.min(g,J_(o,C,n,k,h))):g=Math.min(g,W1(o,C,n,k,h)),g===0)return g}else{const F=mf(C,e),N=mf(k,c);_f(x,g,h,o,n,F[0],N[0]),_f(x,g,h,o,n,F[0],N[1]),_f(x,g,h,o,n,F[1],N[0]),_f(x,g,h,o,n,F[1],N[1])}}return g}function Vm(o,e,n,c,h=1/0){let p=h;const g=jo(o,[0,o.length-1]);for(const x of n)if(!(p!==1/0&&_u(g,jo(x,[0,x.length-1]),c)>=p)&&(p=Math.min(p,ey(o,e,x,!0,c,p)),p===0))return p;return p}function yf(o,e,n,c,h=1/0){let p=h;const g=jo(o,[0,o.length-1]);for(const x of n){if(p!==1/0&&_u(g,ri(x),c)>=p)continue;const b=K1(o,e,x,c,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function $m(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class pc{constructor(e,n){this.type=ur,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(cu(e[1])){const c=e[1];if(c.type==="FeatureCollection"){for(let h=0;h<c.features.length;++h)if($m(c.features[h].geometry.type))return new pc(c,c.features[h].geometry)}else if(c.type==="Feature"){if($m(c.geometry.type))return new pc(c,c.geometry)}else if($m(c.type))return new pc(c,c)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),c=e.canonicalID();if(n!=null&&c!=null){if(e.geometryType()==="Point")return function(h,p,g){const x=[];for(const E of h)for(const I of E)x.push(gf(I,p));const b=new pu(x[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?ey(x,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?Vm(x,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?yf(x,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null}(n,c,this.geometries);if(e.geometryType()==="LineString")return function(h,p,g){const x=[];for(const E of h){const I=[];for(const C of E)I.push(gf(C,p));x.push(I)}const b=new pu(x[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Vm(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,b);if(g.type==="MultiLineString"){let E=1/0;for(let I=0;I<g.coordinates.length;I++){const C=Vm(g.coordinates[I],!0,x,b,E);if(isNaN(C))return C;if((E=Math.min(E,C))===0)return E}return E}if(g.type==="Polygon"||g.type==="MultiPolygon"){let E=1/0;for(let I=0;I<x.length;I++){const C=yf(x[I],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E);if(isNaN(C))return C;if((E=Math.min(E,C))===0)return E}return E}return null}(n,c,this.geometries);if(e.geometryType()==="Polygon")return function(h,p,g){const x=[];for(const E of function(I,C){const k=I.length;if(k<=1)return[I];const F=[];let N,W;for(let Z=0;Z<k;Z++){const X=lf(I[Z]);X!==0&&(I[Z].area=Math.abs(X),W===void 0&&(W=X<0),W===X<0?(N&&F.push(N),N=[I[Z]]):N.push(I[Z]))}return N&&F.push(N),F}(h)){const I=[];for(let C=0;C<E.length;++C)I.push(G1(E[C],p));x.push(I)}const b=new pu(x[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return yf(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,b);if(g.type==="MultiLineString"){let E=1/0;for(let I=0;I<g.coordinates.length;I++){const C=yf(g.coordinates[I],!0,x,b,E);if(isNaN(C))return C;if((E=Math.min(E,C))===0)return E}return E}return g.type==="Polygon"||g.type==="MultiPolygon"?function(E,I,C){let k=1/0;for(const F of E)for(const N of I){const W=X1(F,N,C,k);if(isNaN(W))return W;if((k=Math.min(k,W))===0)return k}return k}(g.type==="Polygon"?[g.coordinates]:g.coordinates,x,b):null}(n,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function yu(o){if(o instanceof Ds&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof fc||o instanceof pc)return!1;if(o instanceof vu)return o.featureConstant;let e=!0;return o.eachChild(n=>{e&&!yu(n)&&(e=!1)}),e}function xf(o){if(o instanceof Ds&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(n=>{e&&!xf(n)&&(e=!1)}),e}function vf(o){if(o instanceof vu)return new Set([o.key]);let e=new Set;return o.eachChild(n=>{e=new Set([...e,...vf(n)])}),e}function xu(o,e){if(o instanceof Ds&&e.indexOf(o.name)>=0)return!1;let n=!0;return o.eachChild(c=>{n&&!xu(c,e)&&(n=!1)}),n}function ty(o,e,n){return[o,e,n].filter(Boolean).join("")}function Gm(o,e){switch(o){case"string":return Hs(e);case"number":return+e;case"boolean":return!!e;case"color":return _i.parse(e);case"formatted":return Ms.fromString(Hs(e));case"resolvedImage":return Gs.build(Hs(e))}return e}function ry(o,e,n,c){return c!==void 0&&(o=c*Math.round(o/c)),e!==void 0&&o<e&&(o=e),n!==void 0&&o>n&&(o=n),o}class vu{constructor(e,n,c,h=!1){this.type=e,this.key=n,this.scope=c,this.featureConstant=h}static parse(e,n){let c=n.expectedType;if(c==null&&(c=fi),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const h=n.parse(e[1],1);if(!(h instanceof Ur))return n.error("Key name of 'config' expression must be a string literal.");let p,g=!0;const x=Hs(h.value);if(e.length>=3){const b=n.parse(e[2],2);if(!(b instanceof Ur))return n.error("Scope of 'config' expression must be a string literal.");p=Hs(b.value)}if(n.options){const b=ty(x,p,n._scope),E=n.options.get(b);E&&(g=yu(E.value||E.default))}return new vu(c,x,p,g)}evaluate(e){const n=ty(this.key,this.scope,e.scope),c=e.getConfig(n);if(!c)return null;const{type:h,value:p,values:g,minValue:x,maxValue:b,stepValue:E}=c,I=c.default.evaluate(e);let C=I;if(p){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),C=p.evaluate(e),e.scope=k}return h&&(C=Gm(h,C)),C===void 0||x===void 0&&b===void 0&&E===void 0||(typeof C=="number"?C=ry(C,x,b,E):Array.isArray(C)&&(C=C.map(k=>typeof k=="number"?ry(k,x,b,E):k))),p!==void 0&&C!==void 0&&g&&!g.includes(C)&&(C=I,h&&(C=Gm(h,C))),(h&&h!==this.type||C!==void 0&&!Oh(Gn(C),this.type))&&(C=Gm(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class wf{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=e[1];return n.scope.has(c)?new wf(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class bf{constructor(e,n=[],c,h=new nf,p=[],g,x,b){this.registry=e,this.path=n,this.key=n.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c,this._scope=g,this.options=x,this.iconImageUseTheme=b}parse(e,n,c,h,p={}){return n||c?this.concat(n,null,c,h)._parse(e,p):this._parse(e,p)}parseObjectValue(e,n,c,h,p,g={}){return this.concat(n,c,h,p)._parse(e,g)}_parse(e,n){function c(h,p,g){return g==="assert"?new Sr(p,[h]):g==="coerce"?new wn(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,x=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else p=c(p,g,n.typeAnnotation||"coerce");else p=c(p,g,n.typeAnnotation||"assert")}if(!(p instanceof Ur)&&p.type.kind!=="resolvedImage"&&Hm(p)){const g=new Xa(this._scope,this.options,this.iconImageUseTheme);try{p=new Ur(p.type,p.evaluate(g))}catch(x){return this.error(x.message),null}}return p}return wn.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,c,h){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof n=="string"?p.concat(n):p;const g=h?this.scope.concat(h):this.scope;return new bf(this.registry,p,c||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const c=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new na(c,e))}checkSubtype(e,n){const c=Mh(e,n);return c&&this.error(c),c}}function Hm(o){if(o instanceof wf)return Hm(o.boundExpression);if(o instanceof Ds&&o.name==="error"||o instanceof ls||o instanceof fc||o instanceof pc||o instanceof vu)return!1;const e=o instanceof wn||o instanceof Sr;let n=!0;return o.eachChild(c=>{n=e?n&&Hm(c):n&&c instanceof Ur}),!!n&&yu(o)&&xu(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Tf(o,e){const n=o.length-1;let c,h,p=0,g=n,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),c=o[x],h=o[x+1],c<=e){if(x===n||e<h)return x;p=x+1}else{if(!(c>e))throw new Ht("Input is not a number.");g=x-1}return 0}class Vh{constructor(e,n,c){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(e[1],1,ur);if(!c)return null;const h=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],b=e[g+1],E=g,I=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const C=n.parse(b,I,p);if(!C)return null;p=p||C.type,h.push([x,C])}return new Vh(p,c,h)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return c[0].evaluate(e);const p=n.length;return h>=n[p-1]?c[p-1].evaluate(e):c[Tf(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const iy=.95047,ny=1.08883,sy=4/29,Rl=6/29,oy=3*Rl*Rl,ay=Rl*Rl*Rl,Y1=Math.PI/180,J1=180/Math.PI;function Wm(o){return o>ay?Math.pow(o,1/3):o/oy+sy}function Sf(o){return o>Rl?o*o*o:oy*(o-sy)}function Ef(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Ml(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function qm(o){const e=Ml(o.r),n=Ml(o.g),c=Ml(o.b),h=Wm((.4124564*e+.3575761*n+.1804375*c)/iy),p=Wm((.2126729*e+.7151522*n+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Wm((.0193339*e+.119192*n+.9503041*c)/ny)),alpha:o.a}}function Zm(o){let e=(o.l+16)/116,n=isNaN(o.a)?e:e+o.a/500,c=isNaN(o.b)?e:e-o.b/200;return e=1*Sf(e),n=iy*Sf(n),c=ny*Sf(c),new _i(Ef(3.2404542*n-1.5371385*e-.4985314*c),Ef(-.969266*n+1.8760108*e+.041556*c),Ef(.0556434*n-.2040259*e+1.0572252*c),o.alpha)}function Q1(o,e,n){const c=e-o;return o+n*(c>180||c<-180?c-360*Math.round(c/360):c)}const mc={forward:qm,reverse:Zm,interpolate:function(o,e,n){return{l:wr(o.l,e.l,n),a:wr(o.a,e.a,n),b:wr(o.b,e.b,n),alpha:wr(o.alpha,e.alpha,n)}}},gc={forward:function(o){const{l:e,a:n,b:c}=qm(o),h=Math.atan2(c,n)*J1;return{h:h<0?h+360:h,c:Math.sqrt(n*n+c*c),l:e,alpha:o.a}},reverse:function(o){const e=o.h*Y1,n=o.c;return Zm({l:o.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:o.alpha})},interpolate:function(o,e,n){return{h:Q1(o.h,e.h,n),c:wr(o.c,e.c,n),l:wr(o.l,e.l,n),alpha:wr(o.alpha,e.alpha,n)}}};var ly=Object.freeze({__proto__:null,hcl:gc,lab:mc});class So{constructor(e,n,c,h,p){this.type=e,this.operator=n,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,n,c,h){let p=0;if(e.name==="exponential")p=Af(n,e.base,c,h);else if(e.name==="linear")p=Af(n,1,c,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new tu(g[0],g[1],g[2],g[3]).solve(Af(n,1,c,h))}return p}static parse(e,n){let[c,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,ur),!p)return null;const x=[];let b=null;c==="interpolate-hcl"||c==="interpolate-lab"?b=ro:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let E=0;E<g.length;E+=2){const I=g[E],C=g[E+1],k=E+3,F=E+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const N=n.parse(C,F,b);if(!N)return null;b=b||N.type,x.push([I,N])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new So(b,c,h,p,x):n.error(`Type ${Cn(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return c[0].evaluate(e);const p=n.length;if(h>=n[p-1])return c[p-1].evaluate(e);const g=Tf(n,h),x=So.interpolationFactor(this.interpolation,h,n[g],n[g+1]),b=c[g].evaluate(e),E=c[g+1].evaluate(e);return this.operator==="interpolate"?bo[this.type.kind.toLowerCase()](b,E,x):this.operator==="interpolate-hcl"?gc.reverse(gc.interpolate(gc.forward(b),gc.forward(E),x)):mc.reverse(mc.interpolate(mc.forward(b),mc.forward(E),x))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)n.push(this.labels[c],this.outputs[c].serialize());return n}}function Af(o,e,n,c){const h=c-n,p=o-n;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}class $h{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let c=null;const h=n.expectedType;h&&h.kind!=="value"&&(c=h);const p=[];for(const x of e.slice(1)){const b=n.parse(x,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!b)return null;c=c||b.type,p.push(b)}const g=h&&p.some(x=>Mh(h,x.type));return new $h(g?fi:c,p)}evaluate(e){let n,c=null,h=0;for(const p of this.args){if(h++,c=p.evaluate(e),c&&c instanceof Gs&&!c.available&&(n||(n=c),c=null,h===this.args.length))return n;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class If{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=n.parse(e[p+1],p+1);if(!x)return null;c.push([g,x])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,c);return h?new If(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,c]of this.bindings)e.push(n,c.serialize());return e.push(this.result.serialize()),e}}class Xm{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,ur),h=n.parse(e[2],2,bs(n.expectedType||fi));return c&&h?new Xm(h.type.itemType,c,h):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Ht("Array index out of bounds: negative index");if(n>=c.length)throw new Ht("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new Ht("Array index must be an integer. Use at-interpolated for fractional indices");return c[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Km{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,ur),h=n.parse(e[2],2,bs(n.expectedType||fi));return c&&h?new Km(h.type.itemType,c,h):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Ht(`Array index out of bounds: ${n} < 0.`);if(n>c.length-1)throw new Ht(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n===Math.floor(n))return c[n];const h=Math.floor(n),p=Math.ceil(n),g=c[h],x=c[p];if(typeof g!="number"||typeof x!="number")throw new Ht(`Cannot interpolate between non-number values at index ${n}.`);const b=n-h;return g*(1-b)+x*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Cf{constructor(e,n){this.type=Ti,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,fi),h=n.parse(e[2],2,fi);return c&&h?Dm(c.type,[Ti,yi,ur,Ia,fi])?new Cf(c,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(c.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!Dh(n,["boolean","string","number","null"]))throw new Ht(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(Gn(n))} instead.`);if(!Dh(c,["string","array"]))throw new Ht(`Expected second argument to be of type array or string, but found ${Cn(Gn(c))} instead.`);return c.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Gh{constructor(e,n,c){this.type=ur,this.needle=e,this.haystack=n,this.fromIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,fi),h=n.parse(e[2],2,fi);if(!c||!h)return null;if(!Dm(c.type,[Ti,yi,ur,Ia,fi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(c.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,ur);return p?new Gh(c,h,p):null}return new Gh(c,h)}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Dh(n,["boolean","string","number","null"]))throw new Ht(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(Gn(n))} instead.`);if(!Dh(c,["string","array"]))throw new Ht(`Expected second argument to be of type array or string, but found ${Cn(Gn(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return c.indexOf(n,h)}return c.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wu{constructor(e,n,c,h,p,g){this.inputType=e,this.type=n,this.input=c,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let c,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const p={},g=[];for(let E=2;E<e.length-1;E+=2){let I=e[E];const C=e[E+1];Array.isArray(I)||(I=[I]);const k=n.concat(E);if(I.length===0)return k.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return k.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,Gn(N)))return null}else c=Gn(N);if(p[String(N)]!==void 0)return k.error("Branch labels must be unique.");p[String(N)]=g.length}const F=n.parse(C,E,h);if(!F)return null;h=h||F.type,g.push(F)}const x=n.parse(e[1],1,fi);if(!x)return null;const b=n.parse(e[e.length-1],e.length-1,h);return b?x.type.kind!=="value"&&n.concat(1).checkSubtype(c,x.type)?null:new wu(c,h,x,p,g,b):null}evaluate(e){const n=this.input.evaluate(e);return(Oh(Gn(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),c=[],h={};for(const g of n){const x=h[this.cases[g]];x===void 0?(h[this.cases[g]]=c.length,c.push([this.cases[g],[g]])):c[x][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of c)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class Ym{constructor(e,n,c){this.type=e,this.branches=n,this.otherwise=c}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const x=n.parse(e[g],g,Ti);if(!x)return null;const b=n.parse(e[g+1],g+1,c);if(!b)return null;h.push([x,b]),c=c||b.type}const p=n.parse(e[e.length-1],e.length-1,c);return p?new Ym(c,h,p):null}evaluate(e){for(const[n,c]of this.branches)if(n.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,c]of this.branches)e(n),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Hh{constructor(e,n,c,h){this.type=e,this.input=n,this.beginIndex=c,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,fi),h=n.parse(e[2],2,ur);if(!c||!h)return null;if(!Dm(c.type,[bs(fi),yi,fi]))return n.error(`Expected first argument to be of type array or string, but found ${Cn(c.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,ur);return p?new Hh(c.type,c,h,p):null}return new Hh(c.type,c,h)}evaluate(e){const n=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!Dh(n,["string","array"]))throw new Ht(`Expected first argument to be of type array or string, but found ${Cn(Gn(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(c,h)}return n.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Jm{constructor(e,n){this.type=bs(yi),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,yi),h=n.parse(e[2],2,yi);return c&&h?new Jm(c,h):void 0}evaluate(e){const n=this.str.evaluate(e),c=this.delimiter.evaluate(e);return n.split(c)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function cy(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qm(o,e,n,c){return c.compare(e,n)===0}function _c(o,e,n){const c=o!=="=="&&o!=="!=";return class eD{constructor(p,g,x){this.type=Ti,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let b=g.parse(p[1],1,fi);if(!b)return null;if(!cy(x,b.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Cn(b.type)}'.`);let E=g.parse(p[2],2,fi);if(!E)return null;if(!cy(x,E.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Cn(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Cn(b.type)}' and '${Cn(E.type)}'.`);c&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new Sr(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new Sr(b.type,[E])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,sf),!I)return null}return new eD(b,E,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const b=Gn(g),E=Gn(x);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Ht(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const b=Gn(g),E=Gn(x);if(b.kind!=="string"||E.kind!=="string")return e(p,g,x)}return this.collator?n(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[o];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const ew=_c("==",function(o,e,n){return e===n},Qm),tw=_c("!=",function(o,e,n){return e!==n},function(o,e,n,c){return!Qm(0,e,n,c)}),rw=_c("<",function(o,e,n){return e<n},function(o,e,n,c){return c.compare(e,n)<0}),Pf=_c(">",function(o,e,n){return e>n},function(o,e,n,c){return c.compare(e,n)>0}),iw=_c("<=",function(o,e,n){return e<=n},function(o,e,n,c){return c.compare(e,n)<=0}),nw=_c(">=",function(o,e,n){return e>=n},function(o,e,n,c){return c.compare(e,n)>=0});class e0{constructor(e,n,c,h,p,g){this.type=yi,this.number=e,this.locale=n,this.currency=c,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const c=n.parse(e[1],1,ur);if(!c)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=n.parseObjectValue(h.locale,2,"locale",yi),!p))return null;let g=null;if(h.currency&&(g=n.parseObjectValue(h.currency,2,"currency",yi),!g))return null;let x=null;if(h.unit&&(x=n.parseObjectValue(h.unit,2,"unit",yi),!x))return null;let b=null;if(h["min-fraction-digits"]&&(b=n.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",ur),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=n.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",ur),!E)?null:new e0(c,p,g,x,b,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class t0{constructor(e){this.type=ur,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=n.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Cn(c.type)} instead.`):new t0(c):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ht(`Expected value to be of type string or array, but found ${Cn(Gn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function r0(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const bu={"==":ew,"!=":tw,">":Pf,"<":rw,">=":nw,"<=":iw,array:Sr,at:Xm,"at-interpolated":Km,boolean:Sr,case:Ym,coalesce:$h,collator:ls,format:hc,image:uu,in:Cf,"index-of":Gh,interpolate:So,"interpolate-hcl":So,"interpolate-lab":So,length:t0,let:If,literal:Ur,match:wu,number:Sr,"number-format":e0,object:Sr,slice:Hh,step:Vh,string:Sr,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:wf,within:fc,distance:pc,config:vu,split:Jm};function uy(o,[e,n,c,h]){e=e.evaluate(o),n=n.evaluate(o),c=c.evaluate(o);const p=h?h.evaluate(o):1,g=H_(e,n,c,p);if(g)throw new Ht(g);return new _i(e/255,n/255,c/255,p)}function i0(o,[e,n,c,h]){e=e.evaluate(o),n=n.evaluate(o),c=c.evaluate(o);const p=h?h.evaluate(o):1,g=function(E,I,C,k){return typeof E=="number"&&E>=0&&E<=360?typeof I=="number"&&I>=0&&I<=100&&typeof C=="number"&&C>=0&&C<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[E,I,C,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[E,I,C,k]:[E,I,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[E,I,C,k]:[E,I,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,c,p);if(g)throw new Ht(g);const x=`hsla(${e}, ${n}%, ${c}%, ${p})`,b=_i.parse(x);if(!b)throw new Ht(`Failed to parse HSLA color: ${x}`);return b}function n0(o,e){return o in e}function kf(o,e){const n=e[o];return n===void 0?null:n}function yc(o){return{type:o}}function xc(o){return{result:"success",value:o}}function Dl(o){return{result:"error",value:o}}function s0(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Rf(o){return o["property-type"]==="data-driven"}function o0(o){return s0(o.expression,"measure-light")}function a0(o){return s0(o.expression,"zoom")}function Mf(o){return!!o.expression&&o.expression.interpolated}function Df(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function l0(o){return o}function Of(o,e){const n=e.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",h=c||!(c||o.property!==void 0),p=o.type||(Mf(e)?"exponential":"interval");if(n&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map(E=>[E[0],_i.parse(E[1])])),o.default=_i.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!ly[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let g,x,b;if(p==="exponential")g=hy;else if(p==="interval")g=Ol;else if(p==="categorical"){g=sw,x=Object.create(null);for(const E of o.stops)x[E[0]]=E[1];b=typeof o.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=ow}if(c){const E={},I=[];for(let F=0;F<o.stops.length;F++){const N=o.stops[F],W=N[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:o.type,property:o.property,default:o.default,stops:[]},I.push(W)),E[W].stops.push([N[0].value,N[1]])}const C=[];for(const F of I)C.push([E[F].zoom,Of(E[F],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:So.interpolationFactor.bind(void 0,k),zoomStops:C.map(F=>F[0]),evaluate:({zoom:F},N)=>hy({stops:C,base:o.base},e,F).evaluate(F,N)}}if(h){const E=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:So.interpolationFactor.bind(void 0,E),zoomStops:o.stops.map(I=>I[0]),evaluate:({zoom:I})=>g(o,e,I,x,b)}}return{kind:"source",evaluate(E,I){const C=I&&I.properties?I.properties[o.property]:void 0;return C===void 0?Tu(o.default,e.default):g(o,e,C,x,b)}}}function Tu(o,e,n){return o!==void 0?o:e!==void 0?e:n!==void 0?n:void 0}function sw(o,e,n,c,h){return Tu(typeof n===h?c[n]:void 0,o.default,e.default)}function Ol(o,e,n){if(!Nh(n))return Tu(o.default,e.default);const c=o.stops.length;if(c===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[c-1][0])return o.stops[c-1][1];const h=Tf(o.stops.map(p=>p[0]),n);return o.stops[h][1]}function hy(o,e,n){const c=o.base!==void 0?o.base:1;if(!Nh(n))return Tu(o.default,e.default);const h=o.stops.length;if(h===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[h-1][0])return o.stops[h-1][1];const p=Tf(o.stops.map(I=>I[0]),n),g=function(I,C,k,F){const N=F-k,W=I-k;return N===0?0:C===1?W/N:(Math.pow(C,W)-1)/(Math.pow(C,N)-1)}(n,c,o.stops[p][0],o.stops[p+1][0]),x=o.stops[p][1],b=o.stops[p+1][1];let E=bo[e.type]||l0;if(o.colorSpace&&o.colorSpace!=="rgb"){const I=ly[o.colorSpace];E=(C,k)=>I.reverse(I.interpolate(I.forward(C),I.forward(k),g))}return typeof x.evaluate=="function"?{evaluate(...I){const C=x.evaluate.apply(void 0,I),k=b.evaluate.apply(void 0,I);if(C!==void 0&&k!==void 0)return E(C,k,g)}}:E(x,b,g)}function ow(o,e,n){return e.type==="color"?n=_i.parse(n):e.type==="formatted"?n=Ms.fromString(n.toString()):e.type==="resolvedImage"?n=Gs.build(n.toString()):Pr(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Tu(n,o.default,e.default)}Ds.register(bu,{error:[{kind:"error"},[yi],(o,[e])=>{throw new Ht(e.evaluate(o))}],typeof:[yi,[fi],(o,[e])=>Cn(Gn(e.evaluate(o)))],"to-rgba":[bs(ur,4),[ro],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[bs(ur,4),[ro],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ro,[ur,ur,ur],uy],rgba:[ro,[ur,ur,ur,ur],uy],hsl:[ro,[ur,ur,ur],i0],hsla:[ro,[ur,ur,ur,ur],i0],has:{type:Ti,overloads:[[[yi],(o,[e])=>n0(e.evaluate(o),o.properties())],[[yi,uc],(o,[e,n])=>n0(e.evaluate(o),n.evaluate(o))]]},get:{type:fi,overloads:[[[yi],(o,[e])=>kf(e.evaluate(o),o.properties())],[[yi,uc],(o,[e,n])=>kf(e.evaluate(o),n.evaluate(o))]]},"feature-state":[fi,[yi],(o,[e])=>kf(e.evaluate(o),o.featureState||{})],properties:[uc,[],o=>o.properties()],"geometry-type":[yi,[],o=>o.geometryType()],worldview:[yi,[],o=>o.globals.worldview||""],id:[fi,[],o=>o.id()],zoom:[ur,[],o=>o.globals.zoom],pitch:[ur,[],o=>o.globals.pitch||0],"distance-from-center":[ur,[],o=>o.distanceFromCenter()],"measure-light":[ur,[yi],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[ur,[],o=>o.globals.heatmapDensity||0],"line-progress":[ur,[],o=>o.globals.lineProgress||0],"raster-value":[ur,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[ur,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[ur,[],o=>o.globals.skyRadialProgress||0],accumulated:[fi,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ur,yc(ur),(o,e)=>{let n=0;for(const c of e)n+=c.evaluate(o);return n}],"*":[ur,yc(ur),(o,e)=>{let n=1;for(const c of e)n*=c.evaluate(o);return n}],"-":{type:ur,overloads:[[[ur,ur],(o,[e,n])=>e.evaluate(o)-n.evaluate(o)],[[ur],(o,[e])=>-e.evaluate(o)]]},"/":[ur,[ur,ur],(o,[e,n])=>e.evaluate(o)/n.evaluate(o)],"%":[ur,[ur,ur],(o,[e,n])=>e.evaluate(o)%n.evaluate(o)],ln2:[ur,[],()=>Math.LN2],pi:[ur,[],()=>Math.PI],e:[ur,[],()=>Math.E],"^":[ur,[ur,ur],(o,[e,n])=>Math.pow(e.evaluate(o),n.evaluate(o))],sqrt:[ur,[ur],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[ur,[ur],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[ur,[ur],(o,[e])=>Math.log(e.evaluate(o))],log2:[ur,[ur],(o,[e])=>Math.log2(e.evaluate(o))],sin:[ur,[ur],(o,[e])=>Math.sin(e.evaluate(o))],cos:[ur,[ur],(o,[e])=>Math.cos(e.evaluate(o))],tan:[ur,[ur],(o,[e])=>Math.tan(e.evaluate(o))],asin:[ur,[ur],(o,[e])=>Math.asin(e.evaluate(o))],acos:[ur,[ur],(o,[e])=>Math.acos(e.evaluate(o))],atan:[ur,[ur],(o,[e])=>Math.atan(e.evaluate(o))],min:[ur,yc(ur),(o,e)=>Math.min(...e.map(n=>n.evaluate(o)))],max:[ur,yc(ur),(o,e)=>Math.max(...e.map(n=>n.evaluate(o)))],abs:[ur,[ur],(o,[e])=>Math.abs(e.evaluate(o))],round:[ur,[ur],(o,[e])=>{const n=e.evaluate(o);return n<0?-Math.round(-n):Math.round(n)}],floor:[ur,[ur],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[ur,[ur],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Ti,[yi,fi],(o,[e,n])=>o.properties()[e.value]===n.value],"filter-id-==":[Ti,[fi],(o,[e])=>o.id()===e.value],"filter-type-==":[Ti,[yi],(o,[e])=>o.geometryType()===e.value],"filter-<":[Ti,[yi,fi],(o,[e,n])=>{const c=o.properties()[e.value],h=n.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Ti,[fi],(o,[e])=>{const n=o.id(),c=e.value;return typeof n==typeof c&&n<c}],"filter->":[Ti,[yi,fi],(o,[e,n])=>{const c=o.properties()[e.value],h=n.value;return typeof c==typeof h&&c>h}],"filter-id->":[Ti,[fi],(o,[e])=>{const n=o.id(),c=e.value;return typeof n==typeof c&&n>c}],"filter-<=":[Ti,[yi,fi],(o,[e,n])=>{const c=o.properties()[e.value],h=n.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Ti,[fi],(o,[e])=>{const n=o.id(),c=e.value;return typeof n==typeof c&&n<=c}],"filter->=":[Ti,[yi,fi],(o,[e,n])=>{const c=o.properties()[e.value],h=n.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Ti,[fi],(o,[e])=>{const n=o.id(),c=e.value;return typeof n==typeof c&&n>=c}],"filter-has":[Ti,[fi],(o,[e])=>e.value in o.properties()],"filter-has-id":[Ti,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ti,[bs(yi)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ti,[bs(fi)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Ti,[yi,bs(fi)],(o,[e,n])=>n.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Ti,[yi,bs(fi)],(o,[e,n])=>function(c,h,p,g){for(;p<=g;){const x=p+g>>1;if(h[x]===c)return!0;h[x]>c?g=x-1:p=x+1}return!1}(o.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Ti,overloads:[[[Ti,Ti],(o,[e,n])=>e.evaluate(o)&&n.evaluate(o)],[yc(Ti),(o,e)=>{for(const n of e)if(!n.evaluate(o))return!1;return!0}]]},any:{type:Ti,overloads:[[[Ti,Ti],(o,[e,n])=>e.evaluate(o)||n.evaluate(o)],[yc(Ti),(o,e)=>{for(const n of e)if(n.evaluate(o))return!0;return!1}]]},"!":[Ti,[Ti],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Ti,[yi],(o,[e])=>{const n=o.globals&&o.globals.isSupportedScript;return!n||n(e.evaluate(o))}],upcase:[yi,[yi],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[yi,[yi],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[yi,yc(fi),(o,e)=>e.map(n=>Hs(n.evaluate(o))).join("")],"resolved-locale":[yi,[sf],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[ur,[ur,ur,fi],(o,e)=>{const[n,c,h]=e.map(g=>g.evaluate(o));if(n>c||n===c)return n;let p;if(typeof h=="string")p=function(g){let x=0;if(g.length===0)return x;for(let b=0;b<g.length;b++)x=(x<<5)-x+g.charCodeAt(b),x|=0;return x}(h);else{if(typeof h!="number")throw new Ht(`Invalid seed input: ${h}`);p=h}return n+r0(p)()*(c-n)}]});class Lf{constructor(e,n,c,h,p){this.expression=e,this._warningHistory={},this._evaluator=new Xa(c,h,p),this._defaultValue=n?function(g){return g.type==="color"&&(Df(g.default)||Array.isArray(g.default))?new _i(0,0,0,0):g.type==="color"?_i.parse(g.default)||null:g.default===void 0?null:g.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=vf(e)}evaluateWithoutErrorHandling(e,n,c,h,p,g,x,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,c,h,p,g,x,b,E){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=E||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Ht(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function c0(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in bu}function Pa(o,e,n,c,h){const p=new bf(bu,[],e?function(x){const b={color:ro,string:yi,number:ur,enum:yi,boolean:Ti,formatted:Il,resolvedImage:Rh};return x.type==="array"?bs(b[x.value]||fi,x.length):b[x.type]}(e):void 0,void 0,void 0,n,c,h),g=p.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?xc(new Lf(g,e,n,c,h)):Dl(p.errors)}class Wh{constructor(e,n,c,h){this.kind=e,this._styleExpression=n,this.isLightConstant=c,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!xf(n.expression),this.configDependencies=vf(n.expression)}evaluateWithoutErrorHandling(e,n,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,h,p,g)}evaluate(e,n,c,h,p,g,x){return this._styleExpression.evaluate(e,n,c,h,p,g,void 0,void 0,x)}}class Ll{constructor(e,n,c,h,p,g){this.kind=e,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!xf(n.expression),this.isLightConstant=p,this.isLineProgressConstant=g,this.configDependencies=vf(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,h,p,g)}evaluate(e,n,c,h,p,g){return this._styleExpression.evaluate(e,n,c,h,p,g)}interpolationFactor(e,n,c){return this.interpolationType?So.interpolationFactor(this.interpolationType,e,n,c):0}}function u0(o,e,n,c,h){if((o=Pa(o,e,n,c,h)).result==="error")return o;const p=o.value.expression,g=yu(p);if(!g&&!Rf(e))return Dl([new na("","data expressions not supported")]);const x=xu(p,["zoom","pitch","distance-from-center"]);if(!x&&!a0(e))return Dl([new na("","zoom expressions not supported")]);const b=xu(p,["measure-light"]);if(!b&&!o0(e))return Dl([new na("","measure-light expression not supported")]);const E=xu(p,["line-progress"]);if(!E&&!function(k){return s0(k.expression,"line-progress")}(e))return Dl([new na("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,C=Nf(p);return C||x||I?C instanceof na?Dl([C]):C instanceof So&&!Mf(e)?Dl([new na("",'"interpolate" expressions cannot be used with this property')]):xc(C?new Ll(g&&E?"camera":"composite",o.value,C.labels,C instanceof So?C.interpolation:void 0,b,E):new Wh(g&&E?"constant":"source",o.value,b,E)):Dl([new na("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ff{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,Of(this._parameters,this._specification))}static deserialize(e){return new Ff(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Nf(o){let e=null;if(o instanceof If)e=Nf(o.result);else if(o instanceof $h){for(const n of o.args)if(e=Nf(n),e)break}else(o instanceof Vh||o instanceof So)&&o.input instanceof Ds&&o.input.name==="zoom"&&(e=o);return e instanceof na||o.eachChild(n=>{const c=Nf(n);c instanceof na?e=c:e&&c&&e!==c&&(e=new na("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var qh,zf,dy=function(){if(zf)return qh;zf=1,qh=e;var o=3;function e(n,c,h){var p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var g=new Int32Array(this.arrayBuffer);n=g[0],this.d=(c=g[1])+2*(h=g[2]);for(var x=0;x<this.d*this.d;x++){var b=g[o+x],E=g[o+x+1];p.push(b===E?null:g.subarray(b,E))}var I=g[o+p.length+1];this.keys=g.subarray(g[o+p.length],I),this.bboxes=g.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*h;for(var C=0;C<this.d*this.d;C++)p.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=h,this.scale=c/n,this.uid=0;var k=h/c*n;this.min=-k,this.max=n+k}return e.prototype.insert=function(n,c,h,p,g){this._forEachCell(c,h,p,g,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,c,h,p,g,x){this.cells[g].push(x)},e.prototype.query=function(n,c,h,p,g){var x=this.min,b=this.max;if(n<=x&&c<=x&&b<=h&&b<=p&&!g)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(n,c,h,p,this._queryCell,E,{},g),E},e.prototype._queryCell=function(n,c,h,p,g,x,b,E){var I=this.cells[g];if(I!==null)for(var C=this.keys,k=this.bboxes,F=0;F<I.length;F++){var N=I[F];if(b[N]===void 0){var W=4*N;(E?E(k[W+0],k[W+1],k[W+2],k[W+3]):n<=k[W+2]&&c<=k[W+3]&&h>=k[W+0]&&p>=k[W+1])?(b[N]=!0,x.push(C[N])):b[N]=!1}}},e.prototype._forEachCell=function(n,c,h,p,g,x,b,E){for(var I=this._convertToCellCoord(n),C=this._convertToCellCoord(c),k=this._convertToCellCoord(h),F=this._convertToCellCoord(p),N=I;N<=k;N++)for(var W=C;W<=F;W++){var Z=this.d*W+N;if((!E||E(this._convertFromCellCoord(N),this._convertFromCellCoord(W),this._convertFromCellCoord(N+1),this._convertFromCellCoord(W+1)))&&g.call(this,n,c,h,p,Z,x,b,E))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,c=o+this.cells.length+1+1,h=0,p=0;p<this.cells.length;p++)h+=this.cells[p].length;var g=new Int32Array(c+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=c,b=0;b<n.length;b++){var E=n[b];g[o+b]=x,g.set(E,x),x+=E.length}return g[o+n.length]=x,g.set(this.keys,x),g[o+n.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer},qh}(),vc=Ea(dy);const Su={};function Wt(o,e,n={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Su[e]={klass:o,omit:n.omit||[]}}Wt(Object,"Object"),vc.serialize=function(o,e){const n=o.toArrayBuffer();return e&&e.add(n),{buffer:n}},vc.deserialize=function(o){return new vc(o.buffer)},Object.defineProperty(vc,"name",{value:"Grid"}),Wt(vc,"Grid"),delete bt.prototype.constructor,typeof DOMMatrix<"u"&&Wt(DOMMatrix,"DOMMatrix"),Wt(_i,"Color"),Wt(Error,"Error"),Wt(Ms,"Formatted"),Wt(of,"FormattedSection"),Wt(Im,"AJAXError"),Wt(Gs,"ResolvedImage"),Wt(Ff,"StylePropertyFunction"),Wt(Lf,"StyleExpression",{omit:["_evaluator"]}),Wt(wo,"ImageId"),Wt(sa,"ImageVariant"),Wt(Ll,"ZoomDependentExpression"),Wt(Wh,"ZoomConstantExpression"),Wt(Ds,"CompoundExpression",{omit:["_evaluate"]});for(const o in bu)Su[bu[o]._classRegistryKey]||Wt(bu[o],`Expression${o}`);function h0(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Ka(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Fl(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(h0(o)||Ka(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const n=[];for(const c of o)n.push(Fl(c,e));return n}if(o instanceof Map){const n={$name:"Map",entries:[]};for(const[c,h]of o.entries())n.entries.push(Fl(c),Fl(h,e));return n}if(o instanceof Set){const n={$name:"Set"};let c=0;for(const h of o.values())n[++c]=Fl(h);return n}if(o instanceof DOMMatrix){const n={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of c)n[h]=o[h];return n}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const n=o.constructor,c=n._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const h=n.serialize?n.serialize(o,e):{};if(!n.serialize){for(const p in o)o.hasOwnProperty(p)&&(Su[c].omit.indexOf(p)>=0||(h[p]=Fl(o[p],e)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof o)}function Nl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||h0(o)||Ka(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Nl);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const h=o.entries||[],p=new Map;for(let g=0;g<h.length;g+=2)p.set(Nl(h[g]),Nl(h[g+1]));return p}if(e==="Set"){const h=new Set;for(const p of Object.keys(o))p!=="$name"&&h.add(Nl(o[p]));return h}if(e==="DOMMatrix"){let h;return h=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(o.value);const{klass:n}=Su[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(o);const c=Object.create(n.prototype);for(const h of Object.keys(o))h!=="$name"&&(c[h]=Nl(o[h]));return c}throw new Error("can't deserialize object of type "+typeof o)}const xr={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function d0(o){for(const e of o)if(jf(e.charCodeAt(0)))return!0;return!1}function fy(o){for(const e of o)if(!Bf(e.charCodeAt(0)))return!1;return!0}function Bf(o){return!(xr.Arabic(o)||xr["Arabic Supplement"](o)||xr["Arabic Extended-A"](o)||xr["Arabic Presentation Forms-A"](o)||xr["Arabic Presentation Forms-B"](o))}function jf(o){return!(o!==746&&o!==747&&(o<4352||!(xr["Bopomofo Extended"](o)||xr.Bopomofo(o)||xr["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||xr["CJK Compatibility Ideographs"](o)||xr["CJK Compatibility"](o)||xr["CJK Radicals Supplement"](o)||xr["CJK Strokes"](o)||!(!xr["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||xr["CJK Unified Ideographs Extension A"](o)||xr["CJK Unified Ideographs"](o)||xr["Enclosed CJK Letters and Months"](o)||xr["Hangul Compatibility Jamo"](o)||xr["Hangul Jamo Extended-A"](o)||xr["Hangul Jamo Extended-B"](o)||xr["Hangul Jamo"](o)||xr["Hangul Syllables"](o)||xr.Hiragana(o)||xr["Ideographic Description Characters"](o)||xr.Kanbun(o)||xr["Kangxi Radicals"](o)||xr["Katakana Phonetic Extensions"](o)||xr.Katakana(o)&&o!==12540||!(!xr["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!xr["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||xr["Unified Canadian Aboriginal Syllabics"](o)||xr["Unified Canadian Aboriginal Syllabics Extended"](o)||xr["Vertical Forms"](o)||xr["Yijing Hexagram Symbols"](o)||xr["Yi Syllables"](o)||xr["Yi Radicals"](o))))}function Uf(o){return!(jf(o)||function(e){return!!(xr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xr["Letterlike Symbols"](e)||xr["Number Forms"](e)||xr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xr["Control Pictures"](e)&&e!==9251||xr["Optical Character Recognition"](e)||xr["Enclosed Alphanumerics"](e)||xr["Geometric Shapes"](e)||xr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xr["CJK Symbols and Punctuation"](e)||xr.Katakana(e)||xr["Private Use Area"](e)||xr["CJK Compatibility Forms"](e)||xr["Small Form Variants"](e)||xr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function aw(o){return xr.Arabic(o)||xr["Arabic Supplement"](o)||xr["Arabic Extended-A"](o)||xr["Arabic Presentation Forms-A"](o)||xr["Arabic Presentation Forms-B"](o)}function py(o){return o>=1424&&o<=2303||xr["Arabic Presentation Forms-A"](o)||xr["Arabic Presentation Forms-B"](o)}function lw(o,e){return!(!e&&py(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||xr.Khmer(o))}function cw(o){for(const e of o)if(py(e.charCodeAt(0)))return!0;return!1}const io={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let f0=null,Os=io.unavailable,zl=null;const my=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Os=io.error),f0&&f0(o)};function p0(){m0.fire(new ia("pluginStateChange",{pluginStatus:Os,pluginURL:zl}))}const m0=new cc,Vf=function(){return Os},wc=function(){if(Os!==io.deferred||!zl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os=io.loading,p0(),zl&&ou({url:zl},o=>{o?my(o):(Os=io.loaded,p0())})},ka={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Os===io.loaded||ka.applyArabicShaping!=null,isLoading:()=>Os===io.loading,setState(o){Os=o.pluginStatus,zl=o.pluginURL},isParsing:()=>Os===io.parsing,isParsed:()=>Os===io.parsed,getPluginURL:()=>zl};class Di{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,c){for(const h of n)if(!lw(h.charCodeAt(0),c))return!1;return!0}(e,ka.isLoaded())}}class bc{constructor(e,n,c,h,p){this.property=e,this.value=n,this.expression=function(g,x,b,E,I){if(Df(g))return new Ff(g,x);if(c0(g)||Array.isArray(g)&&g.length>0){const C=u0(g,x,b,E,I);if(C.result==="error")throw new Error(C.value.map(k=>`${k.key}: ${k.message}`).join(", "));return C.value}{let C=g;return typeof g=="string"&&x.type==="color"&&(C=_i.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}}(n===void 0?e.specification.default:n,e.specification,c,h,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,c,h){return this.property.possiblyEvaluate(this,e,n,c,h)}}class g0{constructor(e,n,c,h){this.property=e,this.value=new bc(e,void 0,n,c,h)}transitioned(e,n){return new Ya(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Ya(this.property,this.value,null,{},0)}}class gy{constructor(e,n,c,h){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return it(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new g0(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new bc(this._values[e].property,n===null?void 0:it(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);const c=this._properties.properties;if(e)for(const h in e){const p=e[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);c[g]&&this.setTransition(g,p)}else c.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(e){return it(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new g0(this._values[e].property)),this._values[e].transition=it(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c);const h=this.getTransition(n);h!==void 0&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const c=new _0(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(e,n._values[h]);return c}untransitioned(){const e=new _0(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Ya{constructor(e,n,c,h,p){const g=h.delay||0,x=h.duration||0;p=p||0,this.property=e,this.value=n,this.begin=p+g,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(e,n,c){const h=e.now||0,p=this.value.possiblyEvaluate(e,n,c),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,n,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,c),p,ve(x))}}return p}}class _0{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,c){const h=new Ec(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,n,c);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Tc{constructor(e,n,c,h){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return it(this._values[e].value)}setValue(e,n){this._values[e]=new bc(this._values[e].property,n===null?void 0:it(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c)}return e}possiblyEvaluate(e,n,c,h){const p=new Ec(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,n,c,h);return p}}class Sc{constructor(e,n,c,h){this.property=e,this.value=n,this.parameters=c,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,c,h){return this.property.evaluate(this.value,this.parameters,e,n,c,h,this.iconImageUseTheme)}}class Ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class It{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,c){const h=bo[this.specification.type];return h?h(e,n,c):e}}class Bt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,c,h,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Sc(this,{kind:"constant",value:e.expression.evaluate(n,null,{},c,h,void 0,p)},n):new Sc(this,e.expression,n,p)}interpolate(e,n,c){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Sc(this,{kind:"constant",value:void 0},e.parameters);const h=bo[this.specification.type];return h?new Sc(this,{kind:"constant",value:h(e.value.value,n.value.value,c)},e.parameters):e}evaluate(e,n,c,h,p,g,x){return e.kind==="constant"?e.value:e.evaluate(n,c,h,p,g,void 0,x)}}class Eu{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,h){return!!e.expression.evaluate(n,null,{},c,h)}interpolate(){return!1}}class rn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Di(0,{});for(const c in e){const h=e[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new bc(h,void 0),g=this.defaultTransitionablePropertyValues[c]=new g0(h);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(n)}}}Wt(Bt,"DataDrivenProperty"),Wt(It,"DataConstantProperty"),Wt(Eu,"ColorRampProperty");var Be=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function $f(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ac(o){if(Array.isArray(o))return o.map(Ac);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const n in o)e[n]=Ac(o[n]);return e}return $f(o)}function Gf(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Gf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Zh(o,e="",n=null,c="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gf(o)||(o=Hf(o));const h=o;let p=!0;try{p=function(I){if(!Au(I))return I;let C=Ac(I);return aa(C),C=_y(C),C}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,x=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){x=Be[`filter_${c}`];const I=Pa(p,x,e,n);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));g=(C,k,F)=>I.value.evaluate(C,k,{},F)}let b=null,E=null;if(p!==h){const I=Pa(h,x,e,n);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,k,F,N,W)=>I.value.evaluate(C,k,{},F,void 0,void 0,N,W),E=!yu(I.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:xy(p),needFeature:!!E}}function _y(o){if(!Array.isArray(o))return o;const e=function(n){if(yy.has(n[0])){for(let c=1;c<n.length;c++)if(Au(n[c]))return!0}return n}(o);return e===!0?e:e.map(n=>_y(n))}function aa(o){let e=!1;const n=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)e=e||Au(o[c]),n.push(o[c+1]);n.push(o[o.length-1])}else if(o[0]==="match"){e=e||Au(o[1]);for(let c=2;c<o.length-1;c+=2)n.push(o[c+1]);n.push(o[o.length-1])}else if(o[0]==="step"){e=e||Au(o[1]);for(let c=1;c<o.length-1;c+=2)n.push(o[c+1])}e&&(o.length=0,o.push("any",...n));for(let c=1;c<o.length;c++)aa(o[c])}function Au(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<o.length;n++)if(Au(o[n]))return!0;return!1}const yy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uw(o,e){return o<e?-1:o>e?1:0}function xy(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(xy(o[e]))return!0;return!1}function Hf(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?y0(o[1],o[2],"=="):e==="!="?Wf(y0(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?y0(o[1],o[2],e):e==="any"?(n=o.slice(1),["any"].concat(n.map(Hf))):e==="all"?["all"].concat(o.slice(1).map(Hf)):e==="none"?["all"].concat(o.slice(1).map(Hf).map(Wf)):e==="in"?vy(o[1],o.slice(2)):e==="!in"?Wf(vy(o[1],o.slice(2))):e==="has"?wy(o[1]):e!=="!has"||Wf(wy(o[1]));var n}function y0(o,e,n){switch(o){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,o,e]}}function vy(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",o,["literal",e.sort(uw)]]:["filter-in-small",o,["literal",e]]}}function wy(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Wf(o){return["!",o]}const Xh="";function Iu(o,e){return e?`${o}${Xh}${e}`:o}let x0;const by=()=>x0||(x0=new rn({"icon-size":new Bt(Be.layout_symbol["icon-size"]),"icon-image":new Bt(Be.layout_symbol["icon-image"]),"icon-rotate":new Bt(Be.layout_symbol["icon-rotate"]),"icon-offset":new Bt(Be.layout_symbol["icon-offset"])}));class hw{constructor(e,n,c,h,p,g){const x=Pa(e,Be.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=n,c){this.properties=new Ec(by()),this.unevaluatedLayout=new Tc(by(),h,p,g);for(const b in c)this.unevaluatedLayout.setValue(b,c[b])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const Ty="-transition",Sy=new Set(["fill","line","background","hillshade","raster"]);class Ts extends cc{constructor(e,n,c,h,p,g){if(super(),this.id=e.id,this.fqid=Iu(this.id,c),this.type=e.type,this.scope=c,this.lut=h,this.options=p,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=Pa(this.filter,Be[`filter_${e.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach(x=>{this.appearances.push(new hw(x.condition,x.name,x.properties,this.scope,p,this.iconImageUseTheme))}),n.layout&&(this._unevaluatedLayout=new Tc(n.layout,this.scope,p,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new gy(n.paint,this.scope,p);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ec(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Sy.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Ty)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const c=this._transitionablePaint,h=c._properties.properties;if(e.endsWith(Ty)){const C=e.slice(0,-11);return h[C]&&c.setTransition(C,n||void 0),!1}if(!h[e])return!1;const p=c._values[e],g=p.value.isDataDriven(),x=p.value;c.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=c._values[e].value,E=b.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return E||g||I||this._handleOverridablePaintPropertyUpdate(e,x,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,c){return null}_handleOverridablePaintPropertyUpdate(e,n,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(n=>n.serialize())),st(e,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Sc&&Rf(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Zh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,n,c,h,p,g,x,b,E){}}const Bl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cu{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ui{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ii(o,e=1){let n=0,c=0;return{members:o.map(h=>{const p=Bl[h.type].BYTES_PER_ELEMENT,g=n=Ey(n,Math.max(e,p)),x=h.components||1;return c=Math.max(c,p),n+=p*x,{name:h.name,type:h.type,components:x,offset:g}}),size:Ey(n,Math.max(c,e)),alignment:e}}function Ey(o,e){return Math.ceil(o/e)*e}class jl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=c,e}}jl.prototype.bytesPerElement=4,Wt(jl,"StructArrayLayout2i4");class Ic extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,c)}emplace(e,n,c,h){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.int16[p+2]=h,e}}Ic.prototype.bytesPerElement=6,Wt(Ic,"StructArrayLayout3i6");class Cc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,h)}emplace(e,n,c,h,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=c,this.int16[g+2]=h,this.int16[g+3]=p,e}}Cc.prototype.bytesPerElement=8,Wt(Cc,"StructArrayLayout4i8");class Ul extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ul.prototype.bytesPerElement=4,Wt(Ul,"StructArrayLayout1f4");class v0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,c)}emplace(e,n,c,h){const p=4*e,g=2*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.float32[g+1]=h,e}}v0.prototype.bytesPerElement=8,Wt(v0,"StructArrayLayout2i1f8");class qf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,c)}emplace(e,n,c,h){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.int16[p+2]=h,e}}qf.prototype.bytesPerElement=8,Wt(qf,"StructArrayLayout3i8");class w0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,h,p)}emplace(e,n,c,h,p,g){const x=5*e;return this.int16[x+0]=n,this.int16[x+1]=c,this.int16[x+2]=h,this.int16[x+3]=p,this.int16[x+4]=g,e}}w0.prototype.bytesPerElement=10,Wt(w0,"StructArrayLayout5i10");class Zf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,h,p,g,x)}emplace(e,n,c,h,p,g,x,b){const E=6*e,I=12*e,C=3*e;return this.int16[E+0]=n,this.int16[E+1]=c,this.uint8[I+4]=h,this.uint8[I+5]=p,this.uint8[I+6]=g,this.uint8[I+7]=x,this.float32[C+2]=b,e}}Zf.prototype.bytesPerElement=12,Wt(Zf,"StructArrayLayout2i4ub1f12");class Ws extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,c)}emplace(e,n,c,h){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=c,this.float32[p+2]=h,e}}Ws.prototype.bytesPerElement=12,Wt(Ws,"StructArrayLayout3f12");class Vl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,h,p)}emplace(e,n,c,h,p,g){const x=6*e,b=3*e;return this.uint16[x+0]=n,this.uint16[x+1]=c,this.uint16[x+2]=h,this.uint16[x+3]=p,this.float32[b+2]=g,e}}Vl.prototype.bytesPerElement=12,Wt(Vl,"StructArrayLayout4ui1f12");class Pu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,h)}emplace(e,n,c,h,p){const g=4*e;return this.uint16[g+0]=n,this.uint16[g+1]=c,this.uint16[g+2]=h,this.uint16[g+3]=p,e}}Pu.prototype.bytesPerElement=8,Wt(Pu,"StructArrayLayout4ui8");class Xf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,h,p,g)}emplace(e,n,c,h,p,g,x){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=c,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=g,this.int16[b+5]=x,e}}Xf.prototype.bytesPerElement=12,Wt(Xf,"StructArrayLayout6i12");class b0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C,k){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,c,h,p,g,x,b,E,I,C,k)}emplace(e,n,c,h,p,g,x,b,E,I,C,k,F){const N=12*e;return this.int16[N+0]=n,this.int16[N+1]=c,this.int16[N+2]=h,this.int16[N+3]=p,this.uint16[N+4]=g,this.uint16[N+5]=x,this.uint16[N+6]=b,this.uint16[N+7]=E,this.int16[N+8]=I,this.int16[N+9]=C,this.int16[N+10]=k,this.int16[N+11]=F,e}}b0.prototype.bytesPerElement=24,Wt(b0,"StructArrayLayout4i4ui4i24");class T0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,h,p,g)}emplace(e,n,c,h,p,g,x){const b=10*e,E=5*e;return this.int16[b+0]=n,this.int16[b+1]=c,this.int16[b+2]=h,this.float32[E+2]=p,this.float32[E+3]=g,this.float32[E+4]=x,e}}T0.prototype.bytesPerElement=20,Wt(T0,"StructArrayLayout3i3f20");class la extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,h)}emplace(e,n,c,h,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=c,this.float32[g+2]=h,this.float32[g+3]=p,e}}la.prototype.bytesPerElement=16,Wt(la,"StructArrayLayout4f16");class ku extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ku.prototype.bytesPerElement=4,Wt(ku,"StructArrayLayout1ul4");class Pn extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=c,e}}Pn.prototype.bytesPerElement=4,Wt(Pn,"StructArrayLayout2ui4");class Ru extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C,k,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,c,h,p,g,x,b,E,I,C,k,F)}emplace(e,n,c,h,p,g,x,b,E,I,C,k,F,N){const W=20*e,Z=10*e;return this.int16[W+0]=n,this.int16[W+1]=c,this.int16[W+2]=h,this.int16[W+3]=p,this.int16[W+4]=g,this.float32[Z+3]=x,this.float32[Z+4]=b,this.float32[Z+5]=E,this.float32[Z+6]=I,this.int16[W+14]=C,this.uint32[Z+8]=k,this.uint16[W+18]=F,this.uint16[W+19]=N,e}}Ru.prototype.bytesPerElement=40,Wt(Ru,"StructArrayLayout5i4f1i1ul2ui40");class Kf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,h,p,g,x)}emplace(e,n,c,h,p,g,x,b){const E=8*e;return this.int16[E+0]=n,this.int16[E+1]=c,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=g,this.int16[E+6]=x,this.int16[E+7]=b,e}}Kf.prototype.bytesPerElement=16,Wt(Kf,"StructArrayLayout3i2i2i16");class S0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,h,p)}emplace(e,n,c,h,p,g){const x=4*e,b=8*e;return this.float32[x+0]=n,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[b+6]=p,this.int16[b+7]=g,e}}S0.prototype.bytesPerElement=16,Wt(S0,"StructArrayLayout2f1f2i16");class E0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,h,p,g)}emplace(e,n,c,h,p,g,x){const b=20*e,E=5*e;return this.uint8[b+0]=n,this.uint8[b+1]=c,this.float32[E+1]=h,this.float32[E+2]=p,this.float32[E+3]=g,this.float32[E+4]=x,e}}E0.prototype.bytesPerElement=20,Wt(E0,"StructArrayLayout2ub4f20");class Nn extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,c)}emplace(e,n,c,h){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=c,this.uint16[p+2]=h,e}}Nn.prototype.bytesPerElement=6,Wt(Nn,"StructArrayLayout3ui6");class Kh extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie)}emplace(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie,Ce){const Re=30*e,Le=15*e,Fe=60*e;return this.int16[Re+0]=n,this.int16[Re+1]=c,this.int16[Re+2]=h,this.float32[Le+2]=p,this.float32[Le+3]=g,this.uint16[Re+8]=x,this.uint16[Re+9]=b,this.uint32[Le+5]=E,this.uint32[Le+6]=I,this.uint32[Le+7]=C,this.uint16[Re+16]=k,this.uint16[Re+17]=F,this.uint16[Re+18]=N,this.float32[Le+10]=W,this.float32[Le+11]=Z,this.uint8[Fe+48]=X,this.uint8[Fe+49]=le,this.uint8[Fe+50]=ce,this.uint32[Le+13]=de,this.int16[Re+28]=Ie,this.uint8[Fe+58]=Ce,e}}Kh.prototype.bytesPerElement=60,Wt(Kh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class A0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie,Ce,Re,Le,Fe,dt,je,pt,wt,mt,_t,Et,lt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie,Ce,Re,Le,Fe,dt,je,pt,wt,mt,_t,Et,lt)}emplace(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce,de,Ie,Ce,Re,Le,Fe,dt,je,pt,wt,mt,_t,Et,lt,yt){const Je=20*e,Ze=40*e,At=80*e;return this.float32[Je+0]=n,this.float32[Je+1]=c,this.int16[Ze+4]=h,this.int16[Ze+5]=p,this.int16[Ze+6]=g,this.int16[Ze+7]=x,this.int16[Ze+8]=b,this.int16[Ze+9]=E,this.int16[Ze+10]=I,this.int16[Ze+11]=C,this.int16[Ze+12]=k,this.uint16[Ze+13]=F,this.uint16[Ze+14]=N,this.uint16[Ze+15]=W,this.uint16[Ze+16]=Z,this.uint16[Ze+17]=X,this.uint16[Ze+18]=le,this.uint16[Ze+19]=ce,this.uint16[Ze+20]=de,this.uint16[Ze+21]=Ie,this.uint16[Ze+22]=Ce,this.uint16[Ze+23]=Re,this.uint16[Ze+24]=Le,this.uint16[Ze+25]=Fe,this.uint16[Ze+26]=dt,this.uint16[Ze+27]=je,this.uint32[Je+14]=pt,this.float32[Je+15]=wt,this.float32[Je+16]=mt,this.float32[Je+17]=_t,this.float32[Je+18]=Et,this.uint8[At+76]=lt,this.uint16[Ze+39]=yt,e}}A0.prototype.bytesPerElement=80,Wt(A0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Yh extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,h,p,g)}emplace(e,n,c,h,p,g,x){const b=6*e;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=h,this.float32[b+3]=p,this.float32[b+4]=g,this.float32[b+5]=x,e}}Yh.prototype.bytesPerElement=24,Wt(Yh,"StructArrayLayout6f24");class Pc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,h,p)}emplace(e,n,c,h,p,g){const x=5*e;return this.float32[x+0]=n,this.float32[x+1]=c,this.float32[x+2]=h,this.float32[x+3]=p,this.float32[x+4]=g,e}}Pc.prototype.bytesPerElement=20,Wt(Pc,"StructArrayLayout5f20");class I0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,h,p,g,x)}emplace(e,n,c,h,p,g,x,b){const E=7*e;return this.float32[E+0]=n,this.float32[E+1]=c,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=g,this.float32[E+5]=x,this.float32[E+6]=b,e}}I0.prototype.bytesPerElement=28,Wt(I0,"StructArrayLayout7f28");class Yf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,c,h,p,g,x,b,E,I,C)}emplace(e,n,c,h,p,g,x,b,E,I,C,k){const F=11*e;return this.float32[F+0]=n,this.float32[F+1]=c,this.float32[F+2]=h,this.float32[F+3]=p,this.float32[F+4]=g,this.float32[F+5]=x,this.float32[F+6]=b,this.float32[F+7]=E,this.float32[F+8]=I,this.float32[F+9]=C,this.float32[F+10]=k,e}}Yf.prototype.bytesPerElement=44,Wt(Yf,"StructArrayLayout11f44");class Jh extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,c,h,p,g,x,b,E)}emplace(e,n,c,h,p,g,x,b,E,I){const C=9*e;return this.float32[C+0]=n,this.float32[C+1]=c,this.float32[C+2]=h,this.float32[C+3]=p,this.float32[C+4]=g,this.float32[C+5]=x,this.float32[C+6]=b,this.float32[C+7]=E,this.float32[C+8]=I,e}}Jh.prototype.bytesPerElement=36,Wt(Jh,"StructArrayLayout9f36");class Mu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=c,e}}Mu.prototype.bytesPerElement=8,Wt(Mu,"StructArrayLayout2f8");class Jf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,h)}emplace(e,n,c,h,p){const g=6*e;return this.uint32[3*e+0]=n,this.uint16[g+2]=c,this.uint16[g+3]=h,this.uint16[g+4]=p,e}}Jf.prototype.bytesPerElement=12,Wt(Jf,"StructArrayLayout1ul3ui12");class Qf extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Qf.prototype.bytesPerElement=2,Wt(Qf,"StructArrayLayout1ui2");class C0 extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z){const X=this.length;return this.resize(X+1),this.emplace(X,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z)}emplace(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X){const le=16*e;return this.float32[le+0]=n,this.float32[le+1]=c,this.float32[le+2]=h,this.float32[le+3]=p,this.float32[le+4]=g,this.float32[le+5]=x,this.float32[le+6]=b,this.float32[le+7]=E,this.float32[le+8]=I,this.float32[le+9]=C,this.float32[le+10]=k,this.float32[le+11]=F,this.float32[le+12]=N,this.float32[le+13]=W,this.float32[le+14]=Z,this.float32[le+15]=X,e}}C0.prototype.bytesPerElement=64,Wt(C0,"StructArrayLayout16f64");class Du extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,h,p,g,x)}emplace(e,n,c,h,p,g,x,b){const E=10*e,I=5*e;return this.uint16[E+0]=n,this.uint16[E+1]=c,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[I+2]=g,this.float32[I+3]=x,this.float32[I+4]=b,e}}Du.prototype.bytesPerElement=20,Wt(Du,"StructArrayLayout4ui3f20");class Ou extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Ou.prototype.bytesPerElement=2,Wt(Ou,"StructArrayLayout1i2");class ep extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}ep.prototype.bytesPerElement=1,Wt(ep,"StructArrayLayout1ub1");class Ay extends Cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ay.prototype.size=40;class P0 extends Ru{get(e){return new Ay(this,e)}}Wt(P0,"CollisionBoxArray");class Iy extends Cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Iy.prototype.size=60;class tp extends Kh{get(e){return new Iy(this,e)}}Wt(tp,"PlacedSymbolArray");class Cy extends Cu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Cy.prototype.size=80;class Py extends A0{get(e){return new Cy(this,e)}}Wt(Py,"SymbolInstanceArray");class ky extends Ul{getoffsetX(e){return this.float32[1*e+0]}}Wt(ky,"GlyphOffsetArray");class Ry extends jl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Wt(Ry,"SymbolLineVertexArray");class k0 extends Cu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}k0.prototype.size=12;class My extends Jf{get(e){return new k0(this,e)}}Wt(My,"FeatureIndexArray");class Dy extends Pn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Wt(Dy,"FillExtrusionCentroidArray");class Oy extends Cu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Oy.prototype.size=6;class Ly extends Ic{get(e){return new Oy(this,e)}}Wt(Ly,"FillExtrusionWallArray");const dw=ii([{name:"a_pos",components:2,type:"Int16"}],4),fw=ii([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),pw=ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class en{constructor(e=[]){this.segments=e}_prepareSegment(e,n,c,h){let p=this.segments[this.segments.length-1];return e>en.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${en.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>en.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:n,primitiveOffset:c,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,n,c,h){return this._prepareSegment(e,n.length,c.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,c,h){return new en([{vertexOffset:e,primitiveOffset:n,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function Qh(o,e){return 256*(o=U(Math.floor(o),0,255))+U(Math.floor(e),0,255)}en.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(en,"SegmentVector");const mw=ii([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gw=ii([{name:"a_pattern_b",components:4,type:"Uint16"}]),rp=ii([{name:"a_dash",components:4,type:"Uint16"}]);class ed{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,c,h){this.ids.push(R0(e)),this.positions.push(n,c,h)}eachPosition(e,n){const c=R0(e);let h=0,p=this.ids.length-1;for(;h<p;){const g=h+p>>1;this.ids[g]>=c?p=g:h=g+1}for(;this.ids[h]===c;)n(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,n){const c=new Float64Array(e.ids),h=new Uint32Array(e.positions);return M0(c,h,0,c.length-1),n&&(n.add(c.buffer),n.add(h.buffer)),{ids:c,positions:h}}static deserialize(e){const n=new ed;let c;n.ids=e.ids,n.positions=e.positions;for(const h of n.ids)h!==c&&n.uniqueIds.push(h),c=h;return n.indexed=!0,n}}function R0(o){const e=+o;return Number.isSafeInteger(e)?e:Qd(String(o))}function M0(o,e,n,c){for(;n<c;){const h=o[n+c>>1];let p=n-1,g=c+1;for(;;){do p++;while(o[p]<h);do g--;while(o[g]>h);if(p>=g)break;td(o,p,g),td(e,3*p,3*g),td(e,3*p+1,3*g+1),td(e,3*p+2,3*g+2)}g-n<c-g?(M0(o,e,n,g),n=g+1):(M0(o,e,g+1,c),c=g)}}function td(o,e,n){const c=o[e];o[e]=o[n],o[n]=c}Wt(ed,"FeaturePositionMap");class Ra{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class rd extends Ra{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class pn extends Ra{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ma extends Ra{constructor(e){super(e),this.current=[0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class id extends Ra{constructor(e){super(e),this.current=[0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class nd extends Ra{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Fy extends Ra{constructor(e){super(e),this.current=_i.transparent.toPremultipliedRenderColor(null)}set(e,n,c){this.fetchUniformLocation(e,n)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const _w=new Float32Array(16);class sd extends Ra{constructor(e){super(e),this.current=_w}set(e,n,c){if(this.fetchUniformLocation(e,n)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const yw=new Float32Array(9),xw=new Float32Array(4);class ip extends Ra{constructor(e){super(e),this.current=xw}set(e,n,c){if(this.fetchUniformLocation(e,n)){for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function od(o){return[Qh(255*o.r,255*o.g),Qh(255*o.b,255*o.a)]}class Eo{constructor(e,n,c,h){this.value=e,this.uniformNames=n.map(p=>`u_${p}`),this.type=c,this.context=h}setUniform(e,n,c,h,p){const g=h.constantOr(this.value);n.set(e,p,g instanceof _i?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,n){return this.type==="color"?new Fy(e):new pn(e)}}class kc{constructor(e,n){this.uniformNames=n.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,c,h,p){let g=null;p!=="u_pattern"&&p!=="u_dash"||(g=this.pattern),p==="u_pattern_b"&&(g=this.patternTransition),p==="u_pixel_ratio"&&(g=this.pixelRatio),g&&n.set(e,p,g)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new nd(e):new pn(e)}}class $l{constructor(e,n,c,h){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,c,h,p,g,x,b){const E=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Di(0,{brightness:g,worldview:b}),n,{},p,h,x):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Di(0,{brightness:g,worldview:b}),n,{},p,h,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(E,e,I,C?null:this.context.lut)}updatePaintArray(e,n,c,h,p,g,x,b){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:b},c,h,void 0,p):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Di(0,{brightness:x,worldview:b}),c,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,n,E,I?null:this.context.lut)}_setPaintValue(e,n,c,h){if(this.type==="color"){const p=od(c.toPremultipliedRenderColor(h));for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ja{constructor(e,n,c,h,p,g){this.expression=e,this.uniformNames=n.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=n.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,c,h,p,g,x,b){const E=this.expression.evaluate(new Di(this.context.zoom,{brightness:g,worldview:b}),n,{},p,h,x),I=this.expression.evaluate(new Di(this.context.zoom+1,{brightness:g,worldview:b}),n,{},p,h,x),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Di(0,{brightness:g,worldview:b}),n,{},p,h,x):this.lutExpression.value)==="none",k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,E,I,C?null:this.context.lut)}updatePaintArray(e,n,c,h,p,g,x,b){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:b},c,h,void 0,p),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:b},c,h,void 0,p),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Di(0,{brightness:x,worldview:b}),c,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,n,E,I,C?null:this.context.lut)}_setPaintValue(e,n,c,h,p){if(this.type==="color"){const g=od(c.toPremultipliedRenderColor(p)),x=od(c.toPremultipliedRenderColor(p));for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,g[0],g[1],x[0],x[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,c,h,p){const g=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=U(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);n.set(e,p,x)}getBinding(e,n){return new pn(e)}}class Qa{constructor(e,n,c,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(c==="array"?rp:mw).members;for(let g=0;g<n.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Pu}populatePaintArray(e,n,c,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(e,n,c,h,p,g,x){this._setPaintValues(e,n,c.patterns&&c.patterns[this.layerId],g)}_setPaintValues(e,n,c,h){if(!h||!c)return;const p=h[c[0]],g=h[c[1]];if(p){if(p){const{tl:x,br:b,pixelRatio:E}=p;for(let I=e;I<n;I++)this.paintVertexArray.emplace(I,x[0],x[1],b[0],b[1],E)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:b}=g;for(let E=e;E<n;E++)this.paintTransitionVertexArray.emplace(E,x[0],x[1],b[0],b[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,gw.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Rc{constructor(e,n,c=()=>!0){this.binders={},this._buffers=[],this.context=n;const h=[];for(const p in e.paint._values){const g=e.paint.get(p);if(p.endsWith("-use-theme")||!c(p)||!(g instanceof Sc&&Rf(g.property.specification)))continue;const x=rE(p,e.type),b=g.value,E=g.property.specification.type,I=!!g.property.useIntegerZoom,C=p==="line-dasharray"||p.endsWith("pattern"),k=e.paint.get(`${p}-use-theme`),F=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(b.kind!=="constant"||F)if(b.kind==="source"||F||C){const N=l(p,E,"source");this.binders[p]=C?new Qa(b,x,E,N,e.id):new $l(b,x,E,N),h.push(`/a_${p}`)}else{const N=l(p,E,"composite");this.binders[p]=new Ja(b,x,E,I,n,N),h.push(`/z_${p}`)}else this.binders[p]=C?new kc(b.value,x):new Eo(b.value,x,E,n),h.push(`/u_${p}`);k&&(this.binders[p].lutExpression=k.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof $l||n instanceof Ja?n.maxValue:0}populatePaintArrays(e,n,c,h,p,g,x,b){for(const E in this.binders){const I=this.binders[E];I.context=this.context,(I instanceof $l||I instanceof Ja||I instanceof Qa)&&I.populatePaintArray(e,n,c,h,p,g,x,b)}}setConstantPatternPositions(e,n){for(const c in this.binders){const h=this.binders[c];h instanceof kc&&h.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof Qa?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,c,h,p,g,x,b,E,I){let C=!1;const k=Object.keys(e),F=k.length!==0&&!b,N=F?k:n.uniqueIds;this.context.lut=p.lut;for(const W in this.binders){const Z=this.binders[W];if(Z.context=this.context,(Z instanceof $l||Z instanceof Ja||Z instanceof Qa)&&Z.expression&&Z.expression.kind&&Z.expression.kind!=="constant"&&(Z.expression.isStateDependent===!0||Z.expression.isLightConstant===!1)){const X=p.paint.get(W);Z.expression=X.value;for(const le of N){const ce=e[le.toString()];n.eachPosition(le,(de,Ie,Ce)=>{const Re=h.feature(de);Z.updatePaintArray(Ie,Ce,Re,ce,g,x,E,I)})}if(!F)for(const le of c.uniqueIds){const ce=e[le.toString()];c.eachPosition(le,(de,Ie,Ce)=>{const Re=h.feature(de);Z.updatePaintArray(Ie,Ce,Re,ce,g,x,E,I)})}C=!0}}return C}defines(){const e=[];for(const n in this.binders){const c=this.binders[n];(c instanceof Eo||c instanceof kc)&&e.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Eo||h instanceof kc||h instanceof Ja)for(const p of h.uniformNames)n.push({name:p,property:c,binding:h.getBinding(e,p)})}return n}setUniforms(e,n,c,h,p){for(const{name:g,property:x,binding:b}of c)this.binders[x].setUniform(e,b,p,h.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof $l||n instanceof Ja||n instanceof Qa)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof Qa&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const c=this.binders[n];(c instanceof $l||c instanceof Ja||c instanceof Qa)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof $l||n instanceof Ja||n instanceof Qa)&&n.destroy()}}}class ca{constructor(e,n,c=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Rc(h,n,c);this.needsUpload=!1,this._featureMap=new ed,this._featureMapWithoutIds=new ed,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,c,h,p,g,x,b,E){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,n,h,p,g,x,b,E);n.id!==void 0?this._featureMap.add(n.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,c,h,p,g,x,b){for(const E of c)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,E,h,p,g,x||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ny={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function rE(o,e){return Ny[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const f={"line-pattern":{source:Vl,composite:Vl},"fill-pattern":{source:Vl,composite:Vl},"fill-extrusion-pattern":{source:Vl,composite:Vl},"line-dasharray":{source:Pu,composite:Pu}},i={color:{source:Mu,composite:la},number:{source:Ul,composite:Mu}};function l(o,e,n){const c=f[o];return c&&c[n]||i[e][n]}Wt(Eo,"ConstantBinder"),Wt(kc,"PatternConstantBinder"),Wt($l,"SourceExpressionBinder"),Wt(Qa,"PatternCompositeBinder"),Wt(Ja,"CompositeExpressionBinder"),Wt(Rc,"ProgramConfiguration",{omit:["_buffers"]}),Wt(ca,"ProgramConfigurationSet");const d=Dt/Math.PI/2,_=5,y=6,w=16383,S=64,A=[S,32,16],P=-d,M=d;function z(o,e,n,c=d){return n=ze(n),[o*Math.sin(n)*c,-e*c,o*Math.cos(n)*c]}function D(o,e,n){return z(Math.cos(ze(o)),Math.sin(ze(o)),e,n)}const j=63710088e-1,V=2*Math.PI*j;class G{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new G(Q(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,c=this.lat*n,h=e.lat*n,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return j*Math.acos(Math.min(p,1))}toBounds(e=0){const n=360*e/40075017,c=n/Math.cos(Math.PI/180*this.lat);return new te({lng:this.lng-c,lat:this.lat-n},{lng:this.lng+c,lat:this.lat+n})}toEcef(e){return D(this.lat,this.lng,d+e*d/j)}static convert(e){if(e instanceof G)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new G(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new G(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class te{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}setSouthWest(e){return this._sw=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}extend(e){const n=this._sw,c=this._ne;let h,p;if(e instanceof G)h=e,p=e;else{if(!(e instanceof te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(te.convert(e)):this.extend(G.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(G.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return n||c?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new G(h.lng,h.lat),this._ne=new G(p.lng,p.lat)),this}getCenter(){return new G((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new G(this.getWest(),this.getNorth())}getSouthEast(){return new G(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:c}=G.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(e){if(e)return e instanceof te?e:new te(e)}}const K=0,oe=25.5;function he(o){return V*Math.cos(o*Math.PI/180)}function ge(o){return(180+o)/360}function Se(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function be(o,e){return o/he(e)}function Ee(o){return 360*o-180}function Te(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function we(o,e){return o*he(Te(e))}const Ae=85.051129;function qe(o){return Math.cos(ze(U(o,-Ae,Ae)))}function Ne(o,e){const n=U(e,K,oe),c=Math.pow(2,n);return qe(o)*V/(512*c)}function rt(o){return 1/Math.cos(o*Math.PI/180)}function $e(o,e=0){const n=Math.exp(Math.PI*(1-(o.y+e/Dt)/(1<<o.z)*2));return 80150034*n/(n*n+1)/Dt/(1<<o.z)}class Qe{constructor(e,n,c=0){this.x=+e,this.y=+n,this.z=+c}static fromLngLat(e,n=0){const c=G.convert(e);return new Qe(ge(c.lng),Se(c.lat),be(n,c.lat))}toLngLat(){return new G(Ee(this.x),Te(this.y))}toAltitude(){return we(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/V*rt(Te(this.y))}}function kt(o,e,n,c,h,p,g,x,b){const E=(e+c)/2,I=(n+h)/2,C=new bt(E,I);x(C),function(k,F,N,W,Z,X){const le=N-Z,ce=W-X;return Math.abs((W-F)*le-(N-k)*ce)/Math.hypot(le,ce)}(C.x,C.y,p.x,p.y,g.x,g.y)>=b?(kt(o,e,n,E,I,p,C,x,b),kt(o,E,I,c,h,C,g,x,b)):o.push(g)}function We(o,e,n){let c=o[0],h=c.x,p=c.y;e(c);const g=[c];for(let x=1;x<o.length;x++){const b=o[x],{x:E,y:I}=b;e(b),kt(g,h,p,E,I,c,b,e,n),h=E,p=I,c=b}return g}function Oe(o,e,n,c){if(c(e,n)){const h=e.add(n)._mult(.5);Oe(o,e,h,c),Oe(o,h,n,c)}else o.push(n)}function ot(o,e){let n=o[0];const c=[n];for(let h=1;h<o.length;h++){const p=o[h];Oe(c,n,p,e),n=p}return c}const Xe=Math.pow(2,14)-1,gt=-Xe-1;function Ct(o,e){const n=Math.round(o.x*e),c=Math.round(o.y*e);return o.x=U(n,gt,Xe),o.y=U(c,gt,Xe),(n<o.x||n>o.x+1||c<o.y||c>o.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function jt(o,e,n){const c=o.loadGeometry(),h=o.extent,p=Dt/h;if(e&&n&&n.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:x,x:b,y:E,projection:I}=n,C=k=>{const F=Ee((e.x+k.x/h)/g),N=Te((e.y+k.y/h)/g),W=I.project(F,N);k.x=(W.x*x-b)*h,k.y=(W.y*x-E)*h};for(let k=0;k<c.length;k++)if(o.type!==1)c[k]=We(c[k],C,1);else{const F=[];for(const N of c[k])N.x<0||N.x>=h||N.y<0||N.y>=h||(C(N),F.push(N));c[k]=F}}for(const g of c)for(const x of g)Ct(x,p);return c}function St(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?jt(o):[]}}class xt{constructor(e,n,c,h,p){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(lr,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,c=[];let h,p=1,g=0,x=0,b=0;for(;e.pos<n;){if(g<=0){const E=e.readVarint();p=7&E,g=E>>3}if(g--,p===1||p===2)x+=e.readSVarint(),b+=e.readSVarint(),p===1&&(h&&c.push(h),h=[]),h&&h.push(new bt(x,b));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&c.push(h),c}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let c=1,h=0,p=0,g=0,x=1/0,b=-1/0,E=1/0,I=-1/0;for(;e.pos<n;){if(h<=0){const C=e.readVarint();c=7&C,h=C>>3}if(h--,c===1||c===2)p+=e.readSVarint(),g+=e.readSVarint(),p<x&&(x=p),p>b&&(b=p),g<E&&(E=g),g>I&&(I=g);else if(c!==7)throw new Error(`unknown command ${c}`)}return[x,E,b,I]}toGeoJSON(e,n,c){const h=this.extent*Math.pow(2,c),p=this.extent*e,g=this.extent*n,x=this.loadGeometry();function b(k){return[360*(k.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+g)/h)*Math.PI))-90]}function E(k){return k.map(b)}let I;if(this.type===1){const k=[];for(const N of x)k.push(N[0]);const F=E(k);I=k.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const k=x.map(E);I=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=function(N){const W=N.length;if(W<=1)return[N];const Z=[];let X,le;for(let ce=0;ce<W;ce++){const de=tr(N[ce]);de!==0&&(le===void 0&&(le=de<0),le===de<0?(X&&Z.push(X),X=[N[ce]]):X&&X.push(N[ce]))}return X&&Z.push(X),Z}(x),F=[];for(const N of k)F.push(N.map(E));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const C={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function lr(o,e,n){o===1?e.id=n.readVarint():o===2?function(c,h){const p=c.readVarint()+c.pos;for(;c.pos<p;){const g=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[g]=x}}(n,e):o===3?e.type=n.readVarint():o===4&&(e._geometry=n.pos)}function tr(o){let e=0;for(let n,c,h=0,p=o.length,g=p-1;h<p;g=h++)n=o[h],c=o[g],e+=(c.x-n.x)*(n.y+c.y);return e}xt.types=["Unknown","Point","LineString","Polygon"];class nr{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(er,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new xt(this._pbf,n,this.extent,this._keys,this._values)}}function er(o,e,n){o===15?e.version=n.readVarint():o===1?e.name=n.readString():o===5?e.extent=n.readVarint():o===2?e._features.push(n.pos):o===3?e._keys.push(n.readString()):o===4&&e._values.push(function(c){let h=null;const p=c.readVarint()+c.pos;for(;c.pos<p;){const g=c.readVarint()>>3;h=g===1?c.readString():g===2?c.readFloat():g===3?c.readDouble():g===4?c.readVarint64():g===5?c.readVarint():g===6?c.readSVarint():g===7?c.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(n))}class Rr{constructor(e,n){this.layers=e.readFields(Br,{},n)}}function Br(o,e,n){if(o===3){const c=new nr(n,n.readVarint()+n.pos);c.length&&(e[c.name]=c)}}const $r="3d_elevation_id",xi="level";class Or{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,c){return this.get(e,!0,n,c)}optional(e,n,c){return this.get(e,!1,n,c)}success(){return this._valid}get(e,n,c,h){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?c(h?h(p):p):n&&(this._valid=!1),this}}class li{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,c){return this.featureFunc(e,n,c)}parseVertex(e,n,c){return this.vertexFunc(e,n,c)}}const mi=new li((o,e,n)=>o.reset(e).require($r,c=>{n.id=c}).optional("fixed_height_relative",c=>{n.constantHeight=c},jr.decodeRelativeHeight).geometry(c=>{n.bounds=c},uf).success(),(o,e,n)=>o.reset(e).require($r,c=>{n.id=c}).require("elevation_idx",c=>{n.idx=c}).require("extent",c=>{n.extent=c}).require("height_relative",c=>{n.height=c},jr.decodeRelativeHeight).geometry(c=>{n.position=c},jr.getPoint).success()),Vi=new li((o,e,n)=>o.reset(e).require($r,c=>{n.id=c}).optional("fixed_height",c=>{n.constantHeight=c},jr.decodeMetricHeight).geometry(c=>{n.bounds=c},uf).success(),(o,e,n)=>o.reset(e).require($r,c=>{n.id=c}).require("elevation_idx",c=>{n.idx=c}).require("extent",c=>{n.extent=c}).require("height",c=>{n.height=c},jr.decodeMetricHeight).geometry(c=>{n.position=c},jr.getPoint).success());class jr{static getPoint(e){return xs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Vi:void 0:mi}static parse(e){const n=[],c=[],h=e.length,p=new Or;for(let g=0;g<h;g++){const x=e.feature(g),b=x.properties.version,E=jr.getVersionSchema(b);if(E===void 0){$t(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const I=x.properties.type;if(!I)continue;const C=xt.types[x.type];if(C==="Point"&&I==="curve_point"){const k={};E.parseVertex(p,x,k)&&n.push(k)}else if(C==="Polygon"&&I==="curve_meta"){const k={};E.parseFeature(p,x,k)&&c.push(k)}}return{vertices:n,features:c}}}class hi{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const h=Fn(n,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,!0}}class ci{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const h=dr(n,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,n,c){if(function(F,N){var W=F[0],Z=F[1],X=F[2],le=N[0],ce=N[1],de=N[2];return Math.abs(W-le)<=R*Math.max(1,Math.abs(W),Math.abs(le))&&Math.abs(Z-ce)<=R*Math.max(1,Math.abs(Z),Math.abs(ce))&&Math.abs(X-de)<=R*Math.max(1,Math.abs(X),Math.abs(de))}(this.pos,e)||n===0)return c[0]=c[1]=c[2]=0,!1;const[h,p,g]=this.dir,x=this.pos[0]-e[0],b=this.pos[1]-e[1],E=this.pos[2]-e[2],I=h*h+p*p+g*g,C=2*(x*h+b*p+E*g),k=C*C-4*I*(x*x+b*b+E*E-n*n);if(k<0){const F=Math.max(-C/2,0),N=x+h*F,W=b+p*F,Z=E+g*F,X=Math.hypot(N,W,Z);return c[0]=N*n/X,c[1]=W*n/X,c[2]=Z*n/X,!1}{const F=(-C-Math.sqrt(k))/(2*I);if(F<0){const N=Math.hypot(x,b,E);return c[0]=x*n/N,c[1]=b*n/N,c[2]=E*n/N,!1}return c[0]=x+h*F,c[1]=b+p*F,c[2]=E+g*F,!0}}}class pi{constructor(e,n,c,h,p){this.TL=e,this.TR=n,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,n,c){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],x=[-1,-1,1],b=Qt(h,h,e),E=Qt(p,p,e),I=Qt(g,g,e),C=Qt(x,x,e);return new pi(b,E,I,C,n/c)}}function Hi(o,e,n){let c=1/0,h=-1/0;const p=[];for(const g of o){Pi(p,g,e);const x=dr(p,n);c=Math.min(c,x),h=Math.max(h,x)}return[c,h]}function hn(o,e){let n=!0;for(let c=0;c<o.planes.length;c++){const h=o.planes[c];let p=0;for(let g=0;g<e.length;g++)p+=+(dr(h,e[g])+h[3]>=0);if(p===0)return 0;p!==e.length&&(n=!1)}return n?2:1}function Hn(o,e){for(const n of o.projections){const c=Hi(e,o.points[0],n.axis);if(n.projection[1]<c[0]||n.projection[0]>c[1])return 0}return 1}function Wi(o,e){let n=0;const c=[0,0,0,0];for(let g=0;g<o.length;g++)c[0]=o[g][0],c[1]=o[g][1],c[2]=o[g][2],c[3]=1,(h=c)[0]*(p=e)[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]>=0&&n++;var h,p;return n}class Gr{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Er.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pi([],this.points[2],this.points[3]),Pi([],this.points[0],this.points[3]),Pi([],this.points[4],this.points[0]),Pi([],this.points[5],this.points[1]),Pi([],this.points[6],this.points[2]),Pi([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const h=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:h,projection:Hi(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Hi(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,n,c,h){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const I=un([],E,e),C=1/I[3]/n*p;return(k=I)[0]=(F=I)[0]*(N=[C,C,h?1/I[3]:C,C])[0],k[1]=F[1]*N[1],k[2]=F[2]*N[2],k[3]=F[3]*N[3],k;var k,F,N}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const I=Pt([],br([],Pi([],g[E[0]],g[E[1]]),Pi([],g[E[2]],g[E[1]]))),C=-dr(I,g[E[1]]);return I.concat(C)}),b=[];for(let E=0;E<g.length;E++)b.push([g[E][0],g[E][1],g[E][2]]);return new Gr(b,x)}intersectsPrecise(e,n,c){for(let h=0;h<n.length;h++)if(!Wi(e,n[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Wi(e,this.planes[h]))return 0;for(const h of c)for(const p of this.frustumEdges){const g=br([],h,p),x=Xt(g);if(x===0)continue;gr(g,g,1/x);const b=Hi(this.points,this.points[0],g),E=Hi(e,this.points[0],g);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const c=n[3];if(dr([n[0],n[1],n[2]],e)+c<0)return!1}return!0}}class Er{static fromPoints(e){const n=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of e)yr(n,n,h),vr(c,c,h);return new Er(n,c)}static fromTileIdAndHeight(e,n,c){const h=1<<e.canonical.z,p=e.canonical.x,g=e.canonical.y;return new Er([p/h,g/h,n],[(p+1)/h,(g+1)/h,c])}static applyTransform(e,n){const c=e.getCorners();for(let h=0;h<c.length;++h)Qt(c[h],c[h],n);return Er.fromPoints(c)}static applyTransformFast(e,n){const c=[n[12],n[13],n[14]],h=[...c];for(let p=0;p<3;p++)for(let g=0;g<3;g++){const x=n[4*g+p],b=x*e.min[g],E=x*e.max[g];c[p]+=Math.min(b,E),h[p]+=Math.max(b,E)}return new Er(c,h)}static projectAabbCorners(e,n){const c=e.getCorners();for(let h=0;h<c.length;++h)Qt(c[h],c[h],n);return c}constructor(e,n){this.min=e,this.max=n,this.center=gr([],Ir([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],c=Ot(this.min),h=Ot(this.max);for(let p=0;p<n.length;p++)c[p]=n[p]?this.min[p]:this.center[p],h[p]=n[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Er(c,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?hn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?hn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Hn(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Hn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Wt(Er,"Aabb");class vi{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,c=n[1],h=-n[0],p=(e.extent+1)*this.metersToTile;return[new bt(Math.trunc(e.position[0]+c*p),Math.trunc(e.position[1]+h*p)),new bt(Math.trunc(e.position[0]-c*p),Math.trunc(e.position[1]-h*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class nn{constructor(e,n,c,h,p,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[An(),An(),An(),An(),An(),An(),An()],this.id=e,this.heightRange={min:c,max:c},this.safeArea=n,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=p,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((b=this.vertices[x.a].position)[0]===(E=this.vertices[x.b].position)[0]&&b[1]===E[1]);var b,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:xs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const b=this.vertices[x.a].position,E=this.vertices[x.b].position,I=go(An(),E,b),C=Wa(I),k=Qo(An(),I,1/C);this.edgeProps.push({vec:I,dir:k,len:C});const F=this.vertexProps[x.a].dir,N=this.vertexProps[x.b].dir;Jo(F,F,k),Jo(N,N,k)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||Gi(x.dir,x.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[c,h]=n;return wr(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,h)}computeSlopeNormal(e,n){const c=this.getClosestEdge(e);if(!c)return Dr(0,0,1);const h=c[0],p=this.edges[h],g=this.edgeProps[h].vec,x=Dr(g[0],g[1],(this.vertices[p.b].height-this.vertices[p.a].height)*n),b=Dr(x[1],-x[0],0);br(b,b,x);const E=Xt(b);return E>0?gr(b,b,1/E):ir(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,c=Number.POSITIVE_INFINITY,h=0;const[p,g,x,b,E,I,C]=this._tmpVec2;zo(C,e.x,e.y);const k=new hi(C,null);for(let F=0;F<this.edges.length;F++){const N=this.edges[F],W=this.edgeProps[F].dir;k.dir=W;const Z=this.vertices[N.a].position,X=this.vertices[N.b].position,le=k.intersectsPlane(Z,this.vertexProps[N.a].dir,p),ce=k.intersectsPlane(X,this.vertexProps[N.b].dir,g);if(!le||!ce)continue;go(x,g,p),go(b,C,p);const de=Fn(x,x),Ie=de>0?Fn(b,x)/de:0,Ce=U(Ie,0,1),Re=Math.abs((Ie-Ce)*this.edgeProps[F].len);go(E,C,Z),zo(I,W[1],-W[0]);const Le=Re+Math.abs(Fn(E,I));Le<c&&(n=F,c=Le,h=Ce)}return[n,h]}tessellate(e){const n=tt(),c=tt(),h=tt(),p=tt();for(let g=this.edges.length-1;g>=0;--g){const x=this.edges[g].a,b=this.edges[g].b,{position:E,height:I,extent:C}=this.vertices[x],{position:k,height:F,extent:N}=this.vertices[b],W=this.vertexProps[x].dir,Z=this.vertexProps[b].dir;if(ir(n,E[0]/e,E[1]/e,I),ir(c,k[0]/e,k[1]/e,F),ir(h,W[1],-W[0],0),gr(h,h,C),ir(p,Z[1],-Z[0],0),gr(p,p,N),this.distSqLines(Dr(n[0]+.5*h[0],n[1]+.5*h[1],n[2]+.5*h[2]),Dr(c[0]-.5*p[0],c[1]-.5*p[1],c[2]-.5*p[2]),Dr(n[0]-.5*h[0],n[1]-.5*h[1],n[2]-.5*h[2]),Dr(c[0]+.5*p[0],c[1]+.5*p[1],c[2]+.5*p[2]))<=.0025000000000000005)continue;const X=this.vertices.length,le=Jo(An(),E,k);this.vertices.push({position:Qo(le,le,.5),height:.5*(I+F),extent:.5*(C+N)});const ce=Jo(An(),W,Z);this.vertexProps.push({dir:Gi(ce,ce)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:x,b:X}),this.edges.push({a:X,b});const de=go(An(),this.vertices[X].position,E),Ie=Wa(de),Ce={vec:de,dir:Qo(An(),de,1/Ie),len:Ie};this.edgeProps.push(Ce),this.edgeProps.push(Ce)}}distSqLines(e,n,c,h){const p=ei(tt(),n,e),g=ei(tt(),h,c),x=ei(tt(),e,c),b=dr(p,p),E=dr(p,g),I=dr(p,x),C=dr(g,g),k=dr(g,x),F=b*C-E*E;if(F===0)return vt(ar(p,c,h,dr(x,g)/dr(g,g)),e);const N=(b*k-E*I)/F;return vt(ar(p,e,n,(E*k-I*C)/F),ar(g,c,h,N))}}class Ki{static parseFrom(e,n){const c=jr.parse(e);if(!c)return[];let{vertices:h,features:p}=c;const g=1/$e(n);p.sort((I,C)=>I.id-C.id),h.sort((I,C)=>I.id-C.id||I.idx-C.idx),h=h.filter((I,C,k)=>C===k.findIndex(F=>F.id===I.id&&F.idx===I.idx));const x=new Array;let b=0;const E=h.length;for(const I of p){if(I.constantHeight){x.push(new nn(I.id,I.bounds,I.constantHeight));continue}for(;b!==E&&h[b].id<I.id;)b++;if(b===E||h[b].id!==I.id)continue;const C=new Array,k=new Array,F=b;for(;b!==E&&h[b].id===I.id;){const N=h[b];if(C.push({position:N.position,height:N.height,extent:N.extent}),b!==F&&h[b-1].idx===N.idx-1){const W=b-F;k.push({a:W-1,b:W})}b++}x.push(new nn(I.id,I.bounds,void 0,C,k,g))}return x}static getElevationFeature(e,n){if(!n)return;const c=+e.properties[$r];return Number.isNaN(c)?void 0:n.find(h=>h.id===c)}}class bn{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Dt,this.yOffset=(e.y*this.zScale-n.y)*Dt)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,c){const h=this.constantElevation(n,c);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),c))}computeBiasedHeight(e,n){return n<=0?e:e+n*ae(0,n,e>=0?e:Math.abs(.5*e))}}Wt(nn,"ElevationFeature");class ts{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new jl,this.indexArray=new Nn,this.segments=new en,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ul),this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,c,h){const p=this.layers[0],g=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:E,id:I,index:C,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,N=St(E,F);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),N,c))continue;const W=x?x.evaluate(N,{},c):void 0,Z={id:I,properties:E.properties,type:E.type,sourceLayerIndex:k,index:C,geometry:F?N.geometry:jt(E,c,h),patterns:{},sortKey:W};g.push(Z)}x&&g.sort((E,I)=>E.sortKey-I.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Xf,b=h.projection);for(const E of g){const{geometry:I,index:C,sourceLayerIndex:k}=E,F=e[C].feature;this.addFeature(E,I,C,n.availableImages,c,b,n.brightness,n.elevationFeatures),n.featureIndex.insert(F,I,C,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,c,h,p,g,x){this.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,pw.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,fw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,c,h,p,g,x,b){let E;this.elevationMode!=="none"&&(E=Ki.getElevationFeature(e,b));for(const I of n)for(const C of I){const k=C.x,F=C.y;if(k<0||k>=Dt||F<0||F>=Dt)continue;if(g){const Z=g.projectTilePoint(k,F,p),X=g.upVector(p,k,F);this.addGlobeExtVertex(Z,X),this.addGlobeExtVertex(Z,X),this.addGlobeExtVertex(Z,X),this.addGlobeExtVertex(Z,X)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),W=N.vertexLength;if(this.addCircleVertex(k,F,-1,-1),this.addCircleVertex(k,F,1,-1),this.addCircleVertex(k,F,1,1),this.addCircleVertex(k,F,-1,1),this.elevationMode!=="none"){const Z=E?E.pointElevation(new bt(k,F)):0;this.hasElevation=this.hasElevation||Z!==0;for(let X=0;X<4;X++)this.elevatedLayoutVertexArray.emplaceBack(Z)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},h,p,x,void 0,this.worldview)}addCircleVertex(e,n,c,h){this.layoutVertexArray.emplaceBack(2*e+(c+1)/2,2*n+(h+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Ao(o,e){for(let n=0;n<o.length;n++)if(Wn(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(Wn(o,e[n]))return!0;return!!Ls(o,e)}function Io(o,e,n){return!!Wn(o,e)||!!dn(e,o,n)}function no(o,e){if(o.length===1)return kn(e,o[0]);for(let n=0;n<e.length;n++){const c=e[n];for(let h=0;h<c.length;h++)if(Wn(o,c[h]))return!0}for(let n=0;n<o.length;n++)if(kn(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(Ls(o,e[n]))return!0;return!1}function so(o,e,n){if(o.length>1){if(Ls(o,e))return!0;for(let c=0;c<e.length;c++)if(dn(e[c],o,n))return!0}for(let c=0;c<o.length;c++)if(dn(o[c],e,n))return!0;return!1}function Ls(o,e){if(o.length===0||e.length===0)return!1;for(let n=0;n<o.length-1;n++){const c=o[n],h=o[n+1];for(let p=0;p<e.length-1;p++)if(Uo(c,h,e[p],e[p+1]))return!0}return!1}function Uo(o,e,n,c){return Kt(o,n,c)!==Kt(e,n,c)&&Kt(o,e,n)!==Kt(o,e,c)}function ua(o,e,n){return(o.x-n.x)*(e.y-n.y)-(o.y-n.y)*(e.x-n.x)}function an(o,e,n,c){const h=ua(o,e,c),p=ua(o,e,n);if(Math.sign(h)===Math.sign(p))return;const g=ua(n,c,o),x=g+p-h;return Math.sign(g)!==Math.sign(x)?[g/(g-x),p/(p-h)]:void 0}function dn(o,e,n){const c=n*n;if(e.length===1)return o.distSqr(e[0])<c;for(let h=1;h<e.length;h++)if(Yi(o,e[h-1],e[h])<c)return!0;return!1}function Yi(o,e,n){const c=e.distSqr(n);if(c===0)return o.distSqr(e);const h=((o.x-e.x)*(n.x-e.x)+(o.y-e.y)*(n.y-e.y))/c;return o.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function kn(o,e){let n,c,h,p=!1;for(let g=0;g<o.length;g++){n=o[g];for(let x=0,b=n.length-1;x<n.length;b=x++)c=n[x],h=n[b],c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function Wn(o,e){let n=!1;for(let c=0,h=o.length-1;c<o.length;h=c++){const p=o[c],g=o[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function mn(o,e,n,c,h){for(const g of o)if(e<=g.x&&n<=g.y&&c>=g.x&&h>=g.y)return!0;const p=[new bt(e,n),new bt(e,h),new bt(c,h),new bt(c,n)];if(o.length>2){for(const g of p)if(Wn(o,g))return!0}for(let g=0;g<o.length-1;g++)if(hs(o[g],o[g+1],p))return!0;return!1}function hs(o,e,n){const c=n[0],h=n[2];if(o.x<c.x&&e.x<c.x||o.x>h.x&&e.x>h.x||o.y<c.y&&e.y<c.y||o.y>h.y&&e.y>h.y)return!1;const p=Kt(o,e,n[0]);return p!==Kt(o,e,n[1])||p!==Kt(o,e,n[2])||p!==Kt(o,e,n[3])}function Da(o,e,n,c,h,p){let g=e.y-o.y,x=o.x-e.x;if(p=p||0){const b=g*g+x*x;if(b===0)return!0;const E=Math.sqrt(b);g/=E,x/=E}return!((n.x-o.x)*g+(n.y-o.y)*x-p<0||(c.x-o.x)*g+(c.y-o.y)*x-p<0||(h.x-o.x)*g+(h.y-o.y)*x-p<0)}function el(o,e,n,c,h,p,g){return!(Da(o,e,c,h,p,g)||Da(e,n,c,h,p,g)||Da(n,o,c,h,p,g)||Da(c,h,o,e,n,g)||Da(h,p,o,e,n,g)||Da(p,c,o,e,n,g))}function ha(o,e,n){const c=e.paint.get(o).value;return c.kind==="constant"?c.value:n.programConfigurations.get(e.id).getMaxValue(o)}function Gl(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Hl(o,e,n,c,h){if(!e[0]&&!e[1])return o;const p=bt.convert(e)._mult(h);n==="viewport"&&p._rotate(-c);const g=[];for(let x=0;x<o.length;x++)g.push(o[x].sub(p));return g}function Oa(o,e,n,c){const h=bt.convert(o)._mult(c);return e==="viewport"&&h._rotate(-n),h}let Lu,tl;function La(o,e,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[o*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}Wt(ts,"CircleBucket",{omit:["layers"]});class rl{constructor(e,n,c){this.z=e,this.x=n,this.y=c,this.key=sp(0,e,e,n,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const c=function(p,g,x){var b=La(256*p,256*(g=Math.pow(2,x)-g-1),x),E=La(256*(p+1),256*(g+1),x);return b[0]+","+b[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(p,g,x){let b,E="";for(let I=p;I>0;I--)b=1<<I-1,E+=(g&b?1:0)+(x&b?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class np{constructor(e,n){this.wrap=e,this.canonical=n,this.key=sp(e,n.z,n.z,n.x,n.y)}}class Fs{constructor(e,n,c,h,p){this.overscaledZ=e,this.wrap=n,this.canonical=new rl(c,+h,+p),this.key=n===0&&e===c?this.canonical.key:sp(n,e,c,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Fs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fs(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return sp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return sp(this.wrap*+n,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Fs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Fs(n,this.wrap,n,c,h),new Fs(n,this.wrap,n,c+1,h),new Fs(n,this.wrap,n,c,h+1),new Fs(n,this.wrap,n,c+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new np(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sp(o,e,n,c,h){const p=1<<Math.min(n,22);let g=p*(h%p)+c%p;return o&&n<22&&(g+=p*p*((o<0?-2*o-1:2*o)%(1<<2*(22-n)))),16*(32*g+n)+(e-n)}const FO=[o=>{let e=o.canonical.x-1,n=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,n--),new Fs(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,n=o.wrap;return e===1<<o.canonical.z&&(e=0,n++),new Fs(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>new Fs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Fs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Wt(rl,"CanonicalTileID"),Wt(Fs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const NO=ii([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zy}=NO,zO=ii([{name:"a_pos_3",components:3,type:"Int16"}]);var iE=ii([{name:"a_pos",type:"Int16",components:2}]);function By(o){return o*d/j}const BO=[new Er([P,P,P],[M,M,M]),new Er([P,P,P],[0,0,M]),new Er([0,P,P],[M,0,M]),new Er([P,0,P],[0,M,M]),new Er([0,0,P],[M,M,M])];function nE(o,e,n,c=!0){const h=gr([],o._camera.position,o.worldSize),p=[e,n,1,1];un(p,p,o.pixelMatrixInverse),si(p,p,1/p[3]);const g=Pt([],Pi([],p,h)),x=o.globeMatrix,b=[x[12],x[13],x[14]],E=Pi([],b,h),I=Xt(E),C=Pt([],E),k=o.worldSize/(2*Math.PI),F=dr(C,g),N=Math.asin(k/I);if(N<Math.acos(F)){if(!c)return null;const dt=[],je=[];gr(dt,g,I/F),Pt(je,Pi(je,dt,E)),Pt(g,Ir(g,E,gr(g,je,Math.tan(N)*I)))}const W=[];new ci(h,g).closestPointOnSphere(b,k,W);const Z=Pt([],ji(x,0)),X=Pt([],ji(x,1)),le=Pt([],ji(x,2)),ce=dr(Z,W),de=dr(X,W),Ie=dr(le,W),Ce=Y(Math.asin(-de/k));let Re=Y(Math.atan2(ce,Ie));Re=o.center.lng+function(dt,je){const pt=(je-dt+180)%360-180;return pt<-180?pt+360:pt}(o.center.lng,Re);const Le=ge(Re),Fe=U(Se(Ce),0,1);return new Qe(Le,Fe)}class jO{constructor(e,n,c){this.a=Pi([],e,c),this.b=Pi([],n,c),this.center=c;const h=Pt([],this.a),p=Pt([],this.b);this.angle=Math.acos(dr(h,p))}}function vw(o,e){if(o.angle===0)return null;let n;return n=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),n<0||n>1?null:function(c,h,p,g){const x=Math.sin(p);return c*(Math.sin((1-g)*p)/x)+h*(Math.sin(g*p)/x)}(o.a[e],o.b[e],o.angle,U(n,0,1))+o.center[e]}function Wl(o){if(o.z<=1)return BO[o.z+2*o.y+o.x];const e=ww(jy(o));return Er.fromPoints(e)}function Mc(o,e,n){return gr(o,o,1-n),Ue(o,o,e,n)}function sE(o,e,n){for(const c of o)Qt(c,c,e),gr(c,c,n)}function oE(o,e,n,c){const h=e/o.worldSize,p=o.globeMatrix;if(n.z<=1){const Fe=Wl(n).getCorners();return sE(Fe,p,h),Er.fromPoints(Fe)}const g=jy(n,c),x=ww(g,d+By(o._tileCoverLift));sE(x,p,h);const b=Number.MAX_VALUE,E=[-b,-b,-b],I=[b,b,b];if(g.contains(o.center)){for(const je of x)yr(I,I,je),vr(E,E,je);E[2]=0;const Fe=o.point,dt=[Fe.x*h,Fe.y*h,0];return yr(I,I,dt),vr(E,E,dt),new Er(I,E)}if(o._tileCoverLift>0){for(const Fe of x)yr(I,I,Fe),vr(E,E,Fe);return new Er(I,E)}const C=[p[12]*h,p[13]*h,p[14]*h],k=g.getCenter(),F=U(o.center.lat,-Ae,Ae),N=U(k.lat,-Ae,Ae),W=ge(o.center.lng),Z=Se(F);let X=W-ge(k.lng);const le=Z-Se(N);X>.5?X-=1:X<-.5&&(X+=1);let ce=0;Math.abs(X)>Math.abs(le)?ce=X>=0?1:3:(ce=le>=0?0:2,Ue(C,C,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(ze(le>=0?g.getSouth():g.getNorth()))*d));const de=x[ce],Ie=x[(ce+1)%4],Ce=new jO(de,Ie,C),Re=[vw(Ce,0)||de[0],vw(Ce,1)||de[1],vw(Ce,2)||de[2]],Le=Fu(o.zoom);if(Le>0){const Fe=function({x:je,y:pt,z:wt},mt,_t,Et,lt){const yt=1/(1<<wt);let Je=je*yt,Ze=Je+yt,At=pt*yt,Tt=At+yt,hr=0;const Gt=(Je+Ze)/2-Et;return Gt>.5?hr=-1:Gt<-.5&&(hr=1),Je=((Je+hr)*mt-(Et*=mt))*_t+Et,Ze=((Ze+hr)*mt-Et)*_t+Et,At=(At*mt-(lt*=mt))*_t+lt,Tt=(Tt*mt-lt)*_t+lt,[[Je,Tt,0],[Ze,Tt,0],[Ze,At,0],[Je,At,0]]}(n,e,o._pixelsPerMercatorPixel,W,Z);for(let je=0;je<x.length;je++)Mc(x[je],Fe[je],Le);const dt=Ir([],Fe[ce],Fe[(ce+1)%4]);gr(dt,dt,.5),Mc(Re,dt,Le)}for(const Fe of x)yr(I,I,Fe),vr(E,E,Fe);return I[2]=Math.min(de[2],Ie[2]),yr(I,I,Re),vr(E,E,Re),new Er(I,E)}function jy({x:o,y:e,z:n},c=!1){const h=1/(1<<n),p=new G(Ee(o*h),e===(1<<n)-1&&c?-90:Te((e+1)*h)),g=new G(Ee((o+1)*h),e===0&&c?90:Te(e*h));return new te(p,g)}function ww(o,e=d){const n=ze(o.getNorth()),c=ze(o.getSouth()),h=Math.cos(n),p=Math.cos(c),g=Math.sin(n),x=Math.sin(c),b=o.getWest(),E=o.getEast();return[z(p,x,b,e),z(p,x,E,e),z(h,g,E,e),z(h,g,b,e)]}function D0(o,e,n,c){const h=1<<n.z,p=(o/Dt+n.x)/h;return D(Te((e/Dt+n.y)/h),Ee(p),c)}function Uy({min:o,max:e}){return w/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const aE=new Float64Array(16);function Vy(o){const e=Uy(o),n=De(aE,[e,e,e]);return ue(n,n,ht([],o.min))}function bw(o){const e=(c=o.min,(n=aE)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=c[0],n[13]=c[1],n[14]=c[2],n[15]=1,n);var n,c;const h=1/Uy(o);return ie(e,e,[h,h,h])}function Tw(o){const e=Dt/(2*Math.PI);return o/(2*Math.PI)/e}function lE(o,e){return Dt/(512*Math.pow(2,o))*Uy(Wl(e))}function cE(o,e,n,c,h){const p=Tw(n),g=[o,e,-n/(2*Math.PI)],x=J(new Float64Array(16));return ue(x,x,g),ie(x,x,[p,p,p]),ke(x,x,ze(-h)),at(x,x,ze(-c)),x}function Fu(o){return ae(_,y,o)}function uE(o,e){const n=D(e.lat,e.lng),c=function(N){const W=D(N._center.lat,N._center.lng);let Z=br([],Dr(0,1,0),W);const X=et([],-N.angle,W);Z=Qt(Z,Z,X),et(X,-N._pitch,Z);const le=Pt([],W);return gr(le,le,By(N.cameraToCenterDistance/N.pixelsPerMeter)),Qt(le,le,X),Ir([],W,le)}(o);return g=(h=ei([],c,n))[0],x=h[1],b=h[2],E=(p=n)[0],I=p[1],C=p[2],F=(k=Math.sqrt((g*g+x*x+b*b)*(E*E+I*I+C*C)))&&dr(h,p)/k,Math.acos(Math.min(Math.max(F,-1),1));var h,p,g,x,b,E,I,C,k,F}function Sw(o,e){return uE(o,e)>Math.PI/2*1.01}const hE=ze(85),UO=Math.cos(hE),VO=Math.sin(hE),$O=re(),dE=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function fE(o,e,n,c,h,p,g,x,b){if(p&&o.queryGeometry.isAboveHorizon)return!1;p&&(b*=o.pixelToTileUnitsFactor);const E=o.tileID.canonical,I=n.projection.upVectorScale(E,n.center.lat,n.worldSize).metersToTile;for(const C of e)for(const k of C){const F=k.add(x),N=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,W=n.projection.projectTilePoint(F.x,F.y,E);if(N>0){const ce=n.projection.upVector(E,F.x,F.y);W.x+=ce[0]*I*N,W.y+=ce[1]*I*N,W.z+=ce[2]*I*N}const Z=p?F:GO(W.x,W.y,W.z,c),X=p?o.tilespaceRays.map(ce=>WO(ce,N)):o.queryGeometry.screenGeometry,le=un([],[W.x,W.y,W.z,1],c);if(!g&&p?b*=le[3]/n.cameraToCenterDistance:g&&!p&&(b*=n.cameraToCenterDistance/le[3]),p){const ce=Te((k.y/Dt+E.y)/(1<<E.z));b/=n.projection.pixelsPerMeter(ce,1)/be(1,ce)}if(Io(X,Z,b))return!0}return!1}function GO(o,e,n,c){const h=un([],[o,e,n,1],c);return new bt(h[0]/h[3],h[1]/h[3])}const pE=Dr(0,0,0),HO=Dr(0,0,1);function WO(o,e){const n=tt();return pE[2]=e,o.intersectsPlane(pE,HO,n),new bt(n[0],n[1])}class mE extends ts{}let gE,_E,yE,xE;function vE(o,{width:e,height:n},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*c);return o.width=e,o.height=n,o.data=h,o}function wE(o,e,n){const{width:c,height:h}=e;c===o.width&&h===o.height||(Ew(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,h)},n,null),o.width=c,o.height=h,o.data=e.data)}function Ew(o,e,n,c,h,p,g,x){if(h.width===0||h.height===0)return e;if(h.width>o.width||h.height>o.height||n.x>o.width-h.width||n.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||c.x>e.width-h.width||c.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,E=e.data,I=p===4&&x;for(let C=0;C<h.height;C++){const k=((n.y+C)*o.width+n.x)*p,F=((c.y+C)*e.width+c.x)*p;if(I)for(let N=0;N<h.width;N++){const W=k+N*p+3,Z=F+N*p;E[Z+0]=255,E[Z+1]=255,E[Z+2]=255,E[Z+3]=b[W]}else if(g)for(let N=0;N<h.width;N++){const W=k+N*p,Z=F+N*p,X=new _i(b[W+0]/255,b[W+1]/255,b[W+2]/255,b[W+3]).toNonPremultipliedRenderColor(g).toArray();E[Z+0]=X[0],E[Z+1]=X[1],E[Z+2]=X[2],E[Z+3]=X[3]}else for(let N=0;N<h.width*p;N++)E[F+N]=b[k+N]}return e}Wt(mE,"HeatmapBucket",{omit:["layers"]});class Nu{constructor(e,n){vE(this,e,1,n)}resize(e){wE(this,new Nu(e),1)}clone(){return new Nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,h,p){Ew(e,n,c,h,p,1,null)}}class ds{constructor(e,n){vE(this,e,4,n)}resize(e){wE(this,new ds(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,h,p,g,x){Ew(e,n,c,h,p,4,g,x)}}class bE{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function O0(o){const e={},n=o.resolution||256,c=o.clips?o.clips.length:1,h=o.image||new ds({width:n,height:c}),p=(g,x,b)=>{e[o.evaluationKey]=b;const E=o.expression.evaluate(e),I=E?E.toNonPremultipliedRenderColor(null):null;I&&(h.data[g+x+0]=Math.floor(255*I.r),h.data[g+x+1]=Math.floor(255*I.g),h.data[g+x+2]=Math.floor(255*I.b),h.data[g+x+3]=Math.floor(255*I.a))};if(o.clips)for(let g=0,x=0;g<c;++g,x+=4*n)for(let b=0,E=0;b<n;b++,E+=4){const I=b/(n-1),{start:C,end:k}=o.clips[g];p(x,E,C*(1-I)+k*I)}else for(let g=0,x=0;g<n;g++,x+=4)p(0,x,g/(n-1));return h}Wt(Nu,"AlphaImage"),Wt(ds,"RGBAImage");const qO=ii([{name:"a_pos",components:2,type:"Int16"}],4),ZO=ii([{name:"a_road_z_offset",components:1,type:"Float32"}],4),XO=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),KO=ii([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function op(o,e,n=2){const c=e&&e.length,h=c?e[0]*n:o.length;let p=TE(o,0,h,n,!0);const g=[];if(!p||p.next===p.prev)return g;let x,b,E;if(c&&(p=function(I,C,k,F){const N=[];for(let W=0,Z=C.length;W<Z;W++){const X=TE(I,C[W]*F,W<Z-1?C[W+1]*F:I.length,F,!1);X===X.next&&(X.steiner=!0),N.push(nL(X))}N.sort(tL);for(let W=0;W<N.length;W++)k=rL(N[W],k);return k}(o,e,p,n)),o.length>80*n){x=o[0],b=o[1];let I=x,C=b;for(let k=n;k<h;k+=n){const F=o[k],N=o[k+1];F<x&&(x=F),N<b&&(b=N),F>I&&(I=F),N>C&&(C=N)}E=Math.max(I-x,C-b),E=E!==0?32767/E:0}return L0(p,g,n,x,b,E,0),g}function TE(o,e,n,c,h){let p;if(h===function(g,x,b,E){let I=0;for(let C=x,k=b-E;C<b;C+=E)I+=(g[k]-g[C])*(g[C+1]+g[k+1]),k=C;return I}(o,e,n,c)>0)for(let g=e;g<n;g+=c)p=IE(g/c|0,o[g],o[g+1],p);else for(let g=n-c;g>=e;g-=c)p=IE(g/c|0,o[g],o[g+1],p);return p&&ap(p,p.next)&&(z0(p),p=p.next),p}function ad(o,e){if(!o)return o;e||(e=o);let n,c=o;do if(n=!1,c.steiner||!ap(c,c.next)&&Yn(c.prev,c,c.next)!==0)c=c.next;else{if(z0(c),c=e=c.prev,c===c.next)break;n=!0}while(n||c!==e);return e}function L0(o,e,n,c,h,p,g){if(!o)return;!g&&p&&function(b,E,I,C){let k=b;do k.z===0&&(k.z=Aw(k.x,k.y,E,I,C)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==b);k.prevZ.nextZ=null,k.prevZ=null,function(F){let N,W=1;do{let Z,X=F;F=null;let le=null;for(N=0;X;){N++;let ce=X,de=0;for(let Ce=0;Ce<W&&(de++,ce=ce.nextZ,ce);Ce++);let Ie=W;for(;de>0||Ie>0&&ce;)de!==0&&(Ie===0||!ce||X.z<=ce.z)?(Z=X,X=X.nextZ,de--):(Z=ce,ce=ce.nextZ,Ie--),le?le.nextZ=Z:F=Z,Z.prevZ=le,le=Z;X=ce}le.nextZ=null,W*=2}while(N>1)}(k)}(o,c,h,p);let x=o;for(;o.prev!==o.next;){const b=o.prev,E=o.next;if(p?JO(o,c,h,p):YO(o))e.push(b.i,o.i,E.i),z0(o),o=E.next,x=E.next;else if((o=E)===x){g?g===1?L0(o=QO(ad(o),e),e,n,c,h,p,2):g===2&&eL(o,e,n,c,h,p):L0(ad(o),e,n,c,h,p,1);break}}}function YO(o){const e=o.prev,n=o,c=o.next;if(Yn(e,n,c)>=0)return!1;const h=e.x,p=n.x,g=c.x,x=e.y,b=n.y,E=c.y,I=Math.min(h,p,g),C=Math.min(x,b,E),k=Math.max(h,p,g),F=Math.max(x,b,E);let N=c.next;for(;N!==e;){if(N.x>=I&&N.x<=k&&N.y>=C&&N.y<=F&&F0(h,x,p,b,g,E,N.x,N.y)&&Yn(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function JO(o,e,n,c){const h=o.prev,p=o,g=o.next;if(Yn(h,p,g)>=0)return!1;const x=h.x,b=p.x,E=g.x,I=h.y,C=p.y,k=g.y,F=Math.min(x,b,E),N=Math.min(I,C,k),W=Math.max(x,b,E),Z=Math.max(I,C,k),X=Aw(F,N,e,n,c),le=Aw(W,Z,e,n,c);let ce=o.prevZ,de=o.nextZ;for(;ce&&ce.z>=X&&de&&de.z<=le;){if(ce.x>=F&&ce.x<=W&&ce.y>=N&&ce.y<=Z&&ce!==h&&ce!==g&&F0(x,I,b,C,E,k,ce.x,ce.y)&&Yn(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,de.x>=F&&de.x<=W&&de.y>=N&&de.y<=Z&&de!==h&&de!==g&&F0(x,I,b,C,E,k,de.x,de.y)&&Yn(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ce&&ce.z>=X;){if(ce.x>=F&&ce.x<=W&&ce.y>=N&&ce.y<=Z&&ce!==h&&ce!==g&&F0(x,I,b,C,E,k,ce.x,ce.y)&&Yn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;de&&de.z<=le;){if(de.x>=F&&de.x<=W&&de.y>=N&&de.y<=Z&&de!==h&&de!==g&&F0(x,I,b,C,E,k,de.x,de.y)&&Yn(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function QO(o,e){let n=o;do{const c=n.prev,h=n.next.next;!ap(c,h)&&EE(c,n,n.next,h)&&N0(c,h)&&N0(h,c)&&(e.push(c.i,n.i,h.i),z0(n),z0(n.next),n=o=h),n=n.next}while(n!==o);return ad(n)}function eL(o,e,n,c,h,p){let g=o;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&sL(g,x)){let b=AE(g,x);return g=ad(g,g.next),b=ad(b,b.next),L0(g,e,n,c,h,p,0),void L0(b,e,n,c,h,p,0)}x=x.next}g=g.next}while(g!==o)}function tL(o,e){let n=o.x-e.x;return n===0&&(n=o.y-e.y,n===0)&&(n=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function rL(o,e){const n=function(h,p){let g=p;const x=h.x,b=h.y;let E,I=-1/0;if(ap(h,g))return g;do{if(ap(h,g.next))return g.next;if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){const W=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(W<=x&&W>I&&(I=W,E=g.x<g.next.x?g:g.next,W===x))return E}g=g.next}while(g!==p);if(!E)return null;const C=E,k=E.x,F=E.y;let N=1/0;g=E;do{if(x>=g.x&&g.x>=k&&x!==g.x&&SE(b<F?x:I,b,k,F,b<F?I:x,b,g.x,g.y)){const W=Math.abs(b-g.y)/(x-g.x);N0(g,h)&&(W<N||W===N&&(g.x>E.x||g.x===E.x&&iL(E,g)))&&(E=g,N=W)}g=g.next}while(g!==C);return E}(o,e);if(!n)return e;const c=AE(n,o);return ad(c,c.next),ad(n,n.next)}function iL(o,e){return Yn(o.prev,o,e.prev)<0&&Yn(e.next,o,o.next)<0}function Aw(o,e,n,c,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-n)*h|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nL(o){let e=o,n=o;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==o);return n}function SE(o,e,n,c,h,p,g,x){return(h-g)*(e-x)>=(o-g)*(p-x)&&(o-g)*(c-x)>=(n-g)*(e-x)&&(n-g)*(p-x)>=(h-g)*(c-x)}function F0(o,e,n,c,h,p,g,x){return!(o===g&&e===x)&&SE(o,e,n,c,h,p,g,x)}function sL(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(n,c){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==c.i&&h.next.i!==c.i&&EE(h,h.next,n,c))return!0;h=h.next}while(h!==n);return!1}(o,e)&&(N0(o,e)&&N0(e,o)&&function(n,c){let h=n,p=!1;const g=(n.x+c.x)/2,x=(n.y+c.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&g<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==n);return p}(o,e)&&(Yn(o.prev,o,e.prev)||Yn(o,e.prev,e))||ap(o,e)&&Yn(o.prev,o,o.next)>0&&Yn(e.prev,e,e.next)>0)}function Yn(o,e,n){return(e.y-o.y)*(n.x-e.x)-(e.x-o.x)*(n.y-e.y)}function ap(o,e){return o.x===e.x&&o.y===e.y}function EE(o,e,n,c){const h=Gy(Yn(o,e,n)),p=Gy(Yn(o,e,c)),g=Gy(Yn(n,c,o)),x=Gy(Yn(n,c,e));return h!==p&&g!==x||!(h!==0||!$y(o,n,e))||!(p!==0||!$y(o,c,e))||!(g!==0||!$y(n,o,c))||!(x!==0||!$y(n,e,c))}function $y(o,e,n){return e.x<=Math.max(o.x,n.x)&&e.x>=Math.min(o.x,n.x)&&e.y<=Math.max(o.y,n.y)&&e.y>=Math.min(o.y,n.y)}function Gy(o){return o>0?1:o<0?-1:0}function N0(o,e){return Yn(o.prev,o,o.next)<0?Yn(o,e,o.next)>=0&&Yn(o,o.prev,e)>=0:Yn(o,e,o.prev)<0||Yn(o,o.next,e)<0}function AE(o,e){const n=Iw(o.i,o.x,o.y),c=Iw(e.i,e.x,e.y),h=o.next,p=e.prev;return o.next=e,e.prev=o,n.next=h,h.prev=n,c.next=n,n.prev=c,p.next=c,c.prev=p,c}function IE(o,e,n,c){const h=Iw(o,e,n);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function z0(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Iw(o,e,n){return{i:o,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function B0(o,e){const n=o.length;if(n<=1)return[o];const c=[];let h,p;for(let g=0;g<n;g++){const x=mr(o[g]);x!==0&&(o[g].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(h&&c.push(h),h=[o[g]]):h.push(o[g]))}if(h&&c.push(h),e>1)for(let g=0;g<c.length;g++)c[g].length<=e||(W_(c[g],e,1,c[g].length-1,oL),c[g]=c[g].slice(0,e));return c}function oL(o,e){return e.area-o.area}function CE(o,e,n=1){if(!o)return null;const c=typeof o=="string"?Gs.from(o).getPrimary():o.getPrimary(),h=typeof o=="string"?null:o.getSecondary();for(const p of[c,h]){if(!p)continue;const g=p.id.toString();e.has(g)||e.set(g,[]),p.scaleSelf(n),e.get(g).push(p)}return{primary:c.toString(),secondary:h?h.toString():null}}function Cw(o,e,n,c){const h=c.patternDependencies;let p=!1;for(const g of e){const x=g.paint.get(`${o}-pattern`);x.isConstant()||(p=!0),CE(x.constantOr(null),h,n)&&(p=!0)}return p}function Pw(o,e,n,c,h,p){const g=p.patternDependencies;for(const x of e){const b=x.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let E=b.evaluate({zoom:c},n,{},p.availableImages);E=E&&E.name?E.name:E;const I=CE(E,g,h);if(!I)continue;const{primary:C,secondary:k}=I;C&&(n.patterns[x.id]=[C,k].filter(Boolean))}}return n}class PE{constructor(){this.polygons=new Map}add(e,...n){const c=this.polygons.get(e);c?c.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,c]of e.polygons)this.add(n,...c)}}class Dc{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=Dt&&n>=Dt}static evaluate(e){if(e.length===0)return new Dc;let n=[];for(const b of e)n.push(...b.portals);if(n.length===0)return new Dc;for(const b of n){const E=b.va,I=b.vb;(Dc.isOnBorder(E.x,I.x)||Dc.isOnBorder(E.y,I.y))&&(b.type="border")}const c=n.filter(b=>b.type!=="unevaluated"),h=n.filter(b=>b.type==="unevaluated");if(h.length===0)return new Dc;h.sort((b,E)=>b.hash===E.hash?b.isTunnel===E.isTunnel?0:b.isTunnel?-1:1:b.hash<E.hash?1:-1),n=c.concat(h);let p=c.length,g=p,x=p;do if(g++,g===n.length||n[p].hash!==n[g].hash){if(g-p==2){x<p&&(n[x]=n[p],n[p]=null);const b=n[x],E=n[g-1];b.type=b.isTunnel!==E.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:E.connection.a},x++}p=g}while(p!==n.length);return n.splice(x),n.sort((b,E)=>b.hash<E.hash?1:-1),{portals:n}}}Wt(Dc,"ElevationPortalGraph"),Wt(PE,"ElevationPolygons");class aL{constructor(e,n,c){this.outPositions=e,this.outNormals=n,this.outIndices=c,this.vertexLookup=new Map}addVertex(e,n,c){let h=e[2];c!=null&&(h*=c);const p=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,g=this.vertexLookup.get(p);if(g!=null)return g;const x=this.outPositions.length;this.vertexLookup.set(p,x);const b=Math.trunc(16384*n[0]),E=Math.trunc(16384*n[1]),I=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(b,E,I),x}addTriangle(e,n,c){this.outIndices.emplaceBack(e,n,c)}addTriangles(e,n,c){if(e.length===0)return;const h=c.length===1,p=tt(),g=tt();for(let x=0;x<e.length;x+=3){const b=n[e[x+0]],E=n[e[x+1]],I=n[e[x+2]],C=h?c[0]:c[e[x+1]],k=h?c[0]:c[e[x+2]];ir(p,b.x,b.y,h?c[0]:c[e[x+0]]);const F=this.addVertex(p,g);ir(p,E.x,E.y,C);const N=this.addVertex(p,g);ir(p,I.x,I.y,k);const W=this.addVertex(p,g);this.outIndices.emplaceBack(F,N,W)}}addQuad(e,n,c,h,p,g){const x=this.addVertex(e,p,g),b=this.addVertex(n,p,g),E=this.addVertex(c,p,g),I=this.addVertex(h,p,g);this.addTriangle(x,b,E),this.addTriangle(E,I,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Co{constructor(e,n,c,h){this.unevaluatedPortals=new Dc,this.portalPolygons=new PE,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new v0,this.vertexNormals=new qf,this.indexArray=new Nn,this.tileToMeters=$e(e),this.bridgeProgramConfigurations=new ca(n,{zoom:c,lut:h},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new ca(n,{zoom:c,lut:h},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,n){const c=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(n[h]);return c}addTriangles(e,n,c){const h=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)h.push(p+n)}addRenderableRing(e,n,c,h,p,g){const x=[new bt(p.min.x,p.min.y),new bt(p.max.x,p.min.y),new bt(p.max.x,p.max.y),new bt(p.min.x,p.max.y)];for(let b=0;b<c-1;b++){const E=n+b,I=E+1,C=this.unevalVertices[E],k=this.unevalVertices[I];if(!(C.x>=p.min.x&&C.x<=p.max.x&&C.y>=p.min.y&&C.y<=p.max.y||k.x>=p.min.x&&k.x<=p.max.x&&k.y>=p.min.y&&k.y<=p.max.y||hs(C,k,x))||this.isOnBorder(C.x,k.x)||this.isOnBorder(C.y,k.y))continue;const F=Co.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[I]);let N,W=this.vertexHashLookup.get(Co.computePosHash(C));W!=null?N=W.next:(W=this.vertexHashLookup.get(Co.computePosHash(k)),N=W!=null?W.prev:F),this.unevalEdges.push({polygonIdx:e,a:E,b:I,hash:F,portalHash:N,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,n,c,h,p){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:p});const g=n[0];this.vertexHashLookup.clear();let x=Co.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let b=0;b<g.length-1;b++){const E=g[b+0],I=g[b+1],C=xs(I.x-E.x,I.y-E.y),k=Wa(C);if(k===0)continue;let F="unevaluated";const N=h.pointElevation(E),W=h.pointElevation(I);Math.abs(N)<.01&&Math.abs(W)<.01?F="entrance":(this.isOnBorder(E.x,I.x)||this.isOnBorder(E.y,I.y))&&(F="border");const Z=Co.computeEdgeHash(E,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:E,vb:I,vab:C,length:k,hash:Z,isTunnel:c,type:F});const X=Co.computePosHash(E);this.vertexHashLookup.set(X,{prev:x,next:Z}),x=Z}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},h=new aL(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=n(),g=n(),x=n(),b=(k,F)=>{k.sort((W,Z)=>W.type===F&&Z.type!==F?-1:W.type!==F&&Z.type===F?1:0);const N=k.findIndex(W=>W.type!==F);return N>=0?N:k.length};let E=0;this.unevalEdges.length>0&&(E=b(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),c(x);const I=n(),C=n();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(E),F=b(k,"tunnel")+E;this.unevalEdges.push(...k),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:F})}c(I),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(C),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(p),this.maskSegments=en.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=en.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=en.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=en.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=en.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,n,c,h,p,g,x,b){this.bridgeProgramConfigurations.updatePaintArrays(e,n,p,c,h,g,x,b),this.tunnelProgramConfigurations.updatePaintArrays(e,n,p,c,h,g,x,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,XO.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,KO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,c,h,p){const g=(x,b)=>{for(let E=0;E<b.length-1;E++){const I=b[E].featureIndex,C=b[E+1].vertexStart,k=e.feature(I);x.populatePaintArrays(C,k,I,{},c,n,h,void 0,p)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,c,h,p){const g=new Map;for(let x=h;x<p;x++){const b=c[x],E=b.a,I=b.b,C=Co.computePosHash(e[E]),k=Co.computePosHash(e[I]);let F=g.get(C);F||(F={},g.set(C,F));let N=g.get(k);N||(N={},g.set(k,N)),n[E]<=0&&n[I]<=0||(F.to=I,N.from=E)}return g}isTerminalVertex(e,n){const c=Co.computePosHash(this.unevalVertices[e]),h=n.get(c);return!h||!h.from||!h.to}constructBridgeStructures(e,n,c,h,p,g){e.clearVertexLookup();const x=this.computeVertexConnections(n,c,h,p.min,p.max),b=1/g,E=.5*b,I=(_t,Et)=>ir(_t,n[Et].x,n[Et].y,c[Et]*b),C=tt(),k=tt(),F=tt(),N=tt(),W=tt(),Z=(_t,Et)=>{const lt=x.get(Co.computePosHash(n[Et])),yt=lt.from,Je=lt.to;if(!yt||!Je)return;I(C,yt),I(k,Et),I(F,Je),Ln(N),gi(C,k)||(Pi(W,k,C),Pt(N,W)),gi(F,k)||(Pi(W,F,k),Ir(N,N,Pt(W,W)));const Ze=Ut(N);return Ze>0?gr(_t,N,1/Ze):void 0};let X=Number.POSITIVE_INFINITY;this.sortSubarray(h,p.min,p.max,(_t,Et)=>_t.featureInfo.featureIndex-Et.featureInfo.featureIndex);const le=tt(),ce=tt(),de=tt(),Ie=tt(),Ce=tt(),Re=tt(),Le=tt(),Fe=tt(),dt=tt(),je=[tt(),tt(),tt(),tt()],pt=[tt(),tt(),tt(),tt()],wt=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],mt=(_t,Et)=>_t>Et;for(let _t=p.min;_t<p.max;_t++){const Et=h[_t];if(!Et.featureInfo.guardRailEnabled||!this.prepareEdgePoints(wt,n,c,Et,mt))continue;const[lt,yt]=wt;if(ir(le,lt.coord.x,lt.coord.y,b*lt.height),ir(ce,yt.coord.x,yt.coord.y,b*yt.height),gi(le,ce))continue;Pi(de,ce,le),Pt(de,de);const Je=Z(Fe,Et.a)||de,Ze=Z(dt,Et.b)||de;ir(Ie,Je[1],-Je[0],0),Pt(Ie,Ie),ir(Ce,Ze[1],-Ze[0],0),Pt(Ce,Ce),br(Fe,Ie,Je),Pt(Re,Fe),br(Fe,Ce,Ze),Pt(Le,Fe),Ir(je[0],le,gr(Fe,Pi(Fe,Ie,Re),E)),Ir(je[1],le,gr(Fe,Ir(Fe,Ie,Re),E)),Ir(je[2],le,gr(Fe,Re,E)),je[3]=le,Ir(pt[0],ce,gr(Fe,Pi(Fe,Ce,Le),E)),Ir(pt[1],ce,gr(Fe,Ir(Fe,Ce,Le),E)),Ir(pt[2],ce,gr(Fe,Le,E)),pt[3]=ce,X=this.addFeatureSection(Et.featureInfo.featureIndex,X,this.bridgeFeatureSections,e);const At=e.addVertex(je[0],Ie,g),Tt=e.addVertex(je[1],Ie,g),hr=e.addVertex(pt[0],Ce,g),Gt=e.addVertex(pt[1],Ce,g);e.addTriangle(At,Tt,hr),e.addTriangle(Tt,Gt,hr);const Jt=e.addVertex(je[1],Re,g),Rt=e.addVertex(je[2],Re,g),cr=e.addVertex(pt[1],Le,g),Mr=e.addVertex(pt[2],Le,g);e.addTriangle(Jt,Rt,cr),e.addTriangle(Rt,Mr,cr),ht(Ie,Ie),ht(Ce,Ce);const Nt=e.addVertex(je[2],Ie,g),rr=e.addVertex(je[3],Ie,g),Tr=e.addVertex(pt[2],Ce,g),Lr=e.addVertex(pt[3],Ce,g);e.addTriangle(Nt,rr,Tr),e.addTriangle(rr,Lr,Tr);const qr=this.isTerminalVertex(Et.a,x),Nr=this.isTerminalVertex(Et.b,x);lt.height<.01&&qr&&e.addQuad(je[3],je[2],je[1],je[0],ht(Je,Je),g),yt.height<.01&&Nr&&e.addQuad(pt[0],pt[1],pt[2],pt[3],Ze,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,c,h,p,g){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const b=(X,le)=>X.featureInfo.featureIndex-le.featureInfo.featureIndex;this.sortSubarray(h,p.min,p.max,b),this.sortSubarray(h,g.min,g.max,b);const E=X=>Pt(X,X),I=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],C=(X,le)=>X<le,k=tt(),F=tt(),N=tt(),W=tt(),Z=tt();for(let X=p.min;X<p.max;X++){if(!this.prepareEdgePoints(I,n,c,h[X],C))continue;const[le,ce]=I,de=E(ir(Z,-(ce.coord.y-le.coord.y),ce.coord.x-le.coord.x,0));x=this.addFeatureSection(h[X].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(ir(k,le.coord.x,le.coord.y,le.height),ir(F,ce.coord.x,ce.coord.y,ce.height),ir(N,ce.coord.x,ce.coord.y,h[X].isTunnel?-.1:0),ir(W,le.coord.x,le.coord.y,h[X].isTunnel?-.1:0),de)}for(let X=g.min;X<g.max;X++){const le=h[X];le.isTunnel&&([le.a,le.b]=[le.b,le.a]);const ce=n[le.a],de=n[le.b],Ie=E(ir(Z,-(de.y-ce.y),de.x-ce.x,0));x=this.addFeatureSection(le.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(ir(k,de.x,de.y,0),ir(F,ce.x,ce.y,0),ir(N,ce.x,ce.y,c[le.a]+4),ir(W,de.x,de.y,c[le.b]+4),Ie),e.addQuad(ir(k,ce.x,ce.y,0),ir(F,de.x,de.y,0),ir(N,de.x,de.y,c[le.b]+4),ir(W,ce.x,ce.y,c[le.a]+4),Ie)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,c,h){e.coord.x=n,e.coord.y=c,e.height=h}prepareEdgePoints(e,n,c,h,p){let g=n[h.a].x,x=n[h.a].y,b=n[h.b].x,E=n[h.b].y,I=c[h.a],C=c[h.b];const k=p(I,0),F=p(C,0);if(k&&F)return this.setElevatedPoint(e[0],g,x,I),this.setElevatedPoint(e[1],b,E,C),!0;if(!k&&!F)return!1;if(k){if(!F){const N=C/(C-I);b=wr(b,g,N),E=wr(E,x,N),C=wr(C,I,N)}}else{const N=I/(I-C);g=wr(g,b,N),x=wr(x,E,N),I=wr(I,C,N)}return this.setElevatedPoint(e[0],g,x,I),this.setElevatedPoint(e[1],b,E,C),!0}prepareEdges(e,n){if(n.length===0)return;n.sort((x,b)=>x.hash===b.hash?b.polygonIdx-x.polygonIdx:b.hash>x.hash?1:-1);let c=0,h=0,p=0,g=n[c].polygonIdx;do h++,(h===n.length||n[c].hash!==n[h].hash)&&((h-c==1||n[h-1].polygonIdx!==g)&&(p<c&&(n[p]=n[c],n[c]=null),n[p].type="none",p++),c=h,c!==n.length&&(g=n[c].polygonIdx));while(c!==n.length);if(n.splice(p),n.length!==0&&e.length!==0){n.sort((E,I)=>E.portalHash<I.portalHash?1:-1);let x=0,b=0;for(;x!==n.length&&b!==e.length;){const E=n[x],I=e[b];E.portalHash>I.hash?x++:I.hash>E.portalHash?b++:(E.type=I.type,x++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Dt&&n>=Dt}addFeatureSection(e,n,c,h){return e!==n&&(n=e,c.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),n}sortSubarray(e,n,c,h){const p=e.slice(n,c);p.sort(h),e.splice(n,p.length,...p)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(Co.computePosHash(e))<<32n|BigInt(Co.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var kE,RE={exports:{}},ME=(kE||(kE=1,function(o,e){(function(n){function c(ye,xe){return ye>xe?1:ye<xe?-1:0}var h=function(ye,xe){ye===void 0&&(ye=c),xe===void 0&&(xe=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!xe},p={size:{configurable:!0}};function g(ye,xe,Ke,ut,Ft){var Lt=Ft-ut;if(Lt>0){var qt=ut+Math.floor(Lt/2),pr={key:xe[qt],data:Ke[qt],parent:ye};return pr.left=g(pr,xe,Ke,ut,qt),pr.right=g(pr,xe,Ke,qt+1,Ft),pr}return null}function x(ye,xe,Ke,ut,Ft){if(!(Ke>=ut)){for(var Lt=ye[Ke+ut>>1],qt=Ke-1,pr=ut+1;;){do qt++;while(Ft(ye[qt],Lt)<0);do pr--;while(Ft(ye[pr],Lt)>0);if(qt>=pr)break;var Zr=ye[qt];ye[qt]=ye[pr],ye[pr]=Zr,Zr=xe[qt],xe[qt]=xe[pr],xe[pr]=Zr}x(ye,xe,Ke,pr,Ft),x(ye,xe,pr+1,ut,Ft)}}h.prototype.rotateLeft=function(ye){var xe=ye.right;xe&&(ye.right=xe.left,xe.left&&(xe.left.parent=ye),xe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=xe:ye.parent.right=xe:this._root=xe,xe&&(xe.left=ye),ye.parent=xe},h.prototype.rotateRight=function(ye){var xe=ye.left;xe&&(ye.left=xe.right,xe.right&&(xe.right.parent=ye),xe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=xe:ye.parent.right=xe:this._root=xe,xe&&(xe.right=ye),ye.parent=xe},h.prototype._splay=function(ye){for(;ye.parent;){var xe=ye.parent;xe.parent?xe.left===ye&&xe.parent.left===xe?(this.rotateRight(xe.parent),this.rotateRight(xe)):xe.right===ye&&xe.parent.right===xe?(this.rotateLeft(xe.parent),this.rotateLeft(xe)):xe.left===ye&&xe.parent.right===xe?(this.rotateRight(xe),this.rotateLeft(xe)):(this.rotateLeft(xe),this.rotateRight(xe)):xe.left===ye?this.rotateRight(xe):this.rotateLeft(xe)}},h.prototype.splay=function(ye){for(var xe,Ke,ut,Ft,Lt;ye.parent;)(Ke=(xe=ye.parent).parent)&&Ke.parent?((ut=Ke.parent).left===Ke?ut.left=ye:ut.right=ye,ye.parent=ut):(ye.parent=null,this._root=ye),Ft=ye.left,Lt=ye.right,ye===xe.left?(Ke&&(Ke.left===xe?(xe.right?(Ke.left=xe.right,Ke.left.parent=Ke):Ke.left=null,xe.right=Ke,Ke.parent=xe):(Ft?(Ke.right=Ft,Ft.parent=Ke):Ke.right=null,ye.left=Ke,Ke.parent=ye)),Lt?(xe.left=Lt,Lt.parent=xe):xe.left=null,ye.right=xe,xe.parent=ye):(Ke&&(Ke.right===xe?(xe.left?(Ke.right=xe.left,Ke.right.parent=Ke):Ke.right=null,xe.left=Ke,Ke.parent=xe):(Lt?(Ke.left=Lt,Lt.parent=Ke):Ke.left=null,ye.right=Ke,Ke.parent=ye)),Ft?(xe.right=Ft,Ft.parent=xe):xe.right=null,ye.left=xe,xe.parent=ye)},h.prototype.replace=function(ye,xe){ye.parent?ye===ye.parent.left?ye.parent.left=xe:ye.parent.right=xe:this._root=xe,xe&&(xe.parent=ye.parent)},h.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},h.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},h.prototype.insert=function(ye,xe){var Ke=this._root,ut=null,Ft=this._compare;if(this._noDuplicates)for(;Ke;){if(ut=Ke,Ft(Ke.key,ye)===0)return;Ke=Ft(Ke.key,ye)<0?Ke.right:Ke.left}else for(;Ke;)ut=Ke,Ke=Ft(Ke.key,ye)<0?Ke.right:Ke.left;return Ke={key:ye,data:xe,left:null,right:null,parent:ut},ut?Ft(ut.key,Ke.key)<0?ut.right=Ke:ut.left=Ke:this._root=Ke,this.splay(Ke),this._size++,Ke},h.prototype.find=function(ye){for(var xe=this._root,Ke=this._compare;xe;){var ut=Ke(xe.key,ye);if(ut<0)xe=xe.right;else{if(!(ut>0))return xe;xe=xe.left}}return null},h.prototype.contains=function(ye){for(var xe=this._root,Ke=this._compare;xe;){var ut=Ke(ye,xe.key);if(ut===0)return!0;xe=ut<0?xe.left:xe.right}return!1},h.prototype.remove=function(ye){var xe=this.find(ye);if(!xe)return!1;if(this.splay(xe),xe.left)if(xe.right){var Ke=this.minNode(xe.right);Ke.parent!==xe&&(this.replace(Ke,Ke.right),Ke.right=xe.right,Ke.right.parent=Ke),this.replace(xe,Ke),Ke.left=xe.left,Ke.left.parent=Ke}else this.replace(xe,xe.left);else this.replace(xe,xe.right);return this._size--,!0},h.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var xe=this.minNode(ye.right);xe.parent!==ye&&(this.replace(xe,xe.right),xe.right=ye.right,xe.right.parent=xe),this.replace(ye,xe),xe.left=ye.left,xe.left.parent=xe}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},h.prototype.erase=function(ye){var xe=this.find(ye);if(xe){this.splay(xe);var Ke=xe.left,ut=xe.right,Ft=null;Ke&&(Ke.parent=null,Ft=this.maxNode(Ke),this.splay(Ft),this._root=Ft),ut&&(Ke?Ft.right=ut:this._root=ut,ut.parent=Ft),this._size--}},h.prototype.pop=function(){var ye=this._root,xe=null;if(ye){for(;ye.left;)ye=ye.left;xe={key:ye.key,data:ye.data},this.remove(ye.key)}return xe},h.prototype.next=function(ye){var xe=ye;if(xe)if(xe.right)for(xe=xe.right;xe&&xe.left;)xe=xe.left;else for(xe=ye.parent;xe&&xe.right===ye;)ye=xe,xe=xe.parent;return xe},h.prototype.prev=function(ye){var xe=ye;if(xe)if(xe.left)for(xe=xe.left;xe&&xe.right;)xe=xe.right;else for(xe=ye.parent;xe&&xe.left===ye;)ye=xe,xe=xe.parent;return xe},h.prototype.forEach=function(ye){for(var xe=this._root,Ke=[],ut=!1,Ft=0;!ut;)xe?(Ke.push(xe),xe=xe.left):Ke.length>0?(ye(xe=Ke.pop(),Ft++),xe=xe.right):ut=!0;return this},h.prototype.range=function(ye,xe,Ke,ut){for(var Ft=[],Lt=this._compare,qt=this._root;Ft.length!==0||qt;)if(qt)Ft.push(qt),qt=qt.left;else{if(Lt((qt=Ft.pop()).key,xe)>0)break;if(Lt(qt.key,ye)>=0&&Ke.call(ut,qt))return this;qt=qt.right}return this},h.prototype.keys=function(){for(var ye=this._root,xe=[],Ke=[],ut=!1;!ut;)ye?(xe.push(ye),ye=ye.left):xe.length>0?(ye=xe.pop(),Ke.push(ye.key),ye=ye.right):ut=!0;return Ke},h.prototype.values=function(){for(var ye=this._root,xe=[],Ke=[],ut=!1;!ut;)ye?(xe.push(ye),ye=ye.left):xe.length>0?(ye=xe.pop(),Ke.push(ye.data),ye=ye.right):ut=!0;return Ke},h.prototype.at=function(ye){for(var xe=this._root,Ke=[],ut=!1,Ft=0;!ut;)if(xe)Ke.push(xe),xe=xe.left;else if(Ke.length>0){if(xe=Ke.pop(),Ft===ye)return xe;Ft++,xe=xe.right}else ut=!0;return null},h.prototype.load=function(ye,xe,Ke){if(ye===void 0&&(ye=[]),xe===void 0&&(xe=[]),Ke===void 0&&(Ke=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ut=ye.length;return Ke&&x(ye,xe,0,ut-1,this._compare),this._root=g(null,ye,xe,0,ut),this._size=ut,this},h.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},h.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},h.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},h.createTree=function(ye,xe,Ke,ut,Ft){return new h(Ke,Ft).load(ye,xe,ut)},Object.defineProperties(h.prototype,p);var b=0,E=1,I=2,C=3,k=0,F=1,N=2,W=3;function Z(ye,xe,Ke){xe===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===xe.isSubject?(ye.inOut=!xe.inOut,ye.otherInOut=xe.otherInOut):(ye.inOut=!xe.otherInOut,ye.otherInOut=xe.isVertical()?!xe.inOut:xe.inOut),xe&&(ye.prevInResult=!X(xe,Ke)||xe.isVertical()?xe.prevInResult:xe));var ut=X(ye,Ke);ye.resultTransition=ut?function(Ft,Lt){var qt,pr=!Ft.inOut,Zr=!Ft.otherInOut;switch(Lt){case k:qt=pr&&Zr;break;case F:qt=pr||Zr;break;case W:qt=pr^Zr;break;case N:qt=Ft.isSubject?pr&&!Zr:Zr&&!pr}return qt?1:-1}(ye,Ke):0}function X(ye,xe){switch(ye.type){case b:switch(xe){case k:return!ye.otherInOut;case F:return ye.otherInOut;case N:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case W:return!0}break;case I:return xe===k||xe===F;case C:return xe===N;case E:return!1}return!1}var le=function(ye,xe,Ke,ut,Ft){this.left=xe,this.point=ye,this.otherEvent=Ke,this.isSubject=ut,this.type=Ft||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ce={inResult:{configurable:!0}};function de(ye,xe){return ye[0]===xe[0]&&ye[1]===xe[1]}le.prototype.isBelow=function(ye){var xe=this.point,Ke=this.otherEvent.point;return this.left?(xe[0]-ye[0])*(Ke[1]-ye[1])-(Ke[0]-ye[0])*(xe[1]-ye[1])>0:(Ke[0]-ye[0])*(xe[1]-ye[1])-(xe[0]-ye[0])*(Ke[1]-ye[1])>0},le.prototype.isAbove=function(ye){return!this.isBelow(ye)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ce.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var ye=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(le.prototype,ce);var Ie=11102230246251565e-32,Ce=134217729,Re=(3+8*Ie)*Ie;function Le(ye,xe,Ke,ut,Ft){var Lt,qt,pr,Zr,Kr=xe[0],Wr=ut[0],wi=0,qi=0;Wr>Kr==Wr>-Kr?(Lt=Kr,Kr=xe[++wi]):(Lt=Wr,Wr=ut[++qi]);var Hr=0;if(wi<ye&&qi<Ke)for(Wr>Kr==Wr>-Kr?(pr=Lt-((qt=Kr+Lt)-Kr),Kr=xe[++wi]):(pr=Lt-((qt=Wr+Lt)-Wr),Wr=ut[++qi]),Lt=qt,pr!==0&&(Ft[Hr++]=pr);wi<ye&&qi<Ke;)Wr>Kr==Wr>-Kr?(pr=Lt-((qt=Lt+Kr)-(Zr=qt-Lt))+(Kr-Zr),Kr=xe[++wi]):(pr=Lt-((qt=Lt+Wr)-(Zr=qt-Lt))+(Wr-Zr),Wr=ut[++qi]),Lt=qt,pr!==0&&(Ft[Hr++]=pr);for(;wi<ye;)pr=Lt-((qt=Lt+Kr)-(Zr=qt-Lt))+(Kr-Zr),Kr=xe[++wi],Lt=qt,pr!==0&&(Ft[Hr++]=pr);for(;qi<Ke;)pr=Lt-((qt=Lt+Wr)-(Zr=qt-Lt))+(Wr-Zr),Wr=ut[++qi],Lt=qt,pr!==0&&(Ft[Hr++]=pr);return Lt===0&&Hr!==0||(Ft[Hr++]=Lt),Hr}function Fe(ye){return new Float64Array(ye)}var dt=33306690738754716e-32,je=22204460492503146e-32,pt=11093356479670487e-47,wt=Fe(4),mt=Fe(8),_t=Fe(12),Et=Fe(16),lt=Fe(4);function yt(ye,xe,Ke){var ut=function(Ft,Lt,qt,pr,Zr,Kr){var Wr=(Lt-Kr)*(qt-Zr),wi=(Ft-Zr)*(pr-Kr),qi=Wr-wi;if(Wr===0||wi===0||Wr>0!=wi>0)return qi;var Hr=Math.abs(Wr+wi);return Math.abs(qi)>=dt*Hr?qi:-function(Oi,Si,ui,Ni,zi,Mi,Li){var Ei,Yr,Ii,tn,Ar,ai,Bi,sn,$i,Rn,ki,En,oo,fs,cs,ao,Xl,Mn,qn=Oi-zi,ps=ui-zi,Ns=Si-Mi,Ss=Ni-Mi;wt[0]=(cs=(sn=qn-(Bi=(ai=Ce*qn)-(ai-qn)))*(Rn=Ss-($i=(ai=Ce*Ss)-(ai-Ss)))-((fs=qn*Ss)-Bi*$i-sn*$i-Bi*Rn))-((ki=cs-(Xl=(sn=Ns-(Bi=(ai=Ce*Ns)-(ai-Ns)))*(Rn=ps-($i=(ai=Ce*ps)-(ai-ps)))-((ao=Ns*ps)-Bi*$i-sn*$i-Bi*Rn)))+(Ar=cs-ki))+(Ar-Xl),wt[1]=(oo=fs-((En=fs+ki)-(Ar=En-fs))+(ki-Ar))-((ki=oo-ao)+(Ar=oo-ki))+(Ar-ao),wt[2]=En-((Mn=En+ki)-(Ar=Mn-En))+(ki-Ar),wt[3]=Mn;var Gu=function(NH,WC){for(var qC=WC[0],Lb=1;Lb<4;Lb++)qC+=WC[Lb];return qC}(0,wt),gg=je*Li;if(Gu>=gg||-Gu>=gg||(Ei=Oi-(qn+(Ar=Oi-qn))+(Ar-zi),Ii=ui-(ps+(Ar=ui-ps))+(Ar-zi),Yr=Si-(Ns+(Ar=Si-Ns))+(Ar-Mi),tn=Ni-(Ss+(Ar=Ni-Ss))+(Ar-Mi),Ei===0&&Yr===0&&Ii===0&&tn===0)||(gg=pt*Li+Re*Math.abs(Gu),(Gu+=qn*tn+Ss*Ei-(Ns*Ii+ps*Yr))>=gg||-Gu>=gg))return Gu;lt[0]=(cs=(sn=Ei-(Bi=(ai=Ce*Ei)-(ai-Ei)))*(Rn=Ss-($i=(ai=Ce*Ss)-(ai-Ss)))-((fs=Ei*Ss)-Bi*$i-sn*$i-Bi*Rn))-((ki=cs-(Xl=(sn=Yr-(Bi=(ai=Ce*Yr)-(ai-Yr)))*(Rn=ps-($i=(ai=Ce*ps)-(ai-ps)))-((ao=Yr*ps)-Bi*$i-sn*$i-Bi*Rn)))+(Ar=cs-ki))+(Ar-Xl),lt[1]=(oo=fs-((En=fs+ki)-(Ar=En-fs))+(ki-Ar))-((ki=oo-ao)+(Ar=oo-ki))+(Ar-ao),lt[2]=En-((Mn=En+ki)-(Ar=Mn-En))+(ki-Ar),lt[3]=Mn;var hN=Le(4,wt,4,lt,mt);lt[0]=(cs=(sn=qn-(Bi=(ai=Ce*qn)-(ai-qn)))*(Rn=tn-($i=(ai=Ce*tn)-(ai-tn)))-((fs=qn*tn)-Bi*$i-sn*$i-Bi*Rn))-((ki=cs-(Xl=(sn=Ns-(Bi=(ai=Ce*Ns)-(ai-Ns)))*(Rn=Ii-($i=(ai=Ce*Ii)-(ai-Ii)))-((ao=Ns*Ii)-Bi*$i-sn*$i-Bi*Rn)))+(Ar=cs-ki))+(Ar-Xl),lt[1]=(oo=fs-((En=fs+ki)-(Ar=En-fs))+(ki-Ar))-((ki=oo-ao)+(Ar=oo-ki))+(Ar-ao),lt[2]=En-((Mn=En+ki)-(Ar=Mn-En))+(ki-Ar),lt[3]=Mn;var dN=Le(hN,mt,4,lt,_t);lt[0]=(cs=(sn=Ei-(Bi=(ai=Ce*Ei)-(ai-Ei)))*(Rn=tn-($i=(ai=Ce*tn)-(ai-tn)))-((fs=Ei*tn)-Bi*$i-sn*$i-Bi*Rn))-((ki=cs-(Xl=(sn=Yr-(Bi=(ai=Ce*Yr)-(ai-Yr)))*(Rn=Ii-($i=(ai=Ce*Ii)-(ai-Ii)))-((ao=Yr*Ii)-Bi*$i-sn*$i-Bi*Rn)))+(Ar=cs-ki))+(Ar-Xl),lt[1]=(oo=fs-((En=fs+ki)-(Ar=En-fs))+(ki-Ar))-((ki=oo-ao)+(Ar=oo-ki))+(Ar-ao),lt[2]=En-((Mn=En+ki)-(Ar=Mn-En))+(ki-Ar),lt[3]=Mn;var fN=Le(dN,_t,4,lt,Et);return Et[fN-1]}(Ft,Lt,qt,pr,Zr,Kr,Hr)}(ye[0],ye[1],xe[0],xe[1],Ke[0],Ke[1]);return ut>0?-1:ut<0?1:0}function Je(ye,xe){var Ke=ye.point,ut=xe.point;return Ke[0]>ut[0]?1:Ke[0]<ut[0]?-1:Ke[1]!==ut[1]?Ke[1]>ut[1]?1:-1:function(Ft,Lt,qt,pr){return Ft.left!==Lt.left?Ft.left?1:-1:yt(qt,Ft.otherEvent.point,Lt.otherEvent.point)!==0?Ft.isBelow(Lt.otherEvent.point)?-1:1:!Ft.isSubject&&Lt.isSubject?1:-1}(ye,xe,Ke)}function Ze(ye,xe,Ke){var ut=new le(xe,!1,ye,ye.isSubject),Ft=new le(xe,!0,ye.otherEvent,ye.isSubject);return de(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),ut.contourId=Ft.contourId=ye.contourId,Je(Ft,ye.otherEvent)>0&&(ye.otherEvent.left=!0,Ft.left=!1),ye.otherEvent.otherEvent=Ft,ye.otherEvent=ut,Ke.push(Ft),Ke.push(ut),Ke}function At(ye,xe){return ye[0]*xe[1]-ye[1]*xe[0]}function Tt(ye,xe){return ye[0]*xe[0]+ye[1]*xe[1]}function hr(ye,xe,Ke){var ut=function(Zr,Kr,Wr,wi,qi){var Hr=[Kr[0]-Zr[0],Kr[1]-Zr[1]],Oi=[wi[0]-Wr[0],wi[1]-Wr[1]];function Si(ai,Bi,sn){return[ai[0]+Bi*sn[0],ai[1]+Bi*sn[1]]}var ui=[Wr[0]-Zr[0],Wr[1]-Zr[1]],Ni=At(Hr,Oi),zi=Ni*Ni,Mi=Tt(Hr,Hr);if(zi>0){var Li=At(ui,Oi)/Ni;if(Li<0||Li>1)return null;var Ei=At(ui,Hr)/Ni;return Ei<0||Ei>1?null:Li===0||Li===1?[Si(Zr,Li,Hr)]:Ei===0||Ei===1?[Si(Wr,Ei,Oi)]:[Si(Zr,Li,Hr)]}if((zi=(Ni=At(ui,Hr))*Ni)>0)return null;var Yr=Tt(Hr,ui)/Mi,Ii=Yr+Tt(Hr,Oi)/Mi,tn=Math.min(Yr,Ii),Ar=Math.max(Yr,Ii);return tn<=1&&Ar>=0?tn===1?[Si(Zr,tn>0?tn:0,Hr)]:Ar===0?[Si(Zr,Ar<1?Ar:1,Hr)]:[Si(Zr,tn>0?tn:0,Hr),Si(Zr,Ar<1?Ar:1,Hr)]:null}(ye.point,ye.otherEvent.point,xe.point,xe.otherEvent.point),Ft=ut?ut.length:0;if(Ft===0||Ft===1&&(de(ye.point,xe.point)||de(ye.otherEvent.point,xe.otherEvent.point))||Ft===2&&ye.isSubject===xe.isSubject)return 0;if(Ft===1)return de(ye.point,ut[0])||de(ye.otherEvent.point,ut[0])||Ze(ye,ut[0],Ke),de(xe.point,ut[0])||de(xe.otherEvent.point,ut[0])||Ze(xe,ut[0],Ke),1;var Lt=[],qt=!1,pr=!1;return de(ye.point,xe.point)?qt=!0:Je(ye,xe)===1?Lt.push(xe,ye):Lt.push(ye,xe),de(ye.otherEvent.point,xe.otherEvent.point)?pr=!0:Je(ye.otherEvent,xe.otherEvent)===1?Lt.push(xe.otherEvent,ye.otherEvent):Lt.push(ye.otherEvent,xe.otherEvent),qt&&pr||qt?(xe.type=E,ye.type=xe.inOut===ye.inOut?I:C,qt&&!pr&&Ze(Lt[1].otherEvent,Lt[0].point,Ke),2):pr?(Ze(Lt[0],Lt[1].point,Ke),3):Lt[0]!==Lt[3].otherEvent?(Ze(Lt[0],Lt[1].point,Ke),Ze(Lt[1],Lt[2].point,Ke),3):(Ze(Lt[0],Lt[1].point,Ke),Ze(Lt[3].otherEvent,Lt[2].point,Ke),3)}function Gt(ye,xe){if(ye===xe)return 0;if(yt(ye.point,ye.otherEvent.point,xe.point)!==0||yt(ye.point,ye.otherEvent.point,xe.otherEvent.point)!==0)return de(ye.point,xe.point)?ye.isBelow(xe.otherEvent.point)?-1:1:ye.point[0]===xe.point[0]?ye.point[1]<xe.point[1]?-1:1:Je(ye,xe)===1?xe.isAbove(ye.point)?-1:1:ye.isBelow(xe.point)?-1:1;if(ye.isSubject!==xe.isSubject)return ye.isSubject?-1:1;var Ke=ye.point,ut=xe.point;return Ke[0]===ut[0]&&Ke[1]===ut[1]?(Ke=ye.otherEvent.point)[0]===(ut=xe.otherEvent.point)[0]&&Ke[1]===ut[1]?0:ye.contourId>xe.contourId?1:-1:Je(ye,xe)===1?1:-1}var Jt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Rt(ye,xe,Ke,ut){var Ft,Lt=ye+1,qt=xe[ye].point,pr=xe.length;for(Lt<pr&&(Ft=xe[Lt].point);Lt<pr&&Ft[0]===qt[0]&&Ft[1]===qt[1];){if(!Ke[Lt])return Lt;++Lt<pr&&(Ft=xe[Lt].point)}for(Lt=ye-1;Ke[Lt]&&Lt>ut;)Lt--;return Lt}Jt.prototype.isExterior=function(){return this.holeOf==null};var cr=Nt,Mr=Nt;function Nt(ye,xe){if(!(this instanceof Nt))return new Nt(ye,xe);if(this.data=ye||[],this.length=this.data.length,this.compare=xe||rr,this.length>0)for(var Ke=(this.length>>1)-1;Ke>=0;Ke--)this._down(Ke)}function rr(ye,xe){return ye<xe?-1:ye>xe?1:0}Nt.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var xe=this.data,Ke=this.compare,ut=xe[ye];ye>0;){var Ft=ye-1>>1,Lt=xe[Ft];if(Ke(ut,Lt)>=0)break;xe[ye]=Lt,ye=Ft}xe[ye]=ut},_down:function(ye){for(var xe=this.data,Ke=this.compare,ut=this.length>>1,Ft=xe[ye];ye<ut;){var Lt=1+(ye<<1),qt=Lt+1,pr=xe[Lt];if(qt<this.length&&Ke(xe[qt],pr)<0&&(Lt=qt,pr=xe[qt]),Ke(pr,Ft)>=0)break;xe[ye]=pr,ye=Lt}xe[ye]=Ft}},cr.default=Mr;var Tr=Math.max,Lr=Math.min,qr=0;function Nr(ye,xe,Ke,ut,Ft,Lt){var qt,pr,Zr,Kr,Wr,wi;for(qt=0,pr=ye.length-1;qt<pr;qt++)if(Kr=ye[qt+1],Wr=new le(Zr=ye[qt],!1,void 0,xe),wi=new le(Kr,!1,Wr,xe),Wr.otherEvent=wi,Zr[0]!==Kr[0]||Zr[1]!==Kr[1]){Wr.contourId=wi.contourId=Ke,Lt||(Wr.isExteriorRing=!1,wi.isExteriorRing=!1),Je(Wr,wi)>0?wi.left=!0:Wr.left=!0;var qi=Zr[0],Hr=Zr[1];Ft[0]=Lr(Ft[0],qi),Ft[1]=Lr(Ft[1],Hr),Ft[2]=Tr(Ft[2],qi),Ft[3]=Tr(Ft[3],Hr),ut.push(Wr),ut.push(wi)}}var Yt=[];function Fr(ye,xe,Ke){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof xe[0][0][0]=="number"&&(xe=[xe]);var ut=function(Hr,Oi,Si){var ui=null;return Hr.length*Oi.length==0&&(Si===k?ui=Yt:Si===N?ui=Hr:Si!==F&&Si!==W||(ui=Hr.length===0?Oi:Hr)),ui}(ye,xe,Ke);if(ut)return ut===Yt?null:ut;var Ft=[1/0,1/0,-1/0,-1/0],Lt=[1/0,1/0,-1/0,-1/0],qt=function(Hr,Oi,Si,ui,Ni){var zi,Mi,Li,Ei,Yr,Ii,tn=new cr(null,Je);for(Li=0,Ei=Hr.length;Li<Ei;Li++)for(Yr=0,Ii=(zi=Hr[Li]).length;Yr<Ii;Yr++)(Mi=Yr===0)&&qr++,Nr(zi[Yr],!0,qr,tn,Si,Mi);for(Li=0,Ei=Oi.length;Li<Ei;Li++)for(Yr=0,Ii=(zi=Oi[Li]).length;Yr<Ii;Yr++)Mi=Yr===0,Ni===N&&(Mi=!1),Mi&&qr++,Nr(zi[Yr],!1,qr,tn,ui,Mi);return tn}(ye,xe,Ft,Lt,Ke);if(ut=function(Hr,Oi,Si,ui,Ni){var zi=null;return(Si[0]>ui[2]||ui[0]>Si[2]||Si[1]>ui[3]||ui[1]>Si[3])&&(Ni===k?zi=Yt:Ni===N?zi=Hr:Ni!==F&&Ni!==W||(zi=Hr.concat(Oi))),zi}(ye,xe,Ft,Lt,Ke))return ut===Yt?null:ut;for(var pr=function(Hr){var Oi,Si,ui=function(Li){var Ei,Yr,Ii,tn,Ar=[];for(Yr=0,Ii=Li.length;Yr<Ii;Yr++)((Ei=Li[Yr]).left&&Ei.inResult||!Ei.left&&Ei.otherEvent.inResult)&&Ar.push(Ei);for(var ai=!1;!ai;)for(ai=!0,Yr=0,Ii=Ar.length;Yr<Ii;Yr++)Yr+1<Ii&&Je(Ar[Yr],Ar[Yr+1])===1&&(tn=Ar[Yr],Ar[Yr]=Ar[Yr+1],Ar[Yr+1]=tn,ai=!1);for(Yr=0,Ii=Ar.length;Yr<Ii;Yr++)(Ei=Ar[Yr]).otherPos=Yr;for(Yr=0,Ii=Ar.length;Yr<Ii;Yr++)(Ei=Ar[Yr]).left||(tn=Ei.otherPos,Ei.otherPos=Ei.otherEvent.otherPos,Ei.otherEvent.otherPos=tn);return Ar}(Hr),Ni={},zi=[],Mi=function(){if(!Ni[Oi]){var Li=zi.length,Ei=function(Ar,ai,Bi){var sn=new Jt;if(Ar.prevInResult!=null){var $i=Ar.prevInResult,Rn=$i.outputContourId;if($i.resultTransition>0){var ki=ai[Rn];if(ki.holeOf!=null){var En=ki.holeOf;ai[En].holeIds.push(Bi),sn.holeOf=En,sn.depth=ai[Rn].depth}else ai[Rn].holeIds.push(Bi),sn.holeOf=Rn,sn.depth=ai[Rn].depth+1}else sn.holeOf=null,sn.depth=ai[Rn].depth}else sn.holeOf=null,sn.depth=0;return sn}(ui[Oi],zi,Li),Yr=function(Ar){Ni[Ar]=!0,Ar<ui.length&&ui[Ar]&&(ui[Ar].outputContourId=Li)},Ii=Oi,tn=Oi;for(Ei.points.push(ui[Oi].point);Yr(Ii),Yr(Ii=ui[Ii].otherPos),Ei.points.push(ui[Ii].point),!((Ii=Rt(Ii,ui,Ni,tn))==tn||Ii>=ui.length)&&ui[Ii];);zi.push(Ei)}};for(Oi=0,Si=ui.length;Oi<Si;Oi++)Mi();return zi}(function(Hr,Oi,Si,ui,Ni,zi){for(var Mi,Li,Ei,Yr=new h(Gt),Ii=[],tn=Math.min(ui[2],Ni[2]);Hr.length!==0;){var Ar=Hr.pop();if(Ii.push(Ar),zi===k&&Ar.point[0]>tn||zi===N&&Ar.point[0]>ui[2])break;if(Ar.left){Li=Mi=Yr.insert(Ar),Mi=Mi!==(Ei=Yr.minNode())?Yr.prev(Mi):null,Li=Yr.next(Li);var ai=Mi?Mi.key:null;if(Z(Ar,ai,zi),Li&&hr(Ar,Li.key,Hr)===2&&(Z(Ar,ai,zi),Z(Li.key,Ar,zi)),Mi&&hr(Mi.key,Ar,Hr)===2){var Bi=Mi;Z(ai,(Bi=Bi!==Ei?Yr.prev(Bi):null)?Bi.key:null,zi),Z(Ar,ai,zi)}}else Li=Mi=Yr.find(Ar=Ar.otherEvent),Mi&&Li&&(Mi=Mi!==Ei?Yr.prev(Mi):null,Li=Yr.next(Li),Yr.remove(Ar),Li&&Mi&&hr(Mi.key,Li.key,Hr))}return Ii}(qt,0,0,Ft,Lt,Ke)),Zr=[],Kr=0;Kr<pr.length;Kr++){var Wr=pr[Kr];if(Wr.isExterior()){for(var wi=[Wr.points],qi=0;qi<Wr.holeIds.length;qi++)wi.push(pr[Wr.holeIds[qi]].points);Zr.push(wi)}}return Zr}var ni={UNION:F,DIFFERENCE:N,INTERSECTION:k,XOR:W};n.diff=function(ye,xe){return Fr(ye,xe,N)},n.intersection=function(ye,xe){return Fr(ye,xe,k)},n.operations=ni,n.union=function(ye,xe){return Fr(ye,xe,F)},n.xor=function(ye,xe){return Fr(ye,xe,W)},Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,RE.exports)),RE.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Hy(o,e,n,c){const h=[],p=c===0?(g,x,b,E,I,C)=>{g.push(new bt(C,b+(C-x)/(E-x)*(I-b)))}:(g,x,b,E,I,C)=>{g.push(new bt(x+(C-b)/(I-b)*(E-x),C))};for(const g of o){const x=[];for(const b of g){if(b.length<=2)continue;const E=[];for(let k=0;k<b.length-1;k++){const F=b[k].x,N=b[k].y,W=b[k+1].x,Z=b[k+1].y,X=c===0?F:N,le=c===0?W:Z;X<e?le>e&&p(E,F,N,W,Z,e):X>n?le<n&&p(E,F,N,W,Z,n):E.push(b[k]),le<e&&X>=e&&p(E,F,N,W,Z,e),le>n&&X<=n&&p(E,F,N,W,Z,n)}let I=b[b.length-1];const C=c===0?I.x:I.y;C>=e&&C<=n&&E.push(I),E.length&&(I=E[E.length-1],E[0].x===I.x&&E[0].y===I.y||E.push(E[0]),x.push(E))}x.length&&h.push(x)}return h}function lL(o,e){const n=kw(o),c=kw([e]),h=ME.intersection(n,c);return h==null?[]:DE(h)}function cL(o,e){let c=kw(o,65536);const h=[];for(;e.valid();e.next()){const[p,g]=e.get(),x=p.x*65536,b=p.y*65536,E=g.x*65536,I=g.y*65536,C=E-x,k=I-b,F=Math.hypot(C,k);if(F===0)continue;const N=Math.trunc(k/F*3),W=-Math.trunc(C/F*3);h.push([[[x,b],[E,I],[E+N,I+W],[x+N,b+W],[x,b]]])}return h.length>0&&(c=ME.diff(c,h)),DE(c,1/65536)}function kw(o,e=1){return[o.map(n=>n.map(c=>[c.x*e,c.y*e]))]}function DE(o,e=1){return o.map(n=>n.map((c,h)=>{const p=c.map(g=>new bt(g[0]*e,g[1]*e).round());return h>0&&p.reverse(),p}))}class Rw{constructor(e,n){this.layoutVertexArray=new jl,this.indexArray=new Nn,this.lineIndexArray=new Pn,this.triangleSegments=new en,this.lineSegments=new en,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new Ul)}update(e,n,c,h,p,g,x,b){this.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ZO.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,c,h,p,g,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,p,g,void 0,x)}}class Mw{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Rw(e,!1),this.elevationBufferData=new Rw(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,c,h){this.hasPattern=Cw("fill",this.layers,this.pixelRatio,n);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:b,index:E,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,k=St(x,C);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),k,c))continue;const F=p?p.evaluate(k,{},c,n.availableImages):void 0,N={id:b,properties:x.properties,type:x.type,sourceLayerIndex:I,index:E,geometry:C?k.geometry:jt(x,c,h),patterns:{},sortKey:F};g.push(N)}p&&g.sort((x,b)=>x.sortKey-b.sortKey);for(const x of g){const{geometry:b,index:E,sourceLayerIndex:I}=x;if(this.hasPattern){const C=Pw("fill",this.layers,x,this.zoom,this.pixelRatio,n);this.patternFeatures.push(C)}else this.addFeature(x,b,E,c,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[E].feature,b,E,I,this.index)}}update(e,n,c,h,p,g,x){this.bufferData.update(e,n,c,h,p,g,x,this.worldview),this.elevationBufferData.update(e,n,c,h,p,g,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,c,h,p,g,x,this.worldview)}addFeatures(e,n,c,h,p,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,c,h,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,c,h,p,g=[],x,b){const E=B0(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,E,h,c,b):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(e,c,p,g,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,c,p,g,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,c,h,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,c,h,p,this.worldview))}addElevatedRoadFeature(e,n,c,h,p){const g=new Array,x=Ki.getElevationFeature(e,p);if(!x)return void this.addGeometry(n,this.bufferData);{const E=this.clipPolygonsToTile(n,1);E.length>0&&g.push({polygons:E,elevationFeature:x,elevationTileID:c})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},c),featureIndex:h};for(const E of g)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Co(E.elevationTileID,this.layers,this.zoom,this.lut));const C=E.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(xi)&&(k=+e.properties[xi]);for(const F of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,F,C,E.elevationFeature,k)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const I=new bn(c,E.elevationTileID);this.addElevatedGeometry(E.polygons,I,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,b)}}addElevatedGeometry(e,n,c,h,p,g){const x={elevation:c,elevationSampler:n,bias:h,index:p,featureInfo:g},[b,E]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(e,n,c){let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=null;c&&(g=c.elevationSampler.constantElevation(c.elevation,c.bias),g!=null&&(h=g,p=g));const x=(b,E,I)=>{if(c!=null)if(E.push(b),g!=null)n.elevatedLayoutVertexArray.emplaceBack(g),I.push(g);else{const C=c.elevationSampler.pointElevation(b,c.elevation,c.bias);n.elevatedLayoutVertexArray.emplaceBack(C),I.push(C),h=Math.min(h,C),p=Math.max(p,C)}};for(const b of e){let E=0;for(const ce of b)E+=ce.length;const I=n.triangleSegments.prepareSegment(E,n.layoutVertexArray,n.indexArray),C=I.vertexLength,k=[],F=[],N=[],W=[],Z=[],X=n.layoutVertexArray.length;for(const ce of b){if(ce.length===0)continue;ce!==b[0]&&F.push(k.length/2);const de=n.lineSegments.prepareSegment(ce.length,n.layoutVertexArray,n.lineIndexArray),Ie=de.vertexLength;c&&Z.push(n.layoutVertexArray.length-X),x(ce[0],N,W),n.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),n.lineIndexArray.emplaceBack(Ie+ce.length-1,Ie),k.push(ce[0].x),k.push(ce[0].y);for(let Ce=1;Ce<ce.length;Ce++)x(ce[Ce],N,W),n.layoutVertexArray.emplaceBack(ce[Ce].x,ce[Ce].y),n.lineIndexArray.emplaceBack(Ie+Ce-1,Ie+Ce),k.push(ce[Ce].x),k.push(ce[Ce].y);de.vertexLength+=ce.length,de.primitiveLength+=ce.length}const le=op(k,F);for(let ce=0;ce<le.length;ce+=3)n.indexArray.emplaceBack(C+le[ce],C+le[ce+1],C+le[ce+2]);if(le.length>0&&c&&this.elevationMode==="hd-road-base"){const ce=c.elevation.isTunnel(),de=c.elevation.safeArea,Ie=this.elevatedStructures.addVertices(N,W);this.elevatedStructures.addTriangles(le,Ie,ce);const Ce=Z.length;if(Ce>0){for(let Re=0;Re<Ce-1;Re++)this.elevatedStructures.addRenderableRing(c.index,Z[Re]+Ie,Z[Re+1]-Z[Re],ce,de,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,Z[Ce-1]+Ie,N.length-Z[Ce-1],ce,de,c.featureInfo)}}I.vertexLength+=E,I.primitiveLength+=le.length/3}return[h,p]}prepareElevatedPolygons(e,n,c){const h=1/$e(c),p=[];for(const g of e){const x=cL(g,new vi(n,h));p.push(...x)}return p}clipPolygonsToTile(e,n){const c=-n,h=-n,p=Dt+n,g=Dt+n;let x=0;const b=[],E=[];for(;x<e.length;x++){const k=e[x],F=uf(k);(F.min.x>=c&&F.max.x<=p&&F.min.y>=h&&F.max.y<=g?b:E).push(k)}if(b.length===e.length)return e;const I=[new bt(c,h),new bt(p,h),new bt(p,g),new bt(c,g),new bt(c,h)],C=b;for(const k of E)C.push(...lL(k,I));return C}}let OE,LE,FE,NE;Wt(Mw,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(Rw,"FillBufferData"),Wt(Co,"ElevatedStructures");class Wy{constructor(e,n,c,h){if(this.triangleCount=n.length/3,this.min=new bt(0,0),this.max=new bt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,g]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const k=e[C];p.x=Math.min(p.x,k.x),p.y=Math.min(p.y,k.y),g.x=Math.max(g.x,k.x),g.y=Math.max(g.y,k.y)}if(h){const C=Math.ceil(Math.max(g.x-p.x,g.y-p.y)/h);c=Math.max(c,C)}if(c===0)return;this.min=p,this.max=g;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const b=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/b)),this.cellsY=Math.max(1,Math.ceil(x.y/b)),this.xScale=1/b,this.yScale=1/b;const E=[];for(let C=0;C<this.triangleCount;C++){const k=e[n[3*C+0]].sub(this.min),F=e[n[3*C+1]].sub(this.min),N=e[n[3*C+2]].sub(this.min),W=ql(Math.floor(Math.min(k.x,F.x,N.x)),this.xScale,this.cellsX),Z=ql(Math.floor(Math.max(k.x,F.x,N.x)),this.xScale,this.cellsX),X=ql(Math.floor(Math.min(k.y,F.y,N.y)),this.yScale,this.cellsY),le=ql(Math.floor(Math.max(k.y,F.y,N.y)),this.yScale,this.cellsY),ce=new bt(0,0),de=new bt(0,0),Ie=new bt(0,0),Ce=new bt(0,0);for(let Re=X;Re<=le;++Re){ce.y=de.y=Re*b,Ie.y=Ce.y=(Re+1)*b;for(let Le=W;Le<=Z;++Le)ce.x=Ie.x=Le*b,de.x=Ce.x=(Le+1)*b,(el(k,F,N,ce,de,Ce)||el(k,F,N,ce,Ce,Ie))&&E.push({cellIdx:Re*this.cellsX+Le,triIdx:C})}}if(E.length===0)return;E.sort((C,k)=>C.cellIdx-k.cellIdx||C.triIdx-k.triIdx);let I=0;for(;I<E.length;){const C=E[I].cellIdx,k={start:this.payload.length,len:0};for(;I<E.length&&E[I].cellIdx===C;)++k.len,this.payload.push(E[I++].triIdx);this.cells[C]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const c=ql(e.x-this.min.x,this.xScale,this.cellsX),h=ql(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+c];if(p){this._lazyInitLookup();for(let g=0;g<p.len;g++){const x=this.payload[p.start+g],b=Math.floor(x/8),E=1<<x%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,n.push(x),n.length===this.triangleCount))return}}}query(e,n,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const h=ql(e.x-this.min.x,this.xScale,this.cellsX),p=ql(n.x-this.min.x,this.xScale,this.cellsX),g=ql(e.y-this.min.y,this.yScale,this.cellsY),x=ql(n.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=x;b++)for(let E=h;E<=p;E++){const I=this.cells[b*this.cellsX+E];if(I)for(let C=0;C<I.len;C++){const k=this.payload[I.start+C],F=Math.floor(k/8),N=1<<k%8;if(!(this.lookup[F]&N)&&(this.lookup[F]|=N,c.push(k),c.length===this.triangleCount))return}}}}function ql(o,e,n){return Math.max(0,Math.min(n-1,Math.floor(o*e)))}Wt(Wy,"TriangleGridIndex");class zE{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,n){for(const c of this.footprints)n.push({footprint:c,id:e})}populate(e,n,c,h){const p=[];for(const{feature:g,id:x,index:b,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,C=St(g,I);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),C,c))continue;const k={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:b,geometry:I?C.geometry:jt(g,c,h),patterns:{}};p.push(k)}for(const g of p){const{geometry:x,index:b,sourceLayerIndex:E}=g;this.addFeature(g,x,b,c,{},n.availableImages,n.brightness),n.featureIndex.insert(e[b].feature,x,b,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,c,h,p,g,x){}destroy(){}addFeature(e,n,c,h,p,g=[],x){for(const b of B0(n,2)){const E=[],I=[],C=[],k=new bt(1/0,1/0),F=new bt(-1/0,-1/0);for(const Z of b)if(Z.length!==0){Z!==b[0]&&C.push(I.length/2);for(let X=0;X<Z.length;X++)I.push(Z[X].x),I.push(Z[X].y),E.push(Z[X]),k.x=Math.min(k.x,Z[X].x),k.y=Math.min(k.y,Z[X].y),F.x=Math.max(F.x,Z[X].x),F.y=Math.max(F.y,Z[X].y)}const N=op(I,C),W=new Wy(E,N,8,256);this.footprints.push({vertices:E,indices:N,grid:W,min:k,max:F})}}}Wt(zE,"ClipBucket",{omit:["layers"]});const uL=ii([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hL=ii([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dL=ii([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fL=ii([{name:"a_join_normal_inside",components:3,type:"Int16"}]),pL=ii([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),mL=ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gL}=uL,j0=Number.MAX_SAFE_INTEGER,BE=j0-1;function jE(o,e,n,c){return o.order<e||o.order===j0||!(o.clipMask&n)||function(h,p){return p.length!==0&&p.find(g=>g===h)===void 0}(c,o.clipScope)}function qy(o,e){return o.x-e.x||o.y-e.y}function UE(o,e){return qy(o.min,e.min)===0&&qy(o.max,e.max)===0}function Dw(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Zy(o,e){if(o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(o[n].sourceId!==e[n].sourceId||!UE(o[n],e[n])||o[n].order!==e[n].order||o[n].clipMask!==e[n].clipMask||!ea(o[n].clipScope,e[n].clipScope))return!1;return!0}function VE(o,e,n){const c=1/Dt,h=1/(1<<n.canonical.z),p=(e.x*c+n.canonical.x)*h+n.wrap,g=(e.y*c+n.canonical.y)*h;return{min:new bt((o.x*c+n.canonical.x)*h+n.wrap,(o.y*c+n.canonical.y)*h),max:new bt(p,g)}}function _L(o,e,n){const c=1<<n.canonical.z,h=((e.x-n.wrap)*c-n.canonical.x)*Dt,p=(e.y*c-n.canonical.y)*Dt;return{min:new bt(((o.x-n.wrap)*c-n.canonical.x)*Dt,(o.y*c-n.canonical.y)*Dt),max:new bt(h,p)}}function Ow(o,e,n,c,h,p,g){const x=o.indices,b=o.vertices,E=[];for(let I=c;I<c+h;I+=3){const C=e[n[I+0]+p],k=e[n[I+1]+p],F=e[n[I+2]+p],N=Math.min(C.x,k.x,F.x),W=Math.max(C.x,k.x,F.x),Z=Math.min(C.y,k.y,F.y),X=Math.max(C.y,k.y,F.y);E.length=0,o.grid.query(new bt(N,Z),new bt(W,X),E);for(let le=0;le<E.length;le++){const ce=E[le];if(el(b[x[3*ce+0]],b[x[3*ce+1]],b[x[3*ce+2]],C,k,F,g))return!0}}return!1}function $E(o,e,n,c){if(!o||!n)return!1;let h=o.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(n.vertices.length<o.vertices.length)return $E(n,c,o,e);const p=e.canonical,g=c.canonical,x=Math.pow(2,g.z-p.z);h=o.vertices.map(b=>new bt((b.x+p.x*Dt)*x-g.x*Dt,(b.y+p.y*Dt)*x-g.y*Dt))}return Ow(n,h,o.indices,0,o.indices.length,0,0)}function GE(o,e,n,c){const h=Math.pow(2,c.z-n.z);return new bt((o+n.x*Dt)*h-c.x*Dt,(e+n.y*Dt)*h-c.y*Dt)}function Lw(o,e){const n=[];e.grid.queryPoint(o,n);const c=e.indices,h=e.vertices;for(let p=0;p<n.length;p++){const g=n[p];if(Wn([h[c[3*g+0]],h[c[3*g+1]],h[c[3*g+2]]],o))return!0}return!1}const Fw=[new bt(0,0),new bt(Dt,0),new bt(Dt,Dt),new bt(0,Dt)];function HE(o,e){const n=[];let c=[];if(!e||o.length<2)return[o];if(o.length===2)return hs(o[0],o[1],Fw)?[o]:[];for(let h=0;h<o.length+2;h++){const p=o[h%o.length],g=o[(h+1)%o.length],x=hs(h===0?o[o.length-1]:o[(h-1)%o.length],p,Fw),b=hs(p,g,Fw),E=x||b;E&&c.push(p),E&&b||c.length>0&&(c.length>1&&n.push(c),c=[])}return c.length>1&&n.push(c),n}const Nw=xt.types,yL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],xL=["fill-extrusion-flood-light-ground-radius"],vL=Math.pow(2,13),wL=Math.pow(2,15)-1,WE=new bt(0,1),zu=2147483648;function U0(o,e,n,c,h,p,g,x){o.emplaceBack((e<<1)+g,(n<<1)+p,(Math.floor(c*vL)<<1)+h,Math.round(x))}function V0(o,e,n){o.emplaceBack(e.x*Dt,e.y*Dt,n?1:0)}function Xy(o,e,n,c,h,p){o.emplaceBack(e.x,e.y,(n.x<<1)+c,(n.y<<1)+h,p)}function $0(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class qE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ZE{constructor(){this.centroidXY=new bt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new bt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new bt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new bt(this.max.x-this.min.x,this.max.y-this.min.y)}}class XE{constructor(){this.acc=new bt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,c){this.accCount++,this.acc._add(n);let h=!!this.borders;n.x<e.min.x?(e.min.x=n.x,h=!0):n.x>e.max.x&&(e.max.x=n.x,h=!0),n.y<e.min.y?(e.min.y=n.y,h=!0):n.y>e.max.y&&(e.max.y=n.y,h=!0),((n.x===0||n.x===Dt)&&n.x===c.x)!=((n.y===0||n.y===Dt)&&n.y===c.y)&&this.processBorderOverlap(n,c),h&&this.checkBorderIntersection(n,c)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,wr(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Dt!=e.x>Dt&&this.addBorderIntersection(1,wr(n.y,e.y,(Dt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,wr(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Dt!=e.y>Dt&&this.addBorderIntersection(3,wr(n.x,e.x,(Dt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];n<c[0]&&(c[0]=n),n>c[1]&&(c[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,n.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,n.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new bt(0,0):new bt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function KE(o,e){const n=o.add(e)._unit(),c=U(o.x*n.x+o.y*n.y,-1,1);var h,p,g;return h=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(h)))/4*wL*((p=o).x*(g=e).y-p.y*g.x<0?-1:1)}const bL=[o=>o.x<0,o=>o.x>Dt,o=>o.y<0,o=>o.y>Dt];function TL(o,e,n,c){const h=[4];if(c===0)return h;n._mult(c);const p=o.sub(n),g=e.sub(n),x=[o,e,p,g];for(let b=0;b<4;b++)for(const E of x)if(bL[b](E)){h.push(b);break}return h}class zw{constructor(e){this.vertexArray=new w0,this.indexArray=new Nn,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut},n=>xL.includes(n)),this._segments=new en,this.hiddenByLandmarkVertexArray=new ep,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new en}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,c,h=!1){const p=e.length;if(p>2){let g=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const E=e[0],I=e[1];b=KE(E.sub(e[p-1])._perp()._unit(),I.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const I=E===p-1?0:E+1,C=e[E],k=e[I],F=e[I===p-1?0:I+1],N=k.sub(C)._perp()._unit(),W=KE(N,F.sub(k)._perp()._unit()),Z=b,X=W;if(Bw(C,k,n)||h&&QE(C,n)&&QE(k,n)){b=W;continue}const le=x.vertexLength;Xy(this.vertexArray,C,k,1,1,Z),Xy(this.vertexArray,C,k,1,0,Z),Xy(this.vertexArray,C,k,0,1,X),Xy(this.vertexArray,C,k,0,0,X),x.vertexLength+=4;const ce=TL(C,k,N,c);for(const de of ce)this._segmentToGroundQuads[g].push({id:le,region:de}),this._segmentToRegionTriCounts[g][de]+=2,x.primitiveLength+=2;b=W}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let c=0;c<n;c++)this._segmentToGroundQuads[c].sort((h,p)=>h.region-p.region);for(let c=0;c<n;c++){const h=this._segmentToGroundQuads[c],p=e[c],g=this._segmentToRegionTriCounts[c];g.reduce((b,E)=>b+E,0);let x=0;for(let b=0;b<=4;b++){const E=g[b];if(E!==0){let I=this.regionSegments[b];I||(I=this.regionSegments[b]=new en);const C={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+x,vertexLength:p.vertexLength,primitiveLength:E};I.get().push(C)}x+=E}for(let b=0;b<h.length;b++){const E=h[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,c,h,p,g,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,c,h,p,g,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,c,h,p,g,x,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,c,h,p,g,x,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&zu))}updateHiddenByLandmarkRange(e,n,c){if(!this.hasData())return;const h=n+e;if(n!==0){for(let p=e;p<h;++p)this.hiddenByLandmarkVertexArray.emplace(p,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Ky{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Nn,this.footprintVertices=new jl,this.footprintSegments=[],this.layoutVertexArray=new Cc,this.centroidVertexArray=new Dy,this.wallVertexArray=new Ly,this.indexArray=new Nn,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut},n=>yL.includes(n)),this.segments=new en,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new zw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,c,h){this.features=[],this.hasPattern=Cw("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$e(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:g,index:x,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,I=St(p,E);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),I,c))continue;const C={id:g,sourceLayerIndex:b,index:x,geometry:E?I.geometry:jt(p,c,h),properties:p.properties,type:p.type,patterns:{}},k=this.layoutVertexArray.length,F=Nw[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:Pw("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const N of C.geometry)for(const W of HE(N,F))this.addFeature(p.id,C,[W],x,c,{},n.availableImages,h,n.brightness);else this.addFeature(p.id,C,C.geometry,x,c,{},n.availableImages,h,n.brightness);n.featureIndex.insert(p,C.geometry,x,b,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,c,h,p,g){for(const{featureId:x,feature:b}of this.features){const E=Nw[b.type]==="Polygon",{geometry:I}=b;if(this.wallMode)for(const C of I)for(const k of HE(C,E))this.addFeature(x,b,[k],b.index,n,c,h,p,g);else this.addFeature(x,b,I,b.index,n,c,h,p,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,c,h,p,g,x){this.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,this.worldview),this.groundEffect.update(e,n,p,c,h,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,fL.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,mL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,dL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,c,h,p,g,x,b,E){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new bt(0,0),new bt(Dt,Dt)],k=b.projection,F=k.name==="globe",N=this.wallMode||Nw[n.type]==="Polygon",W=new XE;W.centroidDataIndex=this.centroidData.length;const Z=new ZE;Z.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(Z.buildingId=n.properties.building_id);const X=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},p)<=0,le=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},p);let ce;if(Z.height=le,Z.vertexArrayOffset=this.layoutVertexArray.length,Z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xf),this.wallMode){if(F)return void $t("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;ce=function(je){const pt=je[0].x===je[je.length-1].x&&je[0].y===je[je.length-1].y;(function(Rt){let cr=0;const Mr=Rt.length;for(let Nt=0;Nt<Mr;Nt++)cr+=(Rt[(Nt+1)%Mr].x-Rt[Nt].x)*(Rt[(Nt+1)%Mr].y+Rt[Nt].y);return cr>=0})(je)||(je=je.reverse());const mt={geometry:[],joinNormals:[],indices:[]},_t=[],Et=[],lt=[];let yt=je.length;for(;yt>=2&&je[yt-1].equals(je[yt-2]);)yt--;if(yt<(pt?3:2))return mt;let Je,Ze,At,Tt,hr,Gt=0;for(;Gt<yt-1&&je[Gt].equals(je[Gt+1]);)Gt++;pt&&(Je=je[yt-2],hr=je[Gt].sub(Je)._unit()._perp());for(let Rt=Gt;Rt<yt;Rt++){if(At=Rt===yt-1?pt?je[Gt+1]:void 0:je[Rt+1],At&&je[Rt].equals(At))continue;hr&&(Tt=hr),Je&&(Ze=Je),Je=je[Rt],hr=At?At.sub(Je)._unit()._perp():Tt,Tt=Tt||hr;let cr=Tt.add(hr);cr.x===0&&cr.y===0||cr._unit();const Mr=cr.x*hr.x+cr.y*hr.y,Nt=Mr!==0?1/Mr:1/0,rr=Tt.x*hr.y-Tt.y*hr.x>0;let Tr="miter";const Lr=2;Tr==="miter"&&Nt>Lr&&(Tr="bevel"),Tr==="bevel"&&(Nt>100&&(Tr="flipbevel"),Nt<Lr&&(Tr="miter"));const qr=(Nr,Yt,Fr,ni)=>{const ye=new bt(Nr.x,Nr.y),xe=new bt(Nr.x,Nr.y);ye.x+=Yt.x*ni,ye.y+=Yt.y*ni,xe.x-=Yt.x*Math.max(Fr,1),xe.y-=Yt.y*Math.max(Fr,1),lt.push(Yt),_t.push(ye),Et.push(xe)};if(Tr==="miter")cr._mult(Nt),qr(Je,cr,0,0);else if(Tr==="flipbevel")cr=hr.mult(-1),qr(Je,cr,0,0),qr(Je,cr.mult(-1),0,0);else{const Nr=-Math.sqrt(Nt*Nt-1),Yt=rr?Nr:0,Fr=rr?0:Nr;Ze&&qr(Je,Tt,Yt,Fr),At&&qr(Je,hr,Yt,Fr)}}mt.geometry=[..._t,...Et.reverse(),_t[0]],mt.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]];const Jt=mt.geometry.length-1;for(let Rt=0;Rt<Jt/2;Rt++)if(Rt+1<Jt/2){let cr=Rt,Mr=Rt+1,Nt=Jt-1-Rt,rr=Jt-2-Rt;cr=cr===0?Jt-1:cr-1,Mr=Mr===0?Jt-1:Mr-1,Nt=Nt===0?Jt-1:Nt-1,rr=rr===0?Jt-1:rr-1,mt.indices.push(Nt),mt.indices.push(Mr),mt.indices.push(cr),mt.indices.push(Nt),mt.indices.push(rr),mt.indices.push(Mr)}return mt}(c[0]),c=[ce.geometry]}const de=(je,pt)=>je<(pt.length-1)/2||je===pt.length-1,Ie=this.wallMode?[c]:B0(c,500);for(let je=Ie.length-1;je>=0;je--){const pt=Ie[je];(pt.length===0||(Ce=pt[0]).every(wt=>wt.x<=0)||Ce.every(wt=>wt.x>=Dt)||Ce.every(wt=>wt.y<=0)||Ce.every(wt=>wt.y>=Dt))&&Ie.splice(je,1)}var Ce;let Re;if(F)Re=iA(Ie,C,p);else{Re=[];for(const je of Ie)Re.push({polygon:je,bounds:C})}const Le=N?this.edgeRadius:0,Fe=Le>0&&this.zoom<17,dt=(je,pt)=>{if(je.length===0)return!1;const wt=je[je.length-1];return pt.x===wt.x&&pt.y===wt.y};for(const{polygon:je,bounds:pt}of Re){let wt=0,mt=0;for(const yt of je)N&&!yt[0].equals(yt[yt.length-1])&&yt.push(yt[0]),mt+=N?yt.length-1:yt.length;const _t=this.segments.prepareSegment((N?5:4)*mt,this.layoutVertexArray,this.indexArray);Z.footprintSegIdx<0&&(Z.footprintSegIdx=this.footprintSegments.length),Z.polygonSegIdx<0&&(Z.polygonSegIdx=this.polygonSegments.length);const Et={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new qE;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],N){const yt=[],Je=[];wt=_t.vertexLength;for(let At=0;At<je.length;At++){const Tt=je[At];Tt.length&&At!==0&&Je.push(yt.length/2);const hr=[];let Gt,Jt;Gt=Tt[1].sub(Tt[0])._perp()._unit(),lt.ringIndices.push(Tt.length-1);for(let Rt=1;Rt<Tt.length;Rt++){const cr=Tt[Rt],Mr=Tt[Rt===Tt.length-1?1:Rt+1],Nt=cr.clone();if(Le){Jt=Mr.sub(cr)._perp()._unit();const rr=Gt.add(Jt)._unit(),Tr=Le*Math.min(4,1/(Gt.x*rr.x+Gt.y*rr.y));Nt.x+=Tr*rr.x,Nt.y+=Tr*rr.y,Nt.x=Math.round(Nt.x),Nt.y=Math.round(Nt.y),Gt=Jt}if(!X||Le!==0&&!Fe||dt(hr,Nt)||hr.push(Nt),U0(this.layoutVertexArray,Nt.x,Nt.y,0,0,1,1,0),this.wallMode){const rr=de(Rt,Tt);V0(this.wallVertexArray,ce.joinNormals[Rt],!rr)}_t.vertexLength++,this.footprintVertices.emplaceBack(cr.x,cr.y),yt.push(cr.x,cr.y),F&&$0(this.layoutVertexExtArray,k.projectTilePoint(Nt.x,Nt.y,p),k.upVector(p,Nt.x,Nt.y))}X&&(Le===0||Fe)&&(hr.length!==0&&dt(hr,hr[0])&&hr.pop(),this.groundEffect.addData(hr,pt,I))}const Ze=this.wallMode?ce.indices:op(yt,Je);for(let At=0;At<Ze.length;At+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+Ze[At+0],lt.vertexOffset+Ze[At+1],lt.vertexOffset+Ze[At+2]),this.indexArray.emplaceBack(wt+Ze[At],wt+Ze[At+2],wt+Ze[At+1]),_t.primitiveLength++;lt.indexCount+=Ze.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let yt=0;yt<je.length;yt++){const Je=je[yt];W.startRing(Z,Je[0]);let Ze=Je.length>4&&eA(Je[Je.length-2],Je[0],Je[1]),At=Le?SL(Je[Je.length-2],Je[0],Je[1],Le):0;const Tt=[];let hr,Gt,Jt;Gt=Je[1].sub(Je[0])._perp()._unit();let Rt=!0;for(let cr=1,Mr=0;cr<Je.length;cr++){let Nt=Je[cr-1],rr=Je[cr];const Tr=Je[cr===Je.length-1?1:cr+1];if(W.appendEdge(Z,rr,Nt),Bw(rr,Nt,pt)){Le&&(Gt=Tr.sub(rr)._perp()._unit(),Rt=!Rt);continue}const Lr=rr.sub(Nt)._perp(),qr=Lr.x/(Math.abs(Lr.x)+Math.abs(Lr.y)),Nr=Lr.y>0?1:0,Yt=Nt.dist(rr);if(Mr+Yt>32768&&(Mr=0),Le){Jt=Tr.sub(rr)._perp()._unit();let xe=JE(Nt,rr,Tr,YE(Gt,Jt),Le);isNaN(xe)&&(xe=0);const Ke=rr.sub(Nt)._unit();Nt=Nt.add(Ke.mult(At))._round(),rr=rr.add(Ke.mult(-xe))._round(),At=xe,Gt=Jt,X&&this.zoom>=17&&(dt(Tt,Nt)||Tt.push(Nt),dt(Tt,rr)||Tt.push(rr))}const Fr=_t.vertexLength,ni=Je.length>4&&eA(Nt,rr,Tr);let ye=tA(Mr,Ze,Rt);if(U0(this.layoutVertexArray,Nt.x,Nt.y,qr,Nr,0,0,ye),U0(this.layoutVertexArray,Nt.x,Nt.y,qr,Nr,0,1,ye),this.wallMode){const xe=de(cr-1,Je),Ke=ce.joinNormals[cr-1];V0(this.wallVertexArray,Ke,xe),V0(this.wallVertexArray,Ke,xe)}if(Mr+=Yt,ye=tA(Mr,ni,!Rt),Ze=ni,U0(this.layoutVertexArray,rr.x,rr.y,qr,Nr,0,0,ye),U0(this.layoutVertexArray,rr.x,rr.y,qr,Nr,0,1,ye),this.wallMode){const xe=de(cr,Je),Ke=ce.joinNormals[cr];V0(this.wallVertexArray,Ke,xe),V0(this.wallVertexArray,Ke,xe)}if(_t.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),_t.primitiveLength+=2,Le){const xe=wt+(cr===1?Je.length-2:cr-2),Ke=cr===1?wt:xe+1;if(this.indexArray.emplaceBack(Fr+1,xe,Fr+3),this.indexArray.emplaceBack(xe,Ke,Fr+3),_t.primitiveLength+=2,hr===void 0&&(hr=Fr),!Bw(Tr,Je[cr],pt)){const ut=cr===Je.length-1?hr:_t.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,ut),this.indexArray.emplaceBack(Fr+3,ut+1,ut),this.indexArray.emplaceBack(Fr+3,Ke,ut+1),_t.primitiveLength+=3}Rt=!Rt}if(F){const xe=this.layoutVertexExtArray,Ke=k.projectTilePoint(Nt.x,Nt.y,p),ut=k.projectTilePoint(rr.x,rr.y,p),Ft=k.upVector(p,Nt.x,Nt.y),Lt=k.upVector(p,rr.x,rr.y);$0(xe,Ke,Ft),$0(xe,Ke,Ft),$0(xe,ut,Lt),$0(xe,ut,Lt)}}N&&(wt+=Je.length-1),X&&Le&&this.zoom>=17&&(Tt.length!==0&&dt(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,pt,I,Le>0))}this.footprintSegments.push(lt),Et.triangleCount=this.indexArray.length-Et.triangleArrayOffset,this.polygonSegments.push(Et),++Z.footprintSegLen,++Z.polygonSegLen}if(Z.vertexCount=this.layoutVertexArray.length-Z.vertexArrayOffset,Z.groundVertexCount=this.groundEffect.vertexArray.length-Z.groundVertexArrayOffset,Z.vertexCount!==0){if(Z.centroidXY=W.borders?WE:this.encodeCentroid(W,Z),this.centroidData.push(Z),W.borders){this.featuresOnBorder.push(W);const je=this.featuresOnBorder.length-1;for(let pt=0;pt<W.borders.length;pt++)W.borders[pt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[pt].push(je)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,g,x,p,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,h,g,x,p,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,le)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,c)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const b=this.centroidData[x],E=+(b.min.y+b.max.y>Dt),I=2*E+(+(b.min.x+b.max.x>Dt)^E);for(let C=0;C<b.polygonSegLen;C++){const k=b.polygonSegIdx+C;e.push({centroidIdx:x,subtile:I,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const n=new Nn;e.sort((x,b)=>x.triangleSegmentIdx===b.triangleSegmentIdx?x.subtile-b.subtile:x.triangleSegmentIdx-b.triangleSegmentIdx);let c=0,h=0,p=0;for(const x of e){if(x.triangleSegmentIdx!==c)break;p++}const g=e.length;for(;h!==e.length;){c=e[h].triangleSegmentIdx;let x=0,b=h,E=h;for(let I=b;I<p&&e[I].subtile===x;I++)E++;for(;b!==p;){const I=e[b];x=I.subtile;const C=this.centroidData[I.centroidIdx].min.clone(),k=this.centroidData[I.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let N=b;N<E;N++){const W=e[N],Z=this.polygonSegments[W.polygonSegmentIdx],X=this.centroidData[W.centroidIdx].min,le=this.centroidData[W.centroidIdx].max,ce=this.indexArray.uint16;for(let de=Z.triangleArrayOffset;de<Z.triangleArrayOffset+Z.triangleCount;de++)n.emplaceBack(ce[3*de],ce[3*de+1],ce[3*de+2]);F.primitiveLength+=Z.triangleCount,C.x=Math.min(C.x,X.x),C.y=Math.min(C.y,X.y),k.x=Math.max(k.x,le.x),k.y=Math.max(k.y,le.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:C,max:k}),b=E;for(let N=b;N<p&&e[N].subtile===e[b].subtile;N++)E++}h=p;for(let I=h;I<g&&e[I].triangleSegmentIdx===e[h].triangleSegmentIdx;I++)p++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,c){const h=new en;if(this.wallMode){for(const W of this.triangleSubSegments)h.segments.push(W.segment);return h}let p=0,g=0;const x=1<<e.canonical.z;if(n){const W=n.getMinMaxForTile(e);W&&(p=W.min,g=W.max)}g+=this.maxHeight;const b=e.toUnwrapped();let E;const I=[b.canonical.x/x+b.wrap,b.canonical.y/x],C=[(b.canonical.x+1)/x+b.wrap,(b.canonical.y+1)/x],k=(W,Z,X)=>[W[0]*(1-X[0])+Z[0]*X[0],W[1]*(1-X[1])+Z[1]*X[1]],F=[],N=[];for(const W of this.triangleSubSegments){F[0]=W.min.x/Dt,F[1]=W.min.y/Dt,N[0]=W.max.x/Dt,N[1]=W.max.y/Dt;const Z=k(I,C,F),X=k(I,C,N);if(new Er([Z[0],Z[1],p],[X[0],X[1],g]).intersectsPrecise(c)===0){E&&(h.segments.push(E),E=void 0);continue}const le=W.segment;E&&E.vertexOffset!==le.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=le.vertexLength,E.primitiveLength+=le.primitiveLength):E={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(e,n){const c=e.centroid(),h=n.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new bt(U(c.x,1,Dt-1)<<3|p,U(c.y,1,Dt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new bt(0,0);const n=e.borders,c=Number.MAX_VALUE;if(n[0][0]!==c||n[1][0]!==c){const h=n[0][0]!==c?0:1;return new bt(6|(n[0][0]!==c?0:65528),(n[h][0]+n[h][1])/2<<3|6)}{const h=n[2][0]!==c?2:3;return new bt((n[h][0]+n[h][1])/2<<3|6,6|(n[2][0]!==c?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,h=e.flags&zu?WE:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==h.y||p!==h.x){for(let g=n;g<c;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const h=n.getReplacementRegionsForTile(e.toUnwrapped());if(Zy(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const p=[];for(const g of this.activeReplacements){if(g.order<c)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){const b=g.footprint.buildingId;for(const E of this.centroidData)E.buildingId===b&&(E.flags|=zu)}else for(const b of this.centroidData)if(!(b.flags&zu||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y))for(let E=0;E<b.footprintSegLen;E++){const I=this.footprintSegments[b.footprintSegIdx+E];if(p.length=0,EL(this.footprintVertices,I.vertexOffset,I.vertexCount,g.footprintTileId.canonical,e.canonical,p),Ow(g.footprint,p,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){b.flags|=zu;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,c){let h=!1;for(let p=0;p<c.footprintSegLen;p++){const g=this.footprintSegments[c.footprintSegIdx+p];let x=0;for(const b of g.ringIndices){for(let E=x,I=b+x-1;E<b+x;I=E++){const C=this.footprintVertices.int16[2*(E+g.vertexOffset)+0],k=this.footprintVertices.int16[2*(E+g.vertexOffset)+1],F=this.footprintVertices.int16[2*(I+g.vertexOffset)+1];k>n!=F>n&&e<(this.footprintVertices.int16[2*(I+g.vertexOffset)+0]-C)*(n-k)/(F-k)+C&&(h=!h)}x=b}}return h}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+Dt)*Dt+(n+Dt);if(this.partLookup.hasOwnProperty(p)){const g=this.partLookup[p];return g?{height:g.height,hidden:!!(g.flags&zu)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||n>g.max.y||g.min.y>n||g.height<=c||this.footprintContainsPoint(e,n,g)&&(c=g.height,this.partLookup[p]=g,h=!!(g.flags&zu));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[p]=void 0}}function YE(o,e){const n=o.add(e)._unit();return o.x*n.x+o.y*n.y}function SL(o,e,n,c){const h=e.sub(o)._perp()._unit(),p=n.sub(e)._perp()._unit();return JE(o,e,n,YE(h,p),c)}function JE(o,e,n,c,h){const p=Math.sqrt(1-c*c);return Math.min(o.dist(e)/3,e.dist(n)/3,h*p/c)}function Bw(o,e,n){return o.x<n[0].x&&e.x<n[0].x||o.x>n[1].x&&e.x>n[1].x||o.y<n[0].y&&e.y<n[0].y||o.y>n[1].y&&e.y>n[1].y}function QE(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function eA(o,e,n){if(o.x<0||o.x>=Dt||e.x<0||e.x>=Dt||n.x<0||n.x>=Dt)return!1;const c=n.sub(e),h=c.perp(),p=o.sub(e);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function tA(o,e,n){const c=e?2|o:-3&o;return n?1|c:-2&c}function rA(){const o=Math.PI/32,e=Math.tan(o),n=j;return n*Math.sqrt(1+2*e*e)-n}function iA(o,e,n){const c=1<<n.z,h=Ee(n.x/c),p=Ee((n.x+1)/c),g=Te(n.y/c),x=Te((n.y+1)/c);return function(b,E,I,C,k=0,F){const N=[];if(!b.length||!I||!C)return N;const W=(Ce,Re)=>{for(const Le of Ce)N.push({polygon:Le,bounds:Re})},Z=Math.ceil(Math.log2(I)),X=Math.ceil(Math.log2(C)),le=Z-X,ce=[];for(let Ce=0;Ce<Math.abs(le);Ce++)ce.push(le>0?0:1);for(let Ce=0;Ce<Math.min(Z,X);Ce++)ce.push(0),ce.push(1);let de=b;if(de=Hy(de,E[0].y-k,E[1].y+k,1),de=Hy(de,E[0].x-k,E[1].x+k,0),!de.length)return N;const Ie=[];for(ce.length?Ie.push({polygons:de,bounds:E,depth:0}):W(de,E);Ie.length;){const Ce=Ie.pop(),Re=Ce.depth,Le=ce[Re],Fe=Ce.bounds[0],dt=Ce.bounds[1],je=Le===0?Fe.x:Fe.y,pt=Le===0?dt.x:dt.y,wt=F?F(Le,je,pt):.5*(je+pt),mt=Hy(Ce.polygons,je-k,wt+k,Le),_t=Hy(Ce.polygons,wt-k,pt+k,Le);if(mt.length){const Et=[Fe,new bt(Le===0?wt:dt.x,Le===1?wt:dt.y)];ce.length>Re+1?Ie.push({polygons:mt,bounds:Et,depth:Re+1}):W(mt,Et)}if(_t.length){const Et=[new bt(Le===0?wt:Fe.x,Le===1?wt:Fe.y),dt];ce.length>Re+1?Ie.push({polygons:_t,bounds:Et,depth:Re+1}):W(_t,Et)}}return N}(o,e,Math.ceil((p-h)/11.25),Math.ceil((g-x)/11.25),1,(b,E,I)=>{if(b===0)return .5*(E+I);{const C=Te((n.y+E/Dt)/c);return(Se(.5*(Te((n.y+I/Dt)/c)+C))*c-n.y)*Dt}})}function EL(o,e,n,c,h,p){const g=Math.pow(2,c.z-h.z);for(let x=0;x<n;x++){let b=o.int16[2*(x+e)+0],E=o.int16[2*(x+e)+1];b=(b+h.x*Dt)*g-c.x*Dt,E=(E+h.y*Dt)*g-c.y*Dt,p.push(new bt(b,E))}}let nA,sA;Wt(Ky,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(ZE,"PartData"),Wt(qE,"FootprintSegment"),Wt(XE,"BorderCentroidData"),Wt(zw,"GroundEffect");class ld extends bt{constructor(e,n,c){super(e,n),this.z=c}}class oA extends ld{constructor(e,n,c,h){super(e,n,c),this.w=h}}function aA(o,e,n,c){const h=n==="x"?"y":"x",p=(c-o[n])/(e[n]-o[n]);o[h]=Math.round(o[h]+(e[h]-o[h])*p),o[n]=c,o.hasOwnProperty("z")&&(o.z=wr(o.z,e.z,p)),o.hasOwnProperty("w")&&(o.w=wr(o.w,e.w,p))}function lA(o,e,n,c){const h=n,p=c;for(const g of["x","y"]){let x=o,b=e;x[g]>=b[g]&&(x=e,b=o),x[g]<h&&b[g]>h&&aA(x,b,g,h),x[g]<p&&b[g]>p&&aA(b,x,g,p)}}function Yy(o,e,n,c,h,p){const g=[];for(let x=0;x<o.length;x++){const b=o[x];let E;const I=g.length;let C=0;for(let k=0;k<b.length-1;k++){let F=b[k],N=b[k+1],W=0;const Z=C;let X,le;p&&(W=Math.hypot(N.x-F.x,N.y-F.y),C+=W,X=F,le=N),F.x<e&&N.x<e||(F.x<e?F=new bt(e,F.y+(e-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x<e&&(N=new bt(e,F.y+(e-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y<n&&N.y<n||(F.y<n?F=new bt(F.x+(n-F.y)/(N.y-F.y)*(N.x-F.x),n)._round():N.y<n&&(N=new bt(F.x+(n-F.y)/(N.y-F.y)*(N.x-F.x),n)._round()),F.x>=c&&N.x>=c||(F.x>=c?F=new bt(c,F.y+(c-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x>=c&&(N=new bt(c,F.y+(c-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y>=h&&N.y>=h||(F.y>=h?F=new bt(F.x+(h-F.y)/(N.y-F.y)*(N.x-F.x),h)._round():N.y>=h&&(N=new bt(F.x+(h-F.y)/(N.y-F.y)*(N.x-F.x),h)._round()),E&&F.equals(E[E.length-1])||(E=[F],g.push(E),p&&p.push({progress:{min:Z+cA(X,le,F)*W,max:1},parentIndex:x,prevPoint:X,nextPoint:le})),E.push(N),p&&(p[p.length-1].progress.max=Z+cA(X,le,N)*W,p[p.length-1].nextPoint=le)))))}if(p&&C>0)for(let k=I;k<g.length;k++)p[k].progress.min/=C,p[k].progress.max/=C}return g}function AL(o,e,n,c,h){if(o.length<2)return void c.push(o);const p=[];for(;e.valid();){const[E,I]=e.get();for(let C=0;C<o.length-1;C++){const k=o[C],F=o[C+1],N=an(k,F,E,I);if(N){const[W]=N,Z=new bt(wr(k.x,F.x,W),wr(k.y,F.y,W));p.push({t:C+W,distance:0,point:Z})}}e.next()}if(p.length===0)return void c.push(o);p.sort((E,I)=>E.t-I.t);let g=0,x=0,b=[];for(c.push(b);g!==o.length;){if(x===p.length){for(;g!==o.length;)b.length!==0&&b[b.length-1].equals(o[g])||b.push(o[g]),g++;break}p[x].t<=g?(b.length!==0&&b[b.length-1].equals(p[x].point)||b.push(p[x].point),Math.trunc(p[x].t),x++):(b.length!==0&&b[b.length-1].equals(o[g])||b.push(o[g]),g++)}}function cA(o,e,n){return o.x!==e.x?(n.x-o.x)/(e.x-o.x):o.y!==e.y?(n.y-o.y)/(e.y-o.y):0}function G0(o,e){return o.x*e.x+o.y*e.y}function uA(o,e){if(o.length===1){let n=0;const c=e[n++];let h;for(;!h||c.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const p=e[n],g=o[0],x=h.sub(c),b=p.sub(c),E=g.sub(c),I=G0(x,x),C=G0(x,b),k=G0(b,b),F=G0(E,x),N=G0(E,b),W=I*k-C*C,Z=(k*F-C*N)/W,X=(I*N-C*F)/W,le=c.z*(1-Z-X)+h.z*Z+p.z*X;if(isFinite(le))return le}return 1/0}{let n=1/0;for(const c of e)n=Math.min(n,c.z);return n}}function hA(o,e,n,c,h,p,g,x){const b=g*h.getElevationAt(o,e,!0,!0),E=p[0]!==0,I=E?p[1]===0?g*(p[0]/7-450):g*function(C,k,F){const N=Math.floor(k[0]/8),W=Math.floor(k[1]/8),Z=10*(k[0]-8*N),X=10*(k[1]-8*W),le=C.getElevationAt(N,W,!0,!0),ce=C.getMeterToDEM(F),de=Math.floor(.5*(Z*ce-1)),Ie=Math.floor(.5*(X*ce-1)),Ce=C.tileCoordToPixel(N,W),Re=2*de+1,Le=2*Ie+1,Fe=function(_t,Et,lt,yt,Je){return[_t.getElevationAtPixel(Et,lt,!0),_t.getElevationAtPixel(Et+Je,lt,!0),_t.getElevationAtPixel(Et,lt+Je,!0),_t.getElevationAtPixel(Et+yt,lt+Je,!0)]}(C,Ce.x-de,Ce.y-Ie,Re,Le),dt=Math.abs(Fe[0]-Fe[1]),je=Math.abs(Fe[2]-Fe[3]),pt=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),wt=Math.min(.25,.5*ce*(dt+je)/Re),mt=Math.min(.25,.5*ce*pt/Le);return le+Math.max(wt*Z,mt*X)}(h,p,x):b;return{base:b+(n===0?-1:n),top:E?Math.max(I+c,b+n+2):b+c}}class IL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class CL{constructor(){this.tasks={},this.taskQueue=[],nt(["process"],this),this.invoker=new IL(this.process),this.nextId=0}add(e,n){const c=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-x:p==="maybePrepare"&&g?400-x:500:200-x:100-x}(n);if(h===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:n,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<n&&(n=p.priority,e=h)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class dA{constructor(e,n,c){this.target=e,this.parent=n,this.mapId=c,this.callbacks={},this.cancelCallbacks={},nt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new CL}send(e,n,c,h,p=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=g,this.callbacks[x]=c);const b=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!c,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Fl(n,b)},b),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const c=n.id;if(c&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(n.mustQueue||Xr(self)){const h=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,n),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const c=this.callbacks[e];delete this.callbacks[e],c&&(n.error?c(Nl(n.error)):c(null,Nl(n.data)))}else{const c=new Set,h=n.hasCallback?(g,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Fl(g):null,data:Fl(x,c)},c)}:()=>{},p=Nl(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,p,h);else if(this.parent.getWorkerSource){const g=n.type.split("."),{source:x,scope:b}=p;this.parent.getWorkerSource(n.sourceMapId,g[0],x,b)[g[1]](p,h)}else h(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var H0={workerUrl:"",workerClass:null,workerParams:void 0};const jw="mapboxgl_preloaded_worker_pool";class cd{constructor(){this.active={}}acquire(e,n=cd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(H0.workerClass!=null?new H0.workerClass:new self.Worker(H0.workerUrl,H0.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jw]}numActive(){return Object.keys(this.active).length}}cd.workerCount=2;class lp{constructor(e,n,c="Worker",h=cd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=fe();const p=this.workerPool.acquire(this.id,h);for(let g=0;g<p.length;g++){const x=new lp.Actor(p[g],n,this.id);x.name=`${c} ${g}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,c){ne(this.actors,(h,p)=>{h.send(e,n,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let W0,Uw;function Jy(){return W0||(W0=new cd),W0}lp.Actor=dA;class PL{constructor(e){this.module=e}createIntArray(e){const n=new Int32Array(e),c=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heap32.set(n,c/n.BYTES_PER_ELEMENT),c}createFloatArray(e){const n=new Float32Array(e),c=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heapF32.set(n,c/n.BYTES_PER_ELEMENT),c}createStringBuffer(e){const n=this.module.malloc(e.length+1);for(let c=0;c<e.length;++c)this.module.heapU8[n+c]=e.charCodeAt(c);return this.module.heapU8[n+e.length]=0,n}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.entranceColorRgb,c=e.facadeGlazingColorRgb,h=e.roofColorRgb,p=e.wallColorRgb,g=e.normalScale;this.module.setStyle(n[0],n[1],n[2],c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,c){this.module.setFauxFacadeOptions(e?1:0,n?1:0,c)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){for(const x of e){const b=this.createStringBuffer(x.roofType),E=[0],I=[];for(const F of x.coordinates)if(Array.isArray(F)){for(const N of F)I.push(N.x),I.push(N.y);E.push(I.length)}const C=this.createIntArray(E),k=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,b,x.roofType.length,k,C,E.length-1),this.module.free(b),this.module.free(C),this.module.free(k)}for(const x of n){let b;b=x.entrances?JSON.parse(x.entrances):[];const E=this.createFloatArray(b),I=[];for(const k of x.coordinates)I.push(k.x),I.push(k.y);const C=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,E,b.length,C,I.length),this.module.free(E),this.module.free(C)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const c=this.module.getMeshCount(),h=new Array(c);for(let x=0;x<c;x++){const b=this.module.getPositionsPtr(x),E=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,b,E),C=this.module.getNormalsPtr(x),k=this.module.getNormalsLength(x),F=new Float32Array(this.module.heapF32.buffer,C,k),N=this.module.getColorsPtr(x),W=this.module.getColorsLength(x),Z=new Uint8Array(this.module.heapU8.buffer,N,W),X=this.module.getAOPtr(x),le=this.module.getAOLength(x),ce=new Float32Array(this.module.heapF32.buffer,X,le),de=this.module.getUVPtr(x),Ie=this.module.getUVLength(x),Ce=new Float32Array(this.module.heapF32.buffer,de,Ie),Re=this.module.getFauxFacadePtr(x),Le=this.module.getFauxFacadeLength(x),Fe=new Uint8Array(this.module.heapU8.buffer,Re,Le),dt=this.module.getIndicesPtr(x),je=this.module.getIndicesLength(x),pt=new Int32Array(this.module.heap32.buffer,dt,je),wt=this.module.getBuildingPart(x),mt=this.readStringBuffer(wt);h[x]={positions:I,normals:F,colors:Z,ao:ce,uv:Ce,isFauxFacade:Fe,indices:pt,buildingPart:mt}}const p=this.module.getRingCount(),g=[];for(let x=0;x<p;x++){const b=this.module.getRingPtr(x),E=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,b,E);g.push(I)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let q0,Vw,il,cp,$w,up=null,hp=null,fA=null,Qy=null;function pA(){return Xr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Vw||ws.DRACO_URL}function mA(){if(Xr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(cp)return cp;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return cp=WebAssembly.validate(o)?ws.MESHOPT_SIMD_URL:ws.MESHOPT_URL,cp}function kL(){return Qy}const ex={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},RL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Z0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gA(o,e,n){const c=n.json.bufferViews.length,h=n.buffers.length;e.bufferView=c,n.json.bufferViews[c]={buffer:h,byteLength:o.byteLength},n.buffers[h]=o}const Gw="KHR_draco_mesh_compression";function ML(o,e){const n=o.extensions&&o.extensions[Gw];if(!n)return;const c=new il.Decoder,h=vA(e,n.bufferView),p=new il.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[o.indices],x=ex[g.componentType],b=g.count*x.BYTES_PER_ELEMENT,E=il._malloc(b);x===Uint16Array?c.GetTrianglesUInt16Array(p,b,E):c.GetTrianglesUInt32Array(p,b,E),gA(il.memory.buffer.slice(E,E+b),g,e),il._free(E);for(const I of Object.keys(n.attributes)){const C=c.GetAttributeByUniqueId(p,n.attributes[I]),k=e.json.accessors[o.attributes[I]],F=RL[k.componentType],N=k.count*Z0[k.type]*ex[k.componentType].BYTES_PER_ELEMENT,W=il._malloc(N);c.GetAttributeDataArrayForAllPoints(p,C,il[F],N,W),gA(il.memory.buffer.slice(W,W+N),k,e),il._free(W)}c.destroy(),p.destroy(),delete o.extensions[Gw]}const tx="EXT_meshopt_compression";function DL(o,e){if(!o.extensions||!o.extensions[tx])return;const n=o.extensions[tx],c=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),h=new Uint8Array(n.count*n.byteStride);$w.decodeGltfBuffer(h,n.count,n.byteStride,c,n.mode,n.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=h.buffer,delete o.extensions[tx]}const _A=1179937895,yA=new TextDecoder("utf8");function xA(o,e){return new URL(o,e).href}function OL(o,e,n,c){return fetch(xA(o.uri,c)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[n]=h})}function vA(o,e){const n=o.json.bufferViews[e];return new Uint8Array(o.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function LL(o,e,n,c){if(o.uri){const h=xA(o.uri,c);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[n]=p})}if(o.bufferView!==void 0){const h=vA(e,o.bufferView),p=new Blob([h],{type:o.mimeType});return createImageBitmap(p).then(g=>{e.images[n]=g})}}function wA(o,e=0,n){const c={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===_A){const I=new Uint32Array(o,e);let C=2;const k=(I[C++]>>2)-3,F=I[C++]>>2;if(C++,c.json=JSON.parse(yA.decode(I.subarray(C,C+F))),C+=F,C<k){const N=I[C++];C++;const W=e+(C<<2);c.buffers[0]=o.slice(W,W+N)}}else c.json=JSON.parse(yA.decode(new Uint8Array(o,e)));const{buffers:h,images:p,meshes:g,extensionsUsed:x,bufferViews:b}=c.json;let E=Promise.resolve();if(h){const I=[];for(let C=0;C<h.length;C++){const k=h[C];k.uri?I.push(OL(k,c,C,n)):c.buffers[C]||(c.buffers[C]=null)}E=Promise.all(I)}return E.then(()=>{const I=[],C=x&&x.includes(Gw),k=x&&x.includes(tx);if(C&&I.push(function(){if(!il)return q0??(q0=function(F){let N,W=null;function Z(){N=new Uint8Array(W.buffer)}function X(){throw new Error("Unexpected Draco error.")}const le={a:{a:X,d:function(ce,de,Ie){return N.copyWithin(ce,de,de+Ie)},c:function(ce){const de=N.length,Ie=Math.max(ce>>>0,Math.ceil(1.2*de)),Ce=Math.ceil((Ie-de)/65536);try{return W.grow(Ce),Z(),!0}catch{return!1}},b:X}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,le):F.then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,le))).then(ce=>{const{Rb:de,Qb:Ie,P:Ce,T:Re,X:Le,Ja:Fe,La:dt,Qa:je,Va:pt,Wa:wt,eb:mt,jb:_t,f:Et,e:lt,yb:yt,zb:Je,Ab:Ze,Bb:At,Db:Tt,Gb:hr}=ce.instance.exports;W=lt;const Gt=(()=>{let Jt=0,Rt=0,cr=0,Mr=0;return Nt=>{cr&&(de(Mr),de(Jt),Rt+=cr,cr=Jt=0),Jt||(Rt+=128,Jt=Ie(Rt));const rr=Nt.length+7&-8;let Tr=Jt;rr>=Rt&&(cr=rr,Tr=Mr=Ie(rr));for(let Lr=0;Lr<Nt.length;Lr++)N[Tr+Lr]=Nt[Lr];return Tr}})();return Z(),Et(),{memory:lt,_free:de,_malloc:Ie,Mesh:class{constructor(){this.ptr=Ce()}destroy(){Re(this.ptr)}},Decoder:class{constructor(){this.ptr=Fe()}destroy(){_t(this.ptr)}DecodeArrayToMesh(Jt,Rt,cr){const Mr=Gt(Jt),Nt=dt(this.ptr,Mr,Rt,cr.ptr);return!!Le(Nt)}GetAttributeByUniqueId(Jt,Rt){return{ptr:je(this.ptr,Jt.ptr,Rt)}}GetTrianglesUInt16Array(Jt,Rt,cr){pt(this.ptr,Jt.ptr,Rt,cr)}GetTrianglesUInt32Array(Jt,Rt,cr){wt(this.ptr,Jt.ptr,Rt,cr)}GetAttributeDataArrayForAllPoints(Jt,Rt,cr,Mr,Nt){mt(this.ptr,Jt.ptr,Rt.ptr,cr,Mr,Nt)}},DT_INT8:yt(),DT_UINT8:Je(),DT_INT16:Ze(),DT_UINT16:At(),DT_UINT32:Tt(),DT_FLOAT32:hr()}})}(fetch(pA())),q0.then(F=>{il=F,q0=void 0}))}()),k&&I.push(function(){if($w)return;const F=function(N){let W;const Z=WebAssembly.instantiateStreaming(N,{}).then(ce=>{W=ce.instance,W.exports.__wasm_call_ctors()}),X={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Z,supported:!0,decodeGltfBuffer(ce,de,Ie,Ce,Re,Le){(function(Fe,dt,je,pt,wt,mt,_t){const Et=Fe.exports.sbrk,lt=pt+3&-4,yt=Et(lt*wt),Je=Et(mt.length),Ze=new Uint8Array(Fe.exports.memory.buffer);Ze.set(mt,Je);const At=dt(yt,pt,wt,Je,mt.length);if(At===0&&_t&&_t(yt,lt,wt),je.set(Ze.subarray(yt,yt+pt*wt)),Et(yt-Et(0)),At!==0)throw new Error(`Malformed buffer data: ${At}`)})(W,W.exports[le[Re]],ce,de,Ie,Ce,W.exports[X[Le]])}}}(fetch(mA()));return F.ready.then(()=>{$w=F})}()),p)for(let F=0;F<p.length;F++)I.push(LL(p[F],c,F,n));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(C&&g)for(const{primitives:F}of g)for(const N of F)ML(N,c);if(k&&g&&b)for(const F of b)DL(F,c);return c})})}function Hw(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Ww(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class qw{constructor(e,n,c,h){this.context=e,this.format=c,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:h&&h.premultiply})}update(e,n){const c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:g}=p,{x,y:b}=n&&n.position?n.position:{x:0,y:0},E=x+c,I=b+h;!this.size||this.size[0]===E&&this.size[1]===I||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!n||n.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&E>0&&I>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(E,I)))+1:1;g.texStorage2D(g.TEXTURE_2D,k,this.format,E,I),this.size=[E,I]}this.size&&(C?g.texSubImage2D(g.TEXTURE_2D,0,x,b,Hw(this.format),Ww(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,x,b,c,h,Hw(this.format),Ww(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n,c=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,c,h,p){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),n!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),p!==this.compareMode&&(p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,p)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class X0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}}const FL=ii([{name:"a_pos_3f",components:3,type:"Float32"}]),NL=ii([{name:"a_color_3f",components:3,type:"Float32"}]),zL=ii([{name:"a_color_4f",components:4,type:"Float32"}]),BL=ii([{name:"a_uv_2f",components:2,type:"Float32"}]),jL=ii([{name:"a_normal_3f",components:3,type:"Float32"}]),UL=ii([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),VL=ii([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function bA(o,e){const n=rx(o.projection,o.zoom,o.width,o.height),c=function(p,g,x,b,E){const I=new G(x.lng-180*Bu,x.lat),C=new G(x.lng+180*Bu,x.lat),k=p.project(I.lng,I.lat),F=p.project(C.lng,C.lat),N=-Math.atan2(F.y-k.y,F.x-k.x),W=Qe.fromLngLat(x);W.y=U(W.y,-1+Bu,1-Bu);const Z=W.toLngLat(),X=p.project(Z.lng,Z.lat),le=Qe.fromLngLat(Z);le.x+=Bu;const ce=le.toLngLat(),de=p.project(ce.lng,ce.lat),Ie=SA(de.x-X.x,de.y-X.y,N),Ce=Qe.fromLngLat(Z);Ce.y+=Bu;const Re=Ce.toLngLat(),Le=p.project(Re.lng,Re.lat),Fe=SA(Le.x-X.x,Le.y-X.y,N),dt=Math.abs(Ie.x)/Math.abs(Fe.y),je=J([]);He(je,je,-N*(1-(E?0:b)));const pt=J([]);return ie(pt,pt,[1,1-(1-dt)*b,1]),pt[4]=-Fe.x/Fe.y*b,He(pt,pt,N),pe(pt,je,pt),pt}(o.projection,0,o.center,n,e),h=TA(o);return ie(c,c,[h,h,1]),c}function TA(o){const e=o.projection,n=rx(o.projection,o.zoom,o.width,o.height),c=Zw(e,o.center),h=Zw(e,G.convert(e.center));return Math.pow(2,c*n+(1-n)*h)}function rx(o,e,n,c,h=1/0){const p=o.range;if(!p)return 0;const g=Math.min(h,Math.max(n,c)),x=Math.log2(g/1024);return ae(p[0]+x,p[1]+x,e)}const Bu=1/4e4;function Zw(o,e){const n=U(e.lat,-Ae,Ae),c=new G(e.lng-180*Bu,n),h=new G(e.lng+180*Bu,n),p=o.project(c.lng,n),g=o.project(h.lng,n),x=Qe.fromLngLat(c),b=Qe.fromLngLat(h),E=g.x-p.x,I=g.y-p.y,C=b.x-x.x,k=b.y-x.y,F=Math.sqrt((C*C+k*k)/(E*E+I*I));return Math.log2(F)}function SA(o,e,n){const c=Math.cos(n),h=Math.sin(n);return{x:o*c-e*h,y:o*h+e*c}}function EA(o,e,n){J(o),He(o,o,ze(e[2])),ke(o,o,ze(e[0])),at(o,o,ze(e[1])),ie(o,o,n),pe(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ix(o,e,n,c,h,p,g,x){const b=[n[0]-e[0],n[1]-e[1],0],E=[c[0]-e[0],c[1]-e[1],0];if(Xt(b)<1e-12||Xt(E)<1e-12)return Vn(o);const I=br([],b,E);Pt(I,I),ei(E,c,e),b[2]=(p-h)*x,E[2]=(g-h)*x;const C=b;return br(C,b,E),Pt(C,C),Yo(o,I,C)}function Xw(o,e,n=!1){const c=Fu(e.zoom),h=function(p,g,x){const b=g.worldSize,E=[p[12],p[13],p[14]],I=Te(E[1]/b),C=Ee(E[0]/b),k=J([]),F=be(1,I)*b,N=be(1,0)*b*Ne(I,g.zoom),W=1/Tw(b);let Z=N*W;if(x){const de=rx(g.projection,g.zoom,g.width,g.height,1024);Z=W*g.projection.pixelSpaceConversion(g.center.lat,b,de)}const X=D(I,C);Ir(X,X,gr([],Pt([],X),F*Z*E[2]));const le=function(de){const Ie=[de[0],de[1],de[2]];let Ce=[0,1,0];const Re=br([],Ce,Ie);return br(Ce,Ie,Re),ct(Ce)===0&&(Ce=[0,1,0],br(Re,Ie,Ce)),Pt(Re,Re),Pt(Ce,Ce),Pt(Ie,Ie),[Re[0],Re[1],Re[2],0,Ce[0],Ce[1],Ce[2],0,Ie[0],Ie[1],Ie[2],0,de[0],de[1],de[2],1]}(X);ie(k,k,[Z,Z,Z*F]),ue(k,k,[-E[0],-E[1],-E[2]]);const ce=pe([],g.globeMatrix,le);return pe(ce,ce,k),pe(ce,ce,p),ce}(o,e,n);if(c>0){const p=function(g,x){const b=x.worldSize,E=be(1,0)*b*Ne(x.center.lat,x.zoom)/Tw(b),I=be(1,x.center.lat)*b,C=J([]);at(C,C,ze(x.center.lng)),ke(C,C,ze(x.center.lat)),ue(C,C,[0,0,d]),ie(C,C,[E,E,E*I]);const k=x.point;return ue(C,C,[-k.x,-k.y,0]),pe(C,C,g),pe(C,x.globeMatrix,C)}(o,e);return function(g,x,b){const E=(N,W,Z)=>{const X=Xt(N),le=Xt(W),ce=Mc(N,W,Z);return gr(ce,ce,1/Xt(ce)*wr(X,le,Z))},I=E([g[0],g[1],g[2]],[x[0],x[1],x[2]],b),C=E([g[4],g[5],g[6]],[x[4],x[5],x[6]],b),k=E([g[8],g[9],g[10]],[x[8],x[9],x[10]],b),F=Mc([g[12],g[13],g[14]],[x[12],x[13],x[14]],b);return[I[0],I[1],I[2],0,C[0],C[1],C[2],0,k[0],k[1],k[2],0,F[0],F[1],F[2],1]}(h,p,c)}return h}function AA(o,e,n,c){const h=Er.projectAabbCorners(c,n);let p=Number.MAX_VALUE,g=-1;for(let E=0;E<h.length;++E){const I=h[E];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<p&&(g=E,p=I[2])}const x=E=>new bt(h[E][0],h[E][1]);let b;switch(g){case 0:case 6:b=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:b=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:b=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:b=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Ao(o,b))return p}const ud=64,dp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function IA(o,e,n,c,h,p,g,x,b,E=!1){const I=n.zoom,C=n.project(c),k=Ne(c.lat,I),F=1/k;J(o),ue(o,o,[C.x+g[0]*F,C.y+g[1]*F,g[2]]);let N=1,W=1;const Z=n.worldSize;if(E){if(n.projection.name==="mercator"){let de=0;n.elevation&&(de=n.elevation.getAtPointOrZero(new Qe(C.x/Z,C.y/Z),0));const Ie=un([],[C.x,C.y,de,1],n.projMatrix)[3]/n.cameraToCenterDistance;N=Ie,W=Ie*Ne(n.center.lat,I)}else if(n.projection.name==="globe"){const de=Xw(o,n),Ie=[0,0,0,1];un(Ie,Ie,pe([],n.projMatrix,de));const Ce=Ie[3]/n.cameraToCenterDistance,Re=Fu(I),Le=n.projection.pixelsPerMeter(c.lat,Z)*Ne(c.lat,I),Fe=n.projection.pixelsPerMeter(n.center.lat,Z)*Ne(n.center.lat,I);N=Ce/wr(Le,qe(n.center.lat),Re),W=Ce*k/Le,N*=Fe,W*=Fe}}else N=F;ie(o,o,[N,N,W]);const X=[...o],le=e.orientation,ce=[];if(EA(ce,[le[0]+h[0],le[1]+h[1],le[2]+h[2]],p),pe(o,X,ce),x&&n.elevation){let de=0;const Ie=[];if(b&&n.elevation){de=function(Re,Le,Fe,dt,je){const pt=Le.elevation;if(!pt)return 0;const wt=Er.projectAabbCorners(Fe,dt),mt=be(1,je.lat)*Le.worldSize,_t=function(Rt,cr){const Mr=[0,0,1],Nt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const rr of Nt){const Tr=Rt[rr.corners[0]],Lr=Rt[rr.corners[1]],qr=Rt[rr.corners[2]],Nr=[Lr[0]-Tr[0],Lr[1]-Tr[1],cr*(Lr[2]-Tr[2])],Yt=br(Nr,Nr,[qr[0]-Tr[0],qr[1]-Tr[1],cr*(qr[2]-Tr[2])]);Pt(Yt,Yt),rr.dotProductWithUp=dr(Yt,Mr)}return Nt.sort((rr,Tr)=>rr.dotProductWithUp-Tr.dotProductWithUp),Nt[0].corners}(wt,mt),Et=wt[_t[0]],lt=wt[_t[1]],yt=wt[_t[2]],Je=wt[_t[3]],Ze=pt.getAtPointOrZero(new Qe(Et[0]/Le.worldSize,Et[1]/Le.worldSize),0),At=pt.getAtPointOrZero(new Qe(lt[0]/Le.worldSize,lt[1]/Le.worldSize),0),Tt=pt.getAtPointOrZero(new Qe(yt[0]/Le.worldSize,yt[1]/Le.worldSize),0),hr=pt.getAtPointOrZero(new Qe(Je[0]/Le.worldSize,Je[1]/Le.worldSize),0),Gt=(Ze+hr)/2,Jt=(At+Tt)/2;return Gt>Jt?At<Tt?ix(Re,lt,Je,Et,At,hr,Ze,mt):ix(Re,yt,Et,Je,Tt,Ze,hr,mt):Ze<hr?ix(Re,Et,lt,yt,Ze,At,Tt,mt):ix(Re,Je,yt,lt,hr,Tt,At,mt),Math.max(Gt,Jt)}(Ie,n,e.aabb,o,c);const Ce=pe([],Ge([],Ie),ce);pe(o,X,Ce)}else de=n.elevation.getAtPointOrZero(new Qe(C.x/Z,C.y/Z),0);de!==0&&(o[14]+=de)}}function K0(o,e,n=!1){o.uploaded||(o.gfxTexture=new qw(e,o.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function $L(o,e,n){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,FL.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,jL.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,BL.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?NL:zL).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,VL.members,!0)),o.segments=en.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const c=o.material;c.pbrMetallicRoughness.baseColorTexture&&K0(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&K0(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&K0(c.normalTexture,e),c.occlusionTexture&&K0(c.occlusionTexture,e,n),c.emissionTexture&&K0(c.emissionTexture,e)}function Kw(o,e,n){if(o.meshes)for(const c of o.meshes)$L(c,e,n);if(o.children)for(const c of o.children)Kw(c,e,n)}function nx(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)nx(e)}function Yw(o){if(o.meshes)for(const n of o.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const n of o.children)Yw(n)}function hd(o,e){const n=o.json.bufferViews[e.bufferView],c=ex[e.componentType];return new c(o.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Z0[e.type]*c.BYTES_PER_ELEMENT?n.byteStride/c.BYTES_PER_ELEMENT:Z0[e.type]))}function Jw(o,e,n,c){const h=ex[e.componentType],p=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=o.json.bufferViews[e.bufferView],x=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:Z0[e.type],b=n.float32,E=b.length/n.capacity;for(let I=0,C=0;I<e.count*x;I+=x,C+=E)for(let k=0;k<E;k++)b[C+k]=c[I+k]*p;n._trim()}function GL(o,e,n){const c=o.indices,h=o.attributes,p={};p.indexArray=new Nn;const g=e.json.accessors[c],x=g.count/3;p.indexArray.reserve(x);const b=hd(e,g);for(let k=0;k<x;k++)p.indexArray.emplaceBack(b[3*k],b[3*k+1],b[3*k+2]);p.indexArray._trim(),p.vertexArray=new Ws;const E=e.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const I=hd(e,E);for(let k=0;k<E.count;k++)p.vertexArray.emplaceBack(I[3*k],I[3*k+1],I[3*k+2]);if(p.vertexArray._trim(),p.aabb=new Er(E.min,E.max),p.centroid=function(k,F){const N=[0,0,0],W=k.length;if(W>0){for(let Z=0;Z<W;Z++){const X=3*k[Z];N[0]+=F[X],N[1]+=F[X+1],N[2]+=F[X+2]}N[0]/=W,N[1]/=W,N[2]/=W}return N}(b,I),h.COLOR_0!==void 0){const k=e.json.accessors[h.COLOR_0],F=Z0[k.type],N=hd(e,k);p.colorArray=F===3?new Ws:new la,p.colorArray.resize(k.count),Jw(e,k,p.colorArray,N)}if(h.NORMAL!==void 0){p.normalArray=new Ws;const k=e.json.accessors[h.NORMAL];p.normalArray.resize(k.count);const F=hd(e,k);Jw(e,k,p.normalArray,F)}if(h.TEXCOORD_0!==void 0&&n.length>0){p.texcoordArray=new Mu;const k=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(k.count);const F=hd(e,k);Jw(e,k,p.texcoordArray,F)}if(h._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=hd(e,k))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(hd(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const C=o.material;return p.material=function(k,F){const{emissiveFactor:N=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:Z=.5,normalTexture:X,occlusionTexture:le,emissiveTexture:ce,doubleSided:de}=k,{baseColorFactor:Ie=[1,1,1,1],metallicFactor:Ce=1,roughnessFactor:Re=1,baseColorTexture:Le,metallicRoughnessTexture:Fe}=k.pbrMetallicRoughness||{},dt=le?F[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&dt){const je=le.extensions.KHR_texture_transform;dt.offsetScale=[je.offset[0],je.offset[1],je.scale[0],je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _i(...Ie),metallicFactor:Ce,roughnessFactor:Re,baseColorTexture:Le?F[Le.index]:void 0,metallicRoughnessTexture:Fe?F[Fe.index]:void 0},doubleSided:de,emissiveFactor:new _i(...N),alphaMode:W,alphaCutoff:Z,normalTexture:X?F[X.index]:void 0,occlusionTexture:dt,emissionTexture:ce?F[ce.index]:void 0,defined:k.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},n),p}function CA(o,e,n){const{matrix:c,rotation:h,translation:p,scale:g,mesh:x,extras:b,children:E}=o,I={};if(I.matrix=c||function(C,k,F,N){var W=k[0],Z=k[1],X=k[2],le=k[3],ce=W+W,de=Z+Z,Ie=X+X,Ce=W*ce,Re=W*de,Le=W*Ie,Fe=Z*de,dt=Z*Ie,je=X*Ie,pt=le*ce,wt=le*de,mt=le*Ie,_t=N[0],Et=N[1],lt=N[2];return C[0]=(1-(Fe+je))*_t,C[1]=(Re+mt)*_t,C[2]=(Le-wt)*_t,C[3]=0,C[4]=(Re-mt)*Et,C[5]=(1-(Ce+je))*Et,C[6]=(dt+pt)*Et,C[7]=0,C[8]=(Le+wt)*lt,C[9]=(dt-pt)*lt,C[10]=(1-(Ce+Fe))*lt,C[11]=0,C[12]=F[0],C[13]=F[1],C[14]=F[2],C[15]=1,C}([],h||[0,0,0,1],p||[0,0,0],g||[1,1,1]),x!==void 0){I.meshes=n[x];const C=I.anchor=[0,0];for(const k of I.meshes){const{min:F,max:N}=k.aabb;C[0]+=F[0]+N[0],C[1]+=F[1]+N[1]}C[0]=Math.floor(C[0]/I.meshes.length/2),C[1]=Math.floor(C[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=function(C){if(!C.length)return[];const k=function(X){const le=atob(X),ce=new Uint8Array(le.length);for(let de=0;de<le.length;de++)ce[de]=le.codePointAt(de);return ce}(C),F=[],N=k.length/24,W=new Uint16Array(k.buffer),Z=new Float32Array(k.buffer);for(let X=0;X<N;X++){const le=W[2*X*6]/30,ce=W[2*X*6+1]/30,de=W[2*X*6+10]/100,Ie=Z[6*X+1],Ce=Z[6*X+2],Re=Z[6*X+3],Le=Z[6*X+4],Fe=Re-Ie,dt=Le-Ce,je=Math.hypot(Fe,dt);F.push({pos:[Ie+.5*Fe,Ce+.5*dt,ce],normal:[dt/je,-Fe/je,0],width:je,height:le,depth:de,points:[Ie,Ce,Re,Le]})}return F}(b.lights))),E){const C=[];for(const k of E)C.push(CA(e.json.nodes[k],e,n));I.children=C}return I}function HL(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new Wy(o.vertices,o.indices,8,256),[n,c]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:n,max:c}}function WL(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const c=[];for(const g of n){if(!Array.isArray(g)||g.length!==2)continue;const x=g[0],b=g[1];typeof x=="number"&&typeof b=="number"&&c.push(new bt(x,b))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let g=0;g<c.length;g++){const x=c[g],b=c[(g+1)%c.length],E=c[(g+2)%c.length];h+=(x.x-b.x)*(E.y-b.y)-(E.x-b.x)*(x.y-b.y)}h>0&&c.reverse();const p=op(c.flatMap(g=>[g.x,g.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function qL(o,e){const n=[],c=[];let h=0;const p=[];for(const g of o){h=n.length;const x=g.vertexArray.float32,b=g.indexArray.uint16;for(let E=0;E<g.vertexArray.length;E++)p[0]=x[3*E+0],p[1]=x[3*E+1],p[2]=x[3*E+2],Qt(p,p,e),n.push(new bt(p[0],p[1]));for(let E=0;E<3*g.indexArray.length;E++)c.push(b[E]+h)}if(c.length%3!=0)return null;for(let g=0;g<c.length;g+=3){const x=n[c[g+0]],b=n[c[g+1]],E=n[c[g+2]];(x.x-b.x)*(E.y-b.y)-(E.x-b.x)*(x.y-b.y)>0&&([c[g+1],c[g+2]]=[c[g+2],c[g+1]])}return{vertices:n,indices:c}}function PA(o){const e=function(b,E){const I=[],C=WebGL2RenderingContext;if(b.json.textures)for(const k of b.json.textures){const F={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};k.sampler!==void 0&&Object.assign(F,b.json.samplers[k.sampler]),I.push({image:E[k.source],sampler:F,uploaded:!1})}return I}(o,o.images),n=function(b,E){const I=[];for(const C of b.json.meshes){const k=[];for(const F of C.primitives)k.push(GL(F,b,E));I.push(k)}return I}(o,e),{scenes:c,scene:h,nodes:p}=o.json,g=c?c[h||0].nodes:[...p.keys()],x=[];for(const b of g)x.push(CA(p[b],o,n));return function(b,E,I){const C={},k=new Set;for(let F=0;F<b.length;F++){const N=I[E[F]];if(!N.extras)continue;const W=N.extras["mapbox:footprint:version"],Z=N.extras["mapbox:footprint:id"];(W||Z)&&k.add(F),W==="1.0.0"&&Z&&(C[Z]=F)}for(let F=0;F<b.length;F++){if(k.has(F))continue;const N=b[F],W=I[E[F]];if(!W.extras)continue;let Z=null;N.id in C&&(Z=qL(b[C[N.id]].meshes,N.matrix)),Z||(Z=WL(W)),Z&&(N.footprint=HL(Z))}if(k.size>0){const F=Array.from(k.values()).sort((N,W)=>N-W);for(let N=F.length-1;N>=0;N--)b.splice(F[N],1)}}(x,g,o.json.nodes),x}function ZL(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,n=o.aabb.min[0]-1,c=o.aabb.min[1]-1,h=ud/(o.aabb.max[0]-n+2),p=ud/(o.aabb.max[1]-c+2);for(let g=0;g<e.length;g+=3){const x=e[g+2],b=(e[g+0]-n)*h|0,E=(e[g+1]-c)*p|0;x>o.heightmap[E*ud+b]&&(o.heightmap[E*ud+b]=x)}}function kA(o,e,n,c,h){n.reserve(n.length+4*o.length),c.reserve(c.length+10*o.length),h.reserve(h.length+10*o.length);let p=c.length;for(const g of o){const x=Math.min(10,Math.max(4,1.3*g.height))*e,b=[-g.normal[1],g.normal[0],0],E=Math.min(.29,.1*g.width/g.depth),I=g.width-2*g.depth*e*(E+.01),C=Ue([],g.pos,b,I/2),k=Ue([],g.pos,b,-I/2),F=[C[0],C[1],C[2]+g.height],N=[k[0],k[1],k[2]+g.height],W=Ue([],g.normal,b,E);gr(W,W,x);const Z=Ue([],g.normal,b,-E);gr(Z,Z,x),Ir(W,C,W),Ir(Z,k,Z),C[2]+=.1,k[2]+=.1,c.emplaceBack(W[0],W[1],W[2]),c.emplaceBack(Z[0],Z[1],Z[2]),c.emplaceBack(C[0],C[1],C[2]),c.emplaceBack(k[0],k[1],k[2]),c.emplaceBack(F[0],F[1],F[2]),c.emplaceBack(N[0],N[1],N[2]),c.emplaceBack(C[0],C[1],C[2]),c.emplaceBack(k[0],k[1],k[2]),c.emplaceBack(W[0],W[1],W[2]),c.emplaceBack(Z[0],Z[1],Z[2]);const X=I/x/2;h.emplaceBack(-X-E,-1,X,.8),h.emplaceBack(X+E,-1,X,.8),h.emplaceBack(-X,0,X,1.3),h.emplaceBack(X,0,X,1.3),h.emplaceBack(X+E,-.8,X,.7),h.emplaceBack(X+E,-.8,X,.7),h.emplaceBack(0,0,X,1.3),h.emplaceBack(0,0,X,1.3),h.emplaceBack(X+E,-1.2,X,.8),h.emplaceBack(X+E,-1.2,X,.8),n.emplaceBack(6+p,4+p,8+p),n.emplaceBack(7+p,9+p,5+p),n.emplaceBack(0+p,1+p,2+p),n.emplaceBack(1+p,3+p,2+p),p+=10}}function XL(o,e){const n={};n.indexArray=new Nn,n.vertexArray=new Ws,n.colorArray=new la,kA(o,e,n.indexArray,n.vertexArray,n.colorArray);const c={defined:!0};c.emissiveFactor=_i.black;const h={};return h.baseColorFactor=_i.white,c.pbrMetallicRoughness=h,n.material=c,n.aabb=new Er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const RA=ii([{name:"a_pos_3f",components:3,type:"Float32"}]),KL=ii([{name:"a_normal_3",components:3,type:"Int16"}]),YL=ii([{name:"a_centroid_3",components:3,type:"Int16"}]),MA=ii([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),JL=ii([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),QL=ii([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),eF=ii([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),tF=ii([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),DA=xt.types,Qw=32767;function rF(o,e){const n=Dt+e;for(const c of o)for(const h of c)if(h.x<-e||h.x>n||h.y<-e||h.y>n)return!1;return!0}class OA{constructor(){this.layoutVertexArray=new Ws,this.layoutAttenuationArray=new la,this.layoutColorArray=new Pn,this.indexArray=new Nn,this.indexArrayForConflation=new Nn,this.segmentsBucket=new en}}class eb{constructor(){this.layoutVertexArray=new Ws,this.layoutNormalArray=new Ic,this.layoutCentroidArray=new Ic,this.layoutColorArray=new Pn,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Nn,this.indexArrayForConflation=new Nn,this.segmentsBucket=new en,this.entranceBloom=new OA}}class LA{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new eb,this.buildingWithFacade=new eb,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Pn,this.buildingWithFacade.layoutFacadeDataArray=new Pu,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Pn,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.groundEffect=new zw(e)}updateFootprints(e,n){for(const c of this.footprints)n.push({footprint:c,id:e})}prepare(){return function(){if(Qy!=null||fA!=null)return null;if(hp!=null)return hp;const e=fetch(ws.BUILDING_GEN_URL);return hp=function(n){let c,h,p,g;function x(){c=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),p=new Float32Array(g.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},I={a:{a:b,f:function(C){const k=c.length,F=Math.max(C>>>0,Math.ceil(1.2*k)),N=Math.ceil((F-k)/65536);try{return g.grow(N),x(),!0}catch{return!1}},g:b,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,I):n.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,I))).then(C=>{const k=C.instance.exports;return(0,k.g)(),g=k.f,x(),new PL({setStyle:k.h,setAOOptions:k.i,setMetricOptions:k.j,setStructuralOptions:k.k,setFacadeOptions:k.l,setFauxFacadeOptions:k.m,setFacadeClassifierOptions:k.n,addFeature:k.o,addFacade:k.p,generateMesh:k.q,getLastError:k.r,getOuterRingLength:k.s,getMeshCount:k.t,getPositionsPtr:k.u,getPositionsLength:k.v,getNormalsPtr:k.w,getNormalsLength:k.x,getColorsPtr:k.y,getColorsLength:k.z,getAOPtr:k.A,getAOLength:k.B,getUVPtr:k.C,getUVLength:k.D,getFauxFacadePtr:k.E,getFauxFacadeLength:k.F,getIndicesPtr:k.G,getIndicesLength:k.H,getBuildingPart:k.I,getRingCount:k.J,getRingPtr:k.K,getRingLength:k.L,free:k.M,malloc:k.N,heapU8:c,heap32:h,heapF32:p})})}(e).then(n=>(hp=null,Qy=n,Qy)).catch(n=>{$t("Could not load building-gen"),hp=null,fA=n}),hp}()}populate(e,n,c,h){const p=kL();if(!p)return;const g=$e(c);this.tileToMeter=g,this.brightness=n.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const x=new Map;for(const{feature:b}of e){if(DA[b.type]!=="LineString")continue;const E=this.layers[0]._featureFilter.needGeometry,I=St(b,E);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),I,c))continue;const C=E?I.geometry:jt(b,c,h),k=[];for(const Z of C)for(const X of Z)k.push({x:X.x,y:X.y});const F={coordinates:k,crossPerc:b.properties.cross_perc,distanceToRoad:b.properties.distance_to_road,entrances:b.properties.entrances,sourceId:0},N=b.properties.source_id;let W=x.get(N);W||(W=[],x.set(N,W)),W.push(F)}this.maxHeight=0;for(const{feature:b,index:E}of e){if(DA[b.type]==="LineString")continue;const I=this.layers[0]._featureFilter.needGeometry,C=St(b,I);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),C,c))continue;const k=I?C.geometry:jt(b,c,h),F=B0(k,500);if(!rF(k,163))continue;const N=this.layers[0],W=N.layout.get("building-base").evaluate(b,{},c),Z=N.layout.get("building-height").evaluate(b,{},c),X=N.layout.get("building-roof-shape").evaluate(b,{},c),le=N.paint.get("building-ambient-occlusion-intensity"),ce=N.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(X==="flat")continue;const de=N.layout.get("building-facade").evaluate(b,{},c);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(de,!1,1);const Ie=b.properties.source_id;let Ce;Ce=x.has(Ie)?x.get(Ie):[];let Re=0,Le=0,Fe=0,dt=0,je=0,pt=0;if(de){let Yt=Math.round(N.layout.get("building-facade-floors").evaluate(b,{},c));if(W===0){Yt=Math.max(1,Yt-(Ce.length>0?1:0));let ni=4;if(Z>100){const ye=[10,13,15];ni=ye[b.id?b.id%ye.length:0],p.setFacadeOptions(ni,!0)}je=1.6803*ni/g}else je=W/g;pt=Z/g,je=Math.min(je,pt),Fe=N.layout.get("building-facade-unit-width").evaluate(b,{},c)/g,dt=(pt-je)/Yt,p.setFauxFacadeOptions(!0,!0,Fe);const Fr=N.layout.get("building-facade-window").evaluate(b,{},c);Re=Fr[0],Le=Fr[1]}const wt=[],mt=new bt(1/0,1/0),_t=new bt(-1/0,-1/0),Et=new bt(0,0);let lt=0;for(const Yt of F)if(Yt.length>0){const Fr=[];for(const ni of Yt){const ye=[];for(let xe=ni.length-1;xe>=0;xe--){const Ke=ni[xe];ye.push({x:Ke.x,y:Ke.y}),mt.x=Math.min(mt.x,Ke.x),mt.y=Math.min(mt.y,Ke.y),_t.x=Math.max(_t.x,Ke.x),_t.y=Math.max(_t.y,Ke.y),Et.x+=Ke.x,Et.y+=Ke.y,lt++}Fr.push(ye)}wt.push({id:b.id?b.id:0,height:Z,minHeight:W,sourceId:0,roofType:X,coordinates:Fr})}Et.x/=lt||1,Et.y/=lt||1;const yt=p.generateMesh(wt,Ce);if(typeof yt=="string"){$t(`Unable to generate building ${b.id}: ${yt}`);continue}if(yt.meshes.length===0||yt.modifiedPolygonRings.length===0)continue;let Je=0;for(const Yt of yt.meshes)Je+=Yt.positions.length/3;const Ze=de?this.buildingWithFacade:this.buildingWithoutFacade,At=Ze.segmentsBucket.prepareSegment(Je,Ze.layoutVertexArray,Ze.indexArray),Tt=[];let hr=null,Gt=0,Jt=-1;const Rt=Ze.indexArray.length;let cr=0;for(const Yt of yt.meshes){const Fr=Ze.layoutVertexArray.length;if(Yt.buildingPart==="entrance"){const ut=new Array;for(let pr=0;pr<Yt.indices.length;pr+=12){const Zr=Yt.positions[pr+0],Kr=Yt.positions[pr+1],Wr=Yt.positions[pr+3],wi=Yt.positions[pr+4],qi=Yt.positions[pr+2],Hr=Yt.positions[pr+8]-qi,Oi=1,Si=Wr-Zr,ui=wi-Kr,Ni=Math.hypot(Si,ui);ut.push({pos:[Zr+.5*Si,Kr+.5*ui,qi],normal:[ui/Ni,-Si/Ni,0],width:Ni,height:Hr,depth:Oi,points:[Zr,Kr,Wr,wi]})}const Ft=Ze.entranceBloom.segmentsBucket.prepareSegment(10*ut.length,Ze.entranceBloom.layoutVertexArray,Ze.entranceBloom.indexArray),Lt=Ze.entranceBloom.layoutVertexArray.length;Gt=Ze.entranceBloom.indexArray.length,kA(ut,.5/this.tileToMeter,Ze.entranceBloom.indexArray,Ze.entranceBloom.layoutVertexArray,Ze.entranceBloom.layoutAttenuationArray);const qt=Ze.entranceBloom.layoutVertexArray.length-Lt;Jt=Ze.entranceBloom.indexArray.length-Gt;for(let pr=0;pr<qt;pr++)Ze.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Ft.vertexLength+=qt,Ft.primitiveLength+=Jt,hr={part:Yt.buildingPart,vertexOffset:Lt,vertexLength:qt}}for(let ut=0;ut<Yt.positions.length;ut+=3)cr=Math.max(cr,Yt.positions[ut+2]),Ze.layoutVertexArray.emplaceBack(Yt.positions[ut],Yt.positions[ut+1],Yt.positions[ut+2]);const ni=Math.floor(Et.x),ye=Math.floor(Et.y),xe=Math.floor(cr);for(let ut=0;ut<Yt.positions.length;ut+=3)Ze.layoutCentroidArray.emplaceBack(ni,ye,xe);for(let ut=0;ut<Yt.normals.length;ut+=3)Ze.layoutNormalArray.emplaceBack(Yt.normals[ut+0]*Qw,Yt.normals[ut+1]*Qw,Yt.normals[ut+2]*Qw);for(let ut=0;ut<Yt.ao.length;ut++)Ze.layoutAOArray.push(Yt.ao[ut]);for(let ut=0;ut<Yt.colors.length;ut+=3){const Ft=1+(Yt.ao[ut/3]-1)*le;Ze.layoutColorArray.emplaceBack(Yt.colors[ut]*Ft<<8|Yt.colors[ut+1]*Ft,Yt.colors[ut+2]*Ft<<8)}if(de){for(let ut=0;ut<Yt.positions.length;ut+=3)Ze.layoutFacadePaintArray.emplaceBack(65535,255);for(let ut=0;ut<Yt.isFauxFacade.length;ut++)if(Yt.isFauxFacade[ut]){const Ft=1|Math.min(65535,Math.floor(Yt.uv[2*ut]*yt.outerRingLength)),Lt=Math.floor(255*Re)<<8|Math.floor(255*Le),qt=Math.floor(65535*Math.min(1,Fe/Dt)),pr=Math.floor(65535*Math.min(1,dt/Dt));Ze.layoutFacadeDataArray.emplaceBack(Ft,Lt,qt,pr);const Zr=Math.floor(65535*Math.min(1,je/Dt)),Kr=Math.floor(65535*Math.min(1,pt/Dt));Ze.layoutFacadeVerticalRangeArray.emplaceBack(Zr,Kr)}else Ze.layoutFacadeDataArray.emplaceBack(0,0,0,0),Ze.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ke=At.vertexLength;for(let ut=0;ut<Yt.indices.length;ut+=3)Ze.indexArray.emplaceBack(Ke+Yt.indices[ut],Ke+Yt.indices[ut+1],Ke+Yt.indices[ut+2]);At.vertexLength+=Yt.positions.length/3,At.primitiveLength+=Yt.indices.length/3,(Yt.buildingPart==="roof"||Yt.buildingPart==="wall"||Yt.buildingPart==="facade_glazing"||Yt.buildingPart==="entrance")&&Tt.push({part:Yt.buildingPart,vertexOffset:Fr,vertexLength:Yt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,cr),this.buildingFeatures.push({feature:C,hasFauxFacade:de,segment:At,parts:Tt,buildingBloom:hr});const Mr=Ze.indexArray.length-Rt,Nt=[],rr=[],Tr=new bt(1/0,1/0),Lr=new bt(-1/0,-1/0),qr=this.groundEffect.vertexArray.length;for(const Yt of yt.modifiedPolygonRings){const Fr=[],ni=new bt(1/0,1/0),ye=new bt(-1/0,-1/0);for(let xe=0;xe<Yt.length;xe+=2){const Ke=Yt.length-xe-2;ni.x=Math.min(ni.x,Yt[Ke]),ni.y=Math.min(ni.y,Yt[Ke+1]),ye.x=Math.max(ye.x,Yt[Ke]),ye.y=Math.max(ye.y,Yt[Ke+1]);const ut=new bt(Yt[Ke],Yt[Ke+1]);Fr.push(ut),Nt.push(ut.x,ut.y),rr.push(ut.clone())}Tr.x=Math.min(Tr.x,ni.x),Tr.y=Math.min(Tr.y,ni.y),Lr.x=Math.max(Lr.x,ye.x),Lr.y=Math.max(Lr.y,ye.y),this.groundEffect.addData(Fr,[ni,ye],ce)}const Nr=this.groundEffect.vertexArray.length-qr;(mt.x<0||_t.x>Dt||mt.y<0||_t.y>Dt)&&this.featuresOnBorder.push({featureId:b.id,footprintIndex:this.footprints.length});{const Yt=op(Nt,null,2),Fr=new Wy(rr,Yt,8,256);let ni=b.id;b.properties&&b.properties.hasOwnProperty("building_id")&&(ni=b.properties.building_id),this.footprints.push({vertices:rr,indices:Yt,grid:Fr,min:Tr,max:Lr,buildingId:ni,hiddenFlags:0,indicesOffset:Rt,indicesLength:Mr,bloomIndicesOffset:Gt,bloomIndicesLength:Jt,groundEffectVertexOffset:qr,groundEffectVertexLength:Nr,hasFauxFacade:de,segment:At,height:cr})}this.programConfigurations.populatePaintArrays(Ze.layoutVertexArray.length,b,E,{},n.availableImages,c,n.brightness),this.groundEffect.addPaintPropertiesData(b,E,{},n.availableImages,c,n.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,n,c,h,p,g,x){this.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x),this.groundEffect.update(e,n,p,c,h,g,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=c=>{c.layoutVertexBuffer=e.createVertexBuffer(c.layoutVertexArray,RA.members),c.layoutNormalBuffer=e.createVertexBuffer(c.layoutNormalArray,KL.members),c.layoutCentroidBuffer=e.createVertexBuffer(c.layoutCentroidArray,YL.members),c.layoutFacadeDataArray&&c.layoutFacadeDataArray.length&&(c.layoutFacadeDataBuffer=e.createVertexBuffer(c.layoutFacadeDataArray,QL.members)),c.layoutFacadeVerticalRangeArray&&c.layoutFacadeVerticalRangeArray.length&&(c.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(c.layoutFacadeVerticalRangeArray,eF.members)),c.entranceBloom.layoutVertexArray.length&&(c.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(c.entranceBloom.layoutVertexArray,RA.members),c.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(c.entranceBloom.layoutAttenuationArray,tF.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,c=!0){let h=!1;const p=c?n:0,g=0|(c?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const b=this.footprints[x],E=b.hiddenFlags&g|p;b.hiddenFlags!==E&&(b.hiddenFlags=E,h=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const h of this.footprints){const p=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let b=h.indicesOffset;b<g;b++)p.indexArrayForConflation.uint16[3*b+0]=0,p.indexArrayForConflation.uint16[3*b+1]=0,p.indexArrayForConflation.uint16[3*b+2]=0;const x=h.bloomIndicesOffset+h.bloomIndicesLength;for(let b=h.bloomIndicesOffset;b<x;b++)p.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}const c=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=e.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=e.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=c=>{c.layoutColorBuffer?c.layoutColorBuffer.updateData(c.layoutColorArray):c.layoutColorBuffer=e.createVertexBuffer(c.layoutColorArray,MA.members,!0),c.layoutFacadePaintArray&&(c.layoutFacadePaintBuffer?c.layoutFacadePaintBuffer.updateData(c.layoutFacadePaintArray):c.layoutFacadePaintBuffer=e.createVertexBuffer(c.layoutFacadePaintArray,JL.members,!0)),c.entranceBloom.layoutColorBuffer?c.entranceBloom.layoutColorBuffer.updateData(c.entranceBloom.layoutColorArray):c.entranceBloom.layoutColorBuffer=e.createVertexBuffer(c.entranceBloom.layoutColorArray,MA.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const c=e.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const p=n[h.feature.id],g=h.feature;g.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="wall";const E=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="door";const F=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical),W=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const X of h.parts){let le,ce=x;X.part==="roof"?(ce=x,le=b):X.part==="wall"?(ce=E,le=I):X.part==="facade_glazing"?(ce=C,le=k):X.part==="entrance"&&(ce=F,le=N),le=U(le,0,1);for(let de=0;de<X.vertexLength;de++){const Ie=X.vertexOffset+de,Ce=1+(W.layoutAOArray[Ie]-1)*c;W.layoutColorArray.emplace(Ie,ce.r*Ce*255<<8|ce.g*Ce*255,ce.b*Ce*255<<8|255*le),h.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Ie,255*C.r<<8|255*C.g,255*C.b<<8|255*k)}}const Z=h.buildingBloom;if(Z)for(let X=0;X<Z.vertexLength;X++)W.entranceBloom.layoutColorArray.emplace(Z.vertexOffset+X,255*F.r<<8|255*F.g,255*F.b<<8|51*N)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const h=n.getReplacementRegionsForTile(e.toUnwrapped());if(Zy(this.activeReplacements,h))return;this.activeReplacements=h;for(const g of this.footprints)g.hiddenFlags&=-2;const p=[];for(const g of this.activeReplacements){if(g.order<=BE)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>g.max.x||b.max.x<g.min.x||b.min.y>g.max.y||b.max.y<g.min.y||(p.length=0,iF(b.vertices,0,b.vertices.length,g.footprintTileId.canonical,e.canonical,p),Ow(g.footprint,p,b.indices,0,b.indices.length,0,-x)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+Dt)*Dt+(n+Dt);if(this.footprintLookup.hasOwnProperty(p)){const x=this.footprintLookup[p];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const g=new bt(e,n);for(const x of this.footprints)e>x.max.x||x.min.x>e||n>x.max.y||x.min.y>n||x.height<=c||Lw(g,x)&&(c=x.height,this.footprintLookup[p]=x,h=x.hiddenFlags!==0);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.footprintLookup[p]=void 0}}function iF(o,e,n,c,h,p){const g=Math.pow(2,c.z-h.z);for(let x=0;x<n;x++){let b=o[x+e].x,E=o[x+e].y;b=(b+h.x*Dt)*g-c.x*Dt,E=(E+h.y*Dt)*g-c.y*Dt,p.push(new bt(b,E))}}let FA,NA;Wt(LA,"BuildingBucket",{omit:["layers"]}),Wt(eb,"BuildingGeometry"),Wt(OA,"BuildingBloomGeometry");const nF=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),sF=ii([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:oF}=nF,aF=ii([{name:"a_packed",components:3,type:"Float32"}]),{members:lF}=aF,cF=ii([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:uF}=cF;class zA{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Nu({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const c=this.getKey(e,n);return this.positions[c]}trim(){const e=this.width,n=this.height=Ve(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,c){const h=[];let p=e.length%2==1?-e[e.length-1]*c:0,g=e[0]*c,x=!0;h.push({left:p,right:g,isDash:x,zeroLength:e[0]===0});let b=e[0];for(let E=1;E<e.length;E++){x=!x;const I=e[E];p=b*c,b+=I,g=b*c,h.push({left:p,right:g,isDash:x,zeroLength:I===0})}return h}addRoundDash(e,n,c){const h=n/2;for(let p=-c;p<=c;p++){const g=this.width*(this.nextRow+c+p);let x=0,b=e[x];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++x]);const I=Math.abs(E-b.left),C=Math.abs(E-b.right),k=Math.min(I,C);let F;const N=p/c*(h+1);if(b.isDash){const W=h-Math.abs(N);F=Math.sqrt(k*k+W*W)}else F=h-Math.sqrt(k*k+N*N);this.image.data[g+E]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const E=e[b],I=e[b+1];E.zeroLength?e.splice(b,1):I&&I.isDash===E.isDash&&(I.left=E.left,e.splice(b,1))}const c=e[0],h=e[e.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const p=this.width*this.nextRow;let g=0,x=e[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++g]);const E=Math.abs(b-x.left),I=Math.abs(b-x.right),C=Math.min(E,I);this.image.data[p+b]=Math.max(0,Math.min(255,(x.isDash?C:-C)+n+128))}}addDash(e,n){const c=this.getKey(e,n);if(this.positions[c])return this.positions[c];const h=n==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return $t("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&($t("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,C=this.getDashRanges(e,this.width,I);h?this.addRoundDash(C,I,p):this.addRegularDash(C,n==="square"?.5*I:0)}const b=this.nextRow+p;this.nextRow+=g;const E={tl:[b,p],br:[x,0]};return this.positions[c]=E,E}}Wt(zA,"LineAtlas");const hF=xt.types,dF=Math.cos(Math.PI/180*37.5),fF=Math.cos(Math.PI/180*5);class tb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Zf,this.layoutVertexArray2=new Ws,this.patternVertexArray=new Ws,this.indexArray=new Nn,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new en,this.maxLineLength=0,this.zOffsetVertexArray=new Ws,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Dt/64,this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,c,h){this.hasPattern=Cw("line",this.layers,this.pixelRatio,n);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$e(c);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),F=k.isConstant()&&!k.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&F?"none":"offset",this.elevationType==="offset"&&g==="none"&&$t(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const b=[];for(const{feature:k,id:F,index:N,sourceLayerIndex:W}of e){const Z=this.layers[0]._featureFilter.needGeometry,X=St(k,Z);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),X,c))continue;const le=p?p.evaluate(X,{},c):void 0,ce={id:F,properties:k.properties,type:k.type,sourceLayerIndex:W,index:N,geometry:Z?X.geometry:jt(k,c,h),patterns:{},sortKey:le};b.push(ce)}p&&b.sort((k,F)=>k.sortKey-F.sortKey);const{lineAtlas:E,featureIndex:I}=n,C=this.addConstantDashes(E);for(const k of b){const{geometry:F,index:N,sourceLayerIndex:W}=k;if(C&&this.addFeatureDashes(k,E),this.hasPattern){const Z=Pw("line",this.layers,k,this.zoom,this.pixelRatio,n);this.patternFeatures.push(Z)}else this.addFeature(k,F,N,c,E.positions,n.availableImages,n.brightness,n.elevationFeatures);I.insert(e[N].feature,F,N,W,this.index)}}addConstantDashes(e){let n=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")n=!0;else{const g=p.value,x=h.value;if(!x)continue;e.addDash(x,g)}}return n}addFeatureDashes(e,n){const c=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let x,b;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:c},e);b=g.kind==="constant"?g.value:g.evaluate({zoom:c},e),n.addDash(x,b),e.patterns[h.id]=[n.getKey(x,b)]}}update(e,n,c,h,p,g,x,b){this.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,b)}addFeatures(e,n,c,h,p,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,c,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,uF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,sF.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oF),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let c,h;if(n&&n>0?(c=`mapbox_clip_start_${n}`,h=`mapbox_clip_end_${n}`):(c="mapbox_clip_start",h="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(c)&&e.properties.hasOwnProperty(h))return{start:+e.properties[c],end:+e.properties[h]}}addFeature(e,n,c,h,p,g,x,b){const E=this.layers[0].layout,I=E.get("line-join").evaluate(e,{}),C=E.get("line-cap").evaluate(e,{}),k=E.get("line-miter-limit"),F=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const N=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const Z=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,h,b,I,C,k,F)){const[X,le]=this.clipRuntimeLinesToTile(n,1);for(let ce=0;ce<X.length;ce++){const de=X[ce],Ie=le[ce],Ce={progress:{min:Ie.progress.min,max:Ie.progress.max},nextDir:this.computeSegNextDir(Ie,de),prevDir:this.computeSegPrevDir(Ie,de)};this.addLine(de,e,h,I,C,k,F,Ce,N&&Ie.parentIndex>0?Ie.parentIndex:null)}this.fillNonElevatedRoadSegment(Z)}}else for(let Z=0;Z<n.length;Z++)this.addLine(n[Z],e,h,I,C,k,F,void 0,N&&Z>0?Z:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,g,h,x,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return Yy(e,-n,-n,Dt+n,Dt+n)}clipRuntimeLinesToTile(e,n){const c=[];return[Yy(e,-n,-n,Dt+n,Dt+n,c),c]}addElevatedRoadFeature(e,n,c,h,p,g,x,b){const E=[],I=Ki.getElevationFeature(e,h);if(I){const C=this.clipLinesToTile(n,1),k=this.prepareElevatedLines(C,I,c);for(const F of k)E.push({geometry:F,elevation:I,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const C of E){const k=this.layoutVertexArray.length;this.addLine(C.geometry,e,c,p,g,x,b);const F=new bn(c,C.elevationTileID);if(C.elevation)for(let N=k;N<this.layoutVertexArray.length;N++){const W=new bt(this.layoutVertexArray.int16[6*N]>>1,this.layoutVertexArray.int16[6*N+1]>>1),Z=F.pointElevation(W,C.elevation,.05);this.updateHeightRange(Z),this.zOffsetVertexArray.emplaceBack(Z,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,n,c){if(n.constantHeight!=null)return e;const h=[],p=1/$e(c);for(const g of e)AL(g,new vi(n,p),0,h);return h}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,c,h,p,g,x,b,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(n,E):this.lineClips;const I=h==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=b&&b.progress.min>0,k=b&&b.progress.max<1;if(this.lineClips){let Fe={min:this.lineClips.start,max:this.lineClips.end},dt=1;if(b){const wt=this.lineClips.end-this.lineClips.start;Fe=function(mt,_t,Et){return{min:as(mt.min,_t,Et),max:as(mt.max,_t,Et)}}(b.progress,{min:0,max:1},Fe),wt>0&&(dt=(Fe.max-Fe.min)/wt)}const je=+n.properties.mapbox_clip_feature_len,pt=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(je)||Number.isNaN(pt)){for(let mt=0;mt<e.length-1;mt++)this.totalDistance+=e[mt].dist(e[mt+1]);const wt=this.totalDistance/(Fe.max-Fe.min);this.totalFeatureLength=Number.isFinite(wt)?wt:0,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=je,this.distance=pt*dt,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const F=hF[n.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let W=0;for(;W<N-1&&e[W].equals(e[W+1]);)W++;if(N<(F?3:2))return;h==="bevel"&&(g=1.05);const Z=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let X,le,ce,de,Ie,Ce,Re,Le;b&&b.prevDir&&(Ce=b.prevDir.perp()),b&&b.nextDir&&(Re=b.nextDir.perp()),this.e1=this.e2=-1,F&&(X=e[N-2],Ie=e[W].sub(X)._unit()._perp());for(let Fe=W;Fe<N;Fe++){if(ce=Fe===N-1?F?e[W+1]:void 0:e[Fe+1],ce&&e[Fe].equals(ce))continue;Ie&&(de=Ie),X&&(le=X),X=e[Fe],Le=this.evaluateLineProgressFeatures(le?le.dist(X):0),Ie=ce?ce.sub(X)._unit()._perp():de,de=de||Ie;const dt=le&&ce;let je=dt?h:F||I?"butt":p;const pt=de.x*Ie.x+de.y*Ie.y;if(I){const Ze=function(At){if(At.patternJoinNone){const Tt=At.segmentPoints.length/2,hr=At.lineSoFar-At.segmentStart;for(let Gt=0;Gt<Tt;++Gt){const Jt=At.segmentPoints[2*Gt+1],Rt=Math.round(At.segmentPoints[2*Gt])+.5+.25*Jt;At.patternVertexArray.emplaceBack(Rt,hr,At.segmentStart),At.patternVertexArray.emplaceBack(Rt,hr,At.segmentStart)}At.segmentPoints.length=0}At.e1=At.e2=-1};if(dt&&pt<fF){this.updateDistance(le,X),this.addCurrentVertex(X,de,1,1,Z,Le),Ze(this),this.addCurrentVertex(X,Ie,-1,-1,Z,Le);continue}if(le){if(!ce){this.updateDistance(le,X),this.addCurrentVertex(X,de,1,1,Z,Le),Ze(this);continue}je="miter"}}let wt=de.add(Ie);wt.x===0&&wt.y===0||wt._unit();const mt=wt.x*Ie.x+wt.y*Ie.y,_t=mt!==0?1/mt:1/0,Et=2*Math.sqrt(2-2*mt),lt=mt<dF&&le&&ce,yt=de.x*Ie.y-de.y*Ie.x>0,Je=this.overscaling<=16?15*Dt/(512*this.overscaling):0;if(dt&&je==="round"){if(_t<x)je="miter";else if(_t<=2){const Ze=rb(X,-10,Dt+10);je=this.elevationType==="offset"&&(Ze||this.hasCrossSlope)?"miter":"fakeround"}}if(je==="miter"&&_t>g&&(je="bevel"),je==="bevel"&&(_t>2&&(je="flipbevel"),_t<g&&(je="miter")),le&&!(je==="miter"&&lt)&&this.updateDistance(le,X),je==="miter")if(lt){const Ze=X.dist(le);if(Ze>2*Je){const Tt=X.sub(X.sub(le)._mult(Je/Ze)._round());this.updateDistance(le,Tt),this.addCurrentVertex(Tt,de,0,0,Z,Le),le=Tt}this.updateDistance(le,X),wt._mult(_t),this.addCurrentVertex(X,wt,0,0,Z,Le);const At=X.dist(ce);if(At>2*Je){const Tt=X.add(ce.sub(X)._mult(Je/At)._round());this.updateDistance(X,Tt),this.addCurrentVertex(Tt,Ie,0,0,Z,Le),X=Tt}}else wt._mult(_t),this.addCurrentVertex(X,wt,0,0,Z,Le);else if(je==="flipbevel"){if(_t>100)wt=Ie.mult(-1);else{const Ze=_t*de.add(Ie).mag()/de.sub(Ie).mag();wt._perp()._mult(Ze*(yt?-1:1))}this.addCurrentVertex(X,wt,0,0,Z,Le),this.addCurrentVertex(X,wt.mult(-1),0,0,Z,Le)}else if(je==="bevel"||je==="fakeround"){Le!=null&&le&&this.addCurrentVertex(X,Re||de,-1,-1,Z,Le);const Ze=X.dist(le)<=2*Je&&je!=="bevel",At=wt.mult(yt?1:-1);At._mult(_t);const Tt=Ie.mult(yt?-1:1),hr=de.mult(yt?-1:1),Gt=this.evaluateLineProgressFeatures(this.distance);if(Le==null&&(this.addHalfVertex(X,At.x,At.y,!1,!yt,0,Z,Gt),Ze||this.addHalfVertex(X,At.x+2*hr.x,At.y+2*hr.y,!1,yt,0,Z,Gt)),je==="fakeround"){const Jt=Math.round(180*Et/Math.PI/20);this.addHalfVertex(X,hr.x,hr.y,!1,yt,0,Z,Gt);for(let Rt=0;Rt<Jt;Rt++){let cr=Rt/Jt;if(cr!==.5){const Nt=cr-.5;cr+=cr*Nt*(cr-1)*((1.0904+pt*(pt*(3.55645-1.43519*pt)-3.2452))*Nt*Nt+(.848013+pt*(.215638*pt-1.06021)))}const Mr=Tt.sub(hr)._mult(cr)._add(hr)._unit();this.addHalfVertex(X,Mr.x,Mr.y,!1,yt,0,Z,Gt)}this.addHalfVertex(X,Tt.x,Tt.y,!1,yt,0,Z,Gt)}Ze||Le!=null||this.addHalfVertex(X,At.x+2*Tt.x,At.y+2*Tt.y,!1,yt,0,Z,Gt),Le!=null&&ce&&this.addCurrentVertex(X,Ce||Ie,1,1,Z,Le)}else if(je==="butt")this.addCurrentVertex(X,wt,0,0,Z,Le);else if(je==="square"){if(!le){const Ze=C?0:-1;this.addCurrentVertex(X,wt,Ze,Ze,Z,Le)}if(this.addCurrentVertex(X,wt,0,0,Z,Le),le){const Ze=k?0:1;this.addCurrentVertex(X,wt,Ze,Ze,Z,Le)}}else if(je==="round"){if(le){const Ze=!dt&&Re?Re:de;this.addCurrentVertex(X,Ze,0,0,Z,Le),!dt&&k||this.addCurrentVertex(X,Ze,1,1,Z,Le,!0)}if(ce){const Ze=!dt&&Ce?Ce:Ie;!dt&&C||this.addCurrentVertex(X,Ze,-1,-1,Z,Le,!0),this.addCurrentVertex(X,Ze,0,0,Z,Le)}}}}addVerticesTo(e,n,c,h,p,g,x,b,E,I){const C=(n.w-e.w)/this.tessellationStep|0;let k=0;const F=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const W=(n.x-e.x)/C,Z=(n.y-e.y)/C,X=(n.z-e.z)/C,le=(n.w-e.w)/C;for(let ce=1;ce<C;++ce){e.x+=W,e.y+=Z,e.z+=X,this.lineSoFar+=le,k+=le;const de=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,c,h,I,!1,x,E,de),this.addHalfVertex(e,p,g,I,!0,-b,E,de)}}this.lineSoFar=n.w,this.scaledDistance=F;const N=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,c,h,I,!1,x,E,N),this.addHalfVertex(n,p,g,I,!0,-b,E,N)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):$t(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,c,h,p,g,x=!1){const b=n.x+n.y*c,E=n.y-n.x*c,I=n.y*h-n.x,C=-n.y-n.x*h;if(g!=null){const k=this.elevationType==="offset",F=-10,N=Dt+10,W=g.zOffset,Z=new oA(e.x,e.y,W,this.lineSoFar),X=!!k&&rb(e,F,N),le=this.lineSoFar,ce=this.distance;if(this.currentVertex)if(X){const de=this.currentVertexIsOutside,Ie=this.currentVertex,Ce=new oA(e.x,e.y,W,this.lineSoFar);if(lA(Ie,Ce,F,N),!rb(Ce,F,N)){if(de){this.e1=this.e2=-1,this.distance-=Ie.dist(Z),this.lineSoFar=Ie.w;const Re=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,b,E,x,!1,c,p,Re),this.addHalfVertex(Ie,I,C,x,!0,-h,p,Re),this.prevDistance=this.distance}this.distance=this.prevDistance+Ie.dist(Ce),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ie,Ce,b,E,I,C,c,h,p,x),this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){lA(de,Z,F,N),this.e1=this.e2=-1,this.distance-=de.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const Ie=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,b,E,x,!1,c,p,Ie),this.addHalfVertex(de,I,C,x,!0,-h,p,Ie),this.prevDistance=this.distance,this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,Z,b,E,I,C,c,h,p,x)}else X||(this.addHalfVertex(e,b,E,x,!1,c,p,g),this.addHalfVertex(e,I,C,x,!0,-h,p,g));this.currentVertex=Z,this.currentVertexIsOutside=X,this.lineSoFar=le}else this.addHalfVertex(e,b,E,x,!1,c,p,g),this.addHalfVertex(e,I,C,x,!0,-h,p,g)}addHalfVertex({x:e,y:n},c,h,p,g,x,b,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=wr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),g?this.e2=I:this.e1=I,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function rb(o,e,n){return o.x<e||o.x>n||o.y<e||o.y>n}let BA,jA;function UA(o,e,n){return e*(Dt/(o.tileSize*Math.pow(2,n-o.tileID.overscaledZ)))}Wt(tb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const VA=(o,e,n)=>(1-n)*o+n*e;function $A(o,e){return 1/UA(o,1,e.tileZoom)}function GA(o,e,n,c){return o.translatePosMatrix(c||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const HA=o=>{const e=[];WA(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=o.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const c=o.layout.get("line-join").constantOr("miter")==="none",h=!!o.paint.get("line-pattern").constantOr(1);return c&&h&&e.push("LINE_JOIN_NONE"),e};function WA(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let ib;const qA=()=>ib||(ib={layout:BA||(BA=new rn({"line-cap":new Bt(Be.layout_line["line-cap"]),"line-join":new Bt(Be.layout_line["line-join"]),"line-miter-limit":new It(Be.layout_line["line-miter-limit"]),"line-round-limit":new It(Be.layout_line["line-round-limit"]),"line-sort-key":new Bt(Be.layout_line["line-sort-key"]),"line-z-offset":new Bt(Be.layout_line["line-z-offset"]),"line-elevation-reference":new It(Be.layout_line["line-elevation-reference"]),"line-cross-slope":new It(Be.layout_line["line-cross-slope"]),visibility:new It(Be.layout_line.visibility),"line-width-unit":new It(Be.layout_line["line-width-unit"])})),paint:jA||(jA=new rn({"line-opacity":new Bt(Be.paint_line["line-opacity"]),"line-color":new Bt(Be.paint_line["line-color"]),"line-translate":new It(Be.paint_line["line-translate"]),"line-translate-anchor":new It(Be.paint_line["line-translate-anchor"]),"line-width":new Bt(Be.paint_line["line-width"]),"line-gap-width":new Bt(Be.paint_line["line-gap-width"]),"line-offset":new Bt(Be.paint_line["line-offset"]),"line-blur":new Bt(Be.paint_line["line-blur"]),"line-dasharray":new Bt(Be.paint_line["line-dasharray"]),"line-pattern":new Bt(Be.paint_line["line-pattern"]),"line-pattern-cross-fade":new It(Be.paint_line["line-pattern-cross-fade"]),"line-gradient":new Eu(Be.paint_line["line-gradient"]),"line-trim-offset":new It(Be.paint_line["line-trim-offset"]),"line-trim-fade-range":new It(Be.paint_line["line-trim-fade-range"]),"line-trim-color":new It(Be.paint_line["line-trim-color"]),"line-emissive-strength":new It(Be.paint_line["line-emissive-strength"]),"line-border-width":new Bt(Be.paint_line["line-border-width"]),"line-border-color":new Bt(Be.paint_line["line-border-color"]),"line-occlusion-opacity":new It(Be.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},ib);class pF extends Bt{possiblyEvaluate(e,n){return n=new Di(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,c,h){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,c,h)}}let Y0;function ZA(o,e){return e>0?e+2*o:o}const mF=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gF=ii([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_F=ii([{name:"a_projected_pos",components:4,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yF=ii([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),xF=ii([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),vF=ii([{name:"a_texb",components:2,type:"Uint16"}]),wF=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),bF=ii([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const XA=ii([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),TF=ii([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ii([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rs=24;function SF(o,e,n){return o.sections.forEach(c=>{c.text=function(h,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),ka.applyArabicShaping&&(h=ka.applyArabicShaping(h)),h}(c.text,e,n)}),o}const J0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function EF(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function AF(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const nb=4294967296,KA=1/nb,YA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let sx=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,n=this.length){for(;this.pos<n;){const c=this.readVarint(),h=c>>3,p=this.pos;this.type=7&c,o(h,e,this),this.pos===p&&this.skip(c)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*nb;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*nb;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let n,c;return c=e[this.pos++],n=127&c,c<128?n:(c=e[this.pos++],n|=(127&c)<<7,c<128?n:(c=e[this.pos++],n|=(127&c)<<14,c<128?n:(c=e[this.pos++],n|=(127&c)<<21,c<128?n:(c=e[this.pos],n|=(15&c)<<28,function(h,p,g){const x=g.buf;let b,E;if(E=x[g.pos++],b=(112&E)>>4,E<128||(E=x[g.pos++],b|=(127&E)<<3,E<128)||(E=x[g.pos++],b|=(127&E)<<10,E<128)||(E=x[g.pos++],b|=(127&E)<<17,E<128)||(E=x[g.pos++],b|=(127&E)<<24,E<128)||(E=x[g.pos++],b|=(1&E)<<31,E<128))return fp(h,b,p);throw new Error("Expected varint not more than 10 bytes")}(n,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&YA?YA.decode(this.buf.subarray(e,o)):function(n,c,h){let p="",g=c;for(;g<h;){const x=n[g];let b,E,I,C=null,k=x>239?4:x>223?3:x>191?2:1;if(g+k>h)break;k===1?x<128&&(C=x):k===2?(b=n[g+1],(192&b)==128&&(C=(31&x)<<6|63&b,C<=127&&(C=null))):k===3?(b=n[g+1],E=n[g+2],(192&b)==128&&(192&E)==128&&(C=(15&x)<<12|(63&b)<<6|63&E,(C<=2047||C>=55296&&C<=57343)&&(C=null))):k===4&&(b=n[g+1],E=n[g+2],I=n[g+3],(192&b)==128&&(192&E)==128&&(192&I)==128&&(C=(15&x)<<18|(63&b)<<12|(63&E)<<6|63&I,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,k=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),g+=k}return p}(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const n=this.readPackedEnd();for(;this.pos<n;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*KA),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*KA),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?function(e,n){let c,h;if(e>=0?(c=e%4294967296|0,h=e/4294967296|0):(c=~(-e%4294967296),h=~(-e/4294967296),4294967295^c?c=c+1|0:(c=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,g,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(c,0,n),function(p,g){const x=(7&p)<<4;g.buf[g.pos++]|=x|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,n)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=function(c,h,p){for(let g,x,b=0;b<h.length;b++){if(g=h.charCodeAt(b),g>55295&&g<57344){if(!x){g>56319||b+1===h.length?(c[p++]=239,c[p++]=191,c[p++]=189):x=g;continue}if(g<56320){c[p++]=239,c[p++]=191,c[p++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(c[p++]=239,c[p++]=191,c[p++]=189,x=null);g<128?c[p++]=g:(g<2048?c[p++]=g>>6|192:(g<65536?c[p++]=g>>12|224:(c[p++]=g>>18|240,c[p++]=g>>12&63|128),c[p++]=g>>6&63|128),c[p++]=63&g|128)}return p}(this.buf,o,this.pos);const n=this.pos-e;n>=128&&JA(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=o[n]}writeRawMessage(o,e){this.pos++;const n=this.pos;o(e,this);const c=this.pos-n;c>=128&&JA(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeMessage(o,e,n){this.writeTag(o,2),this.writeRawMessage(e,n)}writePackedVarint(o,e){e.length&&this.writeMessage(o,IF,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,CF,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,RF,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,PF,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,kF,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,MF,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,DF,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,OF,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,LF,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function fp(o,e,n){return n?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function JA(o,e,n){const c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(c);for(let h=n.pos-1;h>=o;h--)n.buf[h+c]=n.buf[h]}function IF(o,e){for(let n=0;n<o.length;n++)e.writeVarint(o[n])}function CF(o,e){for(let n=0;n<o.length;n++)e.writeSVarint(o[n])}function PF(o,e){for(let n=0;n<o.length;n++)e.writeFloat(o[n])}function kF(o,e){for(let n=0;n<o.length;n++)e.writeDouble(o[n])}function RF(o,e){for(let n=0;n<o.length;n++)e.writeBoolean(o[n])}function MF(o,e){for(let n=0;n<o.length;n++)e.writeFixed32(o[n])}function DF(o,e){for(let n=0;n<o.length;n++)e.writeSFixed32(o[n])}function OF(o,e){for(let n=0;n<o.length;n++)e.writeFixed64(o[n])}function LF(o,e){for(let n=0;n<o.length;n++)e.writeSFixed64(o[n])}const sb=3;function FF(o,e,n){e.glyphs=[],o===1&&n.readMessage(NF,e)}function NF(o,e,n){if(o===3){const{id:c,bitmap:h,width:p,height:g,left:x,top:b,advance:E}=n.readMessage(zF,{});e.glyphs.push({id:c,bitmap:new Nu({width:p+2*sb,height:g+2*sb},h),metrics:{width:p,height:g,left:x,top:b,advance:E}})}else o===4?e.ascender=n.readSVarint():o===5&&(e.descender=n.readSVarint())}function zF(o,e,n){o===1?e.id=n.readVarint():o===2?e.bitmap=n.readBytes():o===3?e.width=n.readVarint():o===4?e.height=n.readVarint():o===5?e.left=n.readSVarint():o===6?e.top=n.readSVarint():o===7&&(e.advance=n.readVarint())}const QA=sb,Po={horizontal:1,vertical:2,horizontalOnly:3};class Q0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const c=new Q0;return c.scale=e||1,c.fontStack=n,c}static forImage(e){const n=new Q0;return n.image=e,n}}class pp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,c){const h=new pp;for(let p=0;p<e.sections.length;p++){const g=e.sections[p];g.image?h.addImageSection(g,c):h.addTextSection(g,n)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,c){let h="";for(let p=0;p<n.length;p++){const g=n.charCodeAt(p+1)||null,x=n.charCodeAt(p-1)||null;h+=!c&&(g&&Uf(g)&&!J0[n[p+1]]||x&&Uf(x)&&!J0[n[p-1]])||!J0[n[p]]?n[p]:J0[n[p]]}return h}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&ox[this.text.charCodeAt(c)];c++)e++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&ox[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const c=new pp;return c.text=this.text.substring(e,n),c.sectionIndex=this.sectionIndex.slice(e,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Q0.forText(e.scale,e.fontStack||n));const c=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(c)}addImageSection(e,n){const c=e.image?e.image.getPrimary():null;if(!c)return void $t("Can't add FormattedSection with an empty image.");c.scaleSelf(n);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Q0.forImage(c)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ob(o,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W=1){const Z=pp.fromFeature(o,h,W);C===Po.vertical&&Z.verticalizePunctuation(k);let X=[];const le=function(Re,Le,Fe,dt,je,pt){if(!Re)return[];const wt=[],mt=function(yt,Je,Ze,At,Tt,hr){let Gt=0;for(let Jt=0;Jt<yt.length();Jt++){const Rt=yt.getSection(Jt);Gt+=eI(yt.getCodePoint(Jt),Rt,At,Tt,Je,hr)}return Gt/Math.max(1,Math.ceil(Gt/Ze))}(Re,Le,Fe,dt,je,pt),_t=Re.text.indexOf("")>=0;let Et=0;for(let yt=0;yt<Re.length();yt++){const Je=Re.getSection(yt),Ze=Re.getCodePoint(yt);if(ox[Ze]||(Et+=eI(Ze,Je,dt,je,Le,pt)),yt<Re.length()-1){const At=!((lt=Ze)<11904||!(xr["Bopomofo Extended"](lt)||xr.Bopomofo(lt)||xr["CJK Compatibility Forms"](lt)||xr["CJK Compatibility Ideographs"](lt)||xr["CJK Compatibility"](lt)||xr["CJK Radicals Supplement"](lt)||xr["CJK Strokes"](lt)||xr["CJK Symbols and Punctuation"](lt)||xr["CJK Unified Ideographs Extension A"](lt)||xr["CJK Unified Ideographs"](lt)||xr["Enclosed CJK Letters and Months"](lt)||xr["Halfwidth and Fullwidth Forms"](lt)||xr.Hiragana(lt)||xr["Ideographic Description Characters"](lt)||xr["Kangxi Radicals"](lt)||xr["Katakana Phonetic Extensions"](lt)||xr.Katakana(lt)||xr["Vertical Forms"](lt)||xr["Yi Radicals"](lt)||xr["Yi Syllables"](lt)));(BF[Ze]||At||Je.image)&&wt.push(rI(yt+1,Et,mt,wt,jF(Ze,Re.getCodePoint(yt+1),At&&_t),!1))}}var lt;return iI(rI(Re.length(),Et,mt,wt,0,!0))}(Z,E,p,e,c,F),{processBidirectionalText:ce,processStyledBidirectionalText:de}=ka;if(ce&&Z.sections.length===1){const Re=ce(Z.toString(),le);for(const Le of Re){const Fe=new pp;Fe.text=Le,Fe.sections=Z.sections;for(let dt=0;dt<Le.length;dt++)Fe.sectionIndex.push(0);X.push(Fe)}}else if(de){const Re=de(Z.text,Z.sectionIndex,le);for(const Le of Re){const Fe=new pp;Fe.text=Le[0],Fe.sectionIndex=Le[1],Fe.sections=Z.sections,X.push(Fe)}}else X=function(Re,Le){const Fe=[],dt=Re.text;let je=0;for(const pt of Le)Fe.push(Re.substring(je,pt)),je=pt;return je<dt.length&&Fe.push(Re.substring(je,dt.length)),Fe}(Z,le);const Ie=[],Ce={positionedLines:Ie,text:Z.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Re,Le,Fe,dt,je,pt,wt,mt,_t,Et,lt,yt){let Je=0,Ze=0,At=0;const Tt=mt==="right"?1:mt==="left"?0:.5;let hr=!1;for(const Nt of je){const rr=Nt.getSections();for(const Tr of rr){if(Tr.image)continue;const Lr=Le[Tr.fontStack];if(Lr&&(hr=Lr.ascender!==void 0&&Lr.descender!==void 0,!hr))break}if(!hr)break}let Gt=0;for(const Nt of je){Nt.trim();const rr=Nt.getMaxScale(),Tr=(rr-1)*rs,Lr={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Gt]=Lr;const qr=Lr.positionedGlyphs;let Nr=0;if(!Nt.length()){Ze+=pt,++Gt;continue}let Yt=0,Fr=0;for(let ye=0;ye<Nt.length();ye++){const xe=Nt.getSection(ye),Ke=Nt.getSectionIndex(ye),ut=Nt.getCodePoint(ye);let Ft=xe.scale,Lt=null,qt=null,pr=null,Zr=rs,Kr=0,Wr=_t;Wr===Po.vertical&&((Jt=ut)===12312||Jt===12313||Jt===12316||Jt===12540||Jt===12448)&&(Wr=Po.horizontal);const wi=!(Wr===Po.horizontal||!lt&&!jf(ut)||lt&&(ox[ut]||aw(ut)));if(xe.image){const qi=dt.get(xe.image.toString());if(!qi)continue;pr=xe.image,Re.iconsInText=Re.iconsInText||!0,qt=qi.paddedRect;const Hr=qi.displaySize;Ft=Ft*rs/yt,Lt={width:Hr[0],height:Hr[1],left:0,top:-QA,advance:wi?Hr[1]:Hr[0],localGlyph:!1},Kr=hr?-Lt.height*Ft:rr*rs-17-Hr[1]*Ft,Zr=Lt.advance;const Oi=(wi?Hr[0]:Hr[1])*Ft-rs*rr;Oi>0&&Oi>Nr&&(Nr=Oi)}else{const qi=Fe[xe.fontStack];if(!qi)continue;qi[ut]&&(qt=qi[ut]);const Hr=Le[xe.fontStack];if(!Hr)continue;const Oi=Hr.glyphs[ut];if(!Oi)continue;if(Lt=Oi.metrics,Zr=ut!==8203?rs:0,hr){const Si=Hr.ascender!==void 0?Math.abs(Hr.ascender):0,ui=Hr.descender!==void 0?Math.abs(Hr.descender):0,Ni=(Si+ui)*Ft;Yt<Ni&&(Yt=Ni,Fr=(Si-ui)/2*Ft),Kr=-Si*Ft}else Kr=(rr-Ft)*rs-17}wi?(Re.verticalizable=!0,qr.push({glyph:ut,image:pr,x:Je,y:Ze+Kr,vertical:wi,scale:Ft,localGlyph:Lt.localGlyph,fontStack:xe.fontStack,sectionIndex:Ke,metrics:Lt,rect:qt}),Je+=Zr*Ft+Et):(qr.push({glyph:ut,image:pr,x:Je,y:Ze+Kr,vertical:wi,scale:Ft,localGlyph:Lt.localGlyph,fontStack:xe.fontStack,sectionIndex:Ke,metrics:Lt,rect:qt}),Je+=Lt.advance*Ft+Et)}qr.length!==0&&(At=Math.max(Je-Et,At),hr?nI(qr,Tt,Nr,Fr,pt*rr/2):nI(qr,Tt,Nr,0,pt/2)),Je=0;const ni=pt*rr+Nr;Lr.lineOffset=Math.max(Nr,Tr),Ze+=ni,++Gt}var Jt;const Rt=Ze,{horizontalAlign:cr,verticalAlign:Mr}=ab(wt);(function(Nt,rr,Tr,Lr,qr,Nr){const Yt=(rr-Tr)*qr,Fr=-Nr*Lr;for(const ni of Nt)for(const ye of ni.positionedGlyphs)ye.x+=Yt,ye.y+=Fr})(Re.positionedLines,Tt,cr,Mr,At,Rt),Re.top+=-Mr*Rt,Re.bottom=Re.top+Rt,Re.left+=-cr*At,Re.right=Re.left+At,Re.hasBaseline=hr}(Ce,e,n,c,X,g,x,b,C,E,k,N),!function(Re){for(const Le of Re)if(Le.positionedGlyphs.length!==0)return!1;return!0}(Ie))return Ce}const ox={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},BF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eI(o,e,n,c,h,p){if(e.image){const g=c.get(e.image.toString());return g?g.displaySize[0]*e.scale*rs/p+h:0}{const g=n[e.fontStack],x=g&&g.glyphs[o];return x?x.metrics.advance*e.scale+h:0}}function tI(o,e,n,c){const h=Math.pow(o-e,2);return c?o<e?h/2:2*h:h+Math.abs(n)*n}function jF(o,e,n){let c=0;return o===10&&(c-=1e4),n&&(c+=150),o!==40&&o!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function rI(o,e,n,c,h,p){let g=null,x=tI(e,n,h,p);for(const b of c){const E=tI(e-b.x,n,h,p)+b.badness;E<=x&&(g=b,x=E)}return{index:o,x:e,priorBreak:g,badness:x}}function iI(o){return o?iI(o.priorBreak).concat(o.index):[]}function ab(o){let e=.5,n=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function nI(o,e,n,c,h){if(!(e||n||c||h))return;const p=o.length-1,g=o[p],x=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=p;b++)o[b].x-=x,o[b].y+=n+c+h}function sI(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function UF(o,e,n,c){const{horizontalAlign:h,verticalAlign:p}=ab(c),g=n[0]-o.displaySize[0]*h,x=n[1]-o.displaySize[1]*p;return{imagePrimary:o,imageSecondary:e,top:x,bottom:x+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function oI(o,e,n,c,h,p){const g=o.imagePrimary;let x;if(g.content){const Z=g.content,X=g.pixelRatio||1;x=[Z[0]/X,Z[1]/X,g.displaySize[0]-Z[2]/X,g.displaySize[1]-Z[3]/X]}const b=e.left*p,E=e.right*p;let I,C,k,F;n==="width"||n==="both"?(F=h[0]+b-c[3],C=h[0]+E+c[1]):(F=h[0]+(b+E-g.displaySize[0])/2,C=F+g.displaySize[0]);const N=e.top*p,W=e.bottom*p;return n==="height"||n==="both"?(I=h[1]+N-c[0],k=h[1]+W+c[2]):(I=h[1]+(N+W-g.displaySize[1])/2,k=I+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:I,right:C,bottom:k,left:F,collisionPadding:x}}function aI(o){return!o.imagePrimary.stretchX}function lI(o){return!o.imagePrimary.stretchY}function cI(o){return{width:o.right-o.left,height:o.bottom-o.top}}const Zl=128;function uI(o,e,n){const{expression:c}=e;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Di(o+1,{worldview:n}))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=c;let g=0;for(;g<h.length&&h[g]<=o;)g++;g=Math.max(0,g-1);let x=g;for(;x<h.length&&h[x]<o+1;)x++;x=Math.min(h.length-1,x);const b=h[g],E=h[x];return c.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:E,minSize:c.evaluate(new Di(b,{worldview:n})),maxSize:c.evaluate(new Di(E,{worldview:n})),interpolationType:p}}}function lb(o,{uSize:e,uSizeT:n},{lowerSize:c,upperSize:h}){return o.kind==="source"?c/Zl:o.kind==="composite"?wr(c/Zl,h/Zl,n):e}function eg(o,e,n=1){let c=0,h=0;if(o.kind==="constant")h=o.layoutSize*n;else if(o.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:x}=o,b=p?U(So.interpolationFactor(p,e,g,x),0,1):0;o.kind==="camera"?h=wr(o.minSize,o.maxSize,b)*n:c=b*n}return{uSizeT:c,uSize:h}}class Oc extends bt{constructor(e,n,c,h,p){super(e,n),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new Oc(this.x,this.y,this.z,this.angle,this.segment)}}function hI(o,e,n,c,h){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=o[g].dist(p),p=o[g]}x+=o[g].dist(o[g+1]),g++;const b=[];let E=0;for(;x<n/2;){const I=o[g],C=o[g+1];if(!C)return!1;let k=o[g-1].angleTo(I)-I.angleTo(C);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:k}),E+=k;x-b[0].distance>c;)E-=b.shift().angleDelta;if(E>h)return!1;g++,x+=I.dist(C)}return!0}function dI(o){let e=0;for(let n=0;n<o.length-1;n++)e+=o[n].dist(o[n+1]);return e}function fI(o,e,n){return o?.6*e*n:0}function pI(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function VF(o,e,n,c,h,p){const g=fI(n,h,p),x=pI(n,c)*p;let b=0;const E=dI(o)/2;for(let I=0;I<o.length-1;I++){const C=o[I],k=o[I+1],F=C.dist(k);if(b+F>E){const N=(E-b)/F,W=wr(C.x,k.x,N),Z=wr(C.y,k.y,N),X=new Oc(W,Z,0,k.angleTo(C),I);return!g||hI(o,X,x,g,e)?X:void 0}b+=F}}function $F(o,e,n,c,h,p,g,x,b){const E=fI(c,p,g),I=pI(c,h),C=I*g,k=o[0].x===0||o[0].x===b||o[0].y===0||o[0].y===b;return e-C<e/4&&(e=C+e/4),mI(o,k?e/2*x%e:(I/2+2*p)*g*x%e,e,E,n,C,k,!1,b)}function mI(o,e,n,c,h,p,g,x,b){const E=p/2,I=dI(o);let C=0,k=e-n,F=[];for(let N=0;N<o.length-1;N++){const W=o[N],Z=o[N+1],X=W.dist(Z),le=Z.angleTo(W);for(;k+n<C+X;){k+=n;const ce=(k-C)/X,de=wr(W.x,Z.x,ce),Ie=wr(W.y,Z.y,ce);if(de>=0&&de<b&&Ie>=0&&Ie<b&&k-E>=0&&k+E<=I){const Ce=new Oc(de,Ie,0,le,N);c&&!hI(o,Ce,p,c,h)||F.push(Ce)}}C+=X}return x||F.length||g||(F=mI(o,C/2,n,c,h,p,g,!0,b)),F}function gI(o){let e=0,n=0;for(const g of o)e+=g.w*g.h,n=Math.max(n,g.w);o.sort((g,x)=>x.h-g.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,p=0;for(const g of o)for(let x=c.length-1;x>=0;x--){const b=c[x];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){const E=c.pop();E&&x<c.length&&(c[x]=E)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(c.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}Wt(Oc,"Anchor");const dd=1;class tg{static getImagePositionScale(e,n,c){if(n&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:c,y:c}}constructor(e,n,c,h){this.paddedRect=e;const{pixelRatio:p,version:g,stretchX:x,stretchY:b,content:E,sdf:I,usvg:C}=n;this.pixelRatio=p,this.stretchX=x,this.stretchY=b,this.content=E,this.version=g,this.padding=c,this.sdf=I,this.usvg=C,this.scale=tg.getImagePositionScale(h,C,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function cb(o,e,n){const c=sa.parse(o),h=function(p,g,x=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*x[0])+2*g,h:(p.data?p.data.height:p.height*x[1])+2*g}}(e,n,[c.options.transform.a,c.options.transform.d]);return{bin:h,imagePosition:new tg(h,e,n,c),imageVariant:c}}class _I{constructor(e,n,c){const h=new Map,p=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,h,dd,g),this.addImages(n,p,2,g);const{w:x,h:b}=gI(g),E=new ds({width:x||1,height:b||1});for(const[I,C]of e.entries()){const k=h.get(I).paddedRect;ds.copy(C.data,E,{x:0,y:0},{x:k.x+dd,y:k.y+dd},C.data,null,C.sdf)}for(const[I,C]of n.entries()){const k=p.get(I),F=k.paddedRect;let N=k.padding;const W=F.x+N,Z=F.y+N,X=C.data.width,le=C.data.height;N=N>1?N-1:N,ds.copy(C.data,E,{x:0,y:0},{x:W,y:Z},C.data,c),ds.copy(C.data,E,{x:0,y:le-N},{x:W,y:Z-N},{width:X,height:N},c),ds.copy(C.data,E,{x:0,y:0},{x:W,y:Z+le},{width:X,height:N},c),ds.copy(C.data,E,{x:X-N,y:0},{x:W-N,y:Z},{width:N,height:le},c),ds.copy(C.data,E,{x:0,y:0},{x:W+X,y:Z},{width:N,height:le},c),ds.copy(C.data,E,{x:X-N,y:le-N},{x:W-N,y:Z-N},{width:N,height:N},c),ds.copy(C.data,E,{x:0,y:le-N},{x:W+X,y:Z-N},{width:N,height:N},c),ds.copy(C.data,E,{x:0,y:0},{x:W+X,y:Z+le},{width:N,height:N},c),ds.copy(C.data,E,{x:X-N,y:0},{x:W-N,y:Z+le},{width:N,height:N},c)}this.lut=c,this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(e,n,c,h){for(const[p,g]of e.entries()){const{bin:x,imagePosition:b,imageVariant:E}=cb(p,g,c);n.set(p,b),h.push(x),g.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(e,n,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const h of e.getUpdatedImages(c)){for(const p of this.iconPositions.keys()){const g=sa.parse(p);if(wo.isEqual(g.id,h)){const x=e.getImage(h,c);this.patchUpdatedImage(this.iconPositions.get(p),x,n,null)}}for(const p of this.patternPositions.keys()){const g=sa.parse(p);if(wo.isEqual(g.id,h)){const x=e.getImage(h,c);this.patchUpdatedImage(this.patternPositions.get(p),x,n,this.lut)}}}}patchUpdatedImage(e,n,c,h=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,g]=e.tl,x=e.sdf;if(this.lut||x){const b={width:n.data.width,height:n.data.height},E=new ds(b);ds.copy(n.data,E,{x:0,y:0},{x:0,y:0},b,h,x),c.update(E,{position:{x:p,y:g}})}else c.update(n.data,{position:{x:p,y:g}})}}Wt(tg,"ImagePosition"),Wt(_I,"ImageAtlas");const rg=1e20;function yI(o,e,n,c,h,p,g,x,b){for(let E=e;E<e+c;E++)xI(o,n*p+E,p,h,g,x,b);for(let E=n;E<n+h;E++)xI(o,E*p+e,1,c,g,x,b)}function xI(o,e,n,c,h,p,g){p[0]=0,g[0]=-rg,g[1]=rg,h[0]=o[e];for(let x=1,b=0,E=0;x<c;x++){h[x]=o[e+x*n];const I=x*x;do{const C=p[b];E=(h[x]-h[C]+I-C*C)/(x-C)/2}while(E<=g[b]&&--b>-1);b++,p[b]=x,g[b]=E,g[b+1]=rg}for(let x=0,b=0;x<c;x++){for(;g[b+1]<x;)b++;const E=p[b],I=x-E;o[e+x*n]=h[E]+I*I}}const nl=2,ub={none:0,ideographs:1,all:2};class mp{constructor(e,n,c){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const c=[],h=this.url||ws.GLYPHS_URL;for(const p in e)for(const g of e[p])c.push({stack:p,id:g});ne(c,({stack:p,id:g},x)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[g];if(E!==void 0)return void x(null,{stack:p,id:g,glyph:E});if(E=this._tinySDF(b,p,g),E)return b.glyphs[g]=E,void x(null,{stack:p,id:g,glyph:E});const I=Math.floor(g/256);if(256*I>65535)return $t("glyphs > 65535 not supported"),void x(null,{stack:p,id:g,glyph:E});if(b.ranges[I])return void x(null,{stack:p,id:g,glyph:E});let C=b.requests[I];C||(C=b.requests[I]=[],mp.loadGlyphRange(p,I,h,this.requestManager,(k,F)=>{if(F){b.ascender=F.ascender,b.descender=F.descender;for(const N in F.glyphs)this._doesCharSupportLocalGlyph(+N)||(b.glyphs[+N]=F.glyphs[+N]);b.ranges[I]=!0}for(const N of C)N(k,F);delete b.requests[I]})),C.push((k,F)=>{k?x(k):F&&x(null,{stack:p,id:g,glyph:F.glyphs[g]||null})})},(p,g)=>{if(p)n(p);else if(g){const x={};for(const{stack:b,id:E,glyph:I}of g)x[b]===void 0&&(x[b]={}),x[b].glyphs===void 0&&(x[b].glyphs={}),x[b].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[b].ascender=this.entries[b].ascender,x[b].descender=this.entries[b].descender;n(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ub.none&&(this.localGlyphMode===ub.all?!!this.localFontFamily:!!this.localFontFamily&&(xr["CJK Unified Ideographs"](e)||xr["Hangul Syllables"](e)||xr.Hiragana(e)||xr.Katakana(e)||xr["CJK Symbols and Punctuation"](e)||xr["CJK Unified Ideographs Extension A"](e)||xr["CJK Unified Ideographs Extension B"](e)||xr.Osage(e)))}_tinySDF(e,n,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=e.tinySDF;if(!p){let W="400";/bold/i.test(n)?W="900":/medium/i.test(n)?W="500":/light/i.test(n)&&(W="200"),p=e.tinySDF=new mp.TinySDF({fontFamily:h,fontWeight:W,fontSize:24*nl,buffer:3*nl,radius:8*nl}),p.fontWeight=W}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const g=String.fromCodePoint(c),{data:x,width:b,height:E,glyphWidth:I,glyphHeight:C,glyphLeft:k,glyphTop:F,glyphAdvance:N}=p.draw(g);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new Nu({width:b,height:E},x),metrics:{width:I/nl,height:C/nl,left:k/nl,top:F/nl-27,advance:N/nl,localGlyph:!0}}}}mp.loadGlyphRange=function(o,e,n,c,h){const p=256*e,g=p+255,x=c.transformRequest(c.normalizeGlyphsURL(n).replace("{fontstack}",o).replace("{range}",`${p}-${g}`),Xd.Glyphs);ou(x,(b,E)=>{if(b)h(b);else if(E){const I={},C=function(k){return new sx(k).readFields(FF,{})}(E);for(const k of C.glyphs)I[k.id]=k;h(null,{glyphs:I,ascender:C.ascender,descender:C.descender})}})},mp.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:n=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal",lang:x=null}={}){this.buffer=e,this.cutoff=c,this.radius=n,this.lang=x;const b=this.size=o+4*e,E=this._createCanvas(b),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${g} ${p} ${o}px ${h}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(o),g=Math.ceil(n),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),b=Math.min(this.size-this.buffer,g+Math.ceil(c)),E=x+2*this.buffer,I=b+2*this.buffer,C=Math.max(E*I,0),k=new Uint8ClampedArray(C),F={data:k,width:E,height:I,glyphWidth:x,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(x===0||b===0)return F;const{ctx:N,buffer:W,gridInner:Z,gridOuter:X}=this;this.lang&&(N.lang=this.lang),N.clearRect(W,W,x,b),N.fillText(o,W,W+g);const le=N.getImageData(W,W,x,b);X.fill(rg,0,C),Z.fill(0,0,C);for(let ce=0;ce<b;ce++)for(let de=0;de<x;de++){const Ie=le.data[4*(ce*x+de)+3]/255;if(Ie===0)continue;const Ce=(ce+W)*E+de+W;if(Ie===1)X[Ce]=0,Z[Ce]=rg;else{const Re=.5-Ie;X[Ce]=Re>0?Re*Re:0,Z[Ce]=Re<0?Re*Re:0}}yI(X,0,0,E,I,E,this.f,this.v,this.z),yI(Z,W,W,x,b,E,this.f,this.v,this.z);for(let ce=0;ce<C;ce++){const de=Math.sqrt(X[ce])-Math.sqrt(Z[ce]);k[ce]=Math.round(255-255*(de/this.radius+this.cutoff))}return F}};const ju=dd;function vI(o,e){return o+e[1]-e[0]}function wI(o,e,n,c,h=1){const p=[],g=o.imagePrimary,x=g.pixelRatio,b=g.paddedRect.w-2*ju,E=g.paddedRect.h-2*ju,I=(o.right-o.left)*h,C=(o.bottom-o.top)*h,k=g.stretchX||[[0,b]],F=g.stretchY||[[0,E]],N=k.reduce(vI,0),W=F.reduce(vI,0),Z=b-N,X=E-W;let le=0,ce=N,de=0,Ie=W,Ce=0,Re=Z,Le=0,Fe=X;if(g.content&&c){const je=g.content;le=ax(k,0,je[0]),de=ax(F,0,je[1]),ce=ax(k,je[0],je[2]),Ie=ax(F,je[1],je[3]),Ce=je[0]-le,Le=je[1]-de,Re=je[2]-je[0]-ce,Fe=je[3]-je[1]-Ie}const dt=(je,pt,wt,mt)=>{const _t=lx(je.stretch-le,ce,I,o.left*h),Et=cx(je.fixed-Ce,Re,je.stretch,N),lt=lx(pt.stretch-de,Ie,C,o.top*h),yt=cx(pt.fixed-Le,Fe,pt.stretch,W),Je=lx(wt.stretch-le,ce,I,o.left*h),Ze=cx(wt.fixed-Ce,Re,wt.stretch,N),At=lx(mt.stretch-de,Ie,C,o.top*h),Tt=cx(mt.fixed-Le,Fe,mt.stretch,W),hr=new bt(_t,lt),Gt=new bt(Je,lt),Jt=new bt(Je,At),Rt=new bt(_t,At),cr=new bt(Et/x,yt/x),Mr=new bt(Ze/x,Tt/x),Nt=e*Math.PI/180;if(Nt){const Yt=Math.sin(Nt),Fr=Math.cos(Nt),ni=[Fr,-Yt,Yt,Fr];hr._matMult(ni),Gt._matMult(ni),Rt._matMult(ni),Jt._matMult(ni)}const rr=je.stretch+je.fixed,Tr=wt.stretch+wt.fixed,Lr=pt.stretch+pt.fixed,qr=mt.stretch+mt.fixed,Nr=o.imageSecondary;return{tl:hr,tr:Gt,bl:Rt,br:Jt,texPrimary:{x:g.paddedRect.x+ju+rr,y:g.paddedRect.y+ju+Lr,w:Tr-rr,h:qr-Lr},texSecondary:Nr?{x:Nr.paddedRect.x+ju+rr,y:Nr.paddedRect.y+ju+Lr,w:Tr-rr,h:qr-Lr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:Mr,minFontScaleX:Re/x/I,minFontScaleY:Fe/x/C,isSDF:n}};if(c&&(g.stretchX||g.stretchY)){const je=bI(k,Z,N),pt=bI(F,X,W);for(let wt=0;wt<je.length-1;wt++){const mt=je[wt],_t=je[wt+1];for(let Et=0;Et<pt.length-1;Et++)p.push(dt(mt,pt[Et],_t,pt[Et+1]))}}else p.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return p}function ax(o,e,n){let c=0;for(const h of o)c+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return c}function bI(o,e,n){const c=[{fixed:-ju,stretch:0}];for(const[h,p]of o){const g=c[c.length-1];c.push({fixed:h-g.stretch,stretch:g.stretch}),c.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return c.push({fixed:e+ju,stretch:n}),c}function lx(o,e,n,c){return o/e*n+c}function cx(o,e,n,c){return o-e*n/c}function GF(o,e,n,c){const h=e+o.positionedLines[c].lineOffset;return c===0?n+h/2:n+(h+(e+o.positionedLines[c-1].lineOffset))/2}function HF(o,e=1,n=!1){let c=1/0,h=1/0,p=-1/0,g=-1/0;const x=o[0];for(let F=0;F<x.length;F++){const N=x[F];(!F||N.x<c)&&(c=N.x),(!F||N.y<h)&&(h=N.y),(!F||N.x>p)&&(p=N.x),(!F||N.y>g)&&(g=N.y)}const b=Math.min(p-c,g-h);let E=b/2;const I=new pf([],WF);if(b===0)return new bt(c,h);for(let F=c;F<p;F+=b)for(let N=h;N<g;N+=b)I.push(new gp(F+E,N+E,E,o));let C=function(F){let N=0,W=0,Z=0;const X=F[0];for(let le=0,ce=X.length,de=ce-1;le<ce;de=le++){const Ie=X[le],Ce=X[de],Re=Ie.x*Ce.y-Ce.x*Ie.y;W+=(Ie.x+Ce.x)*Re,Z+=(Ie.y+Ce.y)*Re,N+=3*Re}return new gp(W/N,Z/N,0,F)}(o),k=I.length;for(;I.length;){const F=I.pop();(F.d>C.d||!C.d)&&(C=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-C.d<=e||(E=F.h/2,I.push(new gp(F.p.x-E,F.p.y-E,E,o)),I.push(new gp(F.p.x+E,F.p.y-E,E,o)),I.push(new gp(F.p.x-E,F.p.y+E,E,o)),I.push(new gp(F.p.x+E,F.p.y+E,E,o)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${C.d}`)),C.p}function WF(o,e){return e.max-o.max}class gp{constructor(e,n,c,h){this.p=new bt(e,n),this.h=c,this.d=function(p,g){let x=!1,b=1/0;for(let E=0;E<g.length;E++){const I=g[E];for(let C=0,k=I.length,F=k-1;C<k;F=C++){const N=I[C],W=I[F];N.y>p.y!=W.y>p.y&&p.x<(W.x-N.x)*(p.y-N.y)/(W.y-N.y)+N.x&&(x=!x),b=Math.min(b,Yi(p,N,W))}}return(x?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const qF=Object.keys,hb=Number.POSITIVE_INFINITY,ZF=Math.sqrt(2);function TI(o,[e,n]){let c=0,h=0;if(n===hb){e<0&&(e=0);const p=e/ZF;switch(o){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(o){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),o){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(o){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,h]}function ux(o,e,n,c,h,p,g,x,b){if(!e||!e.usvg)return;const E=cI(c),I=cI(h),C=p!=="both"&&p!=="width"||!aI(c)?1:I.width/E.width,k=p!=="both"&&p!=="height"||!lI(c)?1:I.height/E.height;n.scaleSelf(C,k);const F=n.toString();g.set(F,n),x.set(F,e);const{imagePosition:N}=cb(F,e,dd);b.set(F,N)}function SI(o,e,n,c,h,p,g,x,b){if(!o)return;const E=function(I,C,k,F,N,W){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const Z=C.possiblyEvaluate(new Di(I.maxZoom,{worldview:W}),k).evaluate(N,{},k),X=C.possiblyEvaluate(new Di(I.minZoom,{worldview:W}),k).evaluate(N,{},k);return Math.max(Z,X)}return C.possiblyEvaluate(new Di(F,{worldview:W})).evaluate(N,{},k)}(e,n,c,h,p,b);return o.scaleSelf(E*x*g)}function EI(o,e,n,c,h,p,g,x,b){return{iconPrimary:SI(o.getPrimary(),e,n,c,h,p,g,x,b),iconSecondary:SI(o.getSecondary(),e,n,c,h,p,g,x,b)}}function XF(o,e,n){if(!e)return;const c=n.get(o.toString()),h=n.get(e.toString());c&&h&&(c.paddedRect.w===h.paddedRect.w&&c.paddedRect.h===h.paddedRect.h||$t(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),c.usvg!==h.usvg&&$t(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function AI(o,e,n,c){if(!o)return;const h=e.get(n.toString());if(o.imagePrimary=h,c){const p=e.get(c.toString());o.imageSecondary=p}}function KF(o,e){for(const n in o.horizontal)II(o.horizontal[n],e);II(o.vertical,e)}function II(o,e){if(o){for(const n of o.positionedLines)for(const c of n.positionedGlyphs)if(c.image!==null){const h=c.image.toString();c.rect=e.get(h).paddedRect}}}function db(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function YF(o,e,n,c,h,p,g,x,b){const E=fb(p.horizontal)||p.vertical,I=n.get("icon-text-fit-padding").evaluate(c,{},h);let C,k=e;return e&&b!=="none"&&(o.allowVerticalPlacement&&p.vertical&&(C=oI(e,p.vertical,b,I,x,g)),E&&(k=oI(e,E,b,I,x,g))),{defaultShapedIcon:k,verticallyShapedIcon:C}}function JF(o,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X,le,ce){let de=g.textMaxSize.evaluate(e,{},k);de===void 0?de=x*g.textScaleFactor:de*=g.textScaleFactor;const Ie=o.layers[0].layout,Ce=fb(n.horizontal)||n.vertical,Re=F.name==="globe",Le=rs,Fe=o.tilePixelRatio*de/Le,dt=(Et=o.overscaling,o.zoom>18&&Et>2&&(Et>>=1),Math.max(Dt/(512*Et),1)*Ie.get("symbol-spacing")),je=Ie.get("text-padding")*o.tilePixelRatio,pt=Ie.get("icon-padding")*o.tilePixelRatio,wt=ze(Ie.get("text-max-angle")),mt=Ie.get("icon-rotation-alignment")==="map"&&ce!=="point",_t=dt/2;var Et;o.hasAnyIconTextFit===!1&&Z!=="none"&&(o.hasAnyIconTextFit=!0);const lt=e.properties?+e.properties[$r]:null,yt=lt&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(lt):65535,Je=(Ze,At,Tt)=>{if(At.x<0||At.x>=Dt||At.y<0||At.y>=Dt)return;let hr=null;if(Re){const{x:Gt,y:Jt,z:Rt}=F.projectTilePoint(At.x,At.y,Tt);hr={anchor:new Oc(Gt,Jt,Rt,0,void 0),up:F.upVector(Tt,At.x,At.y)}}(function(Gt,Jt,Rt,cr,Mr,Nt,rr,Tr,Lr,qr,Nr,Yt,Fr,ni,ye,xe,Ke,ut,Ft,Lt,qt,pr,Zr,Kr,Wr,wi,qi,Hr,Oi){const Si=Gt.addToLineVertexArray(Jt,cr);let ui,Ni,zi,Mi,Li,Ei,Yr,Ii=0,tn=0,Ar=0,ai=0,Bi=-1,sn=-1;const $i={};let Rn=Qd("");const ki=Rt?Rt.anchor:Jt,En=Hr!=="none";let oo=0,fs=0;if(Lr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Mn=Lr.layout.get("text-offset").evaluate(qt,{},Wr);oo=Mn[0]*rs,fs=Mn[1]*rs}else oo=Lr.layout.get("text-radial-offset").evaluate(qt,{},Wr)*rs,fs=hb;if(Gt.allowVerticalPlacement&&Mr.vertical){const Mn=Mr.vertical;if(ye)Ei=pb(Mn),Tr&&(Yr=pb(Tr));else{const qn=Lr.layout.get("text-rotate").evaluate(qt,{},Wr)+90;zi=hx(qr,ki,Jt,Nr,Yt,Fr,Mn,ni,qn,xe),Tr&&(Mi=hx(qr,ki,Jt,Nr,Yt,Fr,Tr,ut,qn))}}if(Nt){const Mn=Gt.iconSizeData,qn=Lr.layout.get("icon-rotate").evaluate(qt,{},Wr),ps=wI(Nt,qn,Zr,En,pr.iconScaleFactor),Ns=Tr?wI(Tr,qn,Zr,En,pr.iconScaleFactor):void 0;Ni=hx(qr,ki,Jt,Nr,Yt,Fr,Nt,ut,qn,null),Ii=4*ps.length;let Ss=null;Mn.kind==="source"?(Ss=[Zl*Lr.layout.get("icon-size").evaluate(qt,{},Wr)*pr.iconScaleFactor],Ss[0]>Uu&&$t(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${ig}. Reduce your "icon-size".`)):Mn.kind==="composite"&&(Ss=[Zl*pr.compositeIconSizes[0].evaluate(qt,{},Wr)*pr.iconScaleFactor,Zl*pr.compositeIconSizes[1].evaluate(qt,{},Wr)*pr.iconScaleFactor],(Ss[0]>Uu||Ss[1]>Uu)&&$t(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${ig}. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,ps,Ss,Lt,Ft,qt,void 0,Rt,Jt,Si.lineStartIndex,Si.lineLength,-1,Kr,Wr,wi,qi),Bi=Gt.icon.placedSymbolArray.length-1,Ns&&(tn=4*Ns.length,Gt.addSymbols(Gt.icon,Ns,Ss,Lt,Ft,qt,Po.vertical,Rt,Jt,Si.lineStartIndex,Si.lineLength,-1,Kr,Wr,wi,qi),sn=Gt.icon.placedSymbolArray.length-1)}for(const Mn in Mr.horizontal){const qn=Mn,ps=Mr.horizontal[qn];ui||(Rn=Qd(ps.text),ye?Li=pb(ps):ui=hx(qr,ki,Jt,Nr,Yt,Fr,ps,ni,Lr.layout.get("text-rotate").evaluate(qt,{},Wr),xe));const Ns=ps.positionedLines.length===1;if(Ar+=CI(Gt,Rt,Jt,ps,rr,Lr,ye,qt,xe,Si,Mr.vertical?Po.horizontal:Po.horizontalOnly,Ns?qF(Mr.horizontal):[qn],$i,Bi,pr,Kr,Wr,wi),Ns)break}Mr.vertical&&(ai+=CI(Gt,Rt,Jt,Mr.vertical,rr,Lr,ye,qt,xe,Si,Po.vertical,["vertical"],$i,sn,pr,Kr,Wr,wi));let cs=-1;const ao=(Mn,qn)=>Mn?Math.max(Mn,qn):qn;cs=ao(Li,cs),cs=ao(Ei,cs),cs=ao(Yr,cs);const Xl=cs>-1?1:0;Gt.glyphOffsetArray.length>=65535&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qt.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,qt.sortKey),Gt.symbolInstances.emplaceBack(Jt.x,Jt.y,ki.x,ki.y,ki.z,$i.right>=0?$i.right:-1,$i.center>=0?$i.center:-1,$i.left>=0?$i.left:-1,$i.vertical>=0?$i.vertical:-1,Bi,sn,Rn,ui!==void 0?ui:Gt.collisionBoxArray.length,ui!==void 0?ui+1:Gt.collisionBoxArray.length,zi!==void 0?zi:Gt.collisionBoxArray.length,zi!==void 0?zi+1:Gt.collisionBoxArray.length,Ni!==void 0?Ni:Gt.collisionBoxArray.length,Ni!==void 0?Ni+1:Gt.collisionBoxArray.length,Mi||Gt.collisionBoxArray.length,Mi?Mi+1:Gt.collisionBoxArray.length,Nr,Ar,ai,Ii,tn,Xl,0,oo,fs,cs,0,En?1:0,Oi)})(o,At,hr,Ze,n,c,p,h,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,je,le,E,0,pt,mt,X,e,g,I,C,k,N,W,Z,yt)};if(ce==="line")for(const Ze of Yy(e.geometry,0,0,Dt,Dt)){const At=$F(Ze,dt,wt,n.vertical||Ce,c,Le,Fe,o.overscaling,Dt);for(const Tt of At)Ce&&QF(o,Ce.text,_t,Tt)||Je(Ze,Tt,k)}else if(ce==="line-center"){for(const Ze of e.geometry)if(Ze.length>1){const At=VF(Ze,wt,n.vertical||Ce,c,Le,Fe);At&&Je(Ze,At,k)}}else if(e.type==="Polygon")for(const Ze of B0(e.geometry,0)){const At=HF(Ze,16);Je(Ze[0],new Oc(At.x,At.y,0,0,void 0),k)}else if(e.type==="LineString")for(const Ze of e.geometry)Je(Ze,new Oc(Ze[0].x,Ze[0].y,0,0,void 0),k);else if(e.type==="Point")for(const Ze of e.geometry)for(const At of Ze)Je([At],new Oc(At.x,At.y,0,0,void 0),k)}const ig=255,Uu=ig*Zl;function CI(o,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z,X){const le=function(Ie,Ce,Re,Le,Fe,dt,je,pt){const wt=[];if(Ce.positionedLines.length===0)return wt;const mt=Le.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,_t=function(Ze){const At=Ze[0],Tt=Ze[1],hr=At*Tt;return hr>0?[At,-Tt]:hr<0?[-At,Tt]:At===0?[Tt,At]:[Tt,-At]}(Re);let Et=Math.abs(Ce.top-Ce.bottom);for(const Ze of Ce.positionedLines)Et-=Ze.lineOffset;const lt=Ce.positionedLines.length,yt=Et/lt;let Je=Ce.top-Re[1];for(let Ze=0;Ze<lt;++Ze){const At=Ce.positionedLines[Ze];Je=GF(Ce,yt,Je,Ze);for(const Tt of At.positionedGlyphs){if(!Tt.rect)continue;const hr=Tt.rect||{};let Gt=QA+1,Jt=!0,Rt=1,cr=0;if(Tt.image){const qt=je.get(Tt.image.toString());if(!qt)continue;if(qt.sdf){$t("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,Rt=qt.pixelRatio,Gt=dd/Rt}const Mr=(Fe||pt)&&Tt.vertical,Nt=Tt.metrics.advance*Tt.scale/2,rr=Tt.metrics,Tr=Tt.rect;if(Tr===null)continue;pt&&Ce.verticalizable&&(cr=Tt.image?Nt-Tt.metrics.width*Tt.scale/2:0);const Lr=Fe?[Tt.x+Nt,Tt.y]:[0,0];let qr=[0,0],Nr=[0,0],Yt=!1;Fe||(Mr?(Nr=[Tt.x+Nt+_t[0],Tt.y+_t[1]-cr],Yt=!0):qr=[Tt.x+Nt+Re[0],Tt.y+Re[1]-cr]);const Fr=Tr.w*Tt.scale/(Rt*(Tt.localGlyph?nl:1)),ni=Tr.h*Tt.scale/(Rt*(Tt.localGlyph?nl:1));let ye,xe,Ke,ut;if(Mr){const qt=Tt.y-Je,pr=new bt(-Nt,Nt-qt),Zr=-Math.PI/2,Kr=new bt(...Nr);ye=new bt(-Nt+qr[0],qr[1]),ye._rotateAround(Zr,pr)._add(Kr),ye.x+=-qt+Nt,ye.y-=(rr.left-Gt)*Tt.scale;const Wr=Tt.image?rr.advance*Tt.scale:rs*Tt.scale,wi=String.fromCodePoint(Tt.glyph);EF(wi)?ye.x+=(1-Gt)*Tt.scale:AF(wi)?ye.x+=Wr-rr.height*Tt.scale+(-Gt-1)*Tt.scale:ye.x+=Tt.image||rr.width+2*Gt===Tr.w&&rr.height+2*Gt===Tr.h?(Wr-ni)/2:(Wr-(rr.height+2*Gt)*Tt.scale)/2,xe=new bt(ye.x,ye.y-Fr),Ke=new bt(ye.x+ni,ye.y),ut=new bt(ye.x+ni,ye.y-Fr)}else{const qt=(rr.left-Gt)*Tt.scale-Nt+qr[0],pr=(-rr.top-Gt)*Tt.scale+qr[1],Zr=qt+Fr,Kr=pr+ni;ye=new bt(qt,pr),xe=new bt(Zr,pr),Ke=new bt(qt,Kr),ut=new bt(Zr,Kr)}if(mt){let qt;qt=Fe?new bt(0,0):Yt?new bt(_t[0],_t[1]):new bt(Re[0],Re[1]),ye._rotateAround(mt,qt),xe._rotateAround(mt,qt),Ke._rotateAround(mt,qt),ut._rotateAround(mt,qt)}const Ft=new bt(0,0),Lt=new bt(0,0);wt.push({tl:ye,tr:xe,bl:Ke,br:ut,texPrimary:hr,texSecondary:void 0,writingMode:Ce.writingMode,glyphOffset:Lr,sectionIndex:Tt.sectionIndex,isSDF:Jt,pixelOffsetTL:Ft,pixelOffsetBR:Lt,minFontScaleX:0,minFontScaleY:0})}}return wt}(0,c,b,p,g,x,h,o.allowVerticalPlacement),ce=o.textSizeData;let de=null;ce.kind==="source"?(de=[Zl*p.layout.get("text-size").evaluate(x,{},Z)*N.textScaleFactor],de[0]>Uu&&$t(`${o.layerIds[0]}: Value for "text-size" is >= ${ig}. Reduce your "text-size".`)):ce.kind==="composite"&&(de=[Zl*N.compositeTextSizes[0].evaluate(x,{},Z)*N.textScaleFactor,Zl*N.compositeTextSizes[1].evaluate(x,{},Z)*N.textScaleFactor],(de[0]>Uu||de[1]>Uu)&&$t(`${o.layerIds[0]}: Value for "text-size" is >= ${ig}. Reduce your "text-size".`)),o.addSymbols(o.text,le,de,b,g,x,I,e,n,E.lineStartIndex,E.lineLength,F,W,Z,X,!1);for(const Ie of C)k[Ie]=o.text.placedSymbolArray.length-1;return 4*le.length}function fb(o){for(const e in o)return o[e];return null}function hx(o,e,n,c,h,p,g,x,b,E){let I=g.top,C=g.bottom,k=g.left,F=g.right;if(sI(g)&&g.collisionPadding){const N=g.collisionPadding;k-=N[0],I-=N[1],F+=N[2],C+=N[3]}if(b){const N=new bt(k,I),W=new bt(F,I),Z=new bt(k,C),X=new bt(F,C),le=ze(b);let ce=new bt(0,0);E&&(ce=new bt(E[0],E[1])),N._rotateAround(le,ce),W._rotateAround(le,ce),Z._rotateAround(le,ce),X._rotateAround(le,ce),k=Math.min(N.x,W.x,Z.x,X.x),F=Math.max(N.x,W.x,Z.x,X.x),I=Math.min(N.y,W.y,Z.y,X.y),C=Math.max(N.y,W.y,Z.y,X.y)}return o.emplaceBack(e.x,e.y,e.z,n.x,n.y,k,I,F,C,x,c,h,p),o.length-1}function pb(o){sI(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function QF(o,e,n,c){const h=o.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(c.dist(p[g])<n)return!0}else h[e]=[];return h[e].push(c),!1}function PI(o,e){const n=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,h=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),p=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-o._pitch-n,.01));let g=Math.sin(o._pitch)*p+h;const x=h*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let b=Math.max(o.zoom-17,0);o.isOrthographic&&(b/=10),g*=1+b}return Math.min(1.01*g,x)}function ng(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const n=Math.pow(2,-o.z),c=o.x*n,h=(o.x+1)*n,p=o.y*n,g=(o.y+1)*n,x=Ee(c),b=Ee(h),E=Te(p),I=Te(g),C=e.project(x,E),k=e.project(b,E),F=e.project(b,I),N=e.project(x,I);let W=Math.min(C.x,k.x,F.x,N.x),Z=Math.min(C.y,k.y,F.y,N.y),X=Math.max(C.x,k.x,F.x,N.x),le=Math.max(C.y,k.y,F.y,N.y);const ce=n/16;function de(Ce,Re,Le,Fe,dt,je){const pt=(Le+dt)/2,wt=(Fe+je)/2,mt=e.project(Ee(pt),Te(wt)),_t=Math.max(0,W-mt.x,Z-mt.y,mt.x-X,mt.y-le);W=Math.min(W,mt.x),X=Math.max(X,mt.x),Z=Math.min(Z,mt.y),le=Math.max(le,mt.y),_t>ce&&(de(Ce,mt,Le,Fe,pt,wt),de(mt,Re,pt,wt,dt,je))}de(C,k,c,p,h,p),de(k,F,h,p,h,g),de(F,N,h,g,c,g),de(N,C,c,g,c,p),W-=ce,Z-=ce,X+=ce,le+=ce;const Ie=1/Math.max(X-W,le-Z);return{scale:Ie,x:W*Ie,y:Z*Ie,x2:X*Ie,y2:le*Ie,projection:e}}function kI(o,{x:e,y:n},c=0){return new bt(((e-c)*o.scale-o.x)*Dt,(n*o.scale-o.y)*Dt)}const e4=J(new Float32Array(16));class Vu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new G(0,0)}projectTilePoint(e,n,c){return{x:e,y:n,z:0}}locationPoint(e,n,c,h=!0){return e._coordinatePoint(e.locationCoordinate(n,c),h)}pixelsPerMeter(e,n){return be(1,e)*n}pixelSpaceConversion(e,n,c){return 1}farthestPixelDistance(e){return PI(e,e.pixelsPerMeter)}pointCoordinate(e,n,c,h){const p=e.horizonLineFromTop(!1),g=new bt(n,Math.max(p,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,n,c){const h=new bt(n,c);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const c=e.horizonLineFromTop();return n.y<c}createInversionMatrix(e,n){return e4}createTileMatrix(e,n,c){let h,p,g;const x=c.canonical,b=J(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=ng(x,this);h=1,p=E.x+c.wrap*E.scale,g=E.y,ie(b,b,[h/E.scale,h/E.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*c.wrap)*h,g=x.y*h;return ue(b,b,[p,g,0]),ie(b,b,[h/Dt,h/Dt,1]),b}upVector(e,n,c){return[0,0,1]}upVectorScale(e,n,c){return{metersToTile:1}}}class t4 extends Vu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,c]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(ze(n));this.n=(h+Math.sin(ze(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:c,c:h,r0:p}=this,g=ze(e-this.center[0]),x=ze(n),b=Math.sqrt(h-2*c*Math.sin(x))/c;return{x:b*Math.sin(g*c),y:b*Math.cos(g*c)-p,z:0}}unproject(e,n){const{n:c,c:h,r0:p}=this,g=p+n;let x=Math.atan2(e,Math.abs(g))*Math.sign(g);g*c<0&&(x-=Math.PI*Math.sign(e)*Math.sign(g));const b=ze(this.center[0])*c;x=Q(x,-Math.PI-b,Math.PI-b);const E=U(Y(x/c)+this.center[0],-180,180),I=Math.asin(U((h-(e*e+g*g)*c*c)/(2*c),-1,1)),C=U(Y(I),-Ae,Ae);return new G(E,C)}}const sg=1.340264,og=-.081106,ag=893e-6,lg=.003796,dx=Math.sqrt(3)/2;class r4 extends Vu{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(dx*Math.sin(n)),h=c*c,p=h*h*h;return{x:.5*(e*Math.cos(c)/(dx*(sg+3*og*h+p*(7*ag+9*lg*h)))/Math.PI+.5),y:1-.5*(c*(sg+og*h+p*(ag+lg*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,h=c*c,p=h*h*h;for(let I,C,k,F=0;F<12&&(C=c*(sg+og*h+p*(ag+lg*h))-n,k=sg+3*og*h+p*(7*ag+9*lg*h),I=C/k,c=U(c-I,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(I)<1e-12));++F);const g=dx*e*(sg+3*og*h+p*(7*ag+9*lg*h))/Math.cos(c),x=Math.asin(Math.sin(c)/dx),b=U(180*g/Math.PI,-180,180),E=U(180*x/Math.PI,-Ae,Ae);return new G(b,E)}}class i4 extends Vu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const c=360*(e-.5),h=U(360*(.5-n),-Ae,Ae);return new G(c,h)}}const _p=Math.PI/2;function fx(o){return Math.tan((_p+o)/2)}class n4 extends Vu{constructor(e){super(e),this.center=e.center||[0,30];const[n,c]=this.parallels=e.parallels||[30,30];let h=ze(n),p=ze(c);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),x=fx(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(fx(p)/x),this.f=g*Math.pow(fx(h),this.n)/this.n}project(e,n){n=ze(n),this.southernCenter&&(n=-n),e=ze(e-this.center[0]);const c=1e-6,{n:h,f:p}=this;p>0?n<-_p+c&&(n=-_p+c):n>_p-c&&(n=_p-c);const g=p/Math.pow(fx(n),h);let x=g*Math.sin(h*e),b=p-g*Math.cos(h*e);return x=.5*(x/Math.PI+.5),b=.5*(b/Math.PI+.5),{x,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:c,f:h}=this,p=h-n,g=Math.sign(p),x=Math.sign(c)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*g;p*c<0&&(b-=Math.PI*Math.sign(e)*g);const E=U(Y(b/c)+this.center[0],-180,180),I=U(Y(2*Math.atan(Math.pow(h/x,1/c))-_p),-Ae,Ae);return new G(E,this.southernCenter?-I:I)}}class RI extends Vu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ge(e),y:Se(n),z:0}}unproject(e,n){const c=Ee(e),h=Te(n);return new G(c,h)}}const MI=ze(Ae);class s4 extends Vu{project(e,n){const c=(n=ze(n))*n,h=c*c;return{x:.5*((e=ze(e))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,h=25,p=0,g=c*c;do{g=c*c;const E=g*g;p=(c*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-n)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),c=U(c-p,-MI,MI)}while(Math.abs(p)>1e-6&&--h>0);g=c*c;const x=U(Y(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=Y(c);return new G(x,b)}}const DI=ze(Ae);class o4 extends Vu{project(e,n){n=ze(n),e=ze(e);const c=Math.cos(n),h=2/Math.PI,p=Math.acos(c*Math.cos(e/2)),g=Math.sin(p)/p,x=.5*(e*h+2*c*Math.sin(e/2)/g)||0,b=.5*(n+Math.sin(n)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let c=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,p=25;const g=1e-6;let x=0,b=0;do{const E=Math.cos(h),I=Math.sin(h),C=2*I*E,k=I*I,F=E*E,N=Math.cos(c/2),W=Math.sin(c/2),Z=2*N*W,X=W*W,le=1-F*N*N,ce=le?1/le:0,de=le?Math.acos(E*N)*Math.sqrt(1/le):0,Ie=.5*(2*de*E*W+2*c/Math.PI)-e,Ce=.5*(de*I+h)-n,Re=.5*ce*(F*X+de*E*N*k)+1/Math.PI,Le=ce*(Z*C/4-de*I*W),Fe=.125*ce*(C*W-de*I*F*Z),dt=.5*ce*(k*N+de*X*E)+.5,je=Le*Fe-dt*Re;x=(Ce*Le-Ie*dt)/je,b=(Ie*Fe-Ce*Re)/je,c=U(c-x,-Math.PI,Math.PI),h=U(h-b,-DI,DI)}while((Math.abs(x)>g||Math.abs(b)>g)&&--p>0);return new G(Y(c),Y(h))}}class OI extends Vu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:c,cosPhi:h}=this;return{x:ze(e)*h*c+.5,y:-Math.sin(ze(n))/h*c+.5,z:0}}unproject(e,n){const{scale:c,cosPhi:h}=this,p=-(n-.5)/c,g=U(Y((e-.5)/c)/h,-180,180),x=Math.asin(U(p*h,-1,1)),b=U(Y(x),-Ae,Ae);return new G(g,b)}}class a4 extends RI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,c){const h=D0(e,n,c);return Qt(h,h,Vy(Wl(c))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n,c){const h=D(n.lat,n.lng),p=Pt([],h),g=c?e._centerAltitude+c:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Ue(h,h,p,be(1,0)*Dt*g);const x=J(new Float64Array(16));return pe(x,e.pixelMatrix,e.globeMatrix),Qt(h,h,x),new bt(h[0],h[1])}pixelsPerMeter(e,n){return be(1,0)*n}pixelSpaceConversion(e,n,c){const h=be(1,e)*n,p=wr(be(1,45)*n,h,c);return this.pixelsPerMeter(e,n)/p}createTileMatrix(e,n,c){const h=bw(Wl(c.canonical));return pe(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){const{center:c}=e,h=Vy(Wl(n));return at(h,h,ze(c.lng)),ke(h,h,ze(c.lat)),ie(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,c,h){return nE(e,n,c,!0)||new Qe(0,0)}pointCoordinate3D(e,n,c){const h=this.pointCoordinate(e,n,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!nE(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(h,p){const g=h.cameraToCenterDistance,x=h._centerAltitude*p,b=h._camera,E=h._camera.forward(),I=Ir([],gr([],E,-g),[0,0,x]),C=h.worldSize/(2*Math.PI),k=[0,0,-C],F=h.width/h.height,N=Math.tan(h.fovAboveCenter),W=gr([],b.up(),N),Z=gr([],b.right(),N*F),X=Pt([],Ir([],Ir([],E,W),Z)),le=[];let ce;if(new ci(I,X).closestPointOnSphere(k,C,le)){const de=Ir([],le,k),Ie=Pi([],de,I);ce=Math.cos(h.fovAboveCenter)*Xt(Ie)}else{const de=Pi([],I,k),Ie=Pi([],k,I);Pt(Ie,Ie);const Ce=Xt(de)-C;ce=Math.sqrt(Ce*(Ce+2*C));const Re=Math.acos(ce/(C+Ce))-Math.acos(dr(E,Ie));ce*=Math.cos(Re)}return 1.01*ce}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=Fu(e.zoom);if(c>0){const h=PI(e,be(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wr(n,h+p*(1-Math.cos(g)),Math.pow(c,10))}return n}upVector(e,n,c){return D0(n,c,e,1)}upVectorScale(e){return{metersToTile:By(Uy(Wl(e)))}}}function LI(o){const e=o.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new RI(o);case"equirectangular":return new i4(o);case"naturalEarth":return new s4(o);case"equalEarth":return new r4(o);case"winkelTripel":return new o4(o);case"albers":return n?new OI(o):new t4(o);case"lambertConformalConic":return n?new OI(o):new n4(o);case"globe":return new a4(o)}throw new Error(`Invalid projection name: ${o.name}`)}const l4=xt.types,c4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function px(o,e,n,c,h,p,g,x,b,E,I,C,k){const F=x?Math.min(Uu,Math.round(x[0])):0,N=x?Math.min(Uu,Math.round(x[1])):0;o.emplaceBack(e,n,Math.round(32*c),Math.round(32*h),p,g,(F<<1)+(b?1:0),N,16*E,16*I,256*C,256*k)}function mx(o,e,n){o.emplaceBack(e,n)}function gx(o,e,n,c,h,p,g){o.emplaceBack(e,n,c,h,p,g)}const _x=(o,e,n,c)=>{for(let h=0;h<e;h++)o.emplaceBack(n[0],n[1],n[2],c[0],c[1],c[2])};function yx(o,e,n,c,h){o.emplaceBack(e,n,c,h),o.emplaceBack(e,n,c,h),o.emplaceBack(e,n,c,h),o.emplaceBack(e,n,c,h)}function u4(o){for(const e of o.sections)if(cw(e.text))return!0;return!1}class mb{constructor(e){this.layoutVertexArray=new b0,this.indexArray=new Nn,this.programConfigurations=e,this.segments=new en,this.dynamicLayoutVertexArray=new la,this.opacityVertexArray=new ku,this.placedSymbolArray=new tp,this.iconTransitioningVertexArray=new Pn,this.globeExtVertexArray=new T0,this.zOffsetVertexArray=new Ul,this.orientationVertexArray=new Yh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,c,h,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_F.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,c4,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,vF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,yF.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,xF.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Wt(mb,"SymbolBuffers");class gb{constructor(e,n,c){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new c,this.segments=new en,this.collisionVertexArray=new E0,this.collisionVertexArrayExt=new la}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wF.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,bF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt(gb,"CollisionBuffers");class xx{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=J([]),this.placementViewportMatrix=J([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=uI(this.zoom,n["text-size"],this.worldview),this.iconSizeData=uI(this.zoom,n["icon-size"],this.worldview);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.lut=e.lut,this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(g=>Po[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new mb(new ca(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new mb(new ca(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ky,this.lineVertexArray=new Ry,this.symbolInstances=new Py}calculateGlyphDependencies(e,n,c,h,p){for(const g of e){const x=g.codePointAt(0);if(x===void 0)break;if(n[x]=!0,h&&p&&x<=65535){const b=J0[g];b&&(n[b.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Zy(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,n,c,h){const p=this.layers[0],g=p.layout,x=this.projection.name==="globe",b=g.get("text-font"),E=g.get("text-field"),I=g.get("icon-image"),[C,k]=g.get("icon-size-scale-range"),F=U(n.scaleFactor||1,C,k),N=(E.value.kind!=="constant"||E.value.value instanceof Ms&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),W=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=g.get("symbol-sort-key");if(this.features=[],!N&&!W)return;const X=n.iconDependencies,le=n.glyphDependencies,ce=n.availableImages,de=new Di(this.zoom,{worldview:this.worldview});for(const{feature:Ie,id:Ce,index:Re,sourceLayerIndex:Le}of e){const Fe=p._featureFilter.needGeometry,dt=St(Ie,Fe);if(!p._featureFilter.filter(de,dt,c))continue;if(Fe||(dt.geometry=jt(Ie,c,h)),x&&Ie.type!==1&&c.z<=5){const _t=dt.geometry,Et=.98078528056,lt=(yt,Je)=>dr(D0(yt.x,yt.y,c,1),D0(Je.x,Je.y,c,1))<Et;for(let yt=0;yt<_t.length;yt++)_t[yt]=ot(_t[yt],lt)}let je,pt;if(N){const _t=p.getValueAndResolveTokens("text-field",dt,c,ce),Et=Ms.factory(_t);u4(Et)&&(this.hasRTLText=!0),(!this.hasRTLText||Vf()==="unavailable"||this.hasRTLText&&ka.isParsed())&&(je=SF(Et,p,dt))}if(W){const _t=p.getValueAndResolveTokens("icon-image",dt,c,ce);pt=typeof _t=="string"?Gs.build(_t):_t}if(!je&&!pt)continue;const wt=this.sortFeaturesByKey?Z.evaluate(dt,{},c):void 0,mt={id:Ce,text:je,icon:pt,index:Re,sourceLayerIndex:Le,geometry:dt.geometry,properties:Ie.properties,type:l4[Ie.type],sortKey:wt};if(this.features.push(mt),pt){const _t=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Et,iconSecondary:lt}=EI(pt,this.iconSizeData,_t["icon-size"],c,this.zoom,mt,this.pixelRatio,F,this.worldview),yt=Et.id.toString();if(X.has(yt)?X.get(yt).push(Et):X.set(yt,[Et]),lt){this.hasAnySecondaryIcon=!0;const Je=lt.id.toString();X.has(Je)?X.get(Je).push(lt):X.set(Je,[lt])}}if(je){const _t=b.evaluate(dt,{},c).join(","),Et=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Po.vertical)>=0;for(const lt of je.sections)if(lt.image){const yt=lt.image.getPrimary().scaleSelf(this.pixelRatio),Je=yt.id.toString(),Ze=X.get(Je)||[];Ze.push(yt),X.set(Je,Ze)}else{const yt=d0(je.toString()),Je=lt.fontStack||_t,Ze=le[Je]=le[Je]||{};this.calculateGlyphDependencies(lt.text,Ze,Et,this.allowVerticalPlacement,yt)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(Ie){const Ce={},Re={},Le=[];let Fe=0;function dt(mt){Le.push(Ie[mt]),Fe++}function je(mt,_t,Et){const lt=Re[mt];return delete Re[mt],Re[_t]=lt,Le[lt].geometry[0].pop(),Le[lt].geometry[0]=Le[lt].geometry[0].concat(Et[0]),lt}function pt(mt,_t,Et){const lt=Ce[_t];return delete Ce[_t],Ce[mt]=lt,Le[lt].geometry[0].shift(),Le[lt].geometry[0]=Et[0].concat(Le[lt].geometry[0]),lt}function wt(mt,_t,Et){const lt=Et?_t[0][_t[0].length-1]:_t[0][0];return`${mt}:${lt.x}:${lt.y}`}for(let mt=0;mt<Ie.length;mt++){const _t=Ie[mt],Et=_t.geometry,lt=_t.text?_t.text.toString():null;if(!lt){dt(mt);continue}const yt=wt(lt,Et),Je=wt(lt,Et,!0);if(yt in Re&&Je in Ce&&Re[yt]!==Ce[Je]){const Ze=pt(yt,Je,Et),At=je(yt,Je,Le[Ze].geometry);delete Ce[yt],delete Re[Je],Re[wt(lt,Le[At].geometry,!0)]=At,Le[Ze].geometry=null}else yt in Re?je(yt,Je,Et):Je in Ce?pt(yt,Je,Et):(dt(mt),Ce[yt]=Fe-1,Re[Je]=Fe-1)}return Le.filter(mt=>mt.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ie of n.elevationFeatures)this.elevationFeatureIdToIndex.set(Ie.id,this.elevationFeatures.length),this.elevationFeatures.push(Ie)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ie,Ce)=>Ie.sortKey-Ce.sortKey)}update(e,n,c,h,p,g,x){this.text.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,p,c,h,g,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const c=$e(e),h=1/c;let p=!1,g=!1;for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x),E=Dr(1,0,0),I=Dr(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:k,numIconVertices:F,numVerticalIconVertices:N}=b,W=C>0||k>0,Z=F>0,X=this.elevationFeatures[b.elevationFeatureIndex];if(X){const le=new bt(b.tileAnchorX,b.tileAnchorY),ce=.075+X.pointElevation(le);b.zOffset!==ce&&(n=!0,b.zOffset=ce);const de=X.computeSlopeNormal(le,h),Ie=Yo(Xn(),Dr(0,0,1),de);bi(E,E,Ie),bi(I,I,Ie),E[2]*=c,I[2]*=c,E[0]===1&&E[1]===0&&E[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(p=p||W,g=g||Z)}if(W&&(_x(this.text.orientationVertexArray,C,E,I),_x(this.text.orientationVertexArray,k,E,I)),Z){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:ce}=b;le>=0&&_x(this.icon.orientationVertexArray,F,E,I),ce>=0&&_x(this.icon.orientationVertexArray,N,E,I)}}p||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,g,x)=>{c+=g,c>p.length&&p.resize(c);for(let b=-g;b<0;b++)p.emplace(b+c,x)},n=(p,g,x)=>{h+=g,h>p.length&&p.resize(h);for(let b=-g;b<0;b++)p.emplace(b+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:b,numIconVertices:E}=g,I=g.zOffset,C=E>0;if((x>0||b>0)&&(e(this.text.zOffsetVertexArray,x,I),e(this.text.zOffsetVertexArray,b,I)),C){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:F}=g;k>=0&&n(this.icon.zOffsetVertexArray,E,I),F>=0&&n(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=LI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of n)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,n,c,h,p,g,x,b,E,I,C,k,F,N,W,Z){const X=e.indexArray,le=e.layoutVertexArray,ce=e.globeExtVertexArray,de=e.segments.prepareSegment(4*n.length,le,X,this.canOverlap?g.sortKey:void 0),Ie=this.glyphOffsetArray.length,Ce=de.vertexLength,Re=this.allowVerticalPlacement&&x===Po.vertical?Math.PI/2:0,Le=g.text&&g.text.sections;for(let dt=0;dt<n.length;dt++){const{tl:je,tr:pt,bl:wt,br:mt,texPrimary:_t,texSecondary:Et,pixelOffsetTL:lt,pixelOffsetBR:yt,minFontScaleX:Je,minFontScaleY:Ze,glyphOffset:At,isSDF:Tt,sectionIndex:hr}=n[dt],Gt=de.vertexLength,Jt=At[1];if(px(le,E.x,E.y,je.x,Jt+je.y,_t.x,_t.y,c,Tt,lt.x,lt.y,Je,Ze),px(le,E.x,E.y,pt.x,Jt+pt.y,_t.x+_t.w,_t.y,c,Tt,yt.x,lt.y,Je,Ze),px(le,E.x,E.y,wt.x,Jt+wt.y,_t.x,_t.y+_t.h,c,Tt,lt.x,yt.y,Je,Ze),px(le,E.x,E.y,mt.x,Jt+mt.y,_t.x+_t.w,_t.y+_t.h,c,Tt,yt.x,yt.y,Je,Ze),b){const{x:Rt,y:cr,z:Mr}=b.anchor,[Nt,rr,Tr]=b.up;gx(ce,Rt,cr,Mr,Nt,rr,Tr),gx(ce,Rt,cr,Mr,Nt,rr,Tr),gx(ce,Rt,cr,Mr,Nt,rr,Tr),gx(ce,Rt,cr,Mr,Nt,rr,Tr),yx(e.dynamicLayoutVertexArray,Rt,cr,Mr,Re)}else yx(e.dynamicLayoutVertexArray,E.x,E.y,E.z,Re);if(Z){const Rt=Et||_t;mx(e.iconTransitioningVertexArray,Rt.x,Rt.y),mx(e.iconTransitioningVertexArray,Rt.x+Rt.w,Rt.y),mx(e.iconTransitioningVertexArray,Rt.x,Rt.y+Rt.h),mx(e.iconTransitioningVertexArray,Rt.x+Rt.w,Rt.y+Rt.h)}X.emplaceBack(Gt,Gt+1,Gt+2),X.emplaceBack(Gt+1,Gt+2,Gt+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),dt!==n.length-1&&hr===n[dt+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,g,g.index,{},F,N,W,Le&&Le[hr],this.worldview)}const Fe=b?b.anchor:E;e.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,E.x,E.y,Ie,this.glyphOffsetArray.length-Ie,Ce,I,C,E.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,0,0,k,0)}_commitLayoutVertex(e,n,c,h,p,g,x){e.emplaceBack(n,c,h,p,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,n,c,h,p,g,x){const b=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=b.vertexLength,I=x.tileAnchorX,C=x.tileAnchorY;for(let F=0;F<4;F++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,n,e.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,I,C,new bt(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,I,C,new bt(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,I,C,new bt(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,I,C,new bt(e.x1,e.y2)),b.vertexLength+=4;const k=c.indexArray;k.emplaceBack(E,E+1),k.emplaceBack(E+1,E+2),k.emplaceBack(E+2,E+3),k.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,c,h,p,g){for(let x=h;x<p;x++){const b=c.get(x),E=this.getSymbolInstanceTextSize(e,g,n,x);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,n,c,h,p,g){for(let x=h;x<p;x++){const b=c.get(x),E=this.getSymbolInstanceIconSize(e,n,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,n,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gb(Kf,XA.members,Pn),this.iconCollisionBox=new gb(Kf,XA.members,Pn);const h=eg(this.iconSizeData,e),p=eg(this.textSizeData,e,c);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,n,c,h){const p=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),g=lb(this.textSizeData,e,p)/rs;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,n,c){const h=this.icon.placedSymbolArray.get(c),p=lb(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,n,c,h){e.emplaceBack(n,-c,-c,h),e.emplaceBack(n,c,-c,h),e.emplaceBack(n,c,c,h),e.emplaceBack(n,-c,c,h)}_updateTextDebugCollisionBoxes(e,n,c,h,p,g,x){for(let b=h;b<p;b++){const E=c.get(b),I=this.getSymbolInstanceTextSize(e,g,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,E.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,n,c,h,p,g,x){for(let b=h;b<p;b++){const E=c.get(b),I=this.getSymbolInstanceIconSize(e,n,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,E.padding,g.zOffset)}}updateCollisionDebugBuffers(e,n,c,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=eg(this.iconSizeData,e,h),g=eg(this.textSizeData,e,c);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(g,e,n,b.textBoxStartIndex,b.textBoxEndIndex,b,c),this._updateTextDebugCollisionBoxes(g,e,n,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,c),this._updateIconDebugCollisionBoxes(p,e,n,b.iconBoxStartIndex,b.iconBoxEndIndex,b,h),this._updateIconDebugCollisionBoxes(p,e,n,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,c,h,p,g,x,b,E){const I={};if(n<c){const{x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de,featureIndex:Ie}=e.get(n);I.textBox={x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de},I.textFeatureIndex=Ie}if(h<p){const{x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de,featureIndex:Ie}=e.get(h);I.verticalTextBox={x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de},I.verticalTextFeatureIndex=Ie}if(g<x){const{x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de,featureIndex:Ie}=e.get(g);I.iconBox={x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de},I.iconFeatureIndex=Ie}if(b<E){const{x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de,featureIndex:Ie}=e.get(b);I.verticalIconBox={x1:C,y1:k,x2:F,y2:N,padding:W,projectedAnchorX:Z,projectedAnchorY:X,projectedAnchorZ:le,tileAnchorX:ce,tileAnchorY:de},I.verticalIconFeatureIndex=Ie}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const c=e.placedSymbolArray.get(n),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),c=Math.cos(e),h=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const b=this.symbolInstances.get(x);h.push(0|Math.round(n*b.tileAnchorX+c*b.tileAnchorY)),p.push(b.featureIndex)}return g.sort((x,b)=>h[x]-h[b]||p[b]-p[x]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let FI,NI,_b;Wt(xx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),xx.addDynamicAttributes=yx;class zI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ia,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(zI,"FormatSectionOverride",{omit:["defaultValue"]});const yb=()=>_b||(_b={layout:FI||(FI=new rn({"symbol-placement":new It(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new It(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(Be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It(Be.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new It(Be.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new It(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bt(Be.layout_symbol["icon-size"]),"icon-size-scale-range":new It(Be.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Bt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bt(Be.layout_symbol["icon-image"]),"icon-image-use-theme":new It({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Bt(Be.layout_symbol["icon-rotate"]),"icon-padding":new It(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new It(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Bt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Bt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Bt(Be.layout_symbol["text-field"]),"text-font":new Bt(Be.layout_symbol["text-font"]),"text-size":new Bt(Be.layout_symbol["text-size"]),"text-size-scale-range":new It(Be.layout_symbol["text-size-scale-range"]),"text-max-width":new Bt(Be.layout_symbol["text-max-width"]),"text-line-height":new Bt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Bt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Bt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Bt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new Bt(Be.layout_symbol["text-anchor"]),"text-max-angle":new It(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new It(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Bt(Be.layout_symbol["text-rotate"]),"text-padding":new It(Be.layout_symbol["text-padding"]),"text-keep-upright":new It(Be.layout_symbol["text-keep-upright"]),"text-transform":new Bt(Be.layout_symbol["text-transform"]),"text-offset":new Bt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new It(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(Be.layout_symbol["text-ignore-placement"]),"text-optional":new It(Be.layout_symbol["text-optional"]),visibility:new It(Be.layout_symbol.visibility)})),paint:NI||(NI=new rn({"icon-opacity":new Bt(Be.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bt(Be.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bt(Be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bt(Be.paint_symbol["text-emissive-strength"]),"icon-color":new Bt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Bt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new It(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(Be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new It(Be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bt(Be.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bt(Be.paint_symbol["text-occlusion-opacity"]),"text-color":new Bt(Be.paint_symbol["text-color"],{runtimeType:ro,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Bt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Bt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Bt(Be.paint_symbol["text-halo-blur"]),"text-translate":new It(Be.paint_symbol["text-translate"]),"text-translate-anchor":new It(Be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It(Be.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It(Be.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It(Be.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It(Be.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bt(Be.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},_b);class vx extends Ts{constructor(e,n,c,h){super(e,yb(),n,c,h,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=J([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,c,h){return this._saturation===e&&this._contrast===n&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,g,x,b){p=vs(p),g=In(g);const E=re(),I=p/3,C=1-2*I,k=[C,I,I,0,I,C,I,0,I,I,C,0,0,0,0,1],F=.5-.5*g,N=b-x;return pe(E,[N,0,0,0,0,N,0,0,0,0,N,0,x,x,x,1],[g,0,0,0,0,g,0,0,0,0,g,0,F,F,F,1]),pe(E,E,k),E}(e,n,c,h),this._saturation=e,this._contrast=n,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,c,h){const p=this.layout.get(e).evaluate(n,{},c,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||c0(g.value)||!p?p:function(x,b){return b.replace(/{([^{}]+)}/g,(E,I)=>I in x?String(x[I]):"")}(n.properties,p)}createBucket(e){return new xx(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of yb().paint.overridableProperties){if(!vx.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),c=new zI(n),h=new Lf(c,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Wh("source",h):new Ll("composite",h,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Sc(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&vx.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const c=e.get("text-field"),h=yb().paint.properties[n];let p=!1;const g=x=>{for(const b of x)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Ms)g(c.value.value.sections);else if(c.value.kind==="source"){const x=E=>{p||(E instanceof Ur&&Gn(E.value)===Il?g(E.value.sections):E instanceof hc?g(E.sections):E.eachChild(x))},b=c.value;b._styleExpression&&x(b._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,c){return{config:new Rc(this,{zoom:n,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let BI,jI,UI,VI;var xb=ii([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function wx(o,e,n,c,h,p,g,x){const b=[o,e,1,n,c,1,h,p,1],E=[g,x,1],I=q([],b),[C,k,F]=Ci(E,E,I);return ee(b,b,[C,0,0,0,k,0,0,0,F])}function $I(o,e,n,c,h,p,g,x){const b=function(E,I,C,k,F,N,W,Z){const X=wx(0,0,1,0,1,1,0,1),le=wx(E,I,C,k,F,N,W,Z);return ee(le,le,q([],X))}(o,e,n,c,h,p,g,x);return[b[2]/b[8]/Dt,b[5]/b[8]/Dt]}function bx(o){return[o[0],Math.min(Math.max(o[1],-Ae),Ae)]}class GI extends cc{constructor(e,n,c,h){super(),this.id=e,this.dispatcher=c,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ia("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=au(this.map._requestManager.transformRequest(this.url,Xd.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new kh(c)):h&&(this.image=h instanceof HTMLImageElement?Aa.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new X0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ia("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof X0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],c=e[0][1];for(const p of e)p[1]>c&&(c=p[1]),p[1]<n&&(n=p[1]);const h=(c+n)/2;if(h>Ae?this.onNorthPole=!0:h<-Ae&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Qe.fromLngLat);this.tileID=function(g){let x=1/0,b=1/0,E=-1/0,I=-1/0;for(const W of g)x=Math.min(x,W.x),b=Math.min(b,W.y),E=Math.max(E,W.x),I=Math.max(I,W.y);const C=Math.max(E-x,I-b),k=Math.max(0,Math.floor(-Math.log2(C))),F=Math.pow(2,k);let N=Math.floor((x+E)/2*F);return N>1&&(N-=1),new rl(k,N,Math.floor((b+I)/2*F))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ia("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof X0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const X in this.tiles){const le=this.tiles[X];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=ng(new rl(0,0,0),this.map.transform.projection),c=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(X){const le=X[1].x-X[0].x,ce=X[1].y-X[0].y,de=X[2].x-X[1].x,Ie=X[2].y-X[1].y,Ce=X[3].x-X[2].x,Re=X[3].y-X[2].y,Le=X[0].x-X[3].x,Fe=X[0].y-X[3].y,dt=le*Ie-de*ce,je=de*Re-Ce*Ie,pt=Ce*Fe-Le*Re,wt=Le*ce-le*Fe;return dt>0&&je>0&&pt>0&&wt>0||dt<0&&je<0&&pt<0&&wt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=ng(this.tileID,this.map.transform.projection),[p,g,x,b]=this.coordinates.map(X=>{const le=h.projection.project(X[0],X[1]);return kI(h,le)._round()});this.perspectiveTransform=$I(p.x,p.y,g.x,g.y,x.x,x.y,b.x,b.y);const E=this._boundsArray=new Cc;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(g.x,g.y,Dt,0),E.emplaceBack(b.x,b.y,0,Dt),E.emplaceBack(x.x,x.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,xb.members),this.boundsSegments=en.simpleSegment(0,0,4,2);const I=[],C=[bx((k=this.coordinates)[0]),bx(k[1]),bx(k[2]),bx(k[3])];var k;const[F,N,W,Z]=function(X){let le=X[0][0],ce=le,de=X[0][1],Ie=de;for(let Ce=1;Ce<X.length;Ce++)X[Ce][0]<le?le=X[Ce][0]:X[Ce][0]>ce&&(ce=X[Ce][0]),X[Ce][1]<de?de=X[Ce][1]:X[Ce][1]>Ie&&(Ie=X[Ce][1]);return[le,de,ce-le,Ie-de]}(C);{const X=new Cc,[le,ce,de,Ie]=function(lt){let yt=lt[0].x,Je=yt,Ze=lt[0].y,At=Ze;for(let Tt=1;Tt<lt.length;Tt++)lt[Tt].x<yt?yt=lt[Tt].x:lt[Tt].x>Je&&(Je=lt[Tt].x),lt[Tt].y<Ze?Ze=lt[Tt].y:lt[Tt].y>At&&(At=lt[Tt].y);return[yt,Ze,Je-yt,At-Ze]}(c),Ce=lt=>[(lt.x-le)/de,(lt.y-ce)/Ie],[Re,Le,Fe,dt]=c.map(Ce),je=function(lt,yt,Je,Ze,At,Tt,hr,Gt){const Jt=wx(0,0,1,0,1,1,0,1);return ee(Jt,Jt,q([],wx(lt,yt,Je,Ze,At,Tt,hr,Gt)))}(Re[0],Re[1],Le[0],Le[1],Fe[0],Fe[1],dt[0],dt[1]);this.elevatedGlobePerspectiveTransform=$I(Re[0],Re[1],Le[0],Le[1],Fe[0],Fe[1],dt[0],dt[1]);const pt=(lt,yt)=>{I.push(lt.lng);const Je=Math.round((lt.lng-F)/W*Dt),Ze=Math.round((lt.lat-N)/Z*Dt),At=Ce(yt),Tt=Ci([],[At[0],At[1],1],je),hr=Math.round(Tt[0]/Tt[2]*Dt),Gt=Math.round(Tt[1]/Tt[2]*Dt);X.emplaceBack(Je,Ze,hr,Gt)},wt=c[3].x-c[0].x,mt=c[3].y-c[0].y,_t=c[2].x-c[1].x,Et=c[2].y-c[1].y;for(let lt=0;lt<65;lt++){const yt=lt/64,Je=[c[0].x+yt*wt,c[0].y+yt*mt],Ze=[c[1].x+yt*_t,c[1].y+yt*Et],At=Ze[0]-Je[0],Tt=Ze[1]-Je[1];for(let hr=0;hr<65;hr++){const Gt=hr/64,Jt={x:Je[0]+At*Gt,y:Je[1]+Tt*Gt};pt(n.projection.unproject(Jt.x,Jt.y),Jt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(X,xb.members)}{this.maxLongitudeTriangleSize=0;let X=[],le=new Nn;const ce=(de,Ie,Ce)=>{le.emplaceBack(de,Ie,Ce);const Re=I[de],Le=I[Ie],Fe=I[Ce],dt=Math.min(Math.min(Re,Le),Fe),je=Math.max(Math.max(Re,Le),Fe)-dt;je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=je),X.push(dt+je/2)};for(let de=0;de<64;de++)for(let Ie=0;Ie<64;Ie++){const Ce=65*de+Ie,Re=Ce+1,Le=Ce+65,Fe=Le+1;ce(Ce,Le,Re),ce(Re,Le,Fe)}[X,le]=function(de,Ie){const Ce=Array.from({length:de.length},(Fe,dt)=>dt);Ce.sort((Fe,dt)=>de[Fe]-de[dt]);const Re=[],Le=new Nn;for(let Fe=0;Fe<Ce.length;Fe++){const dt=Ce[Fe];Re.push(de[dt]);const je=3*dt,pt=je+1;Le.emplaceBack(Ie.uint16[je],Ie.uint16[pt],Ie.uint16[pt+1])}return[Re,Le]}(X,le),this.elevatedGlobeTrianglesCenterLongitudes=X,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(le)}this.elevatedGlobeSegments=en.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Dt,0,Z/Dt,0,0,N,F,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,c=n.gl;!this._dirty||this.texture instanceof X0||(this.texture?this.texture.update(this.image):(this.texture=new qw(n,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=e+180)+360*Math.round((c[0]-p)/360);var p;const g=new en,x=(C,k)=>{g.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:n.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=b){const C=Sn(c,0,c.length,h+b);return C===c.length||x(C,Ai(c,C+1,c.length,h+360-b)-C),g}h<c[0]&&(h+=360);const E=Ai(c,0,c.length,h-b);if(E===c.length)return x(0,c.length),g;x(0,E-0);const I=Sn(c,E+1,c.length,h+b);return I!==c.length&&x(I,c.length-I),g}}const h4=(Math.pow(256,2)-1)/16907520;class HI extends Ts{constructor(e,n,c,h){super(e,{layout:UI||(UI=new rn({visibility:new It(Be.layout_raster.visibility)})),paint:VI||(VI=new rn({"raster-opacity":new It(Be.paint_raster["raster-opacity"]),"raster-color":new Eu(Be.paint_raster["raster-color"]),"raster-color-mix":new It(Be.paint_raster["raster-color-mix"]),"raster-color-range":new It(Be.paint_raster["raster-color-range"]),"raster-hue-rotate":new It(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new It(Be.paint_raster["raster-saturation"]),"raster-contrast":new It(Be.paint_raster["raster-contrast"]),"raster-resampling":new It(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new It(Be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It(Be.paint_raster["raster-emissive-strength"]),"raster-array-band":new It(Be.paint_raster["raster-array-band"]),"raster-elevation":new It(Be.paint_raster["raster-elevation"]),"raster-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},n,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof GI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=O0({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let WI,qI,ZI,XI,KI;class YI extends Ts{constructor(e,n,c,h){super(e,{layout:WI||(WI=new rn({visibility:new It(Be["layout_raster-particle"].visibility)})),paint:qI||(qI=new rn({"raster-particle-array-band":new It(Be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It(Be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Eu(Be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It(Be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It(Be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It(Be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It(Be["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It(Be["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},n,c,h),this._updateColorRamp(),this.lastInvalidatedAt=Aa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=O0({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Aa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class d4 extends Ts{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function vb(o,e,n){const c=[0,0,1],h=Vn([]);return ks(h,h,n?-ze(o)+Math.PI:ze(o)),Kn(h,h,-ze(e)),bi(c,c,h),Pt(c,c)}const JI={None:0,Model:1,Symbol:2,FillExtrusion:4};class Tx{constructor(e,n,c,h){this.message=(e?`${e}: `:"")+c,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function wb(o,e){const n=o.indexOf("://")===-1;try{return new URL(o,n&&e?"http://example.com":void 0),!0}catch{return!1}}class QI{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class eC{constructor(){this.instancedDataArray=new C0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class bb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,n){}populate(e,n,c,h){this.tileToMeter=$e(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:x,index:b,sourceLayerIndex:E}of e){const I=x??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),C=St(g,p);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{worldview:this.worldview}),C,c))continue;const k={id:I,sourceLayerIndex:E,index:b,geometry:p?C.geometry:jt(g,c,h),properties:g.properties,type:g.type,patterns:{}},F=this.addFeature(k,k.geometry,C);F&&n.featureIndex.insert(g,k.geometry,b,E,this.index,this.instancesPerModel[F].instancedDataArray.length,Dt/32)}this.lookup=null}update(e,n,c,h){for(const p in this.instancesPerModel){const g=this.instancesPerModel[p];for(const x in e)g.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(g.features[g.idToFeaturesIndex[x]],e[x],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];for(const h of c.features){const p=this.layers[0],g=h.feature,x=this.canonical,b=p.paint.get("model-rotation").evaluate(g,{},x),E=p.paint.get("model-scale").evaluate(g,{},x),I=p.paint.get("model-translation").evaluate(g,{},x);gi(h.rotation,b)&&gi(h.scale,E)&&gi(h.translation,I)||(this.evaluate(h,h.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,n,c,h){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const p=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Zy(this.activeReplacements,p))return!1;this.activeReplacements=p;let g=!1;for(const x in this.instancesPerModel){const b=this.instancesPerModel[x],E=b.instancedDataArray;for(const I of b.features){const C=I.instancedDataOffset,k=I.instancedDataCount;for(let F=0;F<k;F++){const N=16*(F+C);let W=E.float32[N+0];const Z=W>Dt;W=Z?W-Dt:W;const X=Math.floor(W),le=E.float32[N+1];let ce=!1;for(const de of this.activeReplacements)if(!jE(de,c,JI.Model,h)&&!(de.min.x>X||X>de.max.x||de.min.y>le||le>de.max.y)&&(ce=Lw(GE(X,le,e.canonical,de.footprintTileId.canonical),de.footprint),ce))break;E.float32[N]=ce?W+Dt:W,g=g||ce!==Z}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,UL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const n of this.modelUris)e.removeModel(n,"",!0)}addFeature(e,n,c){const h=this.layers[0],p=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return $t(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;(wb(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new eC);const g=this.instancesPerModel[p],x=g.instancedDataArray,b=new QI(c,x.length);for(const E of n)for(const I of E){if(I.x<0||I.x>=Dt||I.y<0||I.y>=Dt)continue;if(this.lookupDim!==0){const k=(this.lookupDim-1)/Dt,F=this.lookupDim*(I.y*k|0)+I.x*k|0;if(this.lookup){if(this.lookup[F]!==0)continue;this.lookup[F]=1}}this.instanceCount++;const C=x.length;x.resize(C+1),g.instancesEvaluatedElevation.push(0),x.float32[16*C]=I.x,x.float32[16*C+1]=I.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),p}getModelUris(){return this.modelUris}evaluate(e,n,c,h){const p=this.layers[0],g=e.feature,x=this.canonical,b=e.rotation=p.paint.get("model-rotation").evaluate(g,n,x),E=e.scale=p.paint.get("model-scale").evaluate(g,n,x),I=e.translation=p.paint.get("model-translation").evaluate(g,n,x),C=p.paint.get("model-color").evaluate(g,n,x);C.a=p.paint.get("model-color-mix-intensity").evaluate(g,n,x);const k=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),EA(k,b,E);const F=Math.round(100*C.a)+C.b/1.05;for(let N=0;N<e.instancedDataCount;++N){const W=e.instancedDataOffset+N,Z=16*W,X=c.instancedDataArray.float32;let le=0;h&&(le=X[Z+6]-c.instancesEvaluatedElevation[W]);const ce=0|X[Z+1];X[Z]=(0|X[Z])+C.r/1.05,X[Z+1]=ce+C.g/1.05,X[Z+2]=F,X[Z+3]=1/(x.z>10?this.tileToMeter:$e(x,ce)),X[Z+4]=I[0],X[Z+5]=I[1],X[Z+6]=I[2]+le,X[Z+7]=k[0],X[Z+8]=k[1],X[Z+9]=k[2],X[Z+10]=k[4],X[Z+11]=k[5],X[Z+12]=k[6],X[Z+13]=k[8],X[Z+14]=k[9],X[Z+15]=k[10],c.instancesEvaluatedElevation[W]=I[2]}}}let tC,rC;Wt(bb,"ModelBucket",{omit:["layers"]}),Wt(eC,"PerModelAttributes"),Wt(QI,"ModelFeature");class yp{constructor(e,n,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=c}static create(e,n,c){const h=c||e.findDEMTileFor(n);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,x=1<<n.canonical.z-g.canonical.z;return new yp(h,p.dim/Dt/x,[(n.canonical.x/x-g.canonical.x)*p.dim,(n.canonical.y/x-g.canonical.y)*p.dim])}tileCoordToPixel(e,n){const c=n*this._scale+this._offset[1];return new bt(Math.floor(e*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(e,n,c,h){const p=e*this._scale+this._offset[0],g=n*this._scale+this._offset[1],x=Math.floor(p),b=Math.floor(g),E=this._dem;return h=!!h,c?wr(wr(E.get(x,b,h),E.get(x,b+1,h),g-b),wr(E.get(x+1,b,h),E.get(x+1,b+1,h),g-b),p-x):E.get(x,b,h)}getElevationAtPixel(e,n,c){return this._dem.get(e,n,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*be(1,e)*this._dem.stride}}const Tb=new Float32Array(262144),fd=new Uint8Array(262144);function iC(o){let e=0;if(o.meshes)for(const n of o.meshes)e=Math.max(e,n.aabb.max[2]);if(o.children)for(const n of o.children)e=Math.max(e,iC(n));return e}function nC(o,e,n){if(o.meshes)for(const c of o.meshes){if(c.aabb.min[0]===1/0)continue;const h=Er.applyTransform(c.aabb,o.matrix);n.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(o.children)for(const c of o.children)nC(c,e,n)}const sC=["","wall","door","roof","window","lamp","logo"];class oC{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:iC(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=Er.applyTransformFast(c.aabb,this.node.matrix),n.encapsulate(c.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Sx{constructor(e,n,c,h,p,g,x,b){this.id=c,this.layers=e,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=dp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=dp.HasMapboxMeshFeatures),p&&(this.modelTraits|=dp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of n)this.nodesInfo.push(new oC(E)),nC(E,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,n){for(const c of this.getNodesInfo()){const h=c.node;h.footprint&&n.push({footprint:h.footprint,id:e})}}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const c=n?this.stateDependentLayers:this.layers;if(!ea(e,this.states))for(const h of c)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const c of n){const h=c.node;this.uploaded?this.updatePbrBuffer(h):Kw(h,e,!0)}for(const c of n)nx(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),n=!0);return n}needsReEvaluation(e,n,c){const h=e.transform.projectionOptions,p=e.style.getBrightness(),g=this.brightness!==p;if(!this.uploaded||this.dirty||h.name!==this.projection.name||cg(c.paint.get("model-color").value,g)||cg(c.paint.get("model-color-mix-intensity").value,g)||cg(c.paint.get("model-roughness").value,g)||cg(c.paint.get("model-emissive-strength").value,g)||cg(c.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=p;const x=this.getNodesInfo();for(const b of x)b.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const c=this.getNodesInfo(),h=this.id.canonical;for(const p of c){const g=p.feature;p.evaluatedTranslation=n.paint.get("model-translation").evaluate(g,{},h),p.evaluatedScale=n.paint.get("model-scale").evaluate(g,{},h)}}evaluate(e,n){const c=this.getNodesInfo();for(const h of c){if(!h.node.meshes)continue;const p=h.feature,g=n&&n[p.id];if(ea(g,h.state))continue;h.state=structuredClone(g);const x=h.node.meshes&&h.node.meshes[0].featureData,b=h.evaluatedColor[2],E=h.evaluatedRMEA[2],I=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let C=0;C<sC.length;C++){const k=sC[C];k.length&&(p.properties.part=k);const F=e.paint.get("model-color").evaluate(p,g,I).toPremultipliedRenderColor(null),N=e.paint.get("model-color-mix-intensity").evaluate(p,g,I);h.evaluatedColor[C]=[F.r,F.g,F.b,N],h.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(p,g,I),h.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(p,g,I),h.evaluatedRMEA[C][3]=F.a,h.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,g,I),!h.hasTranslucentParts&&F.a<1&&(h.hasTranslucentParts=!0)}delete p.properties.part,p4(h,b!==h.evaluatedColor[2]||E!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,g,I);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,g,I),h.evaluatedScale=e.paint.get("model-scale").evaluate(p,g,I),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,c,h){const p=e.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const g=yp.create(e,c,p);if(!g)return;this.modelTraits&dp.HasMapboxMeshFeatures&&this.updateDEM(e,g,c,h);for(const x of this.getNodesInfo()){const b=x.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const E=b.footprint.vertices;let I=g.getElevationAt(E[0].x,E[0].y,!0,!0);for(let C=1;C<E.length;C++)I=Math.min(I,g.getElevationAt(E[C].x,E[C].y,!0,!0));b.elevation=I}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,c,h){let p=n._dem._modifiedForSources[h];if(p===void 0&&(n._dem._modifiedForSources[h]=[],p=n._dem._modifiedForSources[h]),p.includes(c.canonical))return;const g=n._dem.dim;p.push(c.canonical);let x=!1;for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.grid)continue;const I=E.footprint.grid,C=n.tileCoordToPixel(I.min.x,I.min.y),k=n.tileCoordToPixel(I.max.x,I.max.y),F=Math.min(Math.min(g-k.y,C.x),Math.min(C.y,g-k.x));if(F<0)continue;const N=U(F,2,5);let W=Math.max(0,C.x-N),Z=Math.max(0,C.y-N),X=Math.min(k.x+N,g-1),le=Math.min(k.y+N,g-1);for(let Ce=Z;Ce<=le;++Ce)for(let Re=W;Re<=X;++Re)fd[Ce*g+Re]=255;let ce=0,de=0;for(let Ce=0;Ce<I.cellsY;++Ce)for(let Re=0;Re<I.cellsX;++Re){if(!I.cells[Ce*I.cellsX+Re])continue;const Le=n.tileCoordToPixel(I.min.x+Re/I.xScale,I.min.y+Ce/I.yScale),Fe=n.tileCoordToPixel(I.min.x+(Re+1)/I.xScale,I.min.y+(Ce+1)/I.yScale);for(let dt=Le.y;dt<=Math.min(Fe.y+1,g-1);++dt)for(let je=Le.x;je<=Math.min(Fe.x+1,g-1);++je)fd[dt*g+je]===255&&(fd[dt*g+je]=0,ce+=n.getElevationAtPixel(je,dt),de++)}const Ie=ce/de;W=Math.max(1,C.x-N),Z=Math.max(1,C.y-N),X=Math.min(k.x+N,g-2),le=Math.min(k.y+N,g-2),x=!0;for(let Ce=Z;Ce<=le;++Ce)for(let Re=W;Re<=X;++Re)fd[Ce*g+Re]===0&&(Tb[Ce*g+Re]=n._dem.set(Re,Ce,Ie));for(let Ce=1;Ce<N;++Ce){W=Math.max(1,C.x-Ce),Z=Math.max(1,C.y-Ce),X=Math.min(k.x+Ce,g-2),le=Math.min(k.y+Ce,g-2);for(let Re=Z;Re<=le;++Re)for(let Le=W;Le<=X;++Le){const Fe=Re*g+Le;if(fd[Fe]===255){let dt=0,je=0,pt=-1,wt=-1;for(let mt=-1;mt<=1;++mt)for(let _t=-1;_t<=1;++_t){const Et=(Re+mt)*g+Le+_t;if(fd[Et]>=Ce)continue;const lt=Tb[Et],yt=Math.abs(lt);yt>je&&(dt=lt,je=yt,pt=_t,wt=mt)}if(je>.1){const mt=1-(Ce+.5*Math.abs(pt*wt))/N;let _t=n._dem.get(Le,Re)+dt*mt;const Et=n._dem.get(Le+pt,Re+wt),lt=n._dem.get(Le-pt,Re-wt,!0);(_t-Et)*(_t-lt)>0&&(_t=(Et+lt)/2),Tb[Fe]=n._dem.set(Le,Re,_t),fd[Fe]=Ce}}}}}x&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Aa.now())}setFilter(e){this.filter=e?Zh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Di(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)nx(n.node),Yw(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const p=h.node.footprint;h.hiddenByReplacement=!!p&&!c.find(g=>g.footprint===p)}}getHeightAtTileCoord(e,n){const c=[],h=[0,0,0],p=J([]);for(const g of this.getNodesInfo()){const x=g.node.meshes[0],b=x.transformedAabb;if(e<b.min[0]||n<b.min[1]||e>b.max[0]||n>b.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};_e(p,g.node.matrix),h[0]=e,h[1]=n,Qt(h,h,p);const E=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*ud|0,I=Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*ud|0)*ud+Math.min(63,E),C=x.heightmap[I];if(!(C<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:C,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new bt(e,n),new bt(e,n),c),c.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function cg(o,e){return o instanceof Wh&&!o.isLightConstant&&e}function f4(o,e,n,c,h,p,g,x){let b=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;n[3]>0&&(b=wr(b,255*n[0],n[3]),E=wr(E,255*n[1],n[3]),I=wr(I,255*n[2],n[3]));const C=b<<8|E,k=I<<8|Math.floor(255*c[3]),F=function(Ce){const Re=U(Ce,0,2);return Math.min(Math.round(.5*Re*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],N=U(h[0],0,1),W=U(h[1],0,1),Z=U(h[2],0,1),X=U(h[3],0,1);let le,ce,de,Ie;if(N!==W&&g!==p&&W!==N){const Ce=g-p;ce=1/(Ce*(W-N)),de=-(p+Ce*N)/(Ce*(W-N));const Re=U(h[4],-1,1);Ie=Math.pow(10,Re),le=255*Z<<8|255*X}else le=65535,ce=0,de=1,Ie=1;if(o.emplaceBack(C,k,F,le,ce,de,Ie),x){const Ce=x.length;x.clear();for(let Re=0;Re<Ce;Re++)x.emplaceBack(C,k,F,le,ce,de,Ie)}}function p4(o,e,n){const c=o.node;let h=0;const p=n&dp.HasMeshoptCompression;for(const g of c.meshes){if(c.lights&&c.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new Du,g.featureArray.reserve(g.featureData.length);let x=e;for(const b of g.featureData){const E=p?65535&b:b>>16&65535,I=p?b>>16&65535:65535&b,C=(15&I)<8?15&I:0,k=o.evaluatedRMEA[C],F=o.evaluatedColor[C],N=o.emissionHeightBasedParams[C];let W;if(x&&C===2&&c.lights&&(W=new Du,W.resize(10*c.lights.length)),f4(g.featureArray,E,F,k,N,g.aabb.min[2],g.aabb.max[2],W),W&&x){x=!1;const Z=c.meshes[c.lightMeshIndex];Z.featureArray=W,Z.featureArray._trim()}}g.featureArray._trim(),h++}}function aC(o,e,n,c){const h=1<<o.z;e.lat=Te((c/Dt+o.y)/h),e.lng=Ee((n/Dt+o.x)/h)}function m4(o,e,n,c){const h=o.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let p=Number.MAX_VALUE;const g=h.node,x=n.tile,b=c.calculatePosMatrix(x.tileID.toUnwrapped(),c.worldSize),E=h.evaluatedScale;let I=0;c.elevation&&g.elevation&&(I=g.elevation*c.elevation.exaggeration()),ue(b,b,[(g.anchor?g.anchor[0]:0)*(E[0]-1),(g.anchor?g.anchor[1]:0)*(E[1]-1),I]),ie(b,b,E);const C=n.queryGeometry,k=C.isPointQuery()?C.screenBounds:C.screenGeometry,F=function(W){const Z=pe([],b,W.matrix);pe(Z,c.expandedFarZProjMatrix,Z);for(let X=0;X<W.meshes.length;++X){const le=W.meshes[X];if(X===W.lightMeshIndex)continue;const ce=AA(k,c,Z,le.aabb);ce!=null&&(p=Math.min(ce,p))}if(W.children)for(const X of W.children)F(X)};if(F(g),p===Number.MAX_VALUE)return;const N=new G(0,0);return aC(x.tileID.canonical,N,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:p,position:N,feature:h.feature}}Wt(Sx,"Tiled3dModelBucket",{omit:["layers"]}),Wt(oC,"Tiled3dModelFeature");const g4={circle:class extends Ts{constructor(o,e,n,c){super(o,{layout:Lu||(Lu=new rn({"circle-sort-key":new Bt(Be.layout_circle["circle-sort-key"]),"circle-elevation-reference":new It(Be.layout_circle["circle-elevation-reference"]),visibility:new It(Be.layout_circle.visibility)})),paint:tl||(tl=new rn({"circle-radius":new Bt(Be.paint_circle["circle-radius"]),"circle-color":new Bt(Be.paint_circle["circle-color"]),"circle-blur":new Bt(Be.paint_circle["circle-blur"]),"circle-opacity":new Bt(Be.paint_circle["circle-opacity"]),"circle-translate":new It(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new It(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bt(Be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It(Be.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}createBucket(o){return new ts(o)}queryRadius(o){const e=o;return ha("circle-radius",this,e)+ha("circle-stroke-width",this,e)+Gl(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,n,c,h,p,g,x){const b=Oa(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return fE(o,c,p,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,n){const c=dE(this);return{config:new Rc(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ts{createBucket(o){return new mE(o)}constructor(o,e,n,c){super(o,{layout:gE||(gE=new rn({visibility:new It(Be.layout_heatmap.visibility)})),paint:_E||(_E=new rn({"heatmap-radius":new Bt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eu(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(Be.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=O0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return ha("heatmap-radius",this,o)}queryIntersectsFeature(o,e,n,c,h,p,g,x){const b=this.paint.get("heatmap-radius").evaluate(e,n);return fE(o,c,p,g,x,!0,!0,new bt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,n){return o==="heatmap"?{config:new Rc(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Ts{constructor(o,e,n,c){super(o,{layout:yE||(yE=new rn({visibility:new It(Be.layout_hillshade.visibility)})),paint:xE||(xE=new rn({"hillshade-illumination-direction":new It(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It(Be.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}},fill:class extends Ts{constructor(o,e,n,c){super(o,{layout:OE||(OE=new rn({"fill-sort-key":new Bt(Be.layout_fill["fill-sort-key"]),visibility:new It(Be.layout_fill.visibility),"fill-elevation-reference":new It(Be.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Bt(Be.layout_fill["fill-construct-bridge-guard-rail"])})),paint:LE||(LE=new rn({"fill-antialias":new It(Be.paint_fill["fill-antialias"]),"fill-opacity":new Bt(Be.paint_fill["fill-opacity"]),"fill-color":new Bt(Be.paint_fill["fill-color"]),"fill-outline-color":new Bt(Be.paint_fill["fill-outline-color"]),"fill-translate":new It(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new It(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bt(Be.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new It(Be.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new It(Be.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bt(Be.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Bt(Be.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Bt(Be.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(o,e,n){return{config:new Rc(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Mw(o)}queryRadius(){return Gl(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,n,c,h,p){return!o.queryGeometry.isAboveHorizon&&no(Hl(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ts{constructor(o,e,n,c){super(o,{layout:nA||(nA=new rn({visibility:new It(Be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:sA||(sA=new rn({"fill-extrusion-opacity":new It(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new It(Be["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new It(Be["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new It(Be["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new It(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It(Be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It(Be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bt(Be["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new It(Be["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Ky(o)}queryRadius(){return Gl(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,n,c,h,p,g,x,b){const E=Oa(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),k=[0,0],F=x&&p.elevation,N=p.elevation?p.elevation.exaggeration():1,W=o.tile.getBucket(this);if(F&&W instanceof Ky){const de=W.centroidVertexArray,Ie=b+1;Ie<de.length&&(k[0]=de.geta_centroid_pos0(Ie),k[1]=de.geta_centroid_pos1(Ie))}if(k[0]===0&&k[1]===1)return!1;p.projection.name==="globe"&&(c=iA([c],[new bt(0,0),new bt(Dt,Dt)],o.tileID.canonical).map(de=>de.polygon).flat());const Z=F?x:null,[X,le]=function(de,Ie,Ce,Re,Le,Fe,dt,je,pt,wt,mt){return de.projection.name==="globe"?function(_t,Et,lt,yt,Je,Ze,At,Tt,hr,Gt,Jt){const Rt=[],cr=[],Mr=_t.projection.upVectorScale(Jt,_t.center.lat,_t.worldSize).metersToTile,Nt=[0,0,0,1],rr=[0,0,0,1],Tr=(qr,Nr,Yt,Fr)=>{qr[0]=Nr,qr[1]=Yt,qr[2]=Fr,qr[3]=1},Lr=rA();lt>0&&(lt+=Lr),yt+=Lr;for(const qr of Et){const Nr=[],Yt=[];for(const Fr of qr){const ni=Fr.x+Je.x,ye=Fr.y+Je.y,xe=_t.projection.projectTilePoint(ni,ye,Jt),Ke=_t.projection.upVector(Jt,Fr.x,Fr.y);let ut=lt,Ft=yt;if(At){const Lt=hA(ni,ye,lt,yt,At,Tt,hr,Gt);ut+=Lt.base,Ft+=Lt.top}lt!==0?Tr(Nt,xe.x+Ke[0]*Mr*ut,xe.y+Ke[1]*Mr*ut,xe.z+Ke[2]*Mr*ut):Tr(Nt,xe.x,xe.y,xe.z),Tr(rr,xe.x+Ke[0]*Mr*Ft,xe.y+Ke[1]*Mr*Ft,xe.z+Ke[2]*Mr*Ft),Qt(Nt,Nt,Ze),Qt(rr,rr,Ze),Nr.push(new ld(Nt[0],Nt[1],Nt[2])),Yt.push(new ld(rr[0],rr[1],rr[2]))}Rt.push(Nr),cr.push(Yt)}return[Rt,cr]}(de,Ie,Ce,Re,Le,Fe,dt,je,pt,wt,mt):dt?function(_t,Et,lt,yt,Je,Ze,At,Tt,hr){const Gt=[],Jt=[],Rt=[0,0,0,1];for(const cr of _t){const Mr=[],Nt=[];for(const rr of cr){const Tr=rr.x+yt.x,Lr=rr.y+yt.y,qr=hA(Tr,Lr,Et,lt,Ze,At,Tt,hr);Rt[0]=Tr,Rt[1]=Lr,Rt[2]=qr.base,Rt[3]=1,un(Rt,Rt,Je),Rt[3]=Math.max(Rt[3],1e-5);const Nr=new ld(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Rt[0]=Tr,Rt[1]=Lr,Rt[2]=qr.top,Rt[3]=1,un(Rt,Rt,Je),Rt[3]=Math.max(Rt[3],1e-5);const Yt=new ld(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Mr.push(Nr),Nt.push(Yt)}Gt.push(Mr),Jt.push(Nt)}return[Gt,Jt]}(Ie,Ce,Re,Le,Fe,dt,je,pt,wt):function(_t,Et,lt,yt,Je){const Ze=[],At=[],Tt=Je[8]*Et,hr=Je[9]*Et,Gt=Je[10]*Et,Jt=Je[11]*Et,Rt=Je[8]*lt,cr=Je[9]*lt,Mr=Je[10]*lt,Nt=Je[11]*lt;for(const rr of _t){const Tr=[],Lr=[];for(const qr of rr){const Nr=qr.x+yt.x,Yt=qr.y+yt.y,Fr=Je[0]*Nr+Je[4]*Yt+Je[12],ni=Je[1]*Nr+Je[5]*Yt+Je[13],ye=Je[2]*Nr+Je[6]*Yt+Je[14],xe=Je[3]*Nr+Je[7]*Yt+Je[15],Ke=Fr+Tt,ut=ni+hr,Ft=ye+Gt,Lt=Math.max(xe+Jt,1e-5),qt=Fr+Rt,pr=ni+cr,Zr=ye+Mr,Kr=Math.max(xe+Nt,1e-5);Tr.push(new ld(Ke/Lt,ut/Lt,Ft/Lt)),Lr.push(new ld(qt/Kr,pr/Kr,Zr/Kr))}Ze.push(Tr),At.push(Lr)}return[Ze,At]}(Ie,Ce,Re,Le,Fe)}(p,c,C,I,E,g,Z,k,N,p.center.lat,o.tileID.canonical),ce=o.queryGeometry;return function(de,Ie,Ce){let Re=1/0;no(Ce,Ie)&&(Re=uA(Ce,Ie[0]));for(let Le=0;Le<Ie.length;Le++){const Fe=Ie[Le],dt=de[Le];for(let je=0;je<Fe.length-1;je++){const pt=Fe[je],wt=[pt,Fe[je+1],dt[je+1],dt[je],pt];Ao(Ce,wt)&&(Re=Math.min(Re,uA(Ce,wt)))}}return Re!==1/0&&Re}(X,le,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},building:class extends Ts{constructor(o,e,n,c){super(o,{layout:FA||(FA=new rn({visibility:new It(Be.layout_building.visibility),"building-facade":new Bt(Be.layout_building["building-facade"]),"building-facade-floors":new Bt(Be.layout_building["building-facade-floors"]),"building-facade-unit-width":new Bt(Be.layout_building["building-facade-unit-width"]),"building-facade-window":new Bt(Be.layout_building["building-facade-window"]),"building-roof-shape":new Bt(Be.layout_building["building-roof-shape"]),"building-height":new Bt(Be.layout_building["building-height"]),"building-base":new Bt(Be.layout_building["building-base"]),"building-flood-light-wall-radius":new Bt(Be.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Bt(Be.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Bt(Be.layout_building["building-flip-roof-orientation"])})),paint:NA||(NA=new rn({"building-opacity":new It(Be.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new It(Be.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new It(Be.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new It(Be.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new It(Be.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new It(Be.paint_building["building-vertical-scale"]),"building-cast-shadows":new It(Be.paint_building["building-cast-shadows"]),"building-color":new Bt(Be.paint_building["building-color"]),"building-emissive-strength":new Bt(Be.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new It(Be.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new It(Be.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new It(Be.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new It(Be.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new It(Be.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new LA(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}},line:class extends Ts{constructor(o,e,n,c){const h=qA();super(o,h,e,n,c),h.layout&&(this.layout=new Ec(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Vh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Y0)return Y0;const n=qA();return Y0=new pF(n.paint.properties["line-width"].specification),Y0.useIntegerZoom=!0,Y0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new tb(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,n){const c=HA(this);return{config:new Rc(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}queryRadius(o){const e=o,n=ZA(ha("line-width",this,e),ha("line-gap-width",this,e)),c=ha("line-offset",this,e);return n/2+Math.abs(c)+Gl(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,n,c,h,p){if(o.queryGeometry.isAboveHorizon)return!1;const g=Hl(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*ZA(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(c=function(E,I){const C=[],k=new bt(0,0);for(let F=0;F<E.length;F++){const N=E[F],W=[];for(let Z=0;Z<N.length;Z++){const X=N[Z],le=N[Z+1],ce=Z===0?k:X.sub(N[Z-1])._unit()._perp(),de=Z===N.length-1?k:le.sub(X)._unit()._perp(),Ie=ce._add(de)._unit();Ie._mult(1/(Ie.x*de.x+Ie.y*de.y)),W.push(Ie._mult(I)._add(X))}C.push(W)}return C}(c,b*o.pixelToTileUnitsFactor)),function(E,I,C){for(let k=0;k<I.length;k++){const F=I[k];if(E.length>=3){for(let N=0;N<F.length;N++)if(Wn(E,F[N]))return!0}if(so(E,F,C))return!0}return!1}(g,c,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:vx,background:class extends Ts{constructor(o,e,n,c){super(o,{layout:BI||(BI=new rn({visibility:new It(Be.layout_background.visibility)})),paint:jI||(jI=new rn({"background-pitch-alignment":new It(Be.paint_background["background-pitch-alignment"]),"background-color":new It(Be.paint_background["background-color"]),"background-pattern":new It(Be.paint_background["background-pattern"]),"background-opacity":new It(Be.paint_background["background-opacity"]),"background-emissive-strength":new It(Be.paint_background["background-emissive-strength"]),"background-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:HI,"raster-particle":YI,sky:class extends Ts{constructor(o,e,n,c){super(o,{layout:ZI||(ZI=new rn({visibility:new It(Be.layout_sky.visibility)})),paint:XI||(XI=new rn({"sky-type":new It(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new It(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eu(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It(Be.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=O0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,p=o.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&$t("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?vb(g.azimuthal,90-g.polar,e):vb(c[0],90-c[1],e)}const n=this.paint.get("sky-gradient-center");return vb(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Ts{constructor(o,e,n,c){super(o,{paint:KI||(KI=new rn({}))},e,null)}},model:class extends Ts{constructor(o,e,n,c){super(o,{layout:tC||(tC=new rn({visibility:new It(Be.layout_model.visibility),"model-id":new Bt(Be.layout_model["model-id"])})),paint:rC||(rC=new rn({"model-opacity":new Bt(Be.paint_model["model-opacity"]),"model-rotation":new Bt(Be.paint_model["model-rotation"]),"model-scale":new Bt(Be.paint_model["model-scale"]),"model-translation":new Bt(Be.paint_model["model-translation"]),"model-color":new Bt(Be.paint_model["model-color"]),"model-color-mix-intensity":new Bt(Be.paint_model["model-color-mix-intensity"]),"model-type":new It(Be.paint_model["model-type"]),"model-cast-shadows":new It(Be.paint_model["model-cast-shadows"]),"model-receive-shadows":new It(Be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It(Be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bt(Be.paint_model["model-emissive-strength"]),"model-roughness":new Bt(Be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bt(Be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It(Be.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It(Be.paint_model["model-front-cutoff"]),"model-elevation-reference":new It(Be.paint_model["model-elevation-reference"]),"model-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new bb(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Sx?Dt-1:0}queryIntersectsFeature(o,e,n,c,h,p){if(!this.modelManager)return!1;const g=this.modelManager,x=o.tile.getBucket(this);if(!(x&&x instanceof bb))return!1;for(const b in x.instancesPerModel){const E=x.instancesPerModel[b],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(I)){const C=E.features[E.idToFeaturesIndex[I]],k=g.getModel(b,this.scope);if(!k)return!1;let F=re();const N=new G(0,0),W=x.canonical;let Z=Number.MAX_VALUE;for(let X=0;X<C.instancedDataCount;++X){const le=16*(C.instancedDataOffset+X),ce=E.instancedDataArray.float32,de=[ce[le+4],ce[le+5],ce[le+6]];aC(W,N,ce[le],0|ce[le+1]),IA(F,k,p,N,C.rotation,C.scale,de,!1,!1,!1),p.projection.name==="globe"&&(F=Xw(F,p));const Ie=pe([],p.projMatrix,F),Ce=o.queryGeometry,Re=AA(Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry,p,Ie,k.aabb);Re!=null&&(Z=Math.min(Re,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(o,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ll}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ts{constructor(o,e,n,c){super(o,{layout:FE||(FE=new rn({"clip-layer-types":new It(Be.layout_clip["clip-layer-types"]),"clip-layer-scope":new It(Be.layout_clip["clip-layer-scope"])})),paint:NE||(NE=new rn({}))},e,n,c)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new zE(o)}is3D(o){return!0}}},Sb=new _i(0,0,0),Eb={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Ab={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Ex={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},_4={PAINT_ORDER_FILL_AND_STROKE:1},ug={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},lC={MASK_TYPE_LUMINANCE:1};function y4(o,e,n){o===1&&e.icons.push(function(c,h){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:g}=p;if(g.content_area){const{content_area:x}=g;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=p.usvg_tree.width),x.height==null&&(x.height=x.width)}if(g.text_placeholder){const{text_placeholder:x}=g;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return g.stretch_x&&g.stretch_x.length&&cC(g,"x"),g.stretch_y&&g.stretch_y.length&&cC(g,"y"),p}(c.readFields(x4,{name:void 0},h))}(n,n.readVarint()+n.pos))}function cC(o,e){const n=[],c=o[`stretch_${e}`];let h=null;for(let p=0;p<c.length;p++)h===null?h=n.length===0?c[0]:n[n.length-1][1]+c[p]:(n.push([h,h+c[p]]),h=null);o[`stretch_${e}_areas`]=n}function x4(o,e,n){o===1?e.name=n.readString():o===2?e.metadata=function(c,h){return c.readFields(v4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(n,n.readVarint()+n.pos):o===3&&(e.usvg_tree=function(c,h){return c.readFields(T4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function v4(o,e,n){o===1?e.stretch_x=n.readPackedVarint():o===2?e.stretch_y=n.readPackedVarint():o===3?e.content_area=uC(n,n.readVarint()+n.pos):o===4?e.variables.push(function(c,h){return c.readFields(b4,{name:void 0},h)}(n,n.readVarint()+n.pos)):o===5&&(e.text_placeholder=uC(n,n.readVarint()+n.pos))}function uC(o,e){return o.readFields(w4,{},e)}function w4(o,e,n){o===1?e.left=n.readVarint():o===2?e.width=n.readVarint():o===3?e.top=n.readVarint():o===4&&(e.height=n.readVarint())}function b4(o,e,n){o===1?e.name=n.readString():o===2&&(e.rgb_color=Cx(n.readVarint()),e.value="rgb_color")}function T4(o,e,n){o===1?e.width=e.height=n.readVarint():o===2?e.height=n.readVarint():o===3?e.children.push(Ax(n,n.readVarint()+n.pos)):o===4?e.linear_gradients.push(function(c,h){return c.readFields(k4,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(n,n.readVarint()+n.pos)):o===5?e.radial_gradients.push(function(c,h){return c.readFields(M4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(n,n.readVarint()+n.pos)):o===7?e.clip_paths.push(function(c,h){return c.readFields(D4,{children:[]},h)}(n,n.readVarint()+n.pos)):o===8&&e.masks.push(function(c,h){const p=c.readFields(O4,{left:0,width:20,mask_type:lC.MASK_TYPE_LUMINANCE,children:[]},h);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(n,n.readVarint()+n.pos))}function Ax(o,e){return o.readFields(S4,{},e)}function S4(o,e,n){o===1?(e.group=function(c,h){return c.readFields(E4,{opacity:255,children:[]},h)}(n,n.readVarint()+n.pos),e.node="group"):o===2&&(e.path=function(c,h){return c.readFields(I4,{paint_order:1,commands:[],step:1,diffs:[],rule:Eb.PATH_RULE_NON_ZERO},h)}(n,n.readVarint()+n.pos),e.node="path")}function E4(o,e,n){o===1?e.transform=Ix(n,n.readVarint()+n.pos):o===2?e.opacity=n.readVarint():o===5?e.clip_path_idx=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(Ax(n,n.readVarint()+n.pos))}function Ix(o,e){return o.readFields(A4,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function A4(o,e,n){o===1?e.sx=n.readFloat():o===2?e.ky=n.readFloat():o===3?e.kx=n.readFloat():o===4?e.sy=n.readFloat():o===5?e.tx=n.readFloat():o===6&&(e.ty=n.readFloat())}function I4(o,e,n){o===1?e.fill=function(c,h){return c.readFields(C4,{rgb_color:Sb,paint:"rgb_color",opacity:255},h)}(n,n.readVarint()+n.pos):o===2?e.stroke=function(c,h){return c.readFields(P4,{rgb_color:Sb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(n,n.readVarint()+n.pos):o===3?e.paint_order=n.readVarint():o===5?n.readPackedVarint(e.commands):o===6?e.step=n.readFloat():o===7?n.readPackedSVarint(e.diffs):o===8&&(e.rule=n.readVarint())}function C4(o,e,n){o===1?(e.rgb_color=Cx(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=n.readVarint())}function Cx(o){return new _i((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function P4(o,e,n){o===1?(e.rgb_color=Cx(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5?n.readPackedFloat(e.dasharray):o===6?e.dashoffset=n.readFloat():o===7?e.miterlimit=n.readFloat():o===8?e.opacity=n.readVarint():o===9?e.width=n.readFloat():o===10?e.linecap=n.readVarint():o===11&&(e.linejoin=n.readVarint())}function k4(o,e,n){o===1?e.transform=Ix(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(hC(n,n.readVarint()+n.pos)):o===4?e.x1=n.readFloat():o===5?e.y1=n.readFloat():o===6?e.x2=n.readFloat():o===7&&(e.y2=n.readFloat())}function hC(o,e){return o.readFields(R4,{offset:0,opacity:255,rgb_color:Sb},e)}function R4(o,e,n){o===1?e.offset=n.readFloat():o===2?e.opacity=n.readVarint():o===3&&(e.rgb_color=Cx(n.readVarint()))}function M4(o,e,n){o===1?e.transform=Ix(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(hC(n,n.readVarint()+n.pos)):o===4?e.cx=n.readFloat():o===5?e.cy=n.readFloat():o===6?e.r=n.readFloat():o===7?e.fx=n.readFloat():o===8?e.fy=n.readFloat():o===9&&(e.fr=n.readFloat())}function D4(o,e,n){o===1?e.transform=Ix(n,n.readVarint()+n.pos):o===2?e.clip_path_idx=n.readVarint():o===3&&e.children.push(Ax(n,n.readVarint()+n.pos))}function O4(o,e,n){o===1?e.left=e.top=n.readFloat():o===2?e.width=e.height=n.readFloat():o===3?e.top=n.readFloat():o===4?e.height=n.readFloat():o===5?e.mask_type=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(Ax(n,n.readVarint()+n.pos))}class L4{static calculate(e={},n=[]){const c=new Map,h=new Map;if(Object.keys(e).length===0)return c;n.forEach(p=>{h.set(p.name,p.rgb_color||new _i(0,0,0))});for(const[p,g]of Object.entries(e))h.has(p)?c.set(h.get(p).toString(),g):console.warn(`Ignoring unknown image variable "${p}"`);return c}}function xp(o,e=255,n){const c=e/255,h=o.toString(),p=n.has(h)?n.get(h).clone():o.clone();return p.a*=c,p.toString()}function hg(o,e){if(!Tm()){const n=document.createElement("canvas");return n.width=o,n.height=e,n}return new OffscreenCanvas(o,e)}function F4(o,e){const n=L4.calculate(e.params,o.metadata?o.metadata.variables:[]),c=o.usvg_tree,h=c.width,p=c.height,g=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(h*g.a)),b=Math.max(1,Math.round(p*g.d)),E=new DOMMatrix([x/h,0,0,b/p,0,0]),I=hg(x,b).getContext("2d");return Ib(I,E,c,c,n),I.getImageData(0,0,x,b)}function Ib(o,e,n,c,h){for(const p of c.children)dC(o,e,n,p,h)}function dC(o,e,n,c,h){c.group?(o.save(),function(p,g,x,b,E){const I=b.mask_idx!=null?x.masks[b.mask_idx]:null,C=b.clip_path_idx!=null?x.clip_paths[b.clip_path_idx]:null;if(b.transform&&(g=vp(b.transform).preMultiplySelf(g)),!function(N,W,Z){return N.opacity!==255||W||Z}(b,C!=null,I!=null))return void Ib(p,g,x,b,E);const k=hg(p.canvas.width,p.canvas.height),F=k.getContext("2d");Ib(F,g,x,b,E),C&&xC(F,g,x,C),I&&vC(F,g,x,I,E),p.globalAlpha=b.opacity/255,p.drawImage(k,0,0)}(o,e,n,c.group,h),o.restore()):c.path&&(o.save(),function(p,g,x,b,E){p.setTransform(g),b.paint_order===_4.PAINT_ORDER_FILL_AND_STROKE?(fC(p,x,b,E),mC(p,x,b,E)):(mC(p,x,b,E),fC(p,x,b,E))}(o,e,n,c.path,h),o.restore())}function fC(o,e,n,c){const h=n.fill;if(!h)return;const p=h.opacity/255;switch(o.save(),o.beginPath(),wC(n,o),h.paint){case"rgb_color":o.fillStyle=xp(h.rgb_color,h.opacity,c);break;case"linear_gradient_idx":{const g=e.linear_gradients[h.linear_gradient_idx];g.transform&&o.setTransform(vp(g.transform).preMultiplySelf(o.getTransform())),o.fillStyle=gC(o,g,p,c);break}case"radial_gradient_idx":{const g=e.radial_gradients[h.radial_gradient_idx];g.transform&&o.setTransform(vp(g.transform).preMultiplySelf(o.getTransform())),o.fillStyle=_C(o,g,p,c)}}o.fill(pC(n)),o.restore()}function pC(o){return o.rule===Eb.PATH_RULE_NON_ZERO?"nonzero":o.rule===Eb.PATH_RULE_EVEN_ODD?"evenodd":void 0}function mC(o,e,n,c){const h=n.stroke;if(!h)return;const p=bC(n);o.lineWidth=h.width,o.miterLimit=h.miterlimit,o.setLineDash(h.dasharray),o.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":o.strokeStyle=xp(h.rgb_color,h.opacity,c);break;case"linear_gradient_idx":o.strokeStyle=gC(o,e.linear_gradients[h.linear_gradient_idx],g,c,!0);break;case"radial_gradient_idx":o.strokeStyle=_C(o,e.radial_gradients[h.radial_gradient_idx],g,c,!0)}switch(h.linejoin){case Ex.LINE_JOIN_MITER_CLIP:case Ex.LINE_JOIN_MITER:o.lineJoin="miter";break;case Ex.LINE_JOIN_ROUND:o.lineJoin="round";break;case Ex.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(h.linecap){case Ab.LINE_CAP_BUTT:o.lineCap="butt";break;case Ab.LINE_CAP_ROUND:o.lineCap="round";break;case Ab.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(p)}function gC(o,e,n,c,h=!1){if(e.stops.length===1){const k=e.stops[0];return xp(k.rgb_color,k.opacity*n,c)}const{x1:p,y1:g,x2:x,y2:b}=e;let E=new DOMPoint(p,g),I=new DOMPoint(x,b);if(h){const k=vp(e.transform);E=k.transformPoint(E),I=k.transformPoint(I)}const C=o.createLinearGradient(E.x,E.y,I.x,I.y);for(const k of e.stops)C.addColorStop(k.offset,xp(k.rgb_color,k.opacity*n,c));return C}function _C(o,e,n,c,h=!1){if(e.stops.length===1){const X=e.stops[0];return xp(X.rgb_color,X.opacity*n,c)}const p=vp(e.transform),{fx:g,fy:x,fr:b,cx:E,cy:I,r:C}=e;let k=new DOMPoint(g,x),F=new DOMPoint(E,I),N=b,W=C;if(h){k=p.transformPoint(k),F=p.transformPoint(F);const X=(p.a+p.d)/2;N=b*X,W=e.r*X}const Z=o.createRadialGradient(k.x,k.y,N,F.x,F.y,W);for(const X of e.stops)Z.addColorStop(X.offset,xp(X.rgb_color,X.opacity*n,c));return Z}function yC(o,e,n,c){const h=c.transform?vp(c.transform).preMultiplySelf(e):e,p=hg(o.canvas.width,o.canvas.height),g=p.getContext("2d");for(const b of c.children)if(b.group)yC(g,h,n,b.group);else if(b.path){const E=b.path,I=new Path2D;I.addPath(bC(E),h),g.fill(I,pC(E))}const x=c.clip_path_idx!=null?n.clip_paths[c.clip_path_idx]:null;x&&xC(g,h,n,x),o.globalCompositeOperation="source-over",o.drawImage(p,0,0)}function xC(o,e,n,c){const h=hg(o.canvas.width,o.canvas.height);yC(h.getContext("2d"),e,n,c),o.globalCompositeOperation="destination-in",o.drawImage(h,0,0)}function vC(o,e,n,c,h){if(c.children.length===0)return;const p=c.mask_idx!=null?n.masks[c.mask_idx]:null;p&&vC(o,e,n,p,h);const g=o.canvas.width,x=o.canvas.height,b=hg(g,x),E=b.getContext("2d"),I=c.width,C=c.height,k=c.left,F=c.top,N=new Path2D,W=new Path2D;W.rect(k,F,I,C),N.addPath(W,e),E.clip(N);for(const le of c.children)dC(E,e,n,le,h);const Z=E.getImageData(0,0,g,x),X=Z.data;if(c.mask_type===lC.MASK_TYPE_LUMINANCE)for(let le=0;le<X.length;le+=4)X[le+3]=X[le+3]/255*(.2126*X[le]+.7152*X[le+1]+.0722*X[le+2]);E.putImageData(Z,0,0),o.globalCompositeOperation="destination-in",o.drawImage(b,0,0)}function vp(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function wC(o,e){const n=o.step;let c=o.diffs[0]*n,h=o.diffs[1]*n;e.moveTo(c,h);for(let p=0,g=2;p<o.commands.length;p++)switch(o.commands[p]){case ug.PATH_COMMAND_MOVE:c+=o.diffs[g++]*n,h+=o.diffs[g++]*n,e.moveTo(c,h);break;case ug.PATH_COMMAND_LINE:c+=o.diffs[g++]*n,h+=o.diffs[g++]*n,e.lineTo(c,h);break;case ug.PATH_COMMAND_QUAD:{const x=c+o.diffs[g++]*n,b=h+o.diffs[g++]*n;c=x+o.diffs[g++]*n,h=b+o.diffs[g++]*n,e.quadraticCurveTo(x,b,c,h);break}case ug.PATH_COMMAND_CUBIC:{const x=c+o.diffs[g++]*n,b=h+o.diffs[g++]*n,E=x+o.diffs[g++]*n,I=b+o.diffs[g++]*n;c=E+o.diffs[g++]*n,h=I+o.diffs[g++]*n,e.bezierCurveTo(x,b,E,I,c,h);break}case ug.PATH_COMMAND_CLOSE:e.closePath()}return e}function bC(o){return wC(o,new Path2D)}class Px{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}Wt(Px,"LRUCache");class Cb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ds(e,e.data)}getFromCache(e,n,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new Px(150)),this.cacheMap.get(c).get(Iu(e.toString(),n))}setInCache(e,n,c,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Px(150));const p=this.cacheDependenciesMap.get(h),g=Iu(e.id.toString(),c);p.get(g)||p.set(g,new Set);const x=this.cacheMap.get(h),b=e.toString();p.get(g).add(b),x.put(Iu(e.toString(),c),n)}removeImagesFromCacheByIds(e,n,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const h=this.cacheMap.get(c),p=this.cacheDependenciesMap.get(c);for(const g of e){const x=Iu(g.toString(),n);if(p.has(x)){for(const b of p.get(x))h.delete(b);p.delete(x)}}}rasterize(e,n,c,h,p=F4){const g=this.getFromCache(e,c,h);if(g)return g.clone();const x=p(n.icon,e.options),b=Cb._getImage(x);return this.setInCache(e,b,c,h),b.clone()}}class TC{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const c=this.toIdx(e,n);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function SC(o,e,n,c){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(c[g])<1e-15){if(n[g]<o[g]||n[g]>e[g])return null}else{const x=1/c[g];let b=(o[g]-n[g])*x,E=(e[g]-n[g])*x;if(b>E){const I=b;b=E,E=I}if(b>h&&(h=b),E<p&&(p=E),h>p)return null}return h}function EC(o,e,n,c,h,p,g,x,b,E,I){const C=c-o,k=h-e,F=p-n,N=g-o,W=x-e,Z=b-n,X=I[1]*Z-I[2]*W,le=I[2]*N-I[0]*Z,ce=I[0]*W-I[1]*N,de=C*X+k*le+F*ce;if(Math.abs(de)<1e-15)return null;const Ie=1/de,Ce=E[0]-o,Re=E[1]-e,Le=E[2]-n,Fe=(Ce*X+Re*le+Le*ce)*Ie;if(Fe<0||Fe>1)return null;const dt=Re*F-Le*k,je=Le*C-Ce*F,pt=Ce*k-Re*C,wt=(I[0]*dt+I[1]*je+I[2]*pt)*Ie;return wt<0||Fe+wt>1?null:(N*dt+W*je+Z*pt)*Ie}function AC(o,e,n){return(o-e)/(n-e)}function IC(o,e,n,c,h,p,g,x,b){const E=1<<n,I=p-c,C=g-h,k=(o+1)/E*I+c,F=(e+0)/E*C+h,N=(e+1)/E*C+h;x[0]=(o+0)/E*I+c,x[1]=F,b[0]=k,b[1]=N}class CC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(p){const g=Math.ceil(Math.log2(p.dim/8)),x=[];let b=Math.ceil(Math.pow(2,g));const E=1/b,I=(F,N,W,Z,X)=>{const le=Z?1:0,ce=(F+1)*W-le,de=N*W,Ie=(N+1)*W-le;X[0]=F*W,X[1]=de,X[2]=ce,X[3]=Ie};let C=new TC(b);const k=[];for(let F=0;F<b*b;F++){I(F%b,Math.floor(F/b),E,!1,k);const N=$u(k[0],k[1],p),W=$u(k[2],k[1],p),Z=$u(k[2],k[3],p),X=$u(k[0],k[3],p);C.minimums.push(Math.min(N,W,Z,X)),C.maximums.push(Math.max(N,W,Z,X)),C.leaves.push(1)}for(x.push(C),b/=2;b>=1;b/=2){const F=x[x.length-1];C=new TC(b);for(let N=0;N<b*b;N++){I(N%b,Math.floor(N/b),2,!0,k);const W=F.getElevation(k[0],k[1]),Z=F.getElevation(k[2],k[1]),X=F.getElevation(k[2],k[3]),le=F.getElevation(k[0],k[3]),ce=F.isLeaf(k[0],k[1]),de=F.isLeaf(k[2],k[1]),Ie=F.isLeaf(k[2],k[3]),Ce=F.isLeaf(k[0],k[3]),Re=Math.min(W.min,Z.min,X.min,le.min),Le=Math.max(W.max,Z.max,X.max,le.max),Fe=ce&&de&&Ie&&Ce;C.maximums.push(Le),C.minimums.push(Re),C.leaves.push(Le-Re<=5&&Fe?1:0)}x.push(C)}return x}(this.dem),c=n.length-1,h=n[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,c,0)}raycastRoot(e,n,c,h,p,g,x=1){return SC([e,n,-100],[c,h,this.maximums[0]*x],p,g)}raycast(e,n,c,h,p,g,x=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,c,h,p,g,x);if(b==null)return null;const E=[],I=[],C=[],k=[],F=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:N,t:W,nodex:Z,nodey:X,depth:le}=F.pop();if(this.leaves[N]){IC(Z,X,le,e,n,c,h,C,k);const de=1<<le,Ie=(Z+0)/de,Ce=(Z+1)/de,Re=(X+0)/de,Le=(X+1)/de,Fe=$u(Ie,Re,this.dem)*x,dt=$u(Ce,Re,this.dem)*x,je=$u(Ce,Le,this.dem)*x,pt=$u(Ie,Le,this.dem)*x,wt=EC(C[0],C[1],Fe,k[0],C[1],dt,k[0],k[1],je,p,g),mt=EC(k[0],k[1],je,C[0],k[1],pt,C[0],C[1],Fe,p,g),_t=Math.min(wt!==null?wt:Number.MAX_VALUE,mt!==null?mt:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{const Et=Ue([],p,g,W);if(PC(Fe,dt,pt,je,AC(Et[0],C[0],k[0]),AC(Et[1],C[1],k[1]))>=Et[2])return W}continue}let ce=0;for(let de=0;de<this._siblingOffset.length;de++){IC((Z<<1)+this._siblingOffset[de][0],(X<<1)+this._siblingOffset[de][1],le+1,e,n,c,h,C,k),C[2]=-100,k[2]=this.maximums[this.childOffsets[N]+de]*x;const Ie=SC(C,k,p,g);if(Ie!=null){const Ce=Ie;E[de]=Ce;let Re=!1;for(let Le=0;Le<ce&&!Re;Le++)Ce>=E[I[Le]]&&(I.splice(Le,0,de),Re=!0);Re||(I[ce]=de),ce++}}for(let de=0;de<ce;de++){const Ie=I[de];F.push({idx:this.childOffsets[N]+Ie,t:E[Ie],nodex:(Z<<1)+this._siblingOffset[Ie][0],nodey:(X<<1)+this._siblingOffset[Ie][1],depth:le+1})}}return null}_addNode(e,n,c){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,c,h,p){if(e[h].isLeaf(n,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,x=e[g];let b=0,E=0;for(let I=0;I<this._siblingOffset.length;I++){const C=2*n+this._siblingOffset[I][0],k=2*c+this._siblingOffset[I][1],F=x.getElevation(C,k),N=x.isLeaf(C,k),W=this._addNode(F.min,F.max,N);N&&(b|=1<<I),E||(E=W)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(e,2*n+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],g,E+I)}}function PC(o,e,n,c,h,p){return wr(wr(o,n,p),wr(e,c,p),h)}function $u(o,e,n){const c=n.dim,h=U(o*c-.5,0,c-1),p=U(e*c-.5,0,c-1),g=Math.floor(h),x=Math.floor(p),b=Math.min(g+1,c-1),E=Math.min(x+1,c-1);return PC(n.get(g,x),n.get(b,x),n.get(g,E),n.get(b,E),h-g,p-x)}const N4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function z4(o,e,n){return(256*o*256+256*e+n)/10-1e4}function B4(o,e,n){return 256*o+e+n/256-32768}class kx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,c,h=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void $t(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2,g=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<p;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(p,b)]=g[this._idx(p-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,p)]=g[this._idx(b,p-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(p,-1)]=g[this._idx(p-1,0)],g[this._idx(-1,p)]=g[this._idx(0,p-1)],g[this._idx(p,p)]=g[this._idx(p-1,p-1)]}const x=c==="terrarium"?B4:z4;for(let b=0;b<g.length;++b){const E=4*b;this.floatView[b]=x(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Aa.now()}_buildQuadTree(){this._tree=new CC(this)}get(e,n,c=!1){c&&(e=U(e,-1,this.dim),n=U(n,-1,this.dim));const h=this._idx(e,n);return this.floatView[h]}set(e,n,c){const h=this._idx(e,n),p=this.floatView[h];return this.floatView[h]=c,c-p}static getUnpackVector(e){return N4[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const c=[0,0,0,0],h=kx.getUnpackVector(n);let p=Math.floor((e+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new bE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,p=n*this.dim+this.dim,g=c*this.dim,x=c*this.dim+this.dim;switch(n){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:g=x-1;break;case 1:x=g+1}const b=-n*this.dim,E=-c*this.dim;for(let I=g;I<x;I++)for(let C=h;C<p;C++){const k=4*this._idx(C,I),F=4*this._idx(C+b,I+E);this.pixels[k+0]=e.pixels[F+0],this.pixels[k+1]=e.pixels[F+1],this.pixels[k+2]=e.pixels[F+2],this.pixels[k+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function j4(o,e,n){o===1?e.headerLength=n.readFixed32():o===2?e.x=n.readVarint():o===3?e.y=n.readVarint():o===4?e.z=n.readVarint():o===5&&e.layers.push(function(c,h){return c.readFields(H4,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(n,n.readVarint()+n.pos))}function U4(o,e,n){o===1?(e.delta_filter=function(c,h){return c.readFields(V4,{blockSize:0},h)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):o===2?(n.readVarint(),e.filter="zigzag_filter"):o===3?(n.readVarint(),e.filter="bitshuffle_filter"):o===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function V4(o,e,n){o===1&&(e.blockSize=n.readVarint())}function $4(o,e,n){o===1?(n.readVarint(),e.codec="gzip_data"):o===2?(n.readVarint(),e.codec="jpeg_image"):o===3?(n.readVarint(),e.codec="webp_image"):o===4&&(n.readVarint(),e.codec="png_image")}function G4(o,e,n){let c=0,h=0;o===1?e.firstByte=n.readFixed64():o===2?e.lastByte=n.readFixed64():o===3?e.filters.push(function(p,g){return p.readFields(U4,{},g)}(n,n.readVarint()+n.pos)):o===4?e.codec=function(p,g){return p.readFields($4,{},g)}(n,n.readVarint()+n.pos):o===5?h=n.readFloat():o===6?c=n.readFloat():o===7?e.bands.push(n.readString()):o===8?e.offset=n.readDouble():o===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=c)}function H4(o,e,n){o===1?e.version=n.readVarint():o===2?e.name=n.readString():o===3?e.units=n.readString():o===4?e.tileSize=n.readVarint():o===5?e.buffer=n.readVarint():o===6?e.pixelFormat=n.readVarint():o===7&&e.dataIndex.push(function(c,h){return c.readFields(G4,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(n,n.readVarint()+n.pos))}function W4(o,e,n){if(o===2)(function(c,h,p){c.readFields(q4,p,h)})(n,n.readVarint()+n.pos,e);else if(o===3)throw new Error("Not implemented")}function q4(o,e,n){if(o===1){let c=0;const h=n.readVarint()+n.pos;for(;n.pos<h;)e[c++]=n.readVarint()}}function Z4(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let c=2;c>=1;c--){const h=c===1?1:0,p=c===2?1:0;for(let g=0;g<e[0];g++){const x=e[1]*g;for(let b=h;b<e[1];b++){const E=e[2]*(b+x);for(let I=p;I<e[2];I++){const C=e[3]*(I+E);for(let k=0;k<e[3];k++){const F=C+k;o[F]+=o[F-n]}}}}n*=e[c]}return o}function X4(o){for(let e=0,n=o.length;e<n;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function K4(o,e){switch(e){case"uint32":return o;case"uint16":for(let n=0;n<o.length;n+=2){const c=o[n],h=o[n+1];o[n]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,o[n+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return o;case"uint8":for(let n=0;n<o.length;n+=4){const c=o[n],h=o[n+1],p=o[n+2],g=o[n+3];o[n+0]=(192&c)>>6|(192&h)>>4|(192&p)>>2|192&g,o[n+1]=(48&c)>>4|(48&h)>>2|48&p|(48&g)<<2,o[n+2]=(12&c)>>2|12&h|(12&p)<<2|(12&g)<<4,o[n+3]=3&c|(3&h)<<2|(3&p)<<4|(3&g)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Wt(kx,"DEMData"),Wt(CC,"DemMinMaxQuadTree",{omit:["dem"]});var da=Uint8Array,dg=Uint16Array,Y4=Int32Array,kC=new da([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),RC=new da([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),J4=new da([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MC=function(o,e){for(var n=new dg(31),c=0;c<31;++c)n[c]=e+=1<<o[c-1];var h=new Y4(n[30]);for(c=1;c<30;++c)for(var p=n[c];p<n[c+1];++p)h[p]=p-n[c]<<5|c;return{b:n,r:h}},DC=MC(kC,2),OC=DC.b,Q4=DC.r;OC[28]=258,Q4[258]=28;for(var eN=MC(RC,0).b,LC=new dg(32768),zn=0;zn<32768;++zn){var wp=(43690&zn)>>1|(21845&zn)<<1;LC[zn]=((65280&(wp=(61680&(wp=(52428&wp)>>2|(13107&wp)<<2))>>4|(3855&wp)<<4))>>8|(255&wp)<<8)>>1}var fg=function(o,e,n){for(var c=o.length,h=0,p=new dg(e);h<c;++h)o[h]&&++p[o[h]-1];var g,x=new dg(e);for(h=1;h<e;++h)x[h]=x[h-1]+p[h-1]<<1;g=new dg(1<<e);var b=15-e;for(h=0;h<c;++h)if(o[h])for(var E=h<<4|o[h],I=e-o[h],C=x[o[h]-1]++<<I,k=C|(1<<I)-1;C<=k;++C)g[LC[C]>>b]=E;return g},pg=new da(288);for(zn=0;zn<144;++zn)pg[zn]=8;for(zn=144;zn<256;++zn)pg[zn]=9;for(zn=256;zn<280;++zn)pg[zn]=7;for(zn=280;zn<288;++zn)pg[zn]=8;var FC=new da(32);for(zn=0;zn<32;++zn)FC[zn]=5;var tN=fg(pg,9),rN=fg(FC,5),Pb=function(o){for(var e=o[0],n=1;n<o.length;++n)o[n]>e&&(e=o[n]);return e},sl=function(o,e,n){var c=e/8|0;return(o[c]|o[c+1]<<8)>>(7&e)&n},kb=function(o,e){var n=e/8|0;return(o[n]|o[n+1]<<8|o[n+2]<<16)>>(7&e)},iN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ol=function(o,e,n){var c=new Error(e||iN[o]);if(c.code=o,Error.captureStackTrace&&Error.captureStackTrace(c,ol),!n)throw c;return c},nN=new da(0),sN=typeof TextDecoder<"u"&&new TextDecoder;try{sN.decode(nN,{stream:!0})}catch{}const oN={gzip_data:"gzip"};class Fa extends Error{constructor(e){super(e),this.name="MRTError"}}const aN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},NC={uint32:1,uint16:2,uint8:4},lN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Rb;class Rx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new Fa(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),c=new DataView(e);if(n[0]!==13)throw new Fa("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),c=this.getHeaderLength(e);if(n.length<c)throw new Fa(`Expected header with length >= ${c} but got buffer of length ${n.length}`);const h=new Rb(n.subarray(0,c)).readFields(j4,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Fa(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new zC(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],c=this.getLayer(e.layerName);for(let h of e.blockIndices){const p=c.dataIndex[h],g=p.firstByte-e.firstByte,x=p.lastByte-e.firstByte;if(c._blocksInProgress.has(h))continue;const b={layerName:c.name,firstByte:g,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};c._blocksInProgress.add(h),n.push(b)}return new BC(n,()=>{n.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(n.forEach(g=>c._blocksInProgress.delete(g.blockIndex)),h)throw h;p.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class zC{constructor({version:e,name:n,units:c,tileSize:h,pixelFormat:p,buffer:g,dataIndex:x},b){if(this.version=e,this.version!==1)throw new Fa(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=c,this.tileSize=h,this.buffer=g,this.pixelFormat=aN[p],this.dataIndex=x,this.bandShape=[h+2*g,h+2*g,NC[this.pixelFormat]],this._decodedBlocks=new Px(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return NC[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[c,h]of this.dataIndex.entries()){for(const[p,g]of h.bands.entries())if(g===e)return{bandIndex:n+p,blockIndex:c,blockBandIndex:p};n+=h.bands.length}break;case"number":for(const[c,h]of this.dataIndex.entries()){if(e>=n&&e<n+h.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-n};n+=h.bands.length}break;default:throw new Fa(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,c=-1/0;const h=[],p=new Set;for(const g of e){const{blockIndex:x}=this.getBlockForBand(g);if(x<0)throw new Fa(`Invalid band: ${JSON.stringify(g)}`);const b=this.dataIndex[x];h.includes(x)||h.push(x),p.add(x),n=Math.min(n,b.firstByte),c=Math.max(c,b.lastByte)}if(p.size>this.cacheSize)throw new Fa(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:c,blockIndices:h}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:c}=this.getBlockForBand(e);if(n<0)throw new Fa(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(n.toString());if(!h)throw new Fa(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[n],g=this.bandShape.reduce((E,I)=>E*I,1),x=c*g,b=h.subarray(x,x+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Rx.setPbf=function(o){Rb=o};class BC{constructor(e,n,c){this.tasks=e,this._onCancel=n,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}Rx.performDecoding=function(o,e){const n=new Uint8Array(o);return Promise.all(e.tasks.map(c=>{const{layerName:h,firstByte:p,lastByte:g,pixelFormat:x,blockShape:b,blockIndex:E,filters:I,codec:C}=c,k=n.subarray(p,g+1),F=new Uint32Array(b[0]*b[1]*b[2]);let N;if(C!=="gzip_data")throw new Fa(`Unhandled codec: ${C}`);return N=function(W,Z){if(!globalThis.DecompressionStream&&Z==="gzip_data")return Promise.resolve(((de=function(Re){Re[0]==31&&Re[1]==139&&Re[2]==8||ol(6,"invalid gzip data");var Le=Re[3],Fe=10;4&Le&&(Fe+=2+(Re[10]|Re[11]<<8));for(var dt=(Le>>3&1)+(Le>>4&1);dt>0;dt-=!Re[Fe++]);return Fe+(2&Le)}(ce=W))+8>ce.length&&ol(6,"invalid gzip data"),function(Re,Le,Fe,dt){var je=Re.length;if(!je||Le.f&&!Le.l)return Fe||new da(0);var pt=!Fe,wt=pt||Le.i!=2,mt=Le.i;pt&&(Fe=new da(3*je));var _t,Et,lt=function(Ni){var zi=Fe.length;if(Ni>zi){var Mi=new da(Math.max(2*zi,Ni));Mi.set(Fe),Fe=Mi}},yt=Le.f||0,Je=Le.p||0,Ze=Le.b||0,At=Le.l,Tt=Le.d,hr=Le.m,Gt=Le.n,Jt=8*je;do{if(!At){yt=sl(Re,Je,1);var Rt=sl(Re,Je+1,3);if(Je+=3,!Rt){var cr=Re[(ye=4+((Je+7)/8|0))-4]|Re[ye-3]<<8,Mr=ye+cr;if(Mr>je){mt&&ol(0);break}wt&&lt(Ze+cr),Fe.set(Re.subarray(ye,Mr),Ze),Le.b=Ze+=cr,Le.p=Je=8*Mr,Le.f=yt;continue}if(Rt==1)At=tN,Tt=rN,hr=9,Gt=5;else if(Rt==2){var Nt=sl(Re,Je,31)+257,rr=sl(Re,Je+10,15)+4,Tr=Nt+sl(Re,Je+5,31)+1;Je+=14;for(var Lr=new da(Tr),qr=new da(19),Nr=0;Nr<rr;++Nr)qr[J4[Nr]]=sl(Re,Je+3*Nr,7);Je+=3*rr;var Yt=Pb(qr),Fr=(1<<Yt)-1,ni=fg(qr,Yt);for(Nr=0;Nr<Tr;){var ye,xe=ni[sl(Re,Je,Fr)];if(Je+=15&xe,(ye=xe>>4)<16)Lr[Nr++]=ye;else{var Ke=0,ut=0;for(ye==16?(ut=3+sl(Re,Je,3),Je+=2,Ke=Lr[Nr-1]):ye==17?(ut=3+sl(Re,Je,7),Je+=3):ye==18&&(ut=11+sl(Re,Je,127),Je+=7);ut--;)Lr[Nr++]=Ke}}var Ft=Lr.subarray(0,Nt),Lt=Lr.subarray(Nt);hr=Pb(Ft),Gt=Pb(Lt),At=fg(Ft,hr),Tt=fg(Lt,Gt)}else ol(1);if(Je>Jt){mt&&ol(0);break}}wt&&lt(Ze+131072);for(var qt=(1<<hr)-1,pr=(1<<Gt)-1,Zr=Je;;Zr=Je){var Kr=(Ke=At[kb(Re,Je)&qt])>>4;if((Je+=15&Ke)>Jt){mt&&ol(0);break}if(Ke||ol(2),Kr<256)Fe[Ze++]=Kr;else{if(Kr==256){Zr=Je,At=null;break}var Wr=Kr-254;Kr>264&&(Wr=sl(Re,Je,(1<<(Hr=kC[Nr=Kr-257]))-1)+OC[Nr],Je+=Hr);var wi=Tt[kb(Re,Je)&pr],qi=wi>>4;if(wi||ol(3),Je+=15&wi,Lt=eN[qi],qi>3){var Hr=RC[qi];Lt+=kb(Re,Je)&(1<<Hr)-1,Je+=Hr}if(Je>Jt){mt&&ol(0);break}wt&&lt(Ze+131072);var Oi=Ze+Wr;if(Ze<Lt){var Si=0-Lt,ui=Math.min(Lt,Oi);for(Si+Ze<0&&ol(3);Ze<ui;++Ze)Fe[Ze]=(void 0)[Si+Ze]}for(;Ze<Oi;++Ze)Fe[Ze]=Fe[Ze-Lt]}}Le.l=At,Le.p=Zr,Le.b=Ze,Le.f=yt,At&&(yt=1,Le.m=hr,Le.d=Tt,Le.n=Gt)}while(!yt);return Ze!=Fe.length&&pt?(_t=Fe,((Et=Ze)==null||Et>_t.length)&&(Et=_t.length),new da(_t.subarray(0,Et))):Fe.subarray(0,Ze)}(ce.subarray(de,-8),{i:2},new da(((X=ce)[(le=X.length)-4]|X[le-3]<<8|X[le-2]<<16|X[le-1]<<24)>>>0))));var X,le,ce,de;const Ie=oN[Z];if(!Ie)throw new Error(`Unhandled codec: ${Z}`);const Ce=new globalThis.DecompressionStream(Ie);return new Response(new Blob([W]).stream().pipeThrough(Ce)).arrayBuffer().then(Re=>new Uint8Array(Re))}(k,C).then(W=>(function(Z,X){Z.readFields(W4,X)}(new Rb(W),F),new lN[x](F.buffer))),N.then(W=>{for(let Z=I.length-1;Z>=0;Z--)switch(I[Z]){case"delta_filter":Z4(W,b);break;case"zigzag_filter":X4(W);break;case"bitshuffle_filter":K4(W,x);break;default:throw new Fa(`Unhandled filter "${I[Z]}"`)}return{layerName:h,blockIndex:E,data:W}}).catch(W=>{throw W})}))},Wt(BC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt(Rx,"MapboxRasterTile"),Wt(zC,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class jC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const c=e[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const cN=["id","tile","layer","source","sourceLayer","state"];class bp{constructor(e,n,c,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=c,this._y=h,this.properties=e.properties,this.id=p}clone(){const e=new bp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of cN)this[n]!==void 0&&(e[n]=this[n]);return e}}class UC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vc(Dt,16,0),this.featureIndexArray=new My,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,c,h,p,g=0,x=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,g);const E=this.grid;for(let I=0;I<n.length;I++){const C=n[I],k=[1/0,1/0,-1/0,-1/0];for(let F=0;F<C.length;F++){const N=C[F];k[0]=Math.min(k[0],N.x),k[1]=Math.min(k[1],N.y),k[2]=Math.max(k[2],N.x),k[3]=Math.max(k[3],N.y)}x!==0&&(k[0]-=x,k[1]-=x,k[2]+=x,k[3]+=x),k[0]<Dt&&k[1]<Dt&&k[2]>=0&&k[3]>=0&&E.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Rr(new sx(this.rawTileData)).layers,this.sourceLayerCoder=new jC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:c,transform:h,tileTransform:p,pixelPosMatrix:g,availableImages:x,worldview:b}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const E=c.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(N,W,Z,X)=>mn(c.bufferedTilespaceGeometry,N,W,Z,X));I.sort(uN);let C=null;h.elevation&&I.length>0&&(C=yp.create(h.elevation,this.tileID));const k={};let F;for(let N=0;N<I.length;N++){const W=I[N];if(W===F)continue;F=W;const Z=this.featureIndexArray.get(W);let X=null;this.is3DTile?this.loadMatchingModelFeature(k,Z,e,c,h,b):this.loadMatchingFeature(k,Z,e,x,b,(le,ce,de,Ie=0)=>(X||(X=jt(le,this.tileID.canonical,p)),ce.queryIntersectsFeature(c,le,de,X,this.z,h,g,C,Ie)))}return k}loadMatchingFeature(e,n,c,h,p,g){const{featureIndex:x,bucketIndex:b,sourceLayerIndex:E,layoutVertexArrayOffset:I}=n,C=this.bucketLayerIDs[b],k=c.layers,F=Object.keys(k);if(F.length&&!Mt(F,C))return;const N=c.sourceCache,W=this.sourceLayerCoder.decode(E),Z=this.vtLayers[W].feature(x),X=this.getId(Z,W);for(let le=0;le<C.length;le++){const ce=C[le];if(!k[ce])continue;const{styleLayer:de,targets:Ie}=k[ce];let Ce={};X!==void 0&&(Ce=N.getFeatureState(de.sourceLayer,X));const Re=!g||g(Z,de,Ce,I);if(!Re)continue;const Le=new bp(Z,this.z,this.x,this.y,X);Le.tile=this.tileID.canonical,Le.state=Ce;let Fe=this.serializedLayersCache.get(ce);Fe||(Fe=de.serialize(),Fe.id=ce,this.serializedLayersCache.set(ce,Fe)),Le.source=Fe.source,Le.sourceLayer=Fe["source-layer"],Le.layer=Object.assign({},Fe),Le.layer.paint=VC(Fe.paint,de.paint,Z,Ce,h),Le.layer.layout=VC(Fe.layout,de.layout,Z,Ce,h);let dt=!1;for(const je of Ie){this.updateFeatureProperties(Le,je);const{filter:pt}=je;if(pt){if(Z.properties=Le.properties,pt.needGeometry){const wt=St(Z,!0);if(!pt.filter(new Di(this.tileID.overscaledZ,{worldview:p}),wt,this.tileID.canonical))continue}else if(!pt.filter(new Di(this.tileID.overscaledZ,{worldview:p}),Z))continue}dt=!0,je.targetId&&this.addFeatureVariant(Le,je)}dt&&this.appendToResult(e,ce,x,Le,Re)}}loadMatchingModelFeature(e,n,c,h,p,g){const{featureIndex:x,bucketIndex:b}=n,E=this.bucketLayerIDs[b],I=c.layers,C=Object.keys(I);if(!C.length||Mt(C,E))for(let k=0;k<E.length;k++){const F=E[k],{styleLayer:N,targets:W}=I[F];if(N.type!=="model")continue;const Z=h.tile,X=Z.getBucket(N);if(!(X&&X instanceof Sx))continue;const le=m4(X,x,h,p);if(!le)continue;const{z:ce,x:de,y:Ie}=Z.tileID.canonical,{feature:Ce,intersectionZ:Re,position:Le}=le;let Fe={};Ce.id!==void 0&&(Fe=c.sourceCache.getFeatureState(N.sourceLayer,Ce.id));const dt=new bp({},ce,de,Ie,Ce.id);dt.tile=this.tileID.canonical,dt.state=Fe,dt.properties=Ce.properties,dt.geometry={type:"Point",coordinates:[Le.lng,Le.lat]};let je=this.serializedLayersCache.get(F);je||(je=N.serialize(),je.id=F,this.serializedLayersCache.set(F,je)),dt.source=je.source,dt.sourceLayer=je["source-layer"],dt.layer=Object.assign({},je);let pt=!1;for(const wt of W){this.updateFeatureProperties(dt,wt);const{filter:mt}=wt;if(mt){if(Ce.properties=dt.properties,mt.needGeometry){if(!mt.filter(new Di(this.tileID.overscaledZ,{worldview:g}),Ce,this.tileID.canonical))continue}else if(!mt.filter(new Di(this.tileID.overscaledZ,{worldview:g}),Ce))continue}pt=!0,wt.targetId&&this.addFeatureVariant(dt,wt)}pt&&this.appendToResult(e,F,x,dt,Re)}}updateFeatureProperties(e,n,c){if(n.properties){const h={};for(const p in n.properties){const g=n.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,c);g!=null&&(h[p]=g)}e.properties=h}}addFeatureVariant(e,n,c){const h={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(h)}appendToResult(e,n,c,h,p){let g=e[n];g===void 0&&(g=e[n]=[]),g.push({featureIndex:c,feature:h,intersectionZ:p})}lookupSymbolFeatures(e,n,c,h,p,g){const x={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(x,{bucketIndex:n,sourceLayerIndex:c,featureIndex:b,layoutVertexArrayOffset:0},h,p,g);return x}loadFeature(e){const{featureIndex:n,sourceLayerIndex:c}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[n])return p[n];const g=this.vtLayers[h].feature(n);return p[n]=g,g}hasLayer(e){for(const n of this.bucketLayerIDs)for(const c of n)if(e===c)return!0;return!1}getId(e,n){let c=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const p=Pa(h);if(p.result!=="success"){const g=p.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void $t(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Xa),c=this.promoteIdExpression.evaluate({zoom:0},e)}else c=e.properties[h];typeof c=="boolean"&&(c=Number(c))}return c}}function VC(o,e,n,c,h){return Ye(o,(p,g)=>{const x=e instanceof Ec?e.get(g):null;return x&&x.evaluate?x.evaluate(n,c,void 0,h):x})}function uN(o,e){return e-o}Wt(UC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const $C=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Mb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=$C[15&c];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Mb(x,g,p,e)}constructor(e,n=64,c=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=$C.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=n,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Db(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,b=[0,p.length-1,0],E=[];for(;b.length;){const I=b.pop()||0,C=b.pop()||0,k=b.pop()||0;if(C-k<=x){for(let Z=k;Z<=C;Z++){const X=g[2*Z],le=g[2*Z+1];X>=e&&X<=c&&le>=n&&le<=h&&E.push(p[Z])}continue}const F=k+C>>1,N=g[2*F],W=g[2*F+1];N>=e&&N<=c&&W>=n&&W<=h&&E.push(p[F]),(I===0?e<=N:n<=W)&&(b.push(k),b.push(F-1),b.push(1-I)),(I===0?c>=N:h>=W)&&(b.push(F+1),b.push(C),b.push(1-I))}return E}within(e,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,x=[0,h.length-1,0],b=[],E=c*c;for(;x.length;){const I=x.pop()||0,C=x.pop()||0,k=x.pop()||0;if(C-k<=g){for(let Z=k;Z<=C;Z++)HC(p[2*Z],p[2*Z+1],e,n)<=E&&b.push(h[Z]);continue}const F=k+C>>1,N=p[2*F],W=p[2*F+1];HC(N,W,e,n)<=E&&b.push(h[F]),(I===0?e-c<=N:n-c<=W)&&(x.push(k),x.push(F-1),x.push(1-I)),(I===0?e+c>=N:n+c>=W)&&(x.push(F+1),x.push(C),x.push(1-I))}return b}}function Db(o,e,n,c,h,p){if(h-c<=n)return;const g=c+h>>1;GC(o,e,g,c,h,p),Db(o,e,n,c,g-1,1-p),Db(o,e,n,g+1,h,1-p)}function GC(o,e,n,c,h,p){for(;h>c;){if(h-c>600){const E=h-c+1,I=n-c+1,C=Math.log(E),k=.5*Math.exp(2*C/3),F=.5*Math.sqrt(C*k*(E-k)/E)*(I-E/2<0?-1:1);GC(o,e,n,Math.max(c,Math.floor(n-I*k/E+F)),Math.min(h,Math.floor(n+(E-I)*k/E+F)),p)}const g=e[2*n+p];let x=c,b=h;for(mg(o,e,c,n),e[2*h+p]>g&&mg(o,e,c,h);x<b;){for(mg(o,e,x,b),x++,b--;e[2*x+p]<g;)x++;for(;e[2*b+p]>g;)b--}e[2*c+p]===g?mg(o,e,c,b):(b++,mg(o,e,b,h)),b<=n&&(c=b+1),n<=b&&(h=b-1)}}function mg(o,e,n,c){Ob(o,n,c),Ob(e,2*n,2*c),Ob(e,2*n+1,2*c+1)}function Ob(o,e,n){const c=o[e];o[e]=o[n],o[n]=c}function HC(o,e,n,c){const h=o-n,p=e-c;return h*h+p*p}a.$=Lm,a.A=sa,a.B=Iu,a.C=2,a.D=lp,a.E=cc,a.F=tg,a.G=gI,a.H=Om,a.I=wo,a.J=$f,a.K=Pr,a.L=Nh,a.M=Mf,a.N=Rf,a.O=a0,a.P=bt,a.Q=c0,a.R=Xd,a.S=Ac,a.T=qw,a.U=Pa,a.V=Tx,a.W=u0,a.X=xu,a.Y=yu,a.Z=xf,a._=Ds,a.a=function(o){return ws.API_CDN_URL_REGEX.test(o)},a.a$=Te,a.a0=Fh,a.a1=km,a.a2=Gf,a.a3=class extends Tx{},a.a4=Df,a.a5=o0,a.a6=Be,a.a7=function(o){const e=o.value;return e?Fh(e)?wb(e,!0)?[]:[new Tx(o.key,e,`invalid url "${e}"`)]:[new Tx(o.key,e,`string expected, "${Pr(e)}" found`)]:[]},a.a8=gy,a.a9=rn,a.aA=U,a.aB=pe,a.aC=un,a.aD=d,a.aE=Wn,a.aF=ge,a.aG=We,a.aH=function(o,e){const n={};for(let c=0;c<e.length;c++){const h=e[c];h in o&&(n[h]=o[h])}return n},a.aI=te,a.aJ=Se,a.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,n,c){const h=this.entries[o]=this.entries[o]||{callbacks:[]};if(h.result){const[p,g]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},e):c(p,g),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=n((p,g)=>{h.result=[p,g];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,g)},e):x(p,g);setTimeout(()=>delete this.entries[o],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[o]))}}},a.aL=function(o,e,n){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const p=ou(o.request,(g,x,b,E)=>{g?h(g):x&&h(null,{vectorTile:n?void 0:new Rr(new sx(x)),rawData:x,cacheControl:b,expires:E})});return()=>{p.cancel(),h()}},e)},a.aM=function(o){El++,El>Za&&(o.getActor().send("enforceCacheSizeLimit",ta),El=0)},a.aN=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},a.aO=Fs,a.aP=HI,a.aQ=YI,a.aR=G,a.aS=GI,a.aT=function(o,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let c=0;c<o.length;c++){const h=document.createElement("source");j_(o[c])||(n.crossOrigin="Anonymous"),h.src=o[c],n.appendChild(h)}return{cancel:()=>{}}},a.aU=X0,a.aV=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>wA(e,0,o))},a.aW=PA,a.aX=class{constructor(o,e,n,c){this.id=o,this.position=e!=null?new G(e[0],e[1]):new G(0,0),this.orientation=n??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(pe(o.matrix,e,o.matrix),o.meshes)for(const n of o.meshes){const c=Er.applyTransformFast(n.aabb,o.matrix);this.aabb.encapsulate(c)}if(o.children)for(const n of o.children)this._applyTransformations(n,o.matrix)}computeBoundsAndApplyParent(){const o=J([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,n,c,h,p,g=!1){IA(this.matrix,this,o.transform,this.position,e,n,c,h,p,g)}upload(o){if(!this.uploaded){for(const e of this.nodes)Kw(e,o);for(const e of this.nodes)nx(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)Yw(o)}},a.aY=nt,a.aZ=ng,a.a_=Ee,a.aa=It,a.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Vr(o.expression.evaluate(e))}interpolate(o,e,n){return{x:wr(o.x,e.x,n),y:wr(o.y,e.y,n),z:wr(o.z,e.z,n),azimuthal:wr(o.azimuthal,e.azimuthal,n),polar:wr(o.polar,e.polar,n)}}},a.ac=Di,a.ad=Ll,a.ae=Qe,a.af=Qt,a.ag=Xt,a.ah=ae,a.ai=Ec,a.aj=Fu,a.ak=wr,a.al=Dt,a.am=Mm,a.an=ze,a.ao=_i,a.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([n,c]){const h=Vr([1,n,c]);return{x:h.x,y:h.y,z:h.z}}(o.expression.evaluate(e))}interpolate(o,e,n){return{x:wr(o.x,e.x,n),y:wr(o.y,e.y,n),z:wr(o.z,e.z,n)}}},a.aq=function(o,e,n=0,c=!0){const h=new bt(n,n),p=o.sub(h),g=e.add(h),x=[p,new bt(g.x,p.y),g,new bt(p.x,g.y)];return c&&x.push(p.clone()),x},a.ar=function(o,e){const n=[];for(let c=0;c<o.length;c++){const h=Q(c-1,-1,o.length-1),p=Q(c+1,-1,o.length-1),g=o[c],x=o[p],b=o[h].sub(g).unit(),E=x.sub(g).unit(),I=E.angleWithSep(b.x,b.y),C=b.add(E).unit().mult(-1*e/Math.sin(I/2));n.push(g.add(C))}return n},a.as=kI,a.at=mn,a.au=function(o,e,n=0){return Dr(((e.x-n)*o.scale-o.x)*Dt,(e.y*o.scale-o.y)*Dt,we(e.z,e.y))},a.av=Pi,a.aw=Pt,a.ax=ci,a.ay=UA,a.az=function(o){let e=1/0,n=1/0,c=-1/0,h=-1/0;for(const p of o)e=Math.min(e,p.x),n=Math.min(n,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new bt(e,n),max:new bt(c,h)}},a.b=function(o){return ws.API_FONTS_REGEX.test(o)},a.b$=Lw,a.b0=Cc,a.b1=Nn,a.b2=fe,a.b3=P0,a.b4=xx,a.b5=function(){ka.isLoading()||ka.isLoaded()||Vf()!=="deferred"||wc()},a.b6=Zh,a.b7=St,a.b8=bp,a.b9=zr,a.bA=J,a.bB=He,a.bC=re,a.bD=function(o,e){const{x:n,y:c}=o.point,h=cE(n,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return pe(h,h,bw(Wl(e)))},a.bE=B,a.bF=Ln,a.bG=function(o,e){var n=e[0]-o[0],c=e[1]-o[1],h=e[2]-o[2];return Math.sqrt(n*n+c*c+h*h)},a.bH=Ue,a.bI=br,a.bJ=dr,a.bK=eg,a.bL=Po,a.bM=lb,a.bN=function(o,e,n,c,h){const p=5*e+2;o.float32[p+0]=n,o.float32[p+1]=c,o.float32[p+2]=h},a.bO=yx,a.bP=xs,a.bQ=Qo,a.bR=Jo,a.bS=_o,a.bT=Q,a.bU=function(o,e,n,c){var h=new O(4);return h[0]=o,h[1]=e,h[2]=n,h[3]=c,h},a.bV=Yy,a.bW=Ao,a.bX=rs,a.bY=jE,a.bZ=JI,a.b_=GE,a.ba=tb,a.bb=Mw,a.bc=jt,a.bd=jl,a.be=Qf,a.bf=iE,a.bg=en,a.bh=op,a.bi=xb,a.bj=function(o,e){const n=Fu(e.zoom);if(n===0)return Wl(o);const c=jy(o),h=ww(c),p=ge(c.getWest())*e.worldSize,g=ge(c.getEast())*e.worldSize,x=Se(c.getNorth())*e.worldSize,b=Se(c.getSouth())*e.worldSize,E=[p,x,0],I=[g,x,0],C=[p,b,0],k=[g,b,0],F=_e([],e.globeMatrix);return Qt(E,E,F),Qt(I,I,F),Qt(C,C,F),Qt(k,k,F),h[0]=Mc(h[0],C,n),h[1]=Mc(h[1],k,n),h[2]=Mc(h[2],I,n),h[3]=Mc(h[3],E,n),Er.fromPoints(h)},a.bk=Vy,a.bl=_e,a.bm=D0,a.bn=Mc,a.bo=Ic,a.bp=zO,a.bq=De,a.br=ue,a.bs=Rx,a.bt=sx,a.bu=ou,a.bv=function(o,e){const n=[];for(const c in o)c in e||n.push(c);return n},a.bw=ne,a.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.by=ea,a.bz=function(o){var e=new O(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},a.c=B_,a.c$=function(o){return o*o*o*o*o},a.c0=ab,a.c1=TI,a.c2=db,a.c3=Mb,a.c4=gr,a.c5=Ut,a.c6=Vn,a.c7=function(o,e,n){n*=.5;var c=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(n),b=Math.cos(n);return o[0]=c*b+h*x,o[1]=h*b-c*x,o[2]=p*b+g*x,o[3]=g*b-p*x,o},a.c8=Kn,a.c9=ji,a.cA=Gr,a.cB=TA,a.cC=rl,a.cD=oE,a.cE=function(o,e,n,c,h,p,g,x,b){if(b.name==="globe")return oE(o,e,new rl(n,c,h),!1);const E=ng({z:n,x:c,y:h},b);return new Er([(p+E.x/E.scale)*e,e*(E.y/E.scale),g],[(p+E.x2/E.scale)*e,e*(E.y2/E.scale),x])},a.cF=function(o,e,n){return o[0]=Math.min(e[0],n[0]),o[1]=Math.min(e[1],n[1]),o[2]=Math.min(e[2],n[2]),o[3]=Math.min(e[3],n[3]),o},a.cG=function(o,e,n){return o[0]=Math.max(e[0],n[0]),o[1]=Math.max(e[1],n[1]),o[2]=Math.max(e[2],n[2]),o[3]=Math.max(e[3],n[3]),o},a.cH=function(o){const e=Math.round((o+45+360)%360/90)%4;return se[e]},a.cI=Ae,a.cJ=si,a.cK=y,a.cL=function(o){const e=J(new Float64Array(16));pe(e,o.pixelMatrix,o.globeMatrix);const n=[0,P,0],c=[0,M,0];return Qt(n,n,e),Qt(c,c,e),[n[0]>0&&n[0]<=o.width&&n[1]>0&&n[1]<=o.height&&!Sw(o,new G(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!Sw(o,new G(o.center.lat,-90))]},a.cM=function(o,e){const{scale:n}=o.tileTransform,c=n*Dt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return function(h,p,g){var x=p[1],b=p[2],E=p[3],I=g[0],C=g[1];return h[0]=p[0]*I,h[1]=x*I,h[2]=b*C,h[3]=E*C,h}(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},a.cN=rx,a.cO=ft,a.cP=bA,a.cQ=function(o){const e=bA(o,!0);return B([],[e[0],e[1],e[4],e[5]])},a.cR=ie,a.cS=pi,a.cT=ke,a.cU=function(o){const{x:e,y:n}=o.point,{lng:c,lat:h}=o._center;return cE(e,n,o.worldSize,c,h)},a.cV=sr,a.cW=Y,a.cX=sp,a.cY=hs,a.cZ=_,a.c_=function(o,e,n){let c=0;for(let h=0;h<2;++h)o[h]>0&&(c+=(o[h]-0)*(o[h]-0)),e[h]<0&&(c+=(0-e[h])*(0-e[h]));return c},a.ca=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},a.cb=Ge,a.cc=function(o,e,n,c,h){var p=1/Math.tan(e/2);if(o[0]=p/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=p,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,h!=null&&h!==1/0){var g=1/(c-h);o[10]=(h+c)*g,o[14]=2*h*c*g}else o[10]=-1,o[14]=-2*c;return o},a.cd=function(o,e,n,c,h,p,g){var x=1/(e-n),b=1/(c-h),E=1/(p-g);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*b,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*E,o[11]=0,o[12]=(e+n)*x,o[13]=(h+c)*b,o[14]=(g+p)*E,o[15]=1,o},a.ce=be,a.cf=function(o,e,n){o[4*e+0]=n[0],o[4*e+1]=n[1],o[4*e+2]=n[2],o[4*e+3]=n[3]},a.cg=rd,a.ch=id,a.ci=pn,a.cj=Ma,a.ck=sd,a.cl=LI,a.cm=function(){var o=new O(4);return O!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},a.cn=function(o,e,n){var c=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(n),b=Math.cos(n);return o[0]=c*b+p*x,o[1]=h*b+g*x,o[2]=c*-x+p*b,o[3]=h*-x+g*b,o},a.co=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},a.cp=gi,a.cq=function(o){var e=o[0],n=o[1],c=o[2],h=o[3];return Math.sqrt(e*e+n*n+c*c+h*h)},a.cr=mo,a.cs=bi,a.ct=np,a.cu=3,a.cv=2,a.cw=7,a.cx=6,a.cy=ar,a.cz=tt,a.d=function(o){return ws.API_TILEJSON_REGEX.test(o)},a.d$=HA,a.d0=he,a.d1=45,a.d2=nd,a.d3=function(o,e,n){const c=Math.sqrt(o*o+e*e+n*n),h=c>0?Math.acos(n/c)*bl:0;let p=o!==0||e!==0?Math.atan2(-e,-o)*bl+90:0;return p<0&&(p+=360),[c,p,h]},a.d4=Dr,a.d5=Vr,a.d6=$e,a.d7=Ir,a.d8=Er,a.d9=ei,a.dA=function(o,e,n){const c=Fu(n.zoom),h=o.style.map._antialias,p=o.terrain&&o.terrain.exaggeration()>0;return c===0&&!h&&!p},a.dB=function(o){const e=o.pixelsPerMeter,n=e/be(1,o.center.lat),c=J(new Float64Array(16));return ue(c,c,[o.point.x,o.point.y,0]),ie(c,c,[n,n,e]),Float32Array.from(c)},a.dC=jy,a.dD=function(o){const e=Ae-5;o=U(o,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(ze(o))),3);return Math.round(n*(A.length-1))},a.dE=function(o,e,n,c){const h=e.getNorth(),p=e.getSouth(),g=e.getWest(),x=e.getEast(),b=1<<o.z,E=x-g,I=h-p,C=E/S,k=-I/A[n],F=[0,C,0,k,0,0,h,g,0];if(o.z>0){const N=180/c;ee(F,F,[N/E+1,0,0,0,N/I+1,0,-.5*N/C,.5*N/k,1])}return F[2]=b,F[5]=o.x,F[8]=o.y,F},a.dF=Wl,a.dG=function(o,e,n){const c=J(new Float64Array(16)),h=(e/(1<<o)-.5)*Math.PI*2;return at(c,n.globeMatrix,h),Float32Array.from(c)},a.dH=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const n=e.getSource().maxzoom,c=1<<n,h=Math.floor(o.x),p=Math.floor((o.x-h)*c),g=Math.floor(o.y*c),x=this.findDEMTileFor(new Fs(n,h,n,p,g));return!(!x||!x.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||o.y<0||o.y>1)return e;const h=c.getSource().maxzoom,p=1<<h,g=Math.floor(o.x),x=o.x-g,b=new Fs(h,g,h,Math.floor(x*p),Math.floor(o.y*p)),E=this.findDEMTileFor(b);if(!E||!E.dem)return e;const I=E.dem,C=1<<E.tileID.canonical.z,k=(x*C-E.tileID.canonical.x)*I.dim,F=(o.y*C-E.tileID.canonical.y)*I.dim,N=Math.floor(k),W=Math.floor(F);return(n?this.exaggeration():1)*wr(wr(I.get(N,W),I.get(N,W+1),F-W),wr(I.get(N+1,W),I.get(N+1,W+1),F-W),k-N)}getAtTileOffset(o,e,n){const c=1<<o.canonical.z;return this.getAtPointOrZero(new Qe(o.wrap+(o.canonical.x+e/Dt)/c,(o.canonical.y+n/Dt)/c))}getAtTileOffsetFunc(o,e,n,c){return h=>{const p=this.getAtTileOffset(o,h.x,h.y),g=c.upVector(o.canonical,h.x,h.y);return gr(g,g,p*c.upVectorScale(o.canonical,e,n).metersToTile),g}}getForTilePoints(o,e,n,c){if(this.isUsingMockSource())return!1;const h=yp.create(this,o,c);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],n)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const n=e.dem.tree,c=e.tileID,h=1<<o.canonical.z-c.canonical.z;let p=o.canonical.x/h-c.canonical.x,g=o.canonical.y/h-c.canonical.y,x=0;for(let b=0;b<o.canonical.z-c.canonical.z&&!n.leaves[x];b++){p*=2,g*=2;const E=2*Math.floor(g)+Math.floor(p);x=n.childOffsets[x]+E,p%=1,g%=1}return{min:this.exaggeration()*n.minimums[x],max:this.exaggeration()*n.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,n=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const h of o){const p=this.getMinMaxForTile(h.tileID);p&&(n=Math.min(n,p.min),c=Math.max(c,p.max),e=!0)}return e?{min:n,max:c}:null}},a.dI=bE,a.dJ=By,a.dK=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},a.dL=H,a.dM=function(o,e){var n=Math.sin(e),c=Math.cos(e);return o[0]=c,o[1]=n,o[2]=0,o[3]=-n,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},a.dN=Ci,a.dO=lE,a.dP=In,a.dQ=vs,a.dR=256,a.dS=function(o,e){const n=[0,0,0];return Qt(n,n,Vy(Wl(e.canonical))),Qt(n,n,o),n},a.dT=o=>({u_matrix:new sd(o),u_texsize:new Ma(o),u_pixels_to_tile_units:new ip(o),u_device_pixel_ratio:new pn(o),u_width_scale:new pn(o),u_floor_width_scale:new pn(o),u_image:new rd(o),u_units_to_pixels:new Ma(o),u_tile_units_to_pixels:new pn(o),u_alpha_discard_threshold:new pn(o),u_trim_offset:new Ma(o),u_trim_fade_range:new Ma(o),u_trim_color:new nd(o),u_emissive_strength:new pn(o),u_zbias_factor:new pn(o),u_tile_to_meter:new pn(o),u_ground_shadow_factor:new id(o),u_pattern_transition:new pn(o)}),a.dU=o=>({u_matrix:new sd(o),u_pixels_to_tile_units:new ip(o),u_device_pixel_ratio:new pn(o),u_width_scale:new pn(o),u_floor_width_scale:new pn(o),u_units_to_pixels:new Ma(o),u_dash_image:new rd(o),u_gradient_image:new rd(o),u_image_height:new pn(o),u_texsize:new Ma(o),u_tile_units_to_pixels:new pn(o),u_alpha_discard_threshold:new pn(o),u_trim_offset:new Ma(o),u_trim_fade_range:new Ma(o),u_trim_color:new nd(o),u_emissive_strength:new pn(o),u_zbias_factor:new pn(o),u_tile_to_meter:new pn(o),u_ground_shadow_factor:new id(o)}),a.dV=o=>({u_camera_to_center_distance:new pn(o),u_extrude_scale:new ip(o),u_device_pixel_ratio:new pn(o),u_matrix:new sd(o),u_inv_rot_matrix:new sd(o),u_merc_center:new Ma(o),u_tile_id:new id(o),u_zoom_transition:new pn(o),u_up_dir:new id(o),u_emissive_strength:new pn(o)}),a.dW=S0,a.dX=TF,a.dY=class{constructor(o,e,n,c){this.context=o,this.format=c,this.size=n,this.texture=o.gl.createTexture();const[h,p,g]=this.size,{gl:x}=o;x.bindTexture(x.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,h,p,g,0,Hw(this.format),Ww(this.format),e.data)}bind(o,e){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_3D,this.texture),o!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,o),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},a.dZ=dE,a.d_=(o,e,n,c,h,p)=>{const g=o.transform,x=g.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(x){const I=lE(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([I,0,0,I])}else b=g.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(g.projection),u_matrix:o.translatePosMatrix(e.projMatrix,n,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Aa.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:$O,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(x){E.u_inv_rot_matrix=c,E.u_merc_center=h,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=Fu(g.zoom);const I=h[0]*Dt,C=h[1]*Dt;E.u_up_dir=g.projection.upVector(new rl(0,0,0),I,C)}return E},a.da=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},a.db=wb,a.dc=function(o,e){return o.readFields(y4,{icons:[]},e)},a.dd=Jy,a.de=mp,a.df=ub,a.dg=Kd,a.dh=my,a.di=qd,a.dj=Qd,a.dk=it,a.dl=function(o){const e=o.indexOf(Xh);return e>=0?o.slice(0,e):o},a.dm=function(o){return o.indexOf(Xh)>=0},a.dn=function(o){const e=o.lastIndexOf(Xh);return e>=0?o.slice(e+1):""},a.dp=function(o){const e=[],n=o.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.dq=function(o,e,n,c){return o.type==="custom"?new d4(o,e):new g4[o.type](o,e,n,c)},a.dr=st,a.ds=function(o){const e=o.indexOf(Xh);return e>=0?o.slice(e+1):""},a.dt=class extends bp{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},a.du=m0,a.dv=oi,a.dw=function(o){return o({pluginStatus:Os,pluginURL:zl}),m0.on("pluginStateChange",o),o},a.dx=Fy,a.dy=class extends Ra{constructor(o){super(o),this.current=yw}set(o,e,n){if(this.fetchUniformLocation(o,e)){for(let c=0;c<9;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},a.dz=ve,a.e=ws,a.e$=function(){const o=W0;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(jw),W0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.e0=Gs,a.e1=(o,e,n,c,h,p,g,x,b,E)=>{const I=o.transform,C=I.pitch<15?VA(.07,.7,U((14-I.zoom)/5,0,1)):.07,k=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:GA(o,e,n,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:p,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:$A(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:E}},a.e2=(o,e,n,c,h,p,g,x,b,E)=>{const I=o.transform,C=I.calculatePixelsToTileUnitsMatrix(e),k=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=I.pitch<15?VA(.07,.7,U((14-I.zoom)/5,0,1)):.07;return{u_matrix:GA(o,e,n,c),u_pixels_to_tile_units:C,u_device_pixel_ratio:p,u_width_scale:g,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:WA(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$A(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:E}},a.e3=Ve,a.e4=O0,a.e5=we,a.e6=FO,a.e7=Ky,a.e8=rA,a.e9=zu,a.eA=Pn,a.eB=Mu,a.eC=function(o,e,n,c,h,p,g,x,b,E,I,C,k,F,N,W){var Z=new O(16);return Z[0]=o,Z[1]=e,Z[2]=n,Z[3]=c,Z[4]=h,Z[5]=p,Z[6]=g,Z[7]=x,Z[8]=b,Z[9]=E,Z[10]=I,Z[11]=C,Z[12]=k,Z[13]=F,Z[14]=N,Z[15]=W,Z},a.eD=j,a.eE=Jh,a.eF=Yf,a.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new bt(1/0,1/0),max:new bt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const n=VE(new bt(0,0),new bt(Dt,Dt),o),c=[];if(e&&!Dw(n,this._globalClipBounds))return c;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Dw(n,h))continue;const p=_L(h.min,h.max,o);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return c}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const c of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(c).buckets[e.layer];h&&h.updateFootprints(c.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const n=o.getOrder(),c=o.getClipMask(),h=o.getClipScope();for(const p of e){if(!p.footprint)continue;const g=VE(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:n,clipMask:c,clipScope:h})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||qy(e.min,n.min)||qy(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(c,h){const p=(g,x)=>g+x;return c.length-h.length||c.reduce(p,"").localeCompare(h.reduce(p,""))}(e.clipScope,n.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const n=this._activeRegions[e],c=this._prevRegions[e];o=n.priority!==c.priority||!UE(n,c)||n.order!==c.order||n.clipMask!==c.clipMask||!ea(n.clipScope,c.clipScope),++e}}if(o){++this._updateTime;for(const n of this._activeRegions)n.order!==j0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const c=this._activeRegions;if(n>=c.length)return n;const h=c[n].priority;for(;n<c.length&&c[n].priority===h;)++n;return n};if(this._sourceIds.length>1){let n=0,c=e(n);for(;n!==c;){let h=n;const p=n;for(;h!==c;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let x=0;x<p;x++){const b=this._activeRegions[x];if(!b.hiddenByOverlap&&g.order===j0&&Dw(g,b)&&(g.hiddenByOverlap=$E(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++h}n=c,c=e(n)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},a.eH=j0,a.eI=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const n=new jl,c=new Nn,h=[],p=o+1+2,g=e[0]+1,x=e[0]+1+(1+e.length),b=(E,I,C)=>{let k=E===p-1?E-2:E===0?E:E-1;return k+=C?24575:0,[k,I]};for(let E=0;E<p;++E)n.emplaceBack(...b(E,0,!0));for(let E=0;E<g;++E)for(let I=0;I<p;++I)n.emplaceBack(...b(I,E,(I===0||I===p-1)&&!0));for(let E=0;E<e.length;++E){const I=e[E];for(let C=0;C<p;++C)n.emplaceBack(...b(C,I,!0))}for(let E=0;E<e.length;++E){const I=c.length,C=e[E]+1+2,k=new Nn;for(let W=0;W<C-1;W++){const Z=W===C-2,X=Z?p*(x-e.length+E-W):p;for(let le=0;le<p-1;le++){const ce=W*p+le;W===0||Z||le===0||le===p-2?(k.emplaceBack(ce+1,ce,ce+X),k.emplaceBack(ce+X,ce+X+1,ce+1)):(c.emplaceBack(ce+1,ce,ce+X),c.emplaceBack(ce+X,ce+X+1,ce+1))}}const F=en.simpleSegment(0,I,n.length,c.length-I);for(let W=0;W<k.uint16.length;W+=3)c.emplaceBack(k.uint16[W],k.uint16[W+1],k.uint16[W+2]);const N=en.simpleSegment(0,I,n.length,c.length-I);h.push({withoutSkirts:F,withSkirts:N})}return{vertices:n,indices:c,segments:h}}_createGrid(o){const e=this._fillGridMeshWithLods(S,A);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,iE.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new Nn;for(let g=0;g<=S;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const n=new Pc,c=new Pc,h=new Pc,p=new Pc;this._poleSegments=[];for(let g=0,x=0;g<_;g++){const b=360/(1<<g);n.emplaceBack(0,-d,0,.5,0),c.emplaceBack(0,-d,0,.5,1),h.emplaceBack(0,-d,0,.5,.5),p.emplaceBack(0,-d,0,.5,.5);for(let E=0;E<=S;E++){let I=E/S,C=0;const k=wr(0,b,I),[F,N,W]=z(UO,VO,k,d);n.emplaceBack(F,N,W,I,C),c.emplaceBack(F,N,W,I,1-C);const Z=ze(k);I=.5+.5*Math.sin(Z),C=.5+.5*Math.cos(Z),h.emplaceBack(F,N,W,I,C),p.emplaceBack(F,N,W,I,1-C)}this._poleSegments.push(en.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(n,zy,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,zy,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(h,zy,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(p,zy,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},a.eJ=BE,a.eK=Me,a.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eM=Pe,a.eN=rt,a.eO=function(o,e,n){return o[0]=e[0]/n[0],o[1]=e[1]/n[1],o[2]=e[2]/n[2],o},a.eP=fr,a.eQ=D,a.eR=ct,a.eS=ir,a.eT=function([o,e,n]){const c=Math.hypot(o,e,n),h=Math.atan2(o,n),p=.5*Math.PI-Math.acos(-e/c);return new G(Y(h),Y(p))},a.eU=cn,a.eV=Zw,a.eW=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(n){if(di==null){const c=n.navigator?n.navigator.userAgent:null;di=!!n.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return di}(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.eX=function(o,e){ta=o,Za=e},a.eY=Sw,a.eZ=uE,a.e_=function(o){const e=[0,0,0],n=J(new Float64Array(16));return pe(n,o.pixelMatrix,o.globeMatrix),Qt(e,e,n),new bt(e[0],e[1])},a.ea=450,a.eb=7,a.ec=Ne,a.ed=function(o,e){if(o===e){var n=e[1],c=e[2],h=e[3],p=e[6],g=e[7],x=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=n,o[6]=e[9],o[7]=e[13],o[8]=c,o[9]=p,o[11]=e[14],o[12]=h,o[13]=g,o[14]=x}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},a.ee=h4,a.ef=ii,a.eg=Ou,a.eh=256,a.ei=bw,a.ej=Ws,a.ek=at,a.el=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},a.em=Pc,a.en=I0,a.eo=r0,a.ep=function(o,e,n,c,h){return U((o-e)/(n-e)*(h-c)+c,c,h)},a.eq=ks,a.er=function(o,e){var n=e[0],c=e[1],h=e[2],p=e[3],g=e[4],x=e[5],b=e[6],E=e[7],I=e[8],C=I*g-x*E,k=-I*p+x*b,F=E*p-g*b,N=n*C+c*k+h*F;return N?(o[0]=C*(N=1/N),o[1]=(-I*c+h*E)*N,o[2]=(x*c-h*g)*N,o[3]=k*N,o[4]=(I*n-h*b)*N,o[5]=(-x*n+h*p)*N,o[6]=F*N,o[7]=(-E*n+c*b)*N,o[8]=(g*n-c*p)*N,o):null},a.es=2,a.et=ht,a.eu=Xw,a.ev=[1,1,1],a.ew=yp,a.ex=ti,a.ey=function(o,e,n,c){var h=e[0],p=e[1],g=e[2],x=e[3];return o[0]=h+c*(n[0]-h),o[1]=p+c*(n[1]-p),o[2]=g+c*(n[2]-g),o[3]=x+c*(n[3]-x),o},a.ez=dp,a.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},a.f0=function(){Jy().acquire(jw)},a.f1=Vf,a.f2=function(o,e,n=!1){if(Os===io.deferred||Os===io.loading||Os===io.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");zl=Aa.resolveURL(o),Os=io.deferred,f0=e,p0(),n||wc()},a.f3=function(o){cp=Aa.resolveURL(o),up||(up=new lp(Jy(),new cc)),up.broadcast("setMeshoptUrl",cp)},a.f4=mA,a.f5=function(o){Vw=Aa.resolveURL(o),up||(up=new lp(Jy(),new cc)),up.broadcast("setDracoUrl",Vw)},a.f6=pA,a.f7=H0,a.f8=function(o){const e=Em();if(!e)return;const n=e.delete(yo);o&&n.then(()=>o()).catch(o)},a.f9=cd,a.fA=function(o){Ah(),Rs!=null&&Rs.then(e=>{e.keys().then(n=>{for(let c=0;c<n.length-o;c++)e.delete(n[c]).catch(h=>$t(h.message))}).catch(n=>$t(n.message))}).catch(e=>$t(e.message))},a.fa=Wt,a.fb=Nu,a.fc=nl,a.fd=jC,a.fe=UC,a.ff=zA,a.fg=$r,a.fh="hd_road_elevation",a.fi=Ki,a.fj=Ye,a.fk=Dc,a.fl=cb,a.fm=dd,a.fn=function(o,e,n,c,h,p,g,x=1,b,E,I){o.createArrays(),o.tilePixelRatio=Dt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const C=o.layers[0].layout,k=o.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=x,F.textSizeScaleRange=C.get("text-size-scale-range"),F.iconSizeScaleRange=C.get("icon-size-scale-range");const[N,W]=F.textSizeScaleRange,[Z,X]=F.iconSizeScaleRange;F.textScaleFactor=U(F.scaleFactor,N,W),F.iconScaleFactor=U(F.scaleFactor,Z,X);const le=k["text-size"],ce=k["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:dt}=o.textSizeData;F.compositeTextSizes=[le.possiblyEvaluate(new Di(Fe,{worldview:I}),p),le.possiblyEvaluate(new Di(dt,{worldview:I}),p)]}if(o.iconSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:dt}=o.iconSizeData;F.compositeIconSizes=[ce.possiblyEvaluate(new Di(Fe,{worldview:I}),p),ce.possiblyEvaluate(new Di(dt,{worldview:I}),p)]}F.layoutTextSize=le.possiblyEvaluate(new Di(g+1,{worldview:I}),p),F.layoutIconSize=ce.possiblyEvaluate(new Di(g+1,{worldview:I}),p),F.textMaxSize=le.possiblyEvaluate(new Di(18,{worldview:I}),p);const de=C.get("symbol-placement"),Ie=C.get("text-rotation-alignment")==="map"&&de!=="point",Ce=C.get("text-size");let Re=!1;const Le=[];for(const Fe of o.features){const dt=C.get("text-font").evaluate(Fe,{},p).join(","),je=Ce.evaluate(Fe,{},p)*F.textScaleFactor,pt=F.layoutTextSize.evaluate(Fe,{},p)*F.textScaleFactor,wt=F.layoutIconSize.evaluate(Fe,{},p)*F.iconScaleFactor,mt={horizontal:{},vertical:void 0},_t=Fe.text;let Et,lt=[0,0];if(_t){const rr=_t.toString(),Tr=C.get("text-letter-spacing").evaluate(Fe,{},p)*rs,Lr=C.get("text-line-height").evaluate(Fe,{},p)*rs,qr=fy(rr)?Tr:0,Nr=C.get("text-anchor").evaluate(Fe,{},p),Yt=C.get("text-variable-anchor");if(!Yt){const Ke=C.get("text-radial-offset").evaluate(Fe,{},p);if(Ke)lt=TI(Nr,[Ke*rs,hb]);else{const ut=C.get("text-offset").evaluate(Fe,{},p);lt=[ut[0]*rs,ut[1]*rs]}}let Fr=Ie?"center":C.get("text-justify").evaluate(Fe,{},p);const ni=de==="point",ye=ni?C.get("text-max-width").evaluate(Fe,{},p)*rs:1/0,xe=Ke=>{o.allowVerticalPlacement&&d0(rr)&&(mt.vertical=ob(_t,e,n,h,dt,ye,Lr,Nr,Ke,qr,lt,Po.vertical,!0,pt,je,b))};if(!Ie&&Yt){const Ke=Fr==="auto"?Yt.map(Ft=>db(Ft)):[Fr];let ut=!1;for(let Ft=0;Ft<Ke.length;Ft++){const Lt=Ke[Ft];if(!mt.horizontal[Lt])if(ut)mt.horizontal[Lt]=mt.horizontal[0];else{const qt=ob(_t,e,n,h,dt,ye,Lr,"center",Lt,qr,lt,Po.horizontal,!1,pt,je,b);qt&&(mt.horizontal[Lt]=qt,ut=qt.positionedLines.length===1)}}xe("left")}else{if(Fr==="auto"&&(Fr=db(Nr)),ni||C.get("text-writing-mode").indexOf("horizontal")>=0||!d0(rr)){const Ke=ob(_t,e,n,h,dt,ye,Lr,Nr,Fr,qr,lt,Po.horizontal,!1,pt,je,b);Ke&&(mt.horizontal[Fr]=Ke)}xe(ni?"left":Fr)}}let yt,Je,Ze,At,Tt,hr,Gt=!1;const Jt=C.get("icon-text-fit").evaluate(Fe,{},p);if(Fe.icon&&Fe.icon.hasPrimary()){const rr=EI(Fe.icon,o.iconSizeData,k["icon-size"],p,o.zoom,Fe,b,F.iconScaleFactor,I);yt=rr.iconPrimary,Ze=rr.iconSecondary;const Tr=yt.toString();if(Je=c.get(Tr),Je&&(Tt=C.get("icon-offset").evaluate(Fe,{},p),hr=C.get("icon-anchor").evaluate(Fe,{},p),Et=UF(h.get(Tr),Ze?h.get(Ze.toString()):void 0,Tt,hr),Gt=Je.sdf,o.sdfIcons===void 0?o.sdfIcons=Je.sdf:o.sdfIcons!==Je.sdf&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==o.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),Ze){const Lr=Ze.toString();At=c.get(Lr)}}Re=Re||!(!Fe.icon||!Fe.icon.hasSecondary());const Rt=fb(mt.horizontal)||mt.vertical;o.iconsInText||(o.iconsInText=!!Rt&&Rt.iconsInText);const cr=pt*F.textScaleFactor/rs,{defaultShapedIcon:Mr,verticallyShapedIcon:Nt}=YF(o,Et,C,Fe,p,mt,cr,Tt,Jt);Jt!=="none"&&Et&&(aI(Et)||lI(Et))&&(ux(0,Je,yt,Et,Mr,Jt,E,c,h),ux(0,At,Ze,Et,Mr,Jt,E,c,h),Nt&&(ux(0,Je,yt,Et,Nt,Jt,E,c,h),ux(0,At,Ze,Et,Nt,Jt,E,c,h))),Et=Mr,Le.push({feature:Fe,shapedTextOrientations:mt,shapedText:Rt,shapedIcon:Et,iconPrimary:yt,iconSecondary:Ze,iconOffset:Tt,iconAnchor:hr,verticallyShapedIcon:Nt,layoutTextSize:pt,layoutIconSize:wt,textOffset:lt,isSDFIcon:Gt,iconTextFit:Jt})}return{featureData:Le,sizes:F,hasAnySecondaryIcon:Re,textAlongLine:Ie,symbolPlacement:de}},a.fo=_I,a.fp=function(o,e,n,c,h,p,g,x,b,E){const{featureData:I,hasAnySecondaryIcon:C,sizes:k,textAlongLine:F,symbolPlacement:N}=e;for(const W of I){const{shapedIcon:Z,verticallyShapedIcon:X,feature:le,shapedTextOrientations:ce,shapedText:de,layoutTextSize:Ie,textOffset:Ce,isSDFIcon:Re,iconPrimary:Le,iconSecondary:Fe,iconTextFit:dt,iconOffset:je}=W;AI(Z,E.iconPositions,Le,Fe),AI(X,E.iconPositions,Le,Fe),KF(ce,E.iconPositions),XF(Le,Fe,E.iconPositions),(de||Z)&&JF(o,le,ce,Z,X,b,k,Ie,0,Ce,Re,c,h,g,x,C,dt,je,F,N)}n&&o.generateCollisionDebugBuffers(p,o.collisionBoxArray,k.textScaleFactor)},a.fq=Rr,a.fr=kx,a.fs=xt,a.ft=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==_A){const n=new Uint32Array(o,0,7),[,,c,h,p,g]=n;e=n.byteLength+h+p+g+p,(c!==o.byteLength||e>=o.byteLength)&&$t("Invalid b3dm header information.")}return wA(o,e)},a.fu=function(o,e){const n=PA(o);for(const c of n){for(const h of c.meshes)ZL(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(XL(c.lights,e)))}return n},a.fv=Sx,a.fw=Xr,a.fx=dA,a.fy=ka,a.fz=io,a.g=function(o,e){return oi(Object.assign(o,{method:"GET"}),e)},a.h=function(o){return o.indexOf("mapbox:")===0},a.i=function(o){return ws.API_STYLE_REGEX.test(o)&&!B_(o)},a.j=ru,a.k=Ih,a.l=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.m=function(o,e){return oi(Object.assign(o,{type:"json"}),e)},a.n=au,a.o=Aa,a.p=function(o,e){return oi(Object.assign(o,{method:"POST"}),e)},a.q=ds,a.r=Tm,a.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=function(){return Uw||(Uw=new cd),Uw},a.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},a.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},a.w=$t,a.x=Cb,a.y=kh,a.z=ia}),v(["./shared"],function(a){function R(ze){const Y=ze?ze.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function O(ze){if(typeof ze=="number"||typeof ze=="boolean"||typeof ze=="string"||ze==null)return JSON.stringify(ze);if(Array.isArray(ze)){let se="[";for(const ve of ze)se+=`${O(ve)},`;return`${se}]`}let Y="{";for(const se of Object.keys(ze).sort())Y+=`${se}:${O(ze[se])},`;return`${Y}}`}function B(ze){let Y="";for(const se of a.bx)Y+=`/${O(ze[se])}`;return Y}class H{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,se){this._layerConfigs={},this._layers={},this.update(Y,[],se)}update(Y,se,ve){this._options=ve;for(const Pe of Y)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=a.dq(Pe,this.scope,null,this._options)).compileFilter(ve),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of se)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const Me=function(Pe,U){const ae={};for(let ne=0;ne<Pe.length;ne++){const me=Pe[ne];let fe=U&&U[me.id];fe||(me.type==="symbol"?fe=me.id:(fe=B(me),me.type==="line"&&me.paint&&function nt(Ye){return typeof Ye=="string"&&Ye==="line-progress"||(Array.isArray(Ye)?Ye.some(nt):!(!Ye||typeof Ye!="object")&&Object.values(Ye).some(nt))}(me.paint["line-width"])&&(fe+=`/${O(me.paint["line-width"])}`))),U&&(U[me.id]=fe);let Ve=ae[fe];Ve||(Ve=ae[fe]=[]),Ve.push(me)}const Q=[];for(const ne in ae)Q.push(ae[ne]);return Q}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of Me){const U=Pe.map(Ve=>this._layers[Ve.id]),ae=U[0];if(ae.visibility==="none")continue;const Q=ae.source||"";let ne=this.familiesBySource[Q];ne||(ne=this.familiesBySource[Q]={});const me=ae.sourceLayer||"_geojsonTileLayer";let fe=ne[me];fe||(fe=ne[me]=[]),fe.push(U)}}}const q=1*a.fc;class ee{constructor(Y){const se={},ve=[];for(const ae in Y){const Q=Y[ae],ne=se[ae]={};for(const me in Q.glyphs){const fe=Q.glyphs[+me];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Ve=fe.metrics.localGlyph?q:1,nt={x:0,y:0,w:fe.bitmap.width+2*Ve,h:fe.bitmap.height+2*Ve};ve.push(nt),ne[me]=nt}}const{w:Me,h:Pe}=a.G(ve),U=new a.fb({width:Me||1,height:Pe||1});for(const ae in Y){const Q=Y[ae];for(const ne in Q.glyphs){const me=Q.glyphs[+ne];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const fe=se[ae][ne],Ve=me.metrics.localGlyph?q:1;a.fb.copy(me.bitmap,U,{x:0,y:0},{x:fe.x+Ve,y:fe.y+Ve},me.bitmap)}}this.image=U,this.positions=se}}a.fa(ee,"GlyphAtlas");class re{constructor(Y){this.tileID=new a.aO(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=a.aZ(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview}parse(Y,se,ve,Me,Pe,U){this.status="parsing",this.data=Y,this.collisionBoxArray=new a.b3;const ae=new a.fd(Object.keys(Y.layers).sort()),Q=new a.fe(this.tileID,this.promoteId);Q.bucketLayerIDs=[];const ne={},me=new a.ff(256,256),fe={featureIndex:Q,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:me,availableImages:ve,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Ve=[],nt=se.familiesBySource[this.source];for(const st in nt){const it=Y.layers[st];if(!it)continue;let Mt=!1,Zt=!1,$t=!1;for(const Xr of nt[st])Xr[0].type==="symbol"?Mt=!0:Zt=!0,Xr[0].is3D()&&Xr[0].type!=="model"&&($t=!0);if(this.extraShadowCaster&&!$t||this.isSymbolTile===!0&&!Mt||this.isSymbolTile===!1&&!Zt)continue;it.version===1&&a.w(`Vector tile source "${this.source}" layer "${st}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Kt=ae.encode(st),mr=[];let Vr=!1;for(let Xr=0,zr=0;Xr<it.length;Xr++){const di=it.feature(Xr),ji=Q.getId(di,st);if(this.localizableLayerIds&&this.localizableLayerIds.has(st)){const Ai=di.properties?di.properties.worldview:null;if(this.worldview&&typeof Ai=="string")if(Ai==="all")di.properties.$localized=!0;else{if(!Ai.split(",").includes(this.worldview))continue;di.properties.$localized=!0,di.properties.worldview=this.worldview}}!Vr&&di.properties&&di.properties.hasOwnProperty(a.fg)&&(Vr=!0),mr.push({feature:di,id:ji,index:zr,sourceLayerIndex:Kt}),zr++}Vr&&!fe.elevationFeatures&&Y.layers.hasOwnProperty(a.fh)&&(fe.elevationFeatures=a.fi.parseFrom(Y.layers[a.fh],this.canonical));for(const Xr of nt[st]){const zr=Xr[0];if(this.extraShadowCaster&&(!zr.is3D()||zr.type==="model")||this.isSymbolTile!==void 0&&zr.type==="symbol"!==this.isSymbolTile||zr.minzoom&&this.zoom<Math.floor(zr.minzoom)||zr.maxzoom&&this.zoom>=zr.maxzoom||zr.visibility==="none")continue;J(Xr,this.zoom,fe.brightness,ve,this.worldview);const di=ne[zr.id]=zr.createBucket({index:Q.bucketLayerIDs.length,layers:Xr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kt,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});Q.bucketLayerIDs.push(Xr.map(Ai=>a.B(Ai.id,Ai.scope)));let ji=di.prepare?di.prepare():null;ji!=null?(ji=ji.then(()=>di.populate(mr,fe,this.tileID.canonical,this.tileTransform)),Ve.push(ji)):di.populate(mr,fe,this.tileID.canonical,this.tileTransform)}}const Ye=()=>{let st,it,Mt,Zt,$t,Kt;me.trim();const mr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Vr=()=>{if(st)return this.status="done",U(st);if(this.extraShadowCaster)this.status="done",U(null,{buckets:Object.values(ne).filter(zr=>!zr.isEmpty()),featureIndex:Q,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:fe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(it&&Mt&&Zt){const zr=new ee(it),di=new Map;for(const[Sn,In]of Mt.entries()){const{imagePosition:vs}=a.fl(Sn,In,a.fm);di.set(Sn,vs)}const ji={};for(const Sn in ne){const In=ne[Sn];In instanceof a.b4&&(J(In.layers,this.zoom,fe.brightness,ve,this.worldview),ji[Sn]=a.fn(In,it,zr.positions,Mt,di,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,$t,this.worldview))}const Ai={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,Mt,$t,()=>{Ai.iconsPending=!1,Xr(ji,zr,Ai)}),this.rasterizeIfNeeded(Pe,Zt,Kt,()=>{Ai.patternsPending=!1,Xr(ji,zr,Ai)})}},Xr=(zr,di,ji,Ai)=>{if(ji.iconsPending||ji.patternsPending)return;const Sn=new a.fo(Mt,Zt,this.lut);for(const In in ne){const vs=ne[In];if(In in zr)a.fp(vs,zr[In],this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Mt,Sn);else if(vs.hasPattern&&(vs instanceof a.ba||vs instanceof a.bb||vs instanceof a.e7)){J(vs.layers,this.zoom,fe.brightness,ve,this.worldview);const as=Object.fromEntries(Sn.patternPositions);vs.addFeatures(fe,this.tileID.canonical,as,ve,this.tileTransform,this.brightness)}}this.status="done",U(null,{buckets:Object.values(ne).filter(In=>!In.isEmpty()),featureIndex:Q,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:di.image,lineAtlas:me,imageAtlas:Sn,brightness:fe.brightness})};if(!this.extraShadowCaster){const zr=a.fj(fe.glyphDependencies,Ai=>Object.keys(Ai).map(Number));Object.keys(zr).length?Pe.send("getGlyphs",{uid:this.uid,stacks:zr},(Ai,Sn)=>{st||(st=Ai,it=Sn,Vr())},void 0,!1,mr):it={};const di=Array.from(fe.iconDependencies.keys()).map(Ai=>a.I.parse(Ai));di.length?Pe.send("getImages",{images:di,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ai,Sn)=>{st||(st=Ai,Mt=new Map,$t=this.updateImageMapAndGetImageTaskQueue(Mt,Sn,fe.iconDependencies),Vr())},void 0,!1,mr):(Mt=new Map,$t=new Map);const ji=Array.from(fe.patternDependencies.keys()).map(Ai=>a.I.parse(Ai));ji.length?Pe.send("getImages",{images:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ai,Sn)=>{st||(st=Ai,Zt=new Map,Kt=this.updateImageMapAndGetImageTaskQueue(Zt,Sn,fe.patternDependencies),Vr())},void 0,!1,mr):(Zt=new Map,Kt=new Map)}if(fe.elevationFeatures&&fe.elevationFeatures.length>0){const zr=[];for(const ji of Object.values(ne))if(ji instanceof a.bb){const Ai=ji.getUnevaluatedPortalGraph();Ai&&zr.push(Ai)}const di=a.fk.evaluate(zr);for(const ji of Object.values(ne))if(ji instanceof a.bb){const Ai=Y.layers[ae.decode(ji.sourceLayerIndex)];ji.setEvaluatedPortalGraph(di,Ai,this.tileID.canonical,fe.availableImages,fe.brightness)}}Vr()};Ve.length>0?Promise.allSettled(Ve).then(Ye).catch(U):Ye()}rasterizeIfNeeded(Y,se,ve,Me){Array.from(se.values()).some(Pe=>Pe.usvg)?this.rasterize(Y,se,ve,Me):Me()}updateImageMapAndGetImageTaskQueue(Y,se,ve){const Me=new Map;for(const Pe of se.keys()){const U=ve.get(Pe)||[];for(const ae of U){const Q=ae.toString(),ne=se.get(ae.id.toString());ne.usvg?Me.has(Q)||(Me.set(Q,ae),Y.set(Q,Object.assign({},ne))):Y.set(Q,ne)}}return Me}rasterize(Y,se,ve,Me){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:ve},(Pe,U)=>{if(!Pe)for(const[ae,Q]of U.entries()){const ne=Object.assign(se.get(ae),{data:Q});se.set(ae,ne)}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function J(ze,Y,se,ve,Me){const Pe=new a.ac(Y,{brightness:se,worldview:Me});for(const U of ze)U.recalculate(Pe,ve)}class _e extends a.E{constructor(Y,se,ve,Me,Pe,U,ae){super(),this.actor=Y,this.layerIndex=se,this.availableImages=ve,this.availableModels=Me,this.loadVectorData=U||a.aL,this.loading={},this.loaded={},this.deduped=new a.aK(Y.scheduler),this.isSpriteLoaded=Pe,this.scheduler=Y.scheduler,this.brightness=ae}loadTile(Y,se){const ve=Y.uid,Me=Y&&Y.request,Pe=Me&&Me.collectResourceTiming,U=this.loading[ve]=new re(Y);U.abort=this.loadVectorData(Y,(ae,Q)=>{const ne=!this.loading[ve];if(delete this.loading[ve],U.cancelRasterize(),ne||ae||!Q)return U.status="done",ne||(this.loaded[ve]=U),se(ae);const me=Q.rawData,fe={};Q.expires&&(fe.expires=Q.expires),Q.cacheControl&&(fe.cacheControl=Q.cacheControl),U.vectorTile=Q.vectorTile||new a.fq(new a.bt(me));const Ve=()=>{U.parse(U.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(nt,Ye)=>{if(nt||!Ye)return se(nt);const st={};if(Pe){const it=R(Me);it.length>0&&(st.resourceTiming=JSON.parse(JSON.stringify(it)))}se(null,Object.assign({rawTileData:me.slice(0)},Ye,fe,st))})};this.isSpriteLoaded?Ve():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ve,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Ve()}),this.loaded=this.loaded||{},this.loaded[ve]=U})}reloadTile(Y,se){const ve=this.loaded,Me=Y.uid;if(ve&&ve[Me]){const Pe=ve[Me];Pe.scaleFactor=Y.scaleFactor,Pe.showCollisionBoxes=Y.showCollisionBoxes,Pe.projection=Y.projection,Pe.brightness=Y.brightness,Pe.tileTransform=a.aZ(Y.tileID.canonical,Y.projection),Pe.extraShadowCaster=Y.extraShadowCaster,Pe.lut=Y.lut,Pe.worldview=Y.worldview;const U=(ae,Q)=>{const ne=Pe.reloadCallback;ne&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ne)),se(ae,Q)};Pe.status==="parsing"?Pe.reloadCallback=U:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,U):U())}else se(null,void 0)}abortTile(Y,se){const ve=Y.uid,Me=this.loading[ve];Me&&(Me.abort&&Me.abort(),delete this.loading[ve]),se()}removeTile(Y,se){const ve=this.loaded,Me=Y.uid;ve&&ve[Me]&&delete ve[Me],se()}}class pe{loadTile(Y,se){const{uid:ve,encoding:Me,rawImageData:Pe,padding:U}=Y,ae=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,U):Pe;se(null,new a.fr(ve,ae,Me,U<1))}reloadTile(Y,se){se(null,null)}abortTile(Y,se){se()}removeTile(Y,se){se()}getImageData(Y,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const ve=this.offscreenCanvasContext.getImageData(-se,-se,Y.width+2*se,Y.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}a.bs.setPbf(a.bt);class ue{constructor(Y){this._mrt=new a.bs(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,se){const ve=this._mrt;this.status="parsing",this._entireBuffer=Y;try{ve.parseHeader(Y),this._isHeaderLoaded=!0;const Me=[];for(const Pe in ve.layers){const U=ve.getLayer(Pe),ae=U.getDataRange(U.getBandList()),Q=ve.createDecodingTask(ae),ne=Y.slice(ae.firstByte,ae.lastByte+1),me=a.bs.performDecoding(ne,Q).then(fe=>Q.complete(null,fe)).catch(fe=>Q.complete(fe,null));Me.push(me)}Promise.allSettled(Me).then(()=>se(null,ve)).catch(Pe=>se(Pe))}catch(Me){se(Me)}}}class ie{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,se){const ve=Y.uid,Me=Y.request,Pe=this.loading[ve]=new ue(Y),{cancel:U}=a.bu(Me,(ae,Q,ne,me)=>{const fe=!this.loading[ve];if(delete this.loading[ve],fe||ae||!Q)return Pe.status="done",fe||(this.loaded[ve]=Pe),se(ae);Pe.parse(Q,(Ve,nt)=>{if(Ve||!nt)return se(Ve);se(null,nt,ne,me)}),this.loaded[ve]=Pe});Pe.abort=U}reloadTile(Y,se){se(null,void 0)}abortTile(Y,se){const ve=Y.uid,Me=this.loading[ve];Me&&(Me.abort&&Me.abort(),delete this.loading[ve]),se()}removeTile(Y,se){const ve=Y.uid;this.loaded[ve]&&delete this.loaded[ve],se()}decodeRasterArray(Y,se){a.bs.performDecoding(Y.buffer,Y.task).then(ve=>se(null,ve)).catch(ve=>se(ve))}}const ke=a.fs.prototype.toGeoJSON;class at{constructor(Y){this._feature=Y,this.extent=a.al,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const se of this._feature.geometry)Y.push([new a.P(se[0],se[1])]);return Y}{const Y=[];for(const se of this._feature.geometry){const ve=[];for(const Me of se)ve.push(new a.P(Me[0],Me[1]));Y.push(ve)}return Y}}toGeoJSON(Y,se,ve){return ke.call(this,Y,se,ve)}}class He{constructor(Y,se){this.name=Y,this.extent=a.al,this.length=se.length,this._jsonFeatures=se}feature(Y){return new at(this._jsonFeatures[Y])}}class De{constructor(Y){this.layers={},this.extent=a.al;for(const se of Object.keys(Y))this.layers[se]=new He(se,Y[se])}}const et=64/4096,Ge=128;class ft{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],se){for(const ve of Y){const Me=ve.id;if(Me==null)continue;let Pe=this.features.get(Me);Pe&&this.updateCache(Pe,se),ve.geometry?(Pe=Ot(ve),this.updateCache(Pe,se),this.features.set(Me,Pe)):this.features.delete(Me),this.updateCache(Pe,se)}}updateCache(Y,se){for(const{canonical:ve,uid:Me}of Object.values(se)){const{z:Pe,x:U,y:ae}=ve;tt(Y,Math.pow(2,Pe),U,ae)&&delete se[Me]}}getTile(Y,se,ve){const Me=Math.pow(2,Y),Pe=[];for(const U of this.features.values())tt(U,Me,se,ve)&&Pe.push(Ir(U,Me,se,ve));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function tt({minX:ze,minY:Y,maxX:se,maxY:ve},Me,Pe,U){return ze<(Pe+1+et)/Me&&Y<(U+1+et)/Me&&se>(Pe-et)/Me&&ve>(U-et)/Me}function Ot(ze){const{id:Y,geometry:se,properties:ve}=ze;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:Pe}=se,U={id:Y,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ae=U.geometry;if(Me==="Point")Xt(Pe,ae,U);else if(Me==="MultiPoint")for(const Q of Pe)Xt(Q,ae,U);else if(Me==="LineString")U.type=2,Dr(Pe,ae,U);else if(Me==="MultiLineString")U.type=2,ir(Pe,ae,U);else if(Me==="Polygon")U.type=3,ir(Pe,ae,U,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");U.type=3;for(const Q of Pe)ir(Q,ae,U,!0)}return U}function Xt([ze,Y],se,ve){const Me=a.aF(ze);let Pe=a.aJ(Y);Pe=Pe<0?0:Pe>1?1:Pe,se.push(Me,Pe),ve.minX=Math.min(ve.minX,Me),ve.minY=Math.min(ve.minY,Pe),ve.maxX=Math.max(ve.maxX,Me),ve.maxY=Math.max(ve.maxY,Pe)}function Dr(ze,Y,se,ve=!1,Me=!1){const Pe=[];for(const U of ze)Xt(U,Pe,se);Y.push(Pe),ve&&function(U,ae){let Q=0;for(let ne=0,me=U.length,fe=me-2;ne<me;fe=ne,ne+=2)Q+=(U[ne]-U[fe])*(U[ne+1]+U[fe+1]);if(Q>0===ae)for(let ne=0,me=U.length;ne<me/2;ne+=2){const fe=U[ne],Ve=U[ne+1];U[ne]=U[me-2-ne],U[ne+1]=U[me-1-ne],U[me-2-ne]=fe,U[me-1-ne]=Ve}}(Pe,Me)}function ir(ze,Y,se,ve=!1){for(let Me=0;Me<ze.length;Me++)Dr(ze[Me],Y,se,ve,Me===0)}function Ir(ze,Y,se,ve){const{id:Me,type:Pe,geometry:U,tags:ae}=ze,Q=[];if(Pe===1)(function(ne,me,fe,Ve,nt){for(let Ye=0;Ye<ne.length;Ye+=2){const st=Math.round(a.al*(ne[Ye+0]*me-fe)),it=Math.round(a.al*(ne[Ye+1]*me-Ve));nt.push([st,it])}})(U,Y,se,ve,Q);else for(const ne of U)ei(ne,Y,se,ve,Q);return{id:Me,type:Pe,geometry:Q,tags:ae}}function ei(ze,Y,se,ve,Me){const Pe=-Ge,U=a.al+Ge;let ae;for(let Q=0;Q<ze.length-2;Q+=2){let ne=Math.round(a.al*(ze[Q+0]*Y-se)),me=Math.round(a.al*(ze[Q+1]*Y-ve)),fe=Math.round(a.al*(ze[Q+2]*Y-se)),Ve=Math.round(a.al*(ze[Q+3]*Y-ve));const nt=fe-ne,Ye=Ve-me;ne<Pe&&fe<Pe||(ne<Pe?(me+=Math.round(Ye*((Pe-ne)/nt)),ne=Pe):fe<Pe&&(Ve=me+Math.round(Ye*((Pe-ne)/nt)),fe=Pe),me<Pe&&Ve<Pe||(me<Pe?(ne+=Math.round(nt*((Pe-me)/Ye)),me=Pe):Ve<Pe&&(fe=ne+Math.round(nt*((Pe-me)/Ye)),Ve=Pe),ne>=U&&fe>=U||(ne>=U?(me+=Math.round(Ye*((U-ne)/nt)),ne=U):fe>=U&&(Ve=me+Math.round(Ye*((U-ne)/nt)),fe=U),me>=U&&Ve>=U||(me>=U?(ne+=Math.round(nt*((U-me)/Ye)),me=U):Ve>=U&&(fe=ne+Math.round(nt*((U-me)/Ye)),Ve=U),ae&&ne===ae[ae.length-1][0]&&me===ae[ae.length-1][1]||(ae=[[ne,me]],Me.push(ae)),ae.push([fe,Ve])))))}}function sr({name:ze,features:Y},se){se.writeStringField(1,ze),se.writeVarintField(5,a.al);const ve=new Map,Me=new Map,Pe={keys:ve,values:Me,feature:null};for(const U of Y)Pe.feature=U,se.writeMessage(2,yr,Pe);for(const U of ve.keys())se.writeStringField(3,U);for(const U of Me.keys())se.writeMessage(4,ct,U)}function yr(ze,Y){const se=ze.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&Y.writeVarintField(1,+se.id),se.tags&&Y.writeMessage(2,vr,ze),Y.writeVarintField(3,se.type),Y.writeMessage(4,vt,se)}function vr({keys:ze,values:Y,feature:se},ve){for(const Me of Object.keys(se.tags)){let Pe=se.tags[Me];if(Pe===null)continue;let U=ze.get(Me);U===void 0&&(U=ze.size,ze.set(Me,U)),ve.writeVarint(U);const ae=typeof Pe;ae!=="string"&&ae!=="boolean"&&ae!=="number"&&(Pe=JSON.stringify(Pe));let Q=Y.get(Pe);Q===void 0&&(Q=Y.size,Y.set(Pe,Q)),ve.writeVarint(Q)}}function gr(ze,Y){return(Y<<3)+(7&ze)}function Ue(ze){return ze<<1^ze>>31}function vt(ze,Y){const{geometry:se,type:ve}=ze;let Me=0,Pe=0;if(ve===1){Y.writeVarint(gr(1,se.length));for(const U of se){const ae=U[0]-Me,Q=U[1]-Pe;Y.writeVarint(Ue(ae)),Y.writeVarint(Ue(Q)),Me+=ae,Pe+=Q}}else for(const U of se){Y.writeVarint(gr(1,1));const ae=U.length-(ve===3?1:0);for(let Q=0;Q<ae;Q++){Q===1&&Y.writeVarint(gr(2,ae-1));const ne=U[Q][0]-Me,me=U[Q][1]-Pe;Y.writeVarint(Ue(ne)),Y.writeVarint(Ue(me)),Me+=ne,Pe+=me}ve===3&&Y.writeVarint(gr(7,1))}}function ct(ze,Y){const se=typeof ze;se==="string"?Y.writeStringField(1,ze):se==="boolean"?Y.writeBooleanField(7,ze):se==="number"&&(ze%1!=0?Y.writeDoubleField(3,ze):ze<0?Y.writeSVarintField(6,ze):Y.writeVarintField(5,ze))}const ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},Pt=Math.fround||(dr=new Float32Array(1),ze=>(dr[0]=+ze,dr[0]));var dr;const br=3,ar=5,Qt=6;class Ci{constructor(Y){this.options=Object.assign(Object.create(ht),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:se,minZoom:ve,maxZoom:Me}=this.options;se&&console.time("total time");const Pe=`prepare ${Y.length} points`;se&&console.time(Pe),this.points=Y;const U=[];for(let Q=0;Q<Y.length;Q++){const ne=Y[Q];if(!ne.geometry)continue;const[me,fe]=ne.geometry.coordinates,Ve=Pt(gi(me)),nt=Pt(Pi(fe));U.push(Ve,nt,1/0,Q,-1,1),this.options.reduce&&U.push(0)}let ae=this.trees[Me+1]=this._createTree(U);se&&console.timeEnd(Pe);for(let Q=Me;Q>=ve;Q--){const ne=+Date.now();ae=this.trees[Q]=this._createTree(this._cluster(ae,Q)),se&&console.log("z%d: %d clusters in %dms",Q,ae.numItems,+Date.now()-ne)}return se&&console.timeEnd("total time"),this}getClusters(Y,se){let ve=((Y[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,Y[1]));let Pe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const U=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ve=-180,Pe=180;else if(ve>Pe){const fe=this.getClusters([ve,Me,180,U],se),Ve=this.getClusters([-180,Me,Pe,U],se);return fe.concat(Ve)}const ae=this.trees[this._limitZoom(se)],Q=ae.range(gi(ve),Pi(U),gi(Pe),Pi(Me)),ne=ae.data,me=[];for(const fe of Q){const Ve=this.stride*fe;me.push(ne[Ve+ar]>1?bi(ne,Ve,this.clusterProps):this.points[ne[Ve+br]])}return me}getChildren(Y){const se=this._getOriginId(Y),ve=this._getOriginZoom(Y),Me="No cluster with the specified id.",Pe=this.trees[ve];if(!Pe)throw new Error(Me);const U=Pe.data;if(se*this.stride>=U.length)throw new Error(Me);const ae=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),Q=Pe.within(U[se*this.stride],U[se*this.stride+1],ae),ne=[];for(const me of Q){const fe=me*this.stride;U[fe+4]===Y&&ne.push(U[fe+ar]>1?bi(U,fe,this.clusterProps):this.points[U[fe+br]])}if(ne.length===0)throw new Error(Me);return ne}getLeaves(Y,se,ve){const Me=[];return this._appendLeaves(Me,Y,se=se||10,ve=ve||0,0),Me}getTile(Y,se,ve){const Me=this.trees[this._limitZoom(Y)],Pe=Math.pow(2,Y),{extent:U,radius:ae}=this.options,Q=ae/U,ne=(ve-Q)/Pe,me=(ve+1+Q)/Pe,fe={features:[]};return this._addTileFeatures(Me.range((se-Q)/Pe,ne,(se+1+Q)/Pe,me),Me.data,se,ve,Pe,fe),se===0&&this._addTileFeatures(Me.range(1-Q/Pe,ne,1,me),Me.data,Pe,ve,Pe,fe),se===Pe-1&&this._addTileFeatures(Me.range(0,ne,Q/Pe,me),Me.data,-1,ve,Pe,fe),fe.features.length?fe:null}getClusterExpansionZoom(Y){let se=this._getOriginZoom(Y)-1;for(;se<=this.options.maxZoom;){const ve=this.getChildren(Y);if(se++,ve.length!==1)break;Y=ve[0].properties.cluster_id}return se}_appendLeaves(Y,se,ve,Me,Pe){const U=this.getChildren(se);for(const ae of U){const Q=ae.properties;if(Q&&Q.cluster?Pe+Q.point_count<=Me?Pe+=Q.point_count:Pe=this._appendLeaves(Y,Q.cluster_id,ve,Me,Pe):Pe<Me?Pe++:Y.push(ae),Y.length===ve)break}return Pe}_createTree(Y){const se=new a.c3(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<Y.length;ve+=this.stride)se.add(Y[ve],Y[ve+1]);return se.finish(),se.data=Y,se}_addTileFeatures(Y,se,ve,Me,Pe,U){for(const ae of Y){const Q=ae*this.stride,ne=se[Q+ar]>1;let me,fe,Ve;if(ne)me=Ln(se,Q,this.clusterProps),fe=se[Q],Ve=se[Q+1];else{const st=this.points[se[Q+br]];me=st.properties;const[it,Mt]=st.geometry.coordinates;fe=gi(it),Ve=Pi(Mt)}const nt={type:1,geometry:[[Math.round(this.options.extent*(fe*Pe-ve)),Math.round(this.options.extent*(Ve*Pe-Me))]],tags:me};let Ye;Ye=ne||this.options.generateId?se[Q+br]:this.points[se[Q+br]].id,Ye!==void 0&&(nt.id=Ye),U.features.push(nt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,se){const{radius:ve,extent:Me,reduce:Pe,minPoints:U}=this.options,ae=ve/(Me*Math.pow(2,se)),Q=Y.data,ne=[],me=this.stride;for(let fe=0;fe<Q.length;fe+=me){if(Q[fe+2]<=se)continue;Q[fe+2]=se;const Ve=Q[fe],nt=Q[fe+1],Ye=Y.within(Q[fe],Q[fe+1],ae),st=Q[fe+ar];let it=st;for(const Mt of Ye){const Zt=Mt*me;Q[Zt+2]>se&&(it+=Q[Zt+ar])}if(it>st&&it>=U){let Mt,Zt=Ve*st,$t=nt*st,Kt=-1;const mr=(fe/me<<5)+(se+1)+this.points.length;for(const Vr of Ye){const Xr=Vr*me;if(Q[Xr+2]<=se)continue;Q[Xr+2]=se;const zr=Q[Xr+ar];Zt+=Q[Xr]*zr,$t+=Q[Xr+1]*zr,Q[Xr+4]=mr,Pe&&(Mt||(Mt=this._map(Q,fe,!0),Kt=this.clusterProps.length,this.clusterProps.push(Mt)),Pe(Mt,this._map(Q,Xr)))}Q[fe+4]=mr,ne.push(Zt/it,$t/it,1/0,mr,-1,it),Pe&&ne.push(Kt)}else{for(let Mt=0;Mt<me;Mt++)ne.push(Q[fe+Mt]);if(it>1)for(const Mt of Ye){const Zt=Mt*me;if(!(Q[Zt+2]<=se)){Q[Zt+2]=se;for(let $t=0;$t<me;$t++)ne.push(Q[Zt+$t])}}}}return ne}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,se,ve){if(Y[se+ar]>1){const U=this.clusterProps[Y[se+Qt]];return ve?Object.assign({},U):U}const Me=this.points[Y[se+br]].properties,Pe=this.options.map(Me);return ve&&Pe===Me?Object.assign({},Pe):Pe}}function bi(ze,Y,se){return{type:"Feature",id:ze[Y+br],properties:Ln(ze,Y,se),geometry:{type:"Point",coordinates:[(ve=ze[Y],360*(ve-.5)),fr(ze[Y+1])]}};var ve}function Ln(ze,Y,se){const ve=ze[Y+ar],Me=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Pe=ze[Y+Qt],U=Pe===-1?{}:Object.assign({},se[Pe]);return Object.assign(U,{cluster:!0,cluster_id:ze[Y+br],point_count:ve,point_count_abbreviated:Me})}function gi(ze){return ze/360+.5}function Pi(ze){const Y=Math.sin(ze*Math.PI/180),se=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return se<0?0:se>1?1:se}function fr(ze){const Y=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ut(ze,Y,se,ve){let Me=ve;const Pe=Y+(se-Y>>1);let U,ae=se-Y;const Q=ze[Y],ne=ze[Y+1],me=ze[se],fe=ze[se+1];for(let Ve=Y+3;Ve<se;Ve+=3){const nt=ti(ze[Ve],ze[Ve+1],Q,ne,me,fe);if(nt>Me)U=Ve,Me=nt;else if(nt===Me){const Ye=Math.abs(Ve-Pe);Ye<ae&&(U=Ve,ae=Ye)}}Me>ve&&(U-Y>3&&Ut(ze,Y,U,ve),ze[U+2]=Me,se-U>3&&Ut(ze,U,se,ve))}function ti(ze,Y,se,ve,Me,Pe){let U=Me-se,ae=Pe-ve;if(U!==0||ae!==0){const Q=((ze-se)*U+(Y-ve)*ae)/(U*U+ae*ae);Q>1?(se=Me,ve=Pe):Q>0&&(se+=U*Q,ve+=ae*Q)}return U=ze-se,ae=Y-ve,U*U+ae*ae}function si(ze,Y,se,ve){const Me={id:ze??null,type:Y,geometry:se,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")cn(Me,se);else if(Y==="Polygon")cn(Me,se[0]);else if(Y==="MultiLineString")for(const Pe of se)cn(Me,Pe);else if(Y==="MultiPolygon")for(const Pe of se)cn(Me,Pe[0]);return Me}function cn(ze,Y){for(let se=0;se<Y.length;se+=3)ze.minX=Math.min(ze.minX,Y[se]),ze.minY=Math.min(ze.minY,Y[se+1]),ze.maxX=Math.max(ze.maxX,Y[se]),ze.maxY=Math.max(ze.maxY,Y[se+1])}function un(ze,Y,se,ve){if(!Y.geometry)return;const Me=Y.geometry.coordinates;if(Me&&Me.length===0)return;const Pe=Y.geometry.type,U=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let ae=[],Q=Y.id;if(se.promoteId?Q=Y.properties[se.promoteId]:se.generateId&&(Q=ve||0),Pe==="Point")Xn(Me,ae);else if(Pe==="MultiPoint")for(const ne of Me)Xn(ne,ae);else if(Pe==="LineString")Vn(Me,ae,U,!1);else if(Pe==="MultiLineString"){if(se.lineMetrics){for(const ne of Me)ae=[],Vn(ne,ae,U,!1),ze.push(si(Q,"LineString",ae,Y.properties));return}Kn(Me,ae,U,!1)}else if(Pe==="Polygon")Kn(Me,ae,U,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const ne of Y.geometry.geometries)un(ze,{id:Q,geometry:ne,properties:Y.properties},se,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ne of Me){const me=[];Kn(ne,me,U,!0),ae.push(me)}}ze.push(si(Q,Pe,ae,Y.properties))}function Xn(ze,Y){Y.push(ks(ze[0]),$n(ze[1]),0)}function Vn(ze,Y,se,ve){let Me,Pe,U=0;for(let Q=0;Q<ze.length;Q++){const ne=ks(ze[Q][0]),me=$n(ze[Q][1]);Y.push(ne,me,0),Q>0&&(U+=ve?(Me*me-ne*Pe)/2:Math.sqrt(Math.pow(ne-Me,2)+Math.pow(me-Pe,2))),Me=ne,Pe=me}const ae=Y.length-3;Y[2]=1,Ut(Y,0,ae,se),Y[ae+2]=1,Y.size=Math.abs(U),Y.start=0,Y.end=Y.size}function Kn(ze,Y,se,ve){for(let Me=0;Me<ze.length;Me++){const Pe=[];Vn(ze[Me],Pe,se,ve),Y.push(Pe)}}function ks(ze){return ze/360+.5}function $n(ze){const Y=Math.sin(ze*Math.PI/180),se=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return se<0?0:se>1?1:se}function os(ze,Y,se,ve,Me,Pe,U,ae){if(ve/=Y,Pe>=(se/=Y)&&U<ve)return ze;if(U<se||Pe>=ve)return null;const Q=[];for(const ne of ze){const me=ne.geometry;let fe=ne.type;const Ve=Me===0?ne.minX:ne.minY,nt=Me===0?ne.maxX:ne.maxY;if(Ve>=se&&nt<ve){Q.push(ne);continue}if(nt<se||Ve>=ve)continue;let Ye=[];if(fe==="Point"||fe==="MultiPoint")$s(me,Ye,se,ve,Me);else if(fe==="LineString")mo(me,Ye,se,ve,Me,!1,ae.lineMetrics);else if(fe==="MultiLineString")An(me,Ye,se,ve,Me,!1);else if(fe==="Polygon")An(me,Ye,se,ve,Me,!0);else if(fe==="MultiPolygon")for(const st of me){const it=[];An(st,it,se,ve,Me,!0),it.length&&Ye.push(it)}if(Ye.length){if(ae.lineMetrics&&fe==="LineString"){for(const st of Ye)Q.push(si(ne.id,fe,st,ne.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(Ye.length===1?(fe="LineString",Ye=Ye[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=Ye.length===3?"Point":"MultiPoint"),Q.push(si(ne.id,fe,Ye,ne.tags))}}return Q.length?Q:null}function $s(ze,Y,se,ve,Me){for(let Pe=0;Pe<ze.length;Pe+=3){const U=ze[Pe+Me];U>=se&&U<=ve&&xs(Y,ze[Pe],ze[Pe+1],ze[Pe+2])}}function mo(ze,Y,se,ve,Me,Pe,U){let ae=Yo(ze);const Q=Me===0?zo:Jo;let ne,me,fe=ze.start;for(let it=0;it<ze.length-3;it+=3){const Mt=ze[it],Zt=ze[it+1],$t=ze[it+2],Kt=ze[it+3],mr=ze[it+4],Vr=Me===0?Mt:Zt,Xr=Me===0?Kt:mr;let zr=!1;U&&(ne=Math.sqrt(Math.pow(Mt-Kt,2)+Math.pow(Zt-mr,2))),Vr<se?Xr>se&&(me=Q(ae,Mt,Zt,Kt,mr,se),U&&(ae.start=fe+ne*me)):Vr>ve?Xr<ve&&(me=Q(ae,Mt,Zt,Kt,mr,ve),U&&(ae.start=fe+ne*me)):xs(ae,Mt,Zt,$t),Xr<se&&Vr>=se&&(me=Q(ae,Mt,Zt,Kt,mr,se),zr=!0),Xr>ve&&Vr<=ve&&(me=Q(ae,Mt,Zt,Kt,mr,ve),zr=!0),!Pe&&zr&&(U&&(ae.end=fe+ne*me),Y.push(ae),ae=Yo(ze)),U&&(fe+=ne)}let Ve=ze.length-3;const nt=ze[Ve],Ye=ze[Ve+1],st=Me===0?nt:Ye;st>=se&&st<=ve&&xs(ae,nt,Ye,ze[Ve+2]),Ve=ae.length-3,Pe&&Ve>=3&&(ae[Ve]!==ae[0]||ae[Ve+1]!==ae[1])&&xs(ae,ae[0],ae[1],ae[2]),ae.length&&Y.push(ae)}function Yo(ze){const Y=[];return Y.size=ze.size,Y.start=ze.start,Y.end=ze.end,Y}function An(ze,Y,se,ve,Me,Pe){for(const U of ze)mo(U,Y,se,ve,Me,Pe,!1)}function xs(ze,Y,se,ve){ze.push(Y,se,ve)}function zo(ze,Y,se,ve,Me,Pe){const U=(Pe-Y)/(ve-Y);return xs(ze,Pe,se+(Me-se)*U,1),U}function Jo(ze,Y,se,ve,Me,Pe){const U=(Pe-se)/(Me-se);return xs(ze,Y+(ve-Y)*U,Pe,1),U}function go(ze,Y){const se=[];for(let ve=0;ve<ze.length;ve++){const Me=ze[ve],Pe=Me.type;let U;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")U=Qo(Me.geometry,Y);else if(Pe==="MultiLineString"||Pe==="Polygon"){U=[];for(const ae of Me.geometry)U.push(Qo(ae,Y))}else if(Pe==="MultiPolygon"){U=[];for(const ae of Me.geometry){const Q=[];for(const ne of ae)Q.push(Qo(ne,Y));U.push(Q)}}se.push(si(Me.id,Pe,U,Me.tags))}return se}function Qo(ze,Y){const se=[];se.size=ze.size,ze.start!==void 0&&(se.start=ze.start,se.end=ze.end);for(let ve=0;ve<ze.length;ve+=3)se.push(ze[ve]+Y,ze[ve+1],ze[ve+2]);return se}function Wa(ze,Y){if(ze.transformed)return ze;const se=1<<ze.z,ve=ze.x,Me=ze.y;for(const Pe of ze.features){const U=Pe.geometry,ae=Pe.type;if(Pe.geometry=[],ae===1)for(let Q=0;Q<U.length;Q+=2)Pe.geometry.push(Gi(U[Q],U[Q+1],Y,se,ve,Me));else for(let Q=0;Q<U.length;Q++){const ne=[];for(let me=0;me<U[Q].length;me+=2)ne.push(Gi(U[Q][me],U[Q][me+1],Y,se,ve,Me));Pe.geometry.push(ne)}}return ze.transformed=!0,ze}function Gi(ze,Y,se,ve,Me,Pe){return[Math.round(se*(ze*ve-Me)),Math.round(se*(Y*ve-Pe))]}function Fn(ze,Y,se,ve,Me){const Pe=Y===Me.maxZoom?0:Me.tolerance/((1<<Y)*Me.extent),U={features:[],numPoints:0,numSimplified:0,numFeatures:ze.length,source:null,x:se,y:ve,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ae of ze)wl(U,ae,Pe,Me);return U}function wl(ze,Y,se,ve){const Me=Y.geometry,Pe=Y.type,U=[];if(ze.minX=Math.min(ze.minX,Y.minX),ze.minY=Math.min(ze.minY,Y.minY),ze.maxX=Math.max(ze.maxX,Y.maxX),ze.maxY=Math.max(ze.maxY,Y.maxY),Pe==="Point"||Pe==="MultiPoint")for(let ae=0;ae<Me.length;ae+=3)U.push(Me[ae],Me[ae+1]),ze.numPoints++,ze.numSimplified++;else if(Pe==="LineString")qa(U,Me,ze,se,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let ae=0;ae<Me.length;ae++)qa(U,Me[ae],ze,se,Pe==="Polygon",ae===0);else if(Pe==="MultiPolygon")for(let ae=0;ae<Me.length;ae++){const Q=Me[ae];for(let ne=0;ne<Q.length;ne++)qa(U,Q[ne],ze,se,!0,ne===0)}if(U.length){let ae=Y.tags||null;if(Pe==="LineString"&&ve.lineMetrics){ae={};for(const ne in Y.tags)ae[ne]=Y.tags[ne];ae.mapbox_clip_start=Me.start/Me.size,ae.mapbox_clip_end=Me.end/Me.size}const Q={geometry:U,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:ae};Y.id!==null&&(Q.id=Y.id),ze.features.push(Q)}}function qa(ze,Y,se,ve,Me,Pe){const U=ve*ve;if(ve>0&&Y.size<(Me?U:ve))return void(se.numPoints+=Y.length/3);const ae=[];for(let Q=0;Q<Y.length;Q+=3)(ve===0||Y[Q+2]>U)&&(se.numSimplified++,ae.push(Y[Q],Y[Q+1])),se.numPoints++;Me&&function(Q,ne){let me=0;for(let fe=0,Ve=Q.length,nt=Ve-2;fe<Ve;nt=fe,fe+=2)me+=(Q[fe]-Q[nt])*(Q[fe+1]+Q[nt+1]);if(me>0===ne)for(let fe=0,Ve=Q.length;fe<Ve/2;fe+=2){const nt=Q[fe],Ye=Q[fe+1];Q[fe]=Q[Ve-2-fe],Q[fe+1]=Q[Ve-1-fe],Q[Ve-2-fe]=nt,Q[Ve-1-fe]=Ye}}(ae,Pe),ze.push(ae)}const _o={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ea{constructor(Y,se){const ve=(se=this.options=function(Pe,U){for(const ae in U)Pe[ae]=U[ae];return Pe}(Object.create(_o),se)).debug;if(ve&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=function(Pe,U){const ae=[];if(Pe.type==="FeatureCollection")for(let Q=0;Q<Pe.features.length;Q++)un(ae,Pe.features[Q],U,Q);else un(ae,Pe.type==="Feature"?Pe:{geometry:Pe},U);return ae}(Y,se);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(Pe,U){const ae=U.buffer/U.extent;let Q=Pe;const ne=os(Pe,1,-1-ae,ae,0,-1,2,U),me=os(Pe,1,1-ae,2+ae,0,-1,2,U);return(ne||me)&&(Q=os(Pe,1,-ae,1+ae,0,-1,2,U)||[],ne&&(Q=go(ne,1).concat(Q)),me&&(Q=Q.concat(go(me,-1)))),Q}(Me,se),Me.length&&this.splitTile(Me,0,0,0),ve&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,se,ve,Me,Pe,U,ae){const Q=[Y,se,ve,Me],ne=this.options,me=ne.debug;for(;Q.length;){Me=Q.pop(),ve=Q.pop(),se=Q.pop(),Y=Q.pop();const fe=1<<se,Ve=oc(se,ve,Me);let nt=this.tiles[Ve];if(!nt&&(me>1&&console.time("creation"),nt=this.tiles[Ve]=Fn(Y,se,ve,Me,ne),this.tileCoords.push({z:se,x:ve,y:Me}),me)){me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ve,Me,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));const zr=`z${se}`;this.stats[zr]=(this.stats[zr]||0)+1,this.total++}if(nt.source=Y,Pe==null){if(se===ne.indexMaxZoom||nt.numPoints<=ne.indexMaxPoints)continue}else{if(se===ne.maxZoom||se===Pe)continue;if(Pe!=null){const zr=Pe-se;if(ve!==U>>zr||Me!==ae>>zr)continue}}if(nt.source=null,Y.length===0)continue;me>1&&console.time("clipping");const Ye=.5*ne.buffer/ne.extent,st=.5-Ye,it=.5+Ye,Mt=1+Ye;let Zt=null,$t=null,Kt=null,mr=null,Vr=os(Y,fe,ve-Ye,ve+it,0,nt.minX,nt.maxX,ne),Xr=os(Y,fe,ve+st,ve+Mt,0,nt.minX,nt.maxX,ne);Y=null,Vr&&(Zt=os(Vr,fe,Me-Ye,Me+it,1,nt.minY,nt.maxY,ne),$t=os(Vr,fe,Me+st,Me+Mt,1,nt.minY,nt.maxY,ne),Vr=null),Xr&&(Kt=os(Xr,fe,Me-Ye,Me+it,1,nt.minY,nt.maxY,ne),mr=os(Xr,fe,Me+st,Me+Mt,1,nt.minY,nt.maxY,ne),Xr=null),me>1&&console.timeEnd("clipping"),Q.push(Zt||[],se+1,2*ve,2*Me),Q.push($t||[],se+1,2*ve,2*Me+1),Q.push(Kt||[],se+1,2*ve+1,2*Me),Q.push(mr||[],se+1,2*ve+1,2*Me+1)}}getTile(Y,se,ve){Y=+Y,se=+se,ve=+ve;const Me=this.options,{extent:Pe,debug:U}=Me;if(Y<0||Y>24)return null;const ae=1<<Y,Q=oc(Y,se=se+ae&ae-1,ve);if(this.tiles[Q])return Wa(this.tiles[Q],Pe);U>1&&console.log("drilling down to z%d-%d-%d",Y,se,ve);let ne,me=Y,fe=se,Ve=ve;for(;!ne&&me>0;)me--,fe>>=1,Ve>>=1,ne=this.tiles[oc(me,fe,Ve)];return ne&&ne.source?(U>1&&(console.log("found parent tile z%d-%d-%d",me,fe,Ve),console.time("drilling down")),this.splitTile(ne.source,me,fe,Ve,Y,se,ve),U>1&&console.timeEnd("drilling down"),this.tiles[Q]?Wa(this.tiles[Q],Pe):null):null}}function oc(ze,Y,se){return 32*((1<<ze)*se+Y)+ze}function tu(ze,Y){const se=ze.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const ve=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ve)return void Y(null,null);const Me=ne=>ne.tags&&"3d_elevation_id"in ne.tags&&"source"in ne.tags&&ne.tags.source==="elevation",Pe=ve.features.filter(ne=>Me(ne));let U={_geojsonTileLayer:ve.features};Pe.length>0&&(U={_geojsonTileLayer:ve.features.filter(ne=>!Me(ne)),hd_road_elevation:Pe});const ae=new De(U),Q=function(ne){const me=new a.bt;for(const fe of Object.keys(ne))me.writeMessage(3,sr,{name:fe,features:ne[fe]});return me.finish()}(U).buffer;Y(null,{vectorTile:ae,rawData:Q})}class bt extends _e{constructor(Y,se,ve,Me,Pe,U,ae){super(Y,se,ve,Me,Pe,tu,ae),U&&(this.loadGeoJSON=U),this._dynamicIndex=new ft}loadData(Y,se){const ve=Y&&Y.request,Me=ve&&ve.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Y,(Pe,U)=>{if(Pe||!U)return se(Pe);if(typeof U!="object")return se(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Q=a.U(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(ne=>`${ne.key}: ${ne.message}`).join(", "));U.features=U.features.filter(ne=>Q.value.evaluate({zoom:0},ne))}Y.dynamic?(U.type==="Feature"&&(U={type:"FeatureCollection",features:[U]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(U.features,this.loaded),Y.cluster&&(U.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Ci(function({superclusterOptions:Q,clusterProperties:ne}){if(!ne||!Q)return Q;const me={},fe={},Ve={accumulated:null,zoom:0},nt={properties:null},Ye=Object.keys(ne);for(const st of Ye){const[it,Mt]=ne[st],Zt=a.U(Mt),$t=a.U(typeof it=="string"?[it,["accumulated"],["get",st]]:it);me[st]=Zt.value,fe[st]=$t.value}return Q.map=st=>{nt.properties=st;const it={};for(const Mt of Ye)it[Mt]=me[Mt].evaluate(Ve,nt);return it},Q.reduce=(st,it)=>{nt.properties=it;for(const Mt of Ye)Ve.accumulated=st[Mt],st[Mt]=fe[Mt].evaluate(Ve,nt)},Q}(Y)).load(U.features):Y.dynamic?this._dynamicIndex:function(Q,ne){return new Ea(Q,ne)}(U,Y.geojsonVtOptions)}catch(Q){return se(Q)}const ae={};if(Me){const Q=R(ve);Q&&(ae.resourceTiming={},ae.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Q)))}se(null,ae)}})}reloadTile(Y,se){const ve=this.loaded;return ve&&ve[Y.uid]?Y.partial?se(null,void 0):super.reloadTile(Y,se):this.loadTile(Y,se)}loadGeoJSON(Y,se){if(Y.request)a.m(Y.request,se);else{if(typeof Y.data!="string")return se(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return se(null,JSON.parse(Y.data))}catch{return se(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Y,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ve){se(ve)}}getClusterChildren(Y,se){try{se(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ve){se(ve)}}getClusterLeaves(Y,se){try{se(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ve){se(ve)}}}class ea{constructor(Y,se,ve){this.tileID=new a.aO(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=se,this.worldview=ve}parse(Y,se,ve,Me){this.status="parsing";const Pe=new a.aO(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),U=[],ae=se.familiesBySource[ve.source],Q=new a.fe(Pe,ve.promoteId);Q.bucketLayerIDs=[],Q.is3DTile=!0,a.ft(Y).then(ne=>{if(!ne)return Me(new Error("Could not parse tile"));const me=ne.json.extensionsUsed&&ne.json.extensionsUsed.includes("MAPBOX_mesh_features")||ne.json.asset.extras&&ne.json.asset.extras.MAPBOX_mesh_features,fe=ne.json.extensionsUsed&&ne.json.extensionsUsed.includes("EXT_meshopt_compression"),Ve=new a.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const nt in ae)for(const Ye of ae[nt]){const st=Ye[0];Q.bucketLayerIDs.push(Ye.map(Zt=>a.B(Zt.id,Zt.scope))),st.recalculate(Ve,[]);const it=a.fu(ne,1/a.d6(ve.tileID.canonical)),Mt=new a.fv(Ye,it,Pe,me,fe,this.brightness,Q,this.worldview);me||(Mt.needsUpload=!0),U.push(Mt),Mt.evaluate(st)}this.status="done",Me(null,{buckets:U,featureIndex:Q,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ne=>Me(new Error(ne.message)))}}class bh{constructor(Y,se,ve,Me,Pe,U,ae,Q){this.actor=Y,this.layerIndex=se,this.availableImages=ve,this.availableModels=Me,this.brightness=ae,this.loading={},this.loaded={},this.worldview=Q}loadTile(Y,se){const ve=Y.uid,Me=this.loading[ve]=new ea(Y,this.brightness,this.worldview);a.bu(Y.request,(Pe,U)=>{const ae=!this.loading[ve];return delete this.loading[ve],ae||Pe?(Me.status="done",ae||(this.loaded[ve]=Me),se(Pe)):U&&U.byteLength!==0?void Me.parse(U,this.layerIndex,Y,(Q,ne)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[ve]=Me,Q||!ne?se(Q):se(null,ne)}):(Me.status="done",this.loaded[ve]=Me,se())})}reloadTile(Y,se){const ve=this.loaded,Me=Y.uid;if(ve&&ve[Me]){const Pe=ve[Me];Pe.projection=Y.projection,Pe.brightness=Y.brightness;const U=(ae,Q)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(Y,se)),se(ae,Q)};Pe.status==="parsing"?Pe.reloadCallback=U:Pe.status==="done"&&this.loadTile(Y,se)}}abortTile(Y,se){const ve=Y.uid;this.loading[ve]&&delete this.loading[ve],se()}removeTile(Y,se){const ve=this.loaded,Me=Y.uid;ve&&ve[Me]&&delete ve[Me],se()}}class bl{constructor(Y){this.self=Y,this.actor=new a.fx(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cl({name:"mercator"}),this.workerSourceTypes={vector:_e,geojson:bt,"raster-dem":pe,"raster-array":ie,"batched-model":bh},this.workerSources={},this.self.registerWorkerSource=(se,ve)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=ve},this.self.registerRTLTextPlugin=se=>{if(a.fy.isParsed())throw new Error("RTL text plugin already registered.");a.fy.setState({pluginStatus:a.fz.parsed,pluginURL:a.fy.getPluginURL()}),a.fy.applyArabicShaping=se.applyArabicShaping,a.fy.processBidirectionalText=se.processBidirectionalText,a.fy.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const ve of this.rtlPluginParsingListeners)ve(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,se,ve){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],ve()}checkIfReady(Y,se,ve){ve()}setReferrer(Y,se){this.referrer=se}spriteLoaded(Y,se){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:ve,isLoaded:Me}=se;if(this.isSpriteLoaded[Y][ve]=Me,this.workerSources[Y]&&this.workerSources[Y][ve])for(const Pe in this.workerSources[Y][ve]){const U=this.workerSources[Y][ve][Pe];for(const ae in U){const Q=U[ae];Q instanceof _e&&(Q.isSpriteLoaded=Me,Q.fire(new a.z("isSpriteLoaded")))}}}setImages(Y,se,ve){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:Me,images:Pe}=se;if(this.availableImages[Y][Me]=Pe,this.workerSources[Y]&&this.workerSources[Y][Me]){for(const U in this.workerSources[Y][Me]){const ae=this.workerSources[Y][Me][U];for(const Q in ae)ae[Q].availableImages=Pe}ve()}else ve()}setModels(Y,{scope:se,models:ve},Me){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][se]=ve,this.workerSources[Y]&&this.workerSources[Y][se]){for(const Pe in this.workerSources[Y][se]){const U=this.workerSources[Y][se][Pe];for(const ae in U)U[ae].availableModels=ve}Me()}else Me()}setProjection(Y,se){this.projections[Y]=a.cl(se)}setBrightness(Y,se,ve){this.brightness=se,ve()}setWorldview(Y,se,ve){this.worldview=se,ve()}setLayers(Y,se,ve){this.getLayerIndex(Y,se.scope).replace(se.layers,se.options),ve()}updateLayers(Y,se,ve){this.getLayerIndex(Y,se.scope).update(se.layers,se.removedIds,se.options),ve()}loadTile(Y,se,ve){se.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,se.type,se.source,se.scope).loadTile(se,ve)}decodeRasterArray(Y,se,ve){this.getWorkerSource(Y,se.type,se.source,se.scope).decodeRasterArray(se,ve)}reloadTile(Y,se,ve){se.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,se.type,se.source,se.scope).reloadTile(se,ve)}abortTile(Y,se,ve){this.getWorkerSource(Y,se.type,se.source,se.scope).abortTile(se,ve)}removeTile(Y,se,ve){this.getWorkerSource(Y,se.type,se.source,se.scope).removeTile(se,ve)}removeSource(Y,se,ve){if(!(this.workerSources[Y]&&this.workerSources[Y][se.scope]&&this.workerSources[Y][se.scope][se.type]&&this.workerSources[Y][se.scope][se.type][se.source]))return;const Me=this.workerSources[Y][se.scope][se.type][se.source];delete this.workerSources[Y][se.scope][se.type][se.source],Me.removeSource!==void 0?Me.removeSource(se,ve):ve()}loadWorkerSource(Y,se,ve){try{this.self.importScripts(se.url),ve()}catch(Me){ve(Me.toString())}}syncRTLPluginState(Y,se,ve){if(a.fy.isParsed())ve(null,!0);else if(a.fy.isParsing())this.rtlPluginParsingListeners.push(ve);else try{a.fy.setState(se);const Me=a.fy.getPluginURL();!a.fy.isLoaded()||a.fy.isParsed()||a.fy.isParsing()||Me==null||(a.fy.setState({pluginStatus:a.fz.parsing,pluginURL:a.fy.getPluginURL()}),this.self.importScripts(Me),a.fy.isParsed()?ve(null,!0):this.rtlPluginParsingListeners.push(ve))}catch(Me){ve(Me.toString())}}setDracoUrl(Y,se){this.dracoUrl=se}getAvailableImages(Y,se){this.availableImages[Y]||(this.availableImages[Y]={});let ve=this.availableImages[Y][se];return ve||(ve=[]),ve}getAvailableModels(Y,se){this.availableModels[Y]||(this.availableModels[Y]={});let ve=this.availableModels[Y][se];return ve||(ve={}),ve}getLayerIndex(Y,se){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let ve=this.layerIndexes[Y][se];return ve||(ve=this.layerIndexes[Y][se]=new H,ve.scope=se),ve}getWorkerSource(Y,se,ve,Me){const Pe=this.workerSources;return Pe[Y]||(Pe[Y]={}),Pe[Y][Me]||(Pe[Y][Me]={}),Pe[Y][Me][se]||(Pe[Y][Me][se]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),Pe[Y][Me][se][ve]||(Pe[Y][Me][se][ve]=new this.workerSourceTypes[se]({send:(U,ae,Q,ne,me,fe)=>this.actor.send(U,ae,Q,Y,me,fe),scheduler:this.actor.scheduler},this.getLayerIndex(Y,Me),this.getAvailableImages(Y,Me),this.getAvailableModels(Y,Me),this.isSpriteLoaded[Y][Me],void 0,this.brightness,this.worldview)),Pe[Y][Me][se][ve]}rasterizeImagesWorker(Y,se,ve){const Me=new Map;for(const[Pe,{image:U,imageVariant:ae}]of se.tasks.entries()){const Q=this.imageRasterizer.rasterize(ae,U,se.scope,Y);Me.set(Pe,Q)}ve(void 0,Me)}removeRasterizedImages(Y,se,ve){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,Y),ve()}enforceCacheSizeLimit(Y,se){a.fA(se)}getWorkerPerformanceMetrics(Y,se,ve){ve(void 0,void 0)}}return a.fw(self)&&(self.worker=new bl(self)),bl}),v(["./shared"],function(a){var R="3.15.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},B={mark(f){performance.mark(f)},measure(f,i,l){performance.measure(f,i,l)}};function H(f){const i=f.name.split("?")[0];return a.a(i)&&i.includes("mapbox-gl.js")?"javascript":a.a(i)&&i.includes("mapbox-gl.css")?"css":a.b(i)?"fontRange":a.c(i)?"sprite":a.i(i)?"style":a.d(i)?"tilejson":"other"}var q,ee={},re=function(){if(q)return ee;function f(d){return!i(d)}function i(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,w,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{w=new Worker(A),y=!0}catch{y=!1}return w&&w.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var w=y.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===y.width}()?(l[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(l[_]=function(y){var w,S=function(A){var P=document.createElement("canvas"),M=Object.create(f.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=A,P.getContext("webgl2",M)}(y);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(_)),l[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}q=1,ee.supported=f,ee.notSupportedReason=i;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ee}();function J(f,i,l){const d=document.createElement(f);return i!=null&&(d.className=i),l&&l.appendChild(d),d}function _e(f,i,l){const d=document.createElementNS("http://www.w3.org/2000/svg",f);for(const _ of Object.keys(i))d.setAttributeNS(null,_,String(i[_]));return l&&l.appendChild(d),d}const pe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ue=pe&&pe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ie;function ke(){pe&&ue&&(ie=pe[ue],pe[ue]="none")}function at(){pe&&ue&&(pe[ue]=ie)}function He(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",He,!0)}function De(){window.addEventListener("click",He,!0),window.setTimeout(()=>{window.removeEventListener("click",He,!0)},0)}function et(f,i){const l=f.getBoundingClientRect();return tt(f,l,i)}function Ge(f,i){const l=f.getBoundingClientRect(),d=[];for(let _=0;_<i.length;_++)d.push(tt(f,l,i[_]));return d}function ft(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function tt(f,i,l){const d=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new a.P((l.clientX-i.left)*d,(l.clientY-i.top)*d)}const Ot="01",Xt="NO_ACCESS_TOKEN";class Dr{constructor(i,l,d){this._transformRequestFn=i,this._customAccessToken=l,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const i=function(){let l="";for(let d=0;d<10;d++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ot,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,l){return this._transformRequestFn&&this._transformRequestFn(i,l)||{url:i}}normalizeStyleURL(i,l){if(!a.h(i))return i;const d=Ir(i);return d.params.push(`sdk=js-${R}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeGlyphsURL(i,l){if(!a.h(i))return i;const d=Ir(i);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeModelURL(i,l){if(!a.h(i))return i;const d=Ir(i);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeSourceURL(i,l,d,_){if(!a.h(i))return i;const y=Ir(i);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||l)}normalizeIconsetURL(i,l){const d=Ir(i);return a.h(i)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||l)):ei(d)}normalizeSpriteURL(i,l,d,_){const y=Ir(i);return a.h(i)?(y.path=`/styles/v1${y.path}/sprite${l}${d}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${l}${d}`,ei(y))}normalizeTileURL(i,l,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!a.h(i))return i;const _=Ir(i);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||d&&_.authority!=="raster"&&d===512?"@2x":""}${a.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${a.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${a.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${a.e.TILE_URL_VERSION}${_.path}`);const y=this._customAccessToken||function(w){for(const S of w){const A=S.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(_.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(i,l){const d=Ir(i);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return i;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return l&&(y=y.filter(w=>!w.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(i,l){const d=!!l&&a.h(l),_=[];for(const y of i.tiles||[])a.j(y)?_.push(this.canonicalizeTileURL(y,d)):_.push(y);return _}_makeAPIURL(i,l){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Ir(a.e.API_URL);if(i.protocol=_.protocol,i.authority=_.authority,i.protocol==="http"){const y=i.params.indexOf("secure");y>=0&&i.params.splice(y,1)}if(_.path!=="/"&&(i.path=`${_.path}${i.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return ei(i);if(l=l||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return i.params=i.params.filter(y=>y.indexOf("access_token")===-1),i.params.push(`access_token=${l||""}`),ei(i)}}const ir=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ir(f){const i=f.match(ir);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ei(f){const i=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${i}`}const sr="mapbox.eventData";function yr(f){if(!f)return null;const i=f.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(a.l(i[1]))}catch{return null}}class vr{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=yr(a.e.ACCESS_TOKEN);let d="";return d=l&&l.u?a.f(l.u):a.e.ACCESS_TOKEN||"",i?`${sr}.${i}:${d}`:`${sr}:${d}`}fetchEventData(){const i=a.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(i)try{const _=localStorage.getItem(l);_&&(this.eventData=JSON.parse(_));const y=localStorage.getItem(d);y&&(this.anonId=y)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const i=a.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(i&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,d,_){if(!a.e.EVENTS_URL)return;const y=Ir(a.e.EVENTS_URL);y.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(i).toISOString()},S=l?Object.assign(w,l):w,A={url:ei(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=a.p(A,P=>{this.pendingRequest=null,d(P),this.saveEventData(),this.processRequests(_)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const gr=new class extends vr{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,i){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(l=>a.h(l)||a.j(l))&&this.queueRequest(Date.now(),i)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=yr(a.e.ACCESS_TOKEN),l=i?i.u:a.e.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(_),S=(_-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||y.getDate()!==w.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Ot,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=l)},f):this.processRequests()}},Ue=gr.postTurnstileEvent.bind(gr),vt=new class extends vr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,i,l,d){this.skuToken=i,this.errorCb=d,a.e.EVENTS_URL&&(l||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Xt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Ot,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},f))}remove(){this.errorCb=null}},ct=vt.postMapLoadEvent.bind(vt),ht=new class extends vr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let i=this.mapInstanceIdMap.get(f);return i||(i=a.u(),this.mapInstanceIdMap.set(f,i)),i}getEventId(f){const i=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,i+1),i}postStyleLoadEvent(f,i){const{map:l,style:d,importedStyles:_}=i;if(!a.e.EVENTS_URL||!f&&!a.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(l),w={mapInstanceId:y,eventId:this.getEventId(y),style:d};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:l}=this.queue.shift();this.postEvent(i,l,()=>{},f)}},Pt=ht.postStyleLoadEvent.bind(ht),dr=new class extends vr{constructor(){super("gljs.performance")}postPerformanceEvent(f,i){a.e.EVENTS_URL&&(f||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:l}=this.queue.shift(),d=function(_){const y=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),S=function(j){const V={};if(j){for(const G in j)if(G!=="other")for(const te of j[G]){const K=`${G}ResolveRangeMin`,oe=`${G}ResolveRangeMax`,he=`${G}RequestCount`,ge=`${G}RequestCachedCount`;V[K]=Math.min(V[K]||1/0,te.startTime),V[oe]=Math.max(V[oe]||-1/0,te.responseEnd);const Se=be=>{V[be]===void 0&&(V[be]=0),++V[be]};te.transferSize!==void 0&&te.transferSize===0&&Se(ge),Se(he)}}return V}(function(j,V){const G={};if(j)for(const te of j){const K=V(te);G[K]===void 0&&(G[K]=[]),G[K].push(te)}return G}(y,H)),A=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=P?P.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},D=(j,V,G)=>{G!=null&&j.push({name:V,value:G.toString()})};for(const j in S)D(z.counters,j,S[j]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(D(z.counters,"interactionRangeMin",_.interactionRange[0]),D(z.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const j of Object.keys(O)){const V=O[j],G=w.find(te=>te.name===V);G&&D(z.counters,V,G.startTime)}return D(z.counters,"visibilityHidden",_.visibilityHidden),D(z.attributes,"style",function(j){if(j)for(const V of j){const G=V.name.split("?")[0];if(a.i(G)){const te=G.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(y)),D(z.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),D(z.attributes,"fogEnabled",_.fogEnabled?"true":"false"),D(z.attributes,"projection",_.projection),D(z.attributes,"zoom",_.zoom),D(z.metadata,"devicePixelRatio",A),D(z.metadata,"connectionEffectiveType",M),D(z.metadata,"navigatorUserAgent",navigator.userAgent),D(z.metadata,"screenWidth",window.screen.width),D(z.metadata,"screenHeight",window.screen.height),D(z.metadata,"windowWidth",window.innerWidth),D(z.metadata,"windowHeight",window.innerHeight),D(z.metadata,"mapWidth",_.width/A),D(z.metadata,"mapHeight",_.height/A),D(z.metadata,"webglRenderer",_.renderer),D(z.metadata,"webglVendor",_.vendor),D(z.metadata,"sdkVersion",R),D(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(l);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(i,d,()=>{},f)}},br=dr.postPerformanceEvent.bind(dr),ar=new class extends vr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,i,l,d){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const _=Ir(a.e.API_URL+a.e.SESSION_PATH);_.params.push(`sku=${i||""}`),_.params.push(`access_token=${d||a.e.ACCESS_TOKEN||""}`);const y={url:ei(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(y,w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(d)})}getSessionAPI(f,i,l,d){this.skuToken=i,this.errorCb=d,a.e.SESSION_PATH&&a.e.API_URL&&(l||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Xt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},f)}remove(){this.errorCb=null}},Qt=ar.getSessionAPI.bind(ar),Ci=new Set;function bi(f,i){i?Ci.add(f):Ci.delete(f)}class Ln{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,l){this._updatedSourceCaches[i]=l,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const l=i.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(i.id),this.setDirty()}removeLayer(i){const l=i.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][i.id]=i,this._updatedLayers[l].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const l in this._updatedLayers)i[l]=i[l]||{},i[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)i[l]=i[l]||{},i[l].removedIds=Object.keys(this._removedLayers[l]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(i){return this._updatedImages[i]?Array.from(this._updatedImages[i].values()):[]}updateImage(i,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(a.I.toString(i)),this.setDirty()}resetUpdatedImages(i){this._updatedImages[i]&&this._updatedImages[i].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function gi(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class Pi extends a.E{constructor(i){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=i,i!=="raster"&&a.r()&&(this.imageRasterizerDispatcher=new a.D(a.t(),this,"Image Rasterizer Worker",1))}addScope(i){this.loaded.set(i,!1),this.imageProviders.set(i,new Map),this.images.set(i,new Map),this.updatedImages.set(i,new Set),this.callbackDispatchedThisFrame.set(i,new Set),this.patterns.set(i,new Map),this.atlasImage.set(i,new a.q({width:1,height:1}))}removeScope(i){this.loaded.delete(i),this.imageProviders.delete(i),this.images.delete(i),this.updatedImages.delete(i),this.callbackDispatchedThisFrame.delete(i),this.patterns.delete(i),this.atlasImage.delete(i);const l=this.atlasTexture.get(i);l&&(l.destroy(),this.atlasTexture.delete(i))}addImageProvider(i,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(i.id,i)}removeImageProvider(i,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(i)}getPendingImageProviders(){const i=[];for(const l of this.imageProviders.values())for(const d of l.values())d.hasPendingRequests()&&i.push(d);return i}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.x),this._imageRasterizer}isLoaded(){for(const i of this.loaded.keys())if(!this.loaded.get(i))return!1;return!0}setLoaded(i,l){if(this.loaded.get(l)!==i&&(this.loaded.set(l,i),i)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,l,_);this.requestors=[]}}hasImage(i,l){return!!this.getImage(i,l)}getImage(i,l){return this.images.get(l).get(i.toString())}addImage(i,l,d){this._validate(i,d)&&this.images.get(l).set(i.toString(),d)}_validate(i,l){let d=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "content" value`))),d=!1),d}_validateStretch(i,l){if(!i)return!0;let d=0;for(const _ of i){if(_[0]<d||_[1]<_[0]||l<_[1])return!1;d=_[1]}return!0}_validateContent(i,l){return i?i.length!==4||!l.usvg&&(i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,l,d){const _=this.images.get(l).get(i.toString());d.version=_.version+1,this.images.get(l).set(i.toString(),d),this.updatedImages.get(l).add(i),this.removeFromImageRasterizerCache(i,l)}clearUpdatedImages(i){this.updatedImages.get(i).clear()}removeFromImageRasterizerCache(i,l){this.spriteFormat!=="raster"&&(a.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([i],l))}removeImage(i,l){const d=this.images.get(l),_=d.get(i.toString());d.delete(i.toString()),this.patterns.get(l).delete(i.toString()),this.removeFromImageRasterizerCache(i,l),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(i){return Array.from(this.images.get(i).keys()).map(l=>a.I.from(l))}getImages(i,l,d){const _=[],y=[],w=this.imageProviders.get(l);for(const M of i){if(!M.iconsetId){_.push(M);continue}const z=w.get(M.iconsetId);z&&(this.getImage(M,l)?y.push(M):z.addPendingRequest(M))}if(_.length===0)return void this._notify(y,l,d);let S=!0;const A=!!this.loaded.get(l),P=this.images.get(l);if(!A)for(const M of _)P.has(M.toString())||(S=!1);A||S?this._notify(_,l,d):this.requestors.push({ids:_,scope:l,callback:d})}rasterizeImages(i,l){const d=new Map,{tasks:_,scope:y}=i;for(const[w,S]of _.entries()){const A=this.getImage(S.id,y);A&&d.set(w,{image:A,imageVariant:S})}this._rasterizeImages(y,d,l)}_rasterizeImages(i,l,d){if(a.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:i},d);else{const _=new Map;for(const[y,{image:w,imageVariant:S}]of l.entries())_.set(y,this.imageRasterizer.rasterize(S,w,i,0));d(void 0,_)}}getUpdatedImages(i){return this.updatedImages.get(i)||new Set}_notify(i,l,d){const _=this.images.get(l),y=new Map;for(const w of i){if(!_.get(w.toString())){if(w.iconsetId)continue;this.fire(new a.z("styleimagemissing",{id:w.name}))}const S=_.get(w.toString());if(!S){a.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(A,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),y.set(a.I.toString(w),A)}d(null,y)}getPixelSize(i){const{width:l,height:d}=this.atlasImage.get(i);return{width:l,height:d}}getPattern(i,l,d){const _=i.toString(),y=this.patterns.get(l),w=y.get(_),S=this.getImage(i,l);if(!S)return null;if(w){if(w.position.version===S.version)return w.position;w.position.version=S.version}else{if(S.usvg&&!S.data){const A=this.getPatternInFlightId(_,l);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const P=new a.A(i).scaleSelf(a.o.devicePixelRatio),M=new Map([[P.toString(),{image:S,imageVariant:P}]]);return this._rasterizeImages(l,M,(z,D)=>this.storePatternImage(P,l,S,d,D)),null}this.storePattern(i,l,S)}return this._updatePatternAtlas(l,d),y.get(_).position}getPatternInFlightId(i,l){return a.B(i,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(i,l,d,_,y){const w=i.toString(),S=y?y.get(w):void 0;S&&(d.data=S,this.storePattern(i.id,l,d),this._updatePatternAtlas(l,_),this.patternsInFlight.delete(this.getPatternInFlightId(i.id.toString(),l)))}storePattern(i,l,d){const _={w:d.data.width+2*a.C,h:d.data.height+2*a.C,x:0,y:0},y=new a.F(_,d,a.C);this.patterns.get(l).set(i.toString(),{bin:_,position:y})}destroyAtlasTextures(){for(const i of this.atlasTexture.values())i&&i.destroy();this.atlasTexture.clear()}bind(i,l){const d=i.gl;let _=this.atlasTexture.get(l);_?this.dirty&&(_.update(this.atlasImage.get(l)),this.dirty=!1):(_=new a.T(i,this.atlasImage.get(l),d.RGBA8),this.atlasTexture.set(l,_)),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(i,l){const d=this.patterns.get(i),_=Array.from(d.values()).map(({bin:P})=>P),{w:y,h:w}=a.G(_),S=this.atlasImage.get(i);S.resize({width:y||1,height:w||1});const A=this.images.get(i);for(const[P,{bin:M,position:z}]of d.entries()){let D=z.padding;const j=M.x+D,V=M.y+D,G=A.get(P).data,te=G.width,K=G.height;D=D>1?D-1:D,a.q.copy(G,S,{x:0,y:0},{x:j,y:V},{width:te,height:K},l),a.q.copy(G,S,{x:0,y:K-D},{x:j,y:V-D},{width:te,height:D},l),a.q.copy(G,S,{x:0,y:0},{x:j,y:V+K},{width:te,height:D},l),a.q.copy(G,S,{x:te-D,y:0},{x:j-D,y:V},{width:D,height:K},l),a.q.copy(G,S,{x:0,y:0},{x:j+te,y:V},{width:D,height:K},l),a.q.copy(G,S,{x:te-D,y:K-D},{x:j-D,y:V-D},{width:D,height:D},l),a.q.copy(G,S,{x:0,y:K-D},{x:j+te,y:V-D},{width:D,height:D},l),a.q.copy(G,S,{x:0,y:0},{x:j+te,y:V+K},{width:D,height:D},l),a.q.copy(G,S,{x:te-D,y:0},{x:j-D,y:V+K},{width:D,height:D},l)}this.dirty=!0}beginFrame(){for(const i of this.images.keys())this.callbackDispatchedThisFrame.set(i,new Set)}dispatchRenderCallbacks(i,l){const d=this.images.get(l);for(const _ of i){if(this.callbackDispatchedThisFrame.get(l).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(_.toString());const y=d.get(_.toString());gi(y)&&this.updateImage(_,l,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function fr(f){const i=f.value,l=f.valueSpec,d=f.style,_=f.styleSpec,y=f.key,w=f.arrayElementValidator||Gi;if(!Array.isArray(i))return[new a.V(y,i,`array expected, ${a.K(i)} found`)];if(l.length&&i.length!==l.length)return[new a.V(y,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new a.V(y,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(S.function=l.function),a.H(l.value)&&(S=l.value);let A=[];for(let P=0;P<i.length;P++)A=A.concat(w({array:i,arrayIndex:P,value:i[P],valueSpec:S,style:d,styleSpec:_,key:`${y}[${P}]`},!0));return A}function Ut(f){const i=f.key,l=f.value,d=f.valueSpec;if(!a.L(l))return[new a.V(i,l,`number expected, ${a.K(l)} found`)];if(l!=l)return[new a.V(i,l,"number expected, NaN found")];if("minimum"in d){let _=d.minimum;if(Array.isArray(d.minimum)&&(_=d.minimum[f.arrayIndex]),l<_)return[new a.V(i,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in d){let _=d.maximum;if(Array.isArray(d.maximum)&&(_=d.maximum[f.arrayIndex]),l>_)return[new a.V(i,l,`${l} is greater than the maximum value ${_}`)]}return[]}function ti(f){const i=f.key,l=f.value;if(!a.H(l))return[new a.V(i,l,`object expected, ${a.K(l)} found`)];const d=f.valueSpec,_=a.J(l.type);let y,w,S,A={};const P=_!=="categorical"&&l.property===void 0,M=!P,z=function(G){const te=G.stops;return Array.isArray(te)&&Array.isArray(te[0])&&a.H(te[0][0])}(l),D=Fn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(G){if(_==="identity")return[new a.V(G.key,G.value,'identity function may not have a "stops" property')];let te=[];const K=G.value;return te=te.concat(fr({key:G.key,value:K,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:j})),Array.isArray(K)&&K.length===0&&te.push(new a.V(G.key,K,"array must have at least one stop")),te},default:function(G){return Gi({key:G.key,value:G.value,valueSpec:d,style:G.style,styleSpec:G.styleSpec})}}});return _==="identity"&&P&&D.push(new a.V(f.key,f.value,'missing required property "property"')),_==="identity"||l.stops||D.push(new a.V(f.key,f.value,'missing required property "stops"')),_==="exponential"&&d.expression&&!a.M(d)&&D.push(new a.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(M&&!a.N(d)?D.push(new a.V(f.key,f.value,"property functions not supported")):P&&!a.O(d)&&D.push(new a.V(f.key,f.value,"zoom functions not supported"))),_!=="categorical"&&!z||l.property!==void 0||D.push(new a.V(f.key,f.value,'"property" property is required')),D;function j(G){let te=[];const K=G.value,oe=G.key;if(!Array.isArray(K))return[new a.V(oe,K,`array expected, ${a.K(K)} found`)];if(K.length!==2)return[new a.V(oe,K,`array length 2 expected, length ${K.length} found`)];if(z){if(!a.H(K[0]))return[new a.V(oe,K,`object expected, ${a.K(K[0])} found`)];const he=K[0];if(he.zoom===void 0)return[new a.V(oe,K,"object stop key must have zoom")];if(he.value===void 0)return[new a.V(oe,K,"object stop key must have value")];const ge=a.J(he.zoom);if(typeof ge!="number")return[new a.V(oe,he.zoom,"stop zoom values must be numbers")];if(S&&S>ge)return[new a.V(oe,he.zoom,"stop zoom values must appear in ascending order")];ge!==S&&(S=ge,w=void 0,A={}),te=te.concat(Fn({key:`${oe}[0]`,value:K[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Ut,value:V}}))}else te=te.concat(V({key:`${oe}[0]`,value:K[0],style:G.style,styleSpec:G.styleSpec},K));return a.Q(a.S(K[1]))?te.concat([new a.V(`${oe}[1]`,K[1],"expressions are not allowed in function stops.")]):te.concat(Gi({key:`${oe}[1]`,value:K[1],valueSpec:d,style:G.style,styleSpec:G.styleSpec}))}function V(G,te){const K=a.K(G.value),oe=a.J(G.value),he=G.value!==null?G.value:te;if(y){if(K!==y)return[new a.V(G.key,he,`${K} stop domain type must match previous stop domain type ${y}`)]}else y=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof oe!="number"&&typeof oe!="string"&&typeof oe!="boolean")return[new a.V(G.key,he,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&_!=="categorical"){let ge=`number expected, ${K} found`;return a.N(d)&&_===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(G.key,he,ge)]}return _!=="categorical"||K!=="number"||typeof oe=="number"&&isFinite(oe)&&Math.floor(oe)===oe?_!=="categorical"&&K==="number"&&typeof oe=="number"&&typeof w=="number"&&w!==void 0&&oe<w?[new a.V(G.key,he,"stop domain values must appear in ascending order")]:(w=oe,_==="categorical"&&oe in A?[new a.V(G.key,he,"stop domain values must be unique")]:(A[oe]=!0,[])):[new a.V(G.key,he,`integer expected, found ${String(oe)}`)]}}function si(f){const i=(f.expressionContext==="property"?a.W:a.U)(a.S(f.value),f.valueSpec);if(i.result==="error")return i.value.map(d=>new a.V(`${f.key}${d.key}`,f.value,d.message));const l=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new a.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!a.Z(l))return[new a.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return cn(l,f);if(f.expressionContext==="appearance")return un(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!a.X(l,["zoom","feature-state"]))return[new a.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!a.Y(l))return[new a.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cn(f,i){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const _ of i.valueSpec.expression.parameters)l.delete(_);if(l.size===0)return[];const d=[];return f instanceof a._&&l.has(f.name)?[new a.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(_=>{d.push(...cn(_,i))}),d)}function un(f,i){const l=new Set;if(i.valueSpec&&i.valueSpec.expression)for(const _ of i.valueSpec.expression.parameters)l.add(_);if(l.size===0)return[];const d=[];return f instanceof a._&&!l.has(f.name)?[new a.V(i.key,i.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(_=>{d.push(...un(_,i))}),d)}function Xn(f){const i=f.key,l=f.value,d=f.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(a.J(l))===-1&&_.push(new a.V(i,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(a.J(l))===-1&&_.push(new a.V(i,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function Vn(f){return a.a2(a.S(f.value))?si(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Kn(f)}function Kn(f){const i=f.value,l=f.key;if(!Array.isArray(i))return[new a.V(l,i,`array expected, ${a.K(i)} found`)];if(i.length<1)return[new a.V(l,i,"filter array must have at least 1 element")];const d=f.styleSpec;let _=Xn({key:`${l}[0]`,value:i[0],valueSpec:d.filter_operator});switch(a.J(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&a.J(i[1])==="$type"&&_.push(new a.V(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&_.push(new a.V(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(a.a0(i[1])||_.push(new a.V(`${l}[1]`,i[1],`string expected, ${a.K(i[1])} found`)));for(let y=2;y<i.length;y++)a.J(i[1])==="$type"?_=_.concat(Xn({key:`${l}[${y}]`,value:i[y],valueSpec:d.geometry_type})):a.a0(i[y])||a.L(i[y])||a.$(i[y])||_.push(new a.V(`${l}[${y}]`,i[y],`string, number, or boolean expected, ${a.K(i[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)_=_.concat(Kn({key:`${l}[${y}]`,value:i[y],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":i.length!==2?_.push(new a.V(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):a.a0(i[1])||_.push(new a.V(`${l}[1]`,i[1],`string expected, ${a.K(i[1])} found`))}return _}function ks(f,i){const l=f.key,d=f.style,_=f.layer,y=f.styleSpec,w=f.value,S=f.objectKey,A=y[`${i}_${f.layerType}`];if(!A)return[];const P=S.match(/^(.*)-use-theme$/);if(P&&A[P[1]])return a.Q(w)?[].concat(Gi({key:f.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:i,propertyKey:S})):Gi({key:l,value:w,valueSpec:{type:"string"},style:d,styleSpec:y});const M=S.match(/^(.*)-transition$/);if(i==="paint"&&M&&A[M[1]]&&A[M[1]].transition)return Gi({key:l,value:w,valueSpec:y.transition,style:d,styleSpec:y});const z=f.valueSpec||A[S];if(!z)return[new a.a3(l,w,`unknown property "${S}"`)];let D;if(a.a0(w)&&a.N(z)&&!z.tokens&&(D=/^{([^}]+)}$/.exec(w))){const V=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new a.V(l,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const j=[];if(f.layerType==="symbol")S!=="text-field"||!d||d.glyphs||d.imports||j.push(new a.V(l,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&a.a4(a.S(w))&&a.J(w.type)==="identity"&&j.push(new a.V(l,w,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&a.N(z)&&(a.a5(z)||a.O(z))){const V=a.W(a.S(w),z),G=V.value.expression||V.value._styleExpression.expression;G&&!a.X(G,["measure-light"])&&(S==="model-emissive-strength"&&a.Y(G)&&a.Z(G)||j.push(new a.V(l,w,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Gi({key:f.key,value:w,valueSpec:z,style:d,styleSpec:y,expressionContext:"property",propertyType:i,propertyKey:S}))}function $n(f){return ks(f,"paint")}function os(f){return ks(f,"layout")}function $s(f){let i=[];const l=f.value,d=f.key,_=f.style,y=f.styleSpec;if(!a.H(l))return[new a.V(d,l,"object expected")];l.type||l.ref||i.push(new a.V(d,l,'either "type" or "ref" is required'));let w=a.J(l.type);const S=a.J(l.ref);if(l.id){const A=a.J(l.id);for(let P=0;P<f.arrayIndex;P++){const M=_.layers[P];a.J(M.id)===A&&i.push(new a.V(d,l.id,`duplicate layer id "${A}", previously used at line ${M.id.__line__}`))}}if("ref"in l){let A;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&i.push(new a.V(d,l[P],`"${P}" is prohibited for ref layers`))}),_.layers.forEach(P=>{a.J(P.id)===S&&(A=P)}),A?A.ref?i.push(new a.V(d,l.ref,"ref cannot reference another ref layer")):w=a.J(A.type):typeof S=="string"&&i.push(new a.V(d,l.ref,`ref layer "${S}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(l.source)if(a.a0(l.source)){const A=_.sources&&_.sources[l.source],P=A&&a.J(A.type);A?P==="vector"&&w==="raster"?i.push(new a.V(d,l.source,`layer "${l.id}" requires a raster source`)):P==="raster"&&w!=="raster"?i.push(new a.V(d,l.source,`layer "${l.id}" requires a vector source`)):P!=="vector"||l["source-layer"]?P==="raster-dem"&&w!=="hillshade"?i.push(new a.V(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&P==="geojson"&&!A.lineMetrics?i.push(new a.V(d,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&P!=="raster-array"&&i.push(new a.V(d,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):i.push(new a.V(d,l.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new a.V(d,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new a.V(d,l.source,`source "${l.source}" not found`))}else i.push(new a.V(`${d}.source`,l.source,'"source" must be a string'));else i.push(new a.V(d,l,'missing required property "source"'));return i=i.concat(Fn({key:d,value:l,valueSpec:y.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gi({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:A=>Vn(Object.assign({layerType:w},A)),layout:A=>Fn({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>os(Object.assign({layerType:w},P))}}),paint:A=>Fn({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>$n(Object.assign({layerType:w,layer:l},P))}}),appearances(A){const P=fr({key:A.key,value:A.value,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:D=>function(j){const{key:V,layer:G,layerType:te}=j,K=a.J(j.value),oe=a.J(K.name),he=a.J(K.condition),ge=Fn({key:V,value:K,valueSpec:j.styleSpec.appearance,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{condition:Se=>function(be){const Ee=[];return Ee.push(...si({key:be.key,value:be.object.condition,valueSpec:a.a6.appearance.condition,expressionContext:"appearance"})),Ee}(Object.assign({layer:G,layerType:te},Se)),properties:Se=>function(be){const Ee=[],{styleSpec:Te,layer:we,layerType:Ae}=be,qe=Te[`paint_${Ae}`],Ne=Te[`layout_${Ae}`],rt=be.object[be.objectKey];for(const $e in rt){const Qe=$e in qe?"paint":$e in Ne?"layout":void 0;if(!Qe){Ee.push(new a.V(be.key,$e,`unknown property "${$e}" for layer type "${Ae}"`));continue}const kt=Object.assign({},be,{key:`${be.key}.${$e}`,object:rt,objectKey:$e,layer:we,layerType:Ae,value:rt[$e],valueSpec:Qe==="paint"?qe[$e]:Ne[$e]});Ee.push(...ks(kt,Qe))}return Ee}(Object.assign({layer:G,layerType:te},Se))}});return oe==="hidden"||he||ge.push(new a.V(j.key,"name",'Appearance with name different than "hidden" must have a condition')),ge}(Object.assign({layerType:w,layer:l},D))}),M=Array.isArray(A.value)?A.value:[],z=new Set;return M.forEach((D,j)=>{const V=a.J(D.name);if(V)if(z.has(V)){const G=a.J(l.id);P.push(new a.V(A.key,V,`Duplicated appearance name "${V}" for layer "${G}"`))}else z.add(V)}),P}}})),i}function mo({key:f,value:i}){return a.a0(i)?[]:[new a.V(f,i,`string expected, ${a.K(i)} found`)]}const Yo={promoteId:function f({key:i,value:l}){if(a.a0(l))return mo({key:i,value:l});if(Array.isArray(l)){const _=[],y=a.S(l),w=a.U(y);return w.result==="error"&&w.value.forEach(S=>{_.push(new a.V(`${i}${S.key}`,null,`${S.message}`))}),a.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new a.V(`${i}`,null,"promoteId expression should be only feature dependent")),_}if(!a.H(l))return[new a.V(i,l,`string, expression or object expected, "${a.K(l)}" found`)];const d=[];for(const _ in l)d.push(...f({key:`${i}.${_}`,value:l[_]}));return d}};function An(f){const i=f.value,l=f.key,d=f.styleSpec,_=f.style;if(!a.H(i))return[new a.V(l,i,`object expected, ${a.K(i)} found`)];if(!("type"in i))return[new a.V(l,i,'"type" is required')];const y=a.J(i.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in i||"tiles"in i||w.push(new a.a3(l,i,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(Fn({key:l,value:i,valueSpec:d[`source_${y.replace("-","_")}`],style:f.style,styleSpec:d,objectElementValidators:Yo})),w;case"geojson":if(w=Fn({key:l,value:i,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:Yo}),"cluster"in i&&"clusterProperties"in i){if(!a.H(i.clusterProperties))return[new a.V(`${l}.clusterProperties`,i,`object expected, ${a.K(i)} found`)];for(const S in i.clusterProperties){const A=i.clusterProperties[S];if(!Array.isArray(A))return[new a.V(`${l}.clusterProperties.${S}`,A,"array expected")];const[P,M]=A,z=typeof P=="string"?[P,["accumulated"],["get",S]]:P;w.push(...si({key:`${l}.${S}.map`,value:M,expressionContext:"cluster-map"})),w.push(...si({key:`${l}.${S}.reduce`,value:z,expressionContext:"cluster-reduce"}))}}return w;case"video":return Fn({key:l,value:i,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return Fn({key:l,value:i,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new a.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xn({key:`${l}.type`,value:i.type,valueSpec:{values:xs(d)}})}}function xs(f){return f.source.reduce((i,l)=>{const d=f[l];return d.type.type==="enum"&&(i=i.concat(Object.keys(d.type.values))),i},[])}function zo(f){const i=f.value,l=f.styleSpec,d=l.light,_=f.style;if(i===void 0)return[];if(!a.H(i))return[new a.V("light",i,`object expected, ${a.K(i)} found`)];let y=[];for(const w in i){const S=w.match(/^(.*)-transition$/),A=w.match(/^(.*)-use-theme$/);y=y.concat(A&&d[A[1]]?Gi({key:w,value:i[w],valueSpec:{type:"string"},style:_,styleSpec:l}):S&&d[S[1]]&&d[S[1]].transition?Gi({key:w,value:i[w],valueSpec:l.transition,style:_,styleSpec:l}):d[w]?Gi({key:w,value:i[w],valueSpec:d[w],style:_,styleSpec:l}):[new a.V(w,i[w],`unknown property "${w}"`)])}return y}function Jo(f){const i=f.value;if(!i)return[];const l=f.key;if(!a.H(i))return[new a.V(l,i,`object expected, ${a.K(i)} found`)];let d=[];const _=f.styleSpec,y=_["light-3d"],w=f.style,S=f.style.lights;for(const M of["type","id"])if(!(M in i))return d=d.concat([new a.V(l,i,`missing property "${M}"`)]),d;if(!a.a0(i.type))return d=d.concat([new a.V(`${l}.type`,i.type,"string expected")]),d;if(S)for(let M=0;M<f.arrayIndex;M++){const z=a.J(i.type),D=S[M];a.J(D.type)===z&&d.push(new a.V(l,i.id,`duplicate light type "${i.type}", previously defined at line ${D.id.__line__}`))}const A=`properties_light_${i.type}`;if(!(A in _))return d=d.concat([new a.V(`${l}.type`,i,`Invalid light type ${i.type}`)]),d;const P=_[A];for(const M in i)if(M==="properties"){const z=i[M];if(!a.H(z))return d=d.concat([new a.V("properties",z,`object expected, ${a.K(z)} found`)]),d;for(const D in z){const j=D.match(/^(.*)-transition$/),V=D.match(/^(.*)-use-theme$/);d=d.concat(V&&P[V[1]]?Gi({key:M,value:z[D],valueSpec:{type:"string"},style:w,styleSpec:_}):j&&P[j[1]]&&P[j[1]].transition?Gi({key:M,value:i[M],valueSpec:_.transition,style:w,styleSpec:_}):P[D]?Gi({key:D,value:z[D],valueSpec:P[D],style:w,styleSpec:_}):[new a.a3(f.key,z[D],`unknown property "${D}"`)])}}else d=d.concat(y[M]?Gi({key:M,value:i[M],valueSpec:y[M],style:w,styleSpec:_}):[new a.a3(M,i[M],`unknown property "${M}"`)]);return d}function go(f){const i=f.value,l=f.key,d=f.style,_=f.styleSpec,y=_.terrain;if(i==null)return[];if(!a.H(i))return[new a.V("terrain",i,`object expected, ${a.K(i)} found`)];let w=[];for(const S in i){const A=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);w=w.concat(P&&y[P[1]]?Gi({key:S,value:i[S],valueSpec:{type:"string"},style:d,styleSpec:_}):A&&y[A[1]]&&y[A[1]].transition?Gi({key:S,value:i[S],valueSpec:_.transition,style:d,styleSpec:_}):y[S]?Gi({key:S,value:i[S],valueSpec:y[S],style:d,styleSpec:_}):[new a.a3(S,i[S],`unknown property "${S}"`)])}if(i.source)if(a.a0(i.source)){const S=d.sources&&d.sources[i.source],A=S&&a.J(S.type);S?A!=="raster-dem"&&w.push(new a.V(`${l}.source`,i.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):w.push(new a.V(`${l}.source`,i.source,`source "${i.source}" not found`))}else w.push(new a.V(`${l}.source`,i.source,"source must be a string"));else w.push(new a.V(l,i,'terrain is missing required property "source"'));return w}function Qo(f){const i=f.value,l=f.style,d=f.styleSpec,_=d.fog;if(i===void 0)return[];if(!a.H(i))return[new a.V("fog",i,`object expected, ${a.K(i)} found`)];let y=[];for(const w in i){const S=w.match(/^(.*)-transition$/),A=w.match(/^(.*)-use-theme$/);y=y.concat(A&&_[A[1]]?Gi({key:w,value:i[w],valueSpec:{type:"string"},style:l,styleSpec:d}):S&&_[S[1]]&&_[S[1]].transition?Gi({key:w,value:i[w],valueSpec:d.transition,style:l,styleSpec:d}):_[w]?Gi({key:w,value:i[w],valueSpec:_[w],style:l,styleSpec:d}):[new a.a3(w,i[w],`unknown property "${w}"`)])}return y}const Wa={"*":()=>[],array:fr,boolean:function(f){const i=f.value,l=f.key;return a.$(i)?[]:[new a.V(l,i,`boolean expected, ${a.K(i)} found`)]},number:Ut,color:function({key:f,value:i}){return a.a0(i)?a.a1.parseCSSColor(i)===null?[new a.V(f,i,`color expected, "${i}" found`)]:[]:[new a.V(f,i,`color expected, ${a.K(i)} found`)]},enum:Xn,filter:Vn,function:ti,layer:$s,object:Fn,source:An,model:a.a7,light:zo,"light-3d":Jo,terrain:go,fog:Qo,string:mo,formatted:function(f){return mo(f).length===0?[]:si(f)},resolvedImage:function(f){return mo(f).length===0?[]:si(f)},projection:function(f){const i=f.value,l=f.styleSpec,d=l.projection,_=f.style;if(a.H(i)){let y=[];for(const w in i)y=y.concat(Gi({key:w,value:i[w],valueSpec:d[w],style:_,styleSpec:l}));return y}return a.a0(i)?[]:[new a.V("projection",i,`object or string expected, ${a.K(i)} found`)]},import:function(f){const i=f.key,{value:l,styleSpec:d}=f;if(!a.H(l))return[new a.V(i,l,"import must be an object")];const{data:_,...y}=l;Object.defineProperty(y,"__line__",{value:l.__line__,enumerable:!1});let w=Fn(Object.assign({},f,{value:y,valueSpec:d.import}));return a.J(y.id)===""&&w.push(new a.V(`${f.key}.id`,y,"import id can't be an empty string")),_&&(w=w.concat(qa(_,d,{key:`${f.key}.data`}))),w},iconset:function(f){const i=f.value,l=f.key,d=f.styleSpec,_=f.style;if(!a.H(i))return[new a.V(l,i,"object expected")];if(!i.type)return[new a.V(l,i,'"type" is required')];const y=a.J(i.type);let w=[];if(w=w.concat(Fn({key:l,value:i,valueSpec:d[`iconset_${y}`],style:_,styleSpec:d})),function(S,A){return!(S!=="source"||!A.source)}(y,i)){const S=_.sources&&_.sources[i.source],A=S&&a.J(S.type);S?A!=="raster-array"&&w.push(new a.V(l,i.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):w.push(new a.V(l,i.source,`source "${i.source}" not found`))}return w}};function Gi(f,i=!1){const l=f.value,d=f.valueSpec,_=f.styleSpec;if(d.expression){if(a.a4(a.J(l)))return ti(f);if(a.Q(a.S(l)))return si(f)}if(d.type&&Wa[d.type]){const y=Wa[d.type](f);return i===!0&&y.length>0&&Array.isArray(f.value)?si(f):y}return Fn(Object.assign({},f,{valueSpec:d.type?_[d.type]:d}))}function Fn(f){const i=f.key,l=f.value,d=f.valueSpec||{},_=f.objectElementValidators||{},y=f.style,w=f.styleSpec;if(!a.H(l))return[new a.V(i,l,`object expected, ${a.K(l)} found`)];let S=[];for(const A in l){const P=A.split(".")[0];let M;_[P]?M=_[P]:d[P]?M=Gi:_["*"]?M=_["*"]:d["*"]&&(M=Gi),M?S=S.concat(M({key:(i&&`${i}.`)+A,value:l[A],valueSpec:d[P]||d["*"],style:y,styleSpec:w,object:l,objectKey:A},l)):S.push(new a.a3(i,l[A],`unknown property "${A}"`))}for(const A in d)_[A]||d[A].required&&d[A].default===void 0&&l[A]===void 0&&S.push(new a.V(i,l,`missing required property "${A}"`));return S}function wl({key:f,value:i}){const l=mo({key:f,value:i});if(l.length)return l;const d=i;return d.indexOf("{fontstack}")===-1&&l.push(new a.V(f,i,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&l.push(new a.V(f,i,'"glyphs" url must include a "{range}" token')),l}function qa(f,i=a.a6,l={}){return Fn({key:l.key||"",value:f,valueSpec:Object.assign(i.$root,{"*":{type:"*"}}),styleSpec:i,style:f,objectElementValidators:{glyphs:wl}})}function _o(f,i=a.a6){return Pe(qa(f,i))}const Ea=f=>Pe(An(f)),oc=f=>Pe(zo(f)),tu=f=>Pe(Jo(f)),bt=f=>Pe(go(f)),ea=f=>Pe(Qo(f)),bh=f=>Pe(function(i){const l=i.value,d=i.style,_=i.styleSpec,y=_.snow;if(l===void 0)return[];if(!a.H(l))return[new a.V("snow",l,`object expected, ${a.K(l)} found`)];let w=[];for(const S in l){const A=S.match(/^(.*)-transition$/);w=w.concat(A&&y[A[1]]&&y[A[1]].transition?Gi({key:S,value:l[S],valueSpec:_.transition,style:d,styleSpec:_}):y[S]?Gi({key:S,value:l[S],valueSpec:y[S],style:d,styleSpec:_}):[new a.a3(S,l[S],`unknown property "${S}"`)])}return w}(f)),bl=f=>Pe(function(i){const l=i.value,d=i.style,_=i.styleSpec,y=_.rain;if(l===void 0)return[];if(!a.H(l))return[new a.V("rain",l,`object expected, ${a.K(l)} found`)];let w=[];for(const S in l){const A=S.match(/^(.*)-transition$/);w=w.concat(A&&y[A[1]]&&y[A[1]].transition?Gi({key:S,value:l[S],valueSpec:_.transition,style:d,styleSpec:_}):y[S]?Gi({key:S,value:l[S],valueSpec:y[S],style:d,styleSpec:_}):[new a.a3(S,l[S],`unknown property "${S}"`)])}return w}(f)),ze=f=>Pe($s(f)),Y=f=>Pe(Vn(f)),se=f=>Pe($n(f)),ve=f=>Pe(os(f)),Me=f=>Pe(a.a7(f));function Pe(f){return f.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function U(f,i){let l=!1;if(i&&i.length)for(const d of i)d instanceof a.a3?a.w(d.message):(f.fire(new a.y(new Error(d.message))),l=!0);return l}let ae;class Q extends a.E{constructor(i,l="flat"){super(),this._transitionable=new a.a8(ae||(ae=new a.a9({anchor:new a.aa(a.a6.light.anchor),position:new a.ab(a.a6.light.position),color:new a.aa(a.a6.light.color),intensity:new a.aa(a.a6.light.intensity)}))),this.setLight(i,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l,d={}){this._validate(oc,i,d)||(this._transitionable.setTransitionOrValue(i),this.id=l)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,d){return(!d||d.validate!==!1)&&U(this,i.call(_o,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let ne=class extends a.E{constructor(f,i,l,d,_){super(),this.scope=l,this._transitionable=new a.a8(new a.a9({source:new a.aa(a.a6.terrain.source),exaggeration:new a.aa(a.a6.terrain.exaggeration)}),l,d),this._transitionable.setTransitionOrValue(f,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i,this.worldview=_}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new a.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const i=f.value.expression;if(!i)return null;let l=-1,d=-1,_=1;for(const y of i.zoomStops)_=i.evaluate(new a.ac(y,{worldview:this.worldview})),_>.01?(l=y,d=-1):d=y;return _<.01&&l>0&&d>l?[l,d]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof a.ad}};const me=45,fe=65,Ve=.05;function nt(f,i,l,d){const _=a.ah(me,fe,l),[y,w]=Ye(f,d);let S=1-Math.min(1,Math.exp((i-y)/(w-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*_*f.alpha}function Ye(f,i){const l=.5/Math.tan(.5*i);return[f.range[0]+l,f.range[1]+l]}function st(f,i,l,d,_){const y=a.af([],[i,l,d],_.mercatorFogMatrix);return nt(f,a.ag(y),_.pitch,_._fov)}function it(f,i,l,d,_,y,w){const S=[[l,d,0],[_,d,0],[_,y,0],[l,y,0]];let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const M of S){const z=a.af([],M,i),D=a.ag(z);A=Math.min(A,D),P=Math.max(P,D)}return[nt(f,A,w.pitch,w._fov),nt(f,P,w.pitch,w._fov)]}class Mt extends a.E{constructor(i,l,d,_){super();const y=new a.a9({range:new a.aa(a.a6.fog.range),color:new a.aa(a.a6.fog.color),"color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.aa(a.a6.fog["high-color"]),"high-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.aa(a.a6.fog["space-color"]),"space-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.aa(a.a6.fog["horizon-blend"]),"star-intensity":new a.aa(a.a6.fog["star-intensity"]),"vertical-range":new a.aa(a.a6.fog["vertical-range"])});this._transitionable=new a.a8(y,d,new Map(_)),this.set(i,_),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new a.ai(y),this.scope=d}get state(){const i=this._transform,l=i.projection.name==="globe",d=a.aj(i.zoom),_=this.properties.get("range"),y=[.5,3];return{range:l?[a.ak(y[0],_[0],d),a.ak(y[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l,d={}){if(this._validate(ea,i,d))return;const _=Object.assign({},i);for(const y of Object.keys(a.a6.fog))_[y]===void 0&&(_[y]=a.a6.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ah(me,fe,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(d,_,y){const w=a.ae.fromLngLat(_),S=y.elevation?y.elevation.getAtPointOrZero(w):0;return st(d,w.x,w.y,S,y)}(this.state,i,l):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(i.toUnwrapped());return it(this.state,l,0,0,a.al,a.al,this._transform)}getOpacityForBounds(i,l,d,_,y){return this._transform.projection.supportsFog?it(this.state,i,l,d,_,y,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Ye(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const d of l){const _=i.points[d];let y;if(_[2]>=0)y=_;else{const w=i.points[d-4];y=a.am(w,_,w[2]/(w[2]-_[2]))}if(st(this.state,y[0],y[1],0,this._transform)>=Ve)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,d){return(!d||d.validate!==!1)&&U(this,i.call(_o,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let Zt,$t,Kt,mr,Vr=class extends a.E{constructor(f,i,l,d){super();const _=Zt||(Zt=new a.a9({density:new a.aa(a.a6.snow.density),intensity:new a.aa(a.a6.snow.intensity),color:new a.aa(a.a6.snow.color),opacity:new a.aa(a.a6.snow.opacity),vignette:new a.aa(a.a6.snow.vignette),"vignette-color":new a.aa(a.a6.snow["vignette-color"]),"center-thinning":new a.aa(a.a6.snow["center-thinning"]),direction:new a.aa(a.a6.snow.direction),"flake-size":new a.aa(a.a6.snow["flake-size"])}));this._transitionable=new a.a8(_,l,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(_),this.scope=l}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),l=this.properties.get("direction"),d=a.an(l[0]),_=-Math.max(a.an(l[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(i.r,i.g,i.b,i.a*f),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,i,l={}){if(this._validate(bh,f,l))return;const d=Object.assign({},f);for(const _ of Object.keys(a.a6.snow))d[_]===void 0&&(d[_]=a.a6.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,l){return(!l||l.validate!==!1)&&U(this,f.call(_o,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}},Xr=class extends a.E{constructor(f,i,l,d){super();const _=$t||($t=new a.a9({density:new a.aa(a.a6.rain.density),intensity:new a.aa(a.a6.rain.intensity),color:new a.aa(a.a6.rain.color),opacity:new a.aa(a.a6.rain.opacity),vignette:new a.aa(a.a6.rain.vignette),"vignette-color":new a.aa(a.a6.rain["vignette-color"]),"center-thinning":new a.aa(a.a6.rain["center-thinning"]),direction:new a.aa(a.a6.rain.direction),"droplet-size":new a.aa(a.a6.rain["droplet-size"]),"distortion-strength":new a.aa(a.a6.rain["distortion-strength"])}));this._transitionable=new a.a8(_,l,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(_),this.scope=l}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),l=this.properties.get("direction"),d=a.an(l[0]),_=-Math.max(a.an(l[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(i.r,i.g,i.b,i.a*f),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(f,i,l={}){if(this._validate(bl,f,l))return;const d=Object.assign({},f);for(const _ of Object.keys(a.a6.rain))d[_]===void 0&&(d[_]=a.a6.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,l){return(!l||l.validate!==!1)&&U(this,f.call(_o,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}};class zr extends a.E{constructor(i,l,d,_){super(),this.scope=d,this._options=i,this.properties=new a.ai(l),this._transitionable=new a.a8(l,d,new Map(_)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,l){this._options=i,this._transitionable.setTransitionOrValue(i.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class di{constructor(i,l,d){this.screenBounds=i,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(i,l){let d,_;if(i instanceof a.P||typeof i[0]=="number"){const y=a.P.convert(i);d=[y],_=l.isPointAboveHorizon(y)}else{const y=a.P.convert(i[0]),w=a.P.convert(i[1]),S=y.add(w)._div(2);d=[y,w],_=a.aq(y,w).every(A=>l.isPointAboveHorizon(A))&&l.isPointAboveHorizon(S)}return new di(d,_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return a.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.aq(l,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),a.ar(_,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.aq(l,d,i),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>d.y))+((y.x>l.x)+(y.x>d.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(i,l,d,_=0){const y=i.queryPadding/l._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let S=i.tileID.wrap+(w.unwrapped?_:0);const A=w.polygon.map(te=>a.as(i.tileTransform,te,S));if(!a.at(A,0,0,a.al,a.al))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const P=this.screenGeometryMercator.polygon.map(te=>a.au(i.tileTransform,te,S)),M=P.map(te=>new a.P(te[0],te[1])),z=l.getFreeCameraOptions().position||new a.ae(0,0,0),D=a.au(i.tileTransform,z,S),j=P.map(te=>{const K=a.av(te,te,D);return a.aw(K,K),new a.ax(D,K)}),V=a.ay(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(G=a.az(A),G.min.x=a.aA(G.min.x,0,a.al),G.min.y=a.aA(G.min.y,0,a.al),G.max.x=a.aA(G.max.x,0,a.al),G.max.y=a.aA(G.max.y,0,a.al),G),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:V};var G}_bufferedScreenMercator(i,l){const d=Sn(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(i,l){const d=Sn(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(i,l){const d=function(y,w){const S=a.aB([],w.pixelMatrix,w.globeMatrix),A=[0,-a.aD,0,1],P=[0,a.aD,0,1],M=[0,0,0,1];a.aC(A,A,S),a.aC(P,P,S),a.aC(M,M,S);const z=new a.P(A[0]/A[3],A[1]/A[3]),D=new a.P(P[0]/P[3],P[1]/P[3]),j=a.aE(y,z)&&A[3]<M[3],V=a.aE(y,D)&&P[3]<M[3];if(!j&&!V)return null;const G=function(Ee,Te,we){for(let Ae=1;Ae<Ee.length;Ae++){const qe=Ai(Te.pointCoordinate3D(Ee[Ae-1]).x),Ne=Ai(Te.pointCoordinate3D(Ee[Ae]).x);if(we<0){if(qe<Ne)return{idx:Ae,t:-qe/(Ne-1-qe)}}else if(Ne<qe)return{idx:Ae,t:(1-qe)/(Ne+1-qe)}}return null}(y,w,j?-1:1);if(!G)return null;const{idx:te,t:K}=G;let oe=te>1?ji(y.slice(0,te),w):[],he=te<y.length?ji(y.slice(te),w):[];oe=oe.map(Ee=>new a.P(Ai(Ee.x),Ee.y)),he=he.map(Ee=>new a.P(Ai(Ee.x),Ee.y));const ge=[...oe];ge.length===0&&ge.push(he[he.length-1]);const Se=a.ak(ge[ge.length-1].y,(he.length===0?oe[0]:he[0]).y,K);let be;return be=j?[new a.P(0,Se),new a.P(0,0),new a.P(1,0),new a.P(1,Se)]:[new a.P(1,Se),new a.P(1,1),new a.P(0,1),new a.P(0,Se)],ge.push(...be),he.length===0?ge.push(oe[0]):ge.push(...he),{polygon:ge.map(Ee=>new a.ae(Ee.x,Ee.y)),unwrapped:!1}}(i,l);if(d)return d;const _=function(y,w){let S=!1,A=-1/0,P=0;for(let z=0;z<y.length-1;z++)y[z].x>A&&(A=y[z].x,P=z);for(let z=0;z<y.length-1;z++){const D=(P+z)%(y.length-1),j=y[D],V=y[D+1];Math.abs(j.x-V.x)>.5&&(j.x<V.x?(j.x+=1,D===0&&(y[y.length-1].x+=1)):(V.x+=1,D+1===y.length-1&&(y[0].x+=1)),S=!0)}const M=a.aF(w.center.lng);return S&&M<Math.abs(M-1)&&y.forEach(z=>{z.x-=1}),{polygon:y,unwrapped:S}}(ji(i,l).map(y=>new a.P(Ai(y.x),y.y)),l);return{polygon:_.polygon.map(y=>new a.ae(y.x,y.y)),unwrapped:_.unwrapped}}}function ji(f,i){return a.aG(f,l=>{const d=i.pointCoordinate3D(l);l.x=d.x,l.y=d.y},1/256)}function Ai(f){return f<0?1+f%1:f%1}function Sn(f){return 100*f|0}function In(f,i,l,d,_){const y=function(S,A){if(S)return _(S);if(A){if(f.url&&A.tiles&&f.tiles&&delete f.tiles,A.variants){if(!Array.isArray(A.variants))return _(new Error("variants must be an array"));for(const M of A.variants){if(M==null||typeof M!="object"||M.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(M.capabilities))return _(new Error("capabilities must be an array"));if(M.capabilities.length===1&&M.capabilities[0]==="meshopt"){A=Object.assign(A,M);break}}}const P=a.aH(Object.assign({},A,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=i.canonicalizeTileset(P,f.url),_(null,P)}},w=function(S,A,P){if(!S)return null;if(!A&&!P)return S;P=P||S.worldview_default;const M=Object.values(S.language||{});if(M.length===0)return null;const z=Object.values(S.worldview||{});if(z.length===0)return null;const D=M.every(V=>V===A),j=z.every(V=>V===P);return D&&j?S:A in(S.language_options||{})||P in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(f.data,l,d);return w?a.o.frame(()=>y(null,w)):f.url?a.m(i.transformRequest(i.normalizeSourceURL(f.url,null,l,d),a.R.Source),y):a.o.frame(()=>{const{data:S,...A}=f;y(null,A)})}function vs(f,i){const l=Math.pow(2,i.z),d=Math.floor(a.aF(f.getWest())*l),_=Math.floor(a.aJ(f.getNorth())*l),y=Math.ceil(a.aF(f.getEast())*l),w=Math.ceil(a.aJ(f.getSouth())*l);return i.x>=d&&i.x<y&&i.y>=_&&i.y<w}class as{constructor(i,l,d){this.bounds=i?a.aI.convert(this.validateBounds(i)):null,this.minzoom=l||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}addExtraBounds(i){if(i){this.extraBounds||(this.extraBounds=[]);for(const l of i)this.extraBounds.push(a.aI.convert(this.validateBounds(l)))}}contains(i){if(i.z>this.maxzoom||i.z<this.minzoom||this.bounds&&!vs(this.bounds,i))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(vs(l,i))return!0;return!1}static fromTileJSON(i){if(!i.bounds&&!i.extra_bounds)return null;const l=new as(i.bounds,i.minzoom,i.maxzoom);return l.addExtraBounds(i.extra_bounds),l}}class ws extends a.E{constructor(i,l,d,_){if(super(),this.id=i,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,a.aH(l,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.aK}load(i){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=In(this._options,this.map._requestManager,l,d,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.y(_));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of y.vector_layers)this.vectorLayerIds.push(w.id),y.worldview&&y.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=as.fromTileJSON(y),Ue(y.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(_)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(i,l){const d=i.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(_,a.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S=w?{image:w.image.clone()}:null,A={request:y,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&a.h(d)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",A,P.bind(this));else if(i.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",A,P.bind(this),void 0,!0);else{const M=a.aL.call({deduped:this._deduped},A,(z,D)=>{z||!D?P.call(this,z):(A.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},i.actor&&i.actor.send("loadTile",A,P.bind(this),void 0,!0))},!0);i.request={cancel:M}}function P(M,z){return delete i.request,i.aborted?l(null):M&&M.status!==404?l(M):(z&&z.resourceTiming&&(i.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&i.setExpiryData(z),i.loadVectorData(z,this.map.painter),a.aM(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,l){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ru extends a.E{constructor(i,l,d,_){super(),this.id=i,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},l),Object.assign(this,a.aH(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=In(this._options,this.map._requestManager,null,l,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.y(d)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=as.fromTileJSON(_),Ue(_.tiles),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(d)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const d=a.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=a.n(this.map._requestManager.transformRequest(_,a.R.Tile),(y,w,S,A)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):y?(i.state="errored",l(y)):w?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:A}),i.setTexture(w,this.map.painter),i.state="loaded",a.aM(this.dispatcher),void l(null)):l(null)))}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l&&l()}unloadTile(i,l){i.texture&&i.texture instanceof a.T?(i.destroy(!0),i.texture&&i.texture instanceof a.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function B_([f,i],l,d,{scaled:_=!0}={}){const{tileSize:y,buffer:w}=d,{x:S,y:A,z:P}=l;if(!isFinite(S)||!isFinite(A)||!isFinite(P))throw new Error("Invalid MRT header");const M=2**P,z=M*a.aF(f),D=M*a.aJ(i);return function([j,V],G,{scaled:te=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:K,tileSize:oe,buffer:he,offset:ge,scale:Se,dimension:be}=G;if(j<-he||j>oe+he||V<-he||V>oe+he)throw new Error(`Point (${j}, ${V}) out of bounds for tileSize=${oe}, buffer=${he}`);const Ee=(V+he)*(oe+2*he)+(j+he);if(new Uint32Array(K.buffer)[Ee]===4294967295)return null;let Te=[];Te=te?[]:new G.data.constructor(be);for(let we=0;we<be;we++)Te[we]=Math.round(1e12*(K[be*Ee+we]*Se+ge))/1e12;return Te}([Math.min(Math.max(-w,Math.floor((z-S)*y)),y-1+w),Math.min(Math.max(-w,Math.floor((D-A)*y)),y-1+w)],d,{scaled:_})}class Tl extends ru{constructor(i,l,d,_){super(i,l,d,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},l)}triggerRepaint(i){const l=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);l&&l.enabled&&d&&l._clearRenderCacheForTile(d.id,i.tileID),this.map.triggerRepaint()}loadTile(i,l){const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,a.R.Tile),y={request:_,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};i.source=this.id,i.scope=this.scope,i.requestParams=_,i.actor||(i.actor=this.dispatcher.getActor());const w=(S,A,P,M)=>{if(delete i.request,i.aborted)return i.state="unloaded",l(null);if(S)return S.name==="AbortError"?void 0:(i.state="errored",l(S));if(this.map._refreshExpiredTiles&&A&&i.setExpiryData({cacheControl:P,expires:M}),this.partial&&i.state!=="expired")i.state="empty";else if(!this.partial){if(!A)return l(null);i.state="loaded",i._isHeaderLoaded=!0,i._mrt=A}l(null)};i.request=this.partial?i.fetchHeader(void 0,w.bind(this)):i.actor.send("loadTile",y,w.bind(this),void 0,!0)}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,l){const d=i.texturePerLayer;if(i.flushAllQueues(),d.size){i.destroy(!0);for(const _ of d.values())this.map.painter.saveTileTexture(_)}else i.destroy()}prepareTile(i,l,d,_){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBandForRender(l,d,_,(y,w)=>{if(y)return i.state="errored",this.fire(new a.y(y)),void this.triggerRepaint(i);w&&(i._isHeaderLoaded=!0,i.setTexturePerLayer(d,w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:y})=>y===i),d=l&&l.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(i,l,d){if(!i)return;const _=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;l instanceof a.aP?y=l.paint.get("raster-array-band"):l instanceof a.aQ&&(y=l.paint.get("raster-particle-array-band"));const w=y||this.getInitialBand(_);if(w==null)return;if(!i.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(i,_,l.id,w);if(i.updateNeeded(l.id,w)&&!d)return;const S=i.textureDescriptorPerLayer.get(l.id);return Object.assign({},S,{texture:i.texturePerLayer.get(l.id)})}getImages(i,l){const d=new Map;for(const _ of i)for(const y of l){const[w,S]=y.split("/"),A=_.getLayer(w);if(!A||!A.hasBand(S)||!A.hasDataForBand(S))continue;const{bytes:P,tileSize:M,buffer:z}=A.getBandView(S),D=M+2*z,j={data:new a.q({width:D,height:D},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(y,j)}return d}queryRasterArrayValueByBandId(i,l,d){const _=l._mrt;return new Promise(y=>{const w={},S=new Set;for(const[A,P]of Object.entries(_.layers)){if(d.layerName&&A!==d.layerName)continue;const M={};w[A]=M;for(const{bands:z}of P.dataIndex)for(const D of z)d.bands&&!d.bands.includes(D)||(S.add(a.B(A,D)),l.fetchBand(A,null,D,j=>{a.o.frame(()=>{M[D]=j?null:B_([i.lng,i.lat],_,P.getBandView(D)),S.delete(a.B(A,D)),S.size===0&&y(w)})},!1))}S.size===0&&y(w)})}_loadTileForQuery(i,l){if(this._loadTileLoaded[i.uid])return void l(null,i._mrt);if(this._loadTilePending[i.uid])return void this._loadTilePending[i.uid].push(l);this._loadTilePending[i.uid]=[l];const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,a.R.Tile);i.actor.send("loadTile",{request:_,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,w,S,A)=>y?(this._loadTilePending[i.uid].forEach(P=>P(y,null)),void delete this._loadTilePending[i.uid]):w?(this.map._refreshExpiredTiles&&w&&i.setExpiryData({cacheControl:S,expires:A}),i._mrt=w,i._isHeaderLoaded=!0,i.state="loaded",this._loadTilePending[i.uid].forEach(P=>P(null,w)),this._loadTileLoaded[i.uid]=!0,void delete this._loadTilePending[i.uid]):(this._loadTilePending[i.uid].forEach(P=>P(null,null)),void delete this._loadTilePending[i.uid]),void 0,!0)}queryRasterArrayValueByAllBands(i,l,d){return new Promise((_,y)=>{this._loadTileForQuery(l,(w,S)=>{w?y(w):_(S?this.queryRasterArrayValueByBandId(i,l,d):null)})})}queryRasterArrayValue(i,l){const d=a.aR.convert(i),_=this.findLoadedParent(d);return _&&_._mrt?l.bands||!this.partial?this.queryRasterArrayValueByBandId(d,_,l):this.queryRasterArrayValueByAllBands(d,_,l):Promise.resolve(null)}findLoadedParent(i){const l=a.ae.fromLngLat(i,this.map.transform.tileSize),d=this.maxzoom+1,_=1<<d,y=Math.floor(l.x),w=Math.floor((l.x-y)*_),S=Math.floor(l.y*_),A=this.map.style.getSourceCache(this.id),P=new a.aO(d,y,d,w,S);return A.findLoadedParent(P,this.minzoom)}}const iu={vector:ws,raster:ru,"raster-dem":class extends ru{constructor(f,i,l,d){super(f,i,l,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,y){_&&(f.state="errored",i(_)),y&&(f.dem=y,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=a.n(this.map._requestManager.transformRequest(l,a.R.Tile),(function(_,y,w,S){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(_)f.state="errored",i(_);else if(y){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:w,expires:S});const A=ImageBitmap&&y instanceof ImageBitmap&&a.r(),P=1-(y.width-a.aN(y.width))/2;P<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const M=A?y:a.o.getImageData(y,P),z={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:M,encoding:this.encoding,padding:P};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",z,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,l=Math.pow(2,i.z),d=(i.x-1+l)%l,_=i.x===0?f.wrap-1:f.wrap,y=(i.x+1+l)%l,w=i.x+1===l?f.wrap+1:f.wrap,S={};return S[new a.aO(f.overscaledZ,_,i.z,d,i.y).key]={backfilled:!1},S[new a.aO(f.overscaledZ,w,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(S[new a.aO(f.overscaledZ,_,i.z,d,i.y-1).key]={backfilled:!1},S[new a.aO(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new a.aO(f.overscaledZ,w,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<l&&(S[new a.aO(f.overscaledZ,_,i.z,d,i.y+1).key]={backfilled:!1},S[new a.aO(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new a.aO(f.overscaledZ,w,i.z,y,i.y+1).key]={backfilled:!1}),S}},"raster-array":Tl,geojson:class extends a.E{constructor(f,i,l,d){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(d),this._data=i.data,this._options=Object.assign({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const _=a.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*_,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*_,extent:a.al,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:a.al,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*_,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new a.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new a.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const l of this._data.features)i.set(l.id,l);for(const l of f.features)i.set(l.id,l);this._data.features=[...i.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,l,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:l},d),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=Object.assign({append:f},this.workerOptions);i.scope=this.scope;const l=this._data;typeof l=="string"?(i.request=this.map._requestManager.transformRequest(a.o.resolveURL(l),a.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new a.y(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new a.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=a.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,i){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,y=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};f.request=this.actor.send(l,w,(S,A)=>y&&!A?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):S?i(S):(f.loadVectorData(A,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aS{constructor(f,i,l,d){super(f,i,l,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,a.R.Source).url);a.aT(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new a.y(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new a.y(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(f,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aS,model:class extends a.E{constructor(f,i,l,d){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const l=this._options.models[i],d=a.aV(this.map._requestManager.transformRequest(l.uri,a.R.Model).url).then(_=>{if(!_)return;const y=a.aW(_),w=new a.aX(i,l.position,l.orientation,y);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new a.y(new Error(`Could not load model ${i} from ${l.uri}: ${_.message}`)))});f.push(d)}Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new a.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return this._options}},"batched-model":class extends a.E{constructor(f,i,l,d){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=In(this._options,this.map._requestManager,i,l,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new a.y(d))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new as(_.bounds,this.minzoom,this.maxzoom)),Ue(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(d)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(l,a.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const y=Object.values(f.buckets);for(const w of y)w.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",d,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(y,w){return f.aborted?i(null):y&&y.status!==404?i(y):(this.map._refreshExpiredTiles&&w&&f.setExpiryData(w),f.loadModelData(w,this.map.painter),f.state="loaded",void i(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends a.aS{constructor(f,i,l,d){super(f,i,l,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new a.y(new a.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.y(new a.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new a.y(new a.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new a.y(new a.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.y(new a.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof a.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends a.E{constructor(f,i,l,d){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new as(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,a.aH(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:l,z:d}=f.canonical;return this._implementation.hasTile({x:i,y:l,z:d})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:l,y:d,z:_}=f.tileID.canonical,y=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:d,z:_},{signal:y.signal})).then((function(w){return delete f.request,f.aborted?(f.state="unloaded",i(null)):w===void 0?(f.state="errored",i(null)):w===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(w)?(this.loadTileData(f,w),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(f.state="errored",i(w))}),f.request.cancel=()=>y.abort()}loadTileData(f,i){f.setTexture(i,this.map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof a.T?(f.destroy(!0),f.texture&&f.texture instanceof a.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:l,y:d,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:d,z:_})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=a.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}}},Th=function(f,i,l,d){const _=new iu[i.type](f,i,l,d);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return a.aY(["load","abort","unload","serialize","prepare"],_),_};function Sh(f,i,l=""){return`${l}:${i.id||""}:${i.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:_,importId:y}=d;return`featureset:${_}${y?`:import:${y}`:""}`}}(f.target)}`}function Sl(f,i,l,d=""){if(f.uniqueFeatureID){const _=Sh(f,i,d);if(l.has(_))return!0;l.add(_)}return!1}function Eh(f,i,l,d,_=!1){const y=i.sourceCache.transform,w=i.sourceCache.tilesIn(f,i.has3DLayers,_);w.sort(Sm);const S=[];for(const A of w){const P=A.tile.queryRenderedFeatures(i,A,l,d,y,_);Object.keys(P).length&&S.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:P})}return S.length===0?{}:function(A){const P={},M={};for(const z of A){const D=z.queryResults,j=z.wrappedTileID,V=M[j]=M[j]||{};for(const G in D){const te=D[G],K=V[G]=V[G]||{},oe=P[G]=P[G]||[];for(const he of te)K[he.featureIndex]||(K[he.featureIndex]=!0,oe.push(he))}}return P}(S)}function Tm(f,i,l,d,_,y){const w={},S=d.queryRenderedSymbols(f),A=[];for(const P of Object.keys(S).map(Number))A.push(_[P]);A.sort(Sm);for(const P of A){const M=P.featureIndex.lookupSymbolFeatures(S[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,i,l,y);for(const z in M){const D=w[z]=w[z]||[],j=M[z];j.sort((V,G)=>{const te=P.featureSortOrder;if(te){const K=te.indexOf(V.featureIndex);return te.indexOf(G.featureIndex)-K}return G.featureIndex-V.featureIndex});for(const V of j)D.push(V)}}return w}function Aa(f,i){const l=f.getRenderableIds().map(y=>f.getTileByID(y)),d=[],_={};for(let y=0;y<l.length;y++){const w=l[y],S=w.tileID.canonical.key;_[S]||(_[S]=!0,w.querySourceFeatures(d,i))}return d}function Sm(f,i){const l=f.tileID,d=i.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function qd(f,i){const l={};if(!i)return l;for(const d of f){const _=d.layerIds.map(y=>i.getLayer(y)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>_.filter(w=>w.id===y)[0]));for(const y of _)l[y.fqid]=d}}return l}const yo=32,ta=33,Za=new Uint16Array(8184);for(let f=0;f<2046;f++){let i=f+2,l=0,d=0,_=0,y=0,w=0,S=0;for(1&i?_=y=w=yo:l=d=S=yo;(i>>=1)>1;){const P=l+_>>1,M=d+y>>1;1&i?(_=l,y=d,l=w,d=S):(l=_,d=y,_=w,y=S),w=P,S=M}const A=4*f;Za[A+0]=l,Za[A+1]=d,Za[A+2]=_,Za[A+3]=y}const ra=new Uint16Array(2178),Rs=new Uint8Array(1089),ac=new Uint16Array(1089);function Em(f){return f===0?-.03125:f===32?.03125:0}const Ah={type:2,extent:a.al,loadGeometry:()=>[[new a.P(0,0),new a.P(a.al+1,0),new a.P(a.al+1,a.al+1),new a.P(0,a.al+1),new a.P(0,0)]]};class El{constructor(i,l,d,_,y,w){this.tileID=i,this.uid=a.b2(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=w}registerFadeDuration(i){const l=i+this.timeAdded;l<a.o.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,d){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=qd(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof a.b4){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof a.b4&&y.hasRTLText){this.hasRTLText=!0,a.b5();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],w=l.style.getOwnLayer(_);if(!w)continue;const S=w.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new a.b3}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,l,d){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,qd(i.buckets,l.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(i)}const l=i.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new a.T(i,d.image,l.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(i,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(i,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(i,l,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,d),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=l.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(i,l,d,_,y,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=function(A,P){const M=a.bq([],[.5*A.width,.5*-A.height,1]);return a.br(M,M,[1,-1,0]),a.aB(M,M,A.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(M)}(y,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:l,pixelPosMatrix:S,transform:_,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(i,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),y=l?l.sourceLayer:"",w=_._geojsonTileLayer||_[y];if(!w)return;const S=a.b6(l&&l.filter),{z:A,x:P,y:M}=this.tileID.canonical,z={z:A,x:P,y:M};for(let D=0;D<w.length;D++){const j=w.feature(D);if(S.needGeometry){const te=a.b7(j,!0);if(!S.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),te,this.tileID.canonical))continue}else if(!S.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),j))continue;const V=d.getId(j,y),G=new a.b8(j,A,P,M,V);G.tile=z,i.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const d=a.b9(i.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{const y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,l){if(!this.latestFeatureIndex||!i.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=i.style.listImages(),y=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const S=this.buckets[w],A=S.layers[0],P=A.sourceLayer||"_geojsonTileLayer",M=d[P],z=i.style.getLayerSourceCache(A);let D={};z&&(D=z._state.getState(P,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},V=Object.keys(D).length>0&&!l;(V&&S.stateDependentLayers.length!==0||l)&&S.update(D,M,_,j,V?S.stateDependentLayers:S.layers,l,y),(S instanceof a.ba||S instanceof a.bb)&&i._terrain&&i._terrain.enabled&&z&&S.uploadPending()&&i._terrain._clearRenderCacheForTile(z.id,this.tileID);const G=i&&i.style&&i.style.getOwnLayer(w);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=a.o.now()+i}setTexture(i,l){const d=l.context,_=d.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof a.T?this.texture.update(i):(this.texture=new a.T(d,i,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(i,l){const d={};for(const _ of l)d[_]=!0;this.dependencies[i]=d}hasDependency(i,l){for(const d of i){const _=this.dependencies[d];if(_){for(const y of l)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const d=a.bc(Ah,this.tileID.canonical,this.tileTransform)[0],_=new a.bd,y=new a.be;for(let w=0;w<d.length;w++){const{x:S,y:A}=d[w];_.emplaceBack(S,A),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(y),this._tileDebugBuffer=i.createVertexBuffer(_,a.bf.members),this._tileDebugSegments=a.bg.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const d=a.bc(Ah,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const w=function(S,A){const P=a.aZ(S,A),M=Math.pow(2,S.z);for(let te=0;te<ta;te++)for(let K=0;K<ta;K++){const oe=a.a_((S.x+(K+Em(K))/yo)/M),he=a.a$((S.y+(te+Em(te))/yo)/M),ge=A.project(oe,he),Se=te*ta+K;ra[2*Se+0]=Math.round((ge.x*P.scale-P.x)*a.al),ra[2*Se+1]=Math.round((ge.y*P.scale-P.y)*a.al)}Rs.fill(0),ac.fill(0);for(let te=2045;te>=0;te--){const K=4*te,oe=Za[K+0],he=Za[K+1],ge=Za[K+2],Se=Za[K+3],be=oe+ge>>1,Ee=he+Se>>1,Te=be+Ee-he,we=Ee+oe-be,Ae=he*ta+oe,qe=Se*ta+ge,Ne=Ee*ta+be,rt=Math.hypot((ra[2*Ae+0]+ra[2*qe+0])/2-ra[2*Ne+0],(ra[2*Ae+1]+ra[2*qe+1])/2-ra[2*Ne+1])>=16;Rs[Ne]=Rs[Ne]||(rt?1:0),te<1022&&(Rs[Ne]=Rs[Ne]||Rs[(he+we>>1)*ta+(oe+Te>>1)]||Rs[(Se+we>>1)*ta+(ge+Te>>1)])}const z=new a.b0,D=new a.b1;let j=0;function V(te,K){const oe=K*ta+te;return ac[oe]===0&&(z.emplaceBack(ra[2*oe+0],ra[2*oe+1],te*a.al/yo,K*a.al/yo),ac[oe]=++j),ac[oe]-1}function G(te,K,oe,he,ge,Se){const be=te+oe>>1,Ee=K+he>>1;if(Math.abs(te-ge)+Math.abs(K-Se)>1&&Rs[Ee*ta+be])G(ge,Se,te,K,be,Ee),G(oe,he,ge,Se,be,Ee);else{const Te=V(te,K),we=V(oe,he),Ae=V(ge,Se);D.emplaceBack(Te,we,Ae)}}return G(0,0,yo,yo,yo,0),G(yo,yo,0,0,0,yo),{vertices:z,indices:D}}(this.tileID.canonical,l);_=w.vertices,y=w.indices}else{_=new a.b0,y=new a.b1;for(const{x:S,y:A}of d)_.emplaceBack(S,A,0,0);const w=a.bh(_.int16.subarray(0,4*_.length),void 0,4);for(let S=0;S<w.length;S+=3)y.emplaceBack(w[S],w[S+1],w[S+2])}this._tileBoundsBuffer=i.createVertexBuffer(_,a.bi.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(y),this._tileBoundsSegments=a.bg.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(i,l){const d=l.projection;if(!d||d.name!=="globe"||l.freezeTileCoverage)return;const _=this.tileID.canonical,y=a.bj(_,l),w=a.bk(y),S=a.aj(l.zoom);let A;S>0&&(A=a.bl(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,_,l,w,A,S),this._makeGlobeTileDebugTextBuffer(i,_,l,w,A,S)}_globePoint(i,l,d,_,y,w,S){let A=a.bm(i,l,d);if(w){const P=1<<d.z,M=a.aF(_.center.lng),z=a.aJ(_.center.lat),D=(d.x+.5)/P-M;let j=0;D>.5?j=-1:D<-.5&&(j=1);let V=(i/a.al+d.x)/P+j,G=(l/a.al+d.y)/P;V=(V-M)*_._pixelsPerMercatorPixel+M,G=(G-z)*_._pixelsPerMercatorPixel+z;const te=[V*_.worldSize,G*_.worldSize,0];a.af(te,te,w),A=a.bn(A,te,S)}return a.af(A,A,y)}_makeGlobeTileDebugBorderBuffer(i,l,d,_,y,w){const S=new a.bd,A=new a.be,P=new a.bo,M=(D,j,V,G,te)=>{const K=(V-D)/(te-1),oe=(G-j)/(te-1),he=S.length;for(let ge=0;ge<te;ge++){const Se=D+ge*K,be=j+ge*oe;S.emplaceBack(Se,be);const Ee=this._globePoint(Se,be,l,d,_,y,w);P.emplaceBack(Ee[0],Ee[1],Ee[2]),A.emplaceBack(he+ge)}},z=a.al;M(0,0,z,0,16),M(z,0,z,z,16),M(z,z,0,z,16),M(0,z,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(A),this._tileDebugBuffer=i.createVertexBuffer(S,a.bf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(P,a.bp.members),this._tileDebugSegments=a.bg.simpleSegment(0,0,S.length,A.length)}_makeGlobeTileDebugTextBuffer(i,l,d,_,y,w){const S=a.al/4,A=new a.bd,P=new a.b1,M=new a.bo,z=25;P.reserve(32),A.reserve(z),M.reserve(z);const D=(j,V)=>z*j+V;for(let j=0;j<z;j++){const V=j*S;for(let G=0;G<z;G++){const te=G*S;A.emplaceBack(te,V);const K=this._globePoint(te,V,l,d,_,y,w);M.emplaceBack(K[0],K[1],K[2])}}for(let j=0;j<4;j++)for(let V=0;V<4;V++){const G=D(j,V),te=D(j,V+1),K=D(j+1,V),oe=D(j+1,V+1);P.emplaceBack(G,te,K),P.emplaceBack(K,te,oe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(P),this._tileDebugTextBuffer=i.createVertexBuffer(A,a.bf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(M,a.bp.members),this._tileDebugTextSegments=a.bg.simpleSegment(0,0,z,32)}destroy(i=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bs.setPbf(a.bt);class Ih extends El{constructor(i,l,d,_,y){super(i,l,d,_,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(i){return this._mrt&&this._mrt.getLayer(i)}setTexturePerLayer(i,l,d){const _=d.context,y=_.gl;let w=this.texturePerLayer.get(i)||d.getTileTexture(l.width);w&&w instanceof a.T?w.update(l,{premultiply:!1}):w=new a.T(_,l,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(i)||this.texturePerLayer.set(i,w)}flushQueues(i){const l=this._workQueuePerLayer.get(i)||[],d=this._fetchQueuePerLayer.get(i)||[];for(;l.length;)l.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const i of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(i)||[];for(;l.length;)l.pop()()}for(const i of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(i)||[];for(;l.length;)l.pop()()}}fetchHeader(i=16384,l){const d=this._mrt=new a.bs(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=a.bu(_,(y,w,S,A)=>{if(y)l(y);else try{const P=d.getHeaderLength(w);if(P>i)return void(this.request=this.fetchHeader(P,l));d.parseHeader(w),this._isHeaderLoaded=!0;let M=0;for(const z of Object.values(d.layers))M=Math.max(M,z.dataIndex[z.dataIndex.length-1].lastByte);w.byteLength>=M&&(this.entireBuffer=w),l(null,this.entireBuffer||w,S,A)}catch(P){l(P)}}),this.request}fetchBandForRender(i,l,d,_){this.fetchBand(i,l,d,y=>{if(y)return void _(y);this.updateTextureDescriptor(i,l,d);const w=this.textureDescriptorPerLayer.get(l);_(null,w?w.img:null)})}fetchBand(i,l,d,_,y=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void _(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void _(new Error("Can't fetch tile band without an actor"));let A;const P=a.B(String(d),a.B(this.tileID.key,i));let M=this._taskQueue.get(P);M?M.add(_):(M=new Set,M.add(_),this._taskQueue.set(P,M));const z=(G,te)=>{A.complete(G,te),G?_(G):(M.values().forEach(K=>K(null,te)),this._taskQueue.delete(P))},D=(G,te)=>{if(G)return _(G);const K=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:A},z,void 0,!0);if(l!==null){const oe=this._workQueuePerLayer.get(l)||[];oe.push(()=>{K&&K.cancel(),A.cancel()}),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,oe)}};let j;try{j=w.getLayer(i)}catch(G){if(this.state==="reloading")return;throw G}if(!j)return void _(new Error(`Unknown sourceLayer "${i}"`));if(j.hasDataForBand(d))return M.values().forEach(G=>G(null,null)),void this._taskQueue.delete(P);const V=j.getDataRange([d]);if(A=w.createDecodingTask(V),!A||A.tasks.length)if(l!==null&&this.flushQueues(l),this.entireBuffer)D(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),te=a.bu(G,D);if(l!==null){const K=this._fetchQueuePerLayer.get(l)||[];K.push(()=>{te.cancel(),A.cancel()}),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,K)}}}updateNeeded(i,l){return(!this.textureDescriptorPerLayer.get(i)||this.textureDescriptorPerLayer.get(i).band!==l||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(i,l,d){if(!this._mrt)return;const _=this._mrt.getLayer(i);if(!_||!_.hasBand(d)||!_.hasDataForBand(d))return;const{bytes:y,tileSize:w,buffer:S,offset:A,scale:P}=_.getBandView(d),M=w+2*S,z=new a.q({width:M,height:M},y),D=this.texturePerLayer.get(l);D&&D instanceof a.T&&D.update(z,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:i,band:d,img:z,buffer:S,offset:A,tileSize:w,format:_.pixelFormat,mix:[P,256*P,65536*P,16777216*P]})}destroy(i=!1){if(super.destroy(i),delete this._mrt,!i)for(const l of this.texturePerLayer.values())l&&l instanceof a.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Ch{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,d){const _=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:l,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},d)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const d=i.wrapped().key,_=l===void 0?0:this.data[d].indexOf(l),y=this.data[d][_];return this.data[d].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const d in this.data)for(const _ of this.data[d])i(_.value)||l.push(_);for(const d of l)this.remove(d.value.tileID,d)}}class nu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,d){const _=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][_]=this.stateChanges[i][_]||{},Object.assign(this.stateChanges[i][_],d),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==_&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][_]===null){this.deletedStates[i][_]={};for(const y in this.state[i][_])d[y]||(this.deletedStates[i][_][y]=null)}else for(const y in d)this.deletedStates[i]&&this.deletedStates[i][_]&&this.deletedStates[i][_][y]===null&&delete this.deletedStates[i][_][y]}removeFeatureState(i,l,d){if(this.deletedStates[i]===null)return;const _=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},d&&l!==void 0)this.deletedStates[i][_]!==null&&(this.deletedStates[i][_]=this.deletedStates[i][_]||{},this.deletedStates[i][_][d]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][_])for(d in this.deletedStates[i][_]={},this.stateChanges[i][_])this.deletedStates[i][_][d]=null;else this.deletedStates[i][_]=null;else this.deletedStates[i]=null}getState(i,l){const d=this.state[i]||{},_=this.stateChanges[i]||{},y=this.deletedStates[i];if(y===null)return{};if(l!==void 0){const S=String(l),A=Object.assign({},d[S],_[S]);if(y){const P=y[l];if(P===null)return{};for(const M in P)delete A[M]}return A}const w=Object.assign({},d,_);if(y)for(const S in y)delete w[S];return w}initializeTileState(i,l){i.refreshFeatureState(l)}coalesceChanges(i,l){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),Object.assign(this.state[_][w],this.stateChanges[_][w]),y[w]=this.state[_][w];d[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const w in this.state[_])y[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const S of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][S];y[w]=this.state[_][w]}d[_]=d[_]||{},Object.assign(d[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in i)i[_].refreshFeatureState(l)}}class xo extends a.E{constructor(i,l,d){super(),this.id=i,this._onlySymbols=d,l.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Ch(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new nu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles)if(!this._tiles[i].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(i),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Am).map(i=>i.key)}getRenderableIds(i,l){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,i,l)&&d.push(this._tiles[_]);return i?d.sort((_,y)=>{const w=_.tileID,S=y.tileID,A=new a.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),P=new a.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||P.y-A.y||P.x-A.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(Am).map(_=>_.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l,d){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())&&(d||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const d=this._tiles[i];d&&(d.state!=="loading"&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,i,l)))}_tileLoaded(i,l,d,_){if(_)if(i.state="errored",_.status!==404)this._source.fire(new a.y(_,{tile:i}));else{if(this._source.fire(new a.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=a.o.now(),d==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new a.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let _=0;_<l.length;_++){const y=l[_];if(i.neighboringTiles&&i.neighboringTiles[y]){const w=this.getTileByID(y);d(i,w),d(w,i)}}function d(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-_.tileID.canonical.x;const S=y.tileID.canonical.y-_.tileID.canonical.y,A=Math.pow(2,_.tileID.canonical.z),P=y.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+A)===1?w+=A:Math.abs(w-A)===1&&(w-=A)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,w,S),_.neighboringTiles&&_.neighboringTiles[P]&&(_.neighboringTiles[P].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,d,_){for(const y in this._tiles){let w=this._tiles[y];if(_[y]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>d)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const P=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[P.key],w&&w.hasData()&&(S=P)}let A=S;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),i[A.key]){_[S.key]=S;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const d=this._loadedParentTiles[i.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=i.overscaledZ-1;d>=l;d--){const _=i.scaledTo(d),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const d=Math.ceil(i.width/l)+1,_=Math.ceil(i.height/l)+1,y=Math.floor(d*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)}handleWrapJump(i){const l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){const d={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(i,l,d,_,y){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(i,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let S,A=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const D=P.attenuationRange()[0],j=Math.floor(D)-Math.log2(P.getDemUpscale());A>j&&(A=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new a.aO(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){const D=i.clone();D.tileCoverLift=this.tileCoverLift,S=D.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(S.push(new a.aO(1,0,1,0,0)),S.push(new a.aO(1,0,1,1,0)),S.push(new a.aO(1,0,1,0,1)),S.push(new a.aO(1,0,1,1,1)))}else if(S=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const D=this._source.hasTile.bind(this._source);S=S.filter(j=>D(j))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Zd(this._source.type)){const D=i.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),j=Math.min(D,this._source.maxzoom);if(w){const V=i.extendTileCover(S,j);for(const G of V)S.push(G)}else if(y){const V=i.extendTileCoverToNearPlane(S,this.transform.getFrustum(j),j);for(const G of V)S.push(G)}else if(this.castsShadows&&_){const V=i.extendTileCover(S,j,_);for(const G of V)this._shadowCasterTiles[G.key]=!0,S.push(G)}}const M=this._updateRetainedTiles(S);if(Zd(this._source.type)&&S.length!==0){const D={},j={},V=Object.keys(M);for(const te of V){const K=M[te],oe=this._tiles[te];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=a.o.now())continue;const he=this.findLoadedParent(K,Math.max(K.overscaledZ-xo.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),D[he.tileID.key]=he.tileID),j[te]=K}const G=S[S.length-1].overscaledZ;for(const te in this._tiles){const K=this._tiles[te];if(M[te]||!K.hasData())continue;let oe=K.tileID;for(;oe.overscaledZ>G;){oe=oe.scaledTo(oe.overscaledZ-1);const he=this._tiles[oe.key];if(he&&he.hasData()&&j[oe.key]){M[te]=K.tileID;break}}}for(const te in D)M[te]||(this._coveredTiles[te]=!0,M[te]=D[te])}for(const D in M)this._tiles[D].clearFadeHold();const z=a.bv(this._tiles,M);for(const D of z){const j=this._tiles[D];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(i.length===0)return l;const d={},_=i.reduce((P,M)=>Math.min(P,M.overscaledZ),1/0),y=i[0].overscaledZ,w=Math.max(y-xo.maxOverzooming,this._source.minzoom),S=Math.max(y+xo.maxUnderzooming,this._source.minzoom),A={};for(const P of i){const M=this._addTile(P);l[P.key]=P,M.hasData()||_<this._source.maxzoom&&(A[P.key]=P)}this._retainLoadedChildren(A,_,S,l);for(const P of i){let M=this._tiles[P.key];if(M.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const D=P.children(this._source.maxzoom)[0],j=this.getTile(D);if(j&&j.hasData()){l[D.key]=D;continue}}else{const D=P.children(this._source.maxzoom);if(l[D[0].key]&&l[D[1].key]&&l[D[2].key]&&l[D[3].key])continue}let z=M.wasRequested();for(let D=P.overscaledZ-1;D>=w;--D){const j=P.scaledTo(D);if(d[j.key]||(d[j.key]=!0,M=this.getTile(j),!M&&z&&(M=this._addTile(j)),M&&(l[j.key]=j,z=M.wasRequested(),M.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let d,_=this._tiles[i].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}l.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;_=y}for(const y of l)this._loadedParentTiles[y]=d}}_addTile(i){let l=this._tiles[i.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const d=!!l;if(!d){const _=this.map?this.map.painter:null,y=this._source.tileSize*i.overscaleFactor();l=this._source.type==="raster-array"?new Ih(i,y,this.transform.tileZoom,_,this._isRaster):new El(i,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l.uses++,this._tiles[i.key]=l,d||this._source.fire(new a.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const d=l.getExpiryTimeout();d&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},d))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,d){const _=[],y=this.transform;if(!y)return _;const w=y.projection.name==="globe",S=a.aF(y.center.lng);for(const A in this._tiles){const P=this._tiles[A];if(d&&P.clearQueryDebugViz(),P.holdingForFade())continue;let M;if(w){const z=P.tileID.canonical;if(z.z===0){const D=[Math.abs(a.aA(S,...su(z,-1))-S),Math.abs(a.aA(S,...su(z,1))-S)];M=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(a.aA(S,...su(z,-1))-S),Math.abs(a.aA(S,...su(z,0))-S),Math.abs(a.aA(S,...su(z,1))-S)];M=[D.indexOf(Math.min(...D))-1]}}else M=[0];for(const z of M){const D=i.containsTile(P,y,l,z);D&&_.push(D)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,l){const d=this.getRenderableIds(i,l).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(i){const l=i.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const w of l){const S=1/(1<<w.canonical.z);y[w.key]=((w.canonical.x+.5)*S+w.wrap-d[0])*_[0]+((w.canonical.y+.5)*S-d[1])*_[1]-d[2]*_[2]}return l.sort((w,S)=>y[w.key]-y[S.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Zd(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=a.o.now())return!0}return!1}setFeatureState(i,l,d){this._state.updateState(i=i||"_geojsonTileLayer",l,d)}removeFeatureState(i,l,d){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,d)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,d){const _=this._tiles[i];_&&_.setDependencies(l,d)}reloadTilesForDependencies(i,l){for(const d in this._tiles)this._tiles[d].hasDependency(i,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(i,l))}_preloadTiles(i,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(i,l))};return void this._source.on("data",A)}const d=new Map,_=Array.isArray(i)?i:[i],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const A of _){const P=A.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of P)d.set(M.key,M);this.usedForTerrain&&A.updateElevation(!1)}const S=Array.from(d.values());a.bw(S,(A,P)=>{const M=new El(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(M,z=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),P(z,M)})},l)}}function Am(f,i){const l=Math.abs(2*f.wrap)-+(f.wrap<0),d=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||d-l||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function Zd(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function su(f,i){const l=1<<f.z;return[f.x/l+i,(f.x+1)/l+i]}xo.maxOverzooming=10,xo.maxUnderzooming=3;class Xd{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,l=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:i,visibilityChanged:l});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:i,visibilityChanged:l})}}}onNewFrame(i){this.layersGotHidden=!1;for(const l of this.layers){const d=l.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(i)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?_=!d.isHidden(i)&&d.paint.get("building-opacity")>0:d.type==="model"&&(_=!d.isHidden(i)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&l.visible,l.visible=_}}updateZOffset(i,l){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,w=this.style.getLayerSourceCache(y);let S=1;y.type==="fill-extrusion"?S=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(S=_.visible?y.paint.get("building-vertical-scale"):0);let A=w?w.getTile(l):null;if(!A&&w)for(const P in w._tiles){const M=w._tiles[P];if(l.canonical.isChildOf(M.tileID.canonical)){A=M;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:l,verticalScale:S})}i.hasAnyZOffset=!1;let d=!1;for(let _=0;_<i.symbolInstances.length;_++){const y=i.symbolInstances.get(_),w=y.zOffset,S=this._getHeightAtTileOffset(l,y.tileAnchorX,y.tileAnchorY);y.zOffset=S!==Number.NEGATIVE_INFINITY?S:w,d||w===y.zOffset||(d=!0),i.hasAnyZOffset||y.zOffset===0||(i.hasAnyZOffset=!0)}d&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,l,d,_){let y=l,w=d;if(i.canonical.z!==_.canonical.z){const S=_.canonical,A=1/(1<<i.canonical.z-S.z);y=(l+i.canonical.x*a.al)*A-S.x*a.al|0,w=(d+i.canonical.y*a.al)*A-S.y*a.al|0}return{tileX:y,tileY:w}}_getHeightAtTileOffset(i,l,d){let _,y;for(let w=0;w<this.layers.length;++w){const S=this.layers[w].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:A,tileID:P,verticalScale:M}=this.currentBuildingBuckets[w];if(!A)continue;const{tileX:z,tileY:D}=this._mapCoordToOverlappingTile(i,l,d,P),j=A.getHeightAtTileCoord(z,D);j&&j.height!==void 0&&(j.hidden?_=j.height:y=Math.max(j.height*M,y||0))}if(y!==void 0)return y;for(let w=0;w<this.layers.length;++w){const S=this.layers[w];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:A,tileID:P}=this.currentBuildingBuckets[w];if(!A)continue;const{tileX:M,tileY:z}=this._mapCoordToOverlappingTile(i,l,d,P),D=A.getHeightAtTileCoord(M,z);if(D&&!D.hidden)return D.height===void 0&&_!==void 0?Math.min(D.maxHeight,_)*D.verticalScale:D.height?D.height*D.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Im(f,i){const l={};for(const d in f)d!=="ref"&&(l[d]=f[d]);return a.bx.forEach(d=>{d in i&&(l[d]=i[d])}),l}function Kd(f){f=f.slice();const i=Object.create(null);for(let l=0;l<f.length;l++)i[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=Im(f[l],i[f[l].ref]));return f}const oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ou(f,i,l){l.push({command:oi.addSource,args:[f,i[f]]})}function j_(f,i,l){i.push({command:oi.removeSource,args:[f]}),l[f]=!0}function U_(f,i,l,d){j_(f,l,d),ou(f,i,l)}function Yd(f,i,l){let d;for(d in f[l])if(f[l].hasOwnProperty(d)&&d!=="data"&&!a.by(f[l][d],i[l][d]))return!1;for(d in i[l])if(i[l].hasOwnProperty(d)&&d!=="data"&&!a.by(f[l][d],i[l][d]))return!1;return!0}function Al(f,i,l,d,_,y){let w;for(w in i=i||{},f=f||{})f.hasOwnProperty(w)&&(a.by(f[w],i[w])||l.push({command:y,args:[d,w,i[w],_]}));for(w in i)i.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(a.by(f[w],i[w])||l.push({command:y,args:[d,w,i[w],_]}))}function au(f){return f.id}function Ph(f,i){return f[i.id]=i,f}function Jd(f,i,l){const d=i.createTileMatrix(f,f.worldSize,l.toUnwrapped());return a.aB(new Float32Array(16),f.projMatrix,d)}function V_(f,i,l){if(i.projection.name===l.projection.name)return f.projMatrix;const d=l.clone();return d.setProjection(i.projection),Jd(d,i.getProjection(),f)}function lc(f,i,l){return i.name===l.projection.name?f.projMatrix:Jd(l,i,f)}class $_{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.aA(i,0,1);let l=1,d=this._distances[l];const _=i*this.paddedLength+this.padding;for(;d<_&&l<this._distances.length;)d=this._distances[++l];const y=l-1,w=this._distances[y],S=d-w,A=S>0?(_-w)/S:0;return this.points[y].mult(1-A).add(this.points[l].mult(A))}}class Cm{constructor(i,l,d){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(l/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,d,_,y){this._forEachCell(l,d,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(i,l,d,_){this._forEachCell(l-_,d-_,l+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(d),this.circles.push(_)}_insertBoxCell(i,l,d,_,y,w){this.boxCells[y].push(w)}_insertCircleCell(i,l,d,_,y,w){this.circleCells[y].push(w)}_query(i,l,d,_,y,w){if(d<0||i>this.width||_<0||l>this.height)return!y&&[];const S=[];if(i<=0&&l<=0&&this.width<=d&&this.height<=_){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],M=this.circles[3*A+1],z=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:P-z,y1:M-z,x2:P+z,y2:M+z})}return w?S.filter(w):S}return this._forEachCell(i,l,d,_,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?S.length>0:S}_queryCircle(i,l,d,_,y){const w=i-d,S=i+d,A=l-d,P=l+d;if(S<0||w>this.width||P<0||A>this.height)return!_&&[];const M=[];return this._forEachCell(w,A,S,P,this._queryCellCircle,M,{hitTest:_,circle:{x:i,y:l,radius:d},seenUids:{box:{},circle:{}}},y),_?M.length>0:M}query(i,l,d,_,y){return this._query(i,l,d,_,!1,y)}hitTest(i,l,d,_,y){return this._query(i,l,d,_,!0,y)}hitTestCircle(i,l,d,_){return this._queryCircle(i,l,d,!0,_)}_queryCell(i,l,d,_,y,w,S,A){const P=S.seenUids,M=this.boxCells[y];if(M!==null){const D=this.bboxes;for(const j of M)if(!P.box[j]){P.box[j]=!0;const V=4*j;if(i<=D[V+2]&&l<=D[V+3]&&d>=D[V+0]&&_>=D[V+1]&&(!A||A(this.boxKeys[j]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[j],x1:D[V],y1:D[V+1],x2:D[V+2],y2:D[V+3]})}}}const z=this.circleCells[y];if(z!==null){const D=this.circles;for(const j of z)if(!P.circle[j]){P.circle[j]=!0;const V=3*j;if(this._circleAndRectCollide(D[V],D[V+1],D[V+2],i,l,d,_)&&(!A||A(this.circleKeys[j]))){if(S.hitTest)return w.push(!0),!0;{const G=D[V],te=D[V+1],K=D[V+2];w.push({key:this.circleKeys[j],x1:G-K,y1:te-K,x2:G+K,y2:te+K})}}}}}_queryCellCircle(i,l,d,_,y,w,S,A){const P=S.circle,M=S.seenUids,z=this.boxCells[y];if(z!==null){const j=this.bboxes;for(const V of z)if(!M.box[V]){M.box[V]=!0;const G=4*V;if(this._circleAndRectCollide(P.x,P.y,P.radius,j[G+0],j[G+1],j[G+2],j[G+3])&&(!A||A(this.boxKeys[V])))return w.push(!0),!0}}const D=this.circleCells[y];if(D!==null){const j=this.circles;for(const V of D)if(!M.circle[V]){M.circle[V]=!0;const G=3*V;if(this._circlesCollide(j[G],j[G+1],j[G+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[V])))return w.push(!0),!0}}}_forEachCell(i,l,d,_,y,w,S,A){const P=this._convertToXCellCoord(i),M=this._convertToYCellCoord(l),z=this._convertToXCellCoord(d),D=this._convertToYCellCoord(_);for(let j=P;j<=z;j++)for(let V=M;V<=D;V++)if(y.call(this,i,l,d,_,this.xCellCount*V+j,w,S,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,d,_,y,w){const S=_-i,A=y-l,P=d+w;return P*P>S*S+A*A}_circleAndRectCollide(i,l,d,_,y,w,S){const A=(w-_)/2,P=Math.abs(i-(_+A));if(P>A+d)return!1;const M=(S-y)/2,z=Math.abs(l-(y+M));if(z>M+d)return!1;if(P<=A||z<=M)return!0;const D=P-A,j=z-M;return D*D+j*j<=d*d}}const lu={unknown:0,flipRequired:1,flipNotRequired:2},Qd=Math.tan(85*Math.PI/180);function ia(f,i,l,d,_,y,w){const S=a.bC();if(l)if(y.name==="globe"){const A=a.bD(_,i);a.aB(S,S,A)}else{const A=a.bE([],w);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],d||a.bB(S,S,_.angle)}else a.aB(S,_.labelPlaneMatrix,f);return S}function kh(f,i,l,d,_,y,w){const S=ia(f,i,l,d,_,y,w);return y.name==="globe"&&l||(S[2]=S[6]=S[10]=S[14]=0),S}function ef(f,i,l,d,_,y,w){if(l){if(y.name==="globe"){const S=ia(f,i,l,d,_,y,w);return a.bl(S,S),a.aB(S,f,S),S}{const S=a.bz(f),A=a.bA([]);return A[0]=w[0],A[1]=w[1],A[4]=w[2],A[5]=w[3],a.aB(S,S,A),d||a.bB(S,S,-_.angle),S}}return _.glCoordMatrix}function vo(f,i,l,d){const _=[f,i,l,1];l?a.aC(_,_,d):Mm(_,_,d);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function cc(f,i){return Math.min(.5+f/i*.5,1.5)}function wo(f,i){const l=f[0]/f[3],d=f[1]/f[3];return l>=-i[0]&&l<=i[0]&&d>=-i[1]&&d<=i[1]}function Pm(f,i,l,d,_,y,w,S,A,P){const M=l.transform,z=d?f.textSizeData:f.iconSizeData,D=a.bK(z,l.transform.zoom),j=M.projection.name==="globe",V=[256/l.width*2+1,256/l.height*2+1],G=d?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;G.clear();let te=null;j&&(te=d?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const K=f.lineVertexArray,oe=d?f.text.placedSymbolArray:f.icon.placedSymbolArray,he=l.transform.width/l.transform.height;let ge,Se=!1;for(let be=0;be<oe.length;be++){const Ee=oe.get(be),{numGlyphs:Te,writingMode:we}=Ee;if(we!==a.bL.vertical||Se||ge===a.bL.horizontal||(Se=!0),ge=we,(Ee.hidden||we===a.bL.vertical)&&!Se){wr(Te,G);continue}Se=!1;const Ae=new a.P(Ee.tileAnchorX,Ee.tileAnchorY);let{x:qe,y:Ne,z:rt}=M.projection.projectTilePoint(Ae.x,Ae.y,P.canonical);if(A){const[xt,lr,tr]=A(Ae);qe+=xt,Ne+=lr,rt+=tr}const $e=[qe,Ne,rt,1];if(a.aC($e,$e,i),!wo($e,V)){wr(Te,G);continue}const Qe=$e[3],kt=cc(l.transform.getCameraToCenterDistance(M.projection),Qe),We=a.bM(z,D,Ee),Oe=w?We/kt:We*kt,ot=vo(qe,Ne,rt,_);if(ot[3]<=0){wr(Te,G);continue}let Xe={};const gt=a.an(f.layers[0].layout.get("text-max-angle")),Ct=Math.cos(gt),jt=w?null:A,St=_i(Ee,Oe,!1,S,i,_,y,f.glyphOffsetArray,K,G,te,ot,Ae,Xe,he,jt,M.projection,P,w,Ct);Se=St.useVertical,jt&&St.needsFlipping&&(Xe={}),(St.notEnoughRoom||Se||St.needsFlipping&&_i(Ee,Oe,!0,S,i,_,y,f.glyphOffsetArray,K,G,te,ot,Ae,Xe,he,jt,M.projection,P,w,Ct).notEnoughRoom)&&wr(Te,G)}d?(f.text.dynamicLayoutVertexBuffer.updateData(G),te&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(G),te&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(te))}function tf(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te){const{lineStartIndex:K,glyphStartIndex:oe,segment:he}=S,ge=oe+S.numGlyphs,Se=K+S.lineLength,be=i.getoffsetX(oe),Ee=i.getoffsetX(ge-1),Te=rf(f*be,l,d,_,y,w,he,K,Se,A,P,M,z,D,!0,j,V,G,te);if(!Te)return null;const we=rf(f*Ee,l,d,_,y,w,he,K,Se,A,P,M,z,D,!0,j,V,G,te);return we?{first:Te,last:we}:null}function km(f,i,l,d){return f===a.bL.horizontal&&Math.abs(d)>Math.abs(l)?{useVertical:!0}:f===a.bL.vertical?d>0?{needsFlipping:!0}:null:i!==lu.unknown&&function(_,y){return _===0||Math.abs(y/_)>Qd}(l,d)?i===lu.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function _i(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe,he){const ge=i/24,Se=f.lineOffsetX*ge,be=f.lineOffsetY*ge,{lineStartIndex:Ee,glyphStartIndex:Te,numGlyphs:we,segment:Ae,writingMode:qe,flipState:Ne}=f,rt=Ee+f.lineLength,$e=Qe=>{if(M){const[ot,Xe,gt]=Qe.up,Ct=P.length;a.bN(M,Ct+0,ot,Xe,gt),a.bN(M,Ct+1,ot,Xe,gt),a.bN(M,Ct+2,ot,Xe,gt),a.bN(M,Ct+3,ot,Xe,gt)}const[kt,We,Oe]=Qe.point;a.bO(P,kt,We,Oe,Qe.angle)};if(we>1){const Qe=tf(ge,S,Se,be,l,z,D,f,A,y,j,G,!1,te,K,oe,he);if(!Qe)return{notEnoughRoom:!0};if(d&&!l){let[kt,We,Oe]=Qe.first.point,[ot,Xe,gt]=Qe.last.point;[kt,We]=vo(kt,We,Oe,w),[ot,Xe]=vo(ot,Xe,gt,w);const Ct=km(qe,Ne,(ot-kt)*V,Xe-We);if(f.flipState=Ct&&Ct.needsFlipping?lu.flipRequired:lu.flipNotRequired,Ct)return Ct}$e(Qe.first);for(let kt=Te+1;kt<Te+we-1;kt++){const We=rf(ge*S.getoffsetX(kt),Se,be,l,z,D,Ae,Ee,rt,A,y,j,G,!1,!1,te,K,oe,he);if(!We)return P.length-=4*(kt-Te),{notEnoughRoom:!0};$e(We)}$e(Qe.last)}else{if(d&&!l){const kt=vo(D.x,D.y,0,_),We=Ee+Ae+1,Oe=new a.P(A.getx(We),A.gety(We)),ot=vo(Oe.x,Oe.y,0,_),Xe=ot[3]>0?ot:G_(D,Oe,kt,1,_,void 0,te,K.canonical),gt=km(qe,Ne,(Xe[0]-kt[0])*V,Xe[1]-kt[1]);if(f.flipState=gt&&gt.needsFlipping?lu.flipRequired:lu.flipNotRequired,gt)return gt}const Qe=rf(ge*S.getoffsetX(Te),Se,be,l,z,D,Ae,Ee,rt,A,y,j,G,!1,!1,te,K,oe,he);if(!Qe)return{notEnoughRoom:!0};$e(Qe)}return{}}function Rm(f,i,l,d,_){const{x:y,y:w,z:S}=d.projectTilePoint(f.x,f.y,i);if(!_)return vo(y,w,S,l);const[A,P,M]=_(f);return vo(y+A,w+P,S+M,l)}function G_(f,i,l,d,_,y,w,S){const A=Rm(f.sub(i)._unit()._add(f),S,_,w,y);return a.av(A,l,A),a.aw(A,A),a.bH(A,l,A,d)}function rf(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe){const he=d?f-i:f+i;let ge=he>0?1:-1,Se=0;d&&(ge*=-1,Se=Math.PI),ge<0&&(Se+=Math.PI);let be=S+w+(ge>0?0:1)|0,Ee=_,Te=_,we=0,Ae=0;const qe=Math.abs(he),Ne=[],rt=[];let $e=y,Qe=$e,kt=a.bF([]);const We=()=>G_(Qe,$e,Te,qe-we+1,M,D,G,te.canonical);for(;we+Ae<=qe;){if(be+=ge,be<S||be>=A)return null;if(Te=Ee,Qe=$e,Ne.push(Te),j&&rt.push(Qe),$e=new a.P(P.getx(be),P.gety(be)),Ee=z[be],!Ee){const tr=Rm($e,te.canonical,M,G,D);Ee=tr[3]>0?z[be]=tr:We()}we+=Ae;const xt=a.av([],Ee,Te),lr=a.bG(Te,Ee);if(l&&lr>0&&Ae>0&&a.bJ(kt,xt)/(Ae*lr)<oe)return null;Ae=lr,kt=xt}V&&D&&(z[be]&&(Ee=We(),Ae=a.bG(Te,Ee),kt=a.av([],Ee,Te)),z[be]=Ee);const Oe=(qe-we)/Ae,ot=$e.sub(Qe)._mult(Oe)._add(Qe),Xe=a.bH([],Te,kt,Oe);let gt=[0,0,1],Ct=kt[0],jt=kt[1];if(K&&(gt=G.upVector(te.canonical,ot.x,ot.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const xt=[gt[2],0,-gt[0]],lr=a.bI([],gt,xt);a.aw(xt,xt),a.aw(lr,lr),Ct=a.bJ(kt,xt),jt=a.bJ(kt,lr)}if(l){const xt=a.bI([],gt,kt);a.aw(xt,xt),a.bH(Xe,Xe,xt,l*ge)}const St=Se+Math.atan2(jt,Ct);return Ne.push(Xe),j&&rt.push(ot),{point:Xe,angle:St,path:Ne,tilePath:rt,up:gt}}function wr(f,i){const l=i.length,d=l+4*f;i.resize(d),i.float32.fill(-1/0,4*l,4*d)}function Mm(f,i,l){const d=i[0],_=i[1];return f[0]=l[0]*d+l[4]*_+l[12],f[1]=l[1]*d+l[5]*_+l[13],f[3]=l[3]*d+l[7]*_+l[15],f}const bo=100;class na{constructor(i,l,d=new Cm(i.width+200,i.height+200,25),_=new Cm(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+bo,this.screenBottomBoundary=i.height+bo,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,d,_,y,w,S,A,P,M,z){let D=d.projectedAnchorX,j=d.projectedAnchorY,V=d.projectedAnchorZ;const G=d.tileAnchorX,te=d.tileAnchorY,K=d.elevation,oe=d.tileID,he=i.getProjection();if(K&&oe){const[rt,$e,Qe]=he.upVector(oe.canonical,d.tileAnchorX,d.tileAnchorY),kt=he.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=rt*K*kt,j+=$e*K*kt,V+=Qe*K*kt}const ge=i.projection.name==="globe",Se=i.projection.name==="globe"?a.aj(this.transform.zoom):0;if(oe&&ge&&Se<1&&!w){const rt=1<<oe.canonical.z,$e=a.bP(G,te);a.bQ($e,$e,1/a.al),a.bR($e,$e,a.bP(oe.canonical.x,oe.canonical.y)),a.bQ($e,$e,1/rt),a.bS($e,$e,a.bP(_[0],_[1])),$e[0]=a.bT($e[0],-.5,.5),a.bQ($e,$e,a.al);const Qe=a.bU($e[0],$e[1],a.al/(2*Math.PI),1);a.aC(Qe,Qe,y),D=a.ak(D,Qe[0],Se),j=a.ak(j,Qe[1],Se),V=a.ak(V,Qe[2],Se)}const be=this.projectAndGetPerspectiveRatio(M,D,j,V,d.tileID,he.name==="globe"||!!K||this.transform.pitch>0,he),Ee=P*be.perspectiveRatio,Te=(d.x1*l+S.x-d.padding)*Ee+be.point.x,we=(d.y1*l+S.y-d.padding)*Ee+be.point.y,Ae=(d.x2*l+S.x+d.padding)*Ee+be.point.x,qe=(d.y2*l+S.y+d.padding)*Ee+be.point.y,Ne=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(Te,we,Ae,qe)||!A&&this.grid.hitTest(Te,we,Ae,qe,z)||Ne?{box:[],offscreen:!1,occluded:be.occluded}:{box:[Te,we,Ae,qe],offscreen:this.isOffscreen(Te,we,Ae,qe),occluded:!1}}placeCollisionCircles(i,l,d,_,y,w,S,A,P,M,z,D,j,V,G){const te=[],K=this.transform.elevation,oe=i.getProjection(),he=K?K.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,oe):null,ge=new a.P(d.tileAnchorX,d.tileAnchorY);let{x:Se,y:be,z:Ee}=oe.projectTilePoint(ge.x,ge.y,G.canonical);if(he){const[gt,Ct,jt]=he(ge);Se+=gt,be+=Ct,Ee+=jt}const Te=oe.name==="globe",we=this.projectAndGetPerspectiveRatio(S,Se,be,Ee,G,Te||!!K||this.transform.pitch>0,oe),{perspectiveRatio:Ae}=we,qe=(z?w/Ae:w*Ae)/a.bX,Ne=vo(Se,be,Ee,A),rt=d.lineOffsetX*qe,$e=d.lineOffsetY*qe,Qe=a.an(i.layers[0].layout.get("text-max-angle")),kt=Math.cos(Qe),We=we.signedDistanceFromCamera>0?tf(qe,y,rt,$e,!1,Ne,ge,d,_,A,{},K&&!z?he:null,z&&!!K,oe,G,z,kt):null;let Oe=!1,ot=!1,Xe=!0;if(We&&!we.occluded){const gt=.5*j*Ae+V,Ct=new a.P(-100,-100),jt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),St=new $_,{first:xt,last:lr}=We,tr=xt.path.length;let nr=[];for(let Br=tr-1;Br>=1;Br--)nr.push(xt.path[Br]);for(let Br=1;Br<lr.path.length;Br++)nr.push(lr.path[Br]);const er=2.5*gt;P&&(nr=nr.map(([Br,$r,xi],Or)=>(he&&!Te&&(xi=he(Or<tr-1?xt.tilePath[tr-1-Or]:lr.tilePath[Or-tr+2])[2]),vo(Br,$r,xi,P))),nr.some(Br=>Br[3]<=0)&&(nr=[]));let Rr=[];if(nr.length>0){let Br=1/0,$r=-1/0,xi=1/0,Or=-1/0;for(const li of nr)Br=Math.min(Br,li[0]),xi=Math.min(xi,li[1]),$r=Math.max($r,li[0]),Or=Math.max(Or,li[1]);$r>=Ct.x&&Br<=jt.x&&Or>=Ct.y&&xi<=jt.y&&(Rr=[nr.map(li=>new a.P(li[0],li[1]))],(Br<Ct.x||$r>jt.x||xi<Ct.y||Or>jt.y)&&(Rr=a.bV(Rr,Ct.x,Ct.y,jt.x,jt.y)))}for(const Br of Rr){St.reset(Br,.25*gt);let $r=0;$r=St.length<=.5*gt?1:Math.ceil(St.paddedLength/er)+1;for(let xi=0;xi<$r;xi++){const Or=xi/Math.max($r-1,1),li=St.lerp(Or),mi=li.x+bo,Vi=li.y+bo;te.push(mi,Vi,gt,0);const jr=mi-gt,hi=Vi-gt,ci=mi+gt,pi=Vi+gt;if(Xe=Xe&&this.isOffscreen(jr,hi,ci,pi),ot=ot||this.isInsideGrid(jr,hi,ci,pi),!l&&this.grid.hitTestCircle(mi,Vi,gt,D)&&(Oe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!M&&Oe||!ot?[]:te,offscreen:Xe,collisionDetected:Oe,occluded:we.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let d=1/0,_=1/0,y=-1/0,w=-1/0;for(const M of i){const z=new a.P(M.x+bo,M.y+bo);d=Math.min(d,z.x),_=Math.min(_,z.y),y=Math.max(y,z.x),w=Math.max(w,z.y),l.push(z)}const S=this.grid.query(d,_,y,w).concat(this.ignoredGrid.query(d,_,y,w)),A={},P={};for(const M of S){const z=M.key;if(A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]={}),A[z.bucketInstanceId][z.featureIndex])continue;const D=[new a.P(M.x1,M.y1),new a.P(M.x2,M.y1),new a.P(M.x2,M.y2),new a.P(M.x1,M.y2)];a.bW(l,D)&&(A[z.bucketInstanceId][z.featureIndex]=!0,P[z.bucketInstanceId]===void 0&&(P[z.bucketInstanceId]=[]),P[z.bucketInstanceId].push(z.featureIndex))}return P}insertCollisionBox(i,l,d,_,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:y},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,d,_,y){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:_,collisionGroupID:y};for(let A=0;A<i.length;A+=4)w.insertCircle(S,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,l,d,_,y,w,S){const A=[l,d,_,1];let P=!1;_||this.transform.pitch>0?(a.aC(A,A,i),this.fogState&&y&&S.name!=="globe"&&(P=function(D,j,V,G,te,K){const oe=K.calculateFogTileMatrix(te),he=[j,V,G];return a.af(he,he,oe),nt(D,a.ag(he),K.pitch,K._fov)}(this.fogState,l,d,_,y.toUnwrapped(),this.transform)>.9)):Mm(A,A,i);const M=A[3];return{point:new a.P((A[0]/M+1)/2*this.transform.width+bo,(-A[1]/M+1)/2*this.transform.height+bo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/M*.5,1.5),signedDistanceFromCamera:M,occluded:w&&A[2]>M||P}}isOffscreen(i,l,d,_){return d<bo||i>=this.screenRightBoundary||_<bo||l>this.screenBottomBoundary}isInsideGrid(i,l,d,_){return d>=0&&i<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=a.bA([]);return a.br(i,i,[-100,-100,0]),i}}class nf{constructor(i,l,d,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Ia{constructor(i,l,d,_,y,w=!1){this.text=new nf(i?i.text:null,l,d,y),this.icon=new nf(i?i.icon:null,l,_,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ur{constructor(i,l,d,_=!1){this.text=i,this.icon=l,this.skipFade=d,this.clipped=_}}class yi{constructor(){this.invProjMatrix=a.bC(),this.viewportMatrix=a.bC(),this.circles=[]}}class Ti{constructor(i,l,d,_,y){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=y}}class ro{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[i]}}function uc(f,i,l,d,_){const{horizontalAlign:y,verticalAlign:w}=a.c0(f),S=-(y-.5)*i,A=-(w-.5)*l,P=a.c1(f,d);return new a.P(S+P[0]*_,A+P[1]*_)}function fi(f,i,l,d,_){const y=new a.P(f,i);return l&&y._rotate(d?_:-_),y}class sf{constructor(i,l,d,_,y,w){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new na(this.transform,y),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ro(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,d,_,y=1){const w=d.getBucket(l),S=d.latestFeatureIndex;if(!w||!S||l.fqid!==w.layerIds[0])return;const A=w.layers[0].layout,P=w.layers[0].paint,M=d.collisionBoxArray,z=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),D=d.tileSize/a.al,j=d.tileID.toUnwrapped();this.transform.setProjection(w.projection);const V=(G=d.tileID,te=w.getProjection(),K=this.transform,te.name===this.projection?K.calculateProjMatrix(G.toUnwrapped()):Jd(K,te,G));var G,te,K;const oe=A.get("text-pitch-alignment")==="map",he=A.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const ge=l.dynamicFilter(),Se=l.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(d),Ee=kh(V,d.tileID.canonical,oe,he,this.transform,w.getProjection(),be);let Te=null;const we=w.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(oe){const Oe=ef(V,d.tileID.canonical,oe,he,this.transform,w.getProjection(),be);Te=a.aB([],this.transform.labelPlaneMatrix,Oe)}let Ae=null;ge&&d.latestFeatureIndex&&(Ae={unwrappedTileID:j,dynamicFilter:ge,dynamicFilterNeedsFeature:Se}),this.retainedQueryData[w.bucketInstanceId]=new Ti(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,d.tileID);const[qe,Ne]=w.layers[0].layout.get("text-size-scale-range"),rt=a.aA(y,qe,Ne),[$e,Qe]=A.get("icon-size-scale-range"),kt=a.aA(y,$e,Qe),We={bucket:w,layout:A,paint:P,posMatrix:V,invMatrix:we,mercatorCenter:[a.aF(this.transform.center.lng),a.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ee,labelToScreenMatrix:Te,clippingData:Ae,scale:z,textPixelRatio:D,holdingForFade:d.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.bK(w.textSizeData,this.transform.zoom,rt),partiallyEvaluatedIconSize:a.bK(w.iconSizeData,this.transform.zoom,kt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const Oe of w.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Xe,symbolInstanceEnd:gt}=Oe;i.push({sortKey:ot,symbolInstanceStart:Xe,symbolInstanceEnd:gt,parameters:We})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:We})}attemptAnchorPlacement(i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe,he,ge,Se){const{textOffset0:be,textOffset1:Ee,crossTileID:Te}=G,we=[be,Ee],Ae=uc(i,w,S,we,A),qe=this.collisionIndex.placeCollisionBox(K,A,l,d,_,y,fi(Ae.x,Ae.y,P,M,this.transform.angle),V,z,D,j.predicate);if(he){const Ne=K.getSymbolInstanceIconSize(Se,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,Ne,he,d,_,y,fi(Ae.x,Ae.y,P,M,this.transform.angle),V,z,D,j.predicate).box.length===0)return}if(qe.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Ne=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:we,width:w,height:S,anchor:i,textScale:A,prevAnchor:Ne},this.markUsedJustification(K,i,G,oe),K.allowVerticalPlacement&&(this.markUsedOrientation(K,oe,G),this.placedOrientations[Te]=oe),{shift:Ae,placedGlyphBoxes:qe}}}placeLayerBucketPart(i,l,d,_,y=1){const{bucket:w,layout:S,paint:A,posMatrix:P,textLabelPlaneMatrix:M,labelToScreenMatrix:z,clippingData:D,textPixelRatio:j,mercatorCenter:V,invMatrix:G,holdingForFade:te,collisionBoxArray:K,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:he,collisionGroup:ge,latestFeatureIndex:Se}=i.parameters,be=S.get("text-optional"),Ee=S.get("icon-optional"),Te=S.get("text-allow-overlap"),we=S.get("icon-allow-overlap"),Ae=S.get("text-rotation-alignment")==="map",qe=S.get("icon-rotation-alignment")==="map",Ne=S.get("text-pitch-alignment")==="map",rt=A.get("symbol-z-offset"),$e=S.get("symbol-elevation-reference")==="sea",Qe=S.get("symbol-placement"),[kt,We]=S.get("text-size-scale-range"),[Oe,ot]=S.get("icon-size-scale-range"),Xe=a.aA(y,kt,We),gt=a.aA(y,Oe,ot),Ct=S.get("text-variable-anchor"),jt=Ae&&Qe!=="point",St=qe&&Qe!=="point",xt=Ct&&w.hasTextData(),lr=w.hasIconTextFit()&&xt&&w.hasIconData();this.transform.setProjection(w.projection);const tr=xt||jt,nr=St||lr;let er=Te&&(we||!w.hasIconData()||Ee),Rr=we&&(Te||!w.hasTextData()||be);const Br=!rt.isConstant();!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),d&&_&&w.updateCollisionDebugBuffers(this.transform.zoom,K,Xe,gt);const $r=(Or,li,mi)=>{const{crossTileID:Vi,numVerticalGlyphVertices:jr}=Or;let hi=null;if(D&&D.dynamicFilterNeedsFeature||Br){const an=this.retainedQueryData[w.bucketInstanceId];hi=Se.loadFeature({featureIndex:Or.featureIndex,bucketIndex:an.bucketIndex,sourceLayerIndex:an.sourceLayerIndex,layoutVertexArrayOffset:0})}if(D&&!(0,D.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},hi,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new a.P(Or.tileAnchorX,Or.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[Vi]=new ur(!1,!1,!1,!0),void l.add(Vi);const ci=rt.evaluate(hi,{});if(l.has(Vi))return;if(te)return void(this.placements[Vi]=new ur(!1,!1,!1));let pi=!1,Hi=!1,hn=!0,Hn=!1,Wi=!1,Gr=null,Er={box:null,offscreen:null,occluded:null},vi={box:null},nn=null,Ki=null,bn=null,ts=0,Ao=0,Io=0;mi.textFeatureIndex?ts=mi.textFeatureIndex:Or.useRuntimeCollisionCircles&&(ts=Or.featureIndex),mi.verticalTextFeatureIndex&&(Ao=mi.verticalTextFeatureIndex);const no=an=>{an.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const dn=this.transform.elevation;an.elevation=$e?ci:ci+(dn?dn.getAtTileOffset(an.tileID,an.tileAnchorX,an.tileAnchorY):0),an.elevation+=Or.zOffset},so=mi.textBox;if(so){no(so);const an=Yi=>{let kn=a.bL.horizontal;if(w.allowVerticalPlacement&&!Yi&&this.prevPlacement){const Wn=this.prevPlacement.placedOrientations[Vi];Wn&&(this.placedOrientations[Vi]=Wn,kn=Wn,this.markUsedOrientation(w,kn,Or))}return kn},dn=(Yi,kn)=>{if(w.allowVerticalPlacement&&jr>0&&mi.verticalTextBox){for(const Wn of w.writingModes)if(Wn===a.bL.vertical?(Er=kn(),vi=Er):Er=Yi(),Er&&Er.box&&Er.box.length)break}else Er=Yi()};if(Ct){let Yi=Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vi]){const mn=this.prevPlacement.variableOffsets[Vi];Yi.indexOf(mn.anchor)>0&&(Yi=Yi.filter(hs=>hs!==mn.anchor),Yi.unshift(mn.anchor))}const kn=(mn,hs,Da)=>{const el=w.getSymbolInstanceTextSize(oe,Or,this.transform.zoom,li),ha=(mn.x2-mn.x1)*el+2*mn.padding,Gl=(mn.y2-mn.y1)*el+2*mn.padding,Hl=Or.hasIconTextFit&&!we?hs:null;Hl&&no(Hl);let Oa={box:[],offscreen:!1,occluded:!1};const Lu=Te?2*Yi.length:Yi.length;for(let tl=0;tl<Lu;++tl){const La=this.attemptAnchorPlacement(Yi[tl%Yi.length],mn,V,G,tr,ha,Gl,el,Ae,Ne,j,P,ge,tl>=Yi.length,Or,li,w,Da,Hl,oe,he);if(La&&(Oa=La.placedGlyphBoxes,Oa&&Oa.box&&Oa.box.length)){pi=!0,Gr=La.shift;break}}return Oa};dn(()=>kn(so,mi.iconBox,a.bL.horizontal),()=>{const mn=mi.verticalTextBox;return mn&&no(mn),w.allowVerticalPlacement&&!(Er&&Er.box&&Er.box.length)&&jr>0&&mn?kn(mn,mi.verticalIconBox,a.bL.vertical):{box:null,offscreen:null,occluded:null}}),Er&&(pi=Er.box,hn=Er.offscreen,Hn=Er.occluded);const Wn=an(!(!Er||!Er.box));if(!pi&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[Vi];mn&&(this.variableOffsets[Vi]=mn,this.markUsedJustification(w,mn.anchor,Or,Wn))}}else{const Yi=(kn,Wn)=>{const mn=w.getSymbolInstanceTextSize(oe,Or,this.transform.zoom,li),hs=this.collisionIndex.placeCollisionBox(w,mn,kn,V,G,tr,new a.P(0,0),Te,j,P,ge.predicate);return hs&&hs.box&&hs.box.length&&(this.markUsedOrientation(w,Wn,Or),this.placedOrientations[Vi]=Wn),hs};dn(()=>Yi(so,a.bL.horizontal),()=>{const kn=mi.verticalTextBox;return w.allowVerticalPlacement&&jr>0&&kn?(no(kn),Yi(kn,a.bL.vertical)):{box:null,offscreen:null,occluded:null}}),an(!!(Er&&Er.box&&Er.box.length))}}if(nn=Er,pi=nn&&nn.box&&nn.box.length>0,hn=nn&&nn.offscreen,Hn=nn&&nn.occluded,Or.useRuntimeCollisionCircles){const an=w.text.placedSymbolArray.get(Or.centerJustifiedTextSymbolIndex>=0?Or.centerJustifiedTextSymbolIndex:Or.verticalPlacedTextSymbolIndex),dn=a.bM(w.textSizeData,oe,an),Yi=S.get("text-padding");Ki=this.collisionIndex.placeCollisionCircles(w,Te,an,w.lineVertexArray,w.glyphOffsetArray,dn,P,M,z,d,Ne,ge.predicate,Or.collisionCircleDiameter*dn/a.bX,Yi,this.retainedQueryData[w.bucketInstanceId].tileID),pi=Te||Ki.circles.length>0&&!Ki.collisionDetected,hn=hn&&Ki.offscreen,Hn=Ki.occluded}if(mi.iconFeatureIndex&&(Io=mi.iconFeatureIndex),mi.iconBox){const an=dn=>{no(dn);const Yi=Or.hasIconTextFit&&Gr?fi(Gr.x,Gr.y,Ae,Ne,this.transform.angle):new a.P(0,0),kn=w.getSymbolInstanceIconSize(he,this.transform.zoom,Or.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,kn,dn,V,G,nr,Yi,we,j,P,ge.predicate)};vi&&vi.box&&vi.box.length&&mi.verticalIconBox?(bn=an(mi.verticalIconBox),Hi=bn.box.length>0):(bn=an(mi.iconBox),Hi=bn.box.length>0),hn=hn&&bn.offscreen,Wi=bn.occluded}const Ls=be||Or.numHorizontalGlyphVertices===0&&jr===0,Uo=Ee||Or.numIconVertices===0;if(Ls||Uo?Uo?Ls||(Hi=Hi&&pi):pi=Hi&&pi:Hi=pi=Hi&&pi,pi&&nn&&nn.box&&this.collisionIndex.insertCollisionBox(nn.box,S.get("text-ignore-placement"),w.bucketInstanceId,vi&&vi.box&&Ao?Ao:ts,ge.ID),Hi&&bn&&this.collisionIndex.insertCollisionBox(bn.box,S.get("icon-ignore-placement"),w.bucketInstanceId,Io,ge.ID),Ki&&(pi&&this.collisionIndex.insertCollisionCircles(Ki.circles,S.get("text-ignore-placement"),w.bucketInstanceId,ts,ge.ID),d)){const an=w.bucketInstanceId;let dn=this.collisionCircleArrays[an];dn===void 0&&(dn=this.collisionCircleArrays[an]=new yi);for(let Yi=0;Yi<Ki.circles.length;Yi+=4)dn.circles.push(Ki.circles[Yi+0]),dn.circles.push(Ki.circles[Yi+1]),dn.circles.push(Ki.circles[Yi+2]),dn.circles.push(Ki.collisionDetected?1:0)}const ua=w.projection.name!=="globe";er=er&&(ua||!Hn),Rr=Rr&&(ua||!Wi),this.placements[Vi]=new ur(pi||er,Hi||Rr,hn||w.justReloaded),l.add(Vi)},xi=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,xi),w.elevationType==="road"&&w.updateRoadElevation(xi.canonical),w.updateZOffset(),w.sortFeaturesByY){const Or=w.getSortedSymbolIndexes(this.transform.angle);for(let li=Or.length-1;li>=0;--li){const mi=Or[li];$r(w.symbolInstances.get(mi),mi,w.collisionArrays[mi])}w.hasAnyZOffset&&a.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Or=w.getSortedIndexesByZOffset();for(let li=0;li<Or.length;++li){const mi=Or[li];$r(w.symbolInstances.get(mi),mi,w.collisionArrays[mi])}}else for(let Or=i.symbolInstanceStart;Or<i.symbolInstanceEnd;Or++)$r(w.symbolInstances.get(Or),Or,w.collisionArrays[Or]);if(d&&w.bucketInstanceId in this.collisionCircleArrays){const Or=this.collisionCircleArrays[w.bucketInstanceId];a.bl(Or.invProjMatrix,P),Or.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,l,d,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:P}=d,M=a.c2(l),z=_===a.bL.vertical?A:M==="left"?y:M==="center"?w:M==="right"?S:-1;y>=0&&(i.text.placedSymbolArray.get(y).crossTileID=z>=0&&y!==z?0:P),w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:P),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:P),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=z>=0&&A!==z?0:P)}markUsedOrientation(i,l,d){const _=l===a.bL.horizontal||l===a.bL.horizontalOnly?l:0,y=l===a.bL.vertical?l:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P}=d,M=i.text.placedSymbolArray;w>=0&&(M.get(w).placedOrientation=_),S>=0&&(M.get(S).placedOrientation=_),A>=0&&(M.get(A).placedOrientation=_),P>=0&&(M.get(P).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(i):1,y=l?l.opacities:{},w=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],M=y[A];M?(this.opacities[A]=new Ia(M,_,P.text,P.icon,null,P.clipped),d=d||P.text!==M.text.placed||P.icon!==M.icon.placed):(this.opacities[A]=new Ia(null,_,P.text,P.icon,P.skipFade,P.clipped),d=d||P.text||P.icon)}for(const A in y){const P=y[A];if(!this.opacities[A]){const M=new Ia(P,_,!1,!1);M.isHidden()||(this.opacities[A]=M,d=d||P.text.placed||P.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);d?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l,d,_){const y=new Set;for(const w of l){const S=w.getBucket(i);S&&w.latestFeatureIndex&&i.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,y,w,w.collisionBoxArray,d,_,w.tileID,i.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,w.tileID),S.elevationType==="road"&&S.updateRoadElevation(w.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(i,l,d,_,y,w,S,A){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const P=i.layers[0].layout,M=i.layers[0].paint,z=!!i.layers[0].dynamicFilter(),D=new Ia(null,0,!1,!1,!0),j=P.get("text-allow-overlap"),V=P.get("icon-allow-overlap"),G=P.get("text-variable-anchor"),te=P.get("text-rotation-alignment")==="map",K=P.get("text-pitch-alignment")==="map",oe=M.get("symbol-z-offset"),he=P.get("symbol-elevation-reference")==="sea",ge=!oe.isConstant(),Se=new Ia(null,0,j&&(V||!i.hasIconData()||P.get("icon-optional")),V&&(j||!i.hasTextData()||P.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const be=(Te,we,Ae)=>{for(let qe=0;qe<we/4;qe++)Te.opacityVertexArray.emplaceBack(Ae)};let Ee=0;w&&i.updateReplacement(S,w);for(let Te=0;Te<i.symbolInstances.length;Te++){const we=i.symbolInstances.get(Te),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:qe,crossTileID:Ne,numIconVertices:rt,tileAnchorX:$e,tileAnchorY:Qe}=we;let kt=null;const We=this.retainedQueryData[i.bucketInstanceId];ge&&we&&We&&(kt=d.latestFeatureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=oe.evaluate(kt,{}),ot=l.has(Ne);let Xe=this.opacities[Ne];ot?Xe=D:Xe||(Xe=Se,this.opacities[Ne]=Xe),l.add(Ne);const gt=Ae>0||qe>0,Ct=rt>0,jt=this.placedOrientations[Ne],St=jt===a.bL.vertical,xt=jt===a.bL.horizontal||jt===a.bL.horizontalOnly;!gt&&!Ct||Xe.isHidden()||Ee++;let lr=!1;if((gt||Ct)&&w)for(const tr of i.activeReplacements){if(a.bY(tr,y,a.bZ.Symbol,A)||tr.min.x>$e||$e>tr.max.x||tr.min.y>Qe||Qe>tr.max.y)continue;const nr=a.b_($e,Qe,S.canonical,tr.footprintTileId.canonical);if(lr=a.b$(nr,tr.footprint),lr)break}if(gt){const tr=lr?Cl:Oh(Xe.text);be(i.text,Ae,St?Cl:tr),be(i.text,qe,xt?Cl:tr);const nr=Xe.text.isHidden(),{leftJustifiedTextSymbolIndex:er,centerJustifiedTextSymbolIndex:Rr,rightJustifiedTextSymbolIndex:Br,verticalPlacedTextSymbolIndex:$r}=we,xi=i.text.placedSymbolArray,Or=nr||St?1:0;er>=0&&(xi.get(er).hidden=Or),Rr>=0&&(xi.get(Rr).hidden=Or),Br>=0&&(xi.get(Br).hidden=Or),$r>=0&&(xi.get($r).hidden=nr||xt?1:0);const li=this.variableOffsets[Ne];li&&this.markUsedJustification(i,li.anchor,we,jt);const mi=this.placedOrientations[Ne];mi&&(this.markUsedJustification(i,"left",we,mi),this.markUsedOrientation(i,mi,we))}if(Ct){const tr=lr?Cl:Oh(Xe.icon),{placedIconSymbolIndex:nr,verticalPlacedIconSymbolIndex:er}=we,Rr=i.icon.placedSymbolArray,Br=Xe.icon.isHidden()?1:0;nr>=0&&(be(i.icon,rt,St?Cl:tr),Rr.get(nr).hidden=Br),er>=0&&(be(i.icon,we.numVerticalIconVertices,xt?Cl:tr),Rr.get(er).hidden=Br)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const tr=i.collisionArrays[Te];if(tr){let nr=new a.P(0,0),er=!0;if(tr.textBox||tr.verticalTextBox){if(G){const Br=this.variableOffsets[Ne];Br?(nr=uc(Br.anchor,Br.width,Br.height,Br.textOffset,Br.textScale),te&&nr._rotate(K?this.transform.angle:-this.transform.angle)):er=!1}z&&(er=!Xe.clipped),tr.textBox&&Il(i.textCollisionBox.collisionVertexArray,Xe.text.placed,!er||St,Oe,he,nr.x,nr.y),tr.verticalTextBox&&Il(i.textCollisionBox.collisionVertexArray,Xe.text.placed,!er||xt,Oe,he,nr.x,nr.y)}const Rr=er&&!!(!xt&&tr.verticalIconBox);tr.iconBox&&Il(i.iconCollisionBox.collisionVertexArray,Xe.icon.placed,Rr,Oe,he,we.hasIconTextFit?nr.x:0,we.hasIconTextFit?nr.y:0),tr.verticalIconBox&&Il(i.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!Rr,Oe,he,we.hasIconTextFit?nr.x:0,we.hasIconTextFit?nr.y:0)}}}if(i.fullyClipped=Ee===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Te.invProjMatrix,i.placementViewportMatrix=Te.viewportMatrix,i.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function Il(f,i,l,d,_,y,w){f.emplaceBack(i?1:0,l?1:0,y||0,w||0,d,_?1:0),f.emplaceBack(i?1:0,l?1:0,y||0,w||0,d,_?1:0),f.emplaceBack(i?1:0,l?1:0,y||0,w||0,d,_?1:0),f.emplaceBack(i?1:0,l?1:0,y||0,w||0,d,_?1:0)}const Rh=Math.pow(2,25),bs=Math.pow(2,24),Cn=Math.pow(2,17),N1=Math.pow(2,16),Mh=Math.pow(2,9),Dm=Math.pow(2,8),Dh=Math.pow(2,1);function Oh(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Rh+i*bs+l*Cn+i*N1+l*Mh+i*Dm+l*Dh+i}const Cl=0;class of{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,d,_,y,w){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(S,_,i[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,d,A.symbolInstanceStart===0,w),this._currentPartIndex++,y())return!0}return!1}}class Ms{constructor(i,l,d,_,y,w,S,A,P){this.placement=new sf(i,y,w,S,A,P),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,l,d,_,y){const w=a.o.now(),S=()=>{const A=a.o.now()-w;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=l[i[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){const M=A,z=M.layout.get("symbol-z-elevate"),D=M.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=M.layout.get("symbol-z-order"),V=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&D),G=M.layout.get("text-allow-overlap")||M.layout.get("icon-allow-overlap")||M.layout.get("text-ignore-placement")||M.layout.get("icon-ignore-placement"),te=V&&G,K=this._inProgressLayer=this._inProgressLayer||new of(M),oe=a.B(A.source,A.scope);if(K.continuePlacement(z||te?_[oe]:d[oe],this.placement,this._showCollisionBoxes,A,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const sa=512/a.al/2;class Gs{constructor(i,l,d){this.tileID=i,this.bucketInstanceId=d,this.index=new a.c3(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=i.canonical.x*a.al,y=i.canonical.y*a.al;for(let w=0;w<l.length;w++){const{key:S,crossTileID:A,tileAnchorX:P,tileAnchorY:M}=l.get(w),z=Math.floor((_+P)*sa),D=Math.floor((y+M)*sa);this.index.add(z,D),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(i,l,d){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),y=sa/Math.pow(2,l.canonical.z-this.tileID.canonical.z),w=l.canonical.x*a.al,S=l.canonical.y*a.al;for(let A=0;A<i.length;A++){const P=i.get(A);if(P.crossTileID)continue;const{key:M,tileAnchorX:z,tileAnchorY:D}=P,j=Math.floor((w+z)*y),V=Math.floor((S+D)*y),G=this.index.range(j-_,V-_,j+_,V+_).sort((te,K)=>te-K);for(const te of G){const K=this.crossTileIDs[te];if(this.keys[te]===M&&!d.has(K)){d.add(K),P.crossTileID=K;break}}}}}class H_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const d in this.indexes){const _=this.indexes[d],y={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),y[S.tileID.key]=S}this.indexes[d]=y}this.lng=i}addBucket(i,l,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const _=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>i.overscaledZ)for(const S in w){const A=w[S];A.tileID.isChildOf(i)&&A.findMatches(l.symbolInstances,i,_)}else{const S=w[i.scaledTo(Number(y)).key];S&&S.findMatches(l.symbolInstances,i,_)}}for(let y=0;y<l.symbolInstances.length;y++){const w=l.symbolInstances.get(y);w.crossTileID||(w.crossTileID=d.generate(),_.add(w.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Gs(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const d of l.crossTileIDs)this.usedCrossTileIDs[i].delete(d)}removeStaleBuckets(i){let l=!1;for(const d in this.indexes){const _=this.indexes[d];for(const y in _)i[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[y]),delete _[y],l=!0)}return l}}class Gn{constructor(){this.layerIndexes={},this.crossTileIDs=new H_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,d,_){let y=this.layerIndexes[i.fqid];y===void 0&&(y=this.layerIndexes[i.fqid]=new cu);let w=!1;const S={};_.name!=="globe"&&y.handleWrapJump(d);for(const A of l){const P=A.getBucket(i);P&&i.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,P,this.crossTileIDs)&&(w=!0),S[P.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(i){const l={};i.forEach(d=>{l[d]=!0});for(const d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}const Hs=771;class Ur{constructor(i,l,d,_){this.blendFunction=i,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=_}}Ur.Replace=[1,0,1,0],Ur.disabled=new Ur(Ur.Replace,a.ao.transparent,[!1,!1,!1,!1]),Ur.unblended=new Ur(Ur.Replace,a.ao.transparent,[!0,!0,!0,!0]),Ur.alphaBlended=new Ur([1,Hs,1,Hs],a.ao.transparent,[!0,!0,!0,!0]),Ur.alphaBlendedNonPremultiplied=new Ur([770,Hs,770,Hs],a.ao.transparent,[!0,!0,!0,!0]),Ur.multiply=new Ur([774,0,774,0],a.ao.transparent,[!0,!0,!0,!0]);class Ht{constructor(i,l,d){this.func=i,this.mask=l,this.range=d}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const Lh=7680;class Sr{constructor(i,l,d,_,y,w){this.test=i,this.ref=l,this.mask=d,this.fail=_,this.depthFail=y,this.pass=w}}Sr.disabled=new Sr({func:519,mask:0},0,0,Lh,Lh,Lh);const hc=1029,uu=2305;class Pr{constructor(i,l,d){this.enable=i,this.mode=l,this.frontFace=d}}function Om(f,i){const l=a.c9(f,3);a.cb(f,i),a.cf(f,3,l)}function Fh(f,i){const l=a.c6([]);return a.c7(l,l,-i),a.c8(l,l,-f),l}function Nh(f,i){const l=[f[0],f[1],0],d=[i[0],i[1],0];if(a.ag(l)>=1e-15){const w=a.aw([],l);a.c4(d,w,a.bJ(d,w)),i[0]=d[0],i[1]=d[1]}const _=a.bI([],i,f);if(a.c5(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return Fh(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),y)}Pr.disabled=new Pr(!1,hc,uu),Pr.backCCW=new Pr(!0,hc,uu),Pr.backCW=new Pr(!0,hc,2304),Pr.frontCW=new Pr(!0,1028,2304),Pr.frontCCW=new Pr(!0,1028,uu);class Lm{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof a.ae?i:new a.ae(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=a.bT(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(a.ae.fromLngLat(i)):0,y=a.ae.fromLngLat(i,_),w=[y.x-d.x,y.y-d.y,y.z-d.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Nh(w,l)}setPitchBearing(i,l){this.orientation=Fh(a.an(i),a.an(-l))}}class af{constructor(i,l){this._transform=a.bA([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new a.ae(i[0],i[1],i[2])}get position(){const i=a.c9(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&a.cf(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||a.c6([]),i&&Om(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=Fh(i,l),Om(this._transform,this._orientation)}forward(){const i=a.c9(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=a.c9(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=a.c9(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const d=new Float64Array(16);return a.bl(d,this.getWorldToCamera(i,l)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,l,d){const _=this.position;a.c4(_,_,-i);const y=new Float64Array(16);return a.bq(y,[d,d,d]),a.br(y,y,_),y[10]*=l,y}getWorldToCamera(i,l){const d=new Float64Array(16),_=new Float64Array(4),y=this.position;return a.ca(_,this._orientation),a.c4(y,y,-i),a.cb(d,_),a.br(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=l,d[9]*=l,d[10]*=l,d[11]*=l,d}getCameraToClipPerspective(i,l,d,_){const y=new Float64Array(16);return a.cc(y,i,l,d,_),y}getCameraToClipOrthographic(i,l,d,_,y,w){const S=new Float64Array(16);return a.cd(S,i,l,d,_,y,w),S}getDistanceToElevation(i,l=!1){const d=i===0?0:a.ce(i,l?a.a$(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new af([...this.position],[...this.orientation])}}const wn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Fm{constructor(i=0,l=0,d=0,_=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=d,this.right=_}interpolate(i,l,d){return l.top!=null&&i.top!=null&&(this.top=a.ak(i.top,l.top,d)),l.bottom!=null&&i.bottom!=null&&(this.bottom=a.ak(i.bottom,l.bottom,d)),l.left!=null&&i.left!=null&&(this.left=a.ak(i.left,l.left,d)),l.right!=null&&i.right!=null&&(this.right=a.ak(i.right,l.right,d)),this}getCenter(i,l){const d=a.aA((this.left+i-this.right)/2,0,i),_=a.aA((this.top+l-this.bottom)/2,0,l);return new a.P(d,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Fm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Xa=15;class Ds{constructor(i,l,d,_,y,w,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new a.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new af,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const i=new Ds(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i._allowWorldUnderZoom=this._allowWorldUnderZoom,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Xa}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,l=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(i||d)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return a.aH(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.cl(this.projectionOptions);const d=this.getProjection(),_=!a.by(l,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cl({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bT(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=a.cm(),a.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=a.aA(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=a.an(i),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const i=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,y=0;for(let w=0;w<l.length;w++){const S=new a.P(l[w][0]*this.width,d+l[w][1]*(this.height-d)),A=i.pointCoordinate(S);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);_+=A[3]*P,y+=P}return y===0?NaN:_/y}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(i),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-d,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const _=a.ag(a.av([],this._camera.position,d));return a.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!a.co(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];a.cp(d,this._camera.position)||(this._setCameraPosition(d),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new Lm;return l.position=new a.ae(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!a.cq(i))return!1;a.cr(i,i);const l=a.cs([],[0,0,-1],i),d=a.cs([],[0,-1,0],i);if(d[2]<0)return!1;const _=Nh(l,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;i[2]=a.aA(i[2],_/d,_/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,d){this._unmodified=!1,this._edgeInsets.interpolate(i,l,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new a.ct(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),_=this.pointCoordinate(new a.P(this.width,0)),y=this.pointCoordinate(new a.P(this.width,this.height)),w=this.pointCoordinate(new a.P(0,this.height)),S=Math.floor(Math.min(d.x,_.x,y.x,w.x)),A=Math.floor(Math.max(d.x,_.x,y.x,w.x)),P=1;for(let M=S-P;M<=A+P;M++)M!==0&&l.push(new a.ct(M,i))}return l}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,l,d){let _=[];const y=d!=null,w=!y;if(w&&this.zoom<l||y&&d[0]===0&&d[1]===0)return _;const S=new Set,A=(M,z,D,j,V)=>{const G=a.cX(z,M,D,j,V);S.has(G)||(_.push(new a.aO(M,z,D,j,V)),S.add(G))};for(let M=0;M<i.length;M++){const z=i[M];if(w&&z.canonical.z!==l)continue;const D=z.canonical,j=z.overscaledZ,V=z.wrap,G=1<<D.z,te=D.x+1<G,K=D.x>0,oe=D.y+1<G,he=D.y>0,ge=z.wrap-(K?0:1),Se=z.wrap+(te?0:1),be=K?D.x-1:G-1,Ee=te?D.x+1:0;if(y)d[0]<0?(A(j,Se,D.z,Ee,D.y),d[1]<0&&oe&&(A(j,V,D.z,D.x,D.y+1),A(j,Se,D.z,Ee,D.y+1)),d[1]>0&&he&&(A(j,V,D.z,D.x,D.y-1),A(j,Se,D.z,Ee,D.y-1))):d[0]>0?(A(j,ge,D.z,be,D.y),d[1]<0&&oe&&(A(j,V,D.z,D.x,D.y+1),A(j,ge,D.z,be,D.y+1)),d[1]>0&&he&&(A(j,V,D.z,D.x,D.y-1),A(j,ge,D.z,be,D.y-1))):d[1]<0&&oe?A(j,V,D.z,D.x,D.y+1):he&&A(j,V,D.z,D.x,D.y-1);else{const Te=z.visibleQuadrants;1&Te&&(A(j,ge,D.z,be,D.y),he&&(A(j,V,D.z,D.x,D.y-1),A(j,ge,D.z,be,D.y-1))),2&Te&&(A(j,Se,D.z,Ee,D.y),he&&(A(j,V,D.z,D.x,D.y-1),A(j,Se,D.z,Ee,D.y-1))),4&Te&&(A(j,ge,D.z,be,D.y),oe&&(A(j,V,D.z,D.x,D.y+1),A(j,ge,D.z,be,D.y+1))),8&Te&&(A(j,Se,D.z,Ee,D.y),oe&&(A(j,V,D.z,D.x,D.y+1),A(j,Se,D.z,Ee,D.y+1)))}}const P=[];for(const M of _)_.some(z=>M.isChildOf(z))||P.push(M);if(_=P.filter(M=>!i.some(z=>!!(M.overscaledZ<l&&z.isChildOf(M))||M.equals(z)||M.isChildOf(z))),w){const M=1<<l,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),D=[M*z.x,M*z.y],j=4,V=j*j;_=_.filter(G=>{const te=G.canonical.x+.5-D[0],K=G.canonical.y+.5-D[1];return te*te+K*K<V})}return _}extendTileCoverToNearPlane(i,l,d){const _=[],y=new Set;for(const oe of i)y.add(oe.key);const w=(oe,he,ge,Se,be)=>{const Ee=a.cX(he,oe,ge,Se,be);y.has(Ee)||(_.push(new a.aO(oe,he,ge,Se,be)),y.add(Ee))},S=i.reduce((oe,he)=>Math.max(oe,he.overscaledZ),d),A=1<<d,P=[new a.P(0,0),new a.P(a.al,0),new a.P(a.al,a.al),new a.P(0,a.al)],M=new a.P(0,0),z=new a.P(0,0),D=(oe,he)=>{const ge=Math.floor(oe[0]),Se=Math.floor(oe[1]),be=(oe[0]-ge)*a.al,Ee=(oe[1]-Se)*a.al,Te=Math.floor(he[0]),we=Math.floor(he[1]),Ae=(he[0]-Te)*a.al,qe=(he[1]-we)*a.al;for(let Ne=-1;Ne<=1;Ne++){const rt=ge+Ne;if(!(rt<0||rt>=A)){M.x=be-Ne*a.al,z.x=Ae-(rt-Te)*a.al;for(let $e=-1;$e<=1;$e++){const Qe=Se+$e;M.y=Ee-$e*a.al,z.y=qe-(Qe-we)*a.al,a.cY(M,z,P)&&w(S,0,d,rt,Qe)}}}},j=l.points,V=j[a.cu],G=j[a.cv],te=this._projectToGround(V,j[a.cw]),K=this._projectToGround(G,j[a.cx]);return D(V,te),D(G,K),_}_projectToGround(i,l){return a.cy(a.cz(),i,l,i[2]/(i[2]-l[2]))}coveringTiles(i){let l=this.coveringZoomLevel(i);const d=l,_=this.elevation&&this.elevation.exaggeration(),y=_&&!i.isTerrainDEM,w=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,P=1<<l,M=[P*S.x,P*S.y,0],z=this.projection.name==="globe",D=!z,j=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,D),V=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=P*a.ce(1,this.center.lat),te=this._camera.position[2]/a.ce(1,this.center.lat),K=[P*V.x,P*V.y,te*(D?1:G)],oe=z||_,he=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),ge=this.isLODDisabled(!0)?l:0;let Se;if(this._elevation&&i.isTerrainDEM)Se=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();Se=Oe?Oe.max:this._centerAltitude}else Se=this._centerAltitude;const be=i.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?a.cB(this):1,Te=Oe=>{const Xe=new a.ae(Oe.x+25e-6,Oe.y,Oe.z),gt=new a.ae(Oe.x,Oe.y+25e-6,Oe.z),Ct=Oe.toLngLat(),jt=Xe.toLngLat(),St=gt.toLngLat(),xt=this.locationCoordinate(Ct),lr=this.locationCoordinate(jt),tr=this.locationCoordinate(St),nr=Math.hypot(lr.x-xt.x,lr.y-xt.y),er=Math.hypot(tr.x-xt.x,tr.y-xt.y);return Math.sqrt(nr*er)*Ee/25e-6},we=Oe=>{const ot=Se,Xe=be;return{aabb:a.cE(this,P,0,0,0,Oe,Xe,ot,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:ot,wrap:Oe,fullyVisible:!1}},Ae=[];let qe=[];const Ne=l,rt=i.reparseOverscaled?d:l,$e=(te-this._centerAltitude)*G,Qe=Oe=>{if(!this._elevation||!Oe.tileID||!w)return;const ot=this._elevation.getMinMaxForTile(Oe.tileID),Xe=Oe.aabb;ot?(Xe.min[2]=ot.min,Xe.max[2]=ot.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(Oe.shouldSplit=We(Oe),Oe.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},kt=(Oe,ot)=>{if(.707*ot<Oe)return 1;const Xe=ot/Oe;return Xe/(1.4144271570014144+(Math.pow(1.1,Xe-1.4144271570014144+1)-1)/(1.1-1)-1)},We=Oe=>{if(Oe.zoom<ge)return!0;if(Oe.zoom===Ne)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const ot=Oe.aabb.distanceX(K),Xe=Oe.aabb.distanceY(K);let gt=$e,Ct=1;if(z){gt=Oe.aabb.distanceZ(K);const er=Math.pow(2,Oe.zoom),Rr=a.a$((Oe.y+1)/er),Br=a.a$(Oe.y/er),$r=Math.min(Math.max(A,Rr),Br),xi=a.d0($r)/a.d0(A);if(Ct=$r===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xi/this._mercatorScaleRatio),this.zoom<=a.cZ&&Oe.zoom===Ne-1&&xi>=.9)return!0}else if(y&&(gt=Oe.aabb.distanceZ(K)*G),this.projection.isReprojectedInTileSpace&&d<=5){const er=Math.pow(2,Oe.zoom),Rr=Te(new a.ae((Oe.x+.5)/er,(Oe.y+.5)/er));Ct=Rr>.85?1:Rr}if(!w){const er=Math.sqrt(ot*ot+Xe*Xe+gt*gt);let Rr=(1<<Ne-Oe.zoom)*he*Ct;return Rr*=kt(Math.max(gt,$e),er),er<Rr}let jt=Number.MAX_VALUE,St=0;const xt=Oe.aabb.getCorners(),lr=[];for(const er of xt){a.av(lr,er,K),z||(y?lr[2]*=G:lr[2]=$e);const Rr=a.bJ(lr,this._camera.forward());Rr<jt&&(jt=Rr,St=Math.abs(lr[2]))}let tr=(1<<Ne-Oe.zoom)*he*Ct;if(tr*=kt(Math.max(St,$e),jt),jt<tr)return!0;const nr=Oe.aabb.closestPoint(M);return nr[0]===M[0]&&nr[1]===M[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ae.push(we(-Oe)),Ae.push(we(Oe));for(Ae.push(we(0));Ae.length>0;){const Oe=Ae.pop(),ot=Oe.x,Xe=Oe.y;let gt=Oe.fullyVisible;const Ct=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!gt){let jt=oe?Oe.aabb.intersects(j):Oe.aabb.intersectsFlat(j);if(jt===0&&Ct()){const St=new a.cC(Oe.zoom,ot,Xe);jt=a.cD(this,P,St,!0).intersects(j)}if(jt===0)continue;gt=jt===2}if(Oe.zoom!==Ne&&We(Oe))for(let jt=0;jt<4;jt++){const St=(ot<<1)+jt%2,xt=(Xe<<1)+(jt>>1),lr={aabb:w?Oe.aabb.quadrant(jt):a.cE(this,P,Oe.zoom+1,St,xt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:St,y:xt,wrap:Oe.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};y&&!z&&(lr.tileID=new a.aO(Oe.zoom+1===Ne?rt:Oe.zoom+1,Oe.wrap,Oe.zoom+1,St,xt),Qe(lr)),Ae.push(lr)}else{const jt=Oe.zoom===Ne?rt:Oe.zoom;if(i.minzoom&&i.minzoom>jt)continue;let St=0;if(!gt){let nr=oe?Oe.aabb.intersectsPrecise(j):Oe.aabb.intersectsPreciseFlat(j);if(nr===0&&Ct()){const er=new a.cC(Oe.zoom,ot,Xe);nr=a.cD(this,P,er,!0).intersectsPrecise(j)}if(nr===0)continue;if(i.calculateQuadrantVisibility)if(j.containsPoint(Oe.aabb.center))St=15;else for(let er=0;er<4;er++)Oe.aabb.quadrant(er).intersects(j)!==0&&(St|=1<<er)}const xt=M[0]-(.5+ot+(Oe.wrap<<Oe.zoom))*(1<<l-Oe.zoom),lr=M[1]-.5-Xe,tr=Oe.tileID?Oe.tileID:new a.aO(jt,Oe.wrap,Oe.zoom,ot,Xe);i.calculateQuadrantVisibility&&(tr.visibleQuadrants=St),qe.push({tileID:tr,distanceSq:xt*xt+lr*lr})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,ot=this.horizonLineFromTop();qe=qe.filter(Xe=>{const gt=[0,0,0,1],Ct=[a.al,a.al,0,1],jt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());a.aC(gt,gt,jt),a.aC(Ct,Ct,jt);const St=a.cF([],gt,Ct),xt=a.cG([],gt,Ct),lr=a.c_(St,xt);if(lr===0)return!0;let tr=!1;const nr=this._elevation;if(nr&&lr>Oe&&ot!==0){const er=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let Rr;i.isTerrainDEM||(Rr=nr.getMinMaxForTile(Xe.tileID)),Rr||(Rr={min:be,max:Se});const Br=a.cH(this.rotation),$r=[Br[0]*a.al,Br[1]*a.al,Rr.max];a.af($r,$r,er),tr=(1-$r[1])*this.height*.5<ot}return lr<Oe||tr})}return qe.sort((Oe,ot)=>Oe.distanceSq-ot.distanceSq).map(Oe=>Oe.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log2(i)}project(i){const l=a.aA(i.lat,-a.cI,a.cI),d=this.projection.project(i.lng,l);return new a.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let d,_;const y=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;d=(l.x-y.x)/S,_=(l.y-y.y)/S}else{const S=this.pointCoordinate(l),A=this.pointCoordinate(y);d=S.x-A.x,_=S.y-A.y}const w=this.locationCoordinate(i);this.setLocation(new a.ae(w.x-d,w.y-_))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i,l){return this.projection.locationPoint(this,i,l)}locationPoint3D(i,l){return this.projection.locationPoint(this,i,l,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i,l){return this.coordinateLocation(this.pointCoordinate3D(i,l))}locationCoordinate(i,l){const d=l?a.ce(l,i.lat):void 0,_=this.projection.project(i.lng,i.lat);return new a.ae(_.x,_.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const d=l??this._centerAltitude,_=[i.x,i.y,0,1],y=[i.x,i.y,1,1];a.aC(_,_,this.pixelMatrixInverse),a.aC(y,y,this.pixelMatrixInverse);const w=y[3];a.cJ(_,_,1/_[3]),a.cJ(y,y,1/w);const S=_[2],A=y[2];return{p0:_,p1:y,t:S===A?0:(d-S)/(A-S)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return a.aC(l,l,this.pixelMatrixInverse),a.aC(d,d,this.pixelMatrixInverse),a.cJ(l,l,1/l[3]),a.cJ(d,d,1/d[3]),l[2]=a.ce(l[2],this._center.lat)*this.worldSize,d[2]=a.ce(d[2],this._center.lat)*this.worldSize,a.cJ(l,l,1/this.worldSize),a.cJ(d,d,1/this.worldSize),new a.ax([l[0],l[1],l[2]],a.aw([],a.av([],d,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:d,t:_}=i,y=a.ce(l[2],this._center.lat),w=a.ce(d[2],this._center.lat);return new a.ae(a.ak(l[0],d[0],_)/this.worldSize,a.ak(l[1],d[1],_)/this.worldSize,a.ak(y,w,_))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i,l){if(!this.elevation)return this.pointCoordinate(i,l);let d=this.projection.pointCoordinate3D(this,i.x,i.y);if(d)return new a.ae(d[0],d[1],d[2]);let _=0,y=this.horizonLineFromTop();if(i.y>y)return this.pointCoordinate(i,l);const w=.02*y,S=i.clone();for(let A=0;A<10&&y-_>w;A++){S.y=a.ak(_,y,.66);const P=this.projection.pointCoordinate3D(this,S.x,S.y);P?(y=S.y,d=P):_=S.y}return d?new a.ae(d[0],d[1],d[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=a.cK)return!this.isPointAboveHorizon(i);const l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){const d=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,_=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return a.aC(_,_,this.pixelMatrix),_[3]>0?new a.P(_[0]/_[3],_[1]/_[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:l}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new a.P(l,i)),w=this.pointLocation3D(new a.P(_,i)),S=this.pointLocation3D(new a.P(_,d)),A=this.pointLocation3D(new a.P(l,d));let P=Math.min(y.lng,w.lng,S.lng,A.lng),M=Math.max(y.lng,w.lng,S.lng,A.lng),z=Math.min(y.lat,w.lat,S.lat,A.lat),D=Math.max(y.lat,w.lat,S.lat,A.lat);const j=Math.pow(2,-this.zoom)/16*270,V=this.projection.name==="globe"?1:4,G=(te,K,oe,he,ge)=>{const Se=(te+oe)/2,be=(K+he)/2,Ee=new a.P(Se,be),{lng:Te,lat:we}=this.pointLocation3D(Ee),Ae=Math.max(0,P-Te,z-we,Te-M,we-D);P=Math.min(P,Te),M=Math.max(M,Te),z=Math.min(z,we),D=Math.max(D,we),(ge<V||Ae>j)&&(G(te,K,Se,be,ge+1),G(Se,be,oe,he,ge+1))};if(G(l,i,_,i,1),G(_,i,_,d,1),G(_,d,l,d,1),G(l,d,l,i,1),this.projection.name==="globe"){const[te,K]=a.cL(this);te?(D=90,M=180,P=-180):K&&(z=-90,M=180,P=-180)}return new a.aI(new a.aR(P,z),new a.aR(M,D))}_getBoundsRectangular(i,l){const{top:d,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=new a.P(_,d),A=new a.P(w,d),P=new a.P(w,y),M=new a.P(_,y);let z=this.pointCoordinate(S,i),D=this.pointCoordinate(A,i);const j=this.pointCoordinate(P,l),V=this.pointCoordinate(M,l),G=(te,K)=>(K.y-te.y)/(K.x-te.x);return z.y>1&&D.y>=0?z=new a.ae((1-V.y)/G(V,z)+V.x,1):z.y<0&&D.y<=1&&(z=new a.ae(-V.y/G(V,z)+V.x,0)),D.y>1&&z.y>=0?D=new a.ae((1-j.y)/G(j,D)+j.x,1):D.y<0&&z.y<=1&&(D=new a.ae(-j.y/G(j,D)+j.x,0)),new a.aI().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=i.visibleDemTiles.reduce((d,_)=>{if(_.dem){const y=_.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-a.cI,this.maxLat=a.cI,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aF(this.minLng)*this.tileSize,this.worldMaxX=a.aF(this.maxLng)*this.tileSize,this.worldMinY=a.aJ(this.maxLat)*this.tileSize,this.worldMaxY=a.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,d=this._distanceTileDataCache;if(d[l])return d[l];const _=i.canonical,y=1/this.height,w=this.cameraWorldSize,S=w/this.zoomScale(_.z),A=(_.x+Math.pow(2,_.z)*i.wrap)*S,P=_.y*S,M=this.point;M.x*=w/this.worldSize,M.y*=w/this.worldSize;const z=this.angle,D=Math.sin(-z),j=-Math.cos(-z);return d[l]={bearing:[D,j],center:[(M.x-A)*y,(M.y-P)*y],scale:S/a.al*y},d[l]}calculateFogTileMatrix(i){const l=i.key,d=this._fogTileMatrixCache;if(d[l])return d[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return a.aB(_,this.worldToFogMatrix,_),d[l]=new Float32Array(_),d[l]}calculateProjMatrix(i,l=!1,d=!1){const _=i.key;let y;if(y=d?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const w=this.calculatePosMatrix(i,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,a.aB(w,S,w),y[_]=new Float32Array(w),y[_]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[l])return d[l];const _=a.cM(i,this);return d[l]=_,d[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,l=a.bq([],[i,i,i]);return a.aB(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const l=a.ce(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(l),_=this._camera.forward(),y=a.ce(1,this._center.lat);d[2]/=y,_[2]/=y,a.aw(_,_);const w=i.raycast(d,_,i.exaggeration());if(w){const S=a.bH([],d,_,w),A=new a.ae(S[0],S[1],a.ce(S[2],a.a$(S[1]))),P=(A.z+a.ag([A.x-d[0],A.y-d[1],A.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const l=this._elevation,d=a.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),y=l.getAtPointOrZero(new a.ae(..._)),w=this.pixelsPerMeter/this.worldSize*y,S=this._minimumHeightOverTerrain(),A=_[2]-w;if(A<=S)if(A<0||i){const P=this.locationCoordinate(this._center,this._centerAltitude),M=[_[0],_[1],P.z-_[2]],z=a.ag(M);M[2]-=(S-A)/this._pixelsPerMercatorPixel;const D=a.ag(M);if(D===0)return;a.c4(M,M,z/D*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],P.z*this._pixelsPerMercatorPixel-M[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const D=this.center;return D.lat=a.aA(D.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(D.lng=a.aA(D.lng,this.minLng,this.maxLng)),this.center=D,void(this._constraining=!1)}const l=this._unmodified,{x:d,y:_}=this.point;let y=0,w=d,S=_;const A=this.width/2,P=this.height/2,M=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(_-P<M&&(S=M+P),_+P>z&&(S=z-P),z-M<this.height&&(y=Math.max(y,this.height/(z-M)),S=(z+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const D=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,V=this.worldSize/2-(D+j)/2;w=(d+V+this.worldSize)%this.worldSize-V,w-A<D&&(w=D+A),w+A>j&&(w=j-A),j-D<this.width&&(y=Math.max(y,this.width/(j-D)),w=(j+D)/2)}w===d&&S===_||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(w,S))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ce(1,this.center.lat)/a.ce(1,a.d1));const _=a.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,y);let S;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-i.x/this.width,A[9]=2*i.y/this.height,this.isOrthographic){let we=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=we*this.aspect,qe=-Ae,Ne=-we;Ae-=i.x,qe-=i.x,we+=i.y,Ne+=i.y,S=this._camera.getCameraToClipOrthographic(qe,Ae,Ne,we,this._nearZ,this._farZ),((rt,$e,Qe,kt)=>{for(let We=0;We<16;We++)rt[We]=a.ak($e[We],Qe[We],kt)})(S,S,A,a.c$(this.pitch>=Xa?1:this.pitch/Xa))}else S=A;const P=a.cO([],A,w);let M=a.cO([],S,w);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),Ae=a.bA([]);a.br(Ae,Ae,[we.x*this.worldSize,we.y*this.worldSize,0]),a.aB(Ae,Ae,a.cP(this)),a.br(Ae,Ae,[-we.x*this.worldSize,-we.y*this.worldSize,0]),a.aB(M,M,Ae),a.aB(P,P,Ae),this.inverseAdjustmentMatrix=a.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cR([],M,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=M,this.invProjMatrix=a.bl(new Float64Array(16),this.projMatrix),l){const we=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);we[8]=2*-i.x/this.width,we[9]=2*i.y/this.height,this.expandedFarZProjMatrix=a.cO([],we,w)}else this.expandedFarZProjMatrix=this.projMatrix;const z=a.bl([],S);this.frustumCorners=a.cS.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const D=new Float32Array(16);a.bA(D),a.cR(D,D,[1,-1,1]),a.cT(D,D,this._pitch),a.bB(D,D,this.angle);const j=a.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.bz(j);const V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-i.x/this.width,j[9]=2*(i.y+V)/this.height,this.skyboxMatrix=a.aB(D,j,D);const G=this.point,te=G.x,K=G.y,oe=this.width%2/2,he=this.height%2/2,ge=Math.cos(this.angle),Se=Math.sin(this.angle),be=te-Math.round(te)+ge*oe+Se*he,Ee=K-Math.round(K)+ge*he+Se*oe,Te=new Float64Array(M);if(a.br(Te,Te,[be>.5?be-1:be,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=Te,M=a.bC(),a.cR(M,M,[this.width/2,-this.height/2,1]),a.br(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=a.bC(),a.cR(M,M,[1,-1,1]),a.br(M,M,[-1,-1,0]),a.cR(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=a.aB(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},M=a.bl(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cU(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.af(we,we,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[i,i,l];a.c4(y,y,_),a.c4(d,d,-1),a.cV(d,d,y);const w=a.bC();a.br(w,w,d),a.cR(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,_)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*y,_.y/this.worldSize-d[1]*y,i/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=i[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((l-d)/_,1)),this._camera.position=a.bH([],this._camera.position,i,y),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),y=a.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.an(this._maxPitch)),S=Math.max((i[2]-y)/Math.cos(d),w),A=this._zoomFromMercatorZ(S);a.bH(i,i,l,S),this._pitch=a.aA(d,a.an(this.minPitch),a.an(this.maxPitch)),this.angle=a.bT(_,-Math.PI,Math.PI),this._setZoom(a.aA(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ae(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,i)*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,d=a.cK,_=0,y=1/0;for(;d-l>1e-6&&d>l;){const w=l+.5*(d-l),S=this.tileSize*Math.pow(2,w),A=this.getCameraToCenterDistance(this.projection,w,S),P=this.scaleZoom(A/(Math.max(0,i)*this.tileSize)),M=Math.abs(w-P);M<y&&(y=M,_=w),w<P?l=w:d=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const d=Math.min(i.x,l.x),_=Math.max(i.x,l.x),y=Math.min(i.y,l.y),w=Math.max(i.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new a.P(d,y),new a.P(_,w),new a.P(d,w),new a.P(_,y)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const M of S){const z=this.pointRayIntersection(M);if(z.t<0)return!0;const D=this.rayIntersectionCoordinate(z);if(D.x<A||D.y<0||D.x>P||D.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(i,l){const d=a.ag(a.av([],this._camera.position,i)),_=this._zoomFromMercatorZ(d)+l;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([l,d,_],y){const w=[l,d,_,1];a.aC(w,w,y);const S=w[3]=Math.max(w[3],1e-6);return w[0]/=S,w[1]/=S,w[2]/=S,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,i))}}getCameraToCenterDistance(i,l=this.zoom,d=this.worldSize){const _=a.cN(i,l,this.width,this.height,1024),y=i.pixelSpaceConversion(this.center.lat,d,_);let w=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(w=a.ak(1,w,a.c$(this.pitch>=Xa?1:this.pitch/Xa))),w}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.aB(i,i,this.globeMatrix),i}getFrustum(i){return a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Pl=(f,i)=>{if(i>0&&f.terrain&&a.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=f.transform,d=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),_=l.isLODDisabled(!1)?a.ah(60,45,l.pitch):a.ah(30,15,l.pitch),y=l._farZ-l._nearZ,w=i*l.height,S=((1-(A=_))*l.cameraToCenterDistance+A*(l._farZ+w))*d;var A;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(S-l._nearZ)/y,(S-w-l._nearZ)/y]}}},ls={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class W_{constructor(i,l){this.aabb=i,this.lastCascade=l}}class zh{add(i,l){const d=this.receivers[i.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],l.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],l.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],l.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],l.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],l.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],l.max[2])):this.receivers[i.key]=new W_(l,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,l,d){const _=a.d8.fromPoints(i.points);let y=0;for(const w in this.receivers){const S=this.receivers[w];if(!S||!_.intersectsAabb(S.aabb))continue;S.aabb.min=_.closestPoint(S.aabb.min),S.aabb.max=_.closestPoint(S.aabb.max);const A=S.aabb.getCorners();for(let P=0;P<d.length;P++){let M=!0;for(const z of A){const D=[z[0]*l,z[1]*l,z[2]];if(a.af(D,D,d[P].matrix),D[0]<-1||D[0]>1||D[1]<-1||D[1]>1){M=!1;break}}if(S.lastCascade=P,y=Math.max(y,P),M)break}}return y+1}}class z1{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new zh,this._depthMode=new Ht(i.context.gl.LEQUAL,Ht.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(ls,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(ls,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(ls,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,l){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const _=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce((V,G)=>{const te=d.style._mergedLayers[G];return V+(te.hasShadowPass()&&!te.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=d.context,w=ls.shadowMapResolution,S=ls.shadowMapResolution;if(this._cascades.length===0||ls.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let V=0;V<ls.cascadeCount;++V){const G=d._shadowMapDebug,te=y.gl,K=y.createFramebuffer(w,S,G,"texture"),oe=new a.T(y,{width:w,height:S,data:null},te.DEPTH_COMPONENT16);if(K.depthAttachment.set(oe.texture),G){const he=new a.T(y,{width:w,height:S,data:null},te.RGBA8);K.colorAttachment.set(he.texture)}this._cascades.push({framebuffer:K,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cA,scale:0})}}this.shadowDirection=hu(l);let A=0;if(i.elevation){const V=i.elevation,G=[1e4,-1e4];V.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const K=te.dem.tree;G[0]=Math.min(G[0],K.minimums[0]),G[1]=Math.max(G[1],K.maximums[0])}),G[0]!==1e4&&(A=(G[1]-G[0])*V.exaggeration())}const P=1.5*i.cameraToCenterDistance,M=3*P,z=new Float64Array(16);for(let V=0;V<this._cascades.length;++V){const G=this._cascades[V];let te=i.height/50,K=1;ls.cascadeCount===1?K=M:V===0?K=P:(te=P,K=M);const[oe,he]=B1(i,this.shadowDirection,te,K,ls.shadowMapResolution,A);G.scale=i.scale,G.matrix=oe,G.boundingSphereRadius=he,a.bl(z,G.matrix),G.frustum=a.cA.fromInvProjectionMatrix(z,1,0,!0),G.far=K}const D=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[D].far,this._cascades[D].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ls.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ls.shadowMapResolution,this._uniformValues.u_shadowmap_0=wn.ShadowMap0,this._uniformValues.u_shadowmap_1=wn.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=d.transform.elevation;for(const V of this._groundShadowTiles){let G={min:0,max:0};if(j){const te=j.getMinMaxForTile(V);te&&(G=te)}this.addShadowReceiver(V.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,l){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,ls.shadowMapResolution,ls.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:a.ao.white,depth:1});for(const w of i.order){const S=i._mergedLayers[w];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;const A=i.getLayerSourceCache(S),P=A?l[A.id]:void 0;(S.type==="model"||P&&P.length)&&d.renderLayer(d,A,S,P)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,l=i.style,d=i.context,_=d.gl,y=l.directionalLight,w=l.ambientLight;if(!y||!w)return;const S=[],A=Pl(i,i.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const P=oa(l,y,w),M=new Ht(_.LEQUAL,Ht.ReadOnly,i.depthRangeFor3D),z=new Sr({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const D of this._groundShadowTiles){const j=D.toUnwrapped(),V=i.isTileAffectedByFog(D),G=i.getOrCreateProgram("groundShadow",{defines:S,overrideFog:V});this.setupShadows(j,G),i.uploadCommonUniforms(d,G,j,null,A);const te={u_matrix:i.transform.calculateProjMatrix(j),u_ground_shadow_factor:P};G.draw(i,_.TRIANGLES,M,z,Ur.multiply,Pr.disabled,te,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,null,i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ur.unblended:Ur.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const l=this.painter.transform,d=l.calculatePosMatrix(i,l.worldSize);return a.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(i){return a.aB(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,l,d){if(!this.enabled)return;const _=this.painter.transform,y=this.painter.context,w=y.gl,S=this._uniformValues,A=new Float64Array(16),P=_.calculatePosMatrix(i,_.worldSize);for(let M=0;M<this._cascades.length;M++)a.aB(A,this._cascades[M].matrix,P),S[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(w.TEXTURE0+wn.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const M=a.d6(i.canonical),z=2/_.tileSize*a.al/ls.shadowMapResolution,D=z*this._cascades[0].boundingSphereRadius,j=z*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(d==="vector-tile"?1:3)*function(G,te,K,oe,he){const ge=a.aA((G-22)/-22,0,1);return .125*(1-ge)+4*ge}(_.zoom);S.u_shadow_normal_offset=[M,D*V,j*V],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,S)}setupShadowsFromMatrix(i,l,d=!1){if(!this.enabled)return;const _=this.painter.context,y=_.gl,w=this._uniformValues,S=new Float64Array(16);for(let A=0;A<ls.cascadeCount;A++)a.aB(S,this._cascades[A].matrix,i),w[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),_.activeTexture.set(y.TEXTURE0+wn.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=d,d){const A=ls.normalOffset;w.u_shadow_normal_offset=[1,A,A],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,l,d,_){if(_[2]>=0)return{};const y=function(A,P,M){const z=M/(1<<A.canonical.z);return new a.d8([A.canonical.x*z+A.wrap*M,A.canonical.y*z+A.wrap*M,0],[(A.canonical.x+1)*z+A.wrap*M,(A.canonical.y+1)*z+A.wrap*M,P])}(i,l,d).getCorners(),w=l/-_[2];_[0]<0?(a.d7(y[0],y[0],[_[0]*w,0,0]),a.d7(y[3],y[3],[_[0]*w,0,0])):_[0]>0&&(a.d7(y[1],y[1],[_[0]*w,0,0]),a.d7(y[2],y[2],[_[0]*w,0,0])),_[1]<0?(a.d7(y[0],y[0],[0,_[1]*w,0]),a.d7(y[1],y[1],[0,_[1]*w,0])):_[1]>0&&(a.d7(y[2],y[2],[0,_[1]*w,0]),a.d7(y[3],y[3],[0,_[1]*w,0]));const S={};return S.vertices=y,S.planes=[lf(y[1],y[0],y[4]),lf(y[2],y[1],y[5]),lf(y[3],y[2],y[6]),lf(y[0],y[3],y[7])],S}addShadowReceiver(i,l,d){this._receivers.add(i,a.d8.fromTileIdAndHeight(i,l,d))}getMaxCascadeForTile(i){const l=this._receivers.get(i);return l&&l.lastCascade?l.lastCascade:0}}function lf(f,i,l){const d=a.av([],l,i),_=a.av([],f,i),y=a.bI([],d,_),w=a.ag(y);return w===0?[0,0,1,0]:(a.c4(y,y,1/w),[y[0],y[1],y[2],-a.bJ(y,i)])}function hu(f){const i=f.properties.get("direction"),l=a.d3(i.x,i.y,i.z);l[2]=a.aA(l[2],0,75);const d=a.d5([l[0],l[1],l[2]]);return a.d4(d.x,d.y,d.z)}function oa(f,i,l){const d=i.properties.get("color-use-theme")==="none",_=i.properties.get("color"),y=i.properties.get("intensity"),w=i.properties.get("direction"),S=[w.x,w.y,w.z],A=l.properties.get("color-use-theme")==="none",P=l.properties.get("color"),M=l.properties.get("intensity"),z=Math.max(a.bJ([0,0,1],S),0),D=[0,0,0];a.c4(D,P.toPremultipliedRenderColor(A?null:f.getLut(i.scope)).toArray01Linear().slice(0,3),M);const j=[0,0,0];return a.c4(j,_.toPremultipliedRenderColor(d?null:f.getLut(l.scope)).toArray01Linear().slice(0,3),z*y),a.da([D[0]>0?D[0]/(D[0]+j[0]):0,D[1]>0?D[1]/(D[1]+j[1]):0,D[2]>0?D[2]/(D[2]+j[2]):0])}function B1(f,i,l,d,_,y){const w=f.zoom,S=f.scale,A=f.worldSize,P=1/A,M=f.aspect,z=Math.sqrt(1+M*M)*Math.tan(.5*f.fovX),D=z*z,j=d-l,V=d+l;let G,te;D>j/V?(G=d,te=d*z):(G=.5*V*(1+D),te=.5*Math.sqrt(j*j+2*(d*d+l*l)*D+V*V*D*D));const K=f.projection.pixelsPerMeter(f.center.lat,A),oe=f._camera.getCameraToWorldMercator(),he=[0,0,-G*P];a.af(he,he,oe);let ge=te*P;const Se=f._edgeInsets;if(!(Se.left===0&&Se.top===0&&Se.right===0&&Se.bottom===0||Se.left===Se.right&&Se.top===Se.bottom)){const gt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?K:1),Ct=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,d);Ct[8]=2*-f.centerOffset.x/f.width,Ct[9]=2*f.centerOffset.y/f.height;const jt=new Float64Array(16);a.cO(jt,Ct,gt);const St=new Float64Array(16);a.bl(St,jt);const xt=a.cA.fromInvProjectionMatrix(St,A,w,!0);for(const lr of xt.points){const tr=((be=lr)[0]/=S,be[1]/=S,be[2]=a.ce(be[2],f._center.lat),be);ge=Math.max(ge,a.c5(a.d9([],he,tr)))}}var be;ge*=_/(_-1);const Ee=Math.acos(i[2]),Te=Math.atan2(-i[0],-i[1]),we=new af;we.position=he,we.setPitchBearing(Ee,Te);const Ae=we.getWorldToCamera(A,K),qe=ge*A,Ne=Math.min(f._mercatorZfromZoom(17)*A*-2,-2*qe),rt=we.getCameraToClipOrthographic(-qe,qe,-qe,qe,Ne,(qe+y*K)/i[2]),$e=new Float64Array(16);a.aB($e,rt,Ae);const Qe=a.d4(Math.floor(1e6*he[0])/1e6*A,Math.floor(1e6*he[1])/1e6*A,0),kt=.5*_,We=[0,0,0];a.af(We,Qe,$e),a.c4(We,We,kt);const Oe=[Math.floor(We[0]),Math.floor(We[1]),Math.floor(We[2])],ot=[0,0,0];a.av(ot,We,Oe),a.c4(ot,ot,-1/kt);const Xe=new Float64Array(16);return a.bA(Xe),a.br(Xe,Xe,ot),a.aB($e,Xe,$e),[$e,qe]}class du extends a.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(i,l){return a.aV(this.requestManager.transformRequest(l,a.R.Model).url).then(d=>{if(!d)return;const _=a.aW(d),y=new a.aX(i,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new a.y(new Error(`Could not load model ${i} from ${l}: ${d.message}`)))})}load(i,l,d={forceReload:!1}){this.models[l]||(this.models[l]={});const _=Object.keys(i),y=[],w=[];for(const S of _){const A=i[S];this.hasURLBeenRequested(A)&&!d.forceReload||(this.modelByURL[A]={modelId:S,scope:l},y.push(this.loadModel(S,A)),w.push(S)),this.models[l][S]||(this.models[l][S]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+w.length,Promise.allSettled(y).then(S=>{for(let A=0;A<S.length;A++){const{status:P}=S[A];if(P==="rejected")continue;const{value:M}=S[A];this.models[l][w[A]]||(this.models[l][w[A]]={model:null,numReferences:1}),this.models[l][w[A]].model=M}this.numModelsLoading[l]-=w.length,this.fire(new a.z("data",{dataType:"style"}))}).catch(S=>{this.fire(new a.y(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,l,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(i,l):this.getModelByURL(this.modelUris[l][i]))}getModel(i,l){return this.models[l]||(this.models[l]={}),this.models[l][i]?this.models[l][i].model:void 0}getModelByURL(i){if(!i)return null;const l=this.modelByURL[i];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(i,l){return this.models[l]&&this.models[l][i]!==void 0}getModelURIs(i){return this.modelUris[i]||{}}addModel(i,l,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.requestManager.normalizeModelURL(l);if((this.hasModel(i,d,{exactIdMatch:!0})||this.hasModelBeenAdded(i,d))&&this.modelUris[d][i]===_)this.models[d][i].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:y,modelId:w}=this.modelByURL[_];this.models[y][w].numReferences++}else this.modelUris[d][i]=_,this.load({[i]:this.modelUris[d][i]},d)}addModelURLs(i,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d=this.modelUris[l];for(const _ in i)d[_]=this.requestManager.normalizeModelURL(i[_])}reloadModels(i){this.load(this.modelUris[i],i,{forceReload:!0})}addModelsFromBucket(i,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d={};for(const _ of i)this.hasModel(_,l,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[l][_].numReferences++:this.modelUris[l][_]&&!this.hasURLBeenRequested(_)?d[_]=this.modelUris[l][_]:!this.hasURLBeenRequested(_)&&a.db(_,!1)&&(this.modelUris[l][_]=this.requestManager.normalizeModelURL(_),d[_]=this.modelUris[l][_]);this.load(d,l)}hasURLBeenRequested(i){return this.modelByURL[i]!==void 0}removeModel(i,l,d=!1,_=!1){if(this.models[l]&&this.models[l][i]&&(this.models[l][i].numReferences--,this.models[l][i].numReferences===0||_)){const y=this.modelUris[l][i];d||delete this.modelUris[l][i],delete this.modelByURL[y];const w=this.models[l][i].model;if(!w)return;delete this.models[l][i],w.destroy()}}destroy(){for(const i of Object.keys(this.models))for(const l of Object.keys(this.models[i])){const d=this.models[i][l].model;delete this.models[i][l],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,l){this.models[l]||(this.models[l]={});for(const d in this.models[l])this.models[l][d].model&&this.models[l][d].model.upload(i.context)}}const q_=new a.a9({data:new a.aa(a.a6.colorTheme.data)});function cf(f){if(!f.metadata||!f.metadata.content_area)return;const i=a.o.devicePixelRatio,{left:l,top:d,width:_,height:y}=f.metadata.content_area,w=l*i,S=d*i;return[w,S,w+_*i,S+y*i]}function uf(f){if(f)return f.map(([i,l])=>[i*a.o.devicePixelRatio,l*a.o.devicePixelRatio])}class kl{constructor(i,l,d){this.id=i,this.scope=l,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(i){this.missingRequests.has(i.name)||this.pendingRequests.has(i.name)||this.pendingRequests.add(i.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const i=new Map;if(!this.sourceCache.loaded())return i;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return i;const d=this.sourceCache.getSource();if(!(d instanceof Tl))return i;const _=l.map(w=>this.sourceCache.getTile(w)),y=d.getImages(_,Array.from(this.pendingRequests));for(const[w,S]of y)i.set(a.I.from({name:w,iconsetId:this.id}),S),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),i}}const dc=(f,i)=>U(f,i&&i.filter(l=>l.identifier!=="source.canvas")),j1=a.aH(oi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),U1=a.aH(oi,["setCenter","setZoom","setBearing","setPitch"]),hf=new Set(["background","sky","slot","custom"]),Z_={version:8,layers:[],sources:{}},df={duration:300,delay:0};class Bo extends a.E{constructor(i,l={}){super(),this.map=i,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=Object.assign({},df),this._buildingIndex=new Xd(this),this.crossTileSymbolIndex=new Gn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new Ln,this.dispatcher=l.dispatcher?l.dispatcher:new a.D(a.dd(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Pi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new a.de(i._requestManager,l.localFontFamily?a.df.all:l.localIdeographFontFamily?a.df.ideographs:a.df.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new du(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",a.dg());const d=this;this._rtlTextPluginCallback=Bo.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,w)=>{if(a.dh(y),w&&w.every(S=>S))for(const S in d._sourceCaches){const A=d._sourceCaches[S],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===y.id&&this._validateLayer(S)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(a.h(i))return i;const l=a.di(i);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${a.dj(JSON.stringify(i))}`}_diffStyle(i,l,d){this.globalId=this._getGlobalId(i);const _=(y,w)=>{try{w(null,this.setState(y,d))}catch(S){w(S,!1)}};if(typeof i=="string"){const y=this.map._requestManager.normalizeStyleURL(i),w=this.map._requestManager.transformRequest(y,a.R.Style);a.m(w,(S,A)=>{S?this.fire(new a.y(S)):A&&_(A,l)})}else typeof i=="object"&&_(i,l)}loadURL(i,l={}){this.fire(new a.z("dataloading",{dataType:"style"}));const d=typeof l.validate=="boolean"?l.validate:!a.h(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,l.accessToken),this.resolvedImports.add(i);const _=this.importsCache.get(i);if(_)return this._load(_,d);const y=this.map._requestManager.transformRequest(i,a.R.Style);this._request=a.m(y,(w,S)=>{if(this._request=null,w)this.fire(new a.y(w));else if(S)return this.importsCache.set(i,S),this._load(S,d)})}loadJSON(i,l={}){this.fire(new a.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=a.o.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new a.z("dataloading",{dataType:"style"})),this._load(Z_,!1)}_loadImports(i,l,d){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of i){const w=this._createFragmentStyle(y),S=new Promise(M=>{w.once("style.import.load",M),w.once("error",M)}).then(()=>this.mergeAll());if(_.push(S),this.resolvedImports.has(y.url)){w.loadEmpty();continue}const A=y.data||this.importsCache.get(y.url);A?(w.loadJSON(A,{validate:l}),this._isInternalStyle(A)&&(w.globalId=null)):y.url?w.loadURL(y.url,{validate:l}):w.loadEmpty();const P={style:w,id:y.id,config:y.config};if(d){const M=this.fragments.findIndex(({id:z})=>z===d);this.fragments=this.fragments.slice(0,M).concat(P).concat(this.fragments.slice(M))}else this.fragments.push(P)}return Promise.allSettled(_)}getImportGlobalIds(i=this,l=new Set){for(const d of i.fragments)d.style.globalId&&l.add(d.style.globalId),this.getImportGlobalIds(d.style,l);return[...l.values()]}_createFragmentStyle(i){const l=this.scope?a.B(i.id,this.scope):i.id;let d;const _=this._initialConfig&&this._initialConfig[l];(i.config||_)&&(d=Object.assign({},i.config,_));const y=new Bo(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,l){if(this._isInternalStyle(i)){const y=Object.assign({},Z_,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(y,l)}if(this.updateConfig(this._config,i.schema),l&&dc(this,_o(i)))return;this._loaded=!0,this.stylesheet=a.dk(i);const d=()=>{for(const A in i.sources)this.addSource(A,i.sources[A],{validate:!1,isInitialLoad:!0});if(i.iconsets)for(const A in i.iconsets)this.addIconset(A,i.iconsets[A]);i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&i.glyphs&&this.glyphManager.setURL(i.glyphs);const y=Kd(this.stylesheet.layers);if(this._order=y.map(A=>A.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new Q(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Q(this.stylesheet.light)),this._layers={};for(const A of y){const P=a.dq(A,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;const M=this.getOwnLayerSourceCache(P),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&P.canCastShadows()&&z&&(M.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.z("data",{dataType:"style"}));const S=this.isRootStyle();i.imports?this._loadImports(i.imports,l).then(()=>{this._reloadImports(),this.fire(new a.z(S?"style.load":"style.import.load"))}).catch(A=>{this.fire(new a.y(new Error("Failed to load imports",A))),this.fire(new a.z(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{d()}).catch(w=>{a.w(`Couldn't load color theme from the stylesheet: ${w}`),d()})}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,l,d,_,y,w,S,A,P,M;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(i=D.light),D.stylesheet.lights)for(const j of D.stylesheet.lights)j.type==="ambient"&&D.ambientLight!=null&&(l=D.ambientLight),j.type==="directional"&&D.directionalLight!=null&&(d=D.directionalLight);_=this._prioritizeTerrain(_,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(y=D.fog),D.stylesheet.snow&&D.snow!=null&&(w=D.snow),D.stylesheet.rain&&D.rain!=null&&(S=D.rain),D.stylesheet.camera!=null&&(M=D.stylesheet.camera),D.stylesheet.projection!=null&&(A=D.stylesheet.projection),D.stylesheet.transition!=null&&(P=D.stylesheet.transition),z[D.scope]=D._styleColorTheme}}),this.light=i,this.ambientLight=l,this.directionalLight=d,this.fog=y,this.snow=w,this.rain=S,this._styleColorThemeForScope=z,_===null?delete this.terrain:this.terrain=_,this.camera=M||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=Object.assign({},df,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const l=d=>{for(const _ of d.fragments)l(_.style);i(d)};l(this)}_prioritizeTerrain(i,l,d){const _=i&&i.drapeRenderMode===0;return d===null?l&&l.drapeRenderMode===0?l:_?i:null:l!=null&&(!i||_||l&&l.drapeRenderMode===1)?l:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{i=this._prioritizeTerrain(i,l.terrain,l.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(i=l.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},l={},d={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const w=a.B(y,_.scope);i[w]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const w=a.B(y,_.scope);l[w]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const w=a.B(y,_.scope);d[w]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=d}mergeLayers(){const i={},l=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const S of w._order){const A=w._layers[S];if(A.type==="slot"){const P=a.dl(S);if(i[P])continue;i[P]=[]}A.slot&&i[A.slot]?i[A.slot].push(A):l.push(A)}}),this._mergedOrder=[];let _=-1;const y=(w=[])=>{for(const S of w)if(S.type==="slot"){const A=a.dl(S.id);i[A]&&y(i[A]),this._mergedSlots.push(A)}else{const A=a.B(S.id,S.scope);this._mergedOrder.push(A),d[A]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(l),this._has3DLayers){const w={};for(let S=0;S<this._mergedOrder.length;++S){const A=this._mergedOrder[S];w[A]=S===_?1:S<_?d[A].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((S,A)=>w[S]-w[A])}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(l,d,_,y){const w=Object.assign({},d);for(const A of Object.keys(a.a6.colorTheme))w[A]===void 0&&(w[A]=a.a6.colorTheme[A].default);const S=new a.a8(q_,l,new Map(_));return S.setTransitionOrValue(w,_),S.untransitioned().possiblyEvaluate(new a.ac(0,{worldview:void 0}))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,_)=>{const y="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let w=i;w.startsWith(y)||(w=y+w);const S=a.I.from("mapbox-reserved-lut"),A=new Image;A.src=w,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void d();this._styleColorTheme.lutLoading=!1;const{width:P,height:M,data:z}=a.o.getImageData(A);if(M>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==M*M)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new a.q({width:P,height:M},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const D=this.imageManager.getImage(S,this.scope);D?(this._styleColorTheme.lut={image:D.data,data:i},d()):_(new Error("Missing LUT image."))}})}getLut(i){const l=this._styleColorThemeForScope[i];return l?l.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(l,d,_){let y,w,S;const A=a.o.devicePixelRatio>1?"@2x":"";let P=a.m(d.transformRequest(d.normalizeSpriteURL(l,A,".json"),a.R.SpriteJSON),(D,j)=>{P=null,S||(S=D,y=j,z())}),M=a.n(d.transformRequest(d.normalizeSpriteURL(l,A,".png"),a.R.SpriteImage),(D,j)=>{M=null,S||(S=D,w=j,z())});function z(){if(S)_(S);else if(y&&w){const D=a.o.getImageData(w),j={};for(const V in y){const{width:G,height:te,x:K,y:oe,sdf:he,pixelRatio:ge,stretchX:Se,stretchY:be,content:Ee}=y[V],Te=new a.q({width:G,height:te});a.q.copy(D,Te,{x:K,y:oe},{x:0,y:0},{width:G,height:te},null),j[V]={data:Te,pixelRatio:ge!==void 0?ge:1,sdf:he!==void 0&&he,stretchX:Se,stretchY:be,content:Ee,usvg:!1,version:0}}_(null,j)}}return{cancel(){P&&(P.cancel(),P=null),M&&(M.cancel(),M=null)}}}(i,this.map._requestManager,(l,d)=>{if(this._spriteRequest=null,l)this.fire(new a.y(l));else if(d){const _=new Map;for(const y in d)_.set(a.I.from(y),d[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))})}addIconset(i,l){if(l.type==="sprite")return void this._loadSprite(l.url);const d=this.getOwnSourceCache(l.source);if(!d)return void this.fire(new a.y(new Error(`Source "${l.source}" as specified by iconset "${i}" does not exist and cannot be used as an iconset source`)));const _=d.getSource();if(_.type!=="raster-array")return void this.fire(new a.y(new Error(`Source "${l.source}" as specified by iconset "${i}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const y=new kl(i,this.scope,d);this.imageManager.addImageProvider(y,this.scope)}removeIconset(i){this.imageManager.removeImageProvider(i,this.scope)}_loadIconset(i){if(!a.h(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const l=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(y,w)=>{if(this._spriteRequest=null,y)l?this._loadSprite(i):this.fire(new a.y(y));else if(w){const S=new Map;for(const A in w)S.set(a.I.from(A),w[A]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))},a.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(i),a.R.Iconset),(y,w)=>{if(y)return void _(y);const S={},A=a.dc(new a.bt(w));for(const P of A.icons){const M={version:1,pixelRatio:a.o.devicePixelRatio,content:cf(P),stretchX:P.metadata?uf(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?uf(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};S[P.name]=M}_(null,S)}))}_validateLayer(i){const l=this.getOwnSource(i.source);if(!l)return;const d=i.sourceLayer;d&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.y(new Error(`Source layer "${d}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,l)=>{const d=this.fragments[l];return d&&d.style&&(i.data=d.style.serialize()),i})}_serializeSources(){const i={};for(const l in this._sourceCaches){const d=this._sourceCaches[l].getSource();i[d.id]||(i[d.id]=d.serialize())}return i}_serializeLayers(i){const l=[];for(const d of i){const _=this._layers[d];_&&_.type!=="custom"&&l.push(_.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const l=this.getOwnLayer(i);if(l)return l;this.fire(new a.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const l=this.getOwnSource(i);if(l)return l;this.fire(new a.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,l){const d=this.map.painter;if(d)for(let _=i.minzoom||0;_<(i.maxzoom||25.5);_++){const y=i.getProgramIds();if(y)for(const w of y){const S=i.getDefaultProgramParams(w,l.zoom,this._styleColorTheme.lut);S&&(d.style=this,this.fog&&(d._fogVisible=!0,S.overrideFog=!0,d.getOrCreateProgram(w,S)),d._fogVisible=!1,S.overrideFog=!1,d.getOrCreateProgram(w,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,d.getOrCreateProgram(w,S)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const l=this.calculateLightsBrightness();i.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),i.worldview!==this._worldview&&(this._worldview=i.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:P,removedIds:M}=S[A];(P||M)&&(this._updateWorkerLayers(A,P,M),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const y={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];y[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(i,this._availableImages),!A.isHidden(i.zoom)){const P=this.getLayerSourceCache(A);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,i)}):this.precompilePrograms(A,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const S of w)S.sourceCache.used=!0;for(const S in y){const A=this._mergedSourceCaches[S];y[S]!==A.used&&A.getSource().fire(new a.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new a.z("data",{dataType:"style"}))}updateImageProviders(){const i=this.imageManager.getPendingImageProviders();for(const l of i){const d=l.resolvePendingRequests(),_=this.getFragmentStyle(l.scope);_&&_.addImages(d)}}_updateTilesForChangedImages(){const i={};for(const l in this._mergedSourceCaches){const d=this._mergedSourceCaches[l].getSource().scope;i[d]=i[d]||this._changes.getUpdatedImages(d),i[d].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i[d])}for(const l in i)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(i,l,d){const _=this.getFragmentStyle(i);_&&this.dispatcher.broadcast("updateLayers",{layers:l?_._serializeLayers(l):[],scope:i,removedIds:d||[],options:_.options})}setState(i,l){if(this._checkLoaded(),dc(this,_o(i)))return!1;(i=a.dk(i)).layers=Kd(i.layers);const d=function(w,S){if(!w)return[{command:oi.setStyle,args:[S]}];let A=[];try{if(!a.by(w.version,S.version))return[{command:oi.setStyle,args:[S]}];if(a.by(w.center,S.center)||A.push({command:oi.setCenter,args:[S.center]}),a.by(w.zoom,S.zoom)||A.push({command:oi.setZoom,args:[S.zoom]}),a.by(w.bearing,S.bearing)||A.push({command:oi.setBearing,args:[S.bearing]}),a.by(w.pitch,S.pitch)||A.push({command:oi.setPitch,args:[S.pitch]}),a.by(w.sprite,S.sprite)||A.push({command:oi.setSprite,args:[S.sprite]}),a.by(w.glyphs,S.glyphs)||A.push({command:oi.setGlyphs,args:[S.glyphs]}),a.by(w.imports,S.imports)||function(j=[],V=[],G){V=V||[];const te=(j=j||[]).map(au),K=V.map(au),oe=j.reduce(Ph,{}),he=V.reduce(Ph,{}),ge=te.slice();let Se,be,Ee,Te;for(Se=0,be=0;Se<te.length;Se++)Ee=te[Se],he.hasOwnProperty(Ee)?be++:(G.push({command:oi.removeImport,args:[Ee]}),ge.splice(ge.indexOf(Ee,be),1));for(Se=0,be=0;Se<K.length;Se++)Ee=K[K.length-1-Se],ge[ge.length-1-Se]!==Ee&&(oe.hasOwnProperty(Ee)?(G.push({command:oi.removeImport,args:[Ee]}),ge.splice(ge.lastIndexOf(Ee,ge.length-be),1)):be++,Te=ge[ge.length-Se],G.push({command:oi.addImport,args:[he[Ee],Te]}),ge.splice(ge.length-Se,0,Ee));for(const we of V){const Ae=oe[we.id];Ae&&(delete Ae.data,a.by(Ae,we)||G.push({command:oi.updateImport,args:[we.id,we]}))}}(w.imports,S.imports,A),a.by(w.transition,S.transition)||A.push({command:oi.setTransition,args:[S.transition]}),a.by(w.light,S.light)||A.push({command:oi.setLight,args:[S.light]}),a.by(w.fog,S.fog)||A.push({command:oi.setFog,args:[S.fog]}),a.by(w.snow,S.snow)||A.push({command:oi.setSnow,args:[S.snow]}),a.by(w.rain,S.rain)||A.push({command:oi.setRain,args:[S.rain]}),a.by(w.projection,S.projection)||A.push({command:oi.setProjection,args:[S.projection]}),a.by(w.lights,S.lights)||A.push({command:oi.setLights,args:[S.lights]}),a.by(w.camera,S.camera)||A.push({command:oi.setCamera,args:[S.camera]}),a.by(w.iconsets,S.iconsets)||function(j,V,G){let te;for(te in V=V||{},j=j||{})j.hasOwnProperty(te)&&(V.hasOwnProperty(te)||G.push({command:oi.removeIconset,args:[te]}));for(te in V){if(!V.hasOwnProperty(te))continue;const K=V[te];j.hasOwnProperty(te)?a.by(j[te],K)||(G.push({command:oi.removeIconset,args:[te]}),G.push({command:oi.addIconset,args:[te,K]})):G.push({command:oi.addIconset,args:[te,K]})}}(w.iconsets,S.iconsets,A),!a.by(w["color-theme"],S["color-theme"]))return[{command:oi.setStyle,args:[S]}];const P={},M=[];(function(j,V,G,te){let K;for(K in V=V||{},j=j||{})j.hasOwnProperty(K)&&(V.hasOwnProperty(K)||j_(K,G,te));for(K in V){if(!V.hasOwnProperty(K))continue;const oe=V[K];j.hasOwnProperty(K)?a.by(j[K],oe)||(j[K].type==="geojson"&&oe.type==="geojson"&&Yd(j,V,K)?G.push({command:oi.setGeoJSONSourceData,args:[K,oe.data]}):U_(K,V,G,te)):ou(K,V,G)}})(w.sources,S.sources,M,P);const z=[];w.layers&&w.layers.forEach(j=>{j.source&&P[j.source]?A.push({command:oi.removeLayer,args:[j.id]}):z.push(j)});let D=w.terrain;D&&P[D.source]&&(A.push({command:oi.setTerrain,args:[void 0]}),D=void 0),A=A.concat(M),a.by(D,S.terrain)||A.push({command:oi.setTerrain,args:[S.terrain]}),function(j,V,G){V=V||[];const te=(j=j||[]).map(au),K=V.map(au),oe=j.reduce(Ph,{}),he=V.reduce(Ph,{}),ge=te.slice(),Se=Object.create(null);let be,Ee,Te,we,Ae,qe,Ne;for(be=0,Ee=0;be<te.length;be++)Te=te[be],he.hasOwnProperty(Te)?Ee++:(G.push({command:oi.removeLayer,args:[Te]}),ge.splice(ge.indexOf(Te,Ee),1));for(be=0,Ee=0;be<K.length;be++)Te=K[K.length-1-be],ge[ge.length-1-be]!==Te&&(oe.hasOwnProperty(Te)?(G.push({command:oi.removeLayer,args:[Te]}),ge.splice(ge.lastIndexOf(Te,ge.length-Ee),1)):Ee++,qe=ge[ge.length-be],G.push({command:oi.addLayer,args:[he[Te],qe]}),ge.splice(ge.length-be,0,Te),Se[Te]=!0);for(be=0;be<K.length;be++)if(Te=K[be],we=oe[Te],Ae=he[Te],!Se[Te]&&!a.by(we,Ae))if(a.by(we.source,Ae.source)&&a.by(we["source-layer"],Ae["source-layer"])&&a.by(we.type,Ae.type)){for(Ne in Al(we.layout,Ae.layout,G,Te,null,oi.setLayoutProperty),Al(we.paint,Ae.paint,G,Te,null,oi.setPaintProperty),a.by(we.slot,Ae.slot)||G.push({command:oi.setSlot,args:[Te,Ae.slot]}),a.by(we.filter,Ae.filter)||G.push({command:oi.setFilter,args:[Te,Ae.filter]}),a.by(we.minzoom,Ae.minzoom)&&a.by(we.maxzoom,Ae.maxzoom)||G.push({command:oi.setLayerZoomRange,args:[Te,Ae.minzoom,Ae.maxzoom]}),we)we.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?Al(we[Ne],Ae[Ne],G,Te,Ne.slice(6),oi.setPaintProperty):a.by(we[Ne],Ae[Ne])||G.push({command:oi.setLayerProperty,args:[Te,Ne,Ae[Ne]]}));for(Ne in Ae)Ae.hasOwnProperty(Ne)&&!we.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?Al(we[Ne],Ae[Ne],G,Te,Ne.slice(6),oi.setPaintProperty):a.by(we[Ne],Ae[Ne])||G.push({command:oi.setLayerProperty,args:[Te,Ne,Ae[Ne]]}))}else G.push({command:oi.removeLayer,args:[Te]}),qe=ge[ge.lastIndexOf(Te)+1],G.push({command:oi.addLayer,args:[Ae,qe]})}(z,S.layers,A)}catch(P){console.warn("Unable to compute style diff:",P),A=[{command:oi.setStyle,args:[S]}]}return A}(this.serialize(),i).filter(w=>!(w.command in U1));if(d.length===0)return!1;const _=d.filter(w=>!(w.command in j1));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const y=[];return d.forEach(w=>{y.push(this[w.command](...w.args))}),l&&Promise.all(y).then(l).catch(l),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(i){if(i.size===0)return this;for(const[l,d]of i.entries()){if(this.getImage(l))return this.fire(new a.y(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,d),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this}addImage(i,l){return this.getImage(i)?this.fire(new a.y(new Error(`An image with the name "${i.name}" already exists.`))):(this.imageManager.addImage(i,this.scope,l),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this)}updateImage(i,l,d=!1){this.imageManager.updateImage(i,this.scope,l),d&&(this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})))}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(i){return this.modelManager.addModelURLs(i,this.scope),this._updateWorkerModels(),this.fire(new a.z("data",{dataType:"style"})),this}addModel(i,l,d={}){return this._checkLoaded(),this._validate(Me,`models.${i}`,l,null,d)||(this.modelManager.addModel(i,l,this.scope),this.fire(new a.z("data",{dataType:"style"}))),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope,!1,!0),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,l,d={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Ea,`sources.${i}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Th(i,l,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=w=>{const S=(w?"symbol:":"other:")+_.id,A=a.B(S,this.scope),P=this._sourceCaches[S]=new xo(A,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=P,P.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const l=this.getOwnSource(i);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===i)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([y,w])=>w.type==="source"&&w.source===i);if(_)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while iconset "${_[0]}" is using it.`)))}const d=this.getOwnSourceCaches(i);for(const _ of d){const y=a.dl(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new a.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getOwnSource(i).setData(l),this._changes.setDirty()}getOwnSource(i){const l=this.getOwnSourceCache(i);return l&&l.getSource()}getOwnSources(){const i=[];for(const l in this._otherSourceCaches){const d=this.getOwnSourceCache(l);d&&i.push(d.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const l in i){const d=i[l]._tiles;for(const _ in d){const y=d[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const y of i){if(this._validate(tu,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(y),w.updateTransitions(l)}else this.ambientLight=new zr(y,Kt||(Kt=new a.a9({color:new a.aa(a.a6.properties_light_ambient.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(y),w.updateTransitions(l)}else this.directionalLight=new zr(y,mr||(mr=new a.a9({direction:new a.ap(a.a6.properties_light_directional.direction),color:new a.aa(a.a6.properties_light_directional.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_directional.intensity),"cast-shadows":new a.aa(a.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new a.aa(a.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.aa(a.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(l,{worldview:this.map.getWorldview()}),_=new a.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,l=this.ambientLight;if(!i||!l)return;const d=D=>.2126*(D[0]<=.03928?D[0]/12.92:Math.pow((D[0]+.055)/1.055,2.4))+.7152*(D[1]<=.03928?D[1]/12.92:Math.pow((D[1]+.055)/1.055,2.4))+.0722*(D[2]<=.03928?D[2]/12.92:Math.pow((D[2]+.055)/1.055,2.4)),_=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=i.properties.get("intensity"),w=i.properties.get("direction"),S=1-a.d3(w.x,w.y,w.z)[2]/90,A=d(_)*y*S,P=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=l.properties.get("intensity"),z=d(P)*M;return Number(((A+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(i==null||i===""&&this.isRootStyle())return this;if(a.dm(i)){const l=a.dn(i),d=this.fragments.find(({id:y})=>y===l);if(!d)return;const _=a.dl(i);return d.style.getFragmentStyle(_)}{const l=this.fragments.find(({id:d})=>d===i);return l?l.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const l={},d=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(const _ in i){const y=this._featuresetSelectors[_]=[];for(const w of i[_].selectors){if(w.featureNamespace){const A=this.getOwnLayer(w.layer);if(!A){a.w(`Layer is undefined for selector: ${w.layer}`);continue}const P=d(A.source,A.sourceLayer);if(P in l&&l[P]!==w.featureNamespace){a.w(`"featureNamespace ${w.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}l[P]=w.featureNamespace}let S;if(w.properties)for(const A in w.properties){const P=a.U(w.properties[A]);P.result==="success"&&(S=S||{},S[A]=P.value)}y.push({layerId:w.layer,namespace:w.featureNamespace,properties:S,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const l=this.getFragmentStyle(i);if(!l||!l.stylesheet.featuresets)return[];const d=[];for(const _ in l.stylesheet.featuresets)d.push({featuresetId:_,importId:l.scope?l.scope:void 0});return d}getFeaturesetLayers(i,l){const d=this.getFragmentStyle(l),_=d.stylesheet.featuresets;if(!_||!_[i])return this.fire(new a.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const w of _[i].selectors){const S=d.getOwnLayer(w.layer);S&&y.push(S)}return y}getConfigProperty(i,l){const d=this.getFragmentStyle(i);if(!d)return null;const _=a.B(l,d.scope),y=d.options.get(_),w=y?y.value||y.default:null;return w?w.serialize():null}setConfigProperty(i,l,d){const _=this.getFragmentStyle(i);if(!_)return;const y=_.stylesheet.schema;if(!y||!y[l])return;const w=a.U(d);if(w.result!=="success")return void dc(this,w.value);const S=w.value.expression,A=a.B(l,_.scope),P=_.options.get(A);if(!P)return;let M;const{minValue:z,maxValue:D,stepValue:j,type:V,values:G}=y[l],te=a.U(y[l].default);te.result==="success"&&(M=te.value.expression),M?(this.options.set(A,Object.assign({},P,{value:S,default:M,minValue:z,maxValue:D,stepValue:j,type:V,values:G})),this.updateConfigDependencies(l)):this.fire(new a.y(new Error(`No schema defined for the config option "${l}" in the "${i}" fragment.`)))}getConfig(i){const l=this.getFragmentStyle(i);if(!l)return null;const d=l.stylesheet.schema;if(!d)return null;const _={};for(const y in d){const w=a.B(y,l.scope),S=l.options.get(w),A=S?S.value||S.default:null;_[y]=A?A.serialize():null}return _}setConfig(i,l){const d=this.getFragmentStyle(i);d&&(d.updateConfig(l,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const l=this.getFragmentStyle(i);return l?l.stylesheet.schema:null}setSchema(i,l){const d=this.getFragmentStyle(i);d&&(d.stylesheet.schema=l,d.updateConfig(d._config,l),this.updateConfigDependencies())}updateConfig(i,l){if(this._config=i,i||l)if(l)for(const d in l){let _,y;const w=a.U(l[d].default);if(w.result==="success"&&(_=w.value.expression),i&&i[d]!==void 0){const D=a.U(i[d]);D.result==="success"&&(y=D.value.expression)}const{minValue:S,maxValue:A,stepValue:P,type:M,values:z}=l[d];if(_){const D=a.B(d,this.scope);this.options.set(D,{default:_,value:y,minValue:S,maxValue:A,stepValue:P,type:M,values:z})}else this.fire(new a.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new a.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const l of this._configDependentLayers){const d=this.getLayer(l);if(d){if(i&&!d.configDependencies.has(i))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const d=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(d){const _=l._evaluateColorThemeData(d);(!l._styleColorTheme.lut&&_!==""||l._styleColorTheme.lut&&_!==l._styleColorTheme.lut.data)&&l.setColorTheme(d)}}),this._changes.setDirty()}addLayer(i,l,d={}){this._checkLoaded();const _=i.id;if(this._layers[_])return void this.fire(new a.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(i.type==="custom"){if(dc(this,a.dp(i)))return;y=a.dq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(_,i.source),i=a.dk(i),i=Object.assign(i,{source:_})),this._validate(ze,`layers.${_}`,i,{arrayIndex:-1},d))return;y=a.dq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let w=this._order.length;if(l){const M=this._order.indexOf(l);if(M===-1)return void this.fire(new a.y(new Error(`Layer with id "${l}" does not exist on this map.`)));y.slot===this._layers[l].slot?w=M:a.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const S=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&A&&(S.castsShadows=!0);const P=this._changes.getRemovedLayer(y);if(P&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const M=a.B(y.source,y.scope);P.type!==y.type?this._changes.updateSourceCache(M,"clear"):(this._changes.updateSourceCache(M,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(i,l){this._checkLoaded();const d=this._checkLayer(i);if(!d||i===l)return;const _=this._order.indexOf(i);this._order.splice(_,1);let y=this._order.length;if(l){const w=this._order.indexOf(l);if(w===-1)return void this.fire(new a.y(new Error(`Layer with id "${l}" does not exist on this map.`)));d.slot===this._layers[l].slot?y=w:a.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const l=this._checkLayer(i);if(!l)return;l.setEventedParent(null);const d=this._order.indexOf(i);this._order.splice(d,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const _=this.getOwnLayerSourceCache(l);if(_&&_.castsShadows){let y=!1;for(const w in this._layers)if(this._layers[w].source===l.source&&this._layers[w].canCastShadows()){y=!0;break}_.castsShadows=y}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,d){this._checkLoaded();const _=this._checkLayer(i);_&&(_.minzoom===l&&_.maxzoom===d||(l!=null&&(_.minzoom=l),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,l){this._checkLoaded();const d=this._checkLayer(i);d&&d.slot!==l&&(d.slot=l,this._updateLayer(d))}setFilter(i,l,d={}){this._checkLoaded();const _=this._checkLayer(i);if(_&&!a.by(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Y,`layers.${_.id}.filter`,l,{layerType:_.type},d)||(_.filter=a.dk(l),this._updateLayer(_)))}getFilter(i){const l=this._checkLayer(i);if(l)return a.dk(l.filter)}setLayoutProperty(i,l,d,_={}){this._checkLoaded();const y=this._checkLayer(i);if(y&&!a.by(y.getLayoutProperty(l),d)){if(d!=null&&(!_||_.validate!==!1)&&dc(y,ve.call(_o,{key:`layers.${i}.layout.${l}`,layerType:y.type,objectKey:l,value:d,styleSpec:a.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(l,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(i,l){const d=this._checkLayer(i);if(d)return d.getLayoutProperty(l)}setPaintProperty(i,l,d,_={}){this._checkLoaded();const y=this._checkLayer(i);if(!y||a.by(y.getPaintProperty(l),d)||d!=null&&(!_||_.validate!==!1)&&dc(y,se.call(_o,{key:`layers.${i}.paint.${l}`,layerType:y.type,objectKey:l,value:d,styleSpec:a.a6})))return;const w=y.setPaintProperty(l,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),w&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(i,l){const d=this._checkLayer(i);if(d)return d.getPaintProperty(l)}setFeatureState(i,l){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:A,importId:P}=i.target,M=this.getFragmentStyle(P),z=M.getFeaturesetLayers(A);for(const{source:D,sourceLayer:j}of z)M.setFeatureState({id:i.id,source:D,sourceLayer:j},l)}else if("layerId"in i.target){const{layerId:A}=i.target,P=this.getLayer(A);this.setFeatureState({id:i.id,source:P.source,sourceLayer:P.sourceLayer},l)}return}const d=i.source,_=i.sourceLayer,y=this._checkSource(d);if(!y)return;const w=y.type;if(w==="geojson"&&_)return void this.fire(new a.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.setFeatureState(_,i.id,l)}removeFeatureState(i,l){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:A,importId:P}=i.target,M=this.getFragmentStyle(P),z=M.getFeaturesetLayers(A);for(const{source:D,sourceLayer:j}of z)M.removeFeatureState({id:i.id,source:D,sourceLayer:j},l)}else if("layerId"in i.target){const{layerId:A}=i.target,P=this.getLayer(A);this.removeFeatureState({id:i.id,source:P.source,sourceLayer:P.sourceLayer},l)}return}const d=i.source,_=this._checkSource(d);if(!_)return;const y=_.type,w=y==="vector"?i.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new a.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.removeFeatureState(w,i.id,l)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let y;if("featuresetId"in i.target){const{featuresetId:w,importId:S}=i.target,A=this.getFragmentStyle(S),P=A.getFeaturesetLayers(w);for(const{source:M,sourceLayer:z}of P){const D=A.getFeatureState({id:i.id,source:M,sourceLayer:z});if(D&&!y)y=D;else if(!a.by(y,D))return void this.fire(new a.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:w}=i.target,S=this.getLayer(w);y=this.getFeatureState({id:i.id,source:S.source,sourceLayer:S.sourceLayer})}return y}const l=i.source,d=i.sourceLayer,_=this._checkSource(l);if(_){if(_.type!=="vector"||d)return i.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(d,i.id);this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),l=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return a.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(i){for(const l of Object.values(this._mergedLayers))i(l)&&this._updateLayer(l)}_updateLayer(i){this._changes.updateLayer(i);const l=this.getLayerSourceCache(i),d=a.B(i.source,i.scope),_=this._changes.getUpdatedSourceCaches();i.source&&!_[d]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),l.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=S=>this._mergedLayers[S].is3D(!!this.terrain),d=this.order,_={},y=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(l(A)){_[A]=S;for(const P of i){const M=P[A];if(M)for(const z of M)y.push(z)}}}y.sort((S,A)=>A.intersectionZ-S.intersectionZ);const w=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(l(A))for(let P=y.length-1;P>=0;P--){const M=y[P].feature;if(M.layer&&_[M.layer.id]<S)break;w.push(M),y.pop()}else for(const P of i){const M=P[A];if(M)for(const z of M)w.push(z.feature)}}return w}queryRasterValue(i,l,d){const _=this.getOwnSource(i);return _?_.type!=="raster-array"?(this.fire(new a.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(l,d):(this.fire(new a.y(new Error(`Source with id "${i}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(i,l,d){let _;l&&!Array.isArray(l)&&l.filter&&(this._validate(Y,"queryRenderedFeatures.filter",l.filter,null,l),_=a.b6(l.filter));const y={},w=M=>{if(hf.has(M.type))return;const z=this.getOwnLayerSourceCache(M),D=y[z.id]=y[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};M.is3D(!!this.terrain)&&(D.has3DLayers=!0),D.layers[M.fqid]=D.layers[M.fqid]||{styleLayer:M,targets:[]},D.layers[M.fqid].targets.push({filter:_})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.y(new Error("parameters.layers must be an Array."))),[];for(const M of l.layers){const z=this._layers[M];if(!z)return this.fire(new a.y(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];w(z)}}else for(const M in this._layers)w(this._layers[M]);const S=this._queryRenderedFeatures(i,y,d),A=this._flattenAndSortRenderedFeatures(S),P=[];for(const M of A)a.ds(M.layer.id)===this.scope&&P.push(M);return P}queryRenderedFeatureset(i,l,d){let _;l&&!Array.isArray(l)&&l.filter&&(this._validate(Y,"queryRenderedFeatures.filter",l.filter,null,l),_=a.b6(l.filter));const y="mock",w=[];if(l&&l.target)w.push(Object.assign({},l,{targetId:y,filter:_}));else{const M=this.getFeaturesetDescriptors();for(const z of M)w.push({targetId:y,filter:_,target:z});for(const{style:z}of this.fragments){const D=z.getFeaturesetDescriptors();for(const j of D)w.push({targetId:y,filter:_,target:j})}}const S=this.queryRenderedTargets(i,w,d),A=[],P=new Set;for(const M of S)for(const z of M.variants[y])Sl(z,M,P)||A.push(new a.dt(M,z));return A}queryRenderedTargets(i,l,d){const _={},y=(S,A,P,M)=>{const z=_[A.id]=_[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(z.layers[S.fqid]=z.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(z.has3DLayers=!0),!M)return P.uniqueFeatureID=!1,void z.layers[S.fqid].targets.push(P);z.layers[S.fqid].targets.push(Object.assign({},P,{namespace:M.namespace,properties:M.properties,uniqueFeatureID:M.uniqueFeatureID}))};for(const S of l)if("featuresetId"in S.target){const{featuresetId:A,importId:P}=S.target,M=this.getFragmentStyle(P);if(!M||!M._featuresetSelectors)continue;const z=M._featuresetSelectors[A];if(!z){this.fire(new a.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const D of z){const j=M.getOwnLayer(D.layerId);j&&!hf.has(j.type)&&y(j,M.getOwnLayerSourceCache(j),S,D)}}else if("layerId"in S.target){const{layerId:A}=S.target,P=this.getLayer(A);if(!P||hf.has(P.type))continue;y(P,this.getLayerSourceCache(P),S)}const w=this._queryRenderedFeatures(i,_,d);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(i,l,d){const _=[],y=!!this.map._showQueryGeometry,w=di.createFromScreenPoints(i,d);for(const S in l){const A=Eh(w,l[S],this._availableImages,d,y);Object.keys(A).length&&_.push(A)}if(this.placement)for(const S in l){if(!l[S].sourceCache._onlySymbols)continue;const A=Tm(w.screenGeometry,l[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&_.push(A)}return _}querySourceFeatures(i,l){const d=l&&l.filter;d&&this._validate(Y,"querySourceFeatures.filter",d,null,l);let _=[];const y=this.getOwnSourceCaches(i);for(const w of y)_=_.concat(Aa(w,l));return _}addSourceType(i,l,d){return Bo.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(Bo.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,l,d={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const S in i)if(!a.by(i[S],_[S])){y=!0;break}if(!y)return;const w=this._getTransitionParameters();this.light.setLight(i,l,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,l=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=i;const _=i.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const S="terrain-dem-src";this.addSource(S,d.source),d=a.dk(d),d=Object.assign(d,{source:S})}const y=Object.assign({},d),w={};if(this.terrain&&_){y.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(w.style=S.serialize())}if(this._validate(bt,"terrain",y,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&l!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,l),this.fire(new a.z("data",{dataType:"style"}))}else{const y=this.terrain,w=y.get();for(const S of Object.keys(a.a6.terrain))!d.hasOwnProperty(S)&&a.a6.terrain[S].default&&(d[S]=a.a6.terrain[S].default);for(const S in i)if(!a.by(i[S],w[S])){y.set(i,this.options),this.stylesheet.terrain=i;const A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new a.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Mt(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createSnow(i){const l=this.snow=new Vr(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createRain(i){const l=this.rain=new Xr(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!a.by(l.get(),i)){l.set(i,this.options),this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!a.by(l.get(),i)){l.set(i,this.options),this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!a.by(l.get(),i)){l.set(i,this.options),this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void i();const d=this._evaluateColorThemeData(l);this._loadColorTheme(d).then(()=>{this.fire(new a.z("colorthemeset")),i()}).catch(_=>{a.w(`Couldn't set color theme: ${_}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,l){const d=this.getFragmentStyle(i);d&&(d._styleColorTheme.colorThemeOverride=l,d._reloadColorTheme())}_getTransitionParameters(i){return{now:a.o.now(),transition:Object.assign(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],l=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?i.push(d):l.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const d=this.terrain=new ne(i,l,this.scope,this.options,this.map.getWorldview());l===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,d,_,y={}){if(y&&y.validate===!1)return!1;const w=Object.assign({},this.serialize());return dc(this,i.call(_o,Object.assign({key:l,style:w,value:d,styleSpec:a.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(i){const l=this.getSourceCaches(i);for(const d of l)d.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}clearLayers(){for(const i in this._mergedLayers){const l=this._mergedLayers[i];l._clear&&l._clear()}}reloadSource(i){const l=this.getSourceCaches(i);for(const d of l)d.resume(),d.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let l;this.directionalLight&&(l=hu(this.directionalLight));const d=new Set;for(const _ in this._mergedLayers){const y=this._mergedLayers[_];y.hasElevation()&&!d.has(y.source)&&d.add(y.source)}for(const _ in this._mergedSourceCaches){const y=this._mergedSourceCaches[_],w=d.has(y._source.id);y.update(i,void 0,void 0,l,w)}}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,d,_,y,w,S=!1){let A=!1,P=!1;const M={},z={};for(const D of this._mergedOrder){const j=this._mergedLayers[D];if(j.type!=="symbol")continue;const V=a.B(j.source,j.scope);let G=M[V];if(!G){const K=this.getLayerSourceCache(j);if(!K)continue;const oe=K.getRenderableIds(!0).map(he=>K.getTileByID(he));z[V]=oe.slice(),G=M[V]=oe.sort((he,ge)=>ge.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ge.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(j,G,l.center.lng,l.projection);A=A||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.o.now(),l.zoom))&&(this.pauseablePlacement=new Ms(l,this._mergedOrder,S,d,_,y,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.o.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A){this._buildingIndex.onNewFrame(l.zoom);for(let D=0;D<this._mergedOrder.length;D++){const j=this._mergedLayers[this._mergedOrder[D]];if(j.type!=="symbol")continue;const V=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,M[a.B(j.source,j.scope)],D,V?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.o.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,l){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===i.id)!==-1)return void this.fire(new a.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!l)return d.push(i),this._loadImports([i],!0);const _=d.findIndex(({id:y})=>y===l);return _===-1&&this.fire(new a.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(i).concat(d.slice(_)),this._loadImports([i],!0,l)}updateImport(i,l){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(i);return _===-1?this:typeof l=="string"?(this.setImportUrl(i,l),this):(l.url&&l.url!==d[_].url&&this.setImportUrl(i,l.url),a.by(l.config,d[_].config)||this.setImportConfig(i,l.config,l.data.schema),a.by(l.data,d[_].data)||this.setImportData(i,l.data),this)}moveImport(i,l){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(i);if(_===-1)return this;const y=this.getImportIndex(l);if(y===-1)return this;const w=d[_],S=this.fragments[_];return d=d.filter(({id:A})=>A!==i),this.fragments=this.fragments.filter(({id:A})=>A!==i),this.stylesheet.imports=d.slice(0,y).concat(w).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(S).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(i,l){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(i);if(_===-1)return this;d[_].url=l;const y=this.fragments[_];return y.style=this._createFragmentStyle(d[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(l),this}setImportData(i,l){this._checkLoaded();const d=this.getImportIndex(i),_=this.stylesheet.imports||[];return d===-1?this:l?(this.fragments[d].style.setState(l),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(i,_[d].url))}setImportConfig(i,l,d){this._checkLoaded();const _=this.getImportIndex(i),y=this.stylesheet.imports||[];if(_===-1)return this;l?y[_].config=l:delete y[_].config;const w=this.fragments[_];d&&w.style.stylesheet&&(w.style.stylesheet.schema=d);const S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=l,w.style.updateConfig(l,S),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const l=this.stylesheet.imports||[],d=this.getImportIndex(i);d!==-1&&(l.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(i){const l=(this.stylesheet.imports||[]).findIndex(d=>d.id===i);return l===-1&&this.fire(new a.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),l}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const l in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[l];d&&i.push(d.getSource())}return i}getSource(i,l){const d=this.getSourceCache(i,l);return d&&d.getSource()}getLayerSource(i){const l=this.getLayerSourceCache(i);return l&&l.getSource()}getSourceCache(i,l){const d=a.B(i,l);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(i){const l=a.B(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[i]&&l.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&l.push(this._mergedSymbolSourceCaches[i]),l}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const l in i){const d=i[l];d==="reload"?this.reloadSource(l):d==="clear"&&this.clearSource(l)}}updateLayers(i){const l=this._changes.getUpdatedPaintProperties();for(const d of l){const _=this.getLayer(d);_&&_.updateTransitions(i)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(i){this.stylesheet.glyphs=i,this.glyphManager.setURL(i)}getImages(i,l,d){this.imageManager.getImages(l.images,l.scope,d),this._updateTilesForChangedImages();const _=w=>{if(w){const S=l.images.map(A=>a.I.toString(A));w.setDependencies(l.tileID.key,l.type,S)}},y=a.B(l.source,l.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y]),l.images.some(w=>w.iconsetId)&&this.fire(new a.z("data",{dataType:"style"}))}rasterizeImages(i,l,d){this.imageManager.rasterizeImages(l,d)}getGlyphs(i,l,d){this.glyphManager.getGlyphs(l.stacks,d)}getResource(i,l,d){return a.dv(l,d)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this.getOwnSourceCaches(i);return l.length===0?(this.fire(new a.y(new Error(`There is no source with ID '${i}'`))),!1):l.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,l){if(!this._clipLayerPresent&&i.type!=="fill-extrusion"&&i.type!=="building")return!1;const d=i.type==="fill-extrusion"&&(i.sourceLayer==="building"||i.sourceLayer==="procedural_buildings"),_=i.type==="building";if(i.is3D(!!this.terrain)){if(d||_||l&&l.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bo.getSourceType=function(f){return iu[f]},Bo.setSourceType=function(f,i){iu[f]=i},Bo.registerForPluginStateChange=a.dw;class X_{execute(i){const l=this._makeBuildingsQueryArea(i),d=this._makeFloorsQueryArea(i),_=i.queryRenderedFeatures(l).reduce((P,M)=>{const z=M.properties.id;return M.properties.type!=="building"||P.some(D=>D.properties.id===z)||P.push(M),P},[]),y=i.queryRenderedFeatures(d).reduce((P,M)=>{const z=M.properties.id;return M.properties.type!=="floor"||P.some(D=>D.properties.id===z)||P.push(M),P},[]),w=[i.getCenter().lng,i.getCenter().lat],S=this._findBuildingAtCenter(w,_),A=_.length>0?_[0]:null;return{floors:y.map(P=>({id:P.properties.id,name:P.properties.name,isDefault:P.properties.is_default,zIndex:P.properties.z_index,connectedFloorIds:P.properties.connected_floor_ids,conflictedFloorIds:P.properties.conflicted_floor_ids,buildingIds:P.properties.building_ids})),building:S?{id:S.properties.id,name:S.properties.name}:{id:A.properties.id,name:A.properties.name}}}_makeBuildingsQueryArea(i){const l=i.transform.width,d=i.transform.height,_=Math.min(l,d)*(1/8),y=.5*(l-_),w=.5*(d-_);return[new a.P(y,w),new a.P(y+_,w+_)]}_makeFloorsQueryArea(i){const l=i.transform.width,d=i.transform.height;return[new a.P(0,0),new a.P(l,d)]}_findBuildingAtCenter(i,l){for(const d of l)if(d.geometry.type==="Polygon"&&this._pointInPolygon(i,d.geometry.coordinates[0]))return d;return null}_pointInPolygon(i,l){let d=!1;for(let _=0,y=l.length-1;_<l.length;y=_++){const w=l[_][0],S=l[_][1],A=l[y][1];S>i[1]!=A>i[1]&&i[0]<(l[y][0]-w)*(i[1]-S)/(A-S)+w&&(d=!d)}return d}}class K_{constructor(){this._floors=new Map,this._buildings=new Map}append(i){const l=i.building;let d=!1;if(l){const _=l.id;_&&(this._buildings.set(_,l),d||this._buildings.has(_)||(d=!0))}return i.floors.forEach(_=>{const y=_.id;d||this._floors.has(y)||(d=!0),this._floors.set(y,_)}),d}clear(){this._floors.clear(),this._buildings.clear()}getFloors(i=null){const l=Array.from(this._floors.values());return i?l.filter(d=>{const _=d.buildingIds;return!!_&&_.split(";").includes(i)}):l}}class Y_{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new K_}setIndoorData(i){const l=this._featuresStorage.append(i);return this._selectedBuildingId=i.building?i.building.id:null,l}setFloorId(i){const l=this._selectedFloorId!==i;return l&&(this._selectedFloorId=i),l}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const i=this._featuresStorage.getFloors(this._selectedBuildingId),l=this.getActiveFloors().find(d=>{const _=d.buildingIds;if(!_)return!1;const y=_.split(";");return!!this._selectedBuildingId&&y.includes(this._selectedBuildingId)});return{selectedFloorId:l?l.id:null,floors:i}}getActiveFloors(i=!1){const l=this._featuresStorage.getFloors(),d=l.find(A=>A.id===this._selectedFloorId),_=l.filter(A=>A.isDefault===!0);let y=[];if(d)return y=this._calculateCurrentActiveFloors(l,d,_,i),y;if(_.length===0){const A=this._featuresStorage.getFloors(this._selectedBuildingId);y=A.length>0?[A[0]]:[]}else y=_;const w=this._getNonConflictingLastActiveFloors(y),S=[...y,...w];return this._lastActiveFloors=S,S}hasBuildingChanged(i){return this._selectedBuildingId!==(i.building?i.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(i,l,d,_){if(!l)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,d);const y=this._getConnectedFloors(l,i);return _?this._buildExplicitSelectionFloors(l,y,d):this._buildImplicitSelectionFloors(y,d)}_getConnectedFloors(i,l){const d=i.connectedFloorIds;if(!d)return[];const _=new Set(d.split(";"));return l.filter(y=>_.has(y.id))}_buildExplicitSelectionFloors(i,l,d){const _=[i,...l],y=this._getNonConflictingLastActiveFloors(_),w=[..._,...y],S=this._deduplicateFloors(w),A=this._getConflictingFloorIdsFrom(S),P=d.filter(z=>!A.has(z.id)),M=[...S,...P];return this._lastActiveFloors=M,M}_buildImplicitSelectionFloors(i,l){const d=this._getConflictingFloorIdsFrom(this._lastActiveFloors),_=l.filter(w=>!d.has(w.id)),y=this._deduplicateFloors([...this._lastActiveFloors,..._]);return this._lastActiveFloors=y,y}_getNonConflictingDefaultFloors(i,l){const d=this._getConflictingFloorIdsFrom(i),_=l.filter(w=>!d.has(w.id)),y=this._deduplicateFloors([...i,..._]);return this._lastActiveFloors=y,y}_deduplicateFloors(i){const l=new Set;return i.filter(d=>{const _=d.id;return!l.has(_)&&(l.add(_),!0)})}_getConflictingFloorIdsFrom(i){const l=new Set;return i.forEach(d=>{const _=d.conflictedFloorIds;_&&_.split(";").forEach(y=>l.add(y))}),l}_getNonConflictingLastActiveFloors(i){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const l=new Set(i.map(_=>_.id)),d=this._getConflictingFloorIdsFrom(i);return this._lastActiveFloors.filter(_=>{const y=_.id;return!l.has(y)&&!d.has(y)})}_isFloorConflicted(i,l){const d=i.id;return l.some(_=>{const y=_.conflictedFloorIds;return!!y&&y.split(";").includes(d)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class fc extends a.E{constructor(i){super(),a.aY(["_onLoad","_onMove"],this),this._map=i,this._floorSelectionState=new Y_,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(i){this._floorSelectionState.setFloorId(i)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new a.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=i.scope,this._indoorDataQuery=new X_))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const i=this._indoorDataQuery.execute(this._map);if(!i||i.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(i)){if(!i.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(i),i.building&&this._updateIndoorSelector()}else this._setIndoorData(i)}_setIndoorData(i){this._floorSelectionState.setIndoorData(i)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const i=this._floorSelectionState.getCurrentBuildingSelection(),l=i.floors.map(d=>({id:d.id,name:d.name,shortName:d.zIndex.toString(),levelOrder:d.zIndex}));this.fire(new a.z("indoorupdate",{selectedFloorId:i.selectedFloorId,floors:l}))}_updateIndoorConfig(i=!1){const l=this._floorSelectionState.getActiveFloors(i).map(d=>d.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",l])}}var Bh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Nm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,zm=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,fu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Bm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ff=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,To=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,pf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Dt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,jm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const mu=[];jo(Bh,mu),jo(zm,mu),jo(Nm,mu);const gu={"_prelude_fog.vertex.glsl":Bm,"_prelude_terrain.vertex.glsl":pu,"_prelude_shadow.vertex.glsl":Dt,"_prelude_fog.fragment.glsl":ff,"_prelude_shadow.fragment.glsl":jm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":To,"_prelude_raster_particle.glsl":pf},jh={};ri("",pu),ri(ff,Bm),ri(jm,Dt),ri(To,""),ri(pf,"");const Uh=ri(Nm,zm),Ca=Bh;var mf={background:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:ri(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ri("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ri(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ri(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ri(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ri(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ri(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ri(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ri("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ri("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ri(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ri(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ri("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ri(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fu),skyboxGradient:ri(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fu),skyboxCapture:ri(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ri(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ri(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ri("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ri("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ri("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ri("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function jo(f,i){const l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of l)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const y of _)i.includes(y)||i.push(y)}}function ri(f,i){const l=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_={},y=[],w=[];if(f=f.replace(l,(A,P)=>(w.push(P),"")),(i=i.replace(l,(A,P)=>(y.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...mu];jo(f,S),jo(i,S);for(const A of[...y,...w])gu[A]||console.error(`Undefined include: ${A}`),jh[A]||(jh[A]=[],jo(gu[A],jh[A])),S=[...S,...jh[A]];return{fragmentSource:f=f.replace(d,(A,P,M,z,D)=>(_[D]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${M} ${z} ${D};
#else
uniform ${M} ${z} u_${D};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${D}
    ${M} ${z} ${D} = u_${D};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${M} ${z} ${D};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(d,(A,P,M,z,D)=>{const j=z==="float"?"vec2":z,V=D.match(/color/)?"color":j;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${D}
in ${M} ${z} a_${D};
#endif
`:_[D]?P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${M} ${j} a_${D};
out ${M} ${z} ${D};
#else
uniform ${M} ${z} u_${D};
#endif
`:P==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${M} ${z} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${V}(a_${D}, u_${D}_t);
#else
    ${M} ${z} ${D} = u_${D};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${M} ${z} a_${D};
    out ${M} ${z} ${D};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${D} = a_${D};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${M} ${j} a_${D};
#else
uniform ${M} ${z} u_${D};
#endif
`:P==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${D}0;
in vec4 a_${D}1;
in vec4 a_${D}2;
in vec4 a_${D}3;
#else
uniform ${M} ${z} u_${D};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${j} a_${D};
#else
uniform ${M} ${z} u_${D};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${M} ${z} ${D} = a_${D};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${M} ${z} ${D} = a_${D};
#else
    ${M} ${z} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${M} ${z} ${D} = unpack_mix_${V}(a_${D}, u_${D}_t);
#else
    ${M} ${z} ${D} = u_${D};
#endif
`}),usedDefines:S,vertexIncludes:y,fragmentIncludes:w}}class _u{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,d,_,y,w,S,A){this.context=i;let P=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!P&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(P=!0);let M=this.boundDynamicVertexBuffers.length!==S.length;for(let z=0;!M&&z<S.length;z++)this.boundDynamicVertexBuffers[z]!==S[z]&&(M=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||P||M||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(l,d,_,y,w,S,A);else{i.bindVertexArrayOES.set(this.vao);for(const z of S)z&&(z.bind(),A&&z.instanceCount&&z.setVertexAttribDivisor(i.gl,l,A));y&&y.dynamicDraw&&y.bind()}}freshBind(i,l,d,_,y,w,S){const A=this.context,P=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w,l.enableAttributes(P,i),l.bind(),l.setVertexAttribPointers(P,i,y);for(const M of d)M.enableAttributes(P,i),M.bind(),M.setVertexAttribPointers(P,i,y);for(const M of w)M&&(M.enableAttributes(P,i),M.bind(),M.setVertexAttribPointers(P,i,y),S&&M.instanceCount&&M.setVertexAttribDivisor(P,i,S));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function V1(f,i){const l=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new a.ae(0,d/l).toLngLat().lat,new a.ae(0,(d+1)/l).toLngLat().lat]}function $1(f,i,l,d,_,y,w){const S=f.context,A=S.gl,P=l.hillshadeFBO;if(!P)return;f.prepareDrawTile();const M=f.isTileAffectedByFog(i),z=f.getOrCreateProgram("hillshade",{overrideFog:M});S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const D=((te,K,oe,he)=>{const ge=oe.paint.get("hillshade-shadow-color"),Se=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=oe.paint.get("hillshade-highlight-color"),Ee=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=oe.paint.get("hillshade-accent-color"),we=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=oe.paint.get("hillshade-emissive-strength");let qe=a.an(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")qe-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const rt=te.style.directionalLight.properties.get("direction"),$e=a.d3(rt.x,rt.y,rt.z);qe=a.an($e[1])}const Ne=!te.options.moving;return{u_matrix:he||te.transform.calculateProjMatrix(K.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:V1(0,K.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),qe],u_shadow:ge.toPremultipliedRenderColor(Se?null:oe.lut),u_highlight:be.toPremultipliedRenderColor(Ee?null:oe.lut),u_emissive_strength:Ae,u_accent:Te.toPremultipliedRenderColor(we?null:oe.lut)}})(f,l,d,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(S,z,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:V,tileBoundsSegments:G}=f.getTileBoundsBuffers(l);z.draw(f,A.TRIANGLES,_,y,w,Pr.disabled,D,d.id,j,V,G)}function gf(f,i,l){if(!i.needsDEMTextureUpload)return;const d=f.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(l.stride);const y=l.getPixels();i.demTexture?i.demTexture.update(y,{premultiply:!1}):i.demTexture=new a.T(d,y,_.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function G1(f,i,l){const d=f.context,_=d.gl;if(!i.dem)return;const y=i.dem;if(d.activeTexture.set(_.TEXTURE1),gf(f,i,y),!i.demTexture)return;i.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=y.dim;d.activeTexture.set(_.TEXTURE0);let S=i.hillshadeFBO;if(!S){const D=new a.T(d,{width:w,height:w,data:null},_.RGBA8);D.bind(_.LINEAR,_.CLAMP_TO_EDGE),S=i.hillshadeFBO=d.createFramebuffer(w,w,!0,"renderbuffer"),S.colorAttachment.set(D.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,w,w]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:M}=f.getMercatorTileBoundsBuffers(),z=[];f.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(f,_.TRIANGLES,Ht.disabled,Sr.disabled,Ur.unblended,Pr.disabled,((D,j)=>{const V=j.stride,G=a.bC();return a.cd(G,0,a.al,-a.al,0,0,1),a.br(G,G,[0,-a.al,0]),{u_matrix:G,u_image:1,u_dimension:[V,V],u_zoom:D.overscaledZ}})(i.tileID,y),l.id,A,P,M),i.needsHillshadePrepare=!1}class Qi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class J_ extends Qi{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Um extends Qi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class H1 extends Qi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class W1 extends Qi{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class q1 extends Qi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Z1 extends Qi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Q_ extends Qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class X1 extends Qi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class _f extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class K1 extends Qi{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ey extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class Vm extends Qi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class yf extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class $m extends Qi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class pc extends Qi{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class yu extends Qi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class xf extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class vf extends Qi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class xu extends Qi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let ty=class extends Qi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Gm extends Qi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ry extends Qi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class vu extends Qi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class wf extends Qi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class bf extends Qi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Hm extends Qi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Tf extends Qi{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Vh extends Qi{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class iy extends Qi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ny extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class sy extends Qi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Rl extends Qi{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class oy extends Rl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class ay extends Rl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Y1 extends Rl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class J1 extends ay{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Wm=(f,i,l)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:l}),Sf=(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:M,u_globe_radius:z,u_viewport:D,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:V});function Ef(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const Ml=new class{constructor(){this.operations={}}newMorphing(f,i,l,d,_){if(f in this.operations){const y=this.operations[f];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[f]={startTime:d,phase:0,duration:_,from:i,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const l=this.operations[i];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},qm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Zm(f,i,l){if(i===0)return 0;const d=i<1&&l===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*d}function Q1(f,i){const l=1<<f.z;return!i&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}const mc=f=>({u_matrix:f});function gc(f,i,l,d,_){if(_>0){const y=a.o.now(),w=(y-f.timeAdded)/_,S=i?(y-i.timeAdded)/_:-1,A=l.getSource(),P=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),M=!i||Math.abs(i.tileID.overscaledZ-P)>Math.abs(f.tileID.overscaledZ-P),z=M&&f.refreshedUponExpiration?1:a.aA(M?w:1-S,0,1);return i?{opacity:1,mix:1-z,isFading:w<1}:{opacity:z,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class ly extends xo{constructor(i){const l=Th("mock-dem",{type:"raster-dem",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class So extends xo{constructor(i){const l=Th("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,d){if(i.freezeTileCoverage)return;this.transform=i;const _=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const S=new El(w,this._source.tileSize*w.overscaleFactor(),i.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[w.key]=S}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(i){const l=this.proxyCachedFBO[i];if(l!==void 0){const d=Object.values(l);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Af extends a.aO{constructor(i,l,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=d}}class $h extends a.dH{constructor(i,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,y]=function(A){const P=new a.bd,M=new a.b1,z=131;P.reserve(17161),M.reserve(33800);const D=a.al/128,j=a.al+D/2,V=j+D;for(let te=-D;te<V;te+=D)for(let K=-D;K<V;K+=D){const oe=K<0||K>j||te<0||te>j?24575:0,he=a.aA(Math.round(K),0,a.al),ge=a.aA(Math.round(te),0,a.al);P.emplaceBack(he+oe,ge)}const G=(te,K)=>{const oe=K*z+te;M.emplaceBack(oe+1,oe,oe+z),M.emplaceBack(oe+z,oe+z+1,oe+1)};for(let te=1;te<129;te++)for(let K=1;K<129;K++)G(K,te);return[0,129].forEach(te=>{for(let K=0;K<130;K++)G(K,te),G(te,K)}),[P,M,32768]}(),w=i.context;this.gridBuffer=w.createVertexBuffer(d,a.bf.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=a.bg.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=a.bg.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new So(l.map),this.orthoMatrix=a.bC(),a.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.al,0,a.al,0,1);const S=w.gl;this._overlapStencilMode=new Sr({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ly(l.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,d){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const _=i.terrain.properties,y=i.terrain.drapeRenderMode===0,w=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.o.now();const S=i.terrain&&i.terrain.scope,A=_.get("source"),P=y?this._mockSourceCache:i.getSourceCache(A,S);if(!P)return void a.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=P,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(l):_.get("exaggeration"),!l.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const M=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(l,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),l.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const l=this._previousCameraAltitude,d=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=d;const _=l!=null?d-l:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=i.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(y);let S=y-this._previousZoom;const A=this._previousUpdateTimestamp;let P=y;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(y-P)>.5&&(S=.5*(y-P+S)),S*_<0&&(P+=S)),this._evaluationZoom=P;const M=w.getExaggeration(P),z=M===w.getExaggeration(Math.max(0,P-.1));if(z&&Math.abs(M-this._exaggeration)<.01)return M;let D=Math.min(.1,.00375*(this._updateTimestamp-A));return(z||M<.1||Math.abs(S)<1e-4)&&(D=Math.min(.2,4*D)),a.ak(this._exaggeration,M,D)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.dataType==="source"&&i.coord?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(A=>{const P=l.getTileByID(A).tileID;return P.projMatrix=d.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const M=P.transform.pointCoordinate(P.transform.getCameraPoint()),z=new a.P(M.x,M.y);A.sort((D,j)=>{if(j.overscaledZ-D.overscaledZ)return j.overscaledZ-D.overscaledZ;const V=new a.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),G=new a.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),te=z.mult(1<<D.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(V)-te.distSqr(G)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const A in w){const P=w[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,i[A],y),P.usedForTerrain))continue;const M=i[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[l.id]=_.map(A=>new Af(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const M=P.tileID.key;M in S||(this._visibleDemTiles.push(P),S[M]=M)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const d=this._findTileCoveringTileID(l,this.sourceCache);d&&(this.terrainTileForTile[l.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),gf(this.painter,_,y))}}_prepareDemTileUniforms(i,l,d,_){if(!l||l.demTexture==null)return!1;const y=i.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-y.z),S=_||"";return d[`u_dem_tl${S}`]=[y.x*w%1,y.y*w%1],d[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const l=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const y=_.dem.tree.minimums[0];return y>0&&i++,d+y},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new a.dI({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new a.T(i,_,l.R32F,{premultiply:!1}),y}setupElevationDraw(i,l,d){const _=this.painter.context,y=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let S=null,A=null,P=1;if(d&&d.morphing&&this._useVertexMorphing){const j=d.morphing.srcDemTile,V=d.morphing.dstDemTile;P=d.morphing.phase,j&&V&&(this._prepareDemTileUniforms(i,j,w,"_prev")&&(A=j),this._prepareDemTileUniforms(i,V,w)&&(S=V))}const M=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let z=null;var D;if(this.enabled?A&&S?(z=S.demTexture,_.activeTexture.set(y.TEXTURE4),A.demTexture.bind(M(A),y.CLAMP_TO_EDGE),w.u_dem_lerp=P):(S=this.terrainTileForTile[i.tileID.key],z=this._prepareDemTileUniforms(i,S,w)?S.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),z&&(w.u_dem_size=(D=z).size[0]===1?1:D.size[0]-2,z.bind(M(S),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,l,w),d&&d.useMeterToDem&&S){const j=(1<<S.tileID.canonical.z)*a.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=j}if(d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),l.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,i.tileID.canonical,d&&d.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,j)}}globeUniformValues(i,l,d){const _=i.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,a.al,0),u_tile_br_up:_.upVector(l,a.al,a.al),u_tile_bl_up:_.upVector(l,0,a.al),u_tile_up_scale:d?a.dJ(1):_.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const l=this.painter,d=this.painter.context;i.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,w,S,A){if(_.transform.projection.name==="globe")(function(P,M,z,D,j){const V=P.context,G=V.gl;let te,K;const oe=P.transform,he=a.dA(P,V,oe),ge=(rt,$e)=>{if(K===$e)return;const Qe=[qm[$e],"PROJECTION_GLOBE_VIEW"];he&&Qe.push("CUSTOM_ANTIALIASING");const kt=P.isTileAffectedByFog(rt);te=P.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:kt}),K=$e},Se=P.colorModeForRenderPass(),be=new Ht(G.LEQUAL,Ht.ReadWrite,P.depthRangeFor3D);Ml.update(j);const Ee=a.dB(oe),Te=[a.aF(oe.center.lng),a.aJ(oe.center.lat)],we=P.globeSharedBuffers,Ae=[oe.width*a.o.devicePixelRatio,oe.height*a.o.devicePixelRatio],qe=Float32Array.from(oe.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};{const rt=P.transform,$e=Zm(rt.zoom,M.exaggeration(),M.sourceCache._source.tileSize);K=-1;const Qe=G.TRIANGLES;for(const kt of D){const We=z.getTile(kt),Oe=Sr.disabled,ot=M.prevTerrainTileForTile[kt.key],Xe=M.terrainTileForTile[kt.key];Ef(ot,Xe)&&Ml.newMorphing(kt.key,ot,Xe,j,250),V.activeTexture.set(G.TEXTURE0),We.texture&&We.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const gt=Ml.getMorphValuesForProxy(kt.key),Ct=gt?1:0;gt&&Object.assign(Ne,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:a.dz(gt.phase)}});const jt=a.dC(kt.canonical),St=a.dD(jt.getCenter().lat),xt=a.dE(kt.canonical,jt,St,rt.worldSize/rt._pixelsPerMercatorPixel),lr=a.bk(a.dF(kt.canonical)),tr=Sf(rt.expandedFarZProjMatrix,qe,Ee,lr,a.aj(rt.zoom),Te,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,Ae,$e,rt._farZ,xt);if(ge(kt,Ct),te&&(M.setupElevationDraw(We,te,Ne),P.uploadCommonUniforms(V,te,kt.toUnwrapped()),we)){const[nr,er,Rr]=we.getGridBuffers(St,$e!==0);te.draw(P,Qe,be,Oe,Se,Pr.backCCW,tr,"globe_raster",nr,er,Rr)}}}if(we&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&rt.push("CUSTOM_ANTIALIASING"),te=P.getOrCreateProgram("globeRaster",{defines:rt});for(const $e of D){const{x:Qe,y:kt,z:We}=$e.canonical,Oe=kt===0,ot=kt===(1<<We)-1,[Xe,gt,Ct,jt]=we.getPoleBuffers(We,!1);if(jt&&(Oe||ot)){const St=z.getTile($e);V.activeTexture.set(G.TEXTURE0),St.texture&&St.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let xt=a.dG(We,Qe,oe);const lr=a.bk(a.dF($e.canonical)),tr=(nr,er)=>nr.draw(P,G.TRIANGLES,be,Sr.disabled,Se,Pr.disabled,Sf(oe.expandedFarZProjMatrix,xt,xt,lr,0,Te,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ae,0,oe._farZ),"globe_pole_raster",er,Ct,jt);M.setupElevationDraw(St,te,Ne),P.uploadCommonUniforms(V,te,$e.toUnwrapped()),Oe&&P.renderDefaultNorthPole&&tr(te,Xe),ot&&P.renderDefaultSouthPole&&(xt=a.cR(a.bC(),xt,[1,-1,1]),tr(te,gt))}}}})(_,y,w,S,A);else{const P=_.context,M=P.gl;let z,D;const j=_.shadowRenderer,V=Pl(_,_.longestCutoffRange),G=Se=>{if(D===Se)return;const be=[];be.push(qm[Se]),V.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),j&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&be.push("NORMAL_OFFSET")),z=_.getOrCreateProgram("terrainRaster",{defines:be}),D=Se},te=_.colorModeForRenderPass(),K=new Ht(M.LEQUAL,Ht.ReadWrite,_.depthRangeFor3D);Ml.update(A);const oe=_.transform,he=Zm(oe.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ge=[0,0,0];if(j){const Se=_.style.directionalLight,be=_.style.ambientLight;Se&&be&&(ge=oa(_.style,Se,be))}{D=-1;const Se=M.TRIANGLES,[be,Ee]=[y.gridIndexBuffer,y.gridSegments];for(const Te of S){const we=w.getTile(Te),Ae=Sr.disabled,qe=y.prevTerrainTileForTile[Te.key],Ne=y.terrainTileForTile[Te.key];Ef(qe,Ne)&&Ml.newMorphing(Te.key,qe,Ne,A,250),P.activeTexture.set(M.TEXTURE0),we.texture&&we.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const rt=Ml.getMorphValuesForProxy(Te.key),$e=rt?1:0;let Qe;rt&&(Qe={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:a.dz(rt.phase)}});const kt=Wm(Te.projMatrix,Q1(Te.canonical,oe.renderWorldCopies)?he/10:he,ge);if(G($e),!z)continue;y.setupElevationDraw(we,z,Qe);const We=Te.toUnwrapped();j&&j.setupShadows(We,z),_.uploadCommonUniforms(P,z,We,null,V),z.draw(_,Se,K,Ae,te,Pr.backCCW,kt,"terrain_raster",y.gridBuffer,be,Ee)}}}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const l=this.painter,d=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),S=l.style.order,A=[];let P=0;for(const M of y){const z=_.getTileByID(M.proxyTileKey),D=_.proxyCachedFBO[M.key]?_.proxyCachedFBO[M.key][i]:void 0,j=D!==void 0?_.renderCache[D]:this.pool[P++],V=D!==void 0;if(z.texture=j.tex,V&&!j.dirty){A.push(z.tileID);continue}let G;d.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(d.clear({color:a.ao.transparent,stencil:0}),j.dirty=!1);for(let te=w.start;te<=w.end;++te){const K=l.style._mergedLayers[S[te]];if(K.isHidden(l.transform.zoom))continue;const oe=l.style.getLayerSourceCache(K),he=oe?this.proxyToSource[M.key][oe.id]:[M];if(!he)continue;const ge=he;d.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(oe?oe.id:null)&&(this._setupStencil(j,he,K,oe),G=oe?oe.id:null),l.renderLayer(l,oe,K,ge)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const K=l.style._mergedLayers[S[te]];if(K.isHidden(l.transform.zoom))continue;const oe=l.style.getLayerSourceCache(K),he=oe?this.proxyToSource[M.key][oe.id]:[M];if(!he)continue;const ge=he;d.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(oe?oe.id:null)&&(this._setupStencil(j,he,K,oe),G=oe?oe.id:null),l.renderLayer(l,oe,K,ge)}this.renderedToTile?(j.dirty=!0,A.push(z.tileID)):V||--P,P===5&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}isLayerOrderingCorrect(i){const l=i.order.length;let d=-1,_=l;for(let y=0;y<l;++y)this._style.isLayerDraped(i._mergedLayers[i.order[y]])?d=Math.max(d,y):_=Math.min(_,y);return _>d}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,S=1<<w.overscaledZ,{x:A,y:P}=w.canonical,M=A/S,z=(A+1)/S,D=P/S,j=(P+1)/S;return{minx:M,miny:D,maxx:z,maxy:j,t:y.dem.tree.raycastRoot(M,D,z,j,i,l,d),tile:y}});_.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,i,l,d);if(w!=null)return w}return null}_createFBO(){const i=this.painter.context,l=i.gl,d=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const _=new a.T(i,{width:d[0],height:d[1],data:null},l.RGBA8);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=i.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new J1(i,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._mergedLayers[i],d=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!d&&l.shouldRedrape():!d&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const d of this._style.getSources())if(d instanceof ws){i=!0;break}if(!i)return;const l={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(y&&!l[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof a.ad){l[y.id]=!0;for(const w of this.proxyCoords){const S=this.proxyToSource[w.key][y.id];if(S)for(const A of S)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof ru){i=!0;break}if(!i)return;const l={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(!y||l[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][y.id];if(A)for(const P of A){const M=gc(y.getTile(P),y.findLoadedParent(P,0),y,this.painter.transform,w);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(y.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,l=i.length;if(l===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,y=0,w=this._style._mergedLayers[i[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<l;)w=this._style._mergedLayers[i[y]];for(;y<l;++y){const S=this._style._mergedLayers[i[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=y):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(d.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:y-1}),d.length!==0){const S=d[d.length-1];this._pendingGroundEffectLayers.every(A=>A>S.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<w.length;++S){const A=Object.values(w[S]);l.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const S=d[w];if(l.getTileByID(S.key),l.proxyCachedFBO[S.key]!==void 0){const A=i[S.key],P=this.proxyToSource[S.key];let M=0;for(const z in P){const D=P[z],j=A[z];if(!j||j.length!==D.length||D.some((V,G)=>V!==j[G]||_[z]&&_[z].hasOwnProperty(V.key))){M=-1;break}++M}for(const z in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][z]].dirty=M<0||M!==Object.values(A).length}}const y=[...this._drapedRenderBatches];y.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of y)for(const S of d){if(l.proxyCachedFBO[S.key])continue;let A=l.renderCachePool.pop();A===void 0&&l.renderCache.length<50&&(A=l.renderCache.length,l.renderCache.push(this._createFBO())),A!==void 0&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][w.start]=A,l.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):Sr.disabled}_renderTileClippingMasks(i,l){const d=this.painter,_=this.painter.context,y=_.gl;d._tileClippingMaskIDs={},_.setColorMode(Ur.disabled),_.setDepthMode(Ht.disabled);const w=d.getOrCreateProgram("clippingMask");for(const S of i){const A=d._tileClippingMaskIDs[S.key]=--l;w.draw(d,y.TRIANGLES,Ht.disabled,new Sr({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Ur.disabled,Pr.disabled,mc(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const d=[i.x,i.y,1,1];a.aC(d,d,l.pixelMatrixInverse),a.cJ(d,d,1/d[3]),d[0]/=l.worldSize,d[1]/=l.worldSize;const _=l._camera.position,y=a.ce(1,l.center.lat),w=[_[0],_[1],_[2]/y,0],S=a.d9([],d.slice(0,3),w);a.aw(S,S);const A=this.raycast(w,S,this._exaggeration);return A!==null&&A?(a.bH(w,w,S,A),w[3]=w[2],w[2]*=y,w):null}_setupProxiedCoordsForOrtho(i,l,d){if(i.getSource()instanceof a.aS)return this._setupProxiedCoordsForImageSource(i,l,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const _=this.proxiedCoords[i.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){const P=y[A],M=this._findTileCoveringTileID(P,i);if(M){const z=this._createProxiedId(P,M,d[P.key]&&d[P.key][i.id]);_.push(z),this.proxyToSource[P.key][i.id]=[z]}}let w=!1;const S=new Set;for(let A=0;A<l.length;A++){const P=i.getTile(l[A]);if(!P||!P.hasData())continue;const M=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==P.tileID.canonical.z){const z=this.proxyToSource[M.tileID.key][i.id],D=this._createProxiedId(M.tileID,P,d[M.tileID.key]&&d[M.tileID.key][i.id]);z?z.splice(z.length-1,0,D):this.proxyToSource[M.tileID.key][i.id]=[D];const j=this.proxyToSource[M.tileID.key][i.id];S.has(j)||S.add(j),_.push(D),w=!0}}if(this._sourceTilesOverlap[i.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const A of S)A.sort((P,M)=>M.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(i,l,d){if(!i.getSource().loaded())return;const _=this.proxiedCoords[i.id]=[],y=this.proxyCoords,w=i.getSource(),S=w.tileID;if(!S)return;const A=new a.P(S.x,S.y)._div(1<<S.z),P=w.coordinates.map(a.ae.fromLngLat).reduce((z,D)=>(z.min.x=Math.min(z.min.x,D.x-A.x),z.min.y=Math.min(z.min.y,D.y-A.y),z.max.x=Math.max(z.max.x,D.x-A.x),z.max.y=Math.max(z.max.y,D.y-A.y),z),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(z,D)=>{const j=z.wrap+z.canonical.x/(1<<z.canonical.z),V=z.canonical.y/(1<<z.canonical.z),G=a.al/(1<<z.canonical.z),te=D.wrap+D.canonical.x/(1<<D.canonical.z),K=D.canonical.y/(1<<D.canonical.z);return j+G<te+P.min.x||j>te+P.max.x||V+G<K+P.min.y||V>K+P.max.y};for(let z=0;z<y.length;z++){const D=y[z];for(let j=0;j<l.length;j++){const V=i.getTile(l[j]);if(!V||!V.hasData()||M(D,V.tileID))continue;const G=this._createProxiedId(D,V,d[D.key]&&d[D.key][i.id]),te=this.proxyToSource[D.key][i.id];te?te.push(G):this.proxyToSource[D.key][i.id]=[G],_.push(G)}}}_createProxiedId(i,l,d){let _=this.orthoMatrix;if(d){const y=d.find(w=>w.key===l.tileID.key);if(y)return y}if(l.tileID.key!==i.key){const y=i.canonical.z-l.tileID.canonical.z;let w,S,A;_=a.bC();const P=l.tileID.wrap-i.wrap<<i.overscaledZ;y>0?(w=a.al>>y,S=w*((l.tileID.canonical.x<<y)-i.canonical.x+P),A=w*((l.tileID.canonical.y<<y)-i.canonical.y)):(w=a.al<<-y,S=a.al*(l.tileID.canonical.x-(i.canonical.x+P<<-y)),A=a.al*(l.tileID.canonical.y-(i.canonical.y<<-y))),a.cd(_,0,w,0,w,0,1),a.br(_,_,[S,A,0])}return new Af(l.tileID,i.key,_)}_findTileCoveringTileID(i,l){let d=l.getTile(i);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[l.id],y=_[i.key];if(d=y?l.getTileByID(y):null,d&&d.hasData()||y===null)return d;let w=d?d.tileID:i,S=w.overscaledZ;const A=l.getSource().minzoom,P=[];if(!y){const z=l.getSource().maxzoom;if(i.canonical.z>=z){const D=i.canonical.z-z;l.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,l.transform.tileZoom),w=new a.aO(S,i.wrap,z,i.canonical.x>>D,i.canonical.y>>D)):D!==0&&(S=z,w=new a.aO(S,i.wrap,z,i.canonical.x>>D,i.canonical.y>>D))}w.key!==i.key&&(P.push(w.key),d=l.getTile(w))}const M=z=>{P.forEach(D=>{_[D]=z}),P.length=0};for(S-=1;S>=A&&(!d||!d.hasData());S--){d&&M(d.tileID.key);const z=w.calculateScaledKey(S);if(d=l.getTileByID(z),d&&d.hasData())break;const D=_[z];if(D===null)break;D===void 0?P.push(z):d=l.getTileByID(D)}return M(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[l.key]=!0}}function If(f,i,l){const d=function(S,A,P){const M=a.bJ(A,S),z=a.bJ(P,[.2126,.7152,.0722]),D=(V,G,te)=>(1-te)*V+te*G,j=D(1-.3*Math.min(z,1),1,Math.min(M+1,1));return D(.92,1,Math.asin(a.aA(A[2],-1,1))/Math.PI+.5)*j}(f,[0,0,1],i),_=[0,0,0];a.c4(_,l.slice(0,3),d);const y=[0,0,0];a.c4(y,i.slice(0,3),f[2]);const w=[0,0,0];return a.d7(w,_,y),a.da(w)}const Xm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Km=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Cf{static cacheKey(i,l,d,_){let y=`${l}${_?_.cacheKey:""}`;for(const w of d)i.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(i,l,d,_,y,w){const S=i.gl;this.program=S.createProgram(),this.configuration=_,this.name=l,this.fixedDefines=[...w];let A=_?_.defines():[];A=A.concat(w.map(V=>`#define ${V}`));const P=`#version 300 es
`;let M=P+A.concat("precision mediump float;",Ca,Uh.fragmentSource).join(`
`);for(const V of d.fragmentIncludes)M+=`
${gu[V]}`;M+=`
${d.fragmentSource}`;let z=P+A.concat("precision highp float;",Ca,Uh.vertexSource).join(`
`);for(const V of d.vertexIncludes)z+=`
${gu[V]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(z+=`
uniform int u_instanceID;
`),z+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(z=z.replaceAll("gl_InstanceID","u_instanceID"));const D=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(D,M),S.compileShader(D),S.attachShader(this.program,D);const j=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(j,z),S.compileShader(j),S.attachShader(this.program,j),this.attributes={},S.linkProgram(this.program),S.deleteShader(j),S.deleteShader(D),this.fixedUniforms=y(i),this.binderUniforms=_?_.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(V=>({u_instanceID:new a.cg(V)}))(i)),(w.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(V=>({u_dem:new a.cg(V),u_dem_prev:new a.cg(V),u_dem_tl:new a.cj(V),u_dem_scale:new a.ci(V),u_dem_tl_prev:new a.cj(V),u_dem_scale_prev:new a.ci(V),u_dem_size:new a.ci(V),u_dem_lerp:new a.ci(V),u_exaggeration:new a.ci(V),u_depth:new a.cg(V),u_depth_size_inv:new a.cj(V),u_depth_range_unpack:new a.cj(V),u_occluder_half_size:new a.ci(V),u_occlusion_depth_offset:new a.ci(V),u_meter_to_dem:new a.ci(V),u_label_plane_matrix_inv:new a.ck(V)}))(i)),w.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new a.ch(V),u_tile_tr_up:new a.ch(V),u_tile_br_up:new a.ch(V),u_tile_bl_up:new a.ch(V),u_tile_up_scale:new a.ci(V)}))(i)),w.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new a.ck(V),u_fog_range:new a.cj(V),u_fog_color:new a.d2(V),u_fog_horizon_blend:new a.ci(V),u_fog_vertical_limit:new a.cj(V),u_fog_temporal_offset:new a.ci(V),u_frustum_tl:new a.ch(V),u_frustum_tr:new a.ch(V),u_frustum_br:new a.ch(V),u_frustum_bl:new a.ch(V),u_globe_pos:new a.ch(V),u_globe_radius:new a.ci(V),u_globe_transition:new a.ci(V),u_is_globe:new a.cg(V),u_viewport:new a.cj(V)}))(i)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(V=>({u_cutoff_params:new a.d2(V)}))(i)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(V=>({u_lighting_ambient_color:new a.ch(V),u_lighting_directional_dir:new a.ch(V),u_lighting_directional_color:new a.ch(V),u_ground_radiance:new a.ch(V)}))(i)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(V=>({u_light_matrix_0:new a.ck(V),u_light_matrix_1:new a.ck(V),u_fade_range:new a.cj(V),u_shadow_normal_offset:new a.ch(V),u_shadow_intensity:new a.ci(V),u_shadow_texel_size:new a.ci(V),u_shadow_map_resolution:new a.ci(V),u_shadow_direction:new a.ch(V),u_shadow_bias:new a.ch(V),u_shadowmap_0:new a.cg(V),u_shadowmap_1:new a.cg(V)}))(i)))}getAttributeLocation(i,l){let d=this.attributes[l];return d===void 0&&(d=this.attributes[l]=i.getAttribLocation(this.program,l)),d}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)d[_]&&d[_].set(this.program,_,l[_])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)d[_]&&d[_].set(this.program,_,l[_])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)d[_].set(this.program,_,l[_])}}setCutoffUniformValues(i,l){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)d[_].set(this.program,_,l[_])}}setLightsUniformValues(i,l){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)d[_].set(this.program,_,l[_])}}setShadowUniformValues(i,l){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;i.program.set(this.program);for(const _ in l)d[_].set(this.program,_,l[_])}_drawDebugWireframe(i,l,d,_,y,w,S,A,P,M){const z=i.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const D=i.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||i._terrain&&i._terrain.renderingToTexture||!Xm.includes(this.name))||!(!z.layers3D||!Km.includes(this.name))))return;const j=D.gl,V=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,y,D);if(!V)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const te=i.getOrCreateProgram(this.name,{config:this.configuration,defines:G});D.program.set(te.program);const K=(ge,Se,be)=>{if(Se[ge]&&be[ge])for(const Ee in Se[ge])be[ge][Ee]&&be[ge][Ee].set(be.program,Ee,Se[ge][Ee].current)};P&&P.setUniforms(te.program,D,te.binderUniforms,S,{zoom:A}),K("fixedUniforms",this,te),K("terrainUniforms",this,te),K("globeUniforms",this,te),K("fogUniforms",this,te),K("lightsUniforms",this,te),K("shadowUniforms",this,te),V.bind(),D.setColorMode(new Ur([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],a.ao.transparent,[!0,!0,!0,!1])),D.setDepthMode(new Ht(l.func===j.LESS?j.LEQUAL:l.func,Ht.ReadOnly,l.range)),D.setStencilMode(Sr.disabled);const oe=3*w.primitiveLength*2,he=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ge=M||1;for(let Se=0;Se<ge;++Se)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,he)}else M&&M>1?j.drawElementsInstanced(j.LINES,oe,j.UNSIGNED_SHORT,he,M):j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,he);y.bind(),D.program.set(this.program),D.setDepthMode(l),D.setStencilMode(d),D.setColorMode(_)}checkUniforms(i,l,d){if(this.fixedDefines.includes(l)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${_} not set but required by ${l} being defined`)}}draw(i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te){const K=i.context,oe=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(d),K.setStencilMode(_),K.setColorMode(y),K.setCullFace(w);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,S[Se]);V&&V.setUniforms(this.program,K,this.binderUniforms,D,{zoom:j});const he={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[l];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ge=te&&te>0?1:void 0;for(const Se of z.get()){const be=Se.vaos||(Se.vaos={});if((be[A]||(be[A]=new _u)).bind(K,this,P,V?V.getPaintVertexBuffers():[],M,Se.vertexOffset,G||[],ge),this.forceManualRenderingForInstanceIDShaders){const Ee=te||1;for(let Te=0;Te<Ee;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),M?oe.drawElements(l,Se.primitiveLength*he,oe.UNSIGNED_SHORT,Se.primitiveOffset*he*2):oe.drawArrays(l,Se.vertexOffset,Se.vertexLength)}else te&&te>1?oe.drawElementsInstanced(l,Se.primitiveLength*he,oe.UNSIGNED_SHORT,Se.primitiveOffset*he*2,te):M?oe.drawElements(l,Se.primitiveLength*he,oe.UNSIGNED_SHORT,Se.primitiveOffset*he*2):oe.drawArrays(l,Se.vertexOffset,Se.vertexLength);l===oe.TRIANGLES&&M&&this._drawDebugWireframe(i,d,_,y,M,Se,D,j,V,te)}}}function Gh(f,i,l=0){const d=Math.pow(2,i.tileID.overscaledZ),_=i.tileSize*Math.pow(2,f.transform.tileZoom)/d,y=_*(i.tileID.canonical.x+i.tileID.wrap*d),w=_*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(i,1,f.transform.tileZoom),u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w],u_pattern_transition:l}}const wu={terrain:0,flat:1},Ym=a.bC(),Hh=(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K)=>{const oe=i.style.light,he=oe.properties.get("position"),ge=[he.x,he.y,he.z],Se=a.dL();oe.properties.get("anchor")==="viewport"&&(a.dM(Se,-i.transform.angle),a.dN(ge,ge,Se));const be=oe.properties.get("color").toPremultipliedRenderColor(null),Ee=i.transform,Te={u_matrix:f,u_lightpos:ge,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+l,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ym,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:wu[P],u_base_type:wu[M],u_ao:_,u_edge_radius:y,u_width_scale:w,u_flood_light_color:V,u_vertical_scale:G,u_flood_light_intensity:te,u_ground_shadow_factor:K};return Ee.projection.name==="globe"&&(Te.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],Te.u_zoom_transition=z,Te.u_inv_rot_matrix=j,Te.u_merc_center=D,Te.u_up_dir=Ee.projection.upVector(new a.cC(0,0,0),D[0]*a.al,D[1]*a.al),Te.u_height_lift=A),Te},Jm=(f,i,l,d,_,y)=>({u_matrix:f,u_edge_radius:i,u_width_scale:l,u_vertical_scale:d,u_height_type:wu[_],u_base_type:wu[y]}),cy=(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K)=>{const oe=Hh(f,i,l,d,_,y,w,S,P,M,z,D,j,V,G,te,1,[0,0,0]),he={u_height_factor:-Math.pow(2,S.overscaledZ)/A.tileSize/8};return Object.assign(oe,Gh(i,A,K),he)},Qm=(f,i,l)=>({u_matrix:f,u_emissive_strength:i,u_ground_shadow_factor:l}),_c=(f,i,l,d,_,y=0)=>Object.assign(Qm(f,i,_),Gh(l,d,y)),ew=(f,i,l,d)=>({u_matrix:f,u_world:l,u_emissive_strength:i,u_ground_shadow_factor:d}),tw=(f,i,l,d,_,y,w=0)=>Object.assign(_c(f,i,l,d,y,w),{u_world:_}),rw=(f,i)=>({u_matrix:f,u_ground_shadow_factor:i}),Pf=(f,i,l,d,_)=>({u_matrix:f,u_camera_pos:[i[0],i[1],i[2]],u_depth_bias:l,u_height_scale:d,u_reset_depth:_}),iw=(f,i,l,d,_,y,w)=>({u_matrix:f,u_normal_matrix:i,u_opacity:l,u_faux_facade_ao_intensity:d,u_camera_pos:_,u_tile_to_meter:y,u_facade_emissive_chance:w}),nw=f=>({u_matrix:f}),e0=f=>({u_matrix:f}),t0=(f,i,l,d,_,y,w,S)=>{const A=a.al/y.tileSize;return{u_matrix:f,u_inv_rot_matrix:i,u_camera_to_center_distance:l.getCameraToCenterDistance(S),u_extrude_scale:[l.pixelsToGLUnits[0]/A,l.pixelsToGLUnits[1]/A],u_zoom_transition:d,u_tile_id:w,u_merc_center:_}},r0=(f,i,l=1)=>({u_matrix:f,u_color:i,u_overlay:0,u_overlay_scale:l}),bu=a.bC(),uy=(f,i,l,d,_,y,w)=>{const S=f.transform,A=S.projection.name==="globe",P=A?a.dO(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:a.ay(l,1,y),M={u_matrix:i.projMatrix,u_extrude_scale:P,u_intensity:w,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){M.u_inv_rot_matrix=d,M.u_merc_center=_,M.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],M.u_zoom_transition=a.aj(S.zoom);const z=_[0]*a.al,D=_[1]*a.al;M.u_up_dir=S.projection.upVector(new a.cC(0,0,0),z,D)}return M};function i0(f,[i,l,d,_],[y,w]){if(y===w)return[0,0,0,0];const S=255*(f-1)/(f*(w-y));return[i*S,l*S,d*S,_*S]}function n0(f,i,[l,d]){return l===d?0:.5/f+(i-l)*(f-1)/(f*(d-l))}const kf=(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe,he,ge)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:P,u_fade_t:M.mix,u_opacity:M.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:a.dQ(z.paint.get("raster-saturation")),u_contrast_factor:a.dP(z.paint.get("raster-contrast")),u_spin_weights:yc(z.paint.get("raster-hue-rotate")),u_perspective_transform:D,u_raster_elevation:j,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:A,u_colorization_mix:i0(a.dR,G,K),u_colorization_offset:n0(a.dR,te,K),u_color_ramp:V,u_texture_offset:[he/(oe+2*he),oe/(oe+2*he)],u_texture_res:[oe+2*he,oe+2*he],u_emissive_strength:ge});function yc(f){f*=Math.PI/180;const i=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const xc=.05,Dl=(f,i,l,d,_,y,w,S,A,P,M,z)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:P,u_fade_t:M.mix,u_opacity:M.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:A}),s0=(f,i,l,d,_,y,w,S,A,P)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:l,u_velocity:d,u_color_ramp:y,u_velocity_res:_,u_max_speed:w,u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[xc,xc]}),Rf=(f,i,l,d,_,y,w,S,A,P)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:l,u_velocity_res:d,u_max_speed:_,u_speed_factor:y,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[xc,xc]}),o0=a.bC(),a0=(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe,he,ge,Se,be,Ee)=>{const Te=_.transform,we={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Te.getCameraToCenterDistance(oe),u_rotate_symbol:+l,u_aspect_ratio:Te.width/Te.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+P,u_elevation_from_sea:A?1:0,u_pitch_with_map:+d,u_texsize:M,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:o0,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:o0,u_up_vector:[0,-1,0],u_color_adj_mat:Se,u_icon_transition:be||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(oe)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ee||1,u_ground_shadow_factor:he,u_inv_matrix:a.bl(a.bC(),w),u_normal_scale:ge,u_lutTexture:wn.LUT};return oe.name==="globe"&&(we.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],we.u_zoom_transition=V,we.u_inv_rot_matrix=te,we.u_merc_center=G,we.u_camera_forward=Te._camera.forward(),we.u_ecef_origin=a.dS(Te.globeMatrix,j.toUnwrapped()),we.u_tile_matrix=Float32Array.from(Te.globeMatrix),we.u_up_vector=K),we},Mf=(f,i,l,d)=>({u_matrix:f,u_emissive_strength:i,u_opacity:l,u_color:d}),Df=(f,i,l,d,_,y,w,S,A)=>Object.assign(function(P,M,z,D,j,V){const{width:G,height:te}=D.imageManager.getPixelSize(M),K=Math.pow(2,V.tileID.overscaledZ),oe=V.tileSize*Math.pow(2,D.transform.tileZoom)/K,he=oe*(V.tileID.canonical.x+V.tileID.wrap*K),ge=oe*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[G,te],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:j?[D.transform.width,-1*D.transform.height]:[1/a.ay(V,1,D.transform.tileZoom),1/a.ay(V,1,D.transform.tileZoom)],u_pixel_coord_upper:[he>>16,ge>>16],u_pixel_coord_lower:[65535&he,65535&ge]}}(0,y,w,d,S,A),{u_matrix:f,u_emissive_strength:i,u_opacity:l}),l0=new Float32Array(a.bA([])),Of=(f,i,l,d,_,y,w,S,A,P,M,z,D,j=[0,0,0],V)=>{const G=_.style.light,te=G.properties.get("position"),K=[-te.x,-te.y,te.z],oe=a.dL();G.properties.get("anchor")==="viewport"&&(a.dM(oe,-_.transform.angle),a.dN(K,K,oe));const he=M.alphaMode==="MASK",ge=G.properties.get("color").toNonPremultipliedRenderColor(null),Se=D.paint.get("model-ambient-occlusion-intensity"),be=D.paint.get("model-color").constantOr(a.ao.white).toNonPremultipliedRenderColor(null);return be.a=D.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:l,u_node_matrix:d||l0,u_lightpos:K,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_camera_pos:j,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+he,u_alphaCutoff:M.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:P,u_baseColorTexture:wn.BaseColor,u_metallicRoughnessTexture:wn.MetallicRoughness,u_normalTexture:wn.Normal,u_occlusionTexture:wn.Occlusion,u_emissionTexture:wn.Emission,u_lutTexture:wn.LUT,u_color_mix:be.toArray01(),u_aoIntensity:Se,u_emissive_strength:z,u_occlusionTextureTransform:V||[0,0,0,0]}},Tu=(f,i=l0,l=l0)=>({u_matrix:f,u_instance:i,u_node_matrix:l}),sw={fillExtrusion:f=>({u_matrix:new a.ck(f),u_lightpos:new a.ch(f),u_lightintensity:new a.ci(f),u_lightcolor:new a.ch(f),u_vertical_gradient:new a.ci(f),u_opacity:new a.ci(f),u_edge_radius:new a.ci(f),u_width_scale:new a.ci(f),u_ao:new a.cj(f),u_height_type:new a.cg(f),u_base_type:new a.cg(f),u_tile_id:new a.ch(f),u_zoom_transition:new a.ci(f),u_inv_rot_matrix:new a.ck(f),u_merc_center:new a.cj(f),u_up_dir:new a.ch(f),u_height_lift:new a.ci(f),u_flood_light_color:new a.ch(f),u_vertical_scale:new a.ci(f),u_flood_light_intensity:new a.ci(f),u_ground_shadow_factor:new a.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new a.ck(f),u_edge_radius:new a.ci(f),u_width_scale:new a.ci(f),u_vertical_scale:new a.ci(f),u_height_type:new a.cg(f),u_base_type:new a.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new a.ck(f),u_lightpos:new a.ch(f),u_lightintensity:new a.ci(f),u_lightcolor:new a.ch(f),u_vertical_gradient:new a.ci(f),u_height_factor:new a.ci(f),u_edge_radius:new a.ci(f),u_width_scale:new a.ci(f),u_ao:new a.cj(f),u_height_type:new a.cg(f),u_base_type:new a.cg(f),u_tile_id:new a.ch(f),u_zoom_transition:new a.ci(f),u_inv_rot_matrix:new a.ck(f),u_merc_center:new a.cj(f),u_up_dir:new a.ch(f),u_height_lift:new a.ci(f),u_image:new a.cg(f),u_texsize:new a.cj(f),u_pixel_coord_upper:new a.cj(f),u_pixel_coord_lower:new a.cj(f),u_tile_units_to_pixels:new a.ci(f),u_opacity:new a.ci(f),u_pattern_transition:new a.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new a.ck(f),u_opacity:new a.ci(f),u_ao_pass:new a.ci(f),u_meter_to_tile:new a.ci(f),u_ao:new a.cj(f),u_flood_light_intensity:new a.ci(f),u_flood_light_color:new a.ch(f),u_attenuation:new a.ci(f),u_edge_radius:new a.ci(f),u_fb:new a.cg(f),u_fb_size:new a.ci(f),u_dynamic_offset:new a.ci(f)}),fill:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_ground_shadow_factor:new a.ch(f)}),fillPattern:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_image:new a.cg(f),u_texsize:new a.cj(f),u_pixel_coord_upper:new a.cj(f),u_pixel_coord_lower:new a.cj(f),u_tile_units_to_pixels:new a.ci(f),u_ground_shadow_factor:new a.ch(f),u_pattern_transition:new a.ci(f)}),fillOutline:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_world:new a.cj(f),u_ground_shadow_factor:new a.ch(f)}),fillOutlinePattern:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_world:new a.cj(f),u_image:new a.cg(f),u_texsize:new a.cj(f),u_pixel_coord_upper:new a.cj(f),u_pixel_coord_lower:new a.cj(f),u_tile_units_to_pixels:new a.ci(f),u_ground_shadow_factor:new a.ch(f),u_pattern_transition:new a.ci(f)}),building:f=>({u_matrix:new a.ck(f),u_normal_matrix:new a.ck(f),u_opacity:new a.ci(f),u_faux_facade_ao_intensity:new a.ci(f),u_camera_pos:new a.ch(f),u_tile_to_meter:new a.ci(f),u_facade_emissive_chance:new a.ci(f)}),buildingBloom:f=>({u_matrix:new a.ck(f)}),buildingDepth:f=>({u_matrix:new a.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new a.ck(f),u_depth_bias:new a.ci(f)}),elevatedStructures:f=>({u_matrix:new a.ck(f),u_ground_shadow_factor:new a.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new a.ck(f),u_camera_pos:new a.ch(f),u_depth_bias:new a.ci(f),u_height_scale:new a.ci(f),u_reset_depth:new a.ci(f)}),circle:a.dV,collisionBox:f=>({u_matrix:new a.ck(f),u_inv_rot_matrix:new a.ck(f),u_camera_to_center_distance:new a.ci(f),u_extrude_scale:new a.cj(f),u_zoom_transition:new a.ci(f),u_merc_center:new a.cj(f),u_tile_id:new a.ch(f)}),collisionCircle:f=>({u_matrix:new a.ck(f),u_inv_matrix:new a.ck(f),u_camera_to_center_distance:new a.ci(f),u_viewport_size:new a.cj(f)}),debug:f=>({u_color:new a.dx(f),u_matrix:new a.ck(f),u_overlay:new a.cg(f),u_overlay_scale:new a.ci(f)}),clippingMask:f=>({u_matrix:new a.ck(f)}),heatmap:f=>({u_extrude_scale:new a.ci(f),u_intensity:new a.ci(f),u_matrix:new a.ck(f),u_inv_rot_matrix:new a.ck(f),u_merc_center:new a.cj(f),u_tile_id:new a.ch(f),u_zoom_transition:new a.ci(f),u_up_dir:new a.ch(f)}),heatmapTexture:f=>({u_image:new a.cg(f),u_color_ramp:new a.cg(f),u_opacity:new a.ci(f)}),hillshade:f=>({u_matrix:new a.ck(f),u_image:new a.cg(f),u_latrange:new a.cj(f),u_light:new a.cj(f),u_shadow:new a.dx(f),u_highlight:new a.dx(f),u_emissive_strength:new a.ci(f),u_accent:new a.dx(f)}),hillshadePrepare:f=>({u_matrix:new a.ck(f),u_image:new a.cg(f),u_dimension:new a.cj(f),u_zoom:new a.ci(f)}),line:a.dU,linePattern:a.dT,raster:f=>({u_matrix:new a.ck(f),u_normalize_matrix:new a.ck(f),u_globe_matrix:new a.ck(f),u_merc_matrix:new a.ck(f),u_grid_matrix:new a.dy(f),u_tl_parent:new a.cj(f),u_scale_parent:new a.ci(f),u_fade_t:new a.ci(f),u_opacity:new a.ci(f),u_image0:new a.cg(f),u_image1:new a.cg(f),u_brightness_low:new a.ci(f),u_brightness_high:new a.ci(f),u_saturation_factor:new a.ci(f),u_contrast_factor:new a.ci(f),u_spin_weights:new a.ch(f),u_perspective_transform:new a.cj(f),u_raster_elevation:new a.ci(f),u_zoom_transition:new a.ci(f),u_merc_center:new a.cj(f),u_cutoff_params:new a.d2(f),u_colorization_mix:new a.d2(f),u_colorization_offset:new a.ci(f),u_color_ramp:new a.cg(f),u_texture_offset:new a.cj(f),u_texture_res:new a.cj(f),u_emissive_strength:new a.ci(f)}),rasterParticle:f=>({u_matrix:new a.ck(f),u_normalize_matrix:new a.ck(f),u_globe_matrix:new a.ck(f),u_merc_matrix:new a.ck(f),u_grid_matrix:new a.dy(f),u_tl_parent:new a.cj(f),u_scale_parent:new a.ci(f),u_fade_t:new a.ci(f),u_opacity:new a.ci(f),u_image0:new a.cg(f),u_image1:new a.cg(f),u_raster_elevation:new a.ci(f),u_zoom_transition:new a.ci(f),u_merc_center:new a.cj(f),u_cutoff_params:new a.d2(f)}),rasterParticleTexture:f=>({u_texture:new a.cg(f),u_opacity:new a.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new a.cg(f),u_particle_texture_side_len:new a.ci(f),u_tile_offset:new a.cj(f),u_velocity:new a.cg(f),u_color_ramp:new a.cg(f),u_velocity_res:new a.cj(f),u_max_speed:new a.ci(f),u_uv_offset:new a.cj(f),u_data_scale:new a.cj(f),u_data_offset:new a.ci(f),u_particle_pos_scale:new a.ci(f),u_particle_pos_offset:new a.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new a.cg(f),u_particle_texture_side_len:new a.ci(f),u_velocity:new a.cg(f),u_velocity_res:new a.cj(f),u_max_speed:new a.ci(f),u_speed_factor:new a.ci(f),u_reset_rate:new a.ci(f),u_rand_seed:new a.ci(f),u_uv_offset:new a.cj(f),u_data_scale:new a.cj(f),u_data_offset:new a.ci(f),u_particle_pos_scale:new a.ci(f),u_particle_pos_offset:new a.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new a.cg(f),u_is_size_feature_constant:new a.cg(f),u_size_t:new a.ci(f),u_size:new a.ci(f),u_camera_to_center_distance:new a.ci(f),u_rotate_symbol:new a.cg(f),u_aspect_ratio:new a.ci(f),u_fade_change:new a.ci(f),u_matrix:new a.ck(f),u_label_plane_matrix:new a.ck(f),u_coord_matrix:new a.ck(f),u_is_text:new a.cg(f),u_elevation_from_sea:new a.cg(f),u_pitch_with_map:new a.cg(f),u_texsize:new a.cj(f),u_texsize_icon:new a.cj(f),u_texture:new a.cg(f),u_texture_icon:new a.cg(f),u_gamma_scale:new a.ci(f),u_device_pixel_ratio:new a.ci(f),u_tile_id:new a.ch(f),u_zoom_transition:new a.ci(f),u_inv_rot_matrix:new a.ck(f),u_merc_center:new a.cj(f),u_camera_forward:new a.ch(f),u_tile_matrix:new a.ck(f),u_up_vector:new a.ch(f),u_ecef_origin:new a.ch(f),u_is_halo:new a.cg(f),u_icon_transition:new a.ci(f),u_color_adj_mat:new a.ck(f),u_scale_factor:new a.ci(f),u_ground_shadow_factor:new a.ch(f),u_inv_matrix:new a.ck(f),u_normal_scale:new a.ci(f),u_lutTexture:new a.cg(f)}),background:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_opacity:new a.ci(f),u_color:new a.dx(f)}),backgroundPattern:f=>({u_matrix:new a.ck(f),u_emissive_strength:new a.ci(f),u_opacity:new a.ci(f),u_image:new a.cg(f),u_pattern_tl:new a.cj(f),u_pattern_br:new a.cj(f),u_texsize:new a.cj(f),u_pattern_size:new a.cj(f),u_pixel_coord_upper:new a.cj(f),u_pixel_coord_lower:new a.cj(f),u_pattern_units_to_pixels:new a.cj(f)}),terrainRaster:f=>({u_matrix:new a.ck(f),u_image0:new a.cg(f),u_skirt_height:new a.ci(f),u_ground_shadow_factor:new a.ch(f)}),skybox:f=>({u_matrix:new a.ck(f),u_sun_direction:new a.ch(f),u_cubemap:new a.cg(f),u_opacity:new a.ci(f),u_temporal_offset:new a.ci(f)}),skyboxGradient:f=>({u_matrix:new a.ck(f),u_color_ramp:new a.cg(f),u_center_direction:new a.ch(f),u_radius:new a.ci(f),u_opacity:new a.ci(f),u_temporal_offset:new a.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new a.dy(f),u_sun_direction:new a.ch(f),u_sun_intensity:new a.ci(f),u_color_tint_r:new a.d2(f),u_color_tint_m:new a.d2(f),u_luminance:new a.ci(f)}),globeRaster:f=>({u_proj_matrix:new a.ck(f),u_globe_matrix:new a.ck(f),u_normalize_matrix:new a.ck(f),u_merc_matrix:new a.ck(f),u_zoom_transition:new a.ci(f),u_merc_center:new a.cj(f),u_image0:new a.cg(f),u_grid_matrix:new a.dy(f),u_skirt_height:new a.ci(f),u_far_z_cutoff:new a.ci(f),u_frustum_tl:new a.ch(f),u_frustum_tr:new a.ch(f),u_frustum_br:new a.ch(f),u_frustum_bl:new a.ch(f),u_globe_pos:new a.ch(f),u_globe_radius:new a.ci(f),u_viewport:new a.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new a.ch(f),u_frustum_tr:new a.ch(f),u_frustum_br:new a.ch(f),u_frustum_bl:new a.ch(f),u_horizon:new a.ci(f),u_transition:new a.ci(f),u_fadeout_range:new a.ci(f),u_atmosphere_fog_color:new a.d2(f),u_high_color:new a.d2(f),u_space_color:new a.d2(f),u_temporal_offset:new a.ci(f),u_horizon_angle:new a.ci(f)}),model:f=>({u_matrix:new a.ck(f),u_lighting_matrix:new a.ck(f),u_normal_matrix:new a.ck(f),u_node_matrix:new a.ck(f),u_lightpos:new a.ch(f),u_lightintensity:new a.ci(f),u_lightcolor:new a.ch(f),u_camera_pos:new a.ch(f),u_opacity:new a.ci(f),u_baseColorFactor:new a.d2(f),u_emissiveFactor:new a.d2(f),u_metallicFactor:new a.ci(f),u_roughnessFactor:new a.ci(f),u_baseTextureIsAlpha:new a.cg(f),u_alphaMask:new a.cg(f),u_alphaCutoff:new a.ci(f),u_baseColorTexture:new a.cg(f),u_metallicRoughnessTexture:new a.cg(f),u_normalTexture:new a.cg(f),u_occlusionTexture:new a.cg(f),u_emissionTexture:new a.cg(f),u_lutTexture:new a.cg(f),u_color_mix:new a.d2(f),u_aoIntensity:new a.ci(f),u_emissive_strength:new a.ci(f),u_occlusionTextureTransform:new a.d2(f)}),modelDepth:f=>({u_matrix:new a.ck(f),u_instance:new a.ck(f),u_node_matrix:new a.ck(f)}),groundShadow:f=>({u_matrix:new a.ck(f),u_ground_shadow_factor:new a.ch(f)}),stars:f=>({u_matrix:new a.ck(f),u_up:new a.ch(f),u_right:new a.ch(f),u_intensity_multiplier:new a.ci(f)}),snowParticle:f=>({u_modelview:new a.ck(f),u_projection:new a.ck(f),u_time:new a.ci(f),u_cam_pos:new a.ch(f),u_velocityConeAperture:new a.ci(f),u_velocity:new a.ci(f),u_horizontalOscillationRadius:new a.ci(f),u_horizontalOscillationRate:new a.ci(f),u_boxSize:new a.ci(f),u_billboardSize:new a.ci(f),u_simpleShapeParameters:new a.cj(f),u_screenSize:new a.cj(f),u_thinningCenterPos:new a.cj(f),u_thinningShape:new a.ch(f),u_thinningAffectedRatio:new a.ci(f),u_thinningParticleOffset:new a.ci(f),u_particleColor:new a.d2(f),u_direction:new a.ch(f)}),rainParticle:f=>({u_modelview:new a.ck(f),u_projection:new a.ck(f),u_time:new a.ci(f),u_cam_pos:new a.ch(f),u_texScreen:new a.cg(f),u_velocityConeAperture:new a.ci(f),u_velocity:new a.ci(f),u_boxSize:new a.ci(f),u_rainDropletSize:new a.cj(f),u_distortionStrength:new a.ci(f),u_rainDirection:new a.ch(f),u_color:new a.d2(f),u_screenSize:new a.cj(f),u_thinningCenterPos:new a.cj(f),u_thinningShape:new a.ch(f),u_thinningAffectedRatio:new a.ci(f),u_thinningParticleOffset:new a.ci(f),u_shapeDirectionalPower:new a.ci(f),u_shapeNormalPower:new a.ci(f),u_mode:new a.ci(f)}),vignette:f=>({u_vignetteShape:new a.ch(f),u_vignetteColor:new a.d2(f)}),occlusion:f=>({u_matrix:new a.ck(f),u_anchorPos:new a.ch(f),u_screenSizePx:new a.cj(f),u_occluderSizePx:new a.cj(f),u_color:new a.d2(f)})};class Ol{constructor(i,l,d,_){this.id=Ol.uniqueIdxCounter,Ol.uniqueIdxCounter++,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Ol.uniqueIdxCounter,Ol.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ol.uniqueIdxCounter=0;const hy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ow{constructor(i,l,d,_,y,w){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=i;const S=i.gl;this.buffer=S.createBuffer(),i.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||y||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let d=0;d<this.attributes.length;d++){const _=l.getAttributeLocation(i,this.attributes[d].name);_!==-1&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,l,d){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],w=l.getAttributeLocation(i,y.name);w!==-1&&i.vertexAttribPointer(w,y.components,i[hy[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(i,l,d){for(let _=0;_<this.attributes.length;_++){const y=l.getAttributeLocation(i,this.attributes[_].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lf{constructor(i,l,d,_,y){this.context=i,this.width=l,this.height=d;const w=this.framebuffer=i.gl.createFramebuffer();_&&(this.colorAttachment=new oy(i,w)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new ay(i,w):new Y1(i,w))}destroy(){const i=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&i.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&i.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&i.deleteTexture(l)}i.deleteFramebuffer(this.framebuffer)}}class c0{constructor(i,l){this.gl=i,this.clearColor=new J_(this),this.clearDepth=new Um(this),this.clearStencil=new H1(this),this.colorMask=new W1(this),this.depthMask=new q1(this),this.stencilMask=new Z1(this),this.stencilFunc=new Q_(this),this.stencilOp=new X1(this),this.stencilTest=new _f(this),this.depthRange=new K1(this),this.depthTest=new ey(this),this.depthFunc=new Vm(this),this.blend=new yf(this),this.blendFunc=new $m(this),this.blendColor=new pc(this),this.blendEquation=new yu(this),this.cullFace=new xf(this),this.cullFaceSide=new vf(this),this.frontFace=new xu(this),this.program=new ty(this),this.activeTexture=new Gm(this),this.viewport=new ry(this),this.bindFramebuffer=new vu(this),this.bindRenderbuffer=new wf(this),this.bindTexture=new bf(this),this.bindVertexBuffer=new Hm(this),this.bindElementBuffer=new Tf(this),this.bindVertexArrayOES=new Vh(this),this.pixelStoreUnpack=new iy(this),this.pixelStoreUnpackPremultiplyAlpha=new ny(this),this.pixelStoreUnpackFlipY=new sy(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l,d){return new Ol(this,i,l,d)}createVertexBuffer(i,l,d,_,y){return new ow(this,i,l,d,_,y)}createRenderbuffer(i,l,d){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,i,l,d),this.bindRenderbuffer.set(null),y}createFramebuffer(i,l,d,_){return new Lf(this,i,l,d,_)}clear({color:i,depth:l,stencil:d,colorMask:_}){const y=this.gl;let w=0;i&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(i.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),l!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(w)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.by(i.blendFunction,Ur.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Pa;function Wh(f,i,l,d,_,y,w){const S=f.context,A=S.gl,P=f.transform,M=[a.aF(P.center.lng),a.aJ(P.center.lat)],z=l.layout.get("symbol-placement"),D=l.layout.get("text-variable-anchor"),j=l.layout.get("icon-rotation-alignment")==="map",V=l.layout.get("text-rotation-alignment")==="map",G=z!=="point",te=[];let K=0,oe=0;for(let we=0;we<d.length;we++){const Ae=d[we],qe=i.getTile(Ae),Ne=qe.getBucket(l);if(!Ne)continue;const rt=Ne.getProjection().createInversionMatrix(P,Ae.canonical),$e=[],Qe=V_(Ae,Ne,P),kt=!w&&j&&G,We=w&&V&&G,Oe=D&&Ne.hasTextData(),ot=Ne.hasIconTextFit()&&Oe&&Ne.hasIconData(),Xe=kt||We||w&&Oe||ot,gt=Ne.projection.name==="globe",Ct=gt?a.aj(P.zoom):0;gt&&($e.push("PROJECTION_GLOBE_VIEW"),Xe&&$e.push("PROJECTED_POS_ON_VIEWPORT"));const jt=f.getOrCreateProgram("collisionBox",{defines:$e});let St=Qe;_[0]===0&&_[1]===0||(St=f.translatePosMatrix(Qe,qe,_,y));const xt=w?Ne.textCollisionBox:Ne.iconCollisionBox,lr=Ne.collisionCircleArray;if(lr.length>0){const nr=a.bC(),er=St;a.cO(nr,Ne.placementInvProjMatrix,P.glCoordMatrix),a.cO(nr,nr,Ne.placementViewportMatrix),te.push({circleArray:lr,circleOffset:oe,transform:er,invTransform:nr,projection:Ne.getProjection()}),K+=lr.length/4,oe=K}if(!xt)continue;f.terrain&&f.terrain.setupElevationDraw(qe,jt);const tr=gt?[Ae.canonical.x,Ae.canonical.y,1<<Ae.canonical.z]:[0,0,0];jt.draw(f,A.LINES,Ht.disabled,Sr.disabled,f.colorModeForRenderPass(),Pr.disabled,t0(St,rt,P,Ct,M,qe,tr,Ne.getProjection()),l.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,P.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt])}if(!w||!te.length)return;const he=f.getOrCreateProgram("collisionCircle"),ge=new a.dW;ge.resize(4*K),ge._trim();let Se=0;for(const we of te)for(let Ae=0;Ae<we.circleArray.length/4;Ae++){const qe=4*Ae,Ne=we.circleArray[qe+0],rt=we.circleArray[qe+1],$e=we.circleArray[qe+2],Qe=we.circleArray[qe+3];ge.emplace(Se++,Ne,rt,$e,Qe,0),ge.emplace(Se++,Ne,rt,$e,Qe,1),ge.emplace(Se++,Ne,rt,$e,Qe,2),ge.emplace(Se++,Ne,rt,$e,Qe,3)}(!Pa||Pa.length<2*K)&&(Pa=function(we){const Ae=2*we,qe=new a.b1;qe.resize(Ae),qe._trim();for(let Ne=0;Ne<Ae;Ne++){const rt=6*Ne;qe.uint16[rt+0]=4*Ne+0,qe.uint16[rt+1]=4*Ne+1,qe.uint16[rt+2]=4*Ne+2,qe.uint16[rt+3]=4*Ne+2,qe.uint16[rt+4]=4*Ne+3,qe.uint16[rt+5]=4*Ne+0}return qe}(K));const be=S.createIndexBuffer(Pa,!0),Ee=S.createVertexBuffer(ge,a.dX.members,!0);for(const we of te){const Ae={u_matrix:we.transform,u_inv_matrix:we.invTransform,u_camera_to_center_distance:(Te=P).getCameraToCenterDistance(we.projection),u_viewport_size:[Te.width,Te.height]};he.draw(f,A.TRIANGLES,Ht.disabled,Sr.disabled,f.colorModeForRenderPass(),Pr.disabled,Ae,l.id,Ee,be,a.bg.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,P.zoom)}var Te;Ee.destroy(),be.destroy()}const Ll=a.bC();function u0(f){const i=f._camera.getWorldToCamera(f.worldSize,1),l=a.aB([],i,f.globeMatrix);a.bl(l,l);const d=[0,0,0],_=[0,1,0,0];return a.aC(_,_,l),d[0]=_[0],d[1]=_[1],d[2]=_[2],a.aw(d,d),d}function Ff({width:f,height:i,anchor:l,textOffset:d,textScale:_},y){const{horizontalAlign:w,verticalAlign:S}=a.c0(l),A=-(w-.5)*f,P=-(S-.5)*i,M=a.c1(l,d);return new a.P((A/_+M[0])*y,(P/_+M[1])*y)}function Nf(f,i,l,d,_,y,w,S,A,P){const M=f.text.placedSymbolArray,z=f.text.dynamicLayoutVertexArray,D=f.icon.dynamicLayoutVertexArray,j={},V=f.getProjection(),G=lc(w,V,_),te=_.elevation,K=V.upVectorScale(w.canonical,_.center.lat,_.worldSize).metersToTile;z.clear();for(let oe=0;oe<M.length;oe++){const he=M.get(oe),{tileAnchorX:ge,tileAnchorY:Se,numGlyphs:be}=he,Ee=he.hidden||!he.crossTileID||f.allowVerticalPlacement&&!he.placedOrientation?null:d[he.crossTileID];if(Ee){let Te=0,we=0,Ae=0;if(te){const ot=te?te.getAtTileOffset(w,ge,Se):0,[Xe,gt,Ct]=V.upVector(w.canonical,ge,Se);Te=ot*Xe*K,we=ot*gt*K,Ae=ot*Ct*K}let[qe,Ne,rt,$e]=vo(he.projectedAnchorX+Te,he.projectedAnchorY+we,he.projectedAnchorZ+Ae,l?G:y);const Qe=cc(_.getCameraToCenterDistance(V),$e);let kt=a.bM(f.textSizeData,A,he)*Qe/a.bX;l&&(kt*=f.tilePixelRatio/S);const We=Ff(Ee,kt);l?({x:qe,y:Ne,z:rt}=V.projectTilePoint(ge+We.x,Se+We.y,w.canonical),[qe,Ne,rt]=vo(qe+Te,Ne+we,rt+Ae,y)):(i&&We._rotate(-_.angle),qe+=We.x,Ne+=We.y,rt=0);const Oe=f.allowVerticalPlacement&&he.placedOrientation===a.bL.vertical?Math.PI/2:0;for(let ot=0;ot<be;ot++)a.bO(z,qe,Ne,rt,Oe);P&&he.associatedIconIndex>=0&&(j[he.associatedIconIndex]={x:qe,y:Ne,z:rt,angle:Oe})}else wr(be,z)}if(P){D.clear();const oe=f.icon.placedSymbolArray;for(let he=0;he<oe.length;he++){const ge=oe.get(he),{numGlyphs:Se}=ge,be=j[he];if(ge.hidden||!be)wr(Se,D);else{const{x:Ee,y:Te,z:we,angle:Ae}=be;for(let qe=0;qe<Se;qe++)a.bO(D,Ee,Te,we,Ae)}}f.icon.dynamicLayoutVertexBuffer.updateData(D)}f.text.dynamicLayoutVertexBuffer.updateData(z)}function qh(f,i,l,d,_,y,w={}){const S=l.paint.get("icon-translate"),A=l.paint.get("text-translate"),P=l.paint.get("icon-translate-anchor"),M=l.paint.get("text-translate-anchor"),z=l.layout.get("icon-rotation-alignment"),D=l.layout.get("text-rotation-alignment"),j=l.layout.get("icon-pitch-alignment"),V=l.layout.get("text-pitch-alignment"),G=l.layout.get("icon-keep-upright"),te=l.layout.get("text-keep-upright"),K=l.paint.get("icon-color-saturation"),oe=l.paint.get("icon-color-contrast"),he=l.paint.get("icon-color-brightness-min"),ge=l.paint.get("icon-color-brightness-max"),Se=l.layout.get("symbol-elevation-reference")==="sea",be=l.layout.get("icon-image-use-theme")==="none",Ee=f.context,Te=Ee.gl,we=f.transform,Ae=z==="map",qe=D==="map",Ne=j==="map",rt=V==="map",$e=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const kt=f.depthModeForSublayer(0,Ht.ReadOnly),We=new Ht(f.context.gl.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D),Oe=[a.aF(we.center.lng),a.aJ(we.center.lat)],ot=l.layout.get("text-variable-anchor"),Xe=we.projection.name==="globe",gt=[],Ct=[0,-1,0];for(const jt of d){const St=i.getTile(jt),xt=St.getBucket(l);if(!xt||xt.projection.name==="mercator"&&Xe||xt.fullyClipped)continue;const lr=xt.projection.name==="globe",tr=lr?a.aj(we.zoom):0,nr=lc(jt,xt.getProjection(),we),er=we.calculatePixelsToTileUnitsMatrix(St),Rr=ot&&xt.hasTextData(),Br=xt.hasIconTextFit()&&Rr&&xt.hasIconData(),$r=xt.getProjection().createInversionMatrix(we,jt.canonical),xi=(1<<St.tileID.canonical.z)*a.al/f.transform.worldSize,Or=Wi=>{let Gr=[0,0,0];if(Wi){const Er=f.style.directionalLight,vi=f.style.ambientLight;Er&&vi&&(Gr=oa(f.style,Er,vi))}return Gr},li=Wi=>{we.depthOcclusionForSymbolsAndCircles&&(l.hasOcclusionOpacityProperties||f.terrain)&&(Wi.push("DEPTH_D24"),Wi.push("DEPTH_OCCLUSION"))},mi=Wi=>{l.lut&&!be&&(l.lut.texture||(l.lut.texture=new a.dY(f.context,l.lut.image,[l.lut.image.height,l.lut.image.height,l.lut.image.height],Ee.gl.RGBA8)),Ee.activeTexture.set(Ee.gl.TEXTURE0+wn.LUT),l.lut.texture&&l.lut.texture.bind(Ee.gl.LINEAR,Ee.gl.CLAMP_TO_EDGE),Wi.push("APPLY_LUT_ON_GPU"))},Vi=()=>{const Wi=Ae&&l.layout.get("symbol-placement")!=="point",Gr=[];li(Gr),mi(Gr);const Er=Wi||Br,vi=xt.elevationType==="road",nn=f.shadowRenderer,Ki=vi&&Ne&&!!nn&&nn.enabled,bn=Or(Ki),ts=vi&&Ne&&!f.terrain?We:kt,Ao=l.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ne&&Gr.push("PITCH_WITH_MAP_TERRAIN"),lr&&(Gr.push("PROJECTION_GLOBE_VIEW"),Er&&Gr.push("PROJECTED_POS_ON_VIEWPORT")),Ao>0&&xt.hasAnySecondaryIcon&&Gr.push("ICON_TRANSITION"),!xt.icon.zOffsetVertexBuffer||vi&&f.terrain||Gr.push("Z_OFFSET"),K===0&&oe===0&&he===0&&ge===1||Gr.push("COLOR_ADJUSTMENT"),xt.sdfIcons&&Gr.push("RENDER_SDF"),Ki&&Gr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vi&&Ne&&!f.terrain&&xt.icon.orientationVertexBuffer&&Gr.push("ELEVATED_ROADS");const Io=xt.icon.programConfigurations.get(l.id),no=f.getOrCreateProgram("symbol",{config:Io,defines:Gr}),so=St.imageAtlasTexture?St.imageAtlasTexture.size:[0,0],Ls=xt.iconSizeData,Uo=a.bK(Ls,we.zoom),ua=Ne||!we.isOrthographic,an=ia(nr,St.tileID.canonical,Ne,Ae,we,xt.getProjection(),er),dn=ef(nr,St.tileID.canonical,Ne,Ae,we,xt.getProjection(),er),Yi=f.translatePosMatrix(dn,St,S,P,!0),kn=f.translatePosMatrix(nr,St,S,P),Wn=Er?Ll:an,mn=Ae&&!Ne&&!Wi;let hs=Ct;!Xe&&!we.mercatorFromTransition||Ae||(hs=u0(we));const Da=lr?hs:Ct,el=l.getColorAdjustmentMatrix(K,oe,he,ge),ha=a0(Ls.kind,Uo,mn,Ne,f,kn,Wn,Yi,Se,!1,so,[0,0],0,jt,tr,Oe,$r,Da,xt.getProjection(),bn,xi,el,Ao,null),Gl=St.imageAtlasTexture?St.imageAtlasTexture:null,Hl=l.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear,Oa=xt.sdfIcons||f.options.rotating||f.options.zooming||Hl||ua?Te.LINEAR:Te.NEAREST,Lu=xt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,tl=f.terrain&&Ne&&Wi?a.bl(a.bC(),an):Ll;if(Wi&&xt.icon){const La=we.elevation,rl=La?La.getAtTileOffsetFunc(jt,we.center.lat,we.worldSize,xt.getProjection()):null,np=kh(nr,St.tileID.canonical,Ne,Ae,we,xt.getProjection(),er);Pm(xt,nr,f,!1,np,dn,Ne,G,rl,jt)}return{program:no,buffers:xt.icon,uniformValues:ha,atlasTexture:Gl,atlasTextureIcon:null,atlasInterpolation:Oa,atlasInterpolationIcon:null,isSDF:xt.sdfIcons,hasHalo:Lu,depthMode:ts,tile:St,renderWithShadows:Ki,labelPlaneMatrixInv:tl}},jr=()=>{const Wi=qe&&l.layout.get("symbol-placement")!=="point",Gr=[],Er=Wi||ot||Br,vi=xt.elevationType==="road",nn=f.shadowRenderer,Ki=vi&&rt&&!!nn&&nn.enabled,bn=Or(Ki),ts=vi&&rt&&!f.terrain?We:kt;f.terrainRenderModeElevated()&&rt&&Gr.push("PITCH_WITH_MAP_TERRAIN"),lr&&(Gr.push("PROJECTION_GLOBE_VIEW"),Er&&Gr.push("PROJECTED_POS_ON_VIEWPORT")),!xt.text.zOffsetVertexBuffer||vi&&f.terrain||Gr.push("Z_OFFSET"),xt.iconsInText&&Gr.push("RENDER_TEXT_AND_SYMBOL"),Gr.push("RENDER_SDF"),Ki&&Gr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vi&&rt&&!f.terrain&&xt.text.orientationVertexBuffer&&Gr.push("ELEVATED_ROADS"),li(Gr);const Ao=xt.text.programConfigurations.get(l.id),Io=f.getOrCreateProgram("symbol",{config:Ao,defines:Gr});let no,so=[0,0],Ls=null;const Uo=xt.textSizeData;xt.iconsInText&&(so=St.imageAtlasTexture?St.imageAtlasTexture.size:[0,0],Ls=St.imageAtlasTexture?St.imageAtlasTexture:null,no=rt||!we.isOrthographic||f.options.rotating||f.options.zooming||Uo.kind==="composite"||Uo.kind==="camera"?Te.LINEAR:Te.NEAREST);const ua=St.glyphAtlasTexture?St.glyphAtlasTexture.size:[0,0],an=l.layout.get("text-size-scale-range"),dn=a.aA(f.scaleFactor,an[0],an[1]),Yi=a.bK(Uo,we.zoom,dn),kn=ia(nr,St.tileID.canonical,rt,qe,we,xt.getProjection(),er),Wn=ef(nr,St.tileID.canonical,rt,qe,we,xt.getProjection(),er),mn=f.translatePosMatrix(Wn,St,A,M,!0),hs=f.translatePosMatrix(nr,St,A,M),Da=Er?Ll:kn,el=qe&&!rt&&!Wi;let ha=Ct;!Xe&&!we.mercatorFromTransition||qe||(ha=u0(we));const Gl=a0(Uo.kind,Yi,el,rt,f,hs,Da,mn,Se,!0,ua,so,0,jt,tr,Oe,$r,lr?ha:Ct,xt.getProjection(),bn,xi,null,null,dn),Hl=St.glyphAtlasTexture?St.glyphAtlasTexture:null,Oa=Te.LINEAR,Lu=l.paint.get("text-halo-width").constantOr(1)!==0,tl=f.terrain&&rt&&Wi?a.bl(a.bC(),kn):Ll;if(Wi&&xt.text){const La=we.elevation,rl=La?La.getAtTileOffsetFunc(jt,we.center.lat,we.worldSize,xt.getProjection()):null,np=kh(nr,St.tileID.canonical,rt,qe,we,xt.getProjection(),er);Pm(xt,nr,f,!0,np,Wn,rt,te,rl,jt)}return{program:Io,buffers:xt.text,uniformValues:Gl,atlasTexture:Hl,atlasTextureIcon:Ls,atlasInterpolation:Oa,atlasInterpolationIcon:no,isSDF:!0,hasHalo:Lu,depthMode:ts,tile:St,renderWithShadows:Ki,labelPlaneMatrixInv:tl}},hi=xt.icon.segments.get().length,ci=xt.text.segments.get().length,pi=hi&&!w.onlyText?Vi():null,Hi=ci&&!w.onlyIcons?jr():null,hn=l.paint.get("icon-opacity").constantOr(1),Hn=l.paint.get("text-opacity").constantOr(1);if($e&&xt.canOverlap){Qe=!0;const Wi=hn&&!w.onlyText?xt.icon.segments.get():[],Gr=Hn&&!w.onlyIcons?xt.text.segments.get():[];for(const Er of Wi)gt.push({segments:new a.bg([Er]),sortKey:Er.sortKey,state:pi});for(const Er of Gr)gt.push({segments:new a.bg([Er]),sortKey:Er.sortKey,state:Hi})}else w.onlyText||gt.push({segments:hn?xt.icon.segments:new a.bg([]),sortKey:0,state:pi}),w.onlyIcons||gt.push({segments:Hn?xt.text.segments:new a.bg([]),sortKey:0,state:Hi})}Qe&&gt.sort((jt,St)=>jt.sortKey-St.sortKey);for(const jt of gt){const St=jt.state;if(St)if(f.terrain?f.terrain.setupElevationDraw(St.tile,St.program,{useDepthForOcclusion:we.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:St.labelPlaneMatrixInv}):f.setupDepthForOcclusion(we.depthOcclusionForSymbolsAndCircles,St.program),Ee.activeTexture.set(Te.TEXTURE0),St.atlasTexture&&St.atlasTexture.bind(St.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),St.atlasTextureIcon&&(Ee.activeTexture.set(Te.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),St.renderWithShadows&&f.shadowRenderer.setupShadows(St.tile.tileID.toUnwrapped(),St.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,St.program),St.hasHalo){const xt=St.uniformValues;xt.u_is_halo=1,zf(St.buffers,jt.segments,l,f,St.program,St.depthMode,_,y,xt,2),xt.u_is_halo=0}else{if(St.isSDF){const xt=St.uniformValues;St.hasHalo&&(xt.u_is_halo=1,zf(St.buffers,jt.segments,l,f,St.program,St.depthMode,_,y,xt,1)),xt.u_is_halo=0}zf(St.buffers,jt.segments,l,f,St.program,St.depthMode,_,y,St.uniformValues,1)}}}function zf(f,i,l,d,_,y,w,S,A,P){const M=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,y,w,S,Pr.disabled,A,l.id,f.layoutVertexBuffer,f.indexBuffer,i,l.paint,d.transform.zoom,f.programConfigurations.get(l.id),M,P)}function dy(f,i){const l=1<<f.canonical.z,d=(i.x*l-f.canonical.x-f.wrap*l)*a.al,_=(i.y*l-f.canonical.y)*a.al,y=a.e5(i.z,i.y);return a.d4(d,_,y)}function vc(f,i,l,d,_){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const y=f.context.gl,w=new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D),S=new Ht(f.context.gl.GREATER,Ht.ReadWrite,f.depthRangeFor3D),A=function(j){let V=.01;return j.isOrthographic&&(V=a.ak(1e-4,V,a.c$(j.pitch>=Xa?1:j.pitch/Xa))),2*V}(f.transform),P=f.transform.getFreeCameraOptions().position,M="elevatedStructuresDepthReconstruct",z=f.getOrCreateProgram(M,{defines:["DEPTH_RECONSTRUCTION"]}),D=f.getOrCreateProgram(M);for(const j of d){const V=i.getTile(j),G=V.getBucket(l);if(!G)continue;const te=G.elevatedStructures;if(!te)continue;const K=G.elevationBufferData.heightRange,oe=dy(j.toUnwrapped(),P),he=f.translatePosMatrix(j.projMatrix,V,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ge,Se,be,Ee;if(_==="initialize"){if(!K||K.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;ge=Pf(he,oe,A,1,0),Se=w,be=te.depthSegments,Ee=z}else if(_==="reset"){if(!K||K.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;ge=Pf(he,oe,0,0,1),Se=S,be=te.maskSegments,Ee=z}else if(_==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;ge=Pf(he,oe,A,1,0),Se=w,be=te.depthSegments,Ee=D}Ee.draw(f,y.TRIANGLES,Se,Sr.disabled,Ur.disabled,Pr.disabled,ge,l.id,te.vertexBuffer,te.indexBuffer,be,l.paint,f.transform.zoom)}}function Su(f,i,l){const{painter:d,sourceCache:_,layer:y,coords:w,colorMode:S,elevationType:A,terrainEnabled:P,pass:M}=f,z=d.context.gl,D=y.paint.get("fill-pattern"),j=y.paint.get("fill-pattern-cross-fade"),V=D.constantOr(null);let G=A;A!=="road"||i&&!P||(G="none");const te=G==="road",K=f.painter.shadowRenderer,oe=te&&!!K&&K.enabled,he=new Ht(d.context.gl.LEQUAL,Ht.ReadOnly,d.depthRangeFor3D);let ge=[0,0,0];if(oe){const Ee=d.style.directionalLight,Te=d.style.ambientLight;Ee&&Te&&(ge=oa(d.style,Ee,Te))}const Se=D&&D.constantOr(1),be=(Ee,Te)=>{let we,Ae,qe,Ne,rt;Te?(we=Se&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",qe=z.LINES):(we=Se?"fillPattern":"fill",qe=z.TRIANGLES);for(const $e of w){const Qe=_.getTile($e);if(Se&&!Qe.patternsLoaded())continue;const kt=Qe.getBucket(y);if(!kt)continue;const We=i?kt.elevationBufferData:kt.bufferData;if(We.isEmpty())continue;d.prepareDrawTile();const Oe=We.programConfigurations.get(y.id),ot=d.isTileAffectedByFog($e),Xe=[],gt=[];te&&(Xe.push("ELEVATED_ROADS"),gt.push(We.elevatedLayoutVertexBuffer)),oe&&Xe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&(d.context.activeTexture.set(z.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let Ct=!1;if(V&&Qe.imageAtlas){const tr=Qe.imageAtlas,nr=a.e0.from(V),er=nr.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Rr=nr.getSecondary(),Br=tr.patternPositions.get(er),$r=Rr?tr.patternPositions.get(Rr.scaleSelf(a.o.devicePixelRatio).toString()):null;Ct=!!Br&&!!$r,Br&&Oe.setConstantPatternPositions(Br,$r)}j>0&&(Ct||Oe.getPatternTransitionVertexBuffer("fill-pattern"))&&Xe.push("FILL_PATTERN_TRANSITION");const jt=d.getOrCreateProgram(we,{config:Oe,overrideFog:ot,defines:Xe}),St=d.translatePosMatrix($e.projMatrix,Qe,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));oe&&K.setupShadows(Qe.tileID.toUnwrapped(),jt,"vector-tile");const xt=y.paint.get("fill-emissive-strength");if(Te){Ne=We.lineIndexBuffer,rt=We.lineSegments;const tr=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ae=we==="fillOutlinePattern"&&Se?tw(St,xt,d,Qe,tr,ge,j):ew(St,xt,tr,ge)}else Ne=We.indexBuffer,rt=We.triangleSegments,Ae=Se?_c(St,xt,d,Qe,ge,j):Qm(St,xt,ge);d.uploadCommonUniforms(d.context,jt,$e.toUnwrapped());let lr=Ee;(A==="road"&&!P||A==="offset")&&(lr=he),jt.draw(d,qe,lr,l||d.stencilModeForClipping($e),S,Pr.disabled,Ae,y.id,We.layoutVertexBuffer,Ne,rt,y.paint,d.transform.zoom,Oe,gt)}};d.renderPass===M&&be(d.depthModeForSublayer(1,d.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly),!1),G==="none"&&d.renderPass==="translucent"&&y.paint.get("fill-antialias")&&be(d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly),!0)}function Wt(f,i,l,d,_,y,w,S){l.resetLayerRenderingStats(f);const A=f.context,P=A.gl,M=f.transform,z=l.paint.get("fill-extrusion-pattern"),D=l.paint.get("fill-extrusion-pattern-cross-fade"),j=z.constantOr(null),V=z.constantOr(1),G=l.paint.get("fill-extrusion-opacity"),te=f.style.enable3dLights(),K=l.paint.get(te&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),oe=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],he=l.layout.get("fill-extrusion-edge-radius"),ge=he>0&&!l.paint.get("fill-extrusion-rounded-roof"),Se=ge?0:he,be=M.projection.name==="globe"?a.e8():0,Ee=M.projection.name==="globe",Te=Ee?a.aj(M.zoom):0,we=[a.aF(M.center.lng),a.aJ(M.center.lat)],Ae=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qe=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ae?null:l.lut).toArray01().slice(0,3),Ne=l.paint.get("fill-extrusion-flood-light-intensity"),rt=l.paint.get("fill-extrusion-vertical-scale"),$e=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=l.paint.get("fill-extrusion-height-alignment"),kt=l.paint.get("fill-extrusion-base-alignment"),We=Pl(f,l.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let ot;Ee&&Oe.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Oe.push("FAUX_AO"),ge&&Oe.push("ZERO_ROOF_RADIUS"),S&&Oe.push("HAS_CENTROID"),Ne>0&&Oe.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),$e&&Oe.push("RENDER_WALL_MODE");const Xe=f.renderPass==="shadow",gt=f.shadowRenderer,Ct=Xe&&!!gt,jt=Xe?Pr.disabled:Pr.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let St=[0,0,0];if(gt){const tr=f.style.directionalLight,nr=f.style.ambientLight;tr&&nr&&(St=oa(f.style,tr,nr)),Xe||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&Oe.push("NORMAL_OFFSET")),ot=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const xt=Ct?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",lr=l.getLayerRenderingStats();for(const tr of d){const nr=i.getTile(tr),er=nr.getBucket(l);if(!er||er.projection.name!==M.projection.name)continue;let Rr=!1;gt&&(Rr=gt.getMaxCascadeForTile(tr.toUnwrapped())===0);const Br=f.isTileAffectedByFog(tr),$r=er.programConfigurations.get(l.id);let xi=!1;if(j&&nr.imageAtlas){const ci=nr.imageAtlas,pi=a.e0.from(j),Hi=pi.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),hn=pi.getSecondary(),Hn=ci.patternPositions.get(Hi),Wi=hn?ci.patternPositions.get(hn.scaleSelf(a.o.devicePixelRatio).toString()):null;xi=!!Hn&&!!Wi,Hn&&$r.setConstantPatternPositions(Hn,Wi)}D>0&&(xi||$r.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Or=f.getOrCreateProgram(xt,{config:$r,defines:Rr?ot:Oe,overrideFog:Br});if(f.terrain&&f.terrain.setupElevationDraw(nr,Or,{useMeterToDem:!0}),!er.centroidVertexBuffer){const ci=Or.getAttributeLocation(P,"a_centroid_pos");ci!==-1&&P.vertexAttrib2f(ci,0,0)}!Xe&&gt&&gt.setupShadows(nr.tileID.toUnwrapped(),Or,"vector-tile"),V&&(f.context.activeTexture.set(P.TEXTURE0),nr.imageAtlasTexture&&nr.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),$r.updatePaintBuffers());const li=l.paint.get("fill-extrusion-vertical-gradient"),mi=1/er.tileToMeter;let Vi;if(Xe&&gt){if(fy(nr.tileID,er.maxHeight,f))continue;const ci=gt.calculateShadowPassMatrixFromTile(nr.tileID.toUnwrapped());Vi=Jm(ci,Se,mi,rt,Qe,kt)}else{const ci=f.translatePosMatrix(tr.expandedProjMatrix,nr,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),pi=M.projection.createInversionMatrix(M,tr.canonical);Vi=V?cy(ci,f,li,G,oe,Se,mi,tr,nr,be,Qe,kt,Te,we,pi,qe,rt,D):Hh(ci,f,li,G,oe,Se,mi,tr,be,Qe,kt,Te,we,pi,qe,rt,Ne,St)}f.uploadCommonUniforms(A,Or,tr.toUnwrapped(),null,We);let jr=er.segments;if(M.projection.name==="mercator"&&!Xe&&(jr=er.getVisibleSegments(nr.tileID,f.terrain,f.transform.getFrustum(0)),!jr.get().length))continue;if(lr)if(Xe)for(const ci of jr.get())lr.numRenderedVerticesInShadowPass+=ci.primitiveLength;else for(const ci of jr.get())lr.numRenderedVerticesInTransparentPass+=ci.primitiveLength;const hi=[];(f.terrain||S)&&hi.push(er.centroidVertexBuffer),Ee&&hi.push(er.layoutVertexExtBuffer),$e&&hi.push(er.wallVertexBuffer),Or.draw(f,A.gl.TRIANGLES,_,y,w,jt,Vi,l.id,er.layoutVertexBuffer,er.indexBuffer,jr,l.paint,f.transform.zoom,$r,hi)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class h0{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ka(f,i,l,d,_,y,w,S,A,P,M,z,D,j,V,G,te,K,oe,he){const ge=i.context,Se=ge.gl,be=i.transform,Ee=i.transform.zoom,Te=[],we=f.translate,Ae=f.translateAnchor,qe=f.edgeRadius,Ne=Pl(i,f.cutoffFadeRange);M==="clear"?(Te.push("CLEAR_SUBPASS"),he&&(Te.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(Se.TEXTURE0),he.bind(Se.LINEAR,Se.CLAMP_TO_EDGE))):M==="sdf"&&Te.push("SDF_SUBPASS"),K&&Te.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const rt=($e,Qe,kt,We,Oe)=>{const ot=Qe.programConfigurations.get(d.id),Xe=i.isTileAffectedByFog($e),gt=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:ot,defines:Te,overrideFog:Xe}),Ct=((St,xt,lr,tr,nr,er,Rr,Br,$r,xi,Or)=>({u_matrix:xt,u_opacity:lr,u_ao_pass:tr?1:0,u_meter_to_tile:nr,u_ao:er,u_flood_light_intensity:Rr,u_flood_light_color:Br,u_attenuation:$r,u_edge_radius:xi,u_fb:0,u_fb_size:Or,u_dynamic_offset:1}))(0,We,z,P,Oe,[D,j*Oe],V,G,te,Ee>=17?0:qe*Oe,he?he.size[0]:0),jt=[];K&&jt.push(Qe.hiddenByLandmarkVertexBuffer),i.uploadCommonUniforms(ge,gt,$e.toUnwrapped(),null,Ne),gt.draw(i,ge.gl.TRIANGLES,y,w,S,A,Ct,d.id,Qe.vertexBuffer,Qe.indexBuffer,kt,d.paint,Ee,ot,jt)};for(const $e of _){const Qe=l.getTile($e),kt=Qe.getBucket(d);if(!kt||kt.projection.name!==be.projection.name||!kt.groundEffect||kt.groundEffect&&!kt.groundEffect.hasData())continue;const We=kt.groundEffect,Oe=1/kt.tileToMeter;{const ot=i.translatePosMatrix($e.projMatrix,Qe,we,Ae),Xe=We.getDefaultSegment();rt($e,We,Xe,ot,Oe)}if(oe)for(let ot=0;ot<4;ot++){const Xe=a.e6[ot]($e),gt=l.getTile(Xe);if(!gt)continue;const Ct=gt.getBucket(d);if(!Ct||Ct.projection.name!==be.projection.name||!Ct.groundEffect||Ct.groundEffect&&!Ct.groundEffect.hasData())continue;const jt=Ct.groundEffect;let St,xt;ot===0?(St=[-a.al,0,0],xt=1):ot===1?(St=[a.al,0,0],xt=0):ot===2?(St=[0,-a.al,0],xt=3):(St=[0,a.al,0],xt=2);const lr=jt.regionSegments[xt];if(!lr)continue;const tr=new Float32Array(16);a.br(tr,$e.projMatrix,St),rt($e,jt,lr,i.translatePosMatrix(tr,Qe,we,Ae),Oe)}}}function Fl(f,i,l,d,_,y,w){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const S=y?y.findDEMTileFor(l):null;if(!(S&&S.dem||w))return;y&&S&&S.dem&&d.selfDEMTileTimestamp!==S.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=S.dem._timestamp);const A=K=>new a.P(Math.ceil((K+a.ea)*a.eb),0),P=K=>{const oe=i.getSource().minzoom,he=Se=>{const be=i.getTileByID(Se);if(be&&be.hasData())return be.getBucket(_)},ge=[0,-1,1];for(const Se of ge){if(K.overscaledZ+Se<oe)continue;const be=he(K.calculateScaledKey(K.overscaledZ+Se));if(be)return be}},M=[0,0,0],z=(K,oe)=>(M[0]=Math.min(K.min.y,oe.min.y),M[1]=Math.max(K.max.y,oe.max.y),M[2]=a.al-oe.min.x>K.max.x?oe.min.x-a.al:K.max.x,M),D=(K,oe)=>(M[0]=Math.min(K.min.x,oe.min.x),M[1]=Math.max(K.max.x,oe.max.x),M[2]=a.al-oe.min.y>K.max.y?oe.min.y-a.al:K.max.y,M),j=[(K,oe)=>z(K,oe),(K,oe)=>z(oe,K),(K,oe)=>D(K,oe),(K,oe)=>D(oe,K)],V=(K,oe,he,ge,Se,be,Ee)=>{if(!y)return 0;const Te=[[be?he:K,be?K:he,0],[be?he:oe,be?oe:he,0]],we=Ee<0?a.al+Ee:Ee,Ae=[be?we:(K+oe)/2,be?(K+oe)/2:we,0];return he===0&&Ee<0||he!==0&&Ee>0?y.getForTilePoints(Se,[Ae],!0,ge):Te.push(Ae),y.getForTilePoints(l,Te,!0,S),Math.max(Te[0][2],Te[1][2],Ae[2])/y.exaggeration()};for(let K=0;K<4;K++){const oe=d.borderFeatureIndices[K];if(oe.length===0)continue;const he=a.e6[K](l),ge=P(he);if(!(ge&&ge instanceof a.e7))continue;const Se=y?y.findDEMTileFor(he):null;if(!(Se&&Se.dem||w)||(y&&Se&&Se.dem&&d.borderDEMTileTimestamp[K]!==Se.dem._timestamp&&(d.borderDoneWithNeighborZ[K]=-1,d.borderDEMTileTimestamp[K]=Se.dem._timestamp),d.borderDoneWithNeighborZ[K]===ge.canonical.z))continue;ge.centroidVertexArray.length===0&&ge.createCentroidsBuffer();const be=(K<2?1:5)-K,Ee=ge.borderDoneWithNeighborZ[be]!==d.canonical.z,Te=ge.borderFeatureIndices[be];let we=0;if(d.canonical.z!==ge.canonical.z){for(const Ae of oe)d.showCentroid(d.featuresOnBorder[Ae]);if(Ee)for(const Ae of Te)ge.showCentroid(ge.featuresOnBorder[Ae]);d.borderDoneWithNeighborZ[K]=ge.canonical.z,ge.borderDoneWithNeighborZ[be]=d.canonical.z}for(const Ae of oe){const qe=d.featuresOnBorder[Ae],Ne=d.centroidData[qe.centroidDataIndex],rt=qe.borders[K];let $e;for(;we<Te.length;){$e=ge.featuresOnBorder[Te[we]];const Qe=$e.borders[be];if(Qe[1]>rt[0]+3||Qe[0]>rt[0]-3)break;ge.showCentroid($e),we++}if($e&&we<Te.length){const Qe=we;let kt=0;for(;!($e.borders[be][0]>rt[1]-3)&&(kt++,++we!==Te.length);)$e=ge.featuresOnBorder[Te[we]];$e=ge.featuresOnBorder[Te[Qe]];let We=!1;if(kt>=1){const Xe=$e.borders[be];Math.abs(rt[0]-Xe[0])<3&&Math.abs(rt[1]-Xe[1])<3&&(kt=1,We=!0,we=Qe+1)}else if(kt===0){d.showCentroid(qe);continue}const Oe=ge.centroidData[$e.centroidDataIndex];w&&We&&(((G=Ne).flags|(te=Oe).flags)&a.e9?(G.flags|=a.e9,te.flags|=a.e9):(G.flags&=~a.e9,te.flags&=~a.e9));const ot=qe.intersectsCount()>1||$e.intersectsCount()>1;if(kt>1)we=Qe,Ne.centroidXY=Oe.centroidXY=new a.P(0,0);else if(Se&&Se.dem&&!ot){const Xe=j[K](Ne,Oe),gt=K%2?a.al-1:0,Ct=V(Xe[0],Math.min(a.al-1,Xe[1]),gt,Se,he,K<2,Xe[2]);Ne.centroidXY=Oe.centroidXY=A(Ct)}else ot?Ne.centroidXY=Oe.centroidXY=new a.P(0,0):(Ne.centroidXY=d.encodeBorderCentroid(qe),Oe.centroidXY=ge.encodeBorderCentroid($e));d.writeCentroidToBuffer(Ne),ge.writeCentroidToBuffer(Oe)}else d.showCentroid(qe)}d.borderDoneWithNeighborZ[K]=ge.canonical.z,ge.borderDoneWithNeighborZ[be]=d.canonical.z}var G,te;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(f)}const Nl=[1,0,0],xr=[0,1,0],d0=[0,0,1];function fy(f,i,l){const d=l.transform,_=l.shadowRenderer;if(!_)return!0;const y=f.toUnwrapped(),w=d.tileSize*_._cascades[l.currentShadowCascade].scale;let S=i;if(d.elevation){const G=d.elevation.getMinMaxForTile(f);G&&(S+=G.max)}const A=[..._.shadowDirection];A[2]=-A[2];const P=_.computeSimplifiedTileShadowVolume(y,S,w,A);if(!P)return!1;const M=[Nl,xr,d0,A,[A[0],0,A[2]],[0,A[1],A[2]]],z=d.projection.name==="globe",D=d.scaleZoom(w),j=a.cA.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,D,!z),V=_.getCurrentCascadeFrustum();return j.intersectsPrecise(P.vertices,P.planes,M)===0||V.intersectsPrecise(P.vertices,P.planes,M)===0}function Bf(f){const{painter:i,source:l,layer:d,coords:_}=f;let y=f.defines;const w=i.context,S=i.renderPass==="shadow",A=i.renderPass==="light-beam",P=i.shadowRenderer,M=a.ec(i.transform.center.lat,i.transform.zoom),z=Pl(i,d.paint.get("building-cutoff-fade-range"));z.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF"));for(const D of _){const j=l.getTile(D),V=j.getBucket(d);if(!V)continue;P&&P.getMaxCascadeForTile(D.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const G=V.programConfigurations.get(d.id);let te,K,oe,he=i.translatePosMatrix(D.expandedProjMatrix,j,[0,0],"map");if(he=a.cR(a.bC(),he,[1,1,f.verticalScale]),S&&P){if(fy(j.tileID,V.maxHeight*M,i))continue;let Se=P.calculateShadowPassMatrixFromTile(j.tileID.toUnwrapped());Se=a.cR(a.bC(),Se,[1,1,f.verticalScale]),oe=e0(Se),te=K=i.getOrCreateProgram("buildingDepth",{config:G,defines:y,overrideFog:!1})}else if(A)te=K=i.getOrCreateProgram("buildingBloom",{config:G,defines:y,overrideFog:!1}),oe=nw(he);else{const Se=i.transform.calculatePosMatrix(D.toUnwrapped(),i.transform.worldSize);a.cR(Se,Se,[1,1,f.verticalScale]);const be=a.bC();a.cR(be,Se,[1,-1,1/M]),a.bl(be,be),a.ed(be,be);const Ee=i.transform.getFreeCameraOptions().position,Te=1<<D.canonical.z;oe=iw(he,be,f.opacity,f.facadeAOIntensity,[((Ee.x-D.wrap)*Te-D.canonical.x)*a.al,(Ee.y*Te-D.canonical.y)*a.al,Ee.z*Te*a.al],V.tileToMeter,f.facadeEmissiveChance),K=i.getOrCreateProgram("building",{config:G,defines:y,overrideFog:!1});const we=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);te=i.getOrCreateProgram("building",{config:G,defines:we,overrideFog:!1}),P&&(P.setupShadowsFromMatrix(Se,K,!0),P.setupShadowsFromMatrix(Se,te,!0))}const ge=(Se,be)=>{if(A){const Ee=Se.entranceBloom;be.draw(i,w.gl.TRIANGLES,f.depthMode,Sr.disabled,f.blendMode,Pr.disabled,oe,d.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segmentsBucket,d.paint,i.transform.zoom,G,[Ee.layoutAttenuationBuffer,Ee.layoutColorBuffer])}else{const Ee=Se.segmentsBucket;let Te=[Se.layoutNormalBuffer,Se.layoutCentroidBuffer,Se.layoutColorBuffer];Se.layoutFacadePaintBuffer&&(Te=Te.concat([Se.layoutFacadeDataBuffer,Se.layoutFacadeVerticalRangeBuffer,Se.layoutFacadePaintBuffer])),be.draw(i,w.gl.TRIANGLES,f.depthMode,Sr.disabled,f.blendMode,S?Pr.disabled:Pr.backCW,oe,d.id,Se.layoutVertexBuffer,Se.indexBuffer,Ee,d.paint,i.transform.zoom,G,Te)}};i.uploadCommonUniforms(w,K,D.toUnwrapped(),null,z),V.buildingWithoutFacade&&ge(V.buildingWithoutFacade,K),te!==K&&i.uploadCommonUniforms(w,te,D.toUnwrapped(),null,z),V.buildingWithFacade&&ge(V.buildingWithFacade,te)}}function jf(f){return[f[0]*a.ee,f[1]*a.ee,f[2]*a.ee,0]}function Uf(f,i,l,d,_,y,w,S,A){const P=d.getSource(),M=l.globeSharedBuffers;if(!M)return;let z,D,j;if(i&&(z=d.getTile(i)),P instanceof a.aS?(D=P.texture,j=a.dG(0,0,l.transform)):z&&i&&(D=z.texture,j=a.dG(i.canonical.z,i.canonical.x,l.transform)),!D||!j)return;f||(j=a.cR(a.bC(),j,[1,-1,1]));const V=l.context,G=V.gl,te=_.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,K=l.colorModeForDrapableLayerRenderPass(y),oe=w.defines;oe.push("GLOBE_POLES");const he=new Ht(G.LEQUAL,Ht.ReadWrite,l.depthRangeFor3D),ge=Float32Array.from(l.transform.expandedFarZProjMatrix),Se=Float32Array.from(a.bk(a.dF(new a.cC(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),V.activeTexture.set(G.TEXTURE0),D.bind(te,G.CLAMP_TO_EDGE),V.activeTexture.set(G.TEXTURE1),D.bind(te,G.CLAMP_TO_EDGE),"useMipmap"in D&&V.extTextureFilterAnisotropic&&l.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const[be,Ee,Te,we]=i?M.getPoleBuffers(i.canonical.z,!1):M.getPoleBuffers(0,!0),Ae=_.paint.get("raster-elevation");let qe;f?(qe=be,l.renderDefaultNorthPole=Ae!==0):(qe=Ee,l.renderDefaultSouthPole=Ae!==0);const Ne=jf(w.mix),rt=((Qe,kt,We,Oe,ot,Xe,gt,Ct,jt,St,xt,lr,tr)=>kf(Qe,kt,We,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xe,[0,0],Ct,2,St,xt,lr,1,0,tr))(ge,Se,j,a.aj(l.transform.zoom),0,_,0,Ae,0,Ne,w.offset,w.range,y),$e=l.getOrCreateProgram("raster",{defines:oe});l.uploadCommonUniforms(V,$e,null),$e.draw(l,G.TRIANGLES,he,A,K,S,rt,_.id,qe,Te,we)}function aw(f){const i=f._nearZ,l=f.projection.farthestPixelDistance(f),d=l-i,_=.2*f.height,y=i+_;return[i,l,(y-_-i)/d,(y-i)/d]}function py(f,i,l,d){if(f)return i instanceof Tl&&f instanceof Ih?i.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:jf(d.mix),offset:d.offset,buffer:0,tileSize:1}}var lw=a.ef([{name:"a_index",type:"Int16",components:1}]);class cw{constructor(i,l,d,_){const y={width:d[0],height:d[1],data:null},w=i.gl;this.targetColorTexture=new a.T(i,y,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(i,y,w.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(l,_),this.lastInvalidatedAt=0}updateParticleTexture(i,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=l.width*l.height;this.particleTexture0=new a.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new a.eg;y.reserve(_);for(let w=0;w<_;w++)y.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(y,lw.members,!0),this.particleSegment=a.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=a.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function io(f,i,l){if(!f)return null;const d=i.getTextureDescriptor(f,l,!0);if(!d)return null;let{texture:_,mix:y,offset:w,tileSize:S,buffer:A,format:P}=d;if(!_||!P)return null;let M=!1;return P==="uint32"&&(M=!0,y[3]=0,y=i0(a.eh,y,[0,l.paint.get("raster-particle-max-speed")]),w=n0(a.eh,w,[0,l.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[A/(S+2*A),S/(S+2*A)],tileSize:S,scalarData:M,scale:y,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function f0(f){const i=f._nearZ,l=f.projection.farthestPixelDistance(f),d=l-i,_=.2*f.height,y=i+_;return[i,l,(y-_-i)/d,(y-i)/d]}const Os=new a.ao(1,0,0,1),zl=new a.ao(0,1,0,1),my=new a.ao(0,0,1,1),p0=new a.ao(1,0,1,1),m0=new a.ao(0,1,1,1);function Vf(f,i,l,d,_,y){for(let w=0;w<l.length;w++)if(_){const P=new a.ao(d.r*.8,d.g*.8,d.b*.8,1);wc(f,i,l[w],d,-1,-1,y),wc(f,i,l[w],d,-1,1,y),wc(f,i,l[w],d,1,1,y),wc(f,i,l[w],d,1,-1,y),wc(f,i,l[w],P,0,0,y)}else wc(f,i,l[w],d,0,0,y)}function wc(f,i,l,d,_,y,w){const S=f.context,A=f.transform,P=S.gl,M=A.projection.name==="globe",z=M?["PROJECTION_GLOBE_VIEW"]:[];let D=a.bz(l.projMatrix);if(M&&a.aj(A.zoom)>0){const Ne=a.bj(l.canonical,A),rt=a.ei(Ne);D=a.aB(new Float32Array(16),A.globeMatrix,rt),a.aB(D,A.projMatrix,D)}const j=a.bC();j[12]+=2*_/(a.o.devicePixelRatio*A.width),j[13]+=2*y/(a.o.devicePixelRatio*A.height),a.aB(D,j,D);const V=f.getOrCreateProgram("debug",{defines:z}),G=i.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(G,V);const te=Ht.disabled,K=Sr.disabled,oe=f.colorModeForRenderPass(),he="$debug";S.activeTexture.set(P.TEXTURE0),f.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),M?G._makeGlobeTileDebugBuffers(f.context,A):G._makeDebugTileBoundsBuffers(f.context,A.projection);const ge=G._tileDebugBuffer||f.debugBuffer,Se=G._tileDebugIndexBuffer||f.debugIndexBuffer,be=G._tileDebugSegments||f.debugSegments;if(V.draw(f,P.LINE_STRIP,te,K,oe,Pr.disabled,r0(D,d.toPremultipliedRenderColor(null)),he,ge,Se,be,null,null,null,[G._globeTileDebugBorderBuffer]),w){const Ne=G.latestRawTileData,rt=Math.floor((Ne&&Ne.byteLength||0)/1024);let $e=l.canonical.toString();l.overscaledZ!==l.canonical.z&&($e+=` => ${l.overscaledZ}`),$e+=` ${G.state}`,$e+=` ${rt}kb`,function(Qe,kt){Qe.initDebugOverlayCanvas();const We=Qe.debugOverlayCanvas,Oe=Qe.context.gl,ot=Qe.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,We.width,We.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(kt,5,5),ot.strokeText(kt,5,5),Qe.debugOverlayTexture.update(We),Qe.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(f,$e)}const Ee=i.getTile(l).tileSize,Te=512/Math.min(Ee,512)*(l.overscaledZ/A.zoom)*.5,we=G._tileDebugTextBuffer||f.debugBuffer,Ae=G._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,qe=G._tileDebugTextSegments||f.debugSegments;V.draw(f,P.TRIANGLES,te,K,Ur.alphaBlended,Pr.disabled,r0(D,a.ao.transparent.toPremultipliedRenderColor(null),Te),he,we,Ae,qe,null,null,null,[G._globeTileDebugTextBuffer])}function ka(f,i,l,d){bc(f,0,i+l/2,f.transform.width,l,d)}function Di(f,i,l,d){bc(f,i-l/2,0,l,f.transform.height,d)}function bc(f,i,l,d,_,y){const w=f.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*a.o.devicePixelRatio,l*a.o.devicePixelRatio,d*a.o.devicePixelRatio,_*a.o.devicePixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}const g0=a.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gy}=g0;function Ya(f,i,l,d){f.emplaceBack(i,l,d)}class _0{constructor(i){this.vertexArray=new a.ej,this.indices=new a.b1,Ya(this.vertexArray,-1,-1,1),Ya(this.vertexArray,1,-1,1),Ya(this.vertexArray,-1,1,1),Ya(this.vertexArray,1,1,1),Ya(this.vertexArray,-1,-1,-1),Ya(this.vertexArray,1,-1,-1),Ya(this.vertexArray,-1,1,-1),Ya(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,gy),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=a.bg.simpleSegment(0,0,36,12)}}function Tc(f,i,l,d,_,y){const w=f.context.gl,S=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),P=i.paint.get("sky-atmosphere-sun-intensity"),M=((z,D,j,V,G)=>({u_matrix_3f:z,u_sun_direction:D,u_sun_intensity:j,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(a.el(a.dL(),d),_,P,S.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,i.skyboxTexture,0),l.draw(f,w.TRIANGLES,Ht.disabled,Sr.disabled,Ur.unblended,Pr.frontCW,M,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Sc=a.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ec{constructor(i){const l=new a.em;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const d=new a.b1;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,Sc.members),this.indexBuffer=i.createIndexBuffer(d),this.segments=a.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const It=a.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Bt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Eu{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Ur([1,Hs,1,Hs],a.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ur([1,0,1,0],a.ao.transparent,[!1,!1,!1,!0]),this.params=new Bt,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const l=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ec(l);const d=this.params.sizeRange,_=this.params.intensityRange,y=function(M){const z=a.eo(30),D=[];for(let j=0;j<M;++j){const V=2*Math.PI*z(),G=Math.acos(1-2*z())-.5*Math.PI;D.push(a.d4(Math.cos(G)*Math.cos(V),Math.cos(G)*Math.sin(V),Math.sin(G)))}return D}(this.params.starsCount),w=a.eo(300),S=new a.en,A=new a.b1;let P=0;for(let M=0;M<y.length;++M){const z=a.c4([],y[M],200),D=Math.max(0,1+.01*d*(1*w()-.5)),j=Math.max(0,1+.01*_*(1*w()-.5));S.emplaceBack(z[0],z[1],z[2],-1,-1,D,j),S.emplaceBack(z[0],z[1],z[2],1,-1,D,j),S.emplaceBack(z[0],z[1],z[2],1,1,D,j),S.emplaceBack(z[0],z[1],z[2],-1,1,D,j),A.emplaceBack(P+0,P+1,P+2),A.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=l.createVertexBuffer(S,It.members),this.starsIdx=l.createIndexBuffer(A),this.starsSegments=a.bg.simpleSegment(0,0,S.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,l){const d=i.context,_=d.gl,y=i.transform,w=new Ht(_.LEQUAL,Ht.ReadOnly,[0,1]),S=a.aj(y.zoom),A=i.style.getLut(l.scope),P=l.properties.get("color-use-theme")==="none",M=l.properties.get("color").toNonPremultipliedRenderColor(P?null:A),z=l.properties.get("high-color-use-theme")==="none",D=l.properties.get("high-color").toNonPremultipliedRenderColor(z?null:A),j=l.properties.get("space-color-use-theme")==="none",V=l.properties.get("space-color").toNonPremultipliedRenderColor(j?null:A),G=5e-4,te=a.ep(l.properties.get("horizon-blend"),0,1,G,.25),K=a.dA(i,d,y)&&te===G?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,oe=i.frameCounter/1e3%1,he=a.ag(y.globeCenterInViewSpace),ge=Math.sqrt(Math.pow(he,2)-Math.pow(K,2)),Se=Math.acos(ge/he),be=Ee=>{const Te=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ee&&Te.push("ALPHA_PASS");const we=i.getOrCreateProgram("globeAtmosphere",{defines:Te}),Ae=((Ne,rt,$e,Qe,kt,We,Oe,ot,Xe,gt,Ct,jt)=>({u_frustum_tl:Ne,u_frustum_tr:rt,u_frustum_br:$e,u_frustum_bl:Qe,u_horizon:kt,u_transition:We,u_fadeout_range:Oe,u_atmosphere_fog_color:ot.toArray01(),u_high_color:Xe.toArray01(),u_space_color:gt.toArray01(),u_temporal_offset:Ct,u_horizon_angle:jt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,S,te,M,D,V,oe,Se);i.uploadCommonUniforms(d,we);const qe=this.atmosphereBuffer;qe&&we.draw(i,_.TRIANGLES,w,Sr.disabled,Ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Pr.backCW,Ae,Ee?"atmosphere_glow_alpha":"atmosphere_glow",qe.vertexBuffer,qe.indexBuffer,qe.segments)};be(!1),be(!0)}drawStars(i,l){const d=a.aA(l.properties.get("star-intensity"),0,1);if(d===0)return;const _=i.context,y=_.gl,w=i.transform,S=i.getOrCreateProgram("stars"),A=a.c6([]);a.c8(A,A,-w._pitch),a.c7(A,A,-w.angle),a.c8(A,A,a.an(w._center.lat)),a.eq(A,A,-a.an(w._center.lng));const P=a.cb(new Float32Array(16),A),M=a.aB([],w.starsProjMatrix,P),z=a.el([],P),D=a.er([],z),j=[0,1,0];a.dN(j,j,D),a.c4(j,j,this.params.sizeMultiplier);const V=[1,0,0];a.dN(V,V,D),a.c4(V,V,this.params.sizeMultiplier);const G=(te=j,K=V,oe=d,{u_matrix:Float32Array.from(M),u_up:te,u_right:K,u_intensity_multiplier:oe});var te,K,oe;i.uploadCommonUniforms(_,S),this.starsVx&&this.starsIdx&&S.draw(i,y.TRIANGLES,Ht.disabled,Sr.disabled,this.colorModeAlphaBlendedWriteRGB,Pr.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class rn{constructor(){this.visibleTiles=[]}updateBorders(i,l){const d=[],_=[],y=i._getRenderableCoordinates(!1,!0);for(const A of y){const P=i.getTile(A);if(!P.hasData())continue;const M=P.getBucket(l);M&&(M.isEmpty()||(d.push(A.key),_.push({bucket:M,tileID:A.canonical})))}let w=d.length!==this.visibleTiles.length;if(!w){d.sort();for(let A=0;A<d.length;A++)if(d[A]!==this.visibleTiles[A]){w=!0;break}}if(!w)return;const S=new Set;this.visibleTiles=d,_.sort((A,P)=>A.tileID.z-P.tileID.z||A.tileID.x-P.tileID.x||A.tileID.y-P.tileID.y);for(const A of _){const P=new Array,M=new Array,z=A.bucket;for(const D of z.featuresOnBorder)S.has(D.featureId)?M.push(D.footprintIndex):(S.add(D.featureId),P.push(D.footprintIndex));z.updateFootprintHiddenFlags(P,a.es,!1),z.updateFootprintHiddenFlags(M,a.es,!0)}}}function Be(f,i){const l=[...f],d=i.cameraWorldSizeForFog/i.worldSize,_=a.bA([]);return a.cR(_,_,[d,d,1]),a.aB(l,_,l),a.aB(l,i.worldToFogMatrix,l),l}function $f(f,i,l,d,_){const y=l.material,w=d.context,{baseColorTexture:S,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:M,emissionTexture:z}=y;function D(V,G,te){if(V&&(f.push(G),w.activeTexture.set(w.gl.TEXTURE0+te),V.gfxTexture)){const{minFilter:K,magFilter:oe,wrapS:he,wrapT:ge}=V.sampler;V.gfxTexture.bindExtraParam(K,oe,he,ge)}}D(S,"HAS_TEXTURE_u_baseColorTexture",wn.BaseColor),D(A,"HAS_TEXTURE_u_metallicRoughnessTexture",wn.MetallicRoughness),D(P,"HAS_TEXTURE_u_normalTexture",wn.Normal),D(M,"HAS_TEXTURE_u_occlusionTexture",wn.Occlusion),D(z,"HAS_TEXTURE_u_emissionTexture",wn.Emission),_&&(_.texture||(_.texture=new a.dY(d.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+wn.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(l.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||f.push("DIFFUSE_SHADED");const j=d.shadowRenderer;j&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Ac(f,i,l,d,_,y){const w=l.paint.get("model-opacity").constantOr(1),S=i.context,A=new Ht(i.context.gl.LEQUAL,Ht.ReadWrite,i.depthRangeFor3D),P=i.transform,M=f.mesh,z=M.material,D=z.pbrMetallicRoughness,j=i.style.fog;let V;V=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:a.aB([],d.zScaleMatrix,f.nodeModelMatrix),a.aB(V,d.negCameraPosMatrix,V);const G=a.bl([],V);a.ed(G,G);const te=l.paint.get("model-color-use-theme").constantOr("default")==="none",K=l.paint.get("model-emissive-strength").constantOr(0),oe=Of(new Float32Array(f.worldViewProjection),new Float32Array(V),new Float32Array(G),null,i,w,D.baseColorFactor,z.emissiveFactor,D.metallicFactor,D.roughnessFactor,z,K,l),he={defines:[]},ge=[],Se=i.shadowRenderer;Se&&(Se.useNormalOffset=!1),$f(he.defines,ge,M,i,te?null:l.lut);let be=null;if(j){const we=Be(f.nodeModelMatrix,i.transform);if(be=new Float32Array(we),P.projection.name!=="globe"){const Ae=M.aabb.min,qe=M.aabb.max,[Ne,rt]=j.getOpacityForBounds(we,Ae[0],Ae[1],qe[0],qe[1]);he.overrideFog=Ne>=Ve||rt>=Ve}}const Ee=Pl(i,l.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const Te=i.getOrCreateProgram("model",he);i.uploadCommonUniforms(S,Te,null,be,Ee),i.renderPass!=="shadow"&&Se&&Se.setupShadowsFromMatrix(f.nodeModelMatrix,Te),Te.draw(i,S.gl.TRIANGLES,A,_,y,M.material.doubleSided?Pr.disabled:Pr.backCCW,oe,l.id,M.vertexBuffer,M.indexBuffer,M.segments,l.paint,i.transform.zoom,void 0,ge)}function Gf(f,i,l,d,_,y,w){let S;S=f.projection.name==="globe"?a.eu(l,f):[...l],a.aB(S,S,i.matrix);const A=a.aB([],d,S);if(i.meshes)for(const P of i.meshes){if(P.material.alphaMode!=="BLEND"){w.push({mesh:P,depth:0,modelIndex:_,worldViewProjection:A,nodeModelMatrix:S});continue}const M=a.af([],P.centroid,A);!f.isOrthographic&&M[2]<=0||y.push({mesh:P,depth:M[2],modelIndex:_,worldViewProjection:A,nodeModelMatrix:S})}if(i.children)for(const P of i.children)Gf(f,P,l,d,_,y,w)}function Zh(f,i,l,d){const _=l.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),S=_.calculateShadowPassMatrixFromMatrix(i),A=Tu(S);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,y,Sr.disabled,w,Pr.backCCW,A,d.id,f.vertexBuffer,f.indexBuffer,f.segments,d.paint,l.transform.zoom,void 0,void 0)}function _y(f,i,l){const d=i.updateZoomBasedPaintProperties(),_=function(y,w,S){let A,P,M,z=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&z>0){const D=y.terrain,j=D.findDEMTileFor(S);j&&j.dem?A=a.ew.create(D,S,j):z=0}if(z===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),z===w.validForExaggeration&&(z===0||A&&A._demTile&&A._demTile.tileID===w.validForDEMTile.id&&A._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const D in w.instancesPerModel){const j=w.instancesPerModel[D];for(let V=0;V<j.instancedDataArray.length;++V){const G=(A?z*A.getElevationAt(0|j.instancedDataArray.float32[16*V],0|j.instancedDataArray.float32[16*V+1],!0,!0):0)+j.instancesEvaluatedElevation[V];j.instancedDataArray.float32[16*V+6]=G,P=P?Math.min(w.terrainElevationMin,G):G,M=M?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=P||0,w.terrainElevationMax=M||0,w.validForExaggeration=z,w.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,l);(d||_)&&(i.uploaded=!1,i.upload(f.context))}const aa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d8([0,0,0],[a.al,a.al,0])};function Au(f,i){const l=1<<f.canonical.z,d=i.getFreeCameraOptions().position,_=i.elevation,y=f.canonical.x/l,w=(f.canonical.x+1)/l,S=f.canonical.y/l,A=(f.canonical.y+1)/l;let P=i._centerAltitude;if(_){const j=_.getMinMaxForTile(f);j&&j.max>P&&(P=j.max)}const M=a.aA(d.x,y,w)-d.x,z=a.aA(d.y,S,A)-d.y,D=a.ce(P,i.center.lat)-d.z;return i._zoomFromMercatorZ(Math.sqrt(M*M+z*z+D*D))}function yy(f,i,l,d,_,y,w){const S=f.context,A=f.renderPass==="shadow",P=f.shadowRenderer,M=A&&P?P.getShadowPassDepthMode():new Ht(S.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D),z=f.isTileAffectedByFog(y);if(l.meshes)for(const D of l.meshes){const j=["MODEL_POSITION_ON_GPU"],V=[];let G,te,K;d.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const oe=Pl(f,i.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&P)G=f.getOrCreateProgram("modelDepth",{defines:j}),te=Tu(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(l.matrix)),K=P.getShadowPassColorMode();else{$f(j,V,D,f,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),G=f.getOrCreateProgram("model",{defines:j,overrideFog:z});const ge=D.material,Se=ge.pbrMetallicRoughness,be=i.paint.get("model-opacity").constantOr(1),Ee=i.paint.get("model-emissive-strength").constantOr(0);te=Of(y.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,be,Se.baseColorFactor,ge.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,ge,Ee,i,_),P&&(w.shadowUniformsInitialized?G.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(y.toUnwrapped(),G,"model-tile"),w.shadowUniformsInitialized=!0)),K=oe.shouldRenderCutoff||be<1||ge.alphaMode!=="OPAQUE"?Ur.alphaBlended:Ur.unblended}f.uploadCommonUniforms(S,G,y.toUnwrapped(),null,oe);const he=D.material.doubleSided?Pr.disabled:Pr.backCCW;if(d.instancedDataArray.length>20)V.push(d.instancedDataBuffer),G.draw(f,S.gl.TRIANGLES,M,Sr.disabled,K,he,te,i.id,D.vertexBuffer,D.indexBuffer,D.segments,i.paint,f.transform.zoom,void 0,V,d.instancedDataArray.length);else{const ge=A?"u_instance":"u_normal_matrix";for(let Se=0;Se<d.instancedDataArray.length;++Se)te[ge]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Se,16),G.draw(f,S.gl.TRIANGLES,M,Sr.disabled,K,he,te,i.id,D.vertexBuffer,D.indexBuffer,D.segments,i.paint,f.transform.zoom,void 0,V)}}if(l.children)for(const D of l.children)yy(f,i,D,d,_,y,w)}const uw=[1,-1,1];function xy(f,i,l,d){if(!l.modelManager)return!0;const _=l.modelManager;if(!l.shadowRenderer)return!0;const y=l.shadowRenderer,w=i.aabb;let S=!0,A=f.maxHeight;if(A===0){let M=0;for(const z in f.instancesPerModel){const D=_.getModel(z,d);D?M=Math.max(M,Math.max(Math.max(D.aabb.max[0],D.aabb.max[1]),D.aabb.max[2])):S=!1}A=f.maxScale*M*1.41+f.maxVerticalOffset,S&&(f.maxHeight=A)}w.max[2]=A,w.min[2]+=f.terrainElevationMin,w.max[2]+=f.terrainElevationMax,a.af(w.min,w.min,i.tileMatrix),a.af(w.max,w.max,i.tileMatrix);const P=w.intersects(y.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=P===2),P===0}function Hf(f,i){const l=f.uniformValues.u_cutoff_params[0],d=f.uniformValues.u_cutoff_params[1],_=f.uniformValues.u_cutoff_params[2],y=f.uniformValues.u_cutoff_params[3];return d===l||y===_?1:a.aA(((i-l)/(d-l)-_)/(y-_),0,1)}function y0(f,i,l,d){if(i.pitch<20)return 1;const _=i.getWorldToCameraMatrix();a.aB(_,_,f);const y=a.bU(l.min[0],l.min[1],l.min[2],1);let w=a.aC(a.ex(),y,_),S=w,A=w;y[1]=l.max[1],w=a.aC(a.ex(),y,_),S=w[1]<S[1]?w:S,A=w[1]>A[1]?w:A,y[0]=l.max[0],w=a.aC(a.ex(),y,_),S=w[1]<S[1]?w:S,A=w[1]>A[1]?w:A,y[1]=l.min[1],w=a.aC(a.ex(),y,_),S=w[1]<S[1]?w:S,A=w[1]>A[1]?w:A;const P=a.aA(d[0],0,1),M=100*i.pixelsPerMeter*a.aA(d[1],0,1),z=a.aA(d[2],0,1),D=a.ey(a.ex(),S,A,P),j=Math.tan(.5*i.fovX),V=-D[2]*j;if(M===0)return D[1]<-Math.abs(V)?z:1;const G=(-Math.abs(V)-D[1])/M,te=(oe,he,ge)=>(1-ge)*oe+ge*he,K=a.aA(te(1,z,G),z,1);return te(1,K,a.aA((i.pitch-20)/20,0,1))}class vy{}class wy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,l,d){{const z=this._storage.get(l.id);if(z)return z.lastUsedFrameIdx=i,z.buf}const _=d.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(y),S=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const A=new a.eA;for(let z=0;z<y/2;z+=3){const D=S[z],j=S[z+1],V=S[z+2];A.emplaceBack(D,j),A.emplaceBack(j,V),A.emplaceBack(V,D)}const P=d.bindVertexArrayOES.current,M=new vy;return M.buf=new Ol(d,A),M.lastUsedFrameIdx=i,this._storage.set(l.id,M),d.bindVertexArrayOES.set(P),M.buf}update(i){for(const[l,d]of this._storage)i-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(l))}destroy(){for(const[i,l]of this._storage)l.buf.destroy(),this._storage.delete(i)}}class Wf{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Xh=a.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Iu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class x0{constructor(i,l){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const by=a.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class hw{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,l){const d=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new a.eB,S=new a.b1;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(w,by.members),this.vignetteIdx=i.context.createIndexBuffer(S)}const _=a.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,d);const w={u_vignetteShape:(y={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(i,i.context.gl.TRIANGLES,Ht.disabled,Sr.disabled,Ur.alphaBlended,Pr.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class Ty{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,l){const d=i.getFreeCameraOptions().position,_=d.toAltitude(),y=d.toLngLat(),w=a.an(y.lng),S=a.an(y.lat),A=i.pixelsPerMeter/l,P=w*a.eD,M=a.eD*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+M,D=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*A,this._accumulatedOffsetY+=z*A,this._accumulatedElevation+=D*A,this._offsetXPrev=P,this._offsetYPrev=M,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Sy(f,i){return[-(f[0]-Math.floor(f[0]/i)*i),-(f[1]-Math.floor(f[1]/i)*i),-(f[2]-Math.floor(f[2]/i)*i)]}function Ts(f){const i=a.eo(1323123451230),l=[];for(let d=0;d<f;++d){const _=2*i()-1,y=2*i()-1,w=2*i()-1;l.push(a.d4(_,y,w))}return l}function Bl(f,i,l,d,_){const y=a.aA((_-l)/(d-l),0,1);return(1-y)*f+y*i}class Cu{constructor(i){this._movement=new Ty,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new hw,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,l){const d=i.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,y=a.c6([]);a.c8(y,y,a.an(90)-d._pitch),a.c7(y,y,-d.angle);const w=a.cb(new Float32Array(16),y),S=a.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=a.ed([],S),P=a.aB([],A,w),M=Date.now()/1e3;return this._accumulatedTimeFromStart+=(M-this._prevTime)*l,this._prevTime=M,{projectionMatrix:_,modelviewMatrix:P}}}class Ui extends Cu{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new x0(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const l=i.context;if(!this.particlesVx){const d=Ts(this.particlesCount),_=new a.eE,y=new a.b1;let w=0;const S=a.eo(1323123451230);for(let A=0;A<d.length;++A){const P=d[A],M=[2*S()-1,S(),S(),S()];_.emplaceBack(P[0],P[1],P[2],-1,-1,...M),_.emplaceBack(P[0],P[1],P[2],1,-1,...M),_.emplaceBack(P[0],P[1],P[2],1,1,...M),_.emplaceBack(P[0],P[1],P[2],-1,1,...M),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=l.createVertexBuffer(_,Xh.members),this.particlesIdx=l.createIndexBuffer(y)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=i.transform.zoom;if(l.revealStart>d)return;const _=Bl(0,1,l.revealStart,l.revealStart+l.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let w=[-y.direction.x,y.direction.y,-100];a.aw(w,w);const S=structuredClone(this._vignetteParams);S.strength*=_,y.overrideStyleParameters||(y.intensity=i.style.rain.state.density,y.timeFactor=i.style.rain.state.intensity,y.color=structuredClone(i.style.rain.state.color),w=structuredClone(i.style.rain.state.direction),y.screenThinning.intensity=i.style.rain.state.centerThinning,y.dropletSizeX=i.style.rain.state.dropletSize[0],y.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],y.distortionStrength=100*i.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(i.style.rain.state.vignetteColor));const A=this.updateOnRender(i,y.timeFactor),P=i.context,M=P.gl,z=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new a.T(P,{width:i.width,height:i.height,data:null},M.RGBA8)),y.distortionStrength>0&&(P.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const D=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(P,D),P.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const j=[y.color.r,y.color.g,y.color.b,y.color.a],V=(G,te)=>{const K=Sy(this._movement.getPosition(),G),oe=y.dropletSizeX,he=y.dropletSizeX*y.dropletSizeYScale,ge=i.width/2,Se=i.height/2,be=Bl(0,y.screenThinning.start,0,1,y.screenThinning.intensity),Ee=Bl(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),Te=Bl(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),we=(Ae={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:G,rainDropletSize:[oe,he],distortionStrength:y.distortionStrength,rainDirection:w,color:j,screenSize:[z.width,z.height],thinningCenterPos:[ge,Se],thinningShape:[be,Ee,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const qe=Math.round(y.intensity*this.particlesCount),Ne=a.bg.simpleSegment(0,0,4*qe,2*qe);D.draw(i,M.TRIANGLES,Ht.disabled,Sr.disabled,Ur.alphaBlended,Pr.disabled,we,"rain_particles",this.particlesVx,this.particlesIdx,Ne)};y.distortionStrength>0&&V(y.boxSize,!0),V(y.boxSize,!1),this._vignette.draw(i,S)}}const ii=a.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ey extends Cu{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new x0(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const l=i.context;if(!this.particlesVx){const d=Ts(this.particlesCount),_=new a.eF,y=new a.b1;let w=0;const S=a.eo(1323123451230);for(let A=0;A<d.length;++A){const P=d[A],M=S(),z=S(),D=S(),j=[A/d.length,M,z,D],V=[S(),S()];_.emplaceBack(P[0],P[1],P[2],-1,-1,...j,...V),_.emplaceBack(P[0],P[1],P[2],1,-1,...j,...V),_.emplaceBack(P[0],P[1],P[2],1,1,...j,...V),_.emplaceBack(P[0],P[1],P[2],-1,1,...j,...V),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=l.createVertexBuffer(_,ii.members),this.particlesIdx=l.createIndexBuffer(y)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const l=structuredClone(this._params);let d=[-l.direction.x,l.direction.y,-100];a.aw(d,d);const _=structuredClone(this._vignetteParams),y=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=i.transform.zoom;if(y.revealStart>w)return;const S=Bl(0,1,y.revealStart,y.revealStart+y.revealRange,w);_.strength*=S,l.overrideStyleParameters||(l.intensity=i.style.snow.state.density,l.timeFactor=i.style.snow.state.intensity,l.color=structuredClone(i.style.snow.state.color),d=structuredClone(i.style.snow.state.direction),l.screenThinning.intensity=i.style.snow.state.centerThinning,l.billboardSize=2.79*i.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(i.style.snow.state.vignetteColor));const A=this.updateOnRender(i,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=i.context,M=P.gl,z=i.transform,D=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(P,D),((j,V,G)=>{const te=Sy(this._movement.getPosition(),j),K=z.width/2,oe=z.height/2,he=Bl(0,G.screenThinning.start,0,1,G.screenThinning.intensity),ge=Bl(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),Se=Bl(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),be=(Ee={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:j,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[K,oe],thinningShape:[he,ge,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:Se,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:d},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_horizontalOscillationRadius:Ee.horizontalOscillationRadius,u_horizontalOscillationRate:Ee.horizontalOscillationRate,u_boxSize:Ee.boxSize,u_billboardSize:Ee.billboardSize,u_simpleShapeParameters:Ee.simpleShapeParameters,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_particleColor:Ee.color,u_direction:Ee.direction});var Ee;const Te=Math.round(G.intensity*this.particlesCount),we=a.bg.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&D.draw(i,M.TRIANGLES,Ht.disabled,Sr.disabled,Ur.alphaBlended,Pr.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,we)})(l.boxSize,0,l),this._vignette.draw(i,_)}}const jl={symbol:function(f,i,l,d,_){if(f.renderPass!=="translucent")return;const y=Sr.disabled,w=f.colorModeForRenderPass(),S=l.layout.get("text-variable-anchor"),A=l.layout.get("text-size-scale-range"),P=a.aA(f.scaleFactor,A[0],A[1]);S&&function(D,j,V,G,te,K,oe,he){const ge=j.transform,Se=te==="map",be=K==="map";for(const Ee of D){const Te=G.getTile(Ee),we=Te.getBucket(V);if(!we||!we.text||!we.text.segments.get().length)continue;const Ae=a.bK(we.textSizeData,ge.zoom,he),qe=lc(Ee,we.getProjection(),ge),Ne=ge.calculatePixelsToTileUnitsMatrix(Te),rt=ia(qe,Te.tileID.canonical,be,Se,ge,we.getProjection(),Ne),$e=we.hasIconTextFit()&&we.hasIconData();Ae&&Nf(we,Se,be,oe,ge,rt,Ee,Math.pow(2,ge.zoom-Te.tileID.overscaledZ),Ae,$e)}}(d,f,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_,P);const M=l.paint.get("icon-opacity").constantOr(1)!==0,z=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||z)?qh(f,i,l,d,y,w):(M&&qh(f,i,l,d,y,w,{onlyIcons:!0}),z&&qh(f,i,l,d,y,w,{onlyText:!0})),i.map.showCollisionBoxes&&(Wh(f,i,l,d,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Wh(f,i,l,d,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,l,d){if(f.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),S=l.layout.get("circle-sort-key").constantOr(1)!==void 0,A=l.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const P=f.context,M=P.gl,z=f.transform,D=!(!f.terrain||!f.terrain.enabled),j=l.layout.get("circle-elevation-reference"),V=f.depthModeForSublayer(0,Ht.ReadOnly),G=new Ht(f.context.gl.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D),te=j==="none"||D?V:G,K=Sr.disabled,oe=f.colorModeForDrapableLayerRenderPass(A),he=z.projection.name==="globe",ge=[a.aF(z.center.lng),a.aJ(z.center.lat)],Se=[];for(let Ee=0;Ee<d.length;Ee++){const Te=d[Ee],we=i.getTile(Te),Ae=we.getBucket(l);if(!Ae||Ae.projection.name!==z.projection.name)continue;const qe=Ae.programConfigurations.get(l.id),Ne=Ae.layoutVertexBuffer,rt=Ae.globeExtVertexBuffer,$e=Ae.indexBuffer,Qe=a.dZ(l),kt=[rt],We=f.isTileAffectedByFog(Te);he&&Qe.push("PROJECTION_GLOBE_VIEW"),Qe.push("DEPTH_D24"),f.terrain&&z.depthOcclusionForSymbolsAndCircles&&Qe.push("DEPTH_OCCLUSION"),Ae.hasElevation&&!f.terrain&&(Qe.push("ELEVATED_ROADS"),kt.push(Ae.elevatedLayoutVertexBuffer));const Oe=f.getOrCreateProgram("circle",{config:qe,defines:Qe,overrideFog:We}),ot=z.projection.createInversionMatrix(z,Te.canonical),Xe={programConfiguration:qe,program:Oe,layoutVertexBuffer:Ne,dynamicBuffers:kt,indexBuffer:$e,uniformValues:a.d_(f,Te,we,ot,ge,l),tile:we};if(S){const gt=Ae.segments.get();for(const Ct of gt)Se.push({segments:new a.bg([Ct]),sortKey:Ct.sortKey,state:Xe})}else Se.push({segments:Ae.segments,sortKey:0,state:Xe})}S&&Se.sort((Ee,Te)=>Ee.sortKey-Te.sortKey);const be={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const Ee of Se){const{programConfiguration:Te,program:we,layoutVertexBuffer:Ae,dynamicBuffers:qe,indexBuffer:Ne,uniformValues:rt,tile:$e}=Ee.state,Qe=Ee.segments;f.terrain&&f.terrain.setupElevationDraw($e,we,be),f.uploadCommonUniforms(P,we,$e.tileID.toUnwrapped()),we.draw(f,M.TRIANGLES,te,K,oe,Pr.disabled,rt,l.id,Ae,Ne,Qe,l.paint,z.zoom,Te,qe)}},heatmap:function(f,i,l,d){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const _=f.context,y=_.gl,w=Sr.disabled,S=new Ur([y.ONE,y.ONE,y.ONE,y.ONE],a.ao.transparent,[!0,!0,!0,!0]);(function(j,V,G,te){const K=j.gl,oe=V.width*te,he=V.height*te;j.activeTexture.set(K.TEXTURE1),j.viewport.set([0,0,oe,he]);let ge=G.heatmapFbo;if(!ge||ge&&(ge.width!==oe||ge.height!==he)){ge&&ge.destroy();const Se=K.createTexture();K.bindTexture(K.TEXTURE_2D,Se),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ge=G.heatmapFbo=j.createFramebuffer(oe,he,!0,null),function(be,Ee,Te,we,Ae,qe){const Ne=be.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,Ae,qe,0,Ne.RGBA,be.extRenderToTextureHalfFloat?Ne.HALF_FLOAT:Ne.UNSIGNED_BYTE,null),we.colorAttachment.set(Te)}(j,0,Se,ge,oe,he)}else K.bindTexture(K.TEXTURE_2D,ge.colorAttachment.get()),j.bindFramebuffer.set(ge.framebuffer)})(_,f,l,f.transform.projection.name==="globe"?.5:.25),_.clear({color:a.ao.transparent});const A=f.transform,P=A.projection.name==="globe",M=P?["PROJECTION_GLOBE_VIEW"]:[],z=P?Pr.frontCCW:Pr.disabled,D=[a.aF(A.center.lng),a.aJ(A.center.lat)];for(let j=0;j<d.length;j++){const V=d[j];if(i.hasRenderableParent(V))continue;const G=i.getTile(V),te=G.getBucket(l);if(!te||te.projection.name!==A.projection.name)continue;const K=f.isTileAffectedByFog(V),oe=te.programConfigurations.get(l.id),he=f.getOrCreateProgram("heatmap",{config:oe,defines:M,overrideFog:K}),{zoom:ge}=f.transform;f.terrain&&f.terrain.setupElevationDraw(G,he),f.uploadCommonUniforms(_,he,V.toUnwrapped());const Se=A.projection.createInversionMatrix(A,V.canonical);he.draw(f,y.TRIANGLES,Ht.disabled,w,S,z,uy(f,V,G,Se,D,ge,l.paint.get("heatmap-intensity")),l.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,l.paint,f.transform.zoom,oe,P?[te.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(_,y){const w=_.context,S=w.gl,A=y.heatmapFbo;if(!A)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let P=y.colorRampTexture;P||(P=y.colorRampTexture=new a.T(w,y.colorRamp,S.RGBA8)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,S.TRIANGLES,Ht.disabled,Sr.disabled,_.colorModeForRenderPass(),Pr.disabled,((M,z,D,j)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(f,l))},line:function(f,i,l,d){if(f.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const w=l.paint.get("line-emissive-strength"),S=l.paint.get("line-occlusion-opacity"),A=l.layout.get("line-elevation-reference"),P=l.layout.get("line-width-unit")==="meters",M=A==="sea",z=!(!f.terrain||!f.terrain.enabled),D=f.context,j=D.gl;if(l.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const V=l.layout.get("line-cross-slope"),G=V!==void 0,te=V<1,K=f.colorModeForDrapableLayerRenderPass(w),oe=f.terrain&&f.terrain.renderingToTexture,he=oe?1:a.o.devicePixelRatio,ge=l.paint.get("line-dasharray"),Se=ge.constantOr(1),be=l.layout.get("line-cap"),Ee=ge.constantOr(null),Te=be.constantOr(null),we=l.paint.get("line-pattern"),Ae=we.constantOr(1),qe=l.paint.get("line-pattern-cross-fade"),Ne=we.constantOr(null),rt=l.paint.get("line-opacity").constantOr(1);let $e=!Ae&&rt!==1||f.depthOcclusion&&S>0&&S<1;const Qe=l.paint.get("line-gradient"),kt=Ae?"linePattern":"line",We=a.d$(l);let Oe;if(oe&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&($e=!1),S!==0&&f.depthOcclusion){const Ct=l.paint._values["line-opacity"];Ct&&Ct.value&&Ct.value.kind==="constant"?Oe=Ct.value:a.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&We.push("VARIABLE_LINE_WIDTH");const ot=(Ct,jt,St,xt,lr,tr)=>{for(const nr of Ct){const er=i.getTile(nr);if(Ae&&!er.patternsLoaded())continue;const Rr=er.getBucket(l);if(!Rr||Rr.elevationType!=="none"&&!lr||Rr.elevationType==="none"&&lr)continue;f.prepareDrawTile();const Br=[...jt],$r=f.shadowRenderer,xi=Rr.elevationType==="road"&&!!$r&&$r.enabled;let Or=[0,0,0];if(xi){const Gr=f.style.directionalLight,Er=f.style.ambientLight;Gr&&Er&&(Or=oa(f.style,Gr,Er)),Br.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const li=Rr.programConfigurations.get(l.id);let mi=!1;if(Ne&&er.imageAtlas){const Gr=a.e0.from(Ne),Er=Gr.getPrimary().scaleSelf(he).toString(),vi=er.imageAtlas.patternPositions.get(Er),nn=Gr.getSecondary(),Ki=nn?er.imageAtlas.patternPositions.get(nn.scaleSelf(he).toString()):null;mi=!!vi&&!!Ki,vi&&li.setConstantPatternPositions(vi,Ki)}qe>0&&(mi||li.getPatternTransitionVertexBuffer("line-pattern"))&&Br.push("LINE_PATTERN_TRANSITION");const Vi=f.isTileAffectedByFog(nr),jr=f.getOrCreateProgram(kt,{config:li,defines:Br,overrideFog:Vi});if(!Ae&&Ee&&Te&&er.lineAtlas){const Gr=er.lineAtlas.getDash(Ee,Te);Gr&&li.setConstantPatternPositions(Gr)}xi&&$r.setupShadows(er.tileID.toUnwrapped(),jr,"vector-tile");let[hi,ci]=l.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&hi!==ci&&(hi===0&&(hi-=1),ci===1&&(ci+=1));const pi=oe?nr.projMatrix:null,Hi=P?1/Rr.tileToMeter/a.ay(er,1,f.transform.zoom):1,hn=P?1/Rr.tileToMeter/a.ay(er,1,Math.floor(f.transform.zoom)):1,Hn=Ae?a.e1(f,er,l,pi,he,Hi,hn,[hi,ci],Or,qe):a.e2(f,er,l,pi,Rr.lineClipsArray.length,he,Hi,hn,[hi,ci],Or);if(Qe){const Gr=Rr.gradients[l.id];let Er=Gr.texture;if(l.gradientVersion!==Gr.version){let vi=256;if(l.stepInterpolant){const nn=i.getSource().maxzoom,Ki=nr.canonical.z===nn?Math.ceil(1<<f.transform.maxZoom-nr.canonical.z):1;vi=a.aA(a.e3(Rr.maxLineLength/a.al*1024*Ki),256,D.maxTextureSize)}Gr.gradient=a.e4({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:vi,image:Gr.gradient||void 0,clips:Rr.lineClipsArray}),Gr.texture?Gr.texture.update(Gr.gradient):Gr.texture=new a.T(D,Gr.gradient,j.RGBA8),Gr.version=l.gradientVersion,Er=Gr.texture}D.activeTexture.set(j.TEXTURE1),Er.bind(l.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}Se&&(D.activeTexture.set(j.TEXTURE0),er.lineAtlasTexture&&er.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),li.updatePaintBuffers()),Ae&&(D.activeTexture.set(j.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),li.updatePaintBuffers()),lr&&!M&&f.terrain.setupElevationDraw(er,jr),f.uploadCommonUniforms(D,jr,nr.toUnwrapped());const Wi=Gr=>{Oe!=null&&(Oe.value=rt*S),jr.draw(f,j.TRIANGLES,St,Gr,K,Pr.disabled,Hn,l.id,Rr.layoutVertexBuffer,Rr.indexBuffer,Rr.segments,l.paint,f.transform.zoom,li,[Rr.layoutVertexBuffer2,Rr.patternVertexBuffer,Rr.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=rt)};if($e&&!lr){const Gr=f.stencilModeForClipping(nr).ref;Gr===0&&oe&&D.clear({stencil:0});const Er={func:j.EQUAL,mask:255};Hn.u_alpha_discard_threshold=.8,Wi(new Sr(Er,Gr,255,j.KEEP,j.KEEP,j.INVERT)),Hn.u_alpha_discard_threshold=0,Wi(new Sr(Er,Gr,255,j.KEEP,j.KEEP,j.KEEP))}else Hn.u_alpha_discard_threshold=$e&&lr&&tr?.8:0,Wi(lr?xt:f.stencilModeForClipping(nr))}};let Xe=f.depthModeForSublayer(0,Ht.ReadOnly);const gt=new Ht(f.depthOcclusion?j.GREATER:j.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D);if(l.hasNonElevatedBuckets){const Ct=!oe&&f.terrain;S!==0&&Ct?a.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ct?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):ot(d,We,Xe,Sr.disabled,!1,!0)}if(l.hasElevatedBuckets){A==="hd-road-markup"?z||(Xe=gt,We.push("ELEVATED_ROADS")):(We.push("ELEVATED"),Xe=gt,G&&We.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),M&&We.push("ELEVATION_REFERENCE_SEA"));const Ct=$e?f.stencilModeFor3D():Sr.disabled;f.forceTerrainMode=!0,ot(d,We,Xe,Ct,!0,!0),$e&&ot(d,We,Xe,Ct,!0,!1),f.forceTerrainMode=!1}$e&&(f.resetStencilClippingMasks(),oe&&D.clear({stencil:0})),S===0||f.depthOcclusion||oe||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,i,l,d){const _=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=l.paint.get("fill-emissive-strength"),S=f.colorModeForDrapableLayerRenderPass(w),A=l.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(a.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let M="none";l.layout.get("fill-elevation-reference")!=="none"?M="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(M="offset");const z=!(!f.terrain||!f.terrain.enabled),D={painter:f,sourceCache:i,layer:l,coords:d,colorMode:S,elevationType:M,terrainEnabled:z,pass:P};if(f.renderPass!=="shadow")if(M!=="offset"){if(Su(D,!1),M==="road"){const j=!z&&f.renderPass==="translucent";j&&vc(f,i,l,d,"geometry"),Su(D,!0,Sr.disabled),j&&function(V){const{painter:G,sourceCache:te,layer:K,coords:oe,colorMode:he}=V,ge=G.context.gl,Se=V.painter.shadowRenderer,be=!!Se&&Se.enabled,Ee=new Ht(G.context.gl.LEQUAL,Ht.ReadOnly,G.depthRangeFor3D);let Te=[0,0,0];if(be){const Ae=G.style.directionalLight,qe=G.style.ambientLight;Ae&&qe&&(Te=oa(G.style,Ae,qe))}const we=Ae=>{for(const qe of oe){const Ne=te.getTile(qe),rt=Ne.getBucket(K);if(!rt)continue;const $e=rt.elevatedStructures;if(!$e)continue;let Qe,kt;if(Ae?(Qe=$e.renderableBridgeSegments,kt=$e.bridgeProgramConfigurations.get(K.id)):(Qe=$e.renderableTunnelSegments,kt=$e.tunnelProgramConfigurations.get(K.id)),!Qe||Qe.segments[0].primitiveLength===0)continue;kt.updatePaintBuffers(),G.prepareDrawTile();const We=G.isTileAffectedByFog(qe),Oe=[];be&&Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ot=G.getOrCreateProgram("elevatedStructures",{config:kt,overrideFog:We,defines:Oe}),Xe=G.translatePosMatrix(qe.projMatrix,Ne,K.paint.get("fill-translate"),K.paint.get("fill-translate-anchor"));be&&Se.setupShadows(Ne.tileID.toUnwrapped(),ot,"vector-tile");const gt=rw(Xe,Te);G.uploadCommonUniforms(G.context,ot,qe.toUnwrapped()),ot.draw(G,ge.TRIANGLES,Ee,Sr.disabled,he,Pr.backCCW,gt,K.id,$e.vertexBuffer,$e.indexBuffer,Qe,K.paint,G.transform.zoom,kt,[$e.vertexBufferNormal])}};we(!0),we(!1)}(D)}}else Su(D,!1,f.stencilModeFor3D());else f.shadowRenderer&&M==="road"&&!z&&function(j){const{painter:V,sourceCache:G,layer:te,coords:K}=j,oe=V.context.gl,he=j.painter.shadowRenderer;for(const ge of K){const Se=G.getTile(ge),be=Se.getBucket(te);if(!be)continue;const Ee=be.elevatedStructures;if(!Ee||!Ee.shadowCasterSegments||Ee.shadowCasterSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const Te=be.bufferData.programConfigurations.get(te.id),we=V.isTileAffectedByFog(ge),Ae=V.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:we}),qe=he.calculateShadowPassMatrixFromTile(Se.tileID.toUnwrapped());V.uploadCommonUniforms(V.context,Ae,ge.toUnwrapped());const Ne={u_matrix:qe,u_depth_bias:0};Ae.draw(V,oe.TRIANGLES,he.getShadowPassDepthMode(),Sr.disabled,he.getShadowPassColorMode(),Pr.disabled,Ne,te.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.shadowCasterSegments,te.paint,V.transform.zoom,Te)}}(D)},"fill-extrusion":function(f,i,l,d){const _=l.paint.get("fill-extrusion-opacity"),y=f.context,w=y.gl,S=f.terrain,A=S&&S.renderingToTexture;if(_===0)return;const P=f.conflationActive&&f.style.isLayerClipped(l,i.getSource()),M=f.style.order.indexOf(l.fqid);if(P&&function(z,D,j,V,G){for(const te of V){const K=D.getTile(te).getBucket(j);K&&(K.updateReplacement(te,z.replacementSource,G),K.uploadCentroid(z.context))}}(f,i,l,d,M),S||P)for(const z of d){const D=i.getTile(z).getBucket(l);D&&Fl(f.context,i,z,D,l,S,P)}if(f.renderPass==="shadow"&&f.shadowRenderer){const z=f.shadowRenderer;if(S&&_<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ad)return;const D=z.getShadowPassDepthMode(),j=z.getShadowPassColorMode();Wt(f,i,l,d,D,Sr.disabled,j,P)}else if(f.renderPass==="translucent"){const z=!l.paint.get("fill-extrusion-pattern").constantOr(1),D=l.paint.get("fill-extrusion-color").constantOr(a.ao.white);if(!A&&D.a!==0){const j=new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D);_===1&&z?Wt(f,i,l,d,j,Sr.disabled,Ur.unblended,P):(Wt(f,i,l,d,j,Sr.disabled,Ur.disabled,P),Wt(f,i,l,d,j,f.stencilModeFor3D(),f.colorModeForRenderPass(),P),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&z&&(!S&&f.transform.projection.name!=="globe"||A)){const j=l.paint.get("fill-extrusion-opacity"),V=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=l.paint.get("fill-extrusion-flood-light-intensity"),K=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(K?null:l.lut).toArray01().slice(0,3),he=V>0&&G>0,ge=te>0,Se=(Te,we,Ae)=>(1-Ae)*Te+Ae*we,be=new h0;be.translate=l.paint.get("fill-extrusion-translate"),be.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),be.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),be.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const Ee=Te=>{const we=f.depthModeForSublayer(1,Ht.ReadOnly,w.LEQUAL,!0),Ae=l.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=Se(.1,3,Ae),Ne=f._showOverdrawInspector;if(!Ne){const rt=new Sr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),$e=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.ao.transparent,[!1,!1,!1,!0],w.MIN);Ka(be,f,i,l,d,we,rt,$e,Pr.disabled,Te,"sdf",j,V,G,te,oe,qe,P,!1)}{const rt=Ne?Sr.disabled:new Sr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),$e=Ne?f.colorModeForRenderPass():new Ur([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],a.ao.transparent,[!0,!0,!0,!0]);Ka(be,f,i,l,d,we,rt,$e,Pr.disabled,Te,"color",j,V,G,te,oe,qe,P,!1)}};if(A){const Te=(we,Ae,qe)=>{const Ne=f.depthModeForSublayer(1,Ht.ReadOnly,w.LEQUAL,!1),rt=l.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$e=Se(.1,3,rt);{const Qe=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.ao.transparent,[!1,!1,!1,!0]);Ka(be,f,i,l,d,Ne,Sr.disabled,Qe,Pr.disabled,we,"clear",j,V,G,te,oe,$e,P,Ae)}{const Qe=new Sr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),kt=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.ao.transparent,[!1,!1,!1,!0],w.MIN);Ka(be,f,i,l,d,Ne,Qe,kt,Pr.disabled,we,"sdf",j,V,G,te,oe,$e,P,Ae)}{const Qe=we?w.ZERO:w.ONE_MINUS_DST_ALPHA,kt=new Sr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),We=new Ur([Qe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],a.ao.transparent,[!0,!0,!0,!0]);Ka(be,f,i,l,d,Ne,kt,We,Pr.disabled,we,"color",j,V,G,te,oe,$e,P,Ae)}{const Qe=new Ur([w.ONE,w.ONE,w.ONE,we?w.ZERO:w.ONE],a.ao.transparent,[!1,!1,!1,!0],we?w.FUNC_ADD:w.MAX);Ka(be,f,i,l,d,Ne,Sr.disabled,Qe,Pr.disabled,we,"clear",j,V,G,te,oe,$e,P,Ae,qe)}};if(he||ge){let we;if(f.prepareDrawTile(),S){const Ae=S.drapeBufferSize[0],qe=S.drapeBufferSize[1];we=S.framebufferCopyTexture,we&&(!we||we.size[0]===Ae&&we.size[1]===qe)||(we&&we.destroy(),we=S.framebufferCopyTexture=new a.T(y,new a.q({width:Ae,height:qe}),w.RGBA8)),we.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Ae,qe)}he&&Te(!0,!1,we),ge&&Te(!1,!0,we)}}else he&&Ee(!0),ge&&Ee(!1),(he||ge)&&f.resetStencilClippingMasks()}}},building:function(f,i,l,d){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const _=l.paint.get("building-ambient-occlusion-ground-intensity"),y=l.paint.get("building-ambient-occlusion-ground-radius"),w=l.paint.get("building-ambient-occlusion-ground-attenuation"),S=l.paint.get("building-opacity");if(S<=0)return;let A=_>0&&y>0,P=!0;const M=l.paint.get("building-vertical-scale");(!f.shadowRenderer||M<1)&&(P=!1);const z=f.conflationActive&&f.style.isLayerClipped(l,i.getSource()),D=f.style.order.indexOf(l.fqid);if(function(j,V,G,te,K,oe){for(const he of oe){const ge=V.getTile(he).getBucket(G);ge&&(K&&ge.updateReplacement(he,j.replacementSource,te),ge.uploadUpdatedIndexBuffer(j.context))}}(f,i,l,D,z,d),function(j,V,G,te){for(const K of te){const oe=V.getTile(K).getBucket(G);oe&&oe.needsEvaluation()&&oe.uploadUpdatedColorBuffer(j.context)}}(f,i,l,d),l.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const j=f.shadowRenderer,V=[],G=j.getShadowPassDepthMode();Bf({painter:f,source:i,layer:l,coords:d,defines:V,blendMode:j.getShadowPassColorMode(),depthMode:G,opacity:S,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(f.renderPass==="translucent"){let j=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];P&&(j=j.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(j=j.concat("NORMAL_OFFSET"));const V=l.paint.get("building-facade-emissive-chance"),G=l.paint.get("building-ambient-occlusion-intensity"),te=new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D);S<1&&Bf({painter:f,source:i,layer:l,coords:d,defines:j,blendMode:Ur.disabled,depthMode:te,opacity:S,verticalScale:M,facadeEmissiveChance:V,facadeAOIntensity:G});const K=f.colorModeForRenderPass();Bf({painter:f,source:i,layer:l,coords:d,defines:j,blendMode:K,depthMode:te,opacity:S,verticalScale:M,facadeEmissiveChance:V,facadeAOIntensity:G}),A&&function(oe,he,ge,Se,be,Ee,Te,we,Ae,qe,Ne,rt,$e){const Qe=oe.context.gl,kt=oe.depthModeForSublayer(1,Ht.ReadOnly,Qe.LEQUAL,!0),We=.1*(1-(Oe=Ne))+3*Oe;var Oe;const ot=oe._showOverdrawInspector,Xe=rt,gt=new h0;ot||Ka(gt,oe,he,ge,Se,kt,new Sr({func:Qe.ALWAYS,mask:255},255,255,Qe.KEEP,Qe.KEEP,Qe.REPLACE),new Ur([Qe.ONE,Qe.ONE,Qe.ONE,Qe.ONE],a.ao.transparent,[!1,!1,!1,!0],Qe.MIN),Pr.disabled,be,"sdf",Ee,Te,we,0,qe,We,Xe,!1);{const Ct=ot?Sr.disabled:new Sr({func:Qe.EQUAL,mask:255},255,255,Qe.KEEP,Qe.DECR,Qe.DECR),jt=ot?oe.colorModeForRenderPass():new Ur([Qe.ONE_MINUS_DST_ALPHA,Qe.DST_ALPHA,Qe.ONE,Qe.ONE],a.ao.transparent,[!0,!0,!0,!0]);Ka(gt,oe,he,ge,Se,kt,Ct,jt,Pr.disabled,be,"color",Ee,Te,we,0,qe,We,Xe,!1)}}(f,i,l,d,!0,S,_,y,0,[0,0,0],w,z)}else if(f.renderPass==="light-beam"){const j=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],V=new Ht(f.context.gl.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D);Bf({painter:f,source:i,layer:l,coords:d,defines:j,blendMode:Ur.alphaBlended,depthMode:V,opacity:S,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,i,l,d){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const _=f.context,y=f.terrain&&f.terrain.renderingToTexture,[w,S]=f.renderPass!=="translucent"||y?[{},d]:f.stencilConfigForOverlap(d);for(const A of S){const P=i.getTile(A);if(P.needsHillshadePrepare&&f.renderPass==="offscreen")G1(f,P,l);else if(f.renderPass==="translucent"){const M=f.depthModeForSublayer(0,Ht.ReadOnly),z=l.paint.get("hillshade-emissive-strength"),D=f.colorModeForDrapableLayerRenderPass(z),j=y&&f.terrain?f.terrain.stencilModeForRTTOverlap(A):w[A.overscaledZ];$1(f,A,P,l,M,j,D)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,l,d,_,y){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const w=f.transform.projection.name==="globe",S=l.paint.get("raster-elevation")!==0,A=S&&w;if(f.renderElevatedRasterBackface&&!A)return;const P=f.context,M=P.gl,z=i.getSource(),D=function(be,Ee,Te,we){const Ae=Ee.paint.get("raster-color"),qe=be.type==="raster-array",Ne=[],rt=Ee.paint.get("raster-resampling"),$e=Ee.paint.get("raster-color-mix");let Qe=Ee.paint.get("raster-color-range");const kt=[$e[0],$e[1],$e[2],0],We=$e[3];let Oe=rt==="nearest"?we.NEAREST:we.LINEAR;if(qe&&(Ne.push("RASTER_ARRAY"),Ae||Ne.push("RASTER_COLOR"),rt==="linear"&&Ne.push("RASTER_ARRAY_LINEAR"),Oe=we.NEAREST,!Qe&&be.rasterLayers)){const ot=be.rasterLayers.find(({id:Xe})=>Xe===Ee.sourceLayer);ot&&ot.fields&&ot.fields.range&&(Qe=ot.fields.range)}if(Qe=Qe||[0,1],Ae){Ne.push("RASTER_COLOR"),Te.activeTexture.set(we.TEXTURE2),Ee.updateColorRamp(Qe);let ot=Ee.colorRampTexture;ot||(ot=Ee.colorRampTexture=new a.T(Te,Ee.colorRamp,we.RGBA8)),ot.bind(we.LINEAR,we.CLAMP_TO_EDGE)}return{mix:kt,range:Qe,offset:We,defines:Ne,resampling:Oe}}(z,l,P,M);if(z instanceof a.aS&&!d.length&&!w)return;const j=l.paint.get("raster-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass(j),G=f.terrain&&f.terrain.renderingToTexture,te=!f.options.moving,K=l.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;if(z instanceof a.aS&&!d.length&&(z.onNorthPole||z.onSouthPole)){const be=S?f.stencilModeFor3D():Sr.disabled;return void Uf(!!z.onNorthPole,null,f,i,l,j,D,Pr.disabled,be)}if(!d.length)return;const[oe,he]=z instanceof a.aS||G?[{},d]:f.stencilConfigForOverlap(d),ge=he[he.length-1].overscaledZ;A&&D.defines.push("PROJECTION_GLOBE_VIEW"),S&&D.defines.push("RENDER_CUTOFF");const Se=(be,Ee,Te)=>{for(const we of be){const Ae=we.toUnwrapped(),qe=i.getTile(we);if(G&&(!qe||!qe.hasData()))continue;P.activeTexture.set(M.TEXTURE0);const Ne=py(qe,z,l,D);if(!Ne||!Ne.texture)continue;const{texture:rt,mix:$e,offset:Qe,tileSize:kt,buffer:We}=Ne;let Oe,ot;G?(Oe=Ht.disabled,ot=we.projMatrix):S?(Oe=new Ht(M.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D),ot=w?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ae,te)):(Oe=f.depthModeForSublayer(we.overscaledZ-ge,l.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,M.LESS),ot=f.transform.calculateProjMatrix(Ae,te));const Xe=f.terrain&&G?f.terrain.stencilModeForRTTOverlap(we):oe[we.overscaledZ],gt=y?0:l.paint.get("raster-fade-duration");qe.registerFadeDuration(gt);const Ct=i.findLoadedParent(we,0),jt=gc(qe,Ct,i,f.transform,gt);let St,xt;!jt.isFading&&qe.refreshedUponExpiration&&(qe.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),P.activeTexture.set(M.TEXTURE0),rt.bind(K,M.CLAMP_TO_EDGE),P.activeTexture.set(M.TEXTURE1),Ct?(Ct.texture&&Ct.texture.bind(K,M.CLAMP_TO_EDGE),St=Math.pow(2,Ct.tileID.overscaledZ-qe.tileID.overscaledZ),xt=[qe.tileID.canonical.x*St%1,qe.tileID.canonical.y*St%1]):rt.bind(K,M.CLAMP_TO_EDGE),"useMipmap"in rt&&P.extTextureFilterAnisotropic&&f.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const lr=f.transform;let tr;const nr=S?aw(lr):[0,0,0,0];let er,Rr,Br,$r,xi,Or=0;if(A&&z instanceof a.aS&&z.coordinates.length>3)er=Float32Array.from(a.bk(a.dF(new a.cC(0,0,0)))),Rr=Float32Array.from(lr.globeMatrix),Br=Float32Array.from(a.dB(lr)),$r=[a.aF(lr.center.lng),a.aJ(lr.center.lat)],tr=z.elevatedGlobePerspectiveTransform,xi=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const jr=a.dC(we.canonical);Or=a.dD(jr.getCenter().lat),er=Float32Array.from(a.bk(a.dF(we.canonical))),Rr=Float32Array.from(lr.globeMatrix),Br=Float32Array.from(a.dB(lr)),$r=[a.aF(lr.center.lng),a.aJ(lr.center.lat)],tr=[0,0],xi=Float32Array.from(a.dE(we.canonical,jr,Or,lr.worldSize/lr._pixelsPerMercatorPixel))}else tr=z instanceof a.aS?z.perspectiveTransform:[0,0],er=new Float32Array(16),Rr=new Float32Array(9),Br=new Float32Array(16),$r=[0,0],xi=new Float32Array(9);const li=kf(ot,er,Rr,Br,xi,xt||[0,0],a.aj(f.transform.zoom),$r,nr,St||1,jt,l,tr,S?l.paint.get("raster-elevation"):0,2,$e,Qe,D.range,kt,We,j),mi=f.isTileAffectedByFog(we),Vi=f.getOrCreateProgram("raster",{defines:D.defines,overrideFog:mi});if(f.uploadCommonUniforms(P,Vi,Ae),z instanceof a.aS){const jr=z.elevatedGlobeVertexBuffer,hi=z.elevatedGlobeIndexBuffer;if(G||!w)z.boundsBuffer&&z.boundsSegments&&Vi.draw(f,M.TRIANGLES,Oe,Sr.disabled,V,Pr.disabled,li,l.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else if(jr&&hi){const ci=lr.zoom<=a.cZ?z.elevatedGlobeSegments:z.getSegmentsForLongitude(lr.center.lng);ci&&Vi.draw(f,M.TRIANGLES,Oe,Sr.disabled,V,Ee,li,l.id,jr,hi,ci)}}else if(A){Oe=new Ht(M.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D);const jr=f.globeSharedBuffers;if(jr){const[hi,ci,pi]=jr.getGridBuffers(Or,!1);Vi.draw(f,M.TRIANGLES,Oe,Te||Xe,f.colorModeForRenderPass(),Ee,li,l.id,hi,ci,pi)}}else{const{tileBoundsBuffer:jr,tileBoundsIndexBuffer:hi,tileBoundsSegments:ci}=f.getTileBoundsBuffers(qe);Vi.draw(f,M.TRIANGLES,Oe,Xe,V,Pr.disabled,li,l.id,jr,hi,ci)}}if(!(z instanceof a.aS)&&A)for(const we of be){const Ae=we.canonical.y===(1<<we.canonical.z)-1;we.canonical.y===0&&Uf(!0,we,f,i,l,j,D,Ee,Te||Sr.disabled),Ae&&Uf(!1,we,f,i,l,j,D,Ee===Pr.frontCW?Pr.backCW:Pr.frontCW,Te||Sr.disabled)}};A?Se(he,f.renderElevatedRasterBackface?Pr.backCW:Pr.frontCW,f.stencilModeFor3D()):Se(he,Pr.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,l,d,_,y){f.renderPass==="offscreen"&&function(w,S,A,P){if(!P.length)return;const M=w.context,z=M.gl,D=S.getSource();if(!(D instanceof Tl))return;const j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let V=A.particlePositionRGBAImage;if(!V||V.width!==j){const he=function(ge){const Se=ge*ge,be=new Uint8Array(4*Se),Ee=function(we){return we|=0,we=Math.imul(2747636419^we,2654435769),we=Math.imul(we^we>>>16,2654435769),((we=Math.imul(we^we>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let we=0;we<Se;we++){const Ae=Te*(Ee(2*we+0)+xc),qe=Te*(Ee(2*we+1)+xc),Ne=255*Ae%1,rt=255*qe%1,$e=Ne,Qe=qe-rt/255,kt=rt;be[4*we+0]=255*(Ae-Ne/255),be[4*we+1]=255*$e,be[4*we+2]=255*Qe,be[4*we+3]=255*kt}return be}(j);V=A.particlePositionRGBAImage=new a.q({width:j,height:j},he)}let G=A.particleFramebuffer;G?G.width!==j&&(G.destroy(),G=A.particleFramebuffer=M.createFramebuffer(j,j,!0,null)):G=A.particleFramebuffer=M.createFramebuffer(j,j,!0,null);const te=[];for(const he of P){const ge=S.getTile(he);if(!(ge instanceof Ih))continue;const Se=io(ge,D,A);if(!Se)continue;const be=[ge.tileSize,ge.tileSize];let Ee=A.tileFramebuffer;Ee||(Ee=A.tileFramebuffer=M.createFramebuffer(be[0],be[1],!0,null));let Te=ge.rasterParticleState;Te||(Te=ge.rasterParticleState=new cw(M,he,be,V));const we=Te.update(A.lastInvalidatedAt);Te.particleTextureDimension!==j&&Te.updateParticleTexture(he,V);const Ae=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Ae;const qe=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=qe,te.push([he,Se,Te,we])}if(te.length===0)return;const K=a.o.now(),oe=A.previousDrawTimestamp?.001*(K-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=K,A.hasColorMap()){M.activeTexture.set(z.TEXTURE0+2);let he=A.colorRampTexture;he||(he=A.colorRampTexture=new a.T(M,A.colorRamp,z.RGBA8)),he.bind(z.LINEAR,z.CLAMP_TO_EDGE)}M.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(he,ge,Se){const be=he.context,Ee=be.gl,Te=ge.tileFramebuffer;be.activeTexture.set(Ee.TEXTURE0);const we={u_texture:0,u_opacity:1.05*(qe=ge.paint.get("raster-particle-fade-opacity-factor"))/(qe+.05)},Ae=he.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var qe;for(const Ne of Se){const[,,rt,$e]=Ne;Te.colorAttachment.set(rt.targetColorTexture.texture),be.viewport.set([0,0,Te.width,Te.height]),be.clear({color:a.ao.transparent}),$e&&(rt.backgroundColorTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE),Ae.draw(he,Ee.TRIANGLES,Ht.disabled,Sr.disabled,Ur.alphaBlended,Pr.disabled,we,ge.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments))}}(w,A,te),function(he,ge,Se,be){const Ee=he.context,Te=Ee.gl,we=Se.tileFramebuffer,Ae=he.transform.projection.name==="globe",qe=Se.paint.get("raster-particle-max-speed");for(const Ne of be){const[rt,$e,Qe]=Ne;Ee.activeTexture.set(Te.TEXTURE0+0),$e.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),we.colorAttachment.set(Qe.targetColorTexture.texture);const kt=he.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1});Ee.activeTexture.set(Te.TEXTURE0+1);const We=$e.scalarData?[]:[0,1,2,3].map(Xe=>a.e6[Xe](rt));We.push(rt);const Oe=rt.canonical.x,ot=rt.canonical.y;for(const Xe of We){const gt=ge.getTile(Ae?Xe.wrapped():Xe);if(!gt)continue;const Ct=gt.rasterParticleState;if(!Ct)continue;const jt=Xe.canonical.x+(1<<Xe.canonical.z)*(Xe.wrap-rt.wrap),St=Xe.canonical.y;Ct.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const xt=s0(1,Ct.particleTexture0.size[0],[jt-Oe,St-ot],0,$e.texture.size,2,qe,$e.textureOffset,$e.scale,$e.offset);kt.draw(he,Te.POINTS,Ht.disabled,Sr.disabled,Ur.alphaBlended,Pr.disabled,xt,Se.id,Ct.particleIndexBuffer,void 0,Ct.particleSegment)}}}(w,S,A,te),M.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(he,ge,Se,be){const Ee=he.context,Te=Ee.gl,we=ge.paint.get("raster-particle-max-speed"),Ae=be*ge.paint.get("raster-particle-speed-factor")*.15,qe=function(rt){return Math.pow(rt,6)}(.01+1*ge.paint.get("raster-particle-reset-rate-factor")),Ne=ge.particleFramebuffer;Ee.viewport.set([0,0,Ne.width,Ne.height]);for(const rt of Se){const[,$e,Qe]=rt;Ee.activeTexture.set(Te.TEXTURE0+0),$e.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Ee.activeTexture.set(Te.TEXTURE0+1);const kt=Qe.particleTexture0;kt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const We=Rf(1,kt.size[0],0,$e.texture.size,we,Ae,qe,$e.textureOffset,$e.scale,$e.offset);Ne.colorAttachment.set(Qe.particleTexture1.texture),Ee.clear({color:a.ao.transparent}),he.getOrCreateProgram("rasterParticleUpdate",{defines:$e.defines}).draw(he,Te.TRIANGLES,Ht.disabled,Sr.disabled,Ur.unblended,Pr.disabled,We,ge.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments)}}(w,A,te,oe)}(f,i,l,d),f.renderPass==="translucent"&&(function(w,S,A,P,M){const z=w.context,D=z.gl,j=S.getSource().tileSize,V=5*(1-a.ah(a.cK,a.cK+1,w.transform.zoom))*j+A.paint.get("raster-particle-elevation"),G=!w.options.moving,te=w.transform.projection.name==="globe";if(!P.length)return;const[K,oe]=w.stencilConfigForOverlap(P),he=[];te&&he.push("PROJECTION_GLOBE_VIEW");const ge=w.stencilModeFor3D();for(const Se of oe){const be=Se.toUnwrapped(),Ee=S.getTile(Se);if(!Ee.rasterParticleState)continue;const Te=Ee.rasterParticleState,we=100;Ee.registerFadeDuration(we);const Ae=S.findLoadedParent(Se,0),qe=gc(Ee,Ae,S,w.transform,we);let Ne,rt;w.terrain&&w.terrain.prepareDrawTile(),z.activeTexture.set(D.TEXTURE0),Te.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),z.activeTexture.set(D.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ne=Math.pow(2,Ae.tileID.overscaledZ-Ee.tileID.overscaledZ),rt=[Ee.tileID.canonical.x*Ne%1,Ee.tileID.canonical.y*Ne%1]):Te.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const $e=te?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(be,G),Qe=w.transform,kt=f0(Qe),We=a.dC(Se.canonical),Oe=a.dD(We.getCenter().lat);let ot,Xe,gt,Ct,jt;te?(ot=Float32Array.from(a.bk(a.dF(Se.canonical))),Xe=Float32Array.from(Qe.globeMatrix),gt=Float32Array.from(a.dB(Qe)),Ct=[a.aF(Qe.center.lng),a.aJ(Qe.center.lat)],jt=Float32Array.from(a.dE(Se.canonical,We,Oe,Qe.worldSize/Qe._pixelsPerMercatorPixel))):(ot=new Float32Array(16),Xe=new Float32Array(9),gt=new Float32Array(16),Ct=[0,0],jt=new Float32Array(9));const St=Dl($e,ot,Xe,gt,jt,rt||[0,0],a.aj(w.transform.zoom),Ct,kt,Ne||1,qe,V),xt=w.isTileAffectedByFog(Se),lr=w.getOrCreateProgram("rasterParticle",{defines:he,overrideFog:xt});if(w.uploadCommonUniforms(z,lr,be),te){const tr=new Ht(D.LEQUAL,Ht.ReadOnly,w.depthRangeFor3D),nr=0,er=w.globeSharedBuffers;if(er){const[Rr,Br,$r]=er.getGridBuffers(Oe,nr!==0);lr.draw(w,D.TRIANGLES,tr,ge,Ur.alphaBlended,w.renderElevatedRasterBackface?Pr.frontCCW:Pr.backCCW,St,A.id,Rr,Br,$r)}}else{const tr=w.depthModeForSublayer(0,Ht.ReadOnly),nr=K[Se.overscaledZ],{tileBoundsBuffer:er,tileBoundsIndexBuffer:Rr,tileBoundsSegments:Br}=w.getTileBoundsBuffers(Ee);lr.draw(w,D.TRIANGLES,tr,nr,Ur.alphaBlended,Pr.disabled,St,A.id,er,Rr,Br)}}w.resetStencilClippingMasks()}(f,i,l,d),f.style.map.triggerRepaint())},background:function(f,i,l,d){const _=l.paint.get("background-color"),y=l.paint.get("background-color-use-theme").constantOr("default")==="none",w=l.paint.get("background-opacity"),S=l.paint.get("background-emissive-strength"),A=l.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const P=f.context,M=P.gl,z=f.transform,D=z.tileSize,j=l.paint.get("background-pattern");let V;if(j!==void 0&&(j===null||(V=f.imageManager.getPattern(a.I.from(j.toString()),l.scope,f.style.getLut(l.scope)),!V)))return;const G=!j&&_.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==G)return;const te=Sr.disabled,K=f.depthModeForSublayer(0,G==="opaque"?Ht.ReadWrite:Ht.ReadOnly),oe=f.colorModeForDrapableLayerRenderPass(S),he=j?"backgroundPattern":"background";let ge,Se=d;if(Se||(ge=f.getBackgroundTiles(),Se=Object.values(ge).map(be=>be.tileID)),j&&(P.activeTexture.set(M.TEXTURE0),f.imageManager.bind(f.context,l.scope)),A){const be=f.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(a.bA([])),Te=new a.aO(0,0,0,0,0),we=j?Df(Ee,S,w,f,0,l.scope,V,A,{tileID:Te,tileSize:D}):Mf(Ee,S,w,_.toPremultipliedRenderColor(y?null:l.lut));be.draw(f,M.TRIANGLES,K,te,oe,Pr.disabled,we,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const be of Se){const Ee=f.isTileAffectedByFog(be),Te=f.getOrCreateProgram(he,{overrideFog:Ee}),we=be.toUnwrapped(),Ae=d?be.projMatrix:f.transform.calculateProjMatrix(we);f.prepareDrawTile();const qe=i?i.getTile(be):ge?ge[be.key]:new El(be,D,z.zoom,f),Ne=j?Df(Ae,S,w,f,0,l.scope,V,A,{tileID:be,tileSize:D}):Mf(Ae,S,w,_.toPremultipliedRenderColor(y?null:l.lut));f.uploadCommonUniforms(P,Te,we);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:$e,tileBoundsSegments:Qe}=f.getTileBoundsBuffers(qe);Te.draw(f,M.TRIANGLES,K,te,oe,Pr.disabled,Ne,l.id,rt,$e,Qe)}},sky:function(f,i,l){const d=f._atmosphere?a.aj(f.transform.zoom):1,_=l.paint.get("sky-opacity")*d;if(_===0)return;const y=f.context,w=l.paint.get("sky-type"),S=new Ht(y.gl.LEQUAL,Ht.ReadOnly,[0,1]),A=f.frameCounter/1e3%1;w==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&(function(P,M,z,D){const j=P.context,V=j.gl;let G=M.skyboxFbo;if(!G){G=M.skyboxFbo=j.createFramebuffer(32,32,!0,null),M.skyboxGeometry=new _0(j),M.skyboxTexture=j.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,M.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let he=0;he<6;++he)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(G.framebuffer),j.viewport.set([0,0,32,32]);const te=M.getCenter(P,!0),K=P.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);a.bA(oe),a.ek(oe,oe,.5*-Math.PI),Tc(P,M,K,oe,te,0),a.bA(oe),a.ek(oe,oe,.5*Math.PI),Tc(P,M,K,oe,te,1),a.bA(oe),a.cT(oe,oe,.5*-Math.PI),Tc(P,M,K,oe,te,2),a.bA(oe),a.cT(oe,oe,.5*Math.PI),Tc(P,M,K,oe,te,3),a.bA(oe),Tc(P,M,K,oe,te,4),a.bA(oe),a.ek(oe,oe,Math.PI),Tc(P,M,K,oe,te,5),j.viewport.set([0,0,P.width,P.height])}(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&function(P,M,z,D,j){const V=P.context,G=V.gl,te=P.transform,K=P.getOrCreateProgram("skybox");V.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,M.skyboxTexture);const oe=((he,ge,Se,be,Ee)=>({u_matrix:he,u_sun_direction:ge,u_cubemap:0,u_opacity:be,u_temporal_offset:Ee}))(te.skyboxMatrix,M.getCenter(P,!1),0,D,j);P.uploadCommonUniforms(V,K),K.draw(P,G.TRIANGLES,z,Sr.disabled,P.colorModeForRenderPass(),Pr.backCW,oe,"skybox",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(f,l,S,_,A):w==="gradient"&&f.renderPass==="sky"&&function(P,M,z,D,j){const V=P.context,G=V.gl,te=P.transform,K=P.getOrCreateProgram("skyboxGradient");M.skyboxGeometry||(M.skyboxGeometry=new _0(V)),V.activeTexture.set(G.TEXTURE0);let oe=M.colorRampTexture;oe||(oe=M.colorRampTexture=new a.T(V,M.colorRamp,G.RGBA8)),oe.bind(G.LINEAR,G.CLAMP_TO_EDGE);const he=((ge,Se,be,Ee,Te)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:Se,u_radius:a.an(be),u_opacity:Ee,u_temporal_offset:Te}))(te.skyboxMatrix,M.getCenter(P,!1),M.paint.get("sky-gradient-radius"),D,j);P.uploadCommonUniforms(V,K),K.draw(P,G.TRIANGLES,z,Sr.disabled,P.colorModeForRenderPass(),Pr.backCW,he,"skyboxGradient",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(f,l,S,_,A)},custom:function(f,i,l,d){const _=f.context,y=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(i)){if(f.renderPass==="offscreen"){const w=y.prerender;if(w){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;w.call(y,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else w.call(y,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const S=y.renderToTile;if(S){const A=d[0].canonical,P={x:A.x+d[0].wrap*(y.wrapTileId?0:1<<A.z),y:A.y,z:A.z};_.setDepthMode(Ht.disabled),_.setStencilMode(Sr.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),S.call(y,_.gl,P),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(Sr.disabled);const w=y.renderingMode==="3d"?new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ht.ReadOnly);if(_.setDepthMode(w),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;y.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else y.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,l,d){if(f.renderPass==="opaque")return;const _=l.paint.get("model-opacity").constantOr(1);if(_===0)return;const y=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!y||f.terrain&&_<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof a.ad))return;const w=f.shadowRenderer,S=l.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,S||(w.enabled=!1));const A=()=>{w&&(w.useNormalOffset=!0,S||(w.enabled=!0))},P=i.getSource();if(f.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(K,oe,he,ge,Se){const be=K.transform;if(be.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const Ee=be.getFreeCameraOptions().position;if(!K.modelManager)return;const Te=K.modelManager;he.modelManager=Te;const we=K.shadowRenderer;if(!he._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=he._unevaluatedLayout._values["model-id"],qe=Object.assign({},he.layout.get("model-id").parameters),Ne=K.style.order.indexOf(he.fqid);for(const rt of ge){const $e=oe.getTile(rt).getBucket(he);if(!$e||$e.projection.name!==be.projection.name)continue;const Qe=$e.getModelUris();Qe&&!$e.modelsRequested&&(Te.addModelsFromBucket(Qe,Se),$e.modelsRequested=!0);const kt=Au(rt,be);qe.zoom=kt;const We=Ae.possiblyEvaluate(qe);if(_y(K,$e,rt),aa.shadowUniformsInitialized=!1,aa.useSingleShadowCascade=!!we&&we.getMaxCascadeForTile(rt.toUnwrapped())===0,K.renderPass==="shadow"&&we){if(K.currentShadowCascade===1&&$e.isInsideFirstShadowMapFrustum)continue;const Xe=be.calculatePosMatrix(rt.toUnwrapped(),be.worldSize);if(aa.tileMatrix.set(Xe),aa.shadowTileMatrix=Float32Array.from(we.calculateShadowPassMatrixFromMatrix(Xe)),aa.aabb.min=[0,0,0],aa.aabb.max[0]=aa.aabb.max[1]=a.al,aa.aabb.max[2]=0,xy($e,aa,K,he.scope))continue}const Oe=1<<rt.canonical.z,ot=[((Ee.x-rt.wrap)*Oe-rt.canonical.x)*a.al,(Ee.y*Oe-rt.canonical.y)*a.al,Ee.z*Oe*a.al];K.conflationActive&&Object.keys($e.instancesPerModel).length>0&&K.style.isLayerClipped(he,oe.getSource())&&$e.updateReplacement(rt,K.replacementSource,Ne,Se)&&($e.uploaded=!1,$e.upload(K.context));for(let Xe in $e.instancesPerModel){const gt=$e.instancesPerModel[Xe];gt.features.length>0&&(Xe=We.evaluate(gt.features[0].feature,{}));const Ct=Te.getModel(Xe,Se);if(Ct||Te.hasURLBeenRequested(Xe)||$e.modelUris.includes(Xe)||($e.modelUris.push(Xe),$e.modelsRequested=!1),Ct&&Ct.uploaded)for(const jt of Ct.nodes)yy(K,he,jt,gt,ot,rt,aa)}}}(f,i,l,d,P.type==="vector"?l.scope:""),void A();if(!P.loaded())return;if(P.type==="batched-model")return function(K,oe,he,ge){he.resetLayerRenderingStats(K);const Se=K.context,be=K.transform,Ee=K.style.fog,Te=K.shadowRenderer;if(be.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const we=K.transform.getFreeCameraOptions().position,Ae=a.c4([],[we.x,we.y,we.z],K.transform.worldSize),qe=a.et([],Ae),Ne=a.bA([]),rt=a.ec(be.center.lat,be.zoom),$e=a.bq([],[1,1,1/rt]);a.br(Ne,Ne,qe);const Qe=he.paint.get("model-opacity").constantOr(1),kt=new Ht(Se.gl.LEQUAL,Ht.ReadWrite,K.depthRangeFor3D),We=new Ht(Se.gl.LEQUAL,Ht.ReadOnly,K.depthRangeFor3D),Oe=new a.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=K.renderPass==="shadow",Xe=ot&&Te?Te.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),gt=he.paint.get("model-front-cutoff"),Ct=gt[2]<1,jt=Pl(K,he.paint.get("model-cutoff-fade-range")),St=he.getLayerRenderingStats();(function(xt,lr,tr,nr){const er=xt.terrain?xt.terrain.exaggeration():0,Rr=xt.transform.zoom;for(const Br of nr){const $r=lr.getTile(Br).getBucket(tr);$r&&($r.setFilter(tr.filter),xt.conflationActive&&$r.updateReplacement(Br,xt.replacementSource),$r.evaluateTransform(xt,tr),xt.terrain&&er>0&&$r.elevationUpdate(xt.terrain,er,Br,tr.source),$r.needsReEvaluation(xt,Rr,tr)&&$r.evaluate(tr))}})(K,oe,he,ge),function(){let xt,lr,tr;Ct?(xt=ge.length-1,lr=-1,tr=-1):(xt=0,lr=ge.length,tr=1);const nr=new Float64Array(16),er=a.cz(),Rr=new a.P(0,0);for(let Br=xt;Br!==lr;Br+=tr){const $r=ge[Br],xi=oe.getTile($r).getBucket(he);if(!xi||!xi.uploaded)continue;let Or=!1;Te&&(Or=Te.getMaxCascadeForTile($r.toUnwrapped())===0);const li=be.calculatePosMatrix($r.toUnwrapped(),be.worldSize),mi=xi.modelTraits;!ot&&Ct&&(a.bl(nr,li),a.af(er,Ae,nr),Rr.x=er[0],Rr.y=er[1]);const Vi=[];xi.setFilter(he.filter);for(const jr of xi.getNodesInfo()){if(jr.hiddenByReplacement||!jr.node.meshes)continue;const hi=jr.node;let ci=0;K.terrain&&hi.elevation&&(ci=hi.elevation*K.terrain.exaggeration());const pi=(()=>{const ts=jr.aabb;return Oe.min=[...ts.min],Oe.max=[...ts.max],Oe.min[2]+=ci,Oe.max[2]+=ci,a.af(Oe.min,Oe.min,li),a.af(Oe.max,Oe.max,li),Oe})(),Hi=jr.evaluatedScale;if(Hi[0]<=1&&Hi[1]<=1&&Hi[2]<=1&&pi.intersects(Xe)===0)continue;if(!ot&&Ct){const ts=.16666666666666666;jr.cameraCollisionOpacity=Ae[0]>pi.min[0]&&Ae[0]<pi.max[0]&&Ae[1]>pi.min[1]&&Ae[1]<pi.max[1]&&Ae[2]*rt<pi.max[2]&&hi.footprint&&a.b$(Rr,hi.footprint)?Math.max(jr.cameraCollisionOpacity-ts,0):Math.min(1,jr.cameraCollisionOpacity+ts)}const hn=[...li],Hn=1/a.d6($r.canonical),Wi=hi.anchor?hi.anchor[0]:0,Gr=hi.anchor?hi.anchor[1]:0;a.br(hn,hn,[Wi*(Hi[0]-1)+jr.evaluatedTranslation[0]*Hn,Gr*(Hi[1]-1)+jr.evaluatedTranslation[1]*Hn,ci+jr.evaluatedTranslation[2]]),a.cp(Hi,a.ev)||a.cR(hn,hn,Hi);const Er=a.aB([],hn,hi.matrix),vi=a.aB([],be.expandedFarZProjMatrix,Er),nn=a.aB([],be.expandedFarZProjMatrix,hn),Ki=a.aC([],[Wi,Gr,ci,1],vi)[2];hi.hidden=!1;let bn=Qe;ot||(Ct&&(bn*=jr.cameraCollisionOpacity,bn*=y0(hn,be,jr.aabb,gt)),bn*=Hf(jt,Ki)),bn!==0?Vi.push({nodeInfo:jr,depth:Ki,opacity:bn,wvpForNode:vi,wvpForTile:nn,nodeModelMatrix:Er,tileModelMatrix:hn}):hi.hidden=!0}ot||Vi.sort((jr,hi)=>!Ct||jr.opacity===1&&hi.opacity===1?jr.depth<hi.depth?-1:1:jr.opacity===1?-1:hi.opacity===1?1:jr.depth>hi.depth?-1:1);for(const jr of Vi){const hi=jr.nodeInfo,ci=hi.node;let pi=a.aB([],$e,jr.tileModelMatrix);a.aB(pi,Ne,pi);const Hi=a.bl([],pi);a.ed(Hi,Hi),a.cR(Hi,Hi,uw),pi=a.aB(pi,pi,ci.matrix);const hn=K.renderPass==="light-beam",Hn=he.paint.get("model-color-use-theme").constantOr("default")==="none",Wi=mi&a.ez.HasMapboxMeshFeatures,Gr=Wi?0:hi.evaluatedRMEA[0][2];for(let Er=0;Er<ci.meshes.length;++Er){const vi=ci.meshes[Er],nn=Er===ci.lightMeshIndex;let Ki=jr.wvpForNode;if(nn){if(!hn&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}Ki=jr.wvpForTile}else if(hn)continue;const bn={defines:[]},ts=[];if(!ot&&Te&&(Te.useNormalOffset=!!vi.normalBuffer),$f(bn.defines,ts,vi,K,Hn?null:he.lut),Wi||bn.defines.push("DIFFUSE_SHADED"),Or&&bn.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(ot?St.numRenderedVerticesInShadowPass+=vi.vertexArray.length:St.numRenderedVerticesInTransparentPass+=vi.vertexArray.length),ot){Zh(vi,jr.nodeModelMatrix,K,he);continue}let Ao=null;if(Ee){const ua=Be(jr.nodeModelMatrix,K.transform);if(Ao=new Float32Array(ua),be.projection.name!=="globe"){const an=vi.aabb.min,dn=vi.aabb.max,[Yi,kn]=Ee.getOpacityForBounds(ua,an[0],an[1],dn[0],dn[1]);bn.overrideFog=Yi>=Ve||kn>=Ve}}const Io=vi.material;let no;Io.occlusionTexture&&Io.occlusionTexture.offsetScale&&(no=Io.occlusionTexture.offsetScale,bn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const so=K.getOrCreateProgram("model",bn);!ot&&Te&&Te.setupShadowsFromMatrix(jr.tileModelMatrix,so,Te.useNormalOffset),K.uploadCommonUniforms(Se,so,null,Ao);const Ls=Io.pbrMetallicRoughness;Ls.metallicFactor=.9,Ls.roughnessFactor=.5;const Uo=Of(new Float32Array(Ki),new Float32Array(pi),new Float32Array(Hi),new Float32Array(ci.matrix),K,jr.opacity,Ls.baseColorFactor,Io.emissiveFactor,Ls.metallicFactor,Ls.roughnessFactor,Io,Gr,he,[0,0,0],no);!nn&&(hi.hasTranslucentParts||jr.opacity<1)&&so.draw(K,Se.gl.TRIANGLES,kt,Sr.disabled,Ur.disabled,Pr.backCCW,Uo,he.id,vi.vertexBuffer,vi.indexBuffer,vi.segments,he.paint,K.transform.zoom,void 0,ts),so.draw(K,Se.gl.TRIANGLES,nn?We:kt,Sr.disabled,nn||jr.opacity<1||hi.hasTranslucentParts?Ur.alphaBlended:Ur.unblended,Pr.backCCW,Uo,he.id,vi.vertexBuffer,vi.indexBuffer,vi.segments,he.paint,K.transform.zoom,void 0,ts)}}}}()}(f,i,l,d),void A();if(P.type!=="model")return;const M=P.getModels(),z=[],D=f.transform.getFreeCameraOptions().position,j=a.c4([],[D.x,D.y,D.z],f.transform.worldSize);a.et(j,j);const V=[],G=[];let te=0;for(const K of M){const oe=l.paint.get("model-rotation").constantOr(null),he=l.paint.get("model-scale").constantOr(null),ge=l.paint.get("model-translation").constantOr(null);K.computeModelMatrix(f,oe,he,ge,!0,!0,!1);const Se=a.bA([]),be=a.ec(K.position.lat,f.transform.zoom),Ee=a.bq([],[1,1,1/be]);a.br(Se,Se,j),z.push({zScaleMatrix:Ee,negCameraPosMatrix:Se});for(const Te of K.nodes)Gf(f.transform,Te,K.matrix,f.transform.expandedFarZProjMatrix,te,V,G);te++}if(V.sort((K,oe)=>oe.depth-K.depth),f.renderPass!=="shadow"){if(_===1)for(const K of G)Ac(K,f,l,z[K.modelIndex],Sr.disabled,f.colorModeForRenderPass());else{for(const K of G)Ac(K,f,l,z[K.modelIndex],Sr.disabled,Ur.disabled);for(const K of G)Ac(K,f,l,z[K.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const K of V)Ac(K,f,l,z[K.modelIndex],Sr.disabled,f.colorModeForRenderPass());A()}else{for(const K of G)Zh(K.mesh,K.nodeModelMatrix,f,l);for(const K of V)Zh(K.mesh,K.nodeModelMatrix,f,l);A()}}},Ic={line:function(f,i,l){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const d=i.getVisibleCoordinates();for(const _ of d){const y=i.getTile(_).getBucket(f);if(y&&(y.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,i,l){const d=i.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,d.type==="vector"?f.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const y of _)y.upload(l.context)},raster:function(f,i,l){const d=i.getSource();if(!(d instanceof Tl&&d.loaded()))return;const _=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=f.paint.get("raster-array-band")||d.getInitialBand(_);if(y==null)return;const w=i.getIds().map(S=>i.getTileByID(S));for(const S of w)S.updateNeeded(f.id,y)&&d.prepareTile(S,_,f.id,y)},"raster-particle":function(f,i,l){const d=i.getSource();if(!(d instanceof Tl&&d.loaded()))return;const _=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=f.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(y==null)return;const w=i.getIds().map(S=>i.getTileByID(S));for(const S of w)S.updateNeeded(f.id,y)&&d.prepareTile(S,_,f.id,y)}},Cc={fill:vc},Ul={fill:function(f,i,l,d){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const _=f.context.gl,y=new Ht(_.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D),w=new Sr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),S=f.transform.getFreeCameraOptions().position,A=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const P of d){const M=i.getTile(P),z=M.getBucket(l);if(!z)continue;const D=z.elevatedStructures;if(!D||D.depthSegments.segments[0].primitiveLength===0)continue;const j=dy(P.toUnwrapped(),S),V=f.translatePosMatrix(P.projMatrix,M,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),G=Pf(V,j,0,1,0);A.draw(f,_.TRIANGLES,y,w,Ur.disabled,Pr.disabled,G,l.id,D.vertexBuffer,D.indexBuffer,D.depthSegments,l.paint,f.transform.zoom)}}};class v0{constructor(i,l,d,_,y,w){this.context=new c0(i,l),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=a.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const P of S)this._debugParams.enabledLayers[P]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of S)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new Wf(y),this.setup(),this.numSublayers=xo.maxUnderzooming+xo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new z1(this),this._wireframeDebugCache=new wy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new a.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,A,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=w}updateTerrain(i,l){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new $h(this,i));const _=this._terrain;this.transform.elevation=d?_:null,_.update(i,this.transform,l),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(i){const l=i.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=l.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const y=d+.78*(_-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new $h(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,l){if(this.width=i*a.o.devicePixelRatio,this.height=l*a.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const i=this.context,l=new a.bd;l.emplaceBack(0,0),l.emplaceBack(a.al,0),l.emplaceBack(0,a.al),l.emplaceBack(a.al,a.al),this.tileExtentBuffer=i.createVertexBuffer(l,a.bf.members),this.tileExtentSegments=a.bg.simpleSegment(0,0,4,2);const d=new a.bd;d.emplaceBack(0,0),d.emplaceBack(a.al,0),d.emplaceBack(0,a.al),d.emplaceBack(a.al,a.al),this.debugBuffer=i.createVertexBuffer(d,a.bf.members),this.debugSegments=a.bg.simpleSegment(0,0,4,5);const _=new a.bd;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,a.bf.members),this.viewportSegments=a.bg.simpleSegment(0,0,4,2);const y=new a.b0;y.emplaceBack(0,0,0,0),y.emplaceBack(a.al,0,a.al,0),y.emplaceBack(0,a.al,0,a.al),y.emplaceBack(a.al,a.al,a.al,a.al),this.mercatorBoundsBuffer=i.createVertexBuffer(y,a.bi.members),this.mercatorBoundsSegments=a.bg.simpleSegment(0,0,4,2);const w=new a.b1;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);const S=new a.be;for(const P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new a.T(i,new a.q({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=a.bC();const A=this.context.gl;this.stencilClearMode=new Sr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Ht.disabled,this.stencilClearMode,Ur.disabled,Pr.disabled,mc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,d){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of d)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const _=this.context,y=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Ur.disabled),_.setDepthMode(Ht.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const A=l.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:z,tileBoundsSegments:D}=this.getTileBoundsBuffers(A);w.draw(this,y.TRIANGLES,Ht.disabled,new Sr({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),Ur.disabled,Pr.disabled,mc(S.projMatrix),"$clipping",M,z,D)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new Sr({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new Sr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,d=i.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=d[d.length-1].overscaledZ,y=d[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+_]=new Sr({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[w,d]}return[{[_]:Sr.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ur([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new a.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ur.unblended:Ur.alphaBlended}colorModeForDrapableLayerRenderPass(i){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ur([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new a.ao(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,l,d,_=!1){if(this.depthOcclusion)return new Ht(this.context.gl.GREATER,Ht.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Ht.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Ht(d||this.context.gl.LEQUAL,l,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,l=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&d!==0&&(this.depthFBO=new Lf(this.context,l,d,!1,"texture"),this.depthTexture=new a.T(this.context,{width:l,height:d,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),i.bindTexture(i.TEXTURE_2D,y),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,l,d,0,0,l,d,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,l)=>i+l/this._fpsHistory.length,0))}render(i,l){const d=a.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=l;const _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(y).filter(We=>{const Oe=_[We];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let S=w(),A=!1,P=!1,M=null;for(const We of S){const Oe=_[We];Oe.type==="circle"?A=!0:Oe.type==="building"?M=Oe:Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?P=!0:A=!0)}let z=S.map(We=>_[We]);const D=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(a.o.now()),this.imageManager.beginFrame();let j=0,V=!1;for(const We in D){const Oe=D[We];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++j)}let G=!1;for(const We of z)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(G=!0),this.prepareLayer(We));const te={},K={},oe={},he={},ge={};for(const We in D){const Oe=D[We];te[We]=Oe.getVisibleCoordinates(),K[We]=te[We].slice().reverse(),oe[We]=Oe.getVisibleCoordinates(!0).reverse(),he[We]=Oe.getShadowCasterCoordinates(),ge[We]=Oe.sortCoordinatesByDistance(te[We])}const Se=We=>{const Oe=this.style.getLayerSourceCache(We);return Oe&&Oe.used?Oe.getSource():null};if(j||G||this._clippingActiveLastFrame){const We=[],Oe=[];let ot=0;for(const Xe of z)this.isSourceForClippingOrConflation(Xe,Se(Xe))&&(We.push(Xe),Oe.push(ot)),ot++;if(We&&(G||We.length>1)||this._clippingActiveLastFrame){G=!1;const Xe=[];for(let gt=0;gt<We.length;gt++){const Ct=We[gt],jt=Oe[gt],St=this.style.getLayerSourceCache(Ct);if(!St||!St.used||!St.getSource().usedInConflation&&Ct.type!=="clip"&&Ct.type!=="building")continue;let xt=a.eH,lr=a.bZ.None;const tr=[];let nr=!0;if(Ct.type==="building")xt=a.eJ;else if(Ct.type==="clip"){xt=jt;for(const er of Ct.layout.get("clip-layer-types"))lr|=er==="model"?a.bZ.Model:er==="symbol"?a.bZ.Symbol:a.bZ.FillExtrusion;for(const er of Ct.layout.get("clip-layer-scope"))tr.push(er);Ct.isHidden(this.transform.zoom)?nr=!1:G=!0}nr&&Xe.push({layer:Ct.fqid,cache:St,order:xt,clipMask:lr,clipScope:tr})}this.replacementSource.setSources(Xe),V=!0}}this._clippingActiveLastFrame=G,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<z.length;We++){const Oe=z[We],ot=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(ot,this.longestCutoffRange),ot>0){const Xe=Se(Oe);Xe&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0,S=w(),z=S.map(We=>_[We]));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in D)for(const Oe of te[We]){let ot={min:0,max:0};this.terrain&&(ot=this.terrain.getMinMaxForTile(Oe)||ot),Ee.addShadowReceiver(Oe.toUnwrapped(),ot.min,ot.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Eu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new Ey(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),we&&!this._rain&&(this._rain=new Ui(this)),!we&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),M){this.buildingTileBorderManager||(this.buildingTileBorderManager=new rn);const We=this.style.getLayerSourceCache(M);this.buildingTileBorderManager.updateBorders(We,M)}if(!Ci.has(this.context.gl))return;this.renderPass="offscreen";for(const We of z){const Oe=i.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const ot=Oe?K[Oe.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||ot&&ot.length)&&this.renderLayer(this,Oe,We,ot)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,he)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),qe=(()=>{if(l.showOverdrawInspector)return a.ao.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const Oe=this.style.getLut(We.scope);if(!Ae){const ot=We.properties.get("color-use-theme")==="none",Xe=We.properties.get("color").toNonPremultipliedRenderColor(ot?null:Oe).toArray01();return new a.ao(...Xe)}if(Ae){const ot=We.properties.get("space-color-use-theme")==="none",Xe=We.properties.get("space-color").toNonPremultipliedRenderColor(ot?null:Oe).toArray01();return new a.ao(...Xe)}}return a.ao.transparent})();if(this.context.clear({color:qe,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const We=z[this.currentLayer],Oe=i.getLayerSourceCache(We);if(We.isSky())continue;const ot=Oe?(We.is3D(y)?ge:K)[Oe.id]:void 0;this._renderTileClippingMasks(We,Oe,ot),this.renderLayer(this,Oe,We,ot)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const We=z[this.currentLayer],Oe=i.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,Oe,We,Oe?K[Oe.id]:void 0)}function Ne(We,Oe){let ot;return Oe&&(ot=(We.type==="symbol"?oe:We.is3D(y)?ge:K)[Oe.id]),ot}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const We=z[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const Oe=i.getLayerSourceCache(We);this.renderLayer(this,Oe,We,Ne(We,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let rt=0;Ee&&(rt=Ee.getShadowCastingLayerCount());let $e=!1,Qe=-1;for(let We=0;We<S.length;++We){const Oe=z[We];Oe.isHidden(this.transform.zoom)||Oe.is3D(y)&&(Qe=We)}P&&Qe===-1&&(A=!0);let kt=!1;for(;this.currentLayer<S.length;){const We=z[this.currentLayer],Oe=i.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!kt&&We.is3D(y)&&!y){const ot=this.currentLayer,Xe=gt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const Ct=z[this.currentLayer];if(Cc[Ct.type]){const jt=this.style.getLayerSourceCache(Ct);Cc[Ct.type](this,jt,Ct,Ne(Ct,jt),gt)}}};Xe("initialize"),Xe("reset"),this.currentLayer=ot,kt=!0}if(A&&!$e&&this.terrain&&!this.transform.isOrthographic&&($e=!0,this.blitDepth()),P&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(We,Oe,Oe?te[Oe.id]:void 0),this.renderLayer(this,Oe,We,Ne(We,Oe)),!this.terrain&&Ee&&rt>0&&We.hasShadowPass()&&--rt==0){{this.clearStencil(),this.resetStencilClippingMasks();const ot=this.currentLayer;for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const Xe=z[this.currentLayer];if(Ul[Xe.type]){const gt=this.style.getLayerSourceCache(Xe);Ul[Xe.type](this,gt,Xe,Ne(Xe,gt))}}this.currentLayer=ot}if(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ot=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ot;this.currentLayer++){const Xe=z[this.currentLayer];if(!Xe.hasLightBeamPass())continue;const gt=i.getLayerSourceCache(Xe);this.renderLayer(this,gt,Xe,gt?K[gt.id]:void 0)}this.currentLayer=ot,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ot=this.currentLayer;this.depthOcclusion=!0;for(const Xe of this.layersWithOcclusionOpacity){this.currentLayer=Xe;const gt=z[this.currentLayer],Ct=i.getLayerSourceCache(gt),jt=Ct?K[Ct.id]:void 0;this.terrain||this._renderTileClippingMasks(gt,Ct,Ct?te[Ct.id]:void 0),this.renderLayer(this,Ct,gt,jt)}this.depthOcclusion=!1,this.currentLayer=ot,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;z.forEach(Oe=>{const ot=i.getLayerSourceCache(Oe);ot&&!Oe.isHidden(this.transform.zoom)&&ot.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<ot.getSource().maxzoom)&&(We=ot)}),We&&this.options.showTileBoundaries&&Vf(this,We,We.getVisibleCoordinates(),a.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Vf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(We){const Oe=We.transform.padding;ka(We,We.transform.height-(Oe.top||0),3,Os),ka(We,Oe.bottom||0,3,zl),Di(We,Oe.left||0,3,my),Di(We,We.transform.width-(Oe.right||0),3,p0);const ot=We.transform.centerPoint;(function(Xe,gt,Ct,jt){bc(Xe,gt-1,Ct-10,2,20,jt),bc(Xe,gt-10,Ct-1,20,2,jt)})(We,ot.x,We.transform.height-ot.y,m0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:l}=this.transform.projection,d=!l||!l.includes(i.type);if(Ic[i.type]&&(d||this.terrain&&i.type==="custom")){const _=this.style.getLayerSourceCache(i);Ic[i.type](i,_,this)}this.gpuTimingEnd()}renderLayer(i,l,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(d.type)&&(!i.terrain||d.type!=="custom")||d.type==="clip"||jl[d.type](i,l,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=this.context.gl,d=l.createQuery();this.deferredRenderGpuTimeQueries.push(d),l.beginQuery(i.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const d in i){const _=i[d],y=this.context.extTimerQuery,w=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),l[d]=w}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let d=0;for(const _ of i)d+=l.getQueryParameter(_,l.QUERY_RESULT)/1e6,l.deleteQuery(_);return d}translatePosMatrix(i,l,d,_,y){if(!d[0]&&!d[1])return i;const w=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const P=Math.sin(w),M=Math.cos(w);d=[d[0]*M-d[1]*P,d[0]*P+d[1]*M]}const S=[y?d[0]:a.ay(l,d[0],this.transform.zoom),y?d[1]:a.ay(l,d[1],this.transform.zoom),0],A=new Float32Array(16);return a.br(A,i,S),A}saveTileTexture(i){if(i.context!==this.context)return;const l=i.size[0],d=this._tileTextures[l];d?d.push(i):this._tileTextures[l]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,l,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||l!==void 0&&!l||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(i,l){this.cache=this.cache||{};const d=l&&l.defines||[],_=l&&l.config,y=this.currentGlobalDefines(i,l&&l.overrideFog,l&&l.overrideRtt).concat(d),w=Cf.cacheKey(mf[i],i,y,_);return this.cache[w]||(this.cache[w]=new Cf(this.context,i,mf[i],_,sw[i],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,l){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const y=((w,S,A)=>{const P=w.properties.get("direction"),M=w.properties.get("color-use-theme")==="none",z=w.properties.get("color").toNonPremultipliedRenderColor(M?null:A.getLut(w.scope)).toArray01(),D=w.properties.get("intensity"),j=S.properties.get("color-use-theme")==="none",V=S.properties.get("color").toNonPremultipliedRenderColor(j?null:A.getLut(S.scope)).toArray01(),G=S.properties.get("intensity"),te=[P.x,P.y,P.z],K=a.dK(V,G),oe=a.dK(z,D);return{u_lighting_ambient_color:K,u_lighting_directional_dir:te,u_lighting_directional_color:oe,u_ground_radiance:If(te,oe,K)}})(d,_,this.style);l.setLightsUniformValues(i,y)}}}uploadCommonUniforms(i,l,d,_,y){if(this.uploadCommonLightUniforms(i,l),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const S=w.getOpacity(this.transform.pitch),A=((P,M,z,D,j,V,G,te,K,oe,he,ge)=>{const Se=P.transform,be=M.properties.get("color-use-theme")==="none",Ee=M.properties.get("color").toNonPremultipliedRenderColor(be?null:P.style.getLut(M.scope)).toArray01();Ee[3]=D;const Te=P.frameCounter/1e3%1,[we,Ae]=M.properties.get("vertical-range");return{u_fog_matrix:z?Se.calculateFogTileMatrix(z):ge||P.identityMat,u_fog_range:M.getFovAdjustedRange(Se._fov),u_fog_color:Ee,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(we,Ae),Ae],u_fog_temporal_offset:Te,u_frustum_tl:j,u_frustum_tr:V,u_frustum_br:G,u_frustum_bl:te,u_globe_pos:K,u_globe_radius:oe,u_viewport:he,u_globe_transition:a.aj(Se.zoom),u_is_globe:+(Se.projection.name==="globe")}})(this,w,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.o.devicePixelRatio,this.transform.height*a.o.devicePixelRatio],_);l.setFogUniformValues(i,A)}y&&l.setCutoffUniformValues(i,y.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)l[_.key]=i[_.key]||new El(_,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,l){return!(!i.is3D(!(!this.terrain||!this.terrain.enabled))||i.type!=="clip"&&i.type!=="building"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building"&&i.sourceLayer!=="procedural_buildings")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[i.key];return l||(this._cachedTileFogOpacities[i.key]=l=this.style.fog.getOpacityForTile(i)),l[0]>=Ve||l[1]>=Ve}setupDepthForOcclusion(i,l,d){const _=this.context,y=_.gl,w=!!d;var S;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),w||l.setTerrainUniformValues(_,d)}}function qf(f,i){let l=!1,d=null;const _=()=>{d=null,l&&(f(),d=setTimeout(_,i),l=!1)};return()=>(l=!0,d||_(),d)}class w0{constructor(i){this._hashName=i&&encodeURIComponent(i),a.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qf(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=Zf(i);if(this._hashName){const d=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(w=>{const S=w.split("=")[0];return S===d?(_=!0,`${S}=${l}`):w}).filter(w=>w);return _||y.push(`${d}=${l}`),`#${y.join("&")}`}return`#${l}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(l=d)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(d=>isNaN(Number(d)))){const d=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Zf(f,i){const l=f.getCenter(),d=Math.round(100*f.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),w=Math.round(l.lng*y)/y,S=Math.round(l.lat*y)/y,A=f.getBearing(),P=f.getPitch();let M=i?`/${w}/${S}/${d}`:`${d}/${S}/${w}`;return(A||P)&&(M+="/"+Math.round(10*A)/10),P&&(M+=`/${Math.round(P)}`),M}const Ws={linearity:.3,easing:a.eK(0,0,.3,1)},Vl=Object.assign({deceleration:2500,maxSpeed:1400},Ws),Pu=Object.assign({deceleration:20,maxSpeed:1400},Ws),Xf=Object.assign({deceleration:1e3,maxSpeed:360},Ws),b0=Object.assign({deceleration:1e3,maxSpeed:90},Ws);class T0{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.o.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=a.o.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const y=ku(l.pan.mag(),d,Object.assign({},Vl,i||{}));_.offset=l.pan.mult(y.amount/l.pan.mag()),_.center=this._map.transform.center,la(_,y)}if(l.zoom){const y=ku(l.zoom,d,Pu);_.zoom=this._map.transform.zoom+y.amount,la(_,y)}if(l.bearing){const y=ku(l.bearing,d,Xf);_.bearing=this._map.transform.bearing+a.aA(y.amount,-179,179),la(_,y)}if(l.pitch){const y=ku(l.pitch,d,b0);_.pitch=this._map.transform.pitch+y.amount,la(_,y)}if(_.zoom||_.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function la(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function ku(f,i,l){const{maxSpeed:d,linearity:_,deceleration:y}=l,w=a.aA(f*_/(i/1e3),-d,d),S=Math.abs(w)/(y*_);return{easing:l.easing,duration:1e3*S,amount:w*(S/2)}}class Pn extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,d,_={}){const y=et(l.getCanvasContainer(),d),w=l.unproject(y);super(i,Object.assign({point:y,lngLat:w,originalEvent:d},_)),this._defaultPrevented=!1,this.target=l}}class Ru extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,d){const _=i==="touchend"?d.changedTouches:d.touches,y=Ge(l.getCanvasContainer(),_),w=y.map(A=>l.unproject(A)),S=y.reduce((A,P,M,z)=>A.add(P.div(z.length)),new a.P(0,0));super(i,{points:y,point:S,lngLats:w,lngLat:l.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class Kf extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class S0{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Kf(this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new Pn(i.type,this._map,i))}mouseup(i){this._map.fire(new Pn(i.type,this._map,i))}preclick(i){const l=new MouseEvent("preclick",i);this._map.fire(new Pn(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Pn(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Pn(i.type,this._map,i))}mouseover(i){this._map.fire(new Pn(i.type,this._map,i))}mouseout(i){this._map.fire(new Pn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ru(i.type,this._map,i))}touchmove(i){this._map.fire(new Ru(i.type,this._map,i))}touchend(i){this._map.fire(new Ru(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ru(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class E0{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Pn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Pn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nn{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(ke(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const d=l,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=J("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(_.x,d.x),S=Math.max(_.x,d.x),A=Math.min(_.y,d.y),P=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${A}px)`,this._box.style.width=S-w+"px",this._box.style.height=P-A+"px")})}mouseupWindow(i,l){if(!this._active)return;const d=this._startPos,_=l;if(d&&i.button===0){if(this.reset(),De(),d.x!==_.x||d.y!==_.y)return this._map.fire(new a.z("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new a.z(i,{originalEvent:l}))}}function Kh(f,i){const l={};for(let d=0;d<f.length;d++)l[f[d].identifier]=i[d];return l}class A0{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const y=new a.P(0,0);for(const w of _)y._add(w);return y.div(_.length)}(l),this.touches=Kh(d,l)))}touchmove(i,l,d){if(this.aborted||!this.centroid)return;const _=Kh(d,l);for(const y in this.touches){const w=_[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,l,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Yh{constructor(i){this.singleTap=new A0(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,d){this.singleTap.touchstart(i,l,d)}touchmove(i,l,d){this.singleTap.touchmove(i,l,d)}touchend(i,l,d){const _=this.singleTap.touchend(i,l,d);if(_){const y=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(y&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Pc{constructor(){this._zoomIn=new Yh({numTouches:1,numTaps:2}),this._zoomOut=new Yh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,d){this._zoomIn.touchstart(i,l,d),this._zoomOut.touchstart(i,l,d)}touchmove(i,l,d){this._zoomIn.touchmove(i,l,d),this._zoomOut.touchmove(i,l,d)}touchend(i,l,d){const _=this._zoomIn.touchend(i,l,d),y=this._zoomOut.touchend(i,l,d);return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const I0={0:1,2:2},Yf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Jh{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const d=ft(i);this._correctButton(i,d)&&(this._lastPoint=l,this._eventButton=d)}mousemoveWindow(i,l){const d=this._lastPoint;if(d){if(i.preventDefault(),this._eventButton!=null&&function(_,y){const w=I0[y];return _.buttons===void 0||(_.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(d,l)}}mouseupWindow(i){this._lastPoint&&ft(i)===this._eventButton&&(this._moved&&De(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu extends Jh{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class Jf extends Jh{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?Yf[i.pitchRotateKey]:void 0}_correctButton(i,l){return this._pitchRotateKey?l===0&&i[this._pitchRotateKey]:l===0&&i.ctrlKey||l===2}_move(i,l){const d=.8*(l.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class Qf extends Jh{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?Yf[i.pitchRotateKey]:void 0}_correctButton(i,l){return this._pitchRotateKey?l===0&&i[this._pitchRotateKey]:l===0&&i.ctrlKey||l===2}_move(i,l){const d=-.5*(l.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class C0{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(i,l,d){return this._calculateTransform(i,l,d)}touchmove(i,l,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!a.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,d)}}touchend(i,l,d){this._calculateTransform(i,l,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,d){d.length>0&&(this._active=!0);const _=Kh(d,l),y=new a.P(0,0),w=new a.P(0,0);let S=0;for(const P in _){const M=_[P],z=this._touches[P];z&&(y._add(M),w._add(M.sub(z)),S++,_[P]=M)}if(this._touches=_,S<this._minTouches||!w.mag())return;const A=w.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=J("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Du{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,d){return{}}touchstart(i,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,d){const _=this._firstTwoTouches;if(!_)return;i.preventDefault();const[y,w]=_,S=Ou(d,l,y),A=Ou(d,l,w);if(!S||!A)return;const P=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],P,i)}touchend(i,l,d){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,w=Ou(d,l,_),S=Ou(d,l,y);w&&S||(this._active&&De(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ou(f,i,l){for(let d=0;d<f.length;d++)if(f[d].identifier===l)return i[d]}function ep(f,i){return Math.log2(f/i)}class Ay extends Du{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ep(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ep(this._distance,d),pinchAround:l}}}function P0(f,i){return 180*f.angleWith(i)/Math.PI}class Iy extends Du{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const d=this._vector;if(this._vector=i[0].sub(i[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:P0(this._vector,d),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=P0(i,d);return Math.abs(_)<l}}function tp(f){return Math.abs(f.y)>Math.abs(f.x)}class Cy extends Du{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,tp(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,d){const _=this._lastPoints;if(!_)return;const y=i[0].sub(_[0]),w=i[1].sub(_[1]);return this._map._cooperativeGestures&&!a.eL()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(i,l,d){if(this._valid!==void 0)return this._valid;const _=i.mag()>=2,y=l.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=i.y>0==l.y>0;return tp(i)&&tp(l)&&w}}const Py={panStep:100,bearingStep:15,pitchStep:10};class ky{constructor(){const i=Py;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,d=0,_=0,y=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Ry,zoom:l?Math.round(A)+l*(i.shiftKey?2:1):A,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ry(f){return f*(2-f)}const k0=4.000244140625,My=1/450;class Dy{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=My,a.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||a.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=a.o.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%k0==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=et(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>k0?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);const z=l(),D=Math.pow(2,z),j=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*M))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,y=this._easing;let w,S=!1;if(this._type==="wheel"&&_&&y){const P=Math.min((a.o.now()-this._lastWheelEventTime)/200,1),M=y(P);w=a.ak(_,d,M),P<1?this._frameId||(this._frameId=!0):S=!0}else w=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=w-l();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=a.eM;if(this._prevEase){const d=this._prevEase,_=(a.o.now()-d.start)/d.duration,y=d.easing(_+.01)-d.easing(_),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);l=a.eK(w,S,.25,1)}return this._prevEase={start:a.o.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=J("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Oy{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ly{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dw{constructor(){this._tap=new Yh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=l[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,l,d))}touchmove(i,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=l[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,l,d)}touchend(i,l,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(i,l,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fw{constructor(i,l,d){this._el=i,this._mousePan=l,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pw{constructor(i,l,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class en{constructor(i,l,d,_){this._el=i,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qh=f=>f.zoom||f.drag||f.pitch||f.rotate;class mw extends a.z{}class gw{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const d=a.av([],l,i);this.radius=a.ag(d[2]<0?a.eO([],d,this.constants):[d[0],d[1],0])}projectRay(i){a.eO(i,i,this.constants),a.aw(i,i),a.eP(i,i,this.constants);const l=a.c4([],i,this.radius);if(l[2]>0){const d=a.c4([],[0,0,1],a.bJ(l,[0,0,1])),_=a.c4([],a.aw([],[l[0],l[1],0]),this.radius),y=a.d7([],l,a.c4([],a.av([],a.d7([],_,d),l),2));l[0]=y[0],l[1]=y[1]}return l}}function rp(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ed{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new T0(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new gw,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,w]of this._listeners){const S=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,S,w)}}destroy(){for(const[i,l,d]of this._listeners){const _=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(l,_,d)}}_addDefaultHandlers(i){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new S0(l,i));const _=l.boxZoom=new Nn(l,i);this._add("boxZoom",_);const y=new Pc,w=new Ly;l.doubleClickZoom=new Oy(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const S=new dw;this._add("tapDragZoom",S);const A=l.touchPitch=new Cy(l);this._add("touchPitch",A);const P=new Jf(i),M=new Qf(i);l.dragRotate=new pw(i,P,M),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const z=new Mu(i),D=new C0(l,i);l.dragPan=new fw(d,z,D),this._add("mousePan",z),this._add("touchPan",D,["touchZoom","touchRotate"]);const j=new Iy,V=new Ay;l.touchZoomRotate=new en(d,V,j,S),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new E0(l));const G=l.scrollZoom=new Dy(l,this);this._add("scrollZoom",G,["mousePan"]);const te=l.keyboard=new ky;this._add("keyboard",te);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[K]&&l[K].enable(i[K])}_add(i,l,d){this._handlers.push({handlerName:i,handler:l,allowed:d}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,d){for(const _ in i)if(_!==d&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const d of i)this._el.contains(d.target)&&l.push(d);return l}handleEvent(i,l){this._updatingCamera=!0;const d=i.type==="renderFrame",_=d?void 0:i,y={needsRenderFrame:!1},w={},S={},A=i.touches?this._getMapTouches(i.touches):void 0,P=A?Ge(this._el,A):d?void 0:et(this._el,i);for(const{handlerName:D,handler:j,allowed:V}of this._handlers){if(!j.isEnabled())continue;let G;this._blockedByActive(S,V,D)?j.reset():j[l||i.type]&&(G=j[l||i.type](i,P,A),this.mergeHandlerResult(y,w,G,D,_),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||j.isActive())&&(S[D]=j)}const M={};for(const D in this._previousActiveHandlers)S[D]||(M[D]=_);this._previousActiveHandlers=S,(Object.keys(M).length||rp(y))&&(this._changes.push([y,w,M]),this._triggerRenderFrame()),(Object.keys(S).length||rp(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=y;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(i,l,d,_,y){if(!d)return;Object.assign(i,d);const w={handlerName:_,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(l.zoom=w),d.panDelta!==void 0&&(l.drag=w),d.pitchDelta!==void 0&&(l.pitch=w),d.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const i={},l={},d={};for(const[_,y,w]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(i.around=_.around),_.aroundCoord!==void 0&&(i.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),Object.assign(l,y),Object.assign(d,w);this._updateMapTransform(i,l,d),this._changes=[]}_updateMapTransform(i,l,d){const _=this._map,y=_.transform,w=oe=>[oe.x,oe.y,oe.z];if((oe=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!rp(i)){const oe=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),oe!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!rp(i))return void this._fireEvents(l,d,!0);let{panDelta:S,zoomDelta:A,bearingDelta:P,pitchDelta:M,around:z,aroundCoord:D,pinchAround:j}=i;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),j!==void 0&&(z=j),(A||(oe=>l[oe]&&!this._eventsInProgress[oe])("drag"))&&z&&(this._dragOrigin=w(y.pointCoordinate3D(z)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),z=z||_.transform.centerPoint,P&&(y.bearing+=P),M&&(y.pitch+=M),y._updateCameraState();const V=[0,0,0];if(S)if(y.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z).dir),he=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z.sub(S)).dir);V[0]=he[0]-oe[0],V[1]=he[1]-oe[1]}else{const oe=y.pointCoordinate(z);if(y.projection.name==="globe"){S=S.rotate(-y.angle);const he=y._pixelsPerMercatorPixel/y.worldSize;V[0]=-S.x*a.eN(a.a$(oe.y))*he,V[1]=-S.y*a.eN(y.center.lat)*he}else{const he=y.pointCoordinate(z.sub(S));oe&&he&&(V[0]=he.x-oe.x,V[1]=he.y-oe.y)}}const G=y.zoom,te=[0,0,0];if(A){const oe=w(D||y.pointCoordinate3D(z)),he={dir:a.aw([],a.av([],oe,y._camera.position))};if(he.dir[2]<0){const ge=y.zoomDeltaToMovement(oe,A);a.c4(te,he.dir,ge)}}const K=a.d7(V,V,te);y._translateCameraConstrained(K),A&&Math.abs(y.zoom-G)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,d,!0)}_fireEvents(i,l,d){const _=Qh(this._eventsInProgress),y=Qh(i),w={};for(const M in i){const{originalEvent:z}=i[M];this._eventsInProgress[M]||(w[`${M}start`]=z),this._eventsInProgress[M]=i[M]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const M in w)this._fireEvent(M,w[M]);y&&this._fireEvent("move",y.originalEvent);for(const M in i){const{originalEvent:z}=i[M];this._fireEvent(M,z)}const S={};let A;for(const M in this._eventsInProgress){const{handlerName:z,originalEvent:D}=this._eventsInProgress[M];this._handlersById[z].isActive()||(delete this._eventsInProgress[M],A=l[z]||D,S[`${M}end`]=A)}for(const M in S)this._fireEvent(M,S[M]);const P=Qh(this._eventsInProgress);if(d&&(_||y)&&!P){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;M?(z(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:A})):(this._map.fire(new a.z("moveend",{originalEvent:A})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new a.z(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new mw("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const R0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class M0 extends a.E{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,a.aY(["_renderFrameCallback"],this)}getCenter(){return new a.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,d){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,Object.assign({offset:i},l),d)}panTo(i,l,d){return this.easeTo(Object.assign({center:i},l),d)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,d){return this.easeTo(Object.assign({zoom:i},l),d)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,d){return this.easeTo(Object.assign({bearing:i},l),d)}resetNorth(i,l){return this.rotateTo(0,Object.assign({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=a.aI.convert(i);const d=l&&l.bearing||0,_=l&&l.pitch||0,y=i.getNorthWest(),w=i.getSouthEast();return this._cameraForBounds(this.transform,y,w,d,_,l)}_extendPadding(i){const l={top:0,right:0,bottom:0,left:0};return i==null?Object.assign({},l,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:Object.assign({},l,i)}_extendCameraOptions(i){return(i=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,l){const d=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return d/_>i.aspect?d/(2*Math.tan(.5*i.fovX)*i.aspect):_/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,d,_,y,w){const S=i.clone(),A=this._extendCameraOptions(w);S.bearing=_,S.pitch=y;const P=a.aR.convert(l),M=a.aR.convert(d),z=.5*(P.lat+M.lat),D=.5*(P.lng+M.lng),j=a.eQ(z,D),V=a.aw([],j),G=a.aw([],a.bI([],V,[0,1,0])),te=a.bI([],G,V),K=[G[0],G[1],G[2],0,te[0],te[1],te[2],0,V[0],V[1],V[2],0,0,0,0,1],oe=[j,a.eQ(P.lat,P.lng),a.eQ(M.lat,P.lng),a.eQ(M.lat,M.lng),a.eQ(P.lat,M.lng),a.eQ(z,P.lng),a.eQ(z,M.lng),a.eQ(P.lat,D),a.eQ(M.lat,D)];let he=a.d8.fromPoints(oe.map(Xe=>[a.bJ(G,Xe),a.bJ(te,Xe),a.bJ(V,Xe)]));const ge=a.af([],he.center,K);a.eR(ge)===0&&a.eS(ge,0,0,1),a.aw(ge,ge),a.c4(ge,ge,a.aD),S.center=a.eT(ge);const Se=S.getWorldToCameraMatrix(),be=a.bl(new Float64Array(16),Se);he=a.d8.applyTransform(he,a.aB([],Se,K));const Ee=this._extendAABB(he,S,A,_);if(!Ee)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Ee,a.af(ge,ge,Se);const Te=.5*(he.max[2]-he.min[2]),we=this._minimumAABBFrustumDistance(S,he),Ae=a.c4([],[0,0,1],Te),qe=a.d7(Ae,ge,Ae),Ne=we+(S.pitch===0?0:a.bG(ge,qe)),rt=S.globeCenterInViewSpace,$e=a.av([],ge,[rt[0],rt[1],rt[2]]);a.aw($e,$e),a.c4($e,$e,Ne);const Qe=a.d7([],ge,$e);a.af(Qe,Qe,be);const kt=a.eD/a.aD,We=a.ag(Qe),Oe=a.ce(Math.max(We*kt-a.eD,Number.EPSILON),0),ot=Math.min(S.zoomFromMercatorZAdjusted(Oe),A.maxZoom);return ot>.5*(a.cZ+a.cK)?(S.setProjection({name:"mercator"}),S.zoom=ot,this._cameraForBounds(S,l,d,_,y,w)):{center:S.center,zoom:ot,bearing:_,pitch:y}}_extendAABB(i,l,d,_){const y=.5*((d.padding.left||0)+(d.padding.right||0)),w=.5*((d.padding.top||0)+(d.padding.bottom||0)),S=w,A=y,P=y,M=w,z=l.width-(A+P),D=l.height-(S+M),j=a.av([],i.max,i.min),V=Math.min(z/j[0],D/j[1]),G=Math.min(l.scaleZoom(l.scale*V),d.maxZoom);if(isNaN(G))return null;const te=l.scale/l.zoomScale(G),K=new a.d8([i.min[0]-A*te,i.min[1]-M*te,i.min[2]],[i.max[0]+P*te,i.max[1]+S*te,i.max[2]]),oe=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new a.P(d.offset.x,d.offset.y):a.P.convert(d.offset)).rotate(-a.an(_));return K.center[0]-=oe.x*te,K.center[1]+=oe.y*te,K}queryTerrainElevation(i,l){const d=this.transform.elevation;return d?(l=Object.assign({},{exaggerated:!0},l),d.getAtPoint(a.ae.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,d,_,y,w){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,l,d,_,y,w);const S=i.clone(),A=this._extendCameraOptions(w);S.bearing=_,S.pitch=y;const P=a.aR.convert(l),M=a.aR.convert(d),z=new a.aR(P.lng,M.lat),D=new a.aR(M.lng,P.lat),j=S.project(P),V=S.project(M),G=this.queryTerrainElevation(P),te=this.queryTerrainElevation(M),K=this.queryTerrainElevation(z),oe=this.queryTerrainElevation(D),he=[[j.x,j.y,Math.min(G||0,te||0,K||0,oe||0)],[V.x,V.y,Math.max(G||0,te||0,K||0,oe||0)]];let ge=a.d8.fromPoints(he);const Se=S.getWorldToCameraMatrix(),be=a.bl(new Float64Array(16),Se);ge=a.d8.applyTransform(ge,Se);const Ee=this._extendAABB(ge,S,A,_);if(!Ee)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=Ee;const Te=.5*a.av([],ge.max,ge.min)[2],we=this._minimumAABBFrustumDistance(S,ge),Ae=[0,0,1,0];a.aC(Ae,Ae,Se),a.eU(Ae,Ae);const qe=a.c4([],Ae,we+Te),Ne=a.d7([],ge.center,qe);a.af(ge.center,ge.center,be),a.af(Ne,Ne,be);const rt=S.unproject(new a.P(ge.center[0],ge.center[1])),$e=a.eV(S.projection,rt),Qe=Math.pow(2,$e),kt=Math.min(S._zoomFromMercatorZ(Ne[2]*S.pixelsPerMeter*Qe/S.worldSize),A.maxZoom);return S.mercatorFromTransition&&kt<.5*(a.cZ+a.cK)?(S.setProjection({name:"globe"}),S.zoom=kt,this._cameraForBounds(S,l,d,_,y,w)):{center:rt,zoom:kt,bearing:_,pitch:y}}fitBounds(i,l,d){const _=this.cameraForBounds(i,l);return this._fitInternal(_,l,d)}fitScreenCoordinates(i,l,d,_,y){const w=a.P.convert(i),S=a.P.convert(l),A=new a.P(Math.min(w.x,S.x),Math.min(w.y,S.y)),P=new a.P(Math.max(w.x,S.x),Math.max(w.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,S))return this;const M=this.transform.pointLocation3D(A),z=this.transform.pointLocation3D(P),D=this.transform.pointLocation3D(new a.P(A.x,P.y)),j=this.transform.pointLocation3D(new a.P(P.x,A.y)),V=[Math.min(M.lng,z.lng,D.lng,j.lng),Math.min(M.lat,z.lat,D.lat,j.lat)],G=[Math.max(M.lng,z.lng,D.lng,j.lng),Math.max(M.lat,z.lat,D.lat,j.lat)],te=_&&_.pitch?_.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,V,G,d,te,_);return this._fitInternal(K,_,y)}_fitInternal(i,l,d){return i?(l=Object.assign(i,l)).linear?this.easeTo(l,d):this.flyTo(l,d):this}jumpTo(i,l){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,w=!1;"zoom"in i&&d.zoom!==+i.zoom&&(_=!0,d.zoom=+i.zoom),i.center!==void 0&&(d.center=a.aR.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(y=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(w=!0,d.pitch=+i.pitch);const S=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!d.isPaddingEqual(S))if(i.retainPadding===!1){const A=d.clone();A.padding=S,d.setLocationAtPoint(d.center,A.centerPoint)}else d.padding=S;return i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new a.z("movestart",l)).fire(new a.z("move",l)),_&&this.fire(new a.z("zoomstart",l)).fire(new a.z("zoom",l)).fire(new a.z("zoomend",l)),y&&this.fire(new a.z("rotatestart",l)).fire(new a.z("rotate",l)).fire(new a.z("rotateend",l)),w&&this.fire(new a.z("pitchstart",l)).fire(new a.z("pitch",l)).fire(new a.z("pitchend",l)),this.fire(new a.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(R0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const d=this.transform;if(!d.projection.supportsFreeCamera)return a.w(R0),this;this.stop();const _=d.zoom,y=d.pitch,w=d.bearing;d.setFreeCameraOptions(i);const S=_!==d.zoom,A=y!==d.pitch,P=w!==d.bearing;return this.fire(new a.z("movestart",l)).fire(new a.z("move",l)),S&&this.fire(new a.z("zoomstart",l)).fire(new a.z("zoom",l)).fire(new a.z("zoomend",l)),P&&this.fire(new a.z("rotatestart",l)).fire(new a.z("rotate",l)).fire(new a.z("rotateend",l)),A&&this.fire(new a.z("pitchstart",l)).fire(new a.z("pitch",l)).fire(new a.z("pitchend",l)),this.fire(new a.z("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=Object.assign({offset:[0,0],duration:500,easing:a.eM},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const d=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),A="zoom"in i?+i.zoom:_,P="bearing"in i?this._normalizeBearing(i.bearing,y):y,M="pitch"in i?+i.pitch:w,z=this._extendPadding(i.padding),D=a.P.convert(i.offset);let j,V,G;if(d.projection.name==="globe"){const Ae=a.ae.fromLngLat(d.center),qe=D.rotate(-d.angle);Ae.x+=qe.x/d.worldSize,Ae.y+=qe.y/d.worldSize;const Ne=Ae.toLngLat(),rt=a.aR.convert(i.center||Ne);this._normalizeCenter(rt),j=d.centerPoint.add(qe),V=new a.P(Ae.x,Ae.y).mult(d.worldSize),G=new a.P(a.aF(rt.lng),a.aJ(rt.lat)).mult(d.worldSize).sub(V)}else{j=d.centerPoint.add(D);const Ae=d.pointLocation(j),qe=a.aR.convert(i.center||Ae);this._normalizeCenter(qe),V=d.project(Ae),G=d.project(qe).sub(V)}const te=d.zoomScale(A-_);let K,oe;i.around&&(K=a.aR.convert(i.around),oe=d.locationPoint(K));const he=this._zooming||A!==_,ge=this._rotating||y!==P,Se=this._pitching||M!==w,be=!d.isPaddingEqual(z),Ee=i.retainPadding===!1?d.clone():d,Te=Ae=>qe=>{if(he&&(Ae.zoom=a.ak(_,A,qe)),ge&&(Ae.bearing=a.ak(y,P,qe)),Se&&(Ae.pitch=a.ak(w,M,qe)),be&&(Ee.interpolatePadding(S,z,qe),j=Ee.centerPoint.add(D)),K)Ae.setLocationAtPoint(K,oe);else{const Ne=Ae.zoomScale(Ae.zoom-_),rt=A>_?Math.min(2,te):Math.max(.5,te),$e=Math.pow(rt,1-qe),Qe=Ae.unproject(V.add(G.mult(qe*$e)).mult(Ne));Ae.setLocationAtPoint(Ae.renderWorldCopies?Qe.wrap():Qe,j)}return i.preloadOnly||this._fireMoveEvents(l),Ae};if(i.preloadOnly){const Ae=this._emulate(Te,i.duration,d);return this._preloadTiles(Ae),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=ge,this._pitching=Se,this._padding=be,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,we),this._ease(Te(d),Ae=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(l,Ae)},i),this}_prepareEase(i,l,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||d.moving||this.fire(new a.z("movestart",i)),this._zooming&&!d.zooming&&this.fire(new a.z("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new a.z("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new a.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new a.z("move",i)),this._zooming&&this.fire(new a.z("zoom",i)),this._rotating&&this.fire(new a.z("rotate",i)),this._pitching&&this.fire(new a.z("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.z("zoomend",i)),_&&this.fire(new a.z("rotateend",i)),y&&this.fire(new a.z("pitchend",i)),this.fire(new a.z("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){const Xe=a.aH(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Xe,l)}this.stop(),i=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:a.eM},i);const d=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),A="zoom"in i?a.aA(+i.zoom,d.minZoom,d.maxZoom):_,P="bearing"in i?this._normalizeBearing(i.bearing,y):y,M="pitch"in i?+i.pitch:w,z=this._extendPadding(i.padding),D=d.zoomScale(A-_),j=a.P.convert(i.offset);let V=d.centerPoint.add(j);const G=d.pointLocation(V),te=a.aR.convert(i.center||G);this._normalizeCenter(te);const K=d.project(G),oe=d.project(te).sub(K);let he=i.curve;const ge=Math.max(d.width,d.height),Se=ge/D,be=oe.mag();if("minZoom"in i){const Xe=a.aA(Math.min(i.minZoom,_,A),d.minZoom,d.maxZoom),gt=ge/d.zoomScale(Xe-_);he=Math.sqrt(gt/be*2)}const Ee=he*he;function Te(Xe){const gt=(Se*Se-ge*ge+(Xe?-1:1)*Ee*Ee*be*be)/(2*(Xe?Se:ge)*Ee*be);return Math.log(Math.sqrt(gt*gt+1)-gt)}function we(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Ae(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const qe=Te(0);let Ne=function(Xe){return Ae(qe)/Ae(qe+he*Xe)},rt=function(Xe){return ge*((Ae(qe)*(we(gt=qe+he*Xe)/Ae(gt))-we(qe))/Ee)/be;var gt},$e=(Te(1)-qe)/he;if(Math.abs(be)<1e-6||!isFinite($e)){if(Math.abs(ge-Se)<1e-6)return this.easeTo(i,l);const Xe=Se<ge?-1:1;$e=Math.abs(Math.log(Se/ge))/he,rt=function(){return 0},Ne=function(gt){return Math.exp(Xe*he*gt)}}i.duration="duration"in i?+i.duration:1e3*$e/("screenSpeed"in i?+i.screenSpeed/he:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Qe=y!==P,kt=M!==w,We=!d.isPaddingEqual(z),Oe=i.retainPadding===!1?d.clone():d,ot=Xe=>gt=>{const Ct=gt*$e,jt=1/Ne(Ct);Xe.zoom=gt===1?A:_+Xe.scaleZoom(jt),Qe&&(Xe.bearing=a.ak(y,P,gt)),kt&&(Xe.pitch=a.ak(w,M,gt)),We&&(Oe.interpolatePadding(S,z,gt),V=Oe.centerPoint.add(j));const St=gt===1?te:Xe.unproject(K.add(oe.mult(rt(Ct))).mult(jt));return Xe.setLocationAtPoint(Xe.renderWorldCopies?St.wrap():St,V),Xe._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),Xe};if(i.preloadOnly){const Xe=this._emulate(ot,i.duration,d);return this._preloadTiles(Xe),this}return this._zooming=!0,this._rotating=Qe,this._pitching=kt,this._padding=We,this._prepareEase(l,!1),this._ease(ot(d),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,l)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,l,d){d.animate===!1||d.duration===0?(i(1),l()):(this._easeStart=a.o.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((a.o.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=a.bT(i,-180,180);const d=Math.abs(i-l);return Math.abs(i-360-l)<d&&(i-=360),Math.abs(i+360-l)<d&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const d=i.lng-l.center.lng;i.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&a.o.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,d){const _=Math.ceil(15*l/1e3),y=[],w=i(d.clone());for(let S=0;S<=_;S++){const A=w(S/_);y.push(A.clone())}return y}_preloadTiles(i,l){}}class td{constructor(i={}){this.options=i,a.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact,d=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=J("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=J("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=J("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(i){const d=l.reduce((_,y,w)=>(y.value&&(_+=`${y.key}=${y.value}${w<l.length-1?"&":""}`),_),"?");i.href=`${a.e.FEEDBACK_URL}/${d}#${Zf(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||(i.dataType!=="source"||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility")&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._mergedSourceCaches;for(const _ in l){const y=l[_];if(y.used){const w=y.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i.sort((_,y)=>_.length-y.length),i=i.filter((_,y)=>{for(let w=y+1;w<i.length;w++)if(i[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ra{constructor(){a.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=J("div","mapboxgl-ctrl");const l=J("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const l in i){const d=i[l].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class rd{constructor(){a.aY(["_onIndoorUpdate"],this)}onAdd(i){return this._map=i,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",l=>this._onIndoorUpdate({selectedFloorId:l.selectedFloorId,floors:l.floors})),this._container}_createButton(i,l){const d=J("button",i,this._container);return d.type="button",d.addEventListener("click",l),d}_createSeparator(){return J("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(i,l){this._map&&(i.setAttribute("aria-label",l),i.textContent=l)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(i){if(!i||!i.floors)return void(this._container.style.display="none");const l=this._model;this._model=i,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const d=i.floors.sort((_,y)=>y.levelOrder-_.levelOrder);l?(Array.from(this._container.children).forEach(_=>_.remove()),this.addCurrentFloors(d)):this.addCurrentFloors(d)}addCurrentFloors(i){for(let l=0;l<i.length;l++){const d=i[l],_=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(d.id),this._model&&(this._model.selectedFloorId=d.id),Array.from(this._container.children).forEach(y=>{y.classList.contains("mapboxgl-ctrl-level-button")&&y.classList.remove("mapboxgl-ctrl-level-button-selected")}),_.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(_,d.shortName),this._model&&d.id===this._model.selectedFloorId&&_.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(_),l<i.length-1&&this._createSeparator()}}}class pn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(const _ of d)if(_.id===i)return void(_.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const d of l)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ma{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=a.dz((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,d){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+d}}const id={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class nd extends a.z{constructor(i,l,d,_){const{point:y,lngLat:w,originalEvent:S,target:A}=i;super(i.type,{point:y,lngLat:w,originalEvent:S,target:A}),this.preventDefault=()=>{i.preventDefault()},this.id=l,this.interaction=d,this.feature=_}}class Fy{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,l){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const d=l.filter;let _=l.type;d&&this.filters.set(i,a.b6(d)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,l)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(i,l),this.typeById.set(i,_)}get(i){const l=this.typeById.get(i);if(!l)return;const d=this.interactionsByType.get(l);return d?d.get(i):void 0}remove(i){const l=this.typeById.get(i);if(!l)return;this.typeById.delete(i),this.filters.delete(i);const d=this.interactionsByType.get(l);d&&(d.delete(i),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(l,this.handleType))}queryTargets(i,l){const d=[];for(const[_,y]of l)y.target&&d.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(i,d,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());l.length&&(i.type="mouseenter",this.handleType(i,l));const d=new Map;for(const[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||d.set(y.id,y);d.size&&(i.type="mouseleave",this.handleType(i,Array.from(d.values())))}handleOut(i){const l=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);l.length&&(i.type="mouseleave",this.handleType(i,l)),this.hoveredFeatures.clear()}handleType(i,l){const d=i.type==="mouseenter";if(d&&!this.interactionsByType.has(i.type))return void a.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(i.type)).reverse(),y=!!l;l=l||this.queryTargets(i.point,_);let w=!1;const S=new Set;for(const A of l){for(const[P,M]of _){if(!M.target)continue;const z=A.variants?A.variants[P]:null;if(z){for(const D of z){if(Sl(D,A,S,P))continue;const j=new a.dt(A,D),V=Sh(D,A,P);y&&(j.state=this.map.getFeatureState(j));const G=d?this.prevHoveredFeatures.get(V):null,te=new nd(i,P,M,j),K=G?G.stop:M.handler(te);if(d&&this.hoveredFeatures.set(V,{feature:A,stop:K}),K!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[A,P]of _){const{handler:M,target:z}=P;if(!z&&M(new nd(i,A,P,null))!==!1)break}}}function _w(f,i){if(Array.isArray(f)&&Array.isArray(i)){const l=new Set(f),d=new Set(i);return l.size===d.size&&f.every(_=>d.has(_))}return a.by(f,i)}const sd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},yw={showCompass:!0,showZoom:!0,visualizePitch:!1};class xw{constructor(i,l,d=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Jf({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new Qf({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),a.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),ke()}move(i,l){const d=this.map,_=this.mouseRotate.mousemoveWindow(i,l),y=_&&_.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(i,l),S=w&&w.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(Object.assign({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),et(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,et(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ge(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ge(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ip(f,i,l){if(f=new a.aR(f.lng,f.lat),i){const d=new a.aR(f.lng-360,f.lat),_=new a.aR(f.lng+360,f.lat),y=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),w=l.locationPoint3D(f).distSqr(i),S=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint3D(d).distSqr(i)<w&&(S||Math.abs(d.lng-l.center.lng)<y)?f=d:l.locationPoint3D(_).distSqr(i)<w&&(S||Math.abs(_.lng-l.center.lng)<y)&&(f=_)}for(;Math.abs(f.lng-l.center.lng)>180;){const d=l.locationPoint3D(f);if(d.x>=0&&d.y>=0&&d.x<=l.width&&d.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const od={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Eo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class kc extends a.E{constructor(i,l){super(),(i instanceof HTMLElement||l)&&(i=Object.assign({element:i},l)),a.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:_="#3FB1CE",scale:y=1,draggable:w=!1,clickTolerance:S=0,rotation:A=Eo.rotation,rotationAlignment:P=Eo.rotationAlignment,pitchAlignment:M=Eo.pitchAlignment,occludedOpacity:z=Eo.occludedOpacity,altitude:D=Eo.altitude}=i||{};this._anchor=d,this._color=_,this._scale=y,this._draggable=w,this._clickTolerance=S,this._rotation=A,this._rotationAlignment=P,this._pitchAlignment=M,this._occludedOpacity=z,this._altitude=D,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),i&&i.element?(this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(i&&i.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const j=this._element.classList;for(const G in od)j.remove(`mapboxgl-marker-anchor-${G}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const V=i&&i.className?i.className.trim().split(/\s+/):[];j.add(...V),this._popup=null}_createDefaultMarker(){const i=J("div"),l=_e("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},i);if(this._altitude===0){const d=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},l));_e("stop",{offset:"10%","stop-opacity":.4},d),_e("stop",{offset:"100%","stop-opacity":.05},d),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return _e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),i}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.aR.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(i){return i===this._altitude||(this._defaultMarker&&(this._altitude===0&&i!==0||this._altitude!==0&&i===0)&&(this._element=this._createDefaultMarker()),this._altitude=i||Eo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,i._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,d=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,l=this._pos;if(!i||!l)return!1;const d=i.unproject(l,this._altitude),_=i.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const d=i.unproject(l,this._altitude);let _;i._showingGlobe()&&a.eY(i.transform,this._lngLat)?_=0:(_=1-i._queryFogOpacity(d),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${od[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const i=this._pos,l=this._map,d=this.getPitchAlignment();if(!l||!i||d!=="map")return"";if(!l._showingGlobe()){const A=l.getPitch();return A?`rotateX(${A}deg)`:""}const _=a.cW(a.eZ(l.transform,this._lngLat)),y=i.sub(a.e_(l.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const S=_/w;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const y=l.project(new a.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=l.project(new a.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);d=a.cW(Math.atan2(w.y,w.x))-90}else d=-l.getBearing();else if(_==="horizon"){const y=a.ah(4,6,l.getZoom()),w=a.e_(l.transform);w.y+=y*l.transform.height;const S=i.sub(w),A=a.cW(Math.atan2(S.y,S.x));d=(A>90?A-270:A+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=ip(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const l=this._map;if(!l)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const y=this._clickTolerance||l._clickTolerance;if(i.point.dist(d)<y)return;this._isDragging=!0}this._pos=i.point.sub(_),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.z("dragstart"))),this.fire(new a.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.z("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map,d=this._pos;l&&d&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(d),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||Eo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||Eo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||Eo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||Eo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const $l={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ja={maxWidth:100,unit:"metric"},Qa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Rc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ca=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ny(f=new a.P(0,0),i="bottom"){if(typeof f=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new a.P(0,f);case"top-left":return new a.P(l,l);case"top-right":return new a.P(-l,l);case"bottom":return new a.P(0,-f);case"bottom-left":return new a.P(l,-l);case"bottom-right":return new a.P(-l,-l);case"left":return new a.P(f,0);case"right":return new a.P(-f,0)}return new a.P(0,0)}return f instanceof a.P||Array.isArray(f)?a.P.convert(f):a.P.convert(f[i]||[0,0])}return{version:R,supported:re.supported,setRTLTextPlugin:a.f2,getRTLTextPluginStatus:a.f1,Map:class extends M0{constructor(f){B.mark(O.create);const i=f;if((f=Object.assign({},sd,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&a.eW(window)&&(f.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ds(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new pn,this._domRenderTaskQueue=new pn,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.b2(),this._locale=Object.assign({},id,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ma(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Dr(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,a.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Iu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ed(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||a.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new fc(this),f.hash&&(this._hash=new w0(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const l=f.bounds;l&&(this.resize(),this.fitBounds(l,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new td({customAttribution:f.customAttribution})),this._logoControl=new Ra,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new a.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new a.z(`${l.dataType}dataloading`,l))}),this._interactions=new Fy(this)}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new a.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const d=this._controlPositions[i];return i.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new a.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new a.z("movestart",f)).fire(new a.z("move",f)),this.fire(new a.z("resize",f)),i&&this.fire(new a.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(a.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let l;i==="globe"&&f.zoom>=a.cK?(f.setMercatorFromTransition(),l=!0):i==="mercator"&&f.zoom<a.cK&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=a.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,i){return this.transform.locationPoint3D(a.aR.convert(f),i)}unproject(f,i){return this.transform.pointLocation3D(a.P.convert(f),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,l){const d=_=>{let y=[];if(Array.isArray(i)){const w=i.filter(S=>this.getLayer(S));y=w.length?this.queryRenderedFeatures(_,{layers:w}):[]}else y=this.queryRenderedFeatures(_,{target:i});return y};if(f==="mouseenter"||f==="mouseover"){let _=!1;return{listener:l,targets:i,delegates:{mousemove:w=>{const S=d(w.point);S.length?_||(_=!0,l.call(this,new Pn(f,this,w.originalEvent,{features:S}))):_=!1},mouseout:()=>{_=!1}}}}if(f==="mouseleave"||f==="mouseout"){let _=!1;return{listener:l,targets:i,delegates:{mousemove:S=>{d(S.point).length?_=!0:_&&(_=!1,l.call(this,new Pn(f,this,S.originalEvent)))},mouseout:S=>{_&&(_=!1,l.call(this,new Pn(f,this,S.originalEvent)))}}}}{const _=y=>{const w=d(y.point);w.length&&(y.features=w,l.call(this,y),delete y.features)};return{listener:l,targets:i,delegates:{[f]:_}}}}on(f,i,l){if(typeof i=="function"||l===void 0)return super.on(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(f,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(f,i,l){if(typeof i=="function"||l===void 0)return super.once(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(f,i,l);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(f,i,l){if(typeof i=="function"||l===void 0)return super.off(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._delegatedListeners?this._delegatedListeners[f]:void 0;return d&&(_=>{for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===l&&_w(w.targets,i)){for(const S in w.delegates)this.off(S,w.delegates[S]);return _.splice(y,1),this}}})(d),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(f===void 0||f instanceof a.P||Array.isArray(f)||i!==void 0||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!i){const y=this.style.queryRenderedFeatures(f,void 0,this.transform),w=this.style.queryRenderedFeatureset(f,void 0,this.transform);return y.concat(w)}let l=!0;if(i.target&&(l=this._isTargetValid(i.target),l&&!i.layers))return this.style.queryRenderedFeatureset(f,i,this.transform);let d=!0;if(i.layers&&Array.isArray(i.layers)){for(const y of i.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!i.target)return this.style.queryRenderedFeatures(f,i,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(f,i,this.transform))),l&&(_=_.concat(this.style.queryRenderedFeatureset(f,i,this.transform))),_}querySourceFeatures(f,i){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,i)}queryRasterValue(f,i,l){return this._isValidId(f)?this.style.queryRasterValue(f,i,l):Promise.resolve(null)}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&a.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(f))}addInteraction(f,i){return this._interactions.add(f,i),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,i){return i=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(l,d)=>{if(l){const _=typeof l=="string"?l:l instanceof Error?l.message:l.error;a.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(f,i)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const l=Object.assign({},i);i&&i.config&&(l.initialConfig=i.config,delete l.config),this.style=new Bo(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new a.y(new Error("IDs can't be empty."))),!1):!a.dm(f)||(this.fire(new a.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const i of f)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(f)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:l=1,sdf:d=!1,stretchX:_,stretchY:y,content:w}={}){this._lazyInitEmptyStyle();const S=a.I.from(f);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:A,height:P,data:M}=a.o.getImageData(i);this.style.addImage(S,{data:new a.q({width:A,height:P},M),pixelRatio:l,stretchX:_,stretchY:y,content:w,sdf:d,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new a.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=i,M=i;this.style.addImage(S,{data:new a.q({width:A,height:P},new Uint8Array(M.data)),pixelRatio:l,stretchX:_,stretchY:y,content:w,sdf:d,usvg:!1,version:0,userImage:M}),M.onAdd&&M.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const l=a.I.from(f),d=this.style.getImage(l);if(!d)return void this.fire(new a.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?a.o.getImageData(i):i,{width:y,height:w,data:S}=_;if(y===void 0||w===void 0)return void this.fire(new a.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||w!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new a.y(new Error(`The width and height of the updated image (${y}, ${w})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const A=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let P=!1;d.usvg?(d.data=new a.q({width:y,height:w},new Uint8Array(S)),d.usvg=!1,d.icon=void 0,P=!0):d.data.replace(S,A),this.style.updateImage(l,d,P)}hasImage(f){return f?!!this.style&&!!this.style.getImage(a.I.from(f)):(this.fire(new a.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(a.I.from(f))}loadImage(f,i){a.n(this._requestManager.transformRequest(f,a.R.Image),(l,d)=>{i(l,d instanceof HTMLImageElement?a.o.getImageData(d):d)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new a.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i).catch(l=>this.fire(new a.y(new Error("Failed to add import",l)))),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const i=this.style.getOwnLayer(f);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,l),this._update(!0)):this}setFilter(f,i,l={}){return this._isValidId(f)?(this.style.setFilter(f,i,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,l,d={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,l,d),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,l,d={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,l,d),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,l){return this.style.setConfigProperty(f,i,l),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,i),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aR.convert(f),this.transform):0}setFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,i),this._update())}removeFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,i),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new rd),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,d,_,y=this._container;for(;y&&(!d||!_);){const w=window.getComputedStyle(y).transform;w&&w!=="none"&&(l=w.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(d=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),y=y.parentElement}this._containerWidth=d?Math.abs(f/d):f,this._containerHeight=_?Math.abs(i/_):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=J("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=J("div","mapboxgl-canvas-container",f);this._canvas=J("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=J("div","mapboxgl-control-container",f),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{d[_]=J("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const l=a.o.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=Object.assign({},re.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(bi(i,!0),this.painter=new v0(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.k.testSupport(i)):this.fire(new a.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new a.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,d=a.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=_.createQuery(),_.beginQuery(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,M=this.transform.pitch,z=a.o.now(),D=new a.ac(P,{now:z,fadeDuration:y,pitch:M,transition:this.style.transition,worldview:this._worldview});this.style.update(D)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(d);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,B.mark(O.load),this.fire(new a.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const P=a.o.now()-d;_.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const M=_.getQueryParameter(i,_.QUERY_RESULT)/1e6;_.deleteQuery(i),this.fire(new a.z("gpu-timing-frame",{cpuTime:P,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(P);this.fire(new a.z("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(P);this.fire(new a.z("gpu-timing-deferred-render",{gpuTime:M}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(A||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new a.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new a.z("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,B.mark(O.fullLoad),this._performanceMetricsCollection&&br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const w=Math.abs(_-y);if(w>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),l(y);this._averageElevation.easeTo(y,f,300)}else if(w>1e-4)return this._averageElevation.jumpTo(y),l(y)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){Qt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Xt||f.status===401)){const i=this.painter.context.gl;bi(i,!1),this._logoControl instanceof Ra&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ct(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Pt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,d=l.createFramebuffer();function _(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,d),this._canvasPixelComparison(_(f),i.canvasCopies.map(_),i.timeStamps)}_canvasPixelComparison(f,i,l){let d=l[1]-l[0];const _=f.length/4;for(let y=0;y<i.length;y++){const w=i[y];let S=0;for(let A=0;A<w.length;A+=4)w[A]===f[A]&&w[A+1]===f[A+1]&&w[A+2]===f[A+2]&&w[A+3]===f[A+3]&&(S+=1);d+=(l[y+2]-l[y+1])*(1-S/_)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ci.delete(this.painter.context.gl),ar.remove(),vt.remove(),this._removed=!0,this.fire(new a.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=a.o.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return a.bw(i,(l,d)=>l._preloadTiles(f,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){a.eX(f,i)}get version(){return R}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},yw,f),this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(a.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),J("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),J("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=J("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),l=i===f.getMaxZoom(),d=i===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xw(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const l=J("button",f,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(f,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.E{constructor(f={}){super();const i=navigator.geolocation;this.options=Object.assign({geolocation:i},$l,f),a.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>i(l.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),l=f.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new a.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("geolocate",f)),this._finish()}}_updateCamera(f){const i=new a.aR(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,d=this._map.getBearing(),_=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),_,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new a.aR(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=a.ce(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=J("button","mapboxgl-ctrl-geolocate",this._container),J("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=J("div","mapboxgl-user-location"),this._dotElement.appendChild(J("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(J("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new kc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=J("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:td,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Ja,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,d=i._containerWidth/2-f/2,_=i.unproject([d,l]),y=i.unproject([d+f,l]),w=_.distanceTo(y);if(this.options.unit==="imperial"){const S=3.2808*w;S>5280?this._setScale(f,S/5280,"mile"):this._setScale(f,S,"foot")}else this.options.unit==="nautical"?this._setScale(f,w/1852,"nautical-mile"):w>=1e3?this._setScale(f,w/1e3,"kilometer"):this._setScale(f,w,"meter")}_setScale(f,i,l){this._map._requestDomTask(()=>{const d=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const P=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*P)/P}(S),w*S}(i),_=d/i;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(d):`${d}&nbsp;${Qa[l]}`,this._container.style.width=f*_+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:a.w("Full screen control 'container' must be a DOM element.")),a.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=J("button","mapboxgl-ctrl-fullscreen",this._controlContainer);J("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:rd,Popup:class extends a.E{constructor(f){super(),this.options=Object.assign(Object.create(Rc),f),this._altitude=this.options.altitude,a.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new a.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new a.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=a.aR.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),l=document.createElement("body");let d;for(l.innerHTML=f;d=l.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=J("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const l=this._closeButton=J("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,d=this._pos;if(!i||!l||!d)return"bottom";const _=l.offsetWidth,y=l.offsetHeight,w=d.x<_/2,S=d.x>i.transform.width-_/2;if(d.y+f<y)return w?"top-left":S?"top-right":"top";if(d.y>i.transform.height-y){if(w)return"bottom-left";if(S)return"bottom-right"}return w?"left":S?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let d=this._container;if(d||(d=this._container=J("div","mapboxgl-popup",i.getContainer()),this._tip=J("div","mapboxgl-popup-tip",d),d.appendChild(l)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ip(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const _=this._pos=this._trackPointer&&f instanceof a.P?f:i.project(this._lngLat,this._altitude),y=Ny(this.options.offset),w=this._anchor=this._getAnchor(y.y),S=Ny(this.options.offset,w),A=_.add(S).round();i._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${od[w]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&i._showingGlobe()){const _=a.eY(i.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ca);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:kc,Style:Bo,LngLat:a.aR,LngLatBounds:a.aI,Point:a.P,MercatorCoordinate:a.ae,FreeCameraOptions:Lm,Evented:a.E,config:a.e,prewarm:a.f0,clearPrewarmedResources:a.e$,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(f){a.e.ACCESS_TOKEN=f},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(f){a.e.API_URL=f},get workerCount(){return a.f9.workerCount},set workerCount(f){a.f9.workerCount=f},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){a.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){a.f8(f)},get workerUrl(){return a.f7.workerUrl},set workerUrl(f){a.f7.workerUrl=f},get workerClass(){return a.f7.workerClass},set workerClass(f){a.f7.workerClass=f},get workerParams(){return a.f7.workerParams},set workerParams(f){a.f7.workerParams=f},get dracoUrl(){return a.f6()},set dracoUrl(f){a.f5(f)},get meshoptUrl(){return a.f4()},set meshoptUrl(f){a.f3(f)},setNow:a.o.setNow,restoreNow:a.o.restoreNow}});var T=m;return T})})(QM);var Ij=QM.exports;const Dg=pN(Ij),Cj="pk.eyJ1IjoibWFwaW5oYXMiLCJhIjoiY21naTh4M2VxMDZwODJzcHF3bGttdWl1diJ9.u29rHUnVjbfTPbgmNWW_cw";Dg.accessToken=Cj;function Pj(){const[t,r]=zt.useState([]),[s,u]=zt.useState(null),[m,v]=zt.useState(!0),[T,a]=zt.useState(""),R=zt.useRef(null),O=zt.useRef(null),B=zt.useRef({});zt.useEffect(()=>{H();const re=setInterval(H,1e4);return()=>{clearInterval(re),O.current&&(O.current.remove(),O.current=null)}},[]),zt.useEffect(()=>{if(!(!R.current||O.current))try{O.current=new Dg.Map({container:R.current,style:"mapbox://styles/mapbox/streets-v12",center:[-56.0974,-15.6014],zoom:6}),O.current.addControl(new Dg.NavigationControl,"top-right"),O.current.on("error",re=>{var J;console.error("Mapbox error:",re),a(`Erro no mapa: ${((J=re.error)==null?void 0:J.message)||"Desconhecido"}`)})}catch(re){console.error("Map initialization error:",re),a(`Erro ao inicializar: ${re.message}`)}},[R.current]);const H=async()=>{try{const[re,J]=await Promise.all([Qr.from("profiles").select("*").eq("role","employee"),Qr.from("active_sessions").select("*")]);if(re.error)throw re.error;const _e=re.data||[],pe=J.data||[],ue=_e.map(ie=>{const ke=pe.find(at=>at.user_id===ie.id);return{...ie,is_active:!!ke,last_location:ke!=null&&ke.current_lat&&(ke!=null&&ke.current_lng)?{lat:ke.current_lat,lng:ke.current_lng}:void 0}});r(ue),q(ue)}catch(re){console.error("Error loading employees:",re)}finally{v(!1)}},q=re=>{O.current&&(Object.values(B.current).forEach(J=>J.remove()),B.current={},re.forEach(J=>{var _e;if(J.last_location&&J.is_active&&O.current){const pe=document.createElement("div");pe.className="custom-marker",pe.innerHTML=`
          <div style="
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 3px solid white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            cursor: pointer;
          ">
            ${(_e=J.full_name)==null?void 0:_e.charAt(0).toUpperCase()}
          </div>
        `;const ue=new Dg.Marker(pe).setLngLat([J.last_location.lng,J.last_location.lat]).setPopup(new Dg.Popup({offset:25}).setHTML(`<div style="padding: 8px;">
                <strong>${J.full_name}</strong><br/>
                <small>${J.job_position||"Colaborador"}</small><br/>
                <span style="color: #10b981;">Ativo</span>
              </div>`)).addTo(O.current);B.current[J.id]=ue,pe.addEventListener("click",()=>{u(J.id)})}}))},ee=re=>{var J;re.is_active&&re.last_location&&O.current?(O.current.flyTo({center:[re.last_location.lng,re.last_location.lat],zoom:15,duration:2e3}),u(re.id),(J=B.current[re.id])==null||J.togglePopup()):re.is_active?re.last_location||alert("Localizao do colaborador no disponvel."):alert("Este colaborador no est ativo no momento.")};return m?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acompanhar Colaboradores"}),L.jsx("p",{className:"text-gray-600",children:"Localizao em tempo real dos colaboradores ativos"})]}),T&&L.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:[L.jsx("p",{className:"font-semibold",children:"Erro no Mapa"}),L.jsx("p",{className:"text-sm",children:T}),L.jsxs("p",{className:"text-xs mt-2",children:["Token configurado: ","Sim"]})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[L.jsx("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-lg overflow-hidden",style:{height:"600px"},children:L.jsx("div",{ref:R,style:{width:"100%",height:"100%"}})}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[L.jsx(y_,{className:"w-5 h-5 mr-2 text-amber-600"}),"Todos Colaboradores"]}),t.length===0?L.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhum colaborador cadastrado"}):L.jsx("div",{className:"space-y-3 max-h-[520px] overflow-y-auto",children:t.map(re=>{var J;return L.jsxs("div",{onClick:()=>ee(re),className:`p-4 rounded-lg transition cursor-pointer ${s===re.id?"bg-amber-50 border-2 border-amber-500":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"}`,children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${re.is_active?"bg-gradient-to-br from-green-500 to-emerald-600":"bg-gradient-to-br from-red-500 to-red-600"}`,children:(J=re.full_name)==null?void 0:J.charAt(0).toUpperCase()}),L.jsxs("div",{children:[L.jsx("p",{className:"font-semibold text-gray-800 text-sm",children:re.full_name}),L.jsx("p",{className:"text-xs text-gray-600",children:re.job_position||"Colaborador"})]})]}),re.is_active&&L.jsx(xj,{className:"w-4 h-4 text-amber-600"})]}),L.jsx("div",{className:"text-xs space-y-1",children:L.jsxs("p",{className:"flex items-center",children:[L.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${re.is_active?"bg-green-500 animate-pulse":"bg-red-500"}`}),L.jsx("span",{className:re.is_active?"text-green-600":"text-red-600",children:re.is_active?"Ativo":"Inativo"})]})})]},re.id)})})]})]})]})}function kj(){const[t,r]=zt.useState(!1),[s,u]=zt.useState(!1),[m,v]=zt.useState(""),[T,a]=zt.useState([]),[R,O]=zt.useState(null),[B,H]=zt.useState(null),[q,ee]=zt.useState(""),[re,J]=zt.useState({full_name:"",email:"",password:"",phone:"",job_position:"",work_hours:8,overtime_limit:30,photo_url:"",horario_entrada:"08:00",horario_saida_almoco:"12:00",horario_volta_almoco:"13:00",horario_saida:"17:00"});zt.useEffect(()=>{_e()},[]);const _e=async()=>{try{const{data:He,error:De}=await Qr.from("profiles").select("*").eq("role","employee").order("created_at",{ascending:!1});if(De)throw De;a(He||[])}catch(He){console.error("Error loading employees:",He)}},pe=He=>{var et;const De=(et=He.target.files)==null?void 0:et[0];if(De){H(De);const Ge=new FileReader;Ge.onloadend=()=>{ee(Ge.result)},Ge.readAsDataURL(De)}},ue=async(He,De)=>{try{const et=He.name.split(".").pop(),ft=`avatars/${`${De}-${Date.now()}.${et}`}`,{error:tt}=await Qr.storage.from("employee-photos").upload(ft,He);if(tt)throw tt;const{data:Ot}=Qr.storage.from("employee-photos").getPublicUrl(ft);return Ot.publicUrl}catch(et){return console.error("Error uploading photo:",et),null}},ie=async He=>{He.preventDefault(),r(!0),v(""),u(!1);try{if(R){let De=re.photo_url;if(B){const Ge=await ue(B,R);Ge&&(De=Ge)}const{error:et}=await Qr.from("profiles").update({full_name:re.full_name,phone:re.phone,job_position:re.job_position,work_hours:re.work_hours,overtime_limit:re.overtime_limit,photo_url:De,horario_entrada:re.horario_entrada,horario_saida_almoco:re.horario_saida_almoco,horario_volta_almoco:re.horario_volta_almoco,horario_saida:re.horario_saida,updated_at:new Date().toISOString()}).eq("id",R);if(et)throw et;u(!0),O(null)}else{const et=await fetch("https://ahpdojlajtfejmtjtwvr.supabase.co/functions/v1/create-employee",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFocGRvamxhanRmZWptdGp0d3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4OTQ2MjgsImV4cCI6MjA4MzQ3MDYyOH0.3EHVvsPFnDLm3AZVAm8AdpLIaW9IxLJ5at6VQNT82qk","Content-Type":"application/json"},body:JSON.stringify({email:re.email,password:re.password,full_name:re.full_name,phone:re.phone,job_position:re.job_position,work_hours:re.work_hours,overtime_limit:re.overtime_limit,photo_url:null,horario_entrada:re.horario_entrada,horario_saida_almoco:re.horario_saida_almoco,horario_volta_almoco:re.horario_volta_almoco,horario_saida:re.horario_saida})}),Ge=await et.json();if(!et.ok)throw new Error(Ge.error||"Erro ao cadastrar colaborador");if(B&&Ge.userId){const ft=await ue(B,Ge.userId);ft&&await Qr.from("profiles").update({photo_url:ft}).eq("id",Ge.userId)}u(!0)}J({full_name:"",email:"",password:"",phone:"",job_position:"",work_hours:8,overtime_limit:30,photo_url:"",horario_entrada:"08:00",horario_saida_almoco:"12:00",horario_volta_almoco:"13:00",horario_saida:"17:00"}),H(null),ee(""),_e(),setTimeout(()=>u(!1),5e3)}catch(De){v(De.message||"Erro ao salvar colaborador")}finally{r(!1)}},ke=He=>{O(He.id),J({full_name:He.full_name,email:"",password:"",phone:He.phone||"",job_position:He.job_position||"",work_hours:He.work_hours||8,overtime_limit:He.overtime_limit||30,photo_url:He.photo_url||"",horario_entrada:He.horario_entrada||"08:00",horario_saida_almoco:He.horario_saida_almoco||"12:00",horario_volta_almoco:He.horario_volta_almoco||"13:00",horario_saida:He.horario_saida||"17:00"}),ee(He.photo_url||""),window.scrollTo({top:0,behavior:"smooth"})},at=()=>{O(null),J({full_name:"",email:"",password:"",phone:"",job_position:"",work_hours:8,overtime_limit:30,photo_url:"",horario_entrada:"08:00",horario_saida_almoco:"12:00",horario_volta_almoco:"13:00",horario_saida:"17:00"}),H(null),ee("")};return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:R?"Editar Colaborador":"Cadastrar Colaborador"}),L.jsx("p",{className:"text-gray-600",children:R?"Atualize as informaes do colaborador":"Adicione um novo colaborador ao sistema"})]}),L.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-3xl",children:L.jsxs("form",{onSubmit:ie,className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),L.jsx("input",{type:"text",value:re.full_name,onChange:He=>J({...re,full_name:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"Joo Silva",required:!0})]}),!R&&L.jsxs(L.Fragment,{children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),L.jsx("input",{type:"email",value:re.email,onChange:He=>J({...re,email:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"joao@email.com",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha *"}),L.jsx("input",{type:"password",value:re.password,onChange:He=>J({...re,password:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"",required:!0,minLength:6})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),L.jsx("input",{type:"tel",value:re.phone,onChange:He=>J({...re,phone:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"(00) 00000-0000"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Funo"}),L.jsx("input",{type:"text",value:re.job_position,onChange:He=>J({...re,job_position:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:"Tcnico de Instalao"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horas de Trabalho Dirias *"}),L.jsx("input",{type:"number",value:re.work_hours,onChange:He=>J({...re,work_hours:parseInt(He.target.value)}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",min:"1",max:"12",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Limite de Horas Extras (h/ms) *"}),L.jsx("input",{type:"number",value:re.overtime_limit,onChange:He=>J({...re,overtime_limit:parseInt(He.target.value)}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",min:"0",max:"100",required:!0}),L.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Horas extras at este limite. Excedente vai para banco de horas."})]})]}),L.jsxs("div",{className:"border-t pt-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Horrios de Trabalho"}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horrio de Entrada *"}),L.jsx("input",{type:"time",value:re.horario_entrada,onChange:He=>J({...re,horario_entrada:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sada para Almoo *"}),L.jsx("input",{type:"time",value:re.horario_saida_almoco,onChange:He=>J({...re,horario_saida_almoco:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Volta do Almoo *"}),L.jsx("input",{type:"time",value:re.horario_volta_almoco,onChange:He=>J({...re,horario_volta_almoco:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",required:!0})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horrio de Sada *"}),L.jsx("input",{type:"time",value:re.horario_saida,onChange:He=>J({...re,horario_saida:He.target.value}),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",required:!0})]})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Foto do Colaborador (opcional)"}),L.jsxs("div",{className:"flex items-center space-x-4",children:[q&&L.jsx("img",{src:q,alt:"Preview",className:"w-16 h-16 rounded-full object-cover"}),L.jsxs("label",{className:"flex-1 flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-amber-500 transition",children:[L.jsx(__,{className:"w-5 h-5 text-gray-400 mr-2"}),L.jsx("span",{className:"text-gray-600",children:"Selecionar Foto"}),L.jsx("input",{type:"file",accept:"image/*",onChange:pe,className:"hidden"})]})]})]}),m&&L.jsxs("div",{className:"bg-red-50 text-red-600 px-4 py-3 rounded-lg text-sm flex items-center justify-between",children:[L.jsx("span",{children:m}),L.jsx("button",{onClick:()=>v(""),className:"text-red-800 hover:text-red-900",children:L.jsx(Kc,{className:"w-4 h-4"})})]}),s&&L.jsxs("div",{className:"bg-green-50 text-green-600 px-4 py-3 rounded-lg text-sm flex items-center justify-between",children:[L.jsx("span",{children:"Colaborador cadastrado com sucesso!"}),L.jsx("button",{onClick:()=>u(!1),className:"text-green-800 hover:text-green-900",children:L.jsx(Kc,{className:"w-4 h-4"})})]}),L.jsxs("div",{className:"flex space-x-3",children:[L.jsxs("button",{type:"submit",disabled:t,className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 rounded-lg font-semibold hover:from-amber-600 hover:to-orange-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[R?L.jsx(PT,{className:"w-5 h-5"}):L.jsx(Tj,{className:"w-5 h-5"}),L.jsx("span",{children:t?"Salvando...":R?"Atualizar":"Cadastrar"})]}),R&&L.jsx("button",{type:"button",onClick:at,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition",children:"Cancelar"})]})]})}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[L.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Colaboradores Cadastrados"}),T.length===0?L.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhum colaborador cadastrado"}):L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(He=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[He.photo_url?L.jsx("img",{src:He.photo_url,alt:He.full_name,className:"w-12 h-12 rounded-full object-cover"}):L.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold",children:He.full_name.charAt(0).toUpperCase()}),L.jsxs("div",{className:"flex-1",children:[L.jsx("p",{className:"font-semibold text-gray-800",children:He.full_name}),L.jsx("p",{className:"text-sm text-gray-600",children:He.job_position||"Colaborador"})]})]}),L.jsxs("div",{className:"space-y-1 text-sm text-gray-600 mb-3",children:[He.phone&&L.jsxs("p",{children:["Tel: ",He.phone]}),L.jsxs("p",{children:["Horas: ",He.work_hours,"h/dia"]})]}),L.jsxs("button",{onClick:()=>ke(He),className:"w-full bg-amber-50 text-amber-700 py-2 rounded-lg font-medium hover:bg-amber-100 transition flex items-center justify-center space-x-2",children:[L.jsx(PT,{className:"w-4 h-4"}),L.jsx("span",{children:"Editar"})]})]},He.id))})]})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var qv={};qv.version="0.18.5";var tD=1252,Rj=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],rD=function(t){Rj.indexOf(t)!=-1&&(tD=t)};function Mj(){rD(1252)}var x_=function(t){rD(t)};function Dj(){x_(1200),Mj()}var Qx=function(r){return String.fromCharCode(r)},b3=function(r){return String.fromCharCode(r)},vd,rh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function v_(t){for(var r="",s=0,u=0,m=0,v=0,T=0,a=0,R=0,O=0;O<t.length;)s=t.charCodeAt(O++),v=s>>2,u=t.charCodeAt(O++),T=(s&3)<<4|u>>4,m=t.charCodeAt(O++),a=(u&15)<<2|m>>6,R=m&63,isNaN(u)?a=R=64:isNaN(m)&&(R=64),r+=rh.charAt(v)+rh.charAt(T)+rh.charAt(a)+rh.charAt(R);return r}function Yc(t){var r="",s=0,u=0,m=0,v=0,T=0,a=0,R=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var O=0;O<t.length;)v=rh.indexOf(t.charAt(O++)),T=rh.indexOf(t.charAt(O++)),s=v<<2|T>>4,r+=String.fromCharCode(s),a=rh.indexOf(t.charAt(O++)),u=(T&15)<<4|a>>2,a!==64&&(r+=String.fromCharCode(u)),R=rh.indexOf(t.charAt(O++)),m=(a&3)<<6|R,R!==64&&(r+=String.fromCharCode(m));return r}var fn=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),eu=function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(r,s){return s?new Buffer(r,s):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function Od(t){return fn?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function T3(t){return fn?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var ml=function(r){return fn?eu(r,"binary"):r.split("").map(function(s){return s.charCodeAt(0)&255})};function P1(t){if(typeof ArrayBuffer>"u")return ml(t);for(var r=new ArrayBuffer(t.length),s=new Uint8Array(r),u=0;u!=t.length;++u)s[u]=t.charCodeAt(u)&255;return r}function D_(t){if(Array.isArray(t))return t.map(function(u){return String.fromCharCode(u)}).join("");for(var r=[],s=0;s<t.length;++s)r[s]=String.fromCharCode(t[s]);return r.join("")}function Oj(t){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(t)}var Ks=fn?function(t){return Buffer.concat(t.map(function(r){return Buffer.isBuffer(r)?r:eu(r)}))}:function(t){if(typeof Uint8Array<"u"){var r=0,s=0;for(r=0;r<t.length;++r)s+=t[r].length;var u=new Uint8Array(s),m=0;for(r=0,s=0;r<t.length;s+=m,++r)if(m=t[r].length,t[r]instanceof Uint8Array)u.set(t[r],s);else{if(typeof t[r]=="string")throw"wtf";u.set(new Uint8Array(t[r]),s)}return u}return[].concat.apply([],t.map(function(v){return Array.isArray(v)?v:[].slice.call(v)}))};function Lj(t){for(var r=[],s=0,u=t.length+250,m=Od(t.length+255),v=0;v<t.length;++v){var T=t.charCodeAt(v);if(T<128)m[s++]=T;else if(T<2048)m[s++]=192|T>>6&31,m[s++]=128|T&63;else if(T>=55296&&T<57344){T=(T&1023)+64;var a=t.charCodeAt(++v)&1023;m[s++]=240|T>>8&7,m[s++]=128|T>>2&63,m[s++]=128|a>>6&15|(T&3)<<4,m[s++]=128|a&63}else m[s++]=224|T>>12&15,m[s++]=128|T>>6&63,m[s++]=128|T&63;s>u&&(r.push(m.slice(0,s)),s=0,m=Od(65535),u=65530)}return r.push(m.slice(0,s)),Ks(r)}var qg=/\u0000/g,ev=/[\u0001-\u0006]/g;function tm(t){for(var r="",s=t.length-1;s>=0;)r+=t.charAt(s--);return r}function gl(t,r){var s=""+t;return s.length>=r?s:ns("0",r-s.length)+s}function LS(t,r){var s=""+t;return s.length>=r?s:ns(" ",r-s.length)+s}function Zv(t,r){var s=""+t;return s.length>=r?s:s+ns(" ",r-s.length)}function Fj(t,r){var s=""+Math.round(t);return s.length>=r?s:ns("0",r-s.length)+s}function Nj(t,r){var s=""+t;return s.length>=r?s:ns("0",r-s.length)+s}var S3=Math.pow(2,32);function Pp(t,r){if(t>S3||t<-S3)return Fj(t,r);var s=Math.round(t);return Nj(s,r)}function Xv(t,r){return r=r||0,t.length>=7+r&&(t.charCodeAt(r)|32)===103&&(t.charCodeAt(r+1)|32)===101&&(t.charCodeAt(r+2)|32)===110&&(t.charCodeAt(r+3)|32)===101&&(t.charCodeAt(r+4)|32)===114&&(t.charCodeAt(r+5)|32)===97&&(t.charCodeAt(r+6)|32)===108}var E3=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],g2=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function zj(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"/ "hh""mm""ss" "',t}var ss={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},A3={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Bj={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Kv(t,r,s){for(var u=t<0?-1:1,m=t*u,v=0,T=1,a=0,R=1,O=0,B=0,H=Math.floor(m);O<r&&(H=Math.floor(m),a=H*T+v,B=H*O+R,!(m-H<5e-8));)m=1/(m-H),v=T,T=a,R=O,O=B;if(B>r&&(O>r?(B=R,a=v):(B=O,a=T)),!s)return[0,u*a,B];var q=Math.floor(u*a/B);return[q,u*a-q*B,B]}function tv(t,r,s){if(t>2958465||t<0)return null;var u=t|0,m=Math.floor(86400*(t-u)),v=0,T=[],a={D:u,T:m,u:86400*(t-u)-m,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(a.u)<1e-6&&(a.u=0),r&&r.date1904&&(u+=1462),a.u>.9999&&(a.u=0,++m==86400&&(a.T=m=0,++u,++a.D)),u===60)T=s?[1317,10,29]:[1900,2,29],v=3;else if(u===0)T=s?[1317,8,29]:[1900,1,0],v=6;else{u>60&&--u;var R=new Date(1900,0,1);R.setDate(R.getDate()+u-1),T=[R.getFullYear(),R.getMonth()+1,R.getDate()],v=R.getDay(),u<60&&(v=(v+6)%7),s&&(v=Wj(R,T))}return a.y=T[0],a.m=T[1],a.d=T[2],a.S=m%60,m=Math.floor(m/60),a.M=m%60,m=Math.floor(m/60),a.H=m,a.q=v,a}var iD=new Date(1899,11,31,0,0,0),jj=iD.getTime(),Uj=new Date(1900,2,1,0,0,0);function nD(t,r){var s=t.getTime();return r?s-=1461*24*60*60*1e3:t>=Uj&&(s+=24*60*60*1e3),(s-(jj+(t.getTimezoneOffset()-iD.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function FS(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Vj(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function $j(t){var r=t<0?12:11,s=FS(t.toFixed(12));return s.length<=r||(s=t.toPrecision(10),s.length<=r)?s:t.toExponential(5)}function Gj(t){var r=FS(t.toFixed(11));return r.length>(t<0?12:11)||r==="0"||r==="-0"?t.toPrecision(6):r}function Hj(t){var r=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),s;return r>=-4&&r<=-1?s=t.toPrecision(10+r):Math.abs(r)<=9?s=$j(t):r===10?s=t.toFixed(10).substr(0,12):s=Gj(t),FS(Vj(s.toUpperCase()))}function kT(t,r){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):Hj(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return ph(14,nD(t,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+t)}function Wj(t,r){r[0]-=581;var s=t.getDay();return t<60&&(s=(s+6)%7),s}function qj(t,r,s,u){var m="",v=0,T=0,a=s.y,R,O=0;switch(t){case 98:a=s.y+543;case 121:switch(r.length){case 1:case 2:R=a%100,O=2;break;default:R=a%1e4,O=4;break}break;case 109:switch(r.length){case 1:case 2:R=s.m,O=r.length;break;case 3:return g2[s.m-1][1];case 5:return g2[s.m-1][0];default:return g2[s.m-1][2]}break;case 100:switch(r.length){case 1:case 2:R=s.d,O=r.length;break;case 3:return E3[s.q][0];default:return E3[s.q][1]}break;case 104:switch(r.length){case 1:case 2:R=1+(s.H+11)%12,O=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:R=s.H,O=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:R=s.M,O=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return s.u===0&&(r=="s"||r=="ss")?gl(s.S,r.length):(u>=2?T=u===3?1e3:100:T=u===1?10:1,v=Math.round(T*(s.S+s.u)),v>=60*T&&(v=0),r==="s"?v===0?"0":""+v/T:(m=gl(v,2+u),r==="ss"?m.substr(0,2):"."+m.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":R=s.D*24+s.H;break;case"[m]":case"[mm]":R=(s.D*24+s.H)*60+s.M;break;case"[s]":case"[ss]":R=((s.D*24+s.H)*60+s.M)*60+Math.round(s.S+s.u);break;default:throw"bad abstime format: "+r}O=r.length===3?1:2;break;case 101:R=a,O=1;break}var B=O>0?gl(R,O):"";return B}function ih(t){var r=3;if(t.length<=r)return t;for(var s=t.length%r,u=t.substr(0,s);s!=t.length;s+=r)u+=(u.length>0?",":"")+t.substr(s,r);return u}var sD=/%/g;function Zj(t,r,s){var u=r.replace(sD,""),m=r.length-u.length;return $c(t,u,s*Math.pow(10,2*m))+ns("%",m)}function Xj(t,r,s){for(var u=r.length-1;r.charCodeAt(u-1)===44;)--u;return $c(t,r.substr(0,u),s/Math.pow(10,3*(r.length-u)))}function oD(t,r){var s,u=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+oD(t,-r);var m=t.indexOf(".");m===-1&&(m=t.indexOf("E"));var v=Math.floor(Math.log(r)*Math.LOG10E)%m;if(v<0&&(v+=m),s=(r/Math.pow(10,v)).toPrecision(u+1+(m+v)%m),s.indexOf("e")===-1){var T=Math.floor(Math.log(r)*Math.LOG10E);for(s.indexOf(".")===-1?s=s.charAt(0)+"."+s.substr(1)+"E+"+(T-s.length+v):s+="E+"+(T-v);s.substr(0,2)==="0.";)s=s.charAt(0)+s.substr(2,m)+"."+s.substr(2+m),s=s.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(a,R,O,B){return R+O+B.substr(0,(m+v)%m)+"."+B.substr(v)+"E"})}else s=r.toExponential(u);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}var aD=/# (\?+)( ?)\/( ?)(\d+)/;function Kj(t,r,s){var u=parseInt(t[4],10),m=Math.round(r*u),v=Math.floor(m/u),T=m-v*u,a=u;return s+(v===0?"":""+v)+" "+(T===0?ns(" ",t[1].length+1+t[4].length):LS(T,t[1].length)+t[2]+"/"+t[3]+gl(a,t[4].length))}function Yj(t,r,s){return s+(r===0?"":""+r)+ns(" ",t[1].length+2+t[4].length)}var lD=/^#*0*\.([0#]+)/,cD=/\).*[0#]/,uD=/\(###\) ###\\?-####/;function Mo(t){for(var r="",s,u=0;u!=t.length;++u)switch(s=t.charCodeAt(u)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(s)}return r}function I3(t,r){var s=Math.pow(10,r);return""+Math.round(t*s)/s}function C3(t,r){var s=t-Math.floor(t),u=Math.pow(10,r);return r<(""+Math.round(s*u)).length?0:Math.round(s*u)}function Jj(t,r){return r<(""+Math.round((t-Math.floor(t))*Math.pow(10,r))).length?1:0}function Qj(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function Na(t,r,s){if(t.charCodeAt(0)===40&&!r.match(cD)){var u=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return s>=0?Na("n",u,s):"("+Na("n",u,-s)+")"}if(r.charCodeAt(r.length-1)===44)return Xj(t,r,s);if(r.indexOf("%")!==-1)return Zj(t,r,s);if(r.indexOf("E")!==-1)return oD(r,s);if(r.charCodeAt(0)===36)return"$"+Na(t,r.substr(r.charAt(1)==" "?2:1),s);var m,v,T,a,R=Math.abs(s),O=s<0?"-":"";if(r.match(/^00+$/))return O+Pp(R,r.length);if(r.match(/^[#?]+$/))return m=Pp(s,0),m==="0"&&(m=""),m.length>r.length?m:Mo(r.substr(0,r.length-m.length))+m;if(v=r.match(aD))return Kj(v,R,O);if(r.match(/^#+0+$/))return O+Pp(R,r.length-r.indexOf("0"));if(v=r.match(lD))return m=I3(s,v[1].length).replace(/^([^\.]+)$/,"$1."+Mo(v[1])).replace(/\.$/,"."+Mo(v[1])).replace(/\.(\d*)$/,function(re,J){return"."+J+ns("0",Mo(v[1]).length-J.length)}),r.indexOf("0.")!==-1?m:m.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),v=r.match(/^(0*)\.(#*)$/))return O+I3(R,v[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,v[1].length?"0.":".");if(v=r.match(/^#{1,3},##0(\.?)$/))return O+ih(Pp(R,0));if(v=r.match(/^#,##0\.([#0]*0)$/))return s<0?"-"+Na(t,r,-s):ih(""+(Math.floor(s)+Jj(s,v[1].length)))+"."+gl(C3(s,v[1].length),v[1].length);if(v=r.match(/^#,#*,#0/))return Na(t,r.replace(/^#,#*,/,""),s);if(v=r.match(/^([0#]+)(\\?-([0#]+))+$/))return m=tm(Na(t,r.replace(/[\\-]/g,""),s)),T=0,tm(tm(r.replace(/\\/g,"")).replace(/[0#]/g,function(re){return T<m.length?m.charAt(T++):re==="0"?"0":""}));if(r.match(uD))return m=Na(t,"##########",s),"("+m.substr(0,3)+") "+m.substr(3,3)+"-"+m.substr(6);var B="";if(v=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return T=Math.min(v[4].length,7),a=Kv(R,Math.pow(10,T)-1,!1),m=""+O,B=$c("n",v[1],a[1]),B.charAt(B.length-1)==" "&&(B=B.substr(0,B.length-1)+"0"),m+=B+v[2]+"/"+v[3],B=Zv(a[2],T),B.length<v[4].length&&(B=Mo(v[4].substr(v[4].length-B.length))+B),m+=B,m;if(v=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return T=Math.min(Math.max(v[1].length,v[4].length),7),a=Kv(R,Math.pow(10,T)-1,!0),O+(a[0]||(a[1]?"":"0"))+" "+(a[1]?LS(a[1],T)+v[2]+"/"+v[3]+Zv(a[2],T):ns(" ",2*T+1+v[2].length+v[3].length));if(v=r.match(/^[#0?]+$/))return m=Pp(s,0),r.length<=m.length?m:Mo(r.substr(0,r.length-m.length))+m;if(v=r.match(/^([#0?]+)\.([#0]+)$/)){m=""+s.toFixed(Math.min(v[2].length,10)).replace(/([^0])0+$/,"$1"),T=m.indexOf(".");var H=r.indexOf(".")-T,q=r.length-m.length-H;return Mo(r.substr(0,H)+m+r.substr(r.length-q))}if(v=r.match(/^00,000\.([#0]*0)$/))return T=C3(s,v[1].length),s<0?"-"+Na(t,r,-s):ih(Qj(s)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(re){return"00,"+(re.length<3?gl(0,3-re.length):"")+re})+"."+gl(T,v[1].length);switch(r){case"###,##0.00":return Na(t,"#,##0.00",s);case"###,###":case"##,###":case"#,###":var ee=ih(Pp(R,0));return ee!=="0"?O+ee:"";case"###,###.00":return Na(t,"###,##0.00",s).replace(/^0\./,".");case"#,###.00":return Na(t,"#,##0.00",s).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function e8(t,r,s){for(var u=r.length-1;r.charCodeAt(u-1)===44;)--u;return $c(t,r.substr(0,u),s/Math.pow(10,3*(r.length-u)))}function t8(t,r,s){var u=r.replace(sD,""),m=r.length-u.length;return $c(t,u,s*Math.pow(10,2*m))+ns("%",m)}function hD(t,r){var s,u=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+hD(t,-r);var m=t.indexOf(".");m===-1&&(m=t.indexOf("E"));var v=Math.floor(Math.log(r)*Math.LOG10E)%m;if(v<0&&(v+=m),s=(r/Math.pow(10,v)).toPrecision(u+1+(m+v)%m),!s.match(/[Ee]/)){var T=Math.floor(Math.log(r)*Math.LOG10E);s.indexOf(".")===-1?s=s.charAt(0)+"."+s.substr(1)+"E+"+(T-s.length+v):s+="E+"+(T-v),s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(a,R,O,B){return R+O+B.substr(0,(m+v)%m)+"."+B.substr(v)+"E"})}else s=r.toExponential(u);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}function Jl(t,r,s){if(t.charCodeAt(0)===40&&!r.match(cD)){var u=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return s>=0?Jl("n",u,s):"("+Jl("n",u,-s)+")"}if(r.charCodeAt(r.length-1)===44)return e8(t,r,s);if(r.indexOf("%")!==-1)return t8(t,r,s);if(r.indexOf("E")!==-1)return hD(r,s);if(r.charCodeAt(0)===36)return"$"+Jl(t,r.substr(r.charAt(1)==" "?2:1),s);var m,v,T,a,R=Math.abs(s),O=s<0?"-":"";if(r.match(/^00+$/))return O+gl(R,r.length);if(r.match(/^[#?]+$/))return m=""+s,s===0&&(m=""),m.length>r.length?m:Mo(r.substr(0,r.length-m.length))+m;if(v=r.match(aD))return Yj(v,R,O);if(r.match(/^#+0+$/))return O+gl(R,r.length-r.indexOf("0"));if(v=r.match(lD))return m=(""+s).replace(/^([^\.]+)$/,"$1."+Mo(v[1])).replace(/\.$/,"."+Mo(v[1])),m=m.replace(/\.(\d*)$/,function(re,J){return"."+J+ns("0",Mo(v[1]).length-J.length)}),r.indexOf("0.")!==-1?m:m.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),v=r.match(/^(0*)\.(#*)$/))return O+(""+R).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,v[1].length?"0.":".");if(v=r.match(/^#{1,3},##0(\.?)$/))return O+ih(""+R);if(v=r.match(/^#,##0\.([#0]*0)$/))return s<0?"-"+Jl(t,r,-s):ih(""+s)+"."+ns("0",v[1].length);if(v=r.match(/^#,#*,#0/))return Jl(t,r.replace(/^#,#*,/,""),s);if(v=r.match(/^([0#]+)(\\?-([0#]+))+$/))return m=tm(Jl(t,r.replace(/[\\-]/g,""),s)),T=0,tm(tm(r.replace(/\\/g,"")).replace(/[0#]/g,function(re){return T<m.length?m.charAt(T++):re==="0"?"0":""}));if(r.match(uD))return m=Jl(t,"##########",s),"("+m.substr(0,3)+") "+m.substr(3,3)+"-"+m.substr(6);var B="";if(v=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return T=Math.min(v[4].length,7),a=Kv(R,Math.pow(10,T)-1,!1),m=""+O,B=$c("n",v[1],a[1]),B.charAt(B.length-1)==" "&&(B=B.substr(0,B.length-1)+"0"),m+=B+v[2]+"/"+v[3],B=Zv(a[2],T),B.length<v[4].length&&(B=Mo(v[4].substr(v[4].length-B.length))+B),m+=B,m;if(v=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return T=Math.min(Math.max(v[1].length,v[4].length),7),a=Kv(R,Math.pow(10,T)-1,!0),O+(a[0]||(a[1]?"":"0"))+" "+(a[1]?LS(a[1],T)+v[2]+"/"+v[3]+Zv(a[2],T):ns(" ",2*T+1+v[2].length+v[3].length));if(v=r.match(/^[#0?]+$/))return m=""+s,r.length<=m.length?m:Mo(r.substr(0,r.length-m.length))+m;if(v=r.match(/^([#0]+)\.([#0]+)$/)){m=""+s.toFixed(Math.min(v[2].length,10)).replace(/([^0])0+$/,"$1"),T=m.indexOf(".");var H=r.indexOf(".")-T,q=r.length-m.length-H;return Mo(r.substr(0,H)+m+r.substr(r.length-q))}if(v=r.match(/^00,000\.([#0]*0)$/))return s<0?"-"+Jl(t,r,-s):ih(""+s).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(re){return"00,"+(re.length<3?gl(0,3-re.length):"")+re})+"."+gl(0,v[1].length);switch(r){case"###,###":case"##,###":case"#,###":var ee=ih(""+R);return ee!=="0"?O+ee:"";default:if(r.match(/\.[0#?]*$/))return Jl(t,r.slice(0,r.lastIndexOf(".")),s)+Mo(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function $c(t,r,s){return(s|0)===s?Jl(t,r,s):Na(t,r,s)}function r8(t){for(var r=[],s=!1,u=0,m=0;u<t.length;++u)switch(t.charCodeAt(u)){case 34:s=!s;break;case 95:case 42:case 92:++u;break;case 59:r[r.length]=t.substr(m,u-m),m=u+1}if(r[r.length]=t.substr(m),s===!0)throw new Error("Format |"+t+"| unterminated string ");return r}var dD=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fD(t){for(var r=0,s="",u="";r<t.length;)switch(s=t.charAt(r)){case"G":Xv(t,r)&&(r+=6),r++;break;case'"':for(;t.charCodeAt(++r)!==34&&r<t.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(t.charAt(r+1)==="1"||t.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(t.substr(r,3).toUpperCase()==="A/P"||t.substr(r,5).toUpperCase()==="AM/PM"||t.substr(r,5).toUpperCase()==="/")return!0;++r;break;case"[":for(u=s;t.charAt(r++)!=="]"&&r<t.length;)u+=t.charAt(r);if(u.match(dD))return!0;break;case".":case"0":case"#":for(;r<t.length&&("0#?.,E+-%".indexOf(s=t.charAt(++r))>-1||s=="\\"&&t.charAt(r+1)=="-"&&"0#".indexOf(t.charAt(r+2))>-1););break;case"?":for(;t.charAt(++r)===s;);break;case"*":++r,(t.charAt(r)==" "||t.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<t.length&&"0123456789".indexOf(t.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function i8(t,r,s,u){for(var m=[],v="",T=0,a="",R="t",O,B,H,q="H";T<t.length;)switch(a=t.charAt(T)){case"G":if(!Xv(t,T))throw new Error("unrecognized character "+a+" in "+t);m[m.length]={t:"G",v:"General"},T+=7;break;case'"':for(v="";(H=t.charCodeAt(++T))!==34&&T<t.length;)v+=String.fromCharCode(H);m[m.length]={t:"t",v},++T;break;case"\\":var ee=t.charAt(++T),re=ee==="("||ee===")"?ee:"t";m[m.length]={t:re,v:ee},++T;break;case"_":m[m.length]={t:"t",v:" "},T+=2;break;case"@":m[m.length]={t:"T",v:r},++T;break;case"B":case"b":if(t.charAt(T+1)==="1"||t.charAt(T+1)==="2"){if(O==null&&(O=tv(r,s,t.charAt(T+1)==="2"),O==null))return"";m[m.length]={t:"X",v:t.substr(T,2)},R=a,T+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":a=a.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||O==null&&(O=tv(r,s),O==null))return"";for(v=a;++T<t.length&&t.charAt(T).toLowerCase()===a;)v+=a;a==="m"&&R.toLowerCase()==="h"&&(a="M"),a==="h"&&(a=q),m[m.length]={t:a,v},R=a;break;case"A":case"a":case"":var J={t:a,v:a};if(O==null&&(O=tv(r,s)),t.substr(T,3).toUpperCase()==="A/P"?(O!=null&&(J.v=O.H>=12?"P":"A"),J.t="T",q="h",T+=3):t.substr(T,5).toUpperCase()==="AM/PM"?(O!=null&&(J.v=O.H>=12?"PM":"AM"),J.t="T",T+=5,q="h"):t.substr(T,5).toUpperCase()==="/"?(O!=null&&(J.v=O.H>=12?"":""),J.t="T",T+=5,q="h"):(J.t="t",++T),O==null&&J.t==="T")return"";m[m.length]=J,R=a;break;case"[":for(v=a;t.charAt(T++)!=="]"&&T<t.length;)v+=t.charAt(T);if(v.slice(-1)!=="]")throw'unterminated "[" block: |'+v+"|";if(v.match(dD)){if(O==null&&(O=tv(r,s),O==null))return"";m[m.length]={t:"Z",v:v.toLowerCase()},R=v.charAt(1)}else v.indexOf("$")>-1&&(v=(v.match(/\$([^-\[\]]*)/)||[])[1]||"$",fD(t)||(m[m.length]={t:"t",v}));break;case".":if(O!=null){for(v=a;++T<t.length&&(a=t.charAt(T))==="0";)v+=a;m[m.length]={t:"s",v};break}case"0":case"#":for(v=a;++T<t.length&&"0#?.,E+-%".indexOf(a=t.charAt(T))>-1;)v+=a;m[m.length]={t:"n",v};break;case"?":for(v=a;t.charAt(++T)===a;)v+=a;m[m.length]={t:a,v},R=a;break;case"*":++T,(t.charAt(T)==" "||t.charAt(T)=="*")&&++T;break;case"(":case")":m[m.length]={t:u===1?"t":a,v:a},++T;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(v=a;T<t.length&&"0123456789".indexOf(t.charAt(++T))>-1;)v+=t.charAt(T);m[m.length]={t:"D",v};break;case" ":m[m.length]={t:a,v:a},++T;break;case"$":m[m.length]={t:"t",v:"$"},++T;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(a)===-1)throw new Error("unrecognized character "+a+" in "+t);m[m.length]={t:"t",v:a},++T;break}var _e=0,pe=0,ue;for(T=m.length-1,R="t";T>=0;--T)switch(m[T].t){case"h":case"H":m[T].t=q,R="h",_e<1&&(_e=1);break;case"s":(ue=m[T].v.match(/\.0+$/))&&(pe=Math.max(pe,ue[0].length-1)),_e<3&&(_e=3);case"d":case"y":case"M":case"e":R=m[T].t;break;case"m":R==="s"&&(m[T].t="M",_e<2&&(_e=2));break;case"X":break;case"Z":_e<1&&m[T].v.match(/[Hh]/)&&(_e=1),_e<2&&m[T].v.match(/[Mm]/)&&(_e=2),_e<3&&m[T].v.match(/[Ss]/)&&(_e=3)}switch(_e){case 0:break;case 1:O.u>=.5&&(O.u=0,++O.S),O.S>=60&&(O.S=0,++O.M),O.M>=60&&(O.M=0,++O.H);break;case 2:O.u>=.5&&(O.u=0,++O.S),O.S>=60&&(O.S=0,++O.M);break}var ie="",ke;for(T=0;T<m.length;++T)switch(m[T].t){case"t":case"T":case" ":case"D":break;case"X":m[T].v="",m[T].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":m[T].v=qj(m[T].t.charCodeAt(0),m[T].v,O,pe),m[T].t="t";break;case"n":case"?":for(ke=T+1;m[ke]!=null&&((a=m[ke].t)==="?"||a==="D"||(a===" "||a==="t")&&m[ke+1]!=null&&(m[ke+1].t==="?"||m[ke+1].t==="t"&&m[ke+1].v==="/")||m[T].t==="("&&(a===" "||a==="n"||a===")")||a==="t"&&(m[ke].v==="/"||m[ke].v===" "&&m[ke+1]!=null&&m[ke+1].t=="?"));)m[T].v+=m[ke].v,m[ke]={v:"",t:";"},++ke;ie+=m[T].v,T=ke-1;break;case"G":m[T].t="t",m[T].v=kT(r,s);break}var at="",He,De;if(ie.length>0){ie.charCodeAt(0)==40?(He=r<0&&ie.charCodeAt(0)===45?-r:r,De=$c("n",ie,He)):(He=r<0&&u>1?-r:r,De=$c("n",ie,He),He<0&&m[0]&&m[0].t=="t"&&(De=De.substr(1),m[0].v="-"+m[0].v)),ke=De.length-1;var et=m.length;for(T=0;T<m.length;++T)if(m[T]!=null&&m[T].t!="t"&&m[T].v.indexOf(".")>-1){et=T;break}var Ge=m.length;if(et===m.length&&De.indexOf("E")===-1){for(T=m.length-1;T>=0;--T)m[T]==null||"n?".indexOf(m[T].t)===-1||(ke>=m[T].v.length-1?(ke-=m[T].v.length,m[T].v=De.substr(ke+1,m[T].v.length)):ke<0?m[T].v="":(m[T].v=De.substr(0,ke+1),ke=-1),m[T].t="t",Ge=T);ke>=0&&Ge<m.length&&(m[Ge].v=De.substr(0,ke+1)+m[Ge].v)}else if(et!==m.length&&De.indexOf("E")===-1){for(ke=De.indexOf(".")-1,T=et;T>=0;--T)if(!(m[T]==null||"n?".indexOf(m[T].t)===-1)){for(B=m[T].v.indexOf(".")>-1&&T===et?m[T].v.indexOf(".")-1:m[T].v.length-1,at=m[T].v.substr(B+1);B>=0;--B)ke>=0&&(m[T].v.charAt(B)==="0"||m[T].v.charAt(B)==="#")&&(at=De.charAt(ke--)+at);m[T].v=at,m[T].t="t",Ge=T}for(ke>=0&&Ge<m.length&&(m[Ge].v=De.substr(0,ke+1)+m[Ge].v),ke=De.indexOf(".")+1,T=et;T<m.length;++T)if(!(m[T]==null||"n?(".indexOf(m[T].t)===-1&&T!==et)){for(B=m[T].v.indexOf(".")>-1&&T===et?m[T].v.indexOf(".")+1:0,at=m[T].v.substr(0,B);B<m[T].v.length;++B)ke<De.length&&(at+=De.charAt(ke++));m[T].v=at,m[T].t="t",Ge=T}}}for(T=0;T<m.length;++T)m[T]!=null&&"n?".indexOf(m[T].t)>-1&&(He=u>1&&r<0&&T>0&&m[T-1].v==="-"?-r:r,m[T].v=$c(m[T].t,m[T].v,He),m[T].t="t");var ft="";for(T=0;T!==m.length;++T)m[T]!=null&&(ft+=m[T].v);return ft}var P3=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function k3(t,r){if(r==null)return!1;var s=parseFloat(r[2]);switch(r[1]){case"=":if(t==s)return!0;break;case">":if(t>s)return!0;break;case"<":if(t<s)return!0;break;case"<>":if(t!=s)return!0;break;case">=":if(t>=s)return!0;break;case"<=":if(t<=s)return!0;break}return!1}function n8(t,r){var s=r8(t),u=s.length,m=s[u-1].indexOf("@");if(u<4&&m>-1&&--u,s.length>4)throw new Error("cannot find right format for |"+s.join("|")+"|");if(typeof r!="number")return[4,s.length===4||m>-1?s[s.length-1]:"@"];switch(s.length){case 1:s=m>-1?["General","General","General",s[0]]:[s[0],s[0],s[0],"@"];break;case 2:s=m>-1?[s[0],s[0],s[0],s[1]]:[s[0],s[1],s[0],"@"];break;case 3:s=m>-1?[s[0],s[1],s[0],s[2]]:[s[0],s[1],s[2],"@"];break}var v=r>0?s[0]:r<0?s[1]:s[2];if(s[0].indexOf("[")===-1&&s[1].indexOf("[")===-1)return[u,v];if(s[0].match(/\[[=<>]/)!=null||s[1].match(/\[[=<>]/)!=null){var T=s[0].match(P3),a=s[1].match(P3);return k3(r,T)?[u,s[0]]:k3(r,a)?[u,s[1]]:[u,s[T!=null&&a!=null?2:1]]}return[u,v]}function ph(t,r,s){s==null&&(s={});var u="";switch(typeof t){case"string":t=="m/d/yy"&&s.dateNF?u=s.dateNF:u=t;break;case"number":t==14&&s.dateNF?u=s.dateNF:u=(s.table!=null?s.table:ss)[t],u==null&&(u=s.table&&s.table[A3[t]]||ss[A3[t]]),u==null&&(u=Bj[t]||"General");break}if(Xv(u,0))return kT(r,s);r instanceof Date&&(r=nD(r,s.date1904));var m=n8(u,r);if(Xv(m[1]))return kT(r,s);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return i8(m[1],r,s,m[0])}function pD(t,r){if(typeof r!="number"){r=+r||-1;for(var s=0;s<392;++s){if(ss[s]==null){r<0&&(r=s);continue}if(ss[s]==t){r=s;break}}r<0&&(r=391)}return ss[r]=t,r}function k1(t){for(var r=0;r!=392;++r)t[r]!==void 0&&pD(t[r],r)}function R1(){ss=zj()}var mD=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function s8(t){var r=typeof t=="number"?ss[t]:t;return r=r.replace(mD,"(\\d+)"),new RegExp("^"+r+"$")}function o8(t,r,s){var u=-1,m=-1,v=-1,T=-1,a=-1,R=-1;(r.match(mD)||[]).forEach(function(H,q){var ee=parseInt(s[q+1],10);switch(H.toLowerCase().charAt(0)){case"y":u=ee;break;case"d":v=ee;break;case"h":T=ee;break;case"s":R=ee;break;case"m":T>=0?a=ee:m=ee;break}}),R>=0&&a==-1&&m>=0&&(a=m,m=-1);var O=(""+(u>=0?u:new Date().getFullYear())).slice(-4)+"-"+("00"+(m>=1?m:1)).slice(-2)+"-"+("00"+(v>=1?v:1)).slice(-2);O.length==7&&(O="0"+O),O.length==8&&(O="20"+O);var B=("00"+(T>=0?T:0)).slice(-2)+":"+("00"+(a>=0?a:0)).slice(-2)+":"+("00"+(R>=0?R:0)).slice(-2);return T==-1&&a==-1&&R==-1?O:u==-1&&m==-1&&v==-1?B:O+"T"+B}var a8=function(){var t={};t.version="1.2.0";function r(){for(var De=0,et=new Array(256),Ge=0;Ge!=256;++Ge)De=Ge,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,De=De&1?-306674912^De>>>1:De>>>1,et[Ge]=De;return typeof Int32Array<"u"?new Int32Array(et):et}var s=r();function u(De){var et=0,Ge=0,ft=0,tt=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(ft=0;ft!=256;++ft)tt[ft]=De[ft];for(ft=0;ft!=256;++ft)for(Ge=De[ft],et=256+ft;et<4096;et+=256)Ge=tt[et]=Ge>>>8^De[Ge&255];var Ot=[];for(ft=1;ft!=16;++ft)Ot[ft-1]=typeof Int32Array<"u"?tt.subarray(ft*256,ft*256+256):tt.slice(ft*256,ft*256+256);return Ot}var m=u(s),v=m[0],T=m[1],a=m[2],R=m[3],O=m[4],B=m[5],H=m[6],q=m[7],ee=m[8],re=m[9],J=m[10],_e=m[11],pe=m[12],ue=m[13],ie=m[14];function ke(De,et){for(var Ge=et^-1,ft=0,tt=De.length;ft<tt;)Ge=Ge>>>8^s[(Ge^De.charCodeAt(ft++))&255];return~Ge}function at(De,et){for(var Ge=et^-1,ft=De.length-15,tt=0;tt<ft;)Ge=ie[De[tt++]^Ge&255]^ue[De[tt++]^Ge>>8&255]^pe[De[tt++]^Ge>>16&255]^_e[De[tt++]^Ge>>>24]^J[De[tt++]]^re[De[tt++]]^ee[De[tt++]]^q[De[tt++]]^H[De[tt++]]^B[De[tt++]]^O[De[tt++]]^R[De[tt++]]^a[De[tt++]]^T[De[tt++]]^v[De[tt++]]^s[De[tt++]];for(ft+=15;tt<ft;)Ge=Ge>>>8^s[(Ge^De[tt++])&255];return~Ge}function He(De,et){for(var Ge=et^-1,ft=0,tt=De.length,Ot=0,Xt=0;ft<tt;)Ot=De.charCodeAt(ft++),Ot<128?Ge=Ge>>>8^s[(Ge^Ot)&255]:Ot<2048?(Ge=Ge>>>8^s[(Ge^(192|Ot>>6&31))&255],Ge=Ge>>>8^s[(Ge^(128|Ot&63))&255]):Ot>=55296&&Ot<57344?(Ot=(Ot&1023)+64,Xt=De.charCodeAt(ft++)&1023,Ge=Ge>>>8^s[(Ge^(240|Ot>>8&7))&255],Ge=Ge>>>8^s[(Ge^(128|Ot>>2&63))&255],Ge=Ge>>>8^s[(Ge^(128|Xt>>6&15|(Ot&3)<<4))&255],Ge=Ge>>>8^s[(Ge^(128|Xt&63))&255]):(Ge=Ge>>>8^s[(Ge^(224|Ot>>12&15))&255],Ge=Ge>>>8^s[(Ge^(128|Ot>>6&63))&255],Ge=Ge>>>8^s[(Ge^(128|Ot&63))&255]);return~Ge}return t.table=s,t.bstr=ke,t.buf=at,t.str=He,t}(),Tn=function(){var r={};r.version="1.2.1";function s(U,ae){for(var Q=U.split("/"),ne=ae.split("/"),me=0,fe=0,Ve=Math.min(Q.length,ne.length);me<Ve;++me){if(fe=Q[me].length-ne[me].length)return fe;if(Q[me]!=ne[me])return Q[me]<ne[me]?-1:1}return Q.length-ne.length}function u(U){if(U.charAt(U.length-1)=="/")return U.slice(0,-1).indexOf("/")===-1?U:u(U.slice(0,-1));var ae=U.lastIndexOf("/");return ae===-1?U:U.slice(0,ae+1)}function m(U){if(U.charAt(U.length-1)=="/")return m(U.slice(0,-1));var ae=U.lastIndexOf("/");return ae===-1?U:U.slice(ae+1)}function v(U,ae){typeof ae=="string"&&(ae=new Date(ae));var Q=ae.getHours();Q=Q<<6|ae.getMinutes(),Q=Q<<5|ae.getSeconds()>>>1,U.write_shift(2,Q);var ne=ae.getFullYear()-1980;ne=ne<<4|ae.getMonth()+1,ne=ne<<5|ae.getDate(),U.write_shift(2,ne)}function T(U){var ae=U.read_shift(2)&65535,Q=U.read_shift(2)&65535,ne=new Date,me=Q&31;Q>>>=5;var fe=Q&15;Q>>>=4,ne.setMilliseconds(0),ne.setFullYear(Q+1980),ne.setMonth(fe-1),ne.setDate(me);var Ve=ae&31;ae>>>=5;var nt=ae&63;return ae>>>=6,ne.setHours(ae),ne.setMinutes(nt),ne.setSeconds(Ve<<1),ne}function a(U){ma(U,0);for(var ae={},Q=0;U.l<=U.length-4;){var ne=U.read_shift(2),me=U.read_shift(2),fe=U.l+me,Ve={};switch(ne){case 21589:Q=U.read_shift(1),Q&1&&(Ve.mtime=U.read_shift(4)),me>5&&(Q&2&&(Ve.atime=U.read_shift(4)),Q&4&&(Ve.ctime=U.read_shift(4))),Ve.mtime&&(Ve.mt=new Date(Ve.mtime*1e3));break}U.l=fe,ae[ne]=Ve}return ae}var R;function O(){return R||(R={})}function B(U,ae){if(U[0]==80&&U[1]==75)return wl(U,ae);if((U[0]|32)==109&&(U[1]|32)==105)return bl(U,ae);if(U.length<512)throw new Error("CFB file size "+U.length+" < 512");var Q=3,ne=512,me=0,fe=0,Ve=0,nt=0,Ye=0,st=[],it=U.slice(0,512);ma(it,0);var Mt=H(it);switch(Q=Mt[0],Q){case 3:ne=512;break;case 4:ne=4096;break;case 0:if(Mt[1]==0)return wl(U,ae);default:throw new Error("Major Version: Expected 3 or 4 saw "+Q)}ne!==512&&(it=U.slice(0,ne),ma(it,28));var Zt=U.slice(0,ne);q(it,Q);var $t=it.read_shift(4,"i");if(Q===3&&$t!==0)throw new Error("# Directory Sectors: Expected 0 saw "+$t);it.l+=4,Ve=it.read_shift(4,"i"),it.l+=4,it.chk("00100000","Mini Stream Cutoff Size: "),nt=it.read_shift(4,"i"),me=it.read_shift(4,"i"),Ye=it.read_shift(4,"i"),fe=it.read_shift(4,"i");for(var Kt=-1,mr=0;mr<109&&(Kt=it.read_shift(4,"i"),!(Kt<0));++mr)st[mr]=Kt;var Vr=ee(U,ne);_e(Ye,fe,Vr,ne,st);var Xr=ue(Vr,Ve,st,ne);Xr[Ve].name="!Directory",me>0&&nt!==Xt&&(Xr[nt].name="!MiniFAT"),Xr[st[0]].name="!FAT",Xr.fat_addrs=st,Xr.ssz=ne;var zr={},di=[],ji=[],Ai=[];ie(Ve,Xr,Vr,di,me,zr,ji,nt),re(ji,Ai,di),di.shift();var Sn={FileIndex:ji,FullPaths:Ai};return ae&&ae.raw&&(Sn.raw={header:Zt,sectors:Vr}),Sn}function H(U){if(U[U.l]==80&&U[U.l+1]==75)return[0,0];U.chk(Dr,"Header Signature: "),U.l+=16;var ae=U.read_shift(2,"u");return[U.read_shift(2,"u"),ae]}function q(U,ae){var Q=9;switch(U.l+=2,Q=U.read_shift(2)){case 9:if(ae!=3)throw new Error("Sector Shift: Expected 9 saw "+Q);break;case 12:if(ae!=4)throw new Error("Sector Shift: Expected 12 saw "+Q);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Q)}U.chk("0600","Mini Sector Shift: "),U.chk("000000000000","Reserved: ")}function ee(U,ae){for(var Q=Math.ceil(U.length/ae)-1,ne=[],me=1;me<Q;++me)ne[me-1]=U.slice(me*ae,(me+1)*ae);return ne[Q-1]=U.slice(Q*ae),ne}function re(U,ae,Q){for(var ne=0,me=0,fe=0,Ve=0,nt=0,Ye=Q.length,st=[],it=[];ne<Ye;++ne)st[ne]=it[ne]=ne,ae[ne]=Q[ne];for(;nt<it.length;++nt)ne=it[nt],me=U[ne].L,fe=U[ne].R,Ve=U[ne].C,st[ne]===ne&&(me!==-1&&st[me]!==me&&(st[ne]=st[me]),fe!==-1&&st[fe]!==fe&&(st[ne]=st[fe])),Ve!==-1&&(st[Ve]=ne),me!==-1&&ne!=st[ne]&&(st[me]=st[ne],it.lastIndexOf(me)<nt&&it.push(me)),fe!==-1&&ne!=st[ne]&&(st[fe]=st[ne],it.lastIndexOf(fe)<nt&&it.push(fe));for(ne=1;ne<Ye;++ne)st[ne]===ne&&(fe!==-1&&st[fe]!==fe?st[ne]=st[fe]:me!==-1&&st[me]!==me&&(st[ne]=st[me]));for(ne=1;ne<Ye;++ne)if(U[ne].type!==0){if(nt=ne,nt!=st[nt])do nt=st[nt],ae[ne]=ae[nt]+"/"+ae[ne];while(nt!==0&&st[nt]!==-1&&nt!=st[nt]);st[ne]=-1}for(ae[0]+="/",ne=1;ne<Ye;++ne)U[ne].type!==2&&(ae[ne]+="/")}function J(U,ae,Q){for(var ne=U.start,me=U.size,fe=[],Ve=ne;Q&&me>0&&Ve>=0;)fe.push(ae.slice(Ve*Ot,Ve*Ot+Ot)),me-=Ot,Ve=wd(Q,Ve*4);return fe.length===0?Vt(0):Ks(fe).slice(0,U.size)}function _e(U,ae,Q,ne,me){var fe=Xt;if(U===Xt){if(ae!==0)throw new Error("DIFAT chain shorter than expected")}else if(U!==-1){var Ve=Q[U],nt=(ne>>>2)-1;if(!Ve)return;for(var Ye=0;Ye<nt&&(fe=wd(Ve,Ye*4))!==Xt;++Ye)me.push(fe);_e(wd(Ve,ne-4),ae-1,Q,ne,me)}}function pe(U,ae,Q,ne,me){var fe=[],Ve=[];me||(me=[]);var nt=ne-1,Ye=0,st=0;for(Ye=ae;Ye>=0;){me[Ye]=!0,fe[fe.length]=Ye,Ve.push(U[Ye]);var it=Q[Math.floor(Ye*4/ne)];if(st=Ye*4&nt,ne<4+st)throw new Error("FAT boundary crossed: "+Ye+" 4 "+ne);if(!U[it])break;Ye=wd(U[it],st)}return{nodes:fe,data:z3([Ve])}}function ue(U,ae,Q,ne){var me=U.length,fe=[],Ve=[],nt=[],Ye=[],st=ne-1,it=0,Mt=0,Zt=0,$t=0;for(it=0;it<me;++it)if(nt=[],Zt=it+ae,Zt>=me&&(Zt-=me),!Ve[Zt]){Ye=[];var Kt=[];for(Mt=Zt;Mt>=0;){Kt[Mt]=!0,Ve[Mt]=!0,nt[nt.length]=Mt,Ye.push(U[Mt]);var mr=Q[Math.floor(Mt*4/ne)];if($t=Mt*4&st,ne<4+$t)throw new Error("FAT boundary crossed: "+Mt+" 4 "+ne);if(!U[mr]||(Mt=wd(U[mr],$t),Kt[Mt]))break}fe[Zt]={nodes:nt,data:z3([Ye])}}return fe}function ie(U,ae,Q,ne,me,fe,Ve,nt){for(var Ye=0,st=ne.length?2:0,it=ae[U].data,Mt=0,Zt=0,$t;Mt<it.length;Mt+=128){var Kt=it.slice(Mt,Mt+128);ma(Kt,64),Zt=Kt.read_shift(2),$t=US(Kt,0,Zt-st),ne.push($t);var mr={name:$t,type:Kt.read_shift(1),color:Kt.read_shift(1),L:Kt.read_shift(4,"i"),R:Kt.read_shift(4,"i"),C:Kt.read_shift(4,"i"),clsid:Kt.read_shift(16),state:Kt.read_shift(4,"i"),start:0,size:0},Vr=Kt.read_shift(2)+Kt.read_shift(2)+Kt.read_shift(2)+Kt.read_shift(2);Vr!==0&&(mr.ct=ke(Kt,Kt.l-8));var Xr=Kt.read_shift(2)+Kt.read_shift(2)+Kt.read_shift(2)+Kt.read_shift(2);Xr!==0&&(mr.mt=ke(Kt,Kt.l-8)),mr.start=Kt.read_shift(4,"i"),mr.size=Kt.read_shift(4,"i"),mr.size<0&&mr.start<0&&(mr.size=mr.type=0,mr.start=Xt,mr.name=""),mr.type===5?(Ye=mr.start,me>0&&Ye!==Xt&&(ae[Ye].name="!StreamData")):mr.size>=4096?(mr.storage="fat",ae[mr.start]===void 0&&(ae[mr.start]=pe(Q,mr.start,ae.fat_addrs,ae.ssz)),ae[mr.start].name=mr.name,mr.content=ae[mr.start].data.slice(0,mr.size)):(mr.storage="minifat",mr.size<0?mr.size=0:Ye!==Xt&&mr.start!==Xt&&ae[Ye]&&(mr.content=J(mr,ae[Ye].data,(ae[nt]||{}).data))),mr.content&&ma(mr.content,0),fe[$t]=mr,Ve.push(mr)}}function ke(U,ae){return new Date((_a(U,ae+4)/1e7*Math.pow(2,32)+_a(U,ae)/1e7-11644473600)*1e3)}function at(U,ae){return O(),B(R.readFileSync(U),ae)}function He(U,ae){var Q=ae&&ae.type;switch(Q||fn&&Buffer.isBuffer(U)&&(Q="buffer"),Q||"base64"){case"file":return at(U,ae);case"base64":return B(ml(Yc(U)),ae);case"binary":return B(ml(U),ae)}return B(U,ae)}function De(U,ae){var Q=ae||{},ne=Q.root||"Root Entry";if(U.FullPaths||(U.FullPaths=[]),U.FileIndex||(U.FileIndex=[]),U.FullPaths.length!==U.FileIndex.length)throw new Error("inconsistent CFB structure");U.FullPaths.length===0&&(U.FullPaths[0]=ne+"/",U.FileIndex[0]={name:ne,type:5}),Q.CLSID&&(U.FileIndex[0].clsid=Q.CLSID),et(U)}function et(U){var ae="Sh33tJ5";if(!Tn.find(U,"/"+ae)){var Q=Vt(4);Q[0]=55,Q[1]=Q[3]=50,Q[2]=54,U.FileIndex.push({name:ae,type:2,content:Q,size:4,L:69,R:69,C:69}),U.FullPaths.push(U.FullPaths[0]+ae),Ge(U)}}function Ge(U,ae){De(U);for(var Q=!1,ne=!1,me=U.FullPaths.length-1;me>=0;--me){var fe=U.FileIndex[me];switch(fe.type){case 0:ne?Q=!0:(U.FileIndex.pop(),U.FullPaths.pop());break;case 1:case 2:case 5:ne=!0,isNaN(fe.R*fe.L*fe.C)&&(Q=!0),fe.R>-1&&fe.L>-1&&fe.R==fe.L&&(Q=!0);break;default:Q=!0;break}}if(!(!Q&&!ae)){var Ve=new Date(1987,1,19),nt=0,Ye=Object.create?Object.create(null):{},st=[];for(me=0;me<U.FullPaths.length;++me)Ye[U.FullPaths[me]]=!0,U.FileIndex[me].type!==0&&st.push([U.FullPaths[me],U.FileIndex[me]]);for(me=0;me<st.length;++me){var it=u(st[me][0]);ne=Ye[it],ne||(st.push([it,{name:m(it).replace("/",""),type:1,clsid:Ir,ct:Ve,mt:Ve,content:null}]),Ye[it]=!0)}for(st.sort(function($t,Kt){return s($t[0],Kt[0])}),U.FullPaths=[],U.FileIndex=[],me=0;me<st.length;++me)U.FullPaths[me]=st[me][0],U.FileIndex[me]=st[me][1];for(me=0;me<st.length;++me){var Mt=U.FileIndex[me],Zt=U.FullPaths[me];if(Mt.name=m(Zt).replace("/",""),Mt.L=Mt.R=Mt.C=-(Mt.color=1),Mt.size=Mt.content?Mt.content.length:0,Mt.start=0,Mt.clsid=Mt.clsid||Ir,me===0)Mt.C=st.length>1?1:-1,Mt.size=0,Mt.type=5;else if(Zt.slice(-1)=="/"){for(nt=me+1;nt<st.length&&u(U.FullPaths[nt])!=Zt;++nt);for(Mt.C=nt>=st.length?-1:nt,nt=me+1;nt<st.length&&u(U.FullPaths[nt])!=u(Zt);++nt);Mt.R=nt>=st.length?-1:nt,Mt.type=1}else u(U.FullPaths[me+1]||"")==u(Zt)&&(Mt.R=me+1),Mt.type=2}}}function ft(U,ae){var Q=ae||{};if(Q.fileType=="mad")return ze(U,Q);switch(Ge(U),Q.fileType){case"zip":return _o(U,Q)}var ne=function($t){for(var Kt=0,mr=0,Vr=0;Vr<$t.FileIndex.length;++Vr){var Xr=$t.FileIndex[Vr];if(Xr.content){var zr=Xr.content.length;zr>0&&(zr<4096?Kt+=zr+63>>6:mr+=zr+511>>9)}}for(var di=$t.FullPaths.length+3>>2,ji=Kt+7>>3,Ai=Kt+127>>7,Sn=ji+mr+di+Ai,In=Sn+127>>7,vs=In<=109?0:Math.ceil((In-109)/127);Sn+In+vs+127>>7>In;)vs=++In<=109?0:Math.ceil((In-109)/127);var as=[1,vs,In,Ai,di,mr,Kt,0];return $t.FileIndex[0].size=Kt<<6,as[7]=($t.FileIndex[0].start=as[0]+as[1]+as[2]+as[3]+as[4]+as[5])+(as[6]+7>>3),as}(U),me=Vt(ne[7]<<9),fe=0,Ve=0;{for(fe=0;fe<8;++fe)me.write_shift(1,ir[fe]);for(fe=0;fe<8;++fe)me.write_shift(2,0);for(me.write_shift(2,62),me.write_shift(2,3),me.write_shift(2,65534),me.write_shift(2,9),me.write_shift(2,6),fe=0;fe<3;++fe)me.write_shift(2,0);for(me.write_shift(4,0),me.write_shift(4,ne[2]),me.write_shift(4,ne[0]+ne[1]+ne[2]+ne[3]-1),me.write_shift(4,0),me.write_shift(4,4096),me.write_shift(4,ne[3]?ne[0]+ne[1]+ne[2]-1:Xt),me.write_shift(4,ne[3]),me.write_shift(-4,ne[1]?ne[0]-1:Xt),me.write_shift(4,ne[1]),fe=0;fe<109;++fe)me.write_shift(-4,fe<ne[2]?ne[1]+fe:-1)}if(ne[1])for(Ve=0;Ve<ne[1];++Ve){for(;fe<236+Ve*127;++fe)me.write_shift(-4,fe<ne[2]?ne[1]+fe:-1);me.write_shift(-4,Ve===ne[1]-1?Xt:Ve+1)}var nt=function($t){for(Ve+=$t;fe<Ve-1;++fe)me.write_shift(-4,fe+1);$t&&(++fe,me.write_shift(-4,Xt))};for(Ve=fe=0,Ve+=ne[1];fe<Ve;++fe)me.write_shift(-4,ei.DIFSECT);for(Ve+=ne[2];fe<Ve;++fe)me.write_shift(-4,ei.FATSECT);nt(ne[3]),nt(ne[4]);for(var Ye=0,st=0,it=U.FileIndex[0];Ye<U.FileIndex.length;++Ye)it=U.FileIndex[Ye],it.content&&(st=it.content.length,!(st<4096)&&(it.start=Ve,nt(st+511>>9)));for(nt(ne[6]+7>>3);me.l&511;)me.write_shift(-4,ei.ENDOFCHAIN);for(Ve=fe=0,Ye=0;Ye<U.FileIndex.length;++Ye)it=U.FileIndex[Ye],it.content&&(st=it.content.length,!(!st||st>=4096)&&(it.start=Ve,nt(st+63>>6)));for(;me.l&511;)me.write_shift(-4,ei.ENDOFCHAIN);for(fe=0;fe<ne[4]<<2;++fe){var Mt=U.FullPaths[fe];if(!Mt||Mt.length===0){for(Ye=0;Ye<17;++Ye)me.write_shift(4,0);for(Ye=0;Ye<3;++Ye)me.write_shift(4,-1);for(Ye=0;Ye<12;++Ye)me.write_shift(4,0);continue}it=U.FileIndex[fe],fe===0&&(it.start=it.size?it.start-1:Xt);var Zt=fe===0&&Q.root||it.name;if(st=2*(Zt.length+1),me.write_shift(64,Zt,"utf16le"),me.write_shift(2,st),me.write_shift(1,it.type),me.write_shift(1,it.color),me.write_shift(-4,it.L),me.write_shift(-4,it.R),me.write_shift(-4,it.C),it.clsid)me.write_shift(16,it.clsid,"hex");else for(Ye=0;Ye<4;++Ye)me.write_shift(4,0);me.write_shift(4,it.state||0),me.write_shift(4,0),me.write_shift(4,0),me.write_shift(4,0),me.write_shift(4,0),me.write_shift(4,it.start),me.write_shift(4,it.size),me.write_shift(4,0)}for(fe=1;fe<U.FileIndex.length;++fe)if(it=U.FileIndex[fe],it.size>=4096)if(me.l=it.start+1<<9,fn&&Buffer.isBuffer(it.content))it.content.copy(me,me.l,0,it.size),me.l+=it.size+511&-512;else{for(Ye=0;Ye<it.size;++Ye)me.write_shift(1,it.content[Ye]);for(;Ye&511;++Ye)me.write_shift(1,0)}for(fe=1;fe<U.FileIndex.length;++fe)if(it=U.FileIndex[fe],it.size>0&&it.size<4096)if(fn&&Buffer.isBuffer(it.content))it.content.copy(me,me.l,0,it.size),me.l+=it.size+63&-64;else{for(Ye=0;Ye<it.size;++Ye)me.write_shift(1,it.content[Ye]);for(;Ye&63;++Ye)me.write_shift(1,0)}if(fn)me.l=me.length;else for(;me.l<me.length;)me.write_shift(1,0);return me}function tt(U,ae){var Q=U.FullPaths.map(function(Ye){return Ye.toUpperCase()}),ne=Q.map(function(Ye){var st=Ye.split("/");return st[st.length-(Ye.slice(-1)=="/"?2:1)]}),me=!1;ae.charCodeAt(0)===47?(me=!0,ae=Q[0].slice(0,-1)+ae):me=ae.indexOf("/")!==-1;var fe=ae.toUpperCase(),Ve=me===!0?Q.indexOf(fe):ne.indexOf(fe);if(Ve!==-1)return U.FileIndex[Ve];var nt=!fe.match(ev);for(fe=fe.replace(qg,""),nt&&(fe=fe.replace(ev,"!")),Ve=0;Ve<Q.length;++Ve)if((nt?Q[Ve].replace(ev,"!"):Q[Ve]).replace(qg,"")==fe||(nt?ne[Ve].replace(ev,"!"):ne[Ve]).replace(qg,"")==fe)return U.FileIndex[Ve];return null}var Ot=64,Xt=-2,Dr="d0cf11e0a1b11ae1",ir=[208,207,17,224,161,177,26,225],Ir="00000000000000000000000000000000",ei={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Xt,FREESECT:-1,HEADER_SIGNATURE:Dr,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Ir,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function sr(U,ae,Q){O();var ne=ft(U,Q);R.writeFileSync(ae,ne)}function yr(U){for(var ae=new Array(U.length),Q=0;Q<U.length;++Q)ae[Q]=String.fromCharCode(U[Q]);return ae.join("")}function vr(U,ae){var Q=ft(U,ae);switch(ae&&ae.type||"buffer"){case"file":return O(),R.writeFileSync(ae.filename,Q),Q;case"binary":return typeof Q=="string"?Q:yr(Q);case"base64":return v_(typeof Q=="string"?Q:yr(Q));case"buffer":if(fn)return Buffer.isBuffer(Q)?Q:eu(Q);case"array":return typeof Q=="string"?ml(Q):Q}return Q}var gr;function Ue(U){try{var ae=U.InflateRaw,Q=new ae;if(Q._processChunk(new Uint8Array([3,0]),Q._finishFlushFlag),Q.bytesRead)gr=U;else throw new Error("zlib does not expose bytesRead")}catch(ne){console.error("cannot use native zlib: "+(ne.message||ne))}}function vt(U,ae){if(!gr)return Gi(U,ae);var Q=gr.InflateRaw,ne=new Q,me=ne._processChunk(U.slice(U.l),ne._finishFlushFlag);return U.l+=ne.bytesRead,me}function ct(U){return gr?gr.deflateRawSync(U):Yo(U)}var ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Pt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],dr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function br(U){var ae=(U<<1|U<<11)&139536|(U<<5|U<<15)&558144;return(ae>>16|ae>>8|ae)&255}for(var ar=typeof Uint8Array<"u",Qt=ar?new Uint8Array(256):[],Ci=0;Ci<256;++Ci)Qt[Ci]=br(Ci);function bi(U,ae){var Q=Qt[U&255];return ae<=8?Q>>>8-ae:(Q=Q<<8|Qt[U>>8&255],ae<=16?Q>>>16-ae:(Q=Q<<8|Qt[U>>16&255],Q>>>24-ae))}function Ln(U,ae){var Q=ae&7,ne=ae>>>3;return(U[ne]|(Q<=6?0:U[ne+1]<<8))>>>Q&3}function gi(U,ae){var Q=ae&7,ne=ae>>>3;return(U[ne]|(Q<=5?0:U[ne+1]<<8))>>>Q&7}function Pi(U,ae){var Q=ae&7,ne=ae>>>3;return(U[ne]|(Q<=4?0:U[ne+1]<<8))>>>Q&15}function fr(U,ae){var Q=ae&7,ne=ae>>>3;return(U[ne]|(Q<=3?0:U[ne+1]<<8))>>>Q&31}function Ut(U,ae){var Q=ae&7,ne=ae>>>3;return(U[ne]|(Q<=1?0:U[ne+1]<<8))>>>Q&127}function ti(U,ae,Q){var ne=ae&7,me=ae>>>3,fe=(1<<Q)-1,Ve=U[me]>>>ne;return Q<8-ne||(Ve|=U[me+1]<<8-ne,Q<16-ne)||(Ve|=U[me+2]<<16-ne,Q<24-ne)||(Ve|=U[me+3]<<24-ne),Ve&fe}function si(U,ae,Q){var ne=ae&7,me=ae>>>3;return ne<=5?U[me]|=(Q&7)<<ne:(U[me]|=Q<<ne&255,U[me+1]=(Q&7)>>8-ne),ae+3}function cn(U,ae,Q){var ne=ae&7,me=ae>>>3;return Q=(Q&1)<<ne,U[me]|=Q,ae+1}function un(U,ae,Q){var ne=ae&7,me=ae>>>3;return Q<<=ne,U[me]|=Q&255,Q>>>=8,U[me+1]=Q,ae+8}function Xn(U,ae,Q){var ne=ae&7,me=ae>>>3;return Q<<=ne,U[me]|=Q&255,Q>>>=8,U[me+1]=Q&255,U[me+2]=Q>>>8,ae+16}function Vn(U,ae){var Q=U.length,ne=2*Q>ae?2*Q:ae+5,me=0;if(Q>=ae)return U;if(fn){var fe=T3(ne);if(U.copy)U.copy(fe);else for(;me<U.length;++me)fe[me]=U[me];return fe}else if(ar){var Ve=new Uint8Array(ne);if(Ve.set)Ve.set(U);else for(;me<Q;++me)Ve[me]=U[me];return Ve}return U.length=ne,U}function Kn(U){for(var ae=new Array(U),Q=0;Q<U;++Q)ae[Q]=0;return ae}function ks(U,ae,Q){var ne=1,me=0,fe=0,Ve=0,nt=0,Ye=U.length,st=ar?new Uint16Array(32):Kn(32);for(fe=0;fe<32;++fe)st[fe]=0;for(fe=Ye;fe<Q;++fe)U[fe]=0;Ye=U.length;var it=ar?new Uint16Array(Ye):Kn(Ye);for(fe=0;fe<Ye;++fe)st[me=U[fe]]++,ne<me&&(ne=me),it[fe]=0;for(st[0]=0,fe=1;fe<=ne;++fe)st[fe+16]=nt=nt+st[fe-1]<<1;for(fe=0;fe<Ye;++fe)nt=U[fe],nt!=0&&(it[fe]=st[nt+16]++);var Mt=0;for(fe=0;fe<Ye;++fe)if(Mt=U[fe],Mt!=0)for(nt=bi(it[fe],ne)>>ne-Mt,Ve=(1<<ne+4-Mt)-1;Ve>=0;--Ve)ae[nt|Ve<<Mt]=Mt&15|fe<<4;return ne}var $n=ar?new Uint16Array(512):Kn(512),os=ar?new Uint16Array(32):Kn(32);if(!ar){for(var $s=0;$s<512;++$s)$n[$s]=0;for($s=0;$s<32;++$s)os[$s]=0}(function(){for(var U=[],ae=0;ae<32;ae++)U.push(5);ks(U,os,32);var Q=[];for(ae=0;ae<=143;ae++)Q.push(8);for(;ae<=255;ae++)Q.push(9);for(;ae<=279;ae++)Q.push(7);for(;ae<=287;ae++)Q.push(8);ks(Q,$n,288)})();var mo=function(){for(var ae=ar?new Uint8Array(32768):[],Q=0,ne=0;Q<dr.length-1;++Q)for(;ne<dr[Q+1];++ne)ae[ne]=Q;for(;ne<32768;++ne)ae[ne]=29;var me=ar?new Uint8Array(259):[];for(Q=0,ne=0;Q<Pt.length-1;++Q)for(;ne<Pt[Q+1];++ne)me[ne]=Q;function fe(nt,Ye){for(var st=0;st<nt.length;){var it=Math.min(65535,nt.length-st),Mt=st+it==nt.length;for(Ye.write_shift(1,+Mt),Ye.write_shift(2,it),Ye.write_shift(2,~it&65535);it-- >0;)Ye[Ye.l++]=nt[st++]}return Ye.l}function Ve(nt,Ye){for(var st=0,it=0,Mt=ar?new Uint16Array(32768):[];it<nt.length;){var Zt=Math.min(65535,nt.length-it);if(Zt<10){for(st=si(Ye,st,+(it+Zt==nt.length)),st&7&&(st+=8-(st&7)),Ye.l=st/8|0,Ye.write_shift(2,Zt),Ye.write_shift(2,~Zt&65535);Zt-- >0;)Ye[Ye.l++]=nt[it++];st=Ye.l*8;continue}st=si(Ye,st,+(it+Zt==nt.length)+2);for(var $t=0;Zt-- >0;){var Kt=nt[it];$t=($t<<5^Kt)&32767;var mr=-1,Vr=0;if((mr=Mt[$t])&&(mr|=it&-32768,mr>it&&(mr-=32768),mr<it))for(;nt[mr+Vr]==nt[it+Vr]&&Vr<250;)++Vr;if(Vr>2){Kt=me[Vr],Kt<=22?st=un(Ye,st,Qt[Kt+1]>>1)-1:(un(Ye,st,3),st+=5,un(Ye,st,Qt[Kt-23]>>5),st+=3);var Xr=Kt<8?0:Kt-4>>2;Xr>0&&(Xn(Ye,st,Vr-Pt[Kt]),st+=Xr),Kt=ae[it-mr],st=un(Ye,st,Qt[Kt]>>3),st-=3;var zr=Kt<4?0:Kt-2>>1;zr>0&&(Xn(Ye,st,it-mr-dr[Kt]),st+=zr);for(var di=0;di<Vr;++di)Mt[$t]=it&32767,$t=($t<<5^nt[it])&32767,++it;Zt-=Vr-1}else Kt<=143?Kt=Kt+48:st=cn(Ye,st,1),st=un(Ye,st,Qt[Kt]),Mt[$t]=it&32767,++it}st=un(Ye,st,0)-1}return Ye.l=(st+7)/8|0,Ye.l}return function(Ye,st){return Ye.length<8?fe(Ye,st):Ve(Ye,st)}}();function Yo(U){var ae=Vt(50+Math.floor(U.length*1.1)),Q=mo(U,ae);return ae.slice(0,Q)}var An=ar?new Uint16Array(32768):Kn(32768),xs=ar?new Uint16Array(32768):Kn(32768),zo=ar?new Uint16Array(128):Kn(128),Jo=1,go=1;function Qo(U,ae){var Q=fr(U,ae)+257;ae+=5;var ne=fr(U,ae)+1;ae+=5;var me=Pi(U,ae)+4;ae+=4;for(var fe=0,Ve=ar?new Uint8Array(19):Kn(19),nt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ye=1,st=ar?new Uint8Array(8):Kn(8),it=ar?new Uint8Array(8):Kn(8),Mt=Ve.length,Zt=0;Zt<me;++Zt)Ve[ht[Zt]]=fe=gi(U,ae),Ye<fe&&(Ye=fe),st[fe]++,ae+=3;var $t=0;for(st[0]=0,Zt=1;Zt<=Ye;++Zt)it[Zt]=$t=$t+st[Zt-1]<<1;for(Zt=0;Zt<Mt;++Zt)($t=Ve[Zt])!=0&&(nt[Zt]=it[$t]++);var Kt=0;for(Zt=0;Zt<Mt;++Zt)if(Kt=Ve[Zt],Kt!=0){$t=Qt[nt[Zt]]>>8-Kt;for(var mr=(1<<7-Kt)-1;mr>=0;--mr)zo[$t|mr<<Kt]=Kt&7|Zt<<3}var Vr=[];for(Ye=1;Vr.length<Q+ne;)switch($t=zo[Ut(U,ae)],ae+=$t&7,$t>>>=3){case 16:for(fe=3+Ln(U,ae),ae+=2,$t=Vr[Vr.length-1];fe-- >0;)Vr.push($t);break;case 17:for(fe=3+gi(U,ae),ae+=3;fe-- >0;)Vr.push(0);break;case 18:for(fe=11+Ut(U,ae),ae+=7;fe-- >0;)Vr.push(0);break;default:Vr.push($t),Ye<$t&&(Ye=$t);break}var Xr=Vr.slice(0,Q),zr=Vr.slice(Q);for(Zt=Q;Zt<286;++Zt)Xr[Zt]=0;for(Zt=ne;Zt<30;++Zt)zr[Zt]=0;return Jo=ks(Xr,An,286),go=ks(zr,xs,30),ae}function Wa(U,ae){if(U[0]==3&&!(U[1]&3))return[Od(ae),2];for(var Q=0,ne=0,me=T3(ae||1<<18),fe=0,Ve=me.length>>>0,nt=0,Ye=0;!(ne&1);){if(ne=gi(U,Q),Q+=3,ne>>>1)ne>>1==1?(nt=9,Ye=5):(Q=Qo(U,Q),nt=Jo,Ye=go);else{Q&7&&(Q+=8-(Q&7));var st=U[Q>>>3]|U[(Q>>>3)+1]<<8;if(Q+=32,st>0)for(!ae&&Ve<fe+st&&(me=Vn(me,fe+st),Ve=me.length);st-- >0;)me[fe++]=U[Q>>>3],Q+=8;continue}for(;;){!ae&&Ve<fe+32767&&(me=Vn(me,fe+32767),Ve=me.length);var it=ti(U,Q,nt),Mt=ne>>>1==1?$n[it]:An[it];if(Q+=Mt&15,Mt>>>=4,!(Mt>>>8&255))me[fe++]=Mt;else{if(Mt==256)break;Mt-=257;var Zt=Mt<8?0:Mt-4>>2;Zt>5&&(Zt=0);var $t=fe+Pt[Mt];Zt>0&&($t+=ti(U,Q,Zt),Q+=Zt),it=ti(U,Q,Ye),Mt=ne>>>1==1?os[it]:xs[it],Q+=Mt&15,Mt>>>=4;var Kt=Mt<4?0:Mt-2>>1,mr=dr[Mt];for(Kt>0&&(mr+=ti(U,Q,Kt),Q+=Kt),!ae&&Ve<$t&&(me=Vn(me,$t+100),Ve=me.length);fe<$t;)me[fe]=me[fe-mr],++fe}}}return ae?[me,Q+7>>>3]:[me.slice(0,fe),Q+7>>>3]}function Gi(U,ae){var Q=U.slice(U.l||0),ne=Wa(Q,ae);return U.l+=ne[1],ne[0]}function Fn(U,ae){if(U)typeof console<"u"&&console.error(ae);else throw new Error(ae)}function wl(U,ae){var Q=U;ma(Q,0);var ne=[],me=[],fe={FileIndex:ne,FullPaths:me};De(fe,{root:ae.root});for(var Ve=Q.length-4;(Q[Ve]!=80||Q[Ve+1]!=75||Q[Ve+2]!=5||Q[Ve+3]!=6)&&Ve>=0;)--Ve;Q.l=Ve+4,Q.l+=4;var nt=Q.read_shift(2);Q.l+=6;var Ye=Q.read_shift(4);for(Q.l=Ye,Ve=0;Ve<nt;++Ve){Q.l+=20;var st=Q.read_shift(4),it=Q.read_shift(4),Mt=Q.read_shift(2),Zt=Q.read_shift(2),$t=Q.read_shift(2);Q.l+=8;var Kt=Q.read_shift(4),mr=a(Q.slice(Q.l+Mt,Q.l+Mt+Zt));Q.l+=Mt+Zt+$t;var Vr=Q.l;Q.l=Kt+4,qa(Q,st,it,fe,mr),Q.l=Vr}return fe}function qa(U,ae,Q,ne,me){U.l+=2;var fe=U.read_shift(2),Ve=U.read_shift(2),nt=T(U);if(fe&8257)throw new Error("Unsupported ZIP encryption");for(var Ye=U.read_shift(4),st=U.read_shift(4),it=U.read_shift(4),Mt=U.read_shift(2),Zt=U.read_shift(2),$t="",Kt=0;Kt<Mt;++Kt)$t+=String.fromCharCode(U[U.l++]);if(Zt){var mr=a(U.slice(U.l,U.l+Zt));(mr[21589]||{}).mt&&(nt=mr[21589].mt),((me||{})[21589]||{}).mt&&(nt=me[21589].mt)}U.l+=Zt;var Vr=U.slice(U.l,U.l+st);switch(Ve){case 8:Vr=vt(U,it);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Ve)}var Xr=!1;fe&8&&(Ye=U.read_shift(4),Ye==134695760&&(Ye=U.read_shift(4),Xr=!0),st=U.read_shift(4),it=U.read_shift(4)),st!=ae&&Fn(Xr,"Bad compressed size: "+ae+" != "+st),it!=Q&&Fn(Xr,"Bad uncompressed size: "+Q+" != "+it),se(ne,$t,Vr,{unsafe:!0,mt:nt})}function _o(U,ae){var Q=ae||{},ne=[],me=[],fe=Vt(1),Ve=Q.compression?8:0,nt=0,Ye=0,st=0,it=0,Mt=0,Zt=U.FullPaths[0],$t=Zt,Kt=U.FileIndex[0],mr=[],Vr=0;for(Ye=1;Ye<U.FullPaths.length;++Ye)if($t=U.FullPaths[Ye].slice(Zt.length),Kt=U.FileIndex[Ye],!(!Kt.size||!Kt.content||$t=="Sh33tJ5")){var Xr=it,zr=Vt($t.length);for(st=0;st<$t.length;++st)zr.write_shift(1,$t.charCodeAt(st)&127);zr=zr.slice(0,zr.l),mr[Mt]=a8.buf(Kt.content,0);var di=Kt.content;Ve==8&&(di=ct(di)),fe=Vt(30),fe.write_shift(4,67324752),fe.write_shift(2,20),fe.write_shift(2,nt),fe.write_shift(2,Ve),Kt.mt?v(fe,Kt.mt):fe.write_shift(4,0),fe.write_shift(-4,mr[Mt]),fe.write_shift(4,di.length),fe.write_shift(4,Kt.content.length),fe.write_shift(2,zr.length),fe.write_shift(2,0),it+=fe.length,ne.push(fe),it+=zr.length,ne.push(zr),it+=di.length,ne.push(di),fe=Vt(46),fe.write_shift(4,33639248),fe.write_shift(2,0),fe.write_shift(2,20),fe.write_shift(2,nt),fe.write_shift(2,Ve),fe.write_shift(4,0),fe.write_shift(-4,mr[Mt]),fe.write_shift(4,di.length),fe.write_shift(4,Kt.content.length),fe.write_shift(2,zr.length),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(4,0),fe.write_shift(4,Xr),Vr+=fe.l,me.push(fe),Vr+=zr.length,me.push(zr),++Mt}return fe=Vt(22),fe.write_shift(4,101010256),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,Mt),fe.write_shift(2,Mt),fe.write_shift(4,Vr),fe.write_shift(4,it),fe.write_shift(2,0),Ks([Ks(ne),Ks(me),fe])}var Ea={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function oc(U,ae){if(U.ctype)return U.ctype;var Q=U.name||"",ne=Q.match(/\.([^\.]+)$/);return ne&&Ea[ne[1]]||ae&&(ne=(Q=ae).match(/[\.\\]([^\.\\])+$/),ne&&Ea[ne[1]])?Ea[ne[1]]:"application/octet-stream"}function tu(U){for(var ae=v_(U),Q=[],ne=0;ne<ae.length;ne+=76)Q.push(ae.slice(ne,ne+76));return Q.join(`\r
`)+`\r
`}function bt(U){var ae=U.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(st){var it=st.charCodeAt(0).toString(16).toUpperCase();return"="+(it.length==1?"0"+it:it)});ae=ae.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),ae.charAt(0)==`
`&&(ae="=0D"+ae.slice(1)),ae=ae.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Q=[],ne=ae.split(`\r
`),me=0;me<ne.length;++me){var fe=ne[me];if(fe.length==0){Q.push("");continue}for(var Ve=0;Ve<fe.length;){var nt=76,Ye=fe.slice(Ve,Ve+nt);Ye.charAt(nt-1)=="="?nt--:Ye.charAt(nt-2)=="="?nt-=2:Ye.charAt(nt-3)=="="&&(nt-=3),Ye=fe.slice(Ve,Ve+nt),Ve+=nt,Ve<fe.length&&(Ye+="="),Q.push(Ye)}}return Q.join(`\r
`)}function ea(U){for(var ae=[],Q=0;Q<U.length;++Q){for(var ne=U[Q];Q<=U.length&&ne.charAt(ne.length-1)=="=";)ne=ne.slice(0,ne.length-1)+U[++Q];ae.push(ne)}for(var me=0;me<ae.length;++me)ae[me]=ae[me].replace(/[=][0-9A-Fa-f]{2}/g,function(fe){return String.fromCharCode(parseInt(fe.slice(1),16))});return ml(ae.join(`\r
`))}function bh(U,ae,Q){for(var ne="",me="",fe="",Ve,nt=0;nt<10;++nt){var Ye=ae[nt];if(!Ye||Ye.match(/^\s*$/))break;var st=Ye.match(/^(.*?):\s*([^\s].*)$/);if(st)switch(st[1].toLowerCase()){case"content-location":ne=st[2].trim();break;case"content-type":fe=st[2].trim();break;case"content-transfer-encoding":me=st[2].trim();break}}switch(++nt,me.toLowerCase()){case"base64":Ve=ml(Yc(ae.slice(nt).join("")));break;case"quoted-printable":Ve=ea(ae.slice(nt));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+me)}var it=se(U,ne.slice(Q.length),Ve,{unsafe:!0});fe&&(it.ctype=fe)}function bl(U,ae){if(yr(U.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Q=ae&&ae.root||"",ne=(fn&&Buffer.isBuffer(U)?U.toString("binary"):yr(U)).split(`\r
`),me=0,fe="";for(me=0;me<ne.length;++me)if(fe=ne[me],!!/^Content-Location:/i.test(fe)&&(fe=fe.slice(fe.indexOf("file")),Q||(Q=fe.slice(0,fe.lastIndexOf("/")+1)),fe.slice(0,Q.length)!=Q))for(;Q.length>0&&(Q=Q.slice(0,Q.length-1),Q=Q.slice(0,Q.lastIndexOf("/")+1),fe.slice(0,Q.length)!=Q););var Ve=(ne[1]||"").match(/boundary="(.*?)"/);if(!Ve)throw new Error("MAD cannot find boundary");var nt="--"+(Ve[1]||""),Ye=[],st=[],it={FileIndex:Ye,FullPaths:st};De(it);var Mt,Zt=0;for(me=0;me<ne.length;++me){var $t=ne[me];$t!==nt&&$t!==nt+"--"||(Zt++&&bh(it,ne.slice(Mt,me),Q),Mt=me)}return it}function ze(U,ae){var Q=ae||{},ne=Q.boundary||"SheetJS";ne="------="+ne;for(var me=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+ne.slice(2)+'"',"","",""],fe=U.FullPaths[0],Ve=fe,nt=U.FileIndex[0],Ye=1;Ye<U.FullPaths.length;++Ye)if(Ve=U.FullPaths[Ye].slice(fe.length),nt=U.FileIndex[Ye],!(!nt.size||!nt.content||Ve=="Sh33tJ5")){Ve=Ve.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Vr){return"_x"+Vr.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Vr){return"_u"+Vr.charCodeAt(0).toString(16)+"_"});for(var st=nt.content,it=fn&&Buffer.isBuffer(st)?st.toString("binary"):yr(st),Mt=0,Zt=Math.min(1024,it.length),$t=0,Kt=0;Kt<=Zt;++Kt)($t=it.charCodeAt(Kt))>=32&&$t<128&&++Mt;var mr=Mt>=Zt*4/5;me.push(ne),me.push("Content-Location: "+(Q.root||"file:///C:/SheetJS/")+Ve),me.push("Content-Transfer-Encoding: "+(mr?"quoted-printable":"base64")),me.push("Content-Type: "+oc(nt,Ve)),me.push(""),me.push(mr?bt(it):tu(it))}return me.push(ne+`--\r
`),me.join(`\r
`)}function Y(U){var ae={};return De(ae,U),ae}function se(U,ae,Q,ne){var me=ne&&ne.unsafe;me||De(U);var fe=!me&&Tn.find(U,ae);if(!fe){var Ve=U.FullPaths[0];ae.slice(0,Ve.length)==Ve?Ve=ae:(Ve.slice(-1)!="/"&&(Ve+="/"),Ve=(Ve+ae).replace("//","/")),fe={name:m(ae),type:2},U.FileIndex.push(fe),U.FullPaths.push(Ve),me||Tn.utils.cfb_gc(U)}return fe.content=Q,fe.size=Q?Q.length:0,ne&&(ne.CLSID&&(fe.clsid=ne.CLSID),ne.mt&&(fe.mt=ne.mt),ne.ct&&(fe.ct=ne.ct)),fe}function ve(U,ae){De(U);var Q=Tn.find(U,ae);if(Q){for(var ne=0;ne<U.FileIndex.length;++ne)if(U.FileIndex[ne]==Q)return U.FileIndex.splice(ne,1),U.FullPaths.splice(ne,1),!0}return!1}function Me(U,ae,Q){De(U);var ne=Tn.find(U,ae);if(ne){for(var me=0;me<U.FileIndex.length;++me)if(U.FileIndex[me]==ne)return U.FileIndex[me].name=m(Q),U.FullPaths[me]=Q,!0}return!1}function Pe(U){Ge(U,!0)}return r.find=tt,r.read=He,r.parse=B,r.write=vr,r.writeFile=sr,r.utils={cfb_new:Y,cfb_add:se,cfb_del:ve,cfb_mov:Me,cfb_gc:Pe,ReadShift:Xg,CheckField:DD,prep_blob:ma,bconcat:Ks,use_zlib:Ue,_deflateRaw:Yo,_inflateRaw:Gi,consts:ei},r}();function l8(t){return typeof t=="string"?P1(t):Array.isArray(t)?Oj(t):t}function O_(t,r,s){if(typeof Deno<"u"){if(s&&typeof r=="string")switch(s){case"utf8":r=new TextEncoder(s).encode(r);break;case"binary":r=P1(r);break;default:throw new Error("Unsupported encoding "+s)}return Deno.writeFileSync(t,r)}var u=s=="utf8"?b_(r):r;if(typeof IE_SaveFile<"u")return IE_SaveFile(u,t);if(typeof Blob<"u"){var m=new Blob([l8(u)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(m,t);if(typeof saveAs<"u")return saveAs(m,t);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var v=URL.createObjectURL(m);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(v)},6e4),chrome.downloads.download({url:v,filename:t,saveAs:!0});var T=document.createElement("a");if(T.download!=null)return T.download=t,T.href=v,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(v)},6e4),v}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var a=File(t);return a.open("w"),a.encoding="binary",Array.isArray(r)&&(r=D_(r)),a.write(r),a.close(),r}catch(R){if(!R.message||!R.message.match(/onstruct/))throw R}throw new Error("cannot save file "+t)}function to(t){for(var r=Object.keys(t),s=[],u=0;u<r.length;++u)Object.prototype.hasOwnProperty.call(t,r[u])&&s.push(r[u]);return s}function R3(t,r){for(var s=[],u=to(t),m=0;m!==u.length;++m)s[t[u[m]][r]]==null&&(s[t[u[m]][r]]=u[m]);return s}function NS(t){for(var r=[],s=to(t),u=0;u!==s.length;++u)r[t[s[u]]]=s[u];return r}function M1(t){for(var r=[],s=to(t),u=0;u!==s.length;++u)r[t[s[u]]]=parseInt(s[u],10);return r}function c8(t){for(var r=[],s=to(t),u=0;u!==s.length;++u)r[t[s[u]]]==null&&(r[t[s[u]]]=[]),r[t[s[u]]].push(s[u]);return r}var Yv=new Date(1899,11,30,0,0,0);function Xo(t,r){var s=t.getTime(),u=Yv.getTime()+(t.getTimezoneOffset()-Yv.getTimezoneOffset())*6e4;return(s-u)/(24*60*60*1e3)}var gD=new Date,u8=Yv.getTime()+(gD.getTimezoneOffset()-Yv.getTimezoneOffset())*6e4,M3=gD.getTimezoneOffset();function _D(t){var r=new Date;return r.setTime(t*24*60*60*1e3+u8),r.getTimezoneOffset()!==M3&&r.setTime(r.getTime()+(r.getTimezoneOffset()-M3)*6e4),r}var D3=new Date("2017-02-19T19:06:09.000Z"),yD=isNaN(D3.getFullYear())?new Date("2/19/17"):D3,h8=yD.getFullYear()==2017;function Lo(t,r){var s=new Date(t);if(h8)return r>0?s.setTime(s.getTime()+s.getTimezoneOffset()*60*1e3):r<0&&s.setTime(s.getTime()-s.getTimezoneOffset()*60*1e3),s;if(t instanceof Date)return t;if(yD.getFullYear()==1917&&!isNaN(s.getFullYear())){var u=s.getFullYear();return t.indexOf(""+u)>-1||s.setFullYear(s.getFullYear()+100),s}var m=t.match(/\d+/g)||["2017","2","19","0","0","0"],v=new Date(+m[0],+m[1]-1,+m[2],+m[3]||0,+m[4]||0,+m[5]||0);return t.indexOf("Z")>-1&&(v=new Date(v.getTime()-v.getTimezoneOffset()*60*1e3)),v}function D1(t,r){if(fn&&Buffer.isBuffer(t))return t.toString("binary");if(typeof TextDecoder<"u")try{var s={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[]/g,function(v){return s[v]||v})}catch{}for(var u=[],m=0;m!=t.length;++m)u.push(String.fromCharCode(t[m]));return u.join("")}function Ko(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=Ko(t[s]));return r}function ns(t,r){for(var s="";s.length<r;)s+=t;return s}function Gc(t){var r=Number(t);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(t))return r;var s=1,u=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return s*=100,""});return!isNaN(r=Number(u))||(u=u.replace(/[(](.*)[)]/,function(m,v){return s=-s,v}),!isNaN(r=Number(u)))?r/s:r}var d8=["january","february","march","april","may","june","july","august","september","october","november","december"];function w_(t){var r=new Date(t),s=new Date(NaN),u=r.getYear(),m=r.getMonth(),v=r.getDate();if(isNaN(v))return s;var T=t.toLowerCase();if(T.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(T=T.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),T.length>3&&d8.indexOf(T)==-1)return s}else if(T.match(/[a-z]/))return s;return u<0||u>8099?s:(m>0||v>1)&&u!=101?r:t.match(/[^-0-9:,\/\\]/)?s:r}function Fi(t,r,s){if(t.FullPaths){if(typeof s=="string"){var u;return fn?u=eu(s):u=Lj(s),Tn.utils.cfb_add(t,r,u)}Tn.utils.cfb_add(t,r,s)}else t.file(r,s)}function zS(){return Tn.utils.cfb_new()}var ys=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,f8={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},BS=NS(f8),jS=/[&<>'"]/g,p8=/[\u0000-\u0008\u000b-\u001f]/g;function yn(t){var r=t+"";return r.replace(jS,function(s){return BS[s]}).replace(p8,function(s){return"_x"+("000"+s.charCodeAt(0).toString(16)).slice(-4)+"_"})}function O3(t){return yn(t).replace(/ /g,"_x0020_")}var xD=/[\u0000-\u001f]/g;function m8(t){var r=t+"";return r.replace(jS,function(s){return BS[s]}).replace(/\n/g,"<br/>").replace(xD,function(s){return"&#x"+("000"+s.charCodeAt(0).toString(16)).slice(-4)+";"})}function g8(t){var r=t+"";return r.replace(jS,function(s){return BS[s]}).replace(xD,function(s){return"&#x"+s.charCodeAt(0).toString(16).toUpperCase()+";"})}function _8(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function y8(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function _2(t){for(var r="",s=0,u=0,m=0,v=0,T=0,a=0;s<t.length;){if(u=t.charCodeAt(s++),u<128){r+=String.fromCharCode(u);continue}if(m=t.charCodeAt(s++),u>191&&u<224){T=(u&31)<<6,T|=m&63,r+=String.fromCharCode(T);continue}if(v=t.charCodeAt(s++),u<240){r+=String.fromCharCode((u&15)<<12|(m&63)<<6|v&63);continue}T=t.charCodeAt(s++),a=((u&7)<<18|(m&63)<<12|(v&63)<<6|T&63)-65536,r+=String.fromCharCode(55296+(a>>>10&1023)),r+=String.fromCharCode(56320+(a&1023))}return r}function L3(t){var r=Od(2*t.length),s,u,m=1,v=0,T=0,a;for(u=0;u<t.length;u+=m)m=1,(a=t.charCodeAt(u))<128?s=a:a<224?(s=(a&31)*64+(t.charCodeAt(u+1)&63),m=2):a<240?(s=(a&15)*4096+(t.charCodeAt(u+1)&63)*64+(t.charCodeAt(u+2)&63),m=3):(m=4,s=(a&7)*262144+(t.charCodeAt(u+1)&63)*4096+(t.charCodeAt(u+2)&63)*64+(t.charCodeAt(u+3)&63),s-=65536,T=55296+(s>>>10&1023),s=56320+(s&1023)),T!==0&&(r[v++]=T&255,r[v++]=T>>>8,T=0),r[v++]=s%256,r[v++]=s>>>8;return r.slice(0,v).toString("ucs2")}function F3(t){return eu(t,"binary").toString("utf8")}var rv="foo bar baz",Zg=fn&&(F3(rv)==_2(rv)&&F3||L3(rv)==_2(rv)&&L3)||_2,b_=fn?function(t){return eu(t,"utf8").toString("binary")}:function(t){for(var r=[],s=0,u=0,m=0;s<t.length;)switch(u=t.charCodeAt(s++),!0){case u<128:r.push(String.fromCharCode(u));break;case u<2048:r.push(String.fromCharCode(192+(u>>6))),r.push(String.fromCharCode(128+(u&63)));break;case(u>=55296&&u<57344):u-=55296,m=t.charCodeAt(s++)-56320+(u<<10),r.push(String.fromCharCode(240+(m>>18&7))),r.push(String.fromCharCode(144+(m>>12&63))),r.push(String.fromCharCode(128+(m>>6&63))),r.push(String.fromCharCode(128+(m&63)));break;default:r.push(String.fromCharCode(224+(u>>12))),r.push(String.fromCharCode(128+(u>>6&63))),r.push(String.fromCharCode(128+(u&63)))}return r.join("")},x8=function(){var t=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(s){for(var u=s.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),m=0;m<t.length;++m)u=u.replace(t[m][0],t[m][1]);return u}}(),vD=/(^\s|\s$|\n)/;function Ys(t,r){return"<"+t+(r.match(vD)?' xml:space="preserve"':"")+">"+r+"</"+t+">"}function T_(t){return to(t).map(function(r){return" "+r+'="'+t[r]+'"'}).join("")}function Cr(t,r,s){return"<"+t+(s!=null?T_(s):"")+(r!=null?(r.match(vD)?' xml:space="preserve"':"")+">"+r+"</"+t:"/")+">"}function RT(t,r){try{return t.toISOString().replace(/\.\d*/,"")}catch(s){if(r)throw s}return""}function v8(t,r){switch(typeof t){case"string":var s=Cr("vt:lpwstr",yn(t));return s=s.replace(/&quot;/g,"_x0022_"),s;case"number":return Cr((t|0)==t?"vt:i4":"vt:r8",yn(String(t)));case"boolean":return Cr("vt:bool",t?"true":"false")}if(t instanceof Date)return Cr("vt:filetime",RT(t));throw new Error("Unable to serialize "+t)}var Bs={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},xm=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],ga={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function w8(t,r){for(var s=1-2*(t[r+7]>>>7),u=((t[r+7]&127)<<4)+(t[r+6]>>>4&15),m=t[r+6]&15,v=5;v>=0;--v)m=m*256+t[r+v];return u==2047?m==0?s*(1/0):NaN:(u==0?u=-1022:(u-=1023,m+=Math.pow(2,52)),s*Math.pow(2,u-52)*m)}function b8(t,r,s){var u=(r<0||1/r==-1/0?1:0)<<7,m=0,v=0,T=u?-r:r;isFinite(T)?T==0?m=v=0:(m=Math.floor(Math.log(T)/Math.LN2),v=T*Math.pow(2,52-m),m<=-1023&&(!isFinite(v)||v<Math.pow(2,52))?m=-1022:(v-=Math.pow(2,52),m+=1023)):(m=2047,v=isNaN(r)?26985:0);for(var a=0;a<=5;++a,v/=256)t[s+a]=v&255;t[s+6]=(m&15)<<4|v&15,t[s+7]=m>>4|u}var N3=function(t){for(var r=[],s=10240,u=0;u<t[0].length;++u)if(t[0][u])for(var m=0,v=t[0][u].length;m<v;m+=s)r.push.apply(r,t[0][u].slice(m,m+s));return r},z3=fn?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(r){return Buffer.isBuffer(r)?r:eu(r)})):N3(t)}:N3,B3=function(t,r,s){for(var u=[],m=r;m<s;m+=2)u.push(String.fromCharCode(Og(t,m)));return u.join("").replace(qg,"")},US=fn?function(t,r,s){return Buffer.isBuffer(t)?t.toString("utf16le",r,s).replace(qg,""):B3(t,r,s)}:B3,j3=function(t,r,s){for(var u=[],m=r;m<r+s;++m)u.push(("0"+t[m].toString(16)).slice(-2));return u.join("")},wD=fn?function(t,r,s){return Buffer.isBuffer(t)?t.toString("hex",r,r+s):j3(t,r,s)}:j3,U3=function(t,r,s){for(var u=[],m=r;m<s;m++)u.push(String.fromCharCode(Op(t,m)));return u.join("")},L_=fn?function(r,s,u){return Buffer.isBuffer(r)?r.toString("utf8",s,u):U3(r,s,u)}:U3,bD=function(t,r){var s=_a(t,r);return s>0?L_(t,r+4,r+4+s-1):""},TD=bD,SD=function(t,r){var s=_a(t,r);return s>0?L_(t,r+4,r+4+s-1):""},ED=SD,AD=function(t,r){var s=2*_a(t,r);return s>0?L_(t,r+4,r+4+s-1):""},ID=AD,CD=function(r,s){var u=_a(r,s);return u>0?US(r,s+4,s+4+u):""},PD=CD,kD=function(t,r){var s=_a(t,r);return s>0?L_(t,r+4,r+4+s):""},RD=kD,MD=function(t,r){return w8(t,r)},Jv=MD,VS=function(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};fn&&(TD=function(r,s){if(!Buffer.isBuffer(r))return bD(r,s);var u=r.readUInt32LE(s);return u>0?r.toString("utf8",s+4,s+4+u-1):""},ED=function(r,s){if(!Buffer.isBuffer(r))return SD(r,s);var u=r.readUInt32LE(s);return u>0?r.toString("utf8",s+4,s+4+u-1):""},ID=function(r,s){if(!Buffer.isBuffer(r))return AD(r,s);var u=2*r.readUInt32LE(s);return r.toString("utf16le",s+4,s+4+u-1)},PD=function(r,s){if(!Buffer.isBuffer(r))return CD(r,s);var u=r.readUInt32LE(s);return r.toString("utf16le",s+4,s+4+u)},RD=function(r,s){if(!Buffer.isBuffer(r))return kD(r,s);var u=r.readUInt32LE(s);return r.toString("utf8",s+4,s+4+u)},Jv=function(r,s){return Buffer.isBuffer(r)?r.readDoubleLE(s):MD(r,s)},VS=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var Op=function(t,r){return t[r]},Og=function(t,r){return t[r+1]*256+t[r]},T8=function(t,r){var s=t[r+1]*256+t[r];return s<32768?s:(65535-s+1)*-1},_a=function(t,r){return t[r+3]*(1<<24)+(t[r+2]<<16)+(t[r+1]<<8)+t[r]},wd=function(t,r){return t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]},S8=function(t,r){return t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3]};function Xg(t,r){var s="",u,m,v=[],T,a,R,O;switch(r){case"dbcs":if(O=this.l,fn&&Buffer.isBuffer(this))s=this.slice(this.l,this.l+2*t).toString("utf16le");else for(R=0;R<t;++R)s+=String.fromCharCode(Og(this,O)),O+=2;t*=2;break;case"utf8":s=L_(this,this.l,this.l+t);break;case"utf16le":t*=2,s=US(this,this.l,this.l+t);break;case"wstr":return Xg.call(this,t,"dbcs");case"lpstr-ansi":s=TD(this,this.l),t=4+_a(this,this.l);break;case"lpstr-cp":s=ED(this,this.l),t=4+_a(this,this.l);break;case"lpwstr":s=ID(this,this.l),t=4+2*_a(this,this.l);break;case"lpp4":t=4+_a(this,this.l),s=PD(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+_a(this,this.l),s=RD(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,s="";(T=Op(this,this.l+t++))!==0;)v.push(Qx(T));s=v.join("");break;case"_wstr":for(t=0,s="";(T=Og(this,this.l+t))!==0;)v.push(Qx(T)),t+=2;t+=2,s=v.join("");break;case"dbcs-cont":for(s="",O=this.l,R=0;R<t;++R){if(this.lens&&this.lens.indexOf(O)!==-1)return T=Op(this,O),this.l=O+1,a=Xg.call(this,t-R,T?"dbcs-cont":"sbcs-cont"),v.join("")+a;v.push(Qx(Og(this,O))),O+=2}s=v.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(s="",O=this.l,R=0;R!=t;++R){if(this.lens&&this.lens.indexOf(O)!==-1)return T=Op(this,O),this.l=O+1,a=Xg.call(this,t-R,T?"dbcs-cont":"sbcs-cont"),v.join("")+a;v.push(Qx(Op(this,O))),O+=1}s=v.join("");break;default:switch(t){case 1:return u=Op(this,this.l),this.l++,u;case 2:return u=(r==="i"?T8:Og)(this,this.l),this.l+=2,u;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(u=(t>0?wd:S8)(this,this.l),this.l+=4,u):(m=_a(this,this.l),this.l+=4,m);case 8:case-8:if(r==="f")return t==8?m=Jv(this,this.l):m=Jv([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,m;t=8;case 16:s=wD(this,this.l,t);break}}return this.l+=t,s}var E8=function(t,r,s){t[s]=r&255,t[s+1]=r>>>8&255,t[s+2]=r>>>16&255,t[s+3]=r>>>24&255},A8=function(t,r,s){t[s]=r&255,t[s+1]=r>>8&255,t[s+2]=r>>16&255,t[s+3]=r>>24&255},I8=function(t,r,s){t[s]=r&255,t[s+1]=r>>>8&255};function C8(t,r,s){var u=0,m=0;if(s==="dbcs"){for(m=0;m!=r.length;++m)I8(this,r.charCodeAt(m),this.l+2*m);u=2*r.length}else if(s==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),m=0;m!=r.length;++m)this[this.l+m]=r.charCodeAt(m)&255;u=r.length}else if(s==="hex"){for(;m<t;++m)this[this.l++]=parseInt(r.slice(2*m,2*m+2),16)||0;return this}else if(s==="utf16le"){var v=Math.min(this.l+t,this.length);for(m=0;m<Math.min(r.length,t);++m){var T=r.charCodeAt(m);this[this.l++]=T&255,this[this.l++]=T>>8}for(;this.l<v;)this[this.l++]=0;return this}else switch(t){case 1:u=1,this[this.l]=r&255;break;case 2:u=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:u=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:u=4,E8(this,r,this.l);break;case 8:if(u=8,s==="f"){b8(this,r,this.l);break}case 16:break;case-4:u=4,A8(this,r,this.l);break}return this.l+=u,this}function DD(t,r){var s=wD(this,this.l,t.length>>1);if(s!==t)throw new Error(r+"Expected "+t+" saw "+s);this.l+=t.length>>1}function ma(t,r){t.l=r,t.read_shift=Xg,t.chk=DD,t.write_shift=C8}function sc(t,r){t.l+=r}function Vt(t){var r=Od(t);return ma(r,0),r}function Zo(){var t=[],r=fn?256:2048,s=function(O){var B=Vt(O);return ma(B,0),B},u=s(r),m=function(){u&&(u.length>u.l&&(u=u.slice(0,u.l),u.l=u.length),u.length>0&&t.push(u),u=null)},v=function(O){return u&&O<u.length-u.l?u:(m(),u=s(Math.max(O+1,r)))},T=function(){return m(),Ks(t)},a=function(O){m(),u=O,u.l==null&&(u.l=u.length),v(r)};return{next:v,push:a,end:T,_bufs:t}}function or(t,r,s,u){var m=+r,v;if(!isNaN(m)){u||(u=wG[m].p||(s||[]).length||0),v=1+(m>=128?1:0)+1,u>=128&&++v,u>=16384&&++v,u>=2097152&&++v;var T=t.next(v);m<=127?T.write_shift(1,m):(T.write_shift(1,(m&127)+128),T.write_shift(1,m>>7));for(var a=0;a!=4;++a)if(u>=128)T.write_shift(1,(u&127)+128),u>>=7;else{T.write_shift(1,u);break}u>0&&VS(s)&&t.push(s)}}function Kg(t,r,s){var u=Ko(t);if(r.s?(u.cRel&&(u.c+=r.s.c),u.rRel&&(u.r+=r.s.r)):(u.cRel&&(u.c+=r.c),u.rRel&&(u.r+=r.r)),!s||s.biff<12){for(;u.c>=256;)u.c-=256;for(;u.r>=65536;)u.r-=65536}return u}function V3(t,r,s){var u=Ko(t);return u.s=Kg(u.s,r.s,s),u.e=Kg(u.e,r.s,s),u}function Yg(t,r){if(t.cRel&&t.c<0)for(t=Ko(t);t.c<0;)t.c+=r>8?16384:256;if(t.rRel&&t.r<0)for(t=Ko(t);t.r<0;)t.r+=r>8?1048576:r>5?65536:16384;var s=vn(t);return!t.cRel&&t.cRel!=null&&(s=R8(s)),!t.rRel&&t.rRel!=null&&(s=P8(s)),s}function y2(t,r){return t.s.r==0&&!t.s.rRel&&t.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+ho(t.s.c)+":"+(t.e.cRel?"":"$")+ho(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(r.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+Qs(t.s.r)+":"+(t.e.rRel?"":"$")+Qs(t.e.r):Yg(t.s,r.biff)+":"+Yg(t.e,r.biff)}function $S(t){return parseInt(k8(t),10)-1}function Qs(t){return""+(t+1)}function P8(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function k8(t){return t.replace(/\$(\d+)$/,"$1")}function GS(t){for(var r=M8(t),s=0,u=0;u!==r.length;++u)s=26*s+r.charCodeAt(u)-64;return s-1}function ho(t){if(t<0)throw new Error("invalid column "+t);var r="";for(++t;t;t=Math.floor((t-1)/26))r=String.fromCharCode((t-1)%26+65)+r;return r}function R8(t){return t.replace(/^([A-Z])/,"$$$1")}function M8(t){return t.replace(/^\$([A-Z])/,"$1")}function D8(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function js(t){for(var r=0,s=0,u=0;u<t.length;++u){var m=t.charCodeAt(u);m>=48&&m<=57?r=10*r+(m-48):m>=65&&m<=90&&(s=26*s+(m-64))}return{c:s-1,r:r-1}}function vn(t){for(var r=t.c+1,s="";r;r=(r-1)/26|0)s=String.fromCharCode((r-1)%26+65)+s;return s+(t.r+1)}function ba(t){var r=t.indexOf(":");return r==-1?{s:js(t),e:js(t)}:{s:js(t.slice(0,r)),e:js(t.slice(r+1))}}function _s(t,r){return typeof r>"u"||typeof r=="number"?_s(t.s,t.e):(typeof t!="string"&&(t=vn(t)),typeof r!="string"&&(r=vn(r)),t==r?t:t+":"+r)}function Un(t){var r={s:{c:0,r:0},e:{c:0,r:0}},s=0,u=0,m=0,v=t.length;for(s=0;u<v&&!((m=t.charCodeAt(u)-64)<1||m>26);++u)s=26*s+m;for(r.s.c=--s,s=0;u<v&&!((m=t.charCodeAt(u)-48)<0||m>9);++u)s=10*s+m;if(r.s.r=--s,u===v||m!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++u,s=0;u!=v&&!((m=t.charCodeAt(u)-64)<1||m>26);++u)s=26*s+m;for(r.e.c=--s,s=0;u!=v&&!((m=t.charCodeAt(u)-48)<0||m>9);++u)s=10*s+m;return r.e.r=--s,r}function $3(t,r){var s=t.t=="d"&&r instanceof Date;if(t.z!=null)try{return t.w=ph(t.z,s?Xo(r):r)}catch{}try{return t.w=ph((t.XF||{}).numFmtId||(s?14:0),s?Xo(r):r)}catch{return""+r}}function Jc(t,r,s){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&s&&s.dateNF&&(t.z=s.dateNF),t.t=="e"?F_[t.v]||t.v:r==null?$3(t,t.v):$3(t,r))}function Vd(t,r){var s=r&&r.sheet?r.sheet:"Sheet1",u={};return u[s]=t,{SheetNames:[s],Sheets:u}}function OD(t,r,s){var u=s||{},m=t?Array.isArray(t):u.dense,v=t||(m?[]:{}),T=0,a=0;if(v&&u.origin!=null){if(typeof u.origin=="number")T=u.origin;else{var R=typeof u.origin=="string"?js(u.origin):u.origin;T=R.r,a=R.c}v["!ref"]||(v["!ref"]="A1:A1")}var O={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(v["!ref"]){var B=Un(v["!ref"]);O.s.c=B.s.c,O.s.r=B.s.r,O.e.c=Math.max(O.e.c,B.e.c),O.e.r=Math.max(O.e.r,B.e.r),T==-1&&(O.e.r=T=B.e.r+1)}for(var H=0;H!=r.length;++H)if(r[H]){if(!Array.isArray(r[H]))throw new Error("aoa_to_sheet expects an array of arrays");for(var q=0;q!=r[H].length;++q)if(!(typeof r[H][q]>"u")){var ee={v:r[H][q]},re=T+H,J=a+q;if(O.s.r>re&&(O.s.r=re),O.s.c>J&&(O.s.c=J),O.e.r<re&&(O.e.r=re),O.e.c<J&&(O.e.c=J),r[H][q]&&typeof r[H][q]=="object"&&!Array.isArray(r[H][q])&&!(r[H][q]instanceof Date))ee=r[H][q];else if(Array.isArray(ee.v)&&(ee.f=r[H][q][1],ee.v=ee.v[0]),ee.v===null)if(ee.f)ee.t="n";else if(u.nullError)ee.t="e",ee.v=0;else if(u.sheetStubs)ee.t="z";else continue;else typeof ee.v=="number"?ee.t="n":typeof ee.v=="boolean"?ee.t="b":ee.v instanceof Date?(ee.z=u.dateNF||ss[14],u.cellDates?(ee.t="d",ee.w=ph(ee.z,Xo(ee.v))):(ee.t="n",ee.v=Xo(ee.v),ee.w=ph(ee.z,ee.v))):ee.t="s";if(m)v[re]||(v[re]=[]),v[re][J]&&v[re][J].z&&(ee.z=v[re][J].z),v[re][J]=ee;else{var _e=vn({c:J,r:re});v[_e]&&v[_e].z&&(ee.z=v[_e].z),v[_e]=ee}}}return O.s.c<1e7&&(v["!ref"]=_s(O)),v}function vm(t,r){return OD(null,t,r)}function O8(t){return t.read_shift(4,"i")}function xl(t,r){return r||(r=Vt(4)),r.write_shift(4,t),r}function fo(t){var r=t.read_shift(4);return r===0?"":t.read_shift(r,"dbcs")}function Us(t,r){var s=!1;return r==null&&(s=!0,r=Vt(4+2*t.length)),r.write_shift(4,t.length),t.length>0&&r.write_shift(0,t,"dbcs"),s?r.slice(0,r.l):r}function L8(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function F8(t,r){return r||(r=Vt(4)),r.write_shift(2,0),r.write_shift(2,0),r}function HS(t,r){var s=t.l,u=t.read_shift(1),m=fo(t),v=[],T={t:m,h:m};if(u&1){for(var a=t.read_shift(4),R=0;R!=a;++R)v.push(L8(t));T.r=v}else T.r=[{ich:0,ifnt:0}];return t.l=s+r,T}function N8(t,r){var s=!1;return r==null&&(s=!0,r=Vt(15+4*t.t.length)),r.write_shift(1,0),Us(t.t,r),s?r.slice(0,r.l):r}var z8=HS;function B8(t,r){var s=!1;return r==null&&(s=!0,r=Vt(23+4*t.t.length)),r.write_shift(1,1),Us(t.t,r),r.write_shift(4,1),F8({ich:0,ifnt:0},r),s?r.slice(0,r.l):r}function Ha(t){var r=t.read_shift(4),s=t.read_shift(2);return s+=t.read_shift(1)<<16,t.l++,{c:r,iStyleRef:s}}function $d(t,r){return r==null&&(r=Vt(8)),r.write_shift(-4,t.c),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}function Gd(t){var r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:r}}function Hd(t,r){return r==null&&(r=Vt(4)),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}var j8=fo,LD=Us;function WS(t){var r=t.read_shift(4);return r===0||r===4294967295?"":t.read_shift(r,"dbcs")}function Qv(t,r){var s=!1;return r==null&&(s=!0,r=Vt(127)),r.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&r.write_shift(0,t,"dbcs"),s?r.slice(0,r.l):r}var U8=fo,MT=WS,qS=Qv;function FD(t){var r=t.slice(t.l,t.l+4),s=r[0]&1,u=r[0]&2;t.l+=4;var m=u===0?Jv([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):wd(r,0)>>2;return s?m/100:m}function ND(t,r){r==null&&(r=Vt(4));var s=0,u=0,m=t*100;if(t==(t|0)&&t>=-(1<<29)&&t<1<<29?u=1:m==(m|0)&&m>=-(1<<29)&&m<1<<29&&(u=1,s=1),u)r.write_shift(-4,((s?m:t)<<2)+(s+2));else throw new Error("unsupported RkNumber "+t)}function zD(t){var r={s:{},e:{}};return r.s.r=t.read_shift(4),r.e.r=t.read_shift(4),r.s.c=t.read_shift(4),r.e.c=t.read_shift(4),r}function V8(t,r){return r||(r=Vt(16)),r.write_shift(4,t.s.r),r.write_shift(4,t.e.r),r.write_shift(4,t.s.c),r.write_shift(4,t.e.c),r}var Wd=zD,wm=V8;function bm(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function Ld(t,r){return(r||Vt(8)).write_shift(8,t,"f")}function $8(t){var r={},s=t.read_shift(1),u=s>>>1,m=t.read_shift(1),v=t.read_shift(2,"i"),T=t.read_shift(1),a=t.read_shift(1),R=t.read_shift(1);switch(t.l++,u){case 0:r.auto=1;break;case 1:r.index=m;var O=J8[m];O&&(r.rgb=ek(O));break;case 2:r.rgb=ek([T,a,R]);break;case 3:r.theme=m;break}return v!=0&&(r.tint=v>0?v/32767:v/32768),r}function e1(t,r){if(r||(r=Vt(8)),!t||t.auto)return r.write_shift(4,0),r.write_shift(4,0),r;t.index!=null?(r.write_shift(1,2),r.write_shift(1,t.index)):t.theme!=null?(r.write_shift(1,6),r.write_shift(1,t.theme)):(r.write_shift(1,5),r.write_shift(1,0));var s=t.tint||0;if(s>0?s*=32767:s<0&&(s*=32768),r.write_shift(2,s),!t.rgb||t.theme!=null)r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);else{var u=t.rgb||"FFFFFF";typeof u=="number"&&(u=("000000"+u.toString(16)).slice(-6)),r.write_shift(1,parseInt(u.slice(0,2),16)),r.write_shift(1,parseInt(u.slice(2,4),16)),r.write_shift(1,parseInt(u.slice(4,6),16)),r.write_shift(1,255)}return r}function G8(t){var r=t.read_shift(1);t.l++;var s={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return s}function H8(t,r){r||(r=Vt(2));var s=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return r.write_shift(1,s),r.write_shift(1,0),r}var BD=2,fa=3,iv=11,t1=19,nv=64,W8=65,q8=71,Z8=4108,X8=4126,Xs=80,G3={1:{n:"CodePage",t:BD},2:{n:"Category",t:Xs},3:{n:"PresentationFormat",t:Xs},4:{n:"ByteCount",t:fa},5:{n:"LineCount",t:fa},6:{n:"ParagraphCount",t:fa},7:{n:"SlideCount",t:fa},8:{n:"NoteCount",t:fa},9:{n:"HiddenCount",t:fa},10:{n:"MultimediaClipCount",t:fa},11:{n:"ScaleCrop",t:iv},12:{n:"HeadingPairs",t:Z8},13:{n:"TitlesOfParts",t:X8},14:{n:"Manager",t:Xs},15:{n:"Company",t:Xs},16:{n:"LinksUpToDate",t:iv},17:{n:"CharacterCount",t:fa},19:{n:"SharedDoc",t:iv},22:{n:"HyperlinksChanged",t:iv},23:{n:"AppVersion",t:fa,p:"version"},24:{n:"DigSig",t:W8},26:{n:"ContentType",t:Xs},27:{n:"ContentStatus",t:Xs},28:{n:"Language",t:Xs},29:{n:"Version",t:Xs},255:{},2147483648:{n:"Locale",t:t1},2147483651:{n:"Behavior",t:t1},1919054434:{}},H3={1:{n:"CodePage",t:BD},2:{n:"Title",t:Xs},3:{n:"Subject",t:Xs},4:{n:"Author",t:Xs},5:{n:"Keywords",t:Xs},6:{n:"Comments",t:Xs},7:{n:"Template",t:Xs},8:{n:"LastAuthor",t:Xs},9:{n:"RevNumber",t:Xs},10:{n:"EditTime",t:nv},11:{n:"LastPrinted",t:nv},12:{n:"CreatedDate",t:nv},13:{n:"ModifiedDate",t:nv},14:{n:"PageCount",t:fa},15:{n:"WordCount",t:fa},16:{n:"CharCount",t:fa},17:{n:"Thumbnail",t:q8},18:{n:"Application",t:Xs},19:{n:"DocSecurity",t:fa},255:{},2147483648:{n:"Locale",t:t1},2147483651:{n:"Behavior",t:t1},1919054434:{}};function K8(t){return t.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var Y8=K8([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),J8=Ko(Y8),F_={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},Q8={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},sv={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function jD(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function UD(t,r){var s=c8(Q8),u=[],m;u[u.length]=ys,u[u.length]=Cr("Types",null,{xmlns:Bs.CT,"xmlns:xsd":Bs.xsd,"xmlns:xsi":Bs.xsi}),u=u.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(R){return Cr("Default",null,{Extension:R[0],ContentType:R[1]})}));var v=function(R){t[R]&&t[R].length>0&&(m=t[R][0],u[u.length]=Cr("Override",null,{PartName:(m[0]=="/"?"":"/")+m,ContentType:sv[R][r.bookType]||sv[R].xlsx}))},T=function(R){(t[R]||[]).forEach(function(O){u[u.length]=Cr("Override",null,{PartName:(O[0]=="/"?"":"/")+O,ContentType:sv[R][r.bookType]||sv[R].xlsx})})},a=function(R){(t[R]||[]).forEach(function(O){u[u.length]=Cr("Override",null,{PartName:(O[0]=="/"?"":"/")+O,ContentType:s[R][0]})})};return v("workbooks"),T("sheets"),T("charts"),a("themes"),["strs","styles"].forEach(v),["coreprops","extprops","custprops"].forEach(a),a("vba"),a("comments"),a("threadedcomments"),a("drawings"),T("metadata"),a("people"),u.length>2&&(u[u.length]="</Types>",u[1]=u[1].replace("/>",">")),u.join("")}var ln={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function VD(t){var r=t.lastIndexOf("/");return t.slice(0,r+1)+"_rels/"+t.slice(r+1)+".rels"}function rm(t){var r=[ys,Cr("Relationships",null,{xmlns:Bs.RELS})];return to(t["!id"]).forEach(function(s){r[r.length]=Cr("Relationship",null,t["!id"][s])}),r.length>2&&(r[r.length]="</Relationships>",r[1]=r[1].replace("/>",">")),r.join("")}function _n(t,r,s,u,m,v){if(m||(m={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),r<0)for(r=t["!idx"];t["!id"]["rId"+r];++r);if(t["!idx"]=r+1,m.Id="rId"+r,m.Type=u,m.Target=s,[ln.HLINK,ln.XPATH,ln.XMISS].indexOf(m.Type)>-1&&(m.TargetMode="External"),t["!id"][m.Id])throw new Error("Cannot rewrite rId "+r);return t["!id"][m.Id]=m,t[("/"+m.Target).replace("//","/")]=m,r}function eU(t){var r=[ys];r.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),r.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var s=0;s<t.length;++s)r.push('  <manifest:file-entry manifest:full-path="'+t[s][0]+'" manifest:media-type="'+t[s][1]+`"/>
`);return r.push("</manifest:manifest>"),r.join("")}function W3(t,r,s){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(s||"odf")+"#"+r+`"/>
`,`  </rdf:Description>
`].join("")}function tU(t,r){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+r+`"/>
`,`  </rdf:Description>
`].join("")}function rU(t){var r=[ys];r.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var s=0;s!=t.length;++s)r.push(W3(t[s][0],t[s][1])),r.push(tU("",t[s][0]));return r.push(W3("","Document","pkg")),r.push("</rdf:RDF>"),r.join("")}function $D(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+qv.version+"</meta:generator></office:meta></office:document-meta>"}var Id=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function x2(t,r,s,u,m){m[t]!=null||r==null||r===""||(m[t]=r,r=yn(r),u[u.length]=s?Cr(t,r,s):Ys(t,r))}function GD(t,r){var s=r||{},u=[ys,Cr("cp:coreProperties",null,{"xmlns:cp":Bs.CORE_PROPS,"xmlns:dc":Bs.dc,"xmlns:dcterms":Bs.dcterms,"xmlns:dcmitype":Bs.dcmitype,"xmlns:xsi":Bs.xsi})],m={};if(!t&&!s.Props)return u.join("");t&&(t.CreatedDate!=null&&x2("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:RT(t.CreatedDate,s.WTF),{"xsi:type":"dcterms:W3CDTF"},u,m),t.ModifiedDate!=null&&x2("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:RT(t.ModifiedDate,s.WTF),{"xsi:type":"dcterms:W3CDTF"},u,m));for(var v=0;v!=Id.length;++v){var T=Id[v],a=s.Props&&s.Props[T[1]]!=null?s.Props[T[1]]:t?t[T[1]]:null;a===!0?a="1":a===!1?a="0":typeof a=="number"&&(a=String(a)),a!=null&&x2(T[0],a,null,u,m)}return u.length>2&&(u[u.length]="</cp:coreProperties>",u[1]=u[1].replace("/>",">")),u.join("")}var im=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],HD=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function WD(t){var r=[],s=Cr;return t||(t={}),t.Application="SheetJS",r[r.length]=ys,r[r.length]=Cr("Properties",null,{xmlns:Bs.EXT_PROPS,"xmlns:vt":Bs.vt}),im.forEach(function(u){if(t[u[1]]!==void 0){var m;switch(u[2]){case"string":m=yn(String(t[u[1]]));break;case"bool":m=t[u[1]]?"true":"false";break}m!==void 0&&(r[r.length]=s(u[0],m))}}),r[r.length]=s("HeadingPairs",s("vt:vector",s("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+s("vt:variant",s("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),r[r.length]=s("TitlesOfParts",s("vt:vector",t.SheetNames.map(function(u){return"<vt:lpstr>"+yn(u)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}function qD(t){var r=[ys,Cr("Properties",null,{xmlns:Bs.CUST_PROPS,"xmlns:vt":Bs.vt})];if(!t)return r.join("");var s=1;return to(t).forEach(function(m){++s,r[r.length]=Cr("property",v8(t[m]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:s,name:yn(m)})}),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}var q3={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function iU(t,r){var s=[];return to(q3).map(function(u){for(var m=0;m<Id.length;++m)if(Id[m][1]==u)return Id[m];for(m=0;m<im.length;++m)if(im[m][1]==u)return im[m];throw u}).forEach(function(u){if(t[u[1]]!=null){var m=r&&r.Props&&r.Props[u[1]]!=null?r.Props[u[1]]:t[u[1]];switch(u[2]){case"date":m=new Date(m).toISOString().replace(/\.\d*Z/,"Z");break}typeof m=="number"?m=String(m):m===!0||m===!1?m=m?"1":"0":m instanceof Date&&(m=new Date(m).toISOString().replace(/\.\d*Z/,"")),s.push(Ys(q3[u[1]]||u[1],m))}}),Cr("DocumentProperties",s.join(""),{xmlns:ga.o})}function nU(t,r){var s=["Worksheets","SheetNames"],u="CustomDocumentProperties",m=[];return t&&to(t).forEach(function(v){if(Object.prototype.hasOwnProperty.call(t,v)){for(var T=0;T<Id.length;++T)if(v==Id[T][1])return;for(T=0;T<im.length;++T)if(v==im[T][1])return;for(T=0;T<s.length;++T)if(v==s[T])return;var a=t[v],R="string";typeof a=="number"?(R="float",a=String(a)):a===!0||a===!1?(R="boolean",a=a?"1":"0"):a=String(a),m.push(Cr(O3(v),a,{"dt:dt":R}))}}),r&&to(r).forEach(function(v){if(Object.prototype.hasOwnProperty.call(r,v)&&!(t&&Object.prototype.hasOwnProperty.call(t,v))){var T=r[v],a="string";typeof T=="number"?(a="float",T=String(T)):T===!0||T===!1?(a="boolean",T=T?"1":"0"):T instanceof Date?(a="dateTime.tz",T=T.toISOString()):T=String(T),m.push(Cr(O3(v),T,{"dt:dt":a}))}}),"<"+u+' xmlns="'+ga.o+'">'+m.join("")+"</"+u+">"}function sU(t){var r=typeof t=="string"?new Date(Date.parse(t)):t,s=r.getTime()/1e3+11644473600,u=s%Math.pow(2,32),m=(s-u)/Math.pow(2,32);u*=1e7,m*=1e7;var v=u/Math.pow(2,32)|0;v>0&&(u=u%Math.pow(2,32),m+=v);var T=Vt(8);return T.write_shift(4,u),T.write_shift(4,m),T}function Z3(t,r){var s=Vt(4),u=Vt(4);switch(s.write_shift(4,t==80?31:t),t){case 3:u.write_shift(-4,r);break;case 5:u=Vt(8),u.write_shift(8,r,"f");break;case 11:u.write_shift(4,r?1:0);break;case 64:u=sU(r);break;case 31:case 80:for(u=Vt(4+2*(r.length+1)+(r.length%2?0:2)),u.write_shift(4,r.length+1),u.write_shift(0,r,"dbcs");u.l!=u.length;)u.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+r)}return Ks([s,u])}var ZD=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function oU(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function X3(t,r,s){var u=Vt(8),m=[],v=[],T=8,a=0,R=Vt(8),O=Vt(8);if(R.write_shift(4,2),R.write_shift(4,1200),O.write_shift(4,1),v.push(R),m.push(O),T+=8+R.length,!r){O=Vt(8),O.write_shift(4,0),m.unshift(O);var B=[Vt(4)];for(B[0].write_shift(4,t.length),a=0;a<t.length;++a){var H=t[a][0];for(R=Vt(8+2*(H.length+1)+(H.length%2?0:2)),R.write_shift(4,a+2),R.write_shift(4,H.length+1),R.write_shift(0,H,"dbcs");R.l!=R.length;)R.write_shift(1,0);B.push(R)}R=Ks(B),v.unshift(R),T+=8+R.length}for(a=0;a<t.length;++a)if(!(r&&!r[t[a][0]])&&!(ZD.indexOf(t[a][0])>-1||HD.indexOf(t[a][0])>-1)&&t[a][1]!=null){var q=t[a][1],ee=0;if(r){ee=+r[t[a][0]];var re=s[ee];if(re.p=="version"&&typeof q=="string"){var J=q.split(".");q=(+J[0]<<16)+(+J[1]||0)}R=Z3(re.t,q)}else{var _e=oU(q);_e==-1&&(_e=31,q=String(q)),R=Z3(_e,q)}v.push(R),O=Vt(8),O.write_shift(4,r?ee:2+a),m.push(O),T+=8+R.length}var pe=8*(v.length+1);for(a=0;a<v.length;++a)m[a].write_shift(4,pe),pe+=v[a].length;return u.write_shift(4,T),u.write_shift(4,v.length),Ks([u].concat(m).concat(v))}function K3(t,r,s,u,m,v){var T=Vt(m?68:48),a=[T];T.write_shift(2,65534),T.write_shift(2,0),T.write_shift(4,842412599),T.write_shift(16,Tn.utils.consts.HEADER_CLSID,"hex"),T.write_shift(4,m?2:1),T.write_shift(16,r,"hex"),T.write_shift(4,m?68:48);var R=X3(t,s,u);if(a.push(R),m){var O=X3(m,null,null);T.write_shift(16,v,"hex"),T.write_shift(4,68+R.length),a.push(O)}return Ks(a)}function aU(t,r){r||(r=Vt(t));for(var s=0;s<t;++s)r.write_shift(1,0);return r}function lU(t,r){return t.read_shift(r)===1}function Do(t,r){return r||(r=Vt(2)),r.write_shift(2,+!!t),r}function XD(t){return t.read_shift(2,"u")}function za(t,r){return r||(r=Vt(2)),r.write_shift(2,t),r}function KD(t,r,s){return s||(s=Vt(2)),s.write_shift(1,r=="e"?+t:+!!t),s.write_shift(1,r=="e"?1:0),s}function YD(t,r,s){var u=t.read_shift(s&&s.biff>=12?2:1),m="sbcs-cont";if(s&&s.biff>=8,!s||s.biff==8){var v=t.read_shift(1);v&&(m="dbcs-cont")}else s.biff==12&&(m="wstr");s.biff>=2&&s.biff<=5&&(m="cpstr");var T=u?t.read_shift(u,m):"";return T}function cU(t){var r=t.t||"",s=Vt(3);s.write_shift(2,r.length),s.write_shift(1,1);var u=Vt(2*r.length);u.write_shift(2*r.length,r,"utf16le");var m=[s,u];return Ks(m)}function uU(t,r,s){var u;if(s){if(s.biff>=2&&s.biff<=5)return t.read_shift(r,"cpstr");if(s.biff>=12)return t.read_shift(r,"dbcs-cont")}var m=t.read_shift(1);return m===0?u=t.read_shift(r,"sbcs-cont"):u=t.read_shift(r,"dbcs-cont"),u}function hU(t,r,s){var u=t.read_shift(s&&s.biff==2?1:2);return u===0?(t.l++,""):uU(t,u,s)}function dU(t,r,s){if(s.biff>5)return hU(t,r,s);var u=t.read_shift(1);return u===0?(t.l++,""):t.read_shift(u,s.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function JD(t,r,s){return s||(s=Vt(3+2*t.length)),s.write_shift(2,t.length),s.write_shift(1,1),s.write_shift(31,t,"utf16le"),s}function Y3(t,r){r||(r=Vt(6+t.length*2)),r.write_shift(4,1+t.length);for(var s=0;s<t.length;++s)r.write_shift(2,t.charCodeAt(s));return r.write_shift(2,0),r}function fU(t){var r=Vt(512),s=0,u=t.Target;u.slice(0,7)=="file://"&&(u=u.slice(7));var m=u.indexOf("#"),v=m>-1?31:23;switch(u.charAt(0)){case"#":v=28;break;case".":v&=-3;break}r.write_shift(4,2),r.write_shift(4,v);var T=[8,6815827,6619237,4849780,83];for(s=0;s<T.length;++s)r.write_shift(4,T[s]);if(v==28)u=u.slice(1),Y3(u,r);else if(v&2){for(T="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),s=0;s<T.length;++s)r.write_shift(1,parseInt(T[s],16));var a=m>-1?u.slice(0,m):u;for(r.write_shift(4,2*(a.length+1)),s=0;s<a.length;++s)r.write_shift(2,a.charCodeAt(s));r.write_shift(2,0),v&8&&Y3(m>-1?u.slice(m+1):"",r)}else{for(T="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),s=0;s<T.length;++s)r.write_shift(1,parseInt(T[s],16));for(var R=0;u.slice(R*3,R*3+3)=="../"||u.slice(R*3,R*3+3)=="..\\";)++R;for(r.write_shift(2,R),r.write_shift(4,u.length-3*R+1),s=0;s<u.length-3*R;++s)r.write_shift(1,u.charCodeAt(s+3*R)&255);for(r.write_shift(1,0),r.write_shift(2,65535),r.write_shift(2,57005),s=0;s<6;++s)r.write_shift(4,0)}return r.slice(0,r.l)}function Fd(t,r,s,u){return u||(u=Vt(6)),u.write_shift(2,t),u.write_shift(2,r),u.write_shift(2,s||0),u}function pU(t,r,s){var u=s.biff>8?4:2,m=t.read_shift(u),v=t.read_shift(u,"i"),T=t.read_shift(u,"i");return[m,v,T]}function mU(t){var r=t.read_shift(2),s=t.read_shift(2),u=t.read_shift(2),m=t.read_shift(2);return{s:{c:u,r},e:{c:m,r:s}}}function QD(t,r){return r||(r=Vt(8)),r.write_shift(2,t.s.r),r.write_shift(2,t.e.r),r.write_shift(2,t.s.c),r.write_shift(2,t.e.c),r}function ZS(t,r,s){var u=1536,m=16;switch(s.bookType){case"biff8":break;case"biff5":u=1280,m=8;break;case"biff4":u=4,m=6;break;case"biff3":u=3,m=6;break;case"biff2":u=2,m=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var v=Vt(m);return v.write_shift(2,u),v.write_shift(2,r),m>4&&v.write_shift(2,29282),m>6&&v.write_shift(2,1997),m>8&&(v.write_shift(2,49161),v.write_shift(2,1),v.write_shift(2,1798),v.write_shift(2,0)),v}function gU(t,r){var s=!r||r.biff==8,u=Vt(s?112:54);for(u.write_shift(r.biff==8?2:1,7),s&&u.write_shift(1,0),u.write_shift(4,859007059),u.write_shift(4,5458548|(s?0:536870912));u.l<u.length;)u.write_shift(1,s?0:32);return u}function _U(t,r){var s=!r||r.biff>=8?2:1,u=Vt(8+s*t.name.length);u.write_shift(4,t.pos),u.write_shift(1,t.hs||0),u.write_shift(1,t.dt),u.write_shift(1,t.name.length),r.biff>=8&&u.write_shift(1,1),u.write_shift(s*t.name.length,t.name,r.biff<8?"sbcs":"utf16le");var m=u.slice(0,u.l);return m.l=u.l,m}function yU(t,r){var s=Vt(8);s.write_shift(4,t.Count),s.write_shift(4,t.Unique);for(var u=[],m=0;m<t.length;++m)u[m]=cU(t[m]);var v=Ks([s].concat(u));return v.parts=[s.length].concat(u.map(function(T){return T.length})),v}function xU(){var t=Vt(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function vU(t){var r=Vt(18),s=1718;return t&&t.RTL&&(s|=64),r.write_shift(2,s),r.write_shift(4,0),r.write_shift(4,64),r.write_shift(4,0),r.write_shift(4,0),r}function wU(t,r){var s=t.name||"Arial",u=r&&r.biff==5,m=u?15+s.length:16+2*s.length,v=Vt(m);return v.write_shift(2,(t.sz||12)*20),v.write_shift(4,0),v.write_shift(2,400),v.write_shift(4,0),v.write_shift(2,0),v.write_shift(1,s.length),u||v.write_shift(1,1),v.write_shift((u?1:2)*s.length,s,u?"sbcs":"utf16le"),v}function bU(t,r,s,u){var m=Vt(10);return Fd(t,r,u,m),m.write_shift(4,s),m}function TU(t,r,s,u,m){var v=!m||m.biff==8,T=Vt(8+ +v+(1+v)*s.length);return Fd(t,r,u,T),T.write_shift(2,s.length),v&&T.write_shift(1,1),T.write_shift((1+v)*s.length,s,v?"utf16le":"sbcs"),T}function SU(t,r,s,u){var m=s&&s.biff==5;u||(u=Vt(m?3+r.length:5+2*r.length)),u.write_shift(2,t),u.write_shift(m?1:2,r.length),m||u.write_shift(1,1),u.write_shift((m?1:2)*r.length,r,m?"sbcs":"utf16le");var v=u.length>u.l?u.slice(0,u.l):u;return v.l==null&&(v.l=v.length),v}function EU(t,r){var s=r.biff==8||!r.biff?4:2,u=Vt(2*s+6);return u.write_shift(s,t.s.r),u.write_shift(s,t.e.r+1),u.write_shift(2,t.s.c),u.write_shift(2,t.e.c+1),u.write_shift(2,0),u}function J3(t,r,s,u){var m=s&&s.biff==5;u||(u=Vt(m?16:20)),u.write_shift(2,0),t.style?(u.write_shift(2,t.numFmtId||0),u.write_shift(2,65524)):(u.write_shift(2,t.numFmtId||0),u.write_shift(2,r<<4));var v=0;return t.numFmtId>0&&m&&(v|=1024),u.write_shift(4,v),u.write_shift(4,0),m||u.write_shift(4,0),u.write_shift(2,0),u}function AU(t){var r=Vt(8);return r.write_shift(4,0),r.write_shift(2,0),r.write_shift(2,0),r}function IU(t,r,s,u,m,v){var T=Vt(8);return Fd(t,r,u,T),KD(s,v,T),T}function CU(t,r,s,u){var m=Vt(14);return Fd(t,r,u,m),Ld(s,m),m}function PU(t,r,s){if(s.biff<8)return kU(t,r,s);for(var u=[],m=t.l+r,v=t.read_shift(s.biff>8?4:2);v--!==0;)u.push(pU(t,s.biff>8?12:6,s));if(t.l!=m)throw new Error("Bad ExternSheet: "+t.l+" != "+m);return u}function kU(t,r,s){t[t.l+1]==3&&t[t.l]++;var u=YD(t,r,s);return u.charCodeAt(0)==3?u.slice(1):u}function RU(t){var r=Vt(2+t.length*8);r.write_shift(2,t.length);for(var s=0;s<t.length;++s)QD(t[s],r);return r}function MU(t){var r=Vt(24),s=js(t[0]);r.write_shift(2,s.r),r.write_shift(2,s.r),r.write_shift(2,s.c),r.write_shift(2,s.c);for(var u="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),m=0;m<16;++m)r.write_shift(1,parseInt(u[m],16));return Ks([r,fU(t[1])])}function DU(t){var r=t[1].Tooltip,s=Vt(10+2*(r.length+1));s.write_shift(2,2048);var u=js(t[0]);s.write_shift(2,u.r),s.write_shift(2,u.r),s.write_shift(2,u.c),s.write_shift(2,u.c);for(var m=0;m<r.length;++m)s.write_shift(2,r.charCodeAt(m));return s.write_shift(2,0),s}function OU(t){return t||(t=Vt(4)),t.write_shift(2,1),t.write_shift(2,1),t}function LU(t,r,s){if(!s.cellStyles)return sc(t,r);var u=s&&s.biff>=12?4:2,m=t.read_shift(u),v=t.read_shift(u),T=t.read_shift(u),a=t.read_shift(u),R=t.read_shift(2);u==2&&(t.l+=2);var O={s:m,e:v,w:T,ixfe:a,flags:R};return(s.biff>=5||!s.biff)&&(O.level=R>>8&7),O}function FU(t,r){var s=Vt(12);s.write_shift(2,r),s.write_shift(2,r),s.write_shift(2,t.width*256),s.write_shift(2,0);var u=0;return t.hidden&&(u|=1),s.write_shift(1,u),u=t.level||0,s.write_shift(1,u),s.write_shift(2,0),s}function NU(t){for(var r=Vt(2*t),s=0;s<t;++s)r.write_shift(2,s+1);return r}function zU(t,r,s){var u=Vt(15);return z_(u,t,r),u.write_shift(8,s,"f"),u}function BU(t,r,s){var u=Vt(9);return z_(u,t,r),u.write_shift(2,s),u}var jU=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=NS({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function s(a,R){var O=[],B=Od(1);switch(R.type){case"base64":B=ml(Yc(a));break;case"binary":B=ml(a);break;case"buffer":case"array":B=a;break}ma(B,0);var H=B.read_shift(1),q=!!(H&136),ee=!1,re=!1;switch(H){case 2:break;case 3:break;case 48:ee=!0,q=!0;break;case 49:ee=!0,q=!0;break;case 131:break;case 139:break;case 140:re=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+H.toString(16))}var J=0,_e=521;H==2&&(J=B.read_shift(2)),B.l+=3,H!=2&&(J=B.read_shift(4)),J>1048576&&(J=1e6),H!=2&&(_e=B.read_shift(2));var pe=B.read_shift(2),ue=R.codepage||1252;H!=2&&(B.l+=16,B.read_shift(1),B[B.l]!==0&&(ue=t[B[B.l]]),B.l+=1,B.l+=2),re&&(B.l+=36);for(var ie=[],ke={},at=Math.min(B.length,H==2?521:_e-10-(ee?264:0)),He=re?32:11;B.l<at&&B[B.l]!=13;)switch(ke={},ke.name=vd.utils.decode(ue,B.slice(B.l,B.l+He)).replace(/[\u0000\r\n].*$/g,""),B.l+=He,ke.type=String.fromCharCode(B.read_shift(1)),H!=2&&!re&&(ke.offset=B.read_shift(4)),ke.len=B.read_shift(1),H==2&&(ke.offset=B.read_shift(2)),ke.dec=B.read_shift(1),ke.name.length&&ie.push(ke),H!=2&&(B.l+=re?13:14),ke.type){case"B":(!ee||ke.len!=8)&&R.WTF&&console.log("Skipping "+ke.name+":"+ke.type);break;case"G":case"P":R.WTF&&console.log("Skipping "+ke.name+":"+ke.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+ke.type)}if(B[B.l]!==13&&(B.l=_e-1),B.read_shift(1)!==13)throw new Error("DBF Terminator not found "+B.l+" "+B[B.l]);B.l=_e;var De=0,et=0;for(O[0]=[],et=0;et!=ie.length;++et)O[0][et]=ie[et].name;for(;J-- >0;){if(B[B.l]===42){B.l+=pe;continue}for(++B.l,O[++De]=[],et=0,et=0;et!=ie.length;++et){var Ge=B.slice(B.l,B.l+ie[et].len);B.l+=ie[et].len,ma(Ge,0);var ft=vd.utils.decode(ue,Ge);switch(ie[et].type){case"C":ft.trim().length&&(O[De][et]=ft.replace(/\s+$/,""));break;case"D":ft.length===8?O[De][et]=new Date(+ft.slice(0,4),+ft.slice(4,6)-1,+ft.slice(6,8)):O[De][et]=ft;break;case"F":O[De][et]=parseFloat(ft.trim());break;case"+":case"I":O[De][et]=re?Ge.read_shift(-4,"i")^2147483648:Ge.read_shift(4,"i");break;case"L":switch(ft.trim().toUpperCase()){case"Y":case"T":O[De][et]=!0;break;case"N":case"F":O[De][et]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+ft+"|")}break;case"M":if(!q)throw new Error("DBF Unexpected MEMO for type "+H.toString(16));O[De][et]="##MEMO##"+(re?parseInt(ft.trim(),10):Ge.read_shift(4));break;case"N":ft=ft.replace(/\u0000/g,"").trim(),ft&&ft!="."&&(O[De][et]=+ft||0);break;case"@":O[De][et]=new Date(Ge.read_shift(-8,"f")-621356832e5);break;case"T":O[De][et]=new Date((Ge.read_shift(4)-2440588)*864e5+Ge.read_shift(4));break;case"Y":O[De][et]=Ge.read_shift(4,"i")/1e4+Ge.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":O[De][et]=-Ge.read_shift(-8,"f");break;case"B":if(ee&&ie[et].len==8){O[De][et]=Ge.read_shift(8,"f");break}case"G":case"P":Ge.l+=ie[et].len;break;case"0":if(ie[et].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+ie[et].type)}}}if(H!=2&&B.l<B.length&&B[B.l++]!=26)throw new Error("DBF EOF Marker missing "+(B.l-1)+" of "+B.length+" "+B[B.l-1].toString(16));return R&&R.sheetRows&&(O=O.slice(0,R.sheetRows)),R.DBF=ie,O}function u(a,R){var O=R||{};O.dateNF||(O.dateNF="yyyymmdd");var B=vm(s(a,O),O);return B["!cols"]=O.DBF.map(function(H){return{wch:H.len,DBF:H}}),delete O.DBF,B}function m(a,R){try{return Vd(u(a,R),R)}catch(O){if(R&&R.WTF)throw O}return{SheetNames:[],Sheets:{}}}var v={B:8,C:250,L:1,D:8,"?":0,"":0};function T(a,R){var O=R||{};if(+O.codepage>=0&&x_(+O.codepage),O.type=="string")throw new Error("Cannot write DBF to JS string");var B=Zo(),H=o1(a,{header:1,raw:!0,cellDates:!0}),q=H[0],ee=H.slice(1),re=a["!cols"]||[],J=0,_e=0,pe=0,ue=1;for(J=0;J<q.length;++J){if(((re[J]||{}).DBF||{}).name){q[J]=re[J].DBF.name,++pe;continue}if(q[J]!=null){if(++pe,typeof q[J]=="number"&&(q[J]=q[J].toString(10)),typeof q[J]!="string")throw new Error("DBF Invalid column name "+q[J]+" |"+typeof q[J]+"|");if(q.indexOf(q[J])!==J){for(_e=0;_e<1024;++_e)if(q.indexOf(q[J]+"_"+_e)==-1){q[J]+="_"+_e;break}}}}var ie=Un(a["!ref"]),ke=[],at=[],He=[];for(J=0;J<=ie.e.c-ie.s.c;++J){var De="",et="",Ge=0,ft=[];for(_e=0;_e<ee.length;++_e)ee[_e][J]!=null&&ft.push(ee[_e][J]);if(ft.length==0||q[J]==null){ke[J]="?";continue}for(_e=0;_e<ft.length;++_e){switch(typeof ft[_e]){case"number":et="B";break;case"string":et="C";break;case"boolean":et="L";break;case"object":et=ft[_e]instanceof Date?"D":"C";break;default:et="C"}Ge=Math.max(Ge,String(ft[_e]).length),De=De&&De!=et?"C":et}Ge>250&&(Ge=250),et=((re[J]||{}).DBF||{}).type,et=="C"&&re[J].DBF.len>Ge&&(Ge=re[J].DBF.len),De=="B"&&et=="N"&&(De="N",He[J]=re[J].DBF.dec,Ge=re[J].DBF.len),at[J]=De=="C"||et=="N"?Ge:v[De]||0,ue+=at[J],ke[J]=De}var tt=B.next(32);for(tt.write_shift(4,318902576),tt.write_shift(4,ee.length),tt.write_shift(2,296+32*pe),tt.write_shift(2,ue),J=0;J<4;++J)tt.write_shift(4,0);for(tt.write_shift(4,0|(+r[tD]||3)<<8),J=0,_e=0;J<q.length;++J)if(q[J]!=null){var Ot=B.next(32),Xt=(q[J].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Ot.write_shift(1,Xt,"sbcs"),Ot.write_shift(1,ke[J]=="?"?"C":ke[J],"sbcs"),Ot.write_shift(4,_e),Ot.write_shift(1,at[J]||v[ke[J]]||0),Ot.write_shift(1,He[J]||0),Ot.write_shift(1,2),Ot.write_shift(4,0),Ot.write_shift(1,0),Ot.write_shift(4,0),Ot.write_shift(4,0),_e+=at[J]||v[ke[J]]||0}var Dr=B.next(264);for(Dr.write_shift(4,13),J=0;J<65;++J)Dr.write_shift(4,0);for(J=0;J<ee.length;++J){var ir=B.next(ue);for(ir.write_shift(1,0),_e=0;_e<q.length;++_e)if(q[_e]!=null)switch(ke[_e]){case"L":ir.write_shift(1,ee[J][_e]==null?63:ee[J][_e]?84:70);break;case"B":ir.write_shift(8,ee[J][_e]||0,"f");break;case"N":var Ir="0";for(typeof ee[J][_e]=="number"&&(Ir=ee[J][_e].toFixed(He[_e]||0)),pe=0;pe<at[_e]-Ir.length;++pe)ir.write_shift(1,32);ir.write_shift(1,Ir,"sbcs");break;case"D":ee[J][_e]?(ir.write_shift(4,("0000"+ee[J][_e].getFullYear()).slice(-4),"sbcs"),ir.write_shift(2,("00"+(ee[J][_e].getMonth()+1)).slice(-2),"sbcs"),ir.write_shift(2,("00"+ee[J][_e].getDate()).slice(-2),"sbcs")):ir.write_shift(8,"00000000","sbcs");break;case"C":var ei=String(ee[J][_e]!=null?ee[J][_e]:"").slice(0,at[_e]);for(ir.write_shift(1,ei,"sbcs"),pe=0;pe<at[_e]-ei.length;++pe)ir.write_shift(1,32);break}}return B.next(1).write_shift(1,26),B.end()}return{to_workbook:m,to_sheet:u,from_sheet:T}}(),UU=function(){var t={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+to(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),s=function(q,ee){var re=t[ee];return typeof re=="number"?b3(re):re},u=function(q,ee,re){var J=ee.charCodeAt(0)-32<<4|re.charCodeAt(0)-48;return J==59?q:b3(J)};t["|"]=254;function m(q,ee){switch(ee.type){case"base64":return v(Yc(q),ee);case"binary":return v(q,ee);case"buffer":return v(fn&&Buffer.isBuffer(q)?q.toString("binary"):D_(q),ee);case"array":return v(D1(q),ee)}throw new Error("Unrecognized type "+ee.type)}function v(q,ee){var re=q.split(/[\n\r]+/),J=-1,_e=-1,pe=0,ue=0,ie=[],ke=[],at=null,He={},De=[],et=[],Ge=[],ft=0,tt;for(+ee.codepage>=0&&x_(+ee.codepage);pe!==re.length;++pe){ft=0;var Ot=re[pe].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,u).replace(r,s),Xt=Ot.replace(/;;/g,"\0").split(";").map(function(ht){return ht.replace(/\u0000/g,";")}),Dr=Xt[0],ir;if(Ot.length>0)switch(Dr){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Xt[1].charAt(0)=="P"&&ke.push(Ot.slice(3).replace(/;;/g,";"));break;case"C":var Ir=!1,ei=!1,sr=!1,yr=!1,vr=-1,gr=-1;for(ue=1;ue<Xt.length;++ue)switch(Xt[ue].charAt(0)){case"A":break;case"X":_e=parseInt(Xt[ue].slice(1))-1,ei=!0;break;case"Y":for(J=parseInt(Xt[ue].slice(1))-1,ei||(_e=0),tt=ie.length;tt<=J;++tt)ie[tt]=[];break;case"K":ir=Xt[ue].slice(1),ir.charAt(0)==='"'?ir=ir.slice(1,ir.length-1):ir==="TRUE"?ir=!0:ir==="FALSE"?ir=!1:isNaN(Gc(ir))?isNaN(w_(ir).getDate())||(ir=Lo(ir)):(ir=Gc(ir),at!==null&&fD(at)&&(ir=_D(ir))),Ir=!0;break;case"E":yr=!0;var Ue=BV(Xt[ue].slice(1),{r:J,c:_e});ie[J][_e]=[ie[J][_e],Ue];break;case"S":sr=!0,ie[J][_e]=[ie[J][_e],"S5S"];break;case"G":break;case"R":vr=parseInt(Xt[ue].slice(1))-1;break;case"C":gr=parseInt(Xt[ue].slice(1))-1;break;default:if(ee&&ee.WTF)throw new Error("SYLK bad record "+Ot)}if(Ir&&(ie[J][_e]&&ie[J][_e].length==2?ie[J][_e][0]=ir:ie[J][_e]=ir,at=null),sr){if(yr)throw new Error("SYLK shared formula cannot have own formula");var vt=vr>-1&&ie[vr][gr];if(!vt||!vt[1])throw new Error("SYLK shared formula cannot find base");ie[J][_e][1]=jV(vt[1],{r:J-vr,c:_e-gr})}break;case"F":var ct=0;for(ue=1;ue<Xt.length;++ue)switch(Xt[ue].charAt(0)){case"X":_e=parseInt(Xt[ue].slice(1))-1,++ct;break;case"Y":for(J=parseInt(Xt[ue].slice(1))-1,tt=ie.length;tt<=J;++tt)ie[tt]=[];break;case"M":ft=parseInt(Xt[ue].slice(1))/20;break;case"F":break;case"G":break;case"P":at=ke[parseInt(Xt[ue].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Ge=Xt[ue].slice(1).split(" "),tt=parseInt(Ge[0],10);tt<=parseInt(Ge[1],10);++tt)ft=parseInt(Ge[2],10),et[tt-1]=ft===0?{hidden:!0}:{wch:ft},XS(et[tt-1]);break;case"C":_e=parseInt(Xt[ue].slice(1))-1,et[_e]||(et[_e]={});break;case"R":J=parseInt(Xt[ue].slice(1))-1,De[J]||(De[J]={}),ft>0?(De[J].hpt=ft,De[J].hpx=nO(ft)):ft===0&&(De[J].hidden=!0);break;default:if(ee&&ee.WTF)throw new Error("SYLK bad record "+Ot)}ct<1&&(at=null);break;default:if(ee&&ee.WTF)throw new Error("SYLK bad record "+Ot)}}return De.length>0&&(He["!rows"]=De),et.length>0&&(He["!cols"]=et),ee&&ee.sheetRows&&(ie=ie.slice(0,ee.sheetRows)),[ie,He]}function T(q,ee){var re=m(q,ee),J=re[0],_e=re[1],pe=vm(J,ee);return to(_e).forEach(function(ue){pe[ue]=_e[ue]}),pe}function a(q,ee){return Vd(T(q,ee),ee)}function R(q,ee,re,J){var _e="C;Y"+(re+1)+";X"+(J+1)+";K";switch(q.t){case"n":_e+=q.v||0,q.f&&!q.F&&(_e+=";E"+YS(q.f,{r:re,c:J}));break;case"b":_e+=q.v?"TRUE":"FALSE";break;case"e":_e+=q.w||q.v;break;case"d":_e+='"'+(q.w||q.v)+'"';break;case"s":_e+='"'+q.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return _e}function O(q,ee){ee.forEach(function(re,J){var _e="F;W"+(J+1)+" "+(J+1)+" ";re.hidden?_e+="0":(typeof re.width=="number"&&!re.wpx&&(re.wpx=r1(re.width)),typeof re.wpx=="number"&&!re.wch&&(re.wch=i1(re.wpx)),typeof re.wch=="number"&&(_e+=Math.round(re.wch))),_e.charAt(_e.length-1)!=" "&&q.push(_e)})}function B(q,ee){ee.forEach(function(re,J){var _e="F;";re.hidden?_e+="M0;":re.hpt?_e+="M"+20*re.hpt+";":re.hpx&&(_e+="M"+20*n1(re.hpx)+";"),_e.length>2&&q.push(_e+"R"+(J+1))})}function H(q,ee){var re=["ID;PWXL;N;E"],J=[],_e=Un(q["!ref"]),pe,ue=Array.isArray(q),ie=`\r
`;re.push("P;PGeneral"),re.push("F;P0;DG0G8;M255"),q["!cols"]&&O(re,q["!cols"]),q["!rows"]&&B(re,q["!rows"]),re.push("B;Y"+(_e.e.r-_e.s.r+1)+";X"+(_e.e.c-_e.s.c+1)+";D"+[_e.s.c,_e.s.r,_e.e.c,_e.e.r].join(" "));for(var ke=_e.s.r;ke<=_e.e.r;++ke)for(var at=_e.s.c;at<=_e.e.c;++at){var He=vn({r:ke,c:at});pe=ue?(q[ke]||[])[at]:q[He],!(!pe||pe.v==null&&(!pe.f||pe.F))&&J.push(R(pe,q,ke,at))}return re.join(ie)+ie+J.join(ie)+ie+"E"+ie}return{to_workbook:a,to_sheet:T,from_sheet:H}}(),VU=function(){function t(v,T){switch(T.type){case"base64":return r(Yc(v),T);case"binary":return r(v,T);case"buffer":return r(fn&&Buffer.isBuffer(v)?v.toString("binary"):D_(v),T);case"array":return r(D1(v),T)}throw new Error("Unrecognized type "+T.type)}function r(v,T){for(var a=v.split(`
`),R=-1,O=-1,B=0,H=[];B!==a.length;++B){if(a[B].trim()==="BOT"){H[++R]=[],O=0;continue}if(!(R<0)){var q=a[B].trim().split(","),ee=q[0],re=q[1];++B;for(var J=a[B]||"";(J.match(/["]/g)||[]).length&1&&B<a.length-1;)J+=`
`+a[++B];switch(J=J.trim(),+ee){case-1:if(J==="BOT"){H[++R]=[],O=0;continue}else if(J!=="EOD")throw new Error("Unrecognized DIF special command "+J);break;case 0:J==="TRUE"?H[R][O]=!0:J==="FALSE"?H[R][O]=!1:isNaN(Gc(re))?isNaN(w_(re).getDate())?H[R][O]=re:H[R][O]=Lo(re):H[R][O]=Gc(re),++O;break;case 1:J=J.slice(1,J.length-1),J=J.replace(/""/g,'"'),J&&J.match(/^=".*"$/)&&(J=J.slice(2,-1)),H[R][O++]=J!==""?J:null;break}if(J==="EOD")break}}return T&&T.sheetRows&&(H=H.slice(0,T.sheetRows)),H}function s(v,T){return vm(t(v,T),T)}function u(v,T){return Vd(s(v,T),T)}var m=function(){var v=function(R,O,B,H,q){R.push(O),R.push(B+","+H),R.push('"'+q.replace(/"/g,'""')+'"')},T=function(R,O,B,H){R.push(O+","+B),R.push(O==1?'"'+H.replace(/"/g,'""')+'"':H)};return function(R){var O=[],B=Un(R["!ref"]),H,q=Array.isArray(R);v(O,"TABLE",0,1,"sheetjs"),v(O,"VECTORS",0,B.e.r-B.s.r+1,""),v(O,"TUPLES",0,B.e.c-B.s.c+1,""),v(O,"DATA",0,0,"");for(var ee=B.s.r;ee<=B.e.r;++ee){T(O,-1,0,"BOT");for(var re=B.s.c;re<=B.e.c;++re){var J=vn({r:ee,c:re});if(H=q?(R[ee]||[])[re]:R[J],!H){T(O,1,0,"");continue}switch(H.t){case"n":var _e=H.w;!_e&&H.v!=null&&(_e=H.v),_e==null?H.f&&!H.F?T(O,1,0,"="+H.f):T(O,1,0,""):T(O,0,_e,"V");break;case"b":T(O,0,H.v?1:0,H.v?"TRUE":"FALSE");break;case"s":T(O,1,0,isNaN(H.v)?H.v:'="'+H.v+'"');break;case"d":H.w||(H.w=ph(H.z||ss[14],Xo(Lo(H.v)))),T(O,0,H.w,"V");break;default:T(O,1,0,"")}}}T(O,-1,0,"EOD");var pe=`\r
`,ue=O.join(pe);return ue}}();return{to_workbook:u,to_sheet:s,from_sheet:m}}(),eO=function(){function t(H){return H.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(H){return H.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function s(H,q){for(var ee=H.split(`
`),re=-1,J=-1,_e=0,pe=[];_e!==ee.length;++_e){var ue=ee[_e].trim().split(":");if(ue[0]==="cell"){var ie=js(ue[1]);if(pe.length<=ie.r)for(re=pe.length;re<=ie.r;++re)pe[re]||(pe[re]=[]);switch(re=ie.r,J=ie.c,ue[2]){case"t":pe[re][J]=t(ue[3]);break;case"v":pe[re][J]=+ue[3];break;case"vtf":var ke=ue[ue.length-1];case"vtc":switch(ue[3]){case"nl":pe[re][J]=!!+ue[4];break;default:pe[re][J]=+ue[4];break}ue[2]=="vtf"&&(pe[re][J]=[pe[re][J],ke])}}}return q&&q.sheetRows&&(pe=pe.slice(0,q.sheetRows)),pe}function u(H,q){return vm(s(H,q),q)}function m(H,q){return Vd(u(H,q),q)}var v=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),T=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,a=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),R="--SocialCalcSpreadsheetControlSave--";function O(H){if(!H||!H["!ref"])return"";for(var q=[],ee=[],re,J="",_e=ba(H["!ref"]),pe=Array.isArray(H),ue=_e.s.r;ue<=_e.e.r;++ue)for(var ie=_e.s.c;ie<=_e.e.c;++ie)if(J=vn({r:ue,c:ie}),re=pe?(H[ue]||[])[ie]:H[J],!(!re||re.v==null||re.t==="z")){switch(ee=["cell",J,"t"],re.t){case"s":case"str":ee.push(r(re.v));break;case"n":re.f?(ee[2]="vtf",ee[3]="n",ee[4]=re.v,ee[5]=r(re.f)):(ee[2]="v",ee[3]=re.v);break;case"b":ee[2]="vt"+(re.f?"f":"c"),ee[3]="nl",ee[4]=re.v?"1":"0",ee[5]=r(re.f||(re.v?"TRUE":"FALSE"));break;case"d":var ke=Xo(Lo(re.v));ee[2]="vtc",ee[3]="nd",ee[4]=""+ke,ee[5]=re.w||ph(re.z||ss[14],ke);break;case"e":continue}q.push(ee.join(":"))}return q.push("sheet:c:"+(_e.e.c-_e.s.c+1)+":r:"+(_e.e.r-_e.s.r+1)+":tvf:1"),q.push("valueformat:1:text-wiki"),q.join(`
`)}function B(H){return[v,T,a,T,O(H),R].join(`
`)}return{to_workbook:m,to_sheet:u,from_sheet:B}}(),$U=function(){function t(B,H,q,ee,re){re.raw?H[q][ee]=B:B===""||(B==="TRUE"?H[q][ee]=!0:B==="FALSE"?H[q][ee]=!1:isNaN(Gc(B))?isNaN(w_(B).getDate())?H[q][ee]=B:H[q][ee]=Lo(B):H[q][ee]=Gc(B))}function r(B,H){var q=H||{},ee=[];if(!B||B.length===0)return ee;for(var re=B.split(/[\r\n]/),J=re.length-1;J>=0&&re[J].length===0;)--J;for(var _e=10,pe=0,ue=0;ue<=J;++ue)pe=re[ue].indexOf(" "),pe==-1?pe=re[ue].length:pe++,_e=Math.max(_e,pe);for(ue=0;ue<=J;++ue){ee[ue]=[];var ie=0;for(t(re[ue].slice(0,_e).trim(),ee,ue,ie,q),ie=1;ie<=(re[ue].length-_e)/10+1;++ie)t(re[ue].slice(_e+(ie-1)*10,_e+ie*10).trim(),ee,ue,ie,q)}return q.sheetRows&&(ee=ee.slice(0,q.sheetRows)),ee}var s={44:",",9:"	",59:";",124:"|"},u={44:3,9:2,59:1,124:0};function m(B){for(var H={},q=!1,ee=0,re=0;ee<B.length;++ee)(re=B.charCodeAt(ee))==34?q=!q:!q&&re in s&&(H[re]=(H[re]||0)+1);re=[];for(ee in H)Object.prototype.hasOwnProperty.call(H,ee)&&re.push([H[ee],ee]);if(!re.length){H=u;for(ee in H)Object.prototype.hasOwnProperty.call(H,ee)&&re.push([H[ee],ee])}return re.sort(function(J,_e){return J[0]-_e[0]||u[J[1]]-u[_e[1]]}),s[re.pop()[1]]||44}function v(B,H){var q=H||{},ee="",re=q.dense?[]:{},J={s:{c:0,r:0},e:{c:0,r:0}};B.slice(0,4)=="sep="?B.charCodeAt(5)==13&&B.charCodeAt(6)==10?(ee=B.charAt(4),B=B.slice(7)):B.charCodeAt(5)==13||B.charCodeAt(5)==10?(ee=B.charAt(4),B=B.slice(6)):ee=m(B.slice(0,1024)):q&&q.FS?ee=q.FS:ee=m(B.slice(0,1024));var _e=0,pe=0,ue=0,ie=0,ke=0,at=ee.charCodeAt(0),He=!1,De=0,et=B.charCodeAt(0);B=B.replace(/\r\n/mg,`
`);var Ge=q.dateNF!=null?s8(q.dateNF):null;function ft(){var tt=B.slice(ie,ke),Ot={};if(tt.charAt(0)=='"'&&tt.charAt(tt.length-1)=='"'&&(tt=tt.slice(1,-1).replace(/""/g,'"')),tt.length===0)Ot.t="z";else if(q.raw)Ot.t="s",Ot.v=tt;else if(tt.trim().length===0)Ot.t="s",Ot.v=tt;else if(tt.charCodeAt(0)==61)tt.charCodeAt(1)==34&&tt.charCodeAt(tt.length-1)==34?(Ot.t="s",Ot.v=tt.slice(2,-1).replace(/""/g,'"')):UV(tt)?(Ot.t="n",Ot.f=tt.slice(1)):(Ot.t="s",Ot.v=tt);else if(tt=="TRUE")Ot.t="b",Ot.v=!0;else if(tt=="FALSE")Ot.t="b",Ot.v=!1;else if(!isNaN(ue=Gc(tt)))Ot.t="n",q.cellText!==!1&&(Ot.w=tt),Ot.v=ue;else if(!isNaN(w_(tt).getDate())||Ge&&tt.match(Ge)){Ot.z=q.dateNF||ss[14];var Xt=0;Ge&&tt.match(Ge)&&(tt=o8(tt,q.dateNF,tt.match(Ge)||[]),Xt=1),q.cellDates?(Ot.t="d",Ot.v=Lo(tt,Xt)):(Ot.t="n",Ot.v=Xo(Lo(tt,Xt))),q.cellText!==!1&&(Ot.w=ph(Ot.z,Ot.v instanceof Date?Xo(Ot.v):Ot.v)),q.cellNF||delete Ot.z}else Ot.t="s",Ot.v=tt;if(Ot.t=="z"||(q.dense?(re[_e]||(re[_e]=[]),re[_e][pe]=Ot):re[vn({c:pe,r:_e})]=Ot),ie=ke+1,et=B.charCodeAt(ie),J.e.c<pe&&(J.e.c=pe),J.e.r<_e&&(J.e.r=_e),De==at)++pe;else if(pe=0,++_e,q.sheetRows&&q.sheetRows<=_e)return!0}e:for(;ke<B.length;++ke)switch(De=B.charCodeAt(ke)){case 34:et===34&&(He=!He);break;case at:case 10:case 13:if(!He&&ft())break e;break}return ke-ie>0&&ft(),re["!ref"]=_s(J),re}function T(B,H){return!(H&&H.PRN)||H.FS||B.slice(0,4)=="sep="||B.indexOf("	")>=0||B.indexOf(",")>=0||B.indexOf(";")>=0?v(B,H):vm(r(B,H),H)}function a(B,H){var q="",ee=H.type=="string"?[0,0,0,0]:tH(B,H);switch(H.type){case"base64":q=Yc(B);break;case"binary":q=B;break;case"buffer":H.codepage==65001?q=B.toString("utf8"):H.codepage&&typeof vd<"u"?q=vd.utils.decode(H.codepage,B):q=fn&&Buffer.isBuffer(B)?B.toString("binary"):D_(B);break;case"array":q=D1(B);break;case"string":q=B;break;default:throw new Error("Unrecognized type "+H.type)}return ee[0]==239&&ee[1]==187&&ee[2]==191?q=Zg(q.slice(3)):H.type!="string"&&H.type!="buffer"&&H.codepage==65001?q=Zg(q):H.type=="binary"&&typeof vd<"u"&&H.codepage&&(q=vd.utils.decode(H.codepage,vd.utils.encode(28591,q))),q.slice(0,19)=="socialcalc:version:"?eO.to_sheet(H.type=="string"?q:Zg(q),H):T(q,H)}function R(B,H){return Vd(a(B,H),H)}function O(B){for(var H=[],q=Un(B["!ref"]),ee,re=Array.isArray(B),J=q.s.r;J<=q.e.r;++J){for(var _e=[],pe=q.s.c;pe<=q.e.c;++pe){var ue=vn({r:J,c:pe});if(ee=re?(B[J]||[])[pe]:B[ue],!ee||ee.v==null){_e.push("          ");continue}for(var ie=(ee.w||(Jc(ee),ee.w)||"").slice(0,10);ie.length<10;)ie+=" ";_e.push(ie+(pe===0?" ":""))}H.push(_e.join(""))}return H.join(`
`)}return{to_workbook:R,to_sheet:a,from_sheet:O}}(),Q3=function(){function t(Ue,vt,ct){if(Ue){ma(Ue,Ue.l||0);for(var ht=ct.Enum||vr;Ue.l<Ue.length;){var Pt=Ue.read_shift(2),dr=ht[Pt]||ht[65535],br=Ue.read_shift(2),ar=Ue.l+br,Qt=dr.f&&dr.f(Ue,br,ct);if(Ue.l=ar,vt(Qt,dr,Pt))return}}}function r(Ue,vt){switch(vt.type){case"base64":return s(ml(Yc(Ue)),vt);case"binary":return s(ml(Ue),vt);case"buffer":case"array":return s(Ue,vt)}throw"Unsupported type "+vt.type}function s(Ue,vt){if(!Ue)return Ue;var ct=vt||{},ht=ct.dense?[]:{},Pt="Sheet1",dr="",br=0,ar={},Qt=[],Ci=[],bi={s:{r:0,c:0},e:{r:0,c:0}},Ln=ct.sheetRows||0;if(Ue[2]==0&&(Ue[3]==8||Ue[3]==9)&&Ue.length>=16&&Ue[14]==5&&Ue[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(Ue[2]==2)ct.Enum=vr,t(Ue,function(Ut,ti,si){switch(si){case 0:ct.vers=Ut,Ut>=4096&&(ct.qpro=!0);break;case 6:bi=Ut;break;case 204:Ut&&(dr=Ut);break;case 222:dr=Ut;break;case 15:case 51:ct.qpro||(Ut[1].v=Ut[1].v.slice(1));case 13:case 14:case 16:si==14&&(Ut[2]&112)==112&&(Ut[2]&15)>1&&(Ut[2]&15)<15&&(Ut[1].z=ct.dateNF||ss[14],ct.cellDates&&(Ut[1].t="d",Ut[1].v=_D(Ut[1].v))),ct.qpro&&Ut[3]>br&&(ht["!ref"]=_s(bi),ar[Pt]=ht,Qt.push(Pt),ht=ct.dense?[]:{},bi={s:{r:0,c:0},e:{r:0,c:0}},br=Ut[3],Pt=dr||"Sheet"+(br+1),dr="");var cn=ct.dense?(ht[Ut[0].r]||[])[Ut[0].c]:ht[vn(Ut[0])];if(cn){cn.t=Ut[1].t,cn.v=Ut[1].v,Ut[1].z!=null&&(cn.z=Ut[1].z),Ut[1].f!=null&&(cn.f=Ut[1].f);break}ct.dense?(ht[Ut[0].r]||(ht[Ut[0].r]=[]),ht[Ut[0].r][Ut[0].c]=Ut[1]):ht[vn(Ut[0])]=Ut[1];break}},ct);else if(Ue[2]==26||Ue[2]==14)ct.Enum=gr,Ue[2]==14&&(ct.qpro=!0,Ue.l=0),t(Ue,function(Ut,ti,si){switch(si){case 204:Pt=Ut;break;case 22:Ut[1].v=Ut[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Ut[3]>br&&(ht["!ref"]=_s(bi),ar[Pt]=ht,Qt.push(Pt),ht=ct.dense?[]:{},bi={s:{r:0,c:0},e:{r:0,c:0}},br=Ut[3],Pt="Sheet"+(br+1)),Ln>0&&Ut[0].r>=Ln)break;ct.dense?(ht[Ut[0].r]||(ht[Ut[0].r]=[]),ht[Ut[0].r][Ut[0].c]=Ut[1]):ht[vn(Ut[0])]=Ut[1],bi.e.c<Ut[0].c&&(bi.e.c=Ut[0].c),bi.e.r<Ut[0].r&&(bi.e.r=Ut[0].r);break;case 27:Ut[14e3]&&(Ci[Ut[14e3][0]]=Ut[14e3][1]);break;case 1537:Ci[Ut[0]]=Ut[1],Ut[0]==br&&(Pt=Ut[1]);break}},ct);else throw new Error("Unrecognized LOTUS BOF "+Ue[2]);if(ht["!ref"]=_s(bi),ar[dr||Pt]=ht,Qt.push(dr||Pt),!Ci.length)return{SheetNames:Qt,Sheets:ar};for(var gi={},Pi=[],fr=0;fr<Ci.length;++fr)ar[Qt[fr]]?(Pi.push(Ci[fr]||Qt[fr]),gi[Ci[fr]]=ar[Ci[fr]]||ar[Qt[fr]]):(Pi.push(Ci[fr]),gi[Ci[fr]]={"!ref":"A1"});return{SheetNames:Pi,Sheets:gi}}function u(Ue,vt){var ct=vt||{};if(+ct.codepage>=0&&x_(+ct.codepage),ct.type=="string")throw new Error("Cannot write WK1 to JS string");var ht=Zo(),Pt=Un(Ue["!ref"]),dr=Array.isArray(Ue),br=[];kr(ht,0,v(1030)),kr(ht,6,R(Pt));for(var ar=Math.min(Pt.e.r,8191),Qt=Pt.s.r;Qt<=ar;++Qt)for(var Ci=Qs(Qt),bi=Pt.s.c;bi<=Pt.e.c;++bi){Qt===Pt.s.r&&(br[bi]=ho(bi));var Ln=br[bi]+Ci,gi=dr?(Ue[Qt]||[])[bi]:Ue[Ln];if(!(!gi||gi.t=="z"))if(gi.t=="n")(gi.v|0)==gi.v&&gi.v>=-32768&&gi.v<=32767?kr(ht,13,ee(Qt,bi,gi.v)):kr(ht,14,J(Qt,bi,gi.v));else{var Pi=Jc(gi);kr(ht,15,H(Qt,bi,Pi.slice(0,239)))}}return kr(ht,1),ht.end()}function m(Ue,vt){var ct=vt||{};if(+ct.codepage>=0&&x_(+ct.codepage),ct.type=="string")throw new Error("Cannot write WK3 to JS string");var ht=Zo();kr(ht,0,T(Ue));for(var Pt=0,dr=0;Pt<Ue.SheetNames.length;++Pt)(Ue.Sheets[Ue.SheetNames[Pt]]||{})["!ref"]&&kr(ht,27,yr(Ue.SheetNames[Pt],dr++));var br=0;for(Pt=0;Pt<Ue.SheetNames.length;++Pt){var ar=Ue.Sheets[Ue.SheetNames[Pt]];if(!(!ar||!ar["!ref"])){for(var Qt=Un(ar["!ref"]),Ci=Array.isArray(ar),bi=[],Ln=Math.min(Qt.e.r,8191),gi=Qt.s.r;gi<=Ln;++gi)for(var Pi=Qs(gi),fr=Qt.s.c;fr<=Qt.e.c;++fr){gi===Qt.s.r&&(bi[fr]=ho(fr));var Ut=bi[fr]+Pi,ti=Ci?(ar[gi]||[])[fr]:ar[Ut];if(!(!ti||ti.t=="z"))if(ti.t=="n")kr(ht,23,ft(gi,fr,br,ti.v));else{var si=Jc(ti);kr(ht,22,De(gi,fr,br,si.slice(0,239)))}}++br}}return kr(ht,1),ht.end()}function v(Ue){var vt=Vt(2);return vt.write_shift(2,Ue),vt}function T(Ue){var vt=Vt(26);vt.write_shift(2,4096),vt.write_shift(2,4),vt.write_shift(4,0);for(var ct=0,ht=0,Pt=0,dr=0;dr<Ue.SheetNames.length;++dr){var br=Ue.SheetNames[dr],ar=Ue.Sheets[br];if(!(!ar||!ar["!ref"])){++Pt;var Qt=ba(ar["!ref"]);ct<Qt.e.r&&(ct=Qt.e.r),ht<Qt.e.c&&(ht=Qt.e.c)}}return ct>8191&&(ct=8191),vt.write_shift(2,ct),vt.write_shift(1,Pt),vt.write_shift(1,ht),vt.write_shift(2,0),vt.write_shift(2,0),vt.write_shift(1,1),vt.write_shift(1,2),vt.write_shift(4,0),vt.write_shift(4,0),vt}function a(Ue,vt,ct){var ht={s:{c:0,r:0},e:{c:0,r:0}};return vt==8&&ct.qpro?(ht.s.c=Ue.read_shift(1),Ue.l++,ht.s.r=Ue.read_shift(2),ht.e.c=Ue.read_shift(1),Ue.l++,ht.e.r=Ue.read_shift(2),ht):(ht.s.c=Ue.read_shift(2),ht.s.r=Ue.read_shift(2),vt==12&&ct.qpro&&(Ue.l+=2),ht.e.c=Ue.read_shift(2),ht.e.r=Ue.read_shift(2),vt==12&&ct.qpro&&(Ue.l+=2),ht.s.c==65535&&(ht.s.c=ht.e.c=ht.s.r=ht.e.r=0),ht)}function R(Ue){var vt=Vt(8);return vt.write_shift(2,Ue.s.c),vt.write_shift(2,Ue.s.r),vt.write_shift(2,Ue.e.c),vt.write_shift(2,Ue.e.r),vt}function O(Ue,vt,ct){var ht=[{c:0,r:0},{t:"n",v:0},0,0];return ct.qpro&&ct.vers!=20768?(ht[0].c=Ue.read_shift(1),ht[3]=Ue.read_shift(1),ht[0].r=Ue.read_shift(2),Ue.l+=2):(ht[2]=Ue.read_shift(1),ht[0].c=Ue.read_shift(2),ht[0].r=Ue.read_shift(2)),ht}function B(Ue,vt,ct){var ht=Ue.l+vt,Pt=O(Ue,vt,ct);if(Pt[1].t="s",ct.vers==20768){Ue.l++;var dr=Ue.read_shift(1);return Pt[1].v=Ue.read_shift(dr,"utf8"),Pt}return ct.qpro&&Ue.l++,Pt[1].v=Ue.read_shift(ht-Ue.l,"cstr"),Pt}function H(Ue,vt,ct){var ht=Vt(7+ct.length);ht.write_shift(1,255),ht.write_shift(2,vt),ht.write_shift(2,Ue),ht.write_shift(1,39);for(var Pt=0;Pt<ht.length;++Pt){var dr=ct.charCodeAt(Pt);ht.write_shift(1,dr>=128?95:dr)}return ht.write_shift(1,0),ht}function q(Ue,vt,ct){var ht=O(Ue,vt,ct);return ht[1].v=Ue.read_shift(2,"i"),ht}function ee(Ue,vt,ct){var ht=Vt(7);return ht.write_shift(1,255),ht.write_shift(2,vt),ht.write_shift(2,Ue),ht.write_shift(2,ct,"i"),ht}function re(Ue,vt,ct){var ht=O(Ue,vt,ct);return ht[1].v=Ue.read_shift(8,"f"),ht}function J(Ue,vt,ct){var ht=Vt(13);return ht.write_shift(1,255),ht.write_shift(2,vt),ht.write_shift(2,Ue),ht.write_shift(8,ct,"f"),ht}function _e(Ue,vt,ct){var ht=Ue.l+vt,Pt=O(Ue,vt,ct);if(Pt[1].v=Ue.read_shift(8,"f"),ct.qpro)Ue.l=ht;else{var dr=Ue.read_shift(2);ke(Ue.slice(Ue.l,Ue.l+dr),Pt),Ue.l+=dr}return Pt}function pe(Ue,vt,ct){var ht=vt&32768;return vt&=-32769,vt=(ht?Ue:0)+(vt>=8192?vt-16384:vt),(ht?"":"$")+(ct?ho(vt):Qs(vt))}var ue={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},ie=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function ke(Ue,vt){ma(Ue,0);for(var ct=[],ht=0,Pt="",dr="",br="",ar="";Ue.l<Ue.length;){var Qt=Ue[Ue.l++];switch(Qt){case 0:ct.push(Ue.read_shift(8,"f"));break;case 1:dr=pe(vt[0].c,Ue.read_shift(2),!0),Pt=pe(vt[0].r,Ue.read_shift(2),!1),ct.push(dr+Pt);break;case 2:{var Ci=pe(vt[0].c,Ue.read_shift(2),!0),bi=pe(vt[0].r,Ue.read_shift(2),!1);dr=pe(vt[0].c,Ue.read_shift(2),!0),Pt=pe(vt[0].r,Ue.read_shift(2),!1),ct.push(Ci+bi+":"+dr+Pt)}break;case 3:if(Ue.l<Ue.length){console.error("WK1 premature formula end");return}break;case 4:ct.push("("+ct.pop()+")");break;case 5:ct.push(Ue.read_shift(2));break;case 6:{for(var Ln="";Qt=Ue[Ue.l++];)Ln+=String.fromCharCode(Qt);ct.push('"'+Ln.replace(/"/g,'""')+'"')}break;case 8:ct.push("-"+ct.pop());break;case 23:ct.push("+"+ct.pop());break;case 22:ct.push("NOT("+ct.pop()+")");break;case 20:case 21:ar=ct.pop(),br=ct.pop(),ct.push(["AND","OR"][Qt-20]+"("+br+","+ar+")");break;default:if(Qt<32&&ie[Qt])ar=ct.pop(),br=ct.pop(),ct.push(br+ie[Qt]+ar);else if(ue[Qt]){if(ht=ue[Qt][1],ht==69&&(ht=Ue[Ue.l++]),ht>ct.length){console.error("WK1 bad formula parse 0x"+Qt.toString(16)+":|"+ct.join("|")+"|");return}var gi=ct.slice(-ht);ct.length-=ht,ct.push(ue[Qt][0]+"("+gi.join(",")+")")}else return Qt<=7?console.error("WK1 invalid opcode "+Qt.toString(16)):Qt<=24?console.error("WK1 unsupported op "+Qt.toString(16)):Qt<=30?console.error("WK1 invalid opcode "+Qt.toString(16)):Qt<=115?console.error("WK1 unsupported function opcode "+Qt.toString(16)):console.error("WK1 unrecognized opcode "+Qt.toString(16))}}ct.length==1?vt[1].f=""+ct[0]:console.error("WK1 bad formula parse |"+ct.join("|")+"|")}function at(Ue){var vt=[{c:0,r:0},{t:"n",v:0},0];return vt[0].r=Ue.read_shift(2),vt[3]=Ue[Ue.l++],vt[0].c=Ue[Ue.l++],vt}function He(Ue,vt){var ct=at(Ue);return ct[1].t="s",ct[1].v=Ue.read_shift(vt-4,"cstr"),ct}function De(Ue,vt,ct,ht){var Pt=Vt(6+ht.length);Pt.write_shift(2,Ue),Pt.write_shift(1,ct),Pt.write_shift(1,vt),Pt.write_shift(1,39);for(var dr=0;dr<ht.length;++dr){var br=ht.charCodeAt(dr);Pt.write_shift(1,br>=128?95:br)}return Pt.write_shift(1,0),Pt}function et(Ue,vt){var ct=at(Ue);ct[1].v=Ue.read_shift(2);var ht=ct[1].v>>1;if(ct[1].v&1)switch(ht&7){case 0:ht=(ht>>3)*5e3;break;case 1:ht=(ht>>3)*500;break;case 2:ht=(ht>>3)/20;break;case 3:ht=(ht>>3)/200;break;case 4:ht=(ht>>3)/2e3;break;case 5:ht=(ht>>3)/2e4;break;case 6:ht=(ht>>3)/16;break;case 7:ht=(ht>>3)/64;break}return ct[1].v=ht,ct}function Ge(Ue,vt){var ct=at(Ue),ht=Ue.read_shift(4),Pt=Ue.read_shift(4),dr=Ue.read_shift(2);if(dr==65535)return ht===0&&Pt===3221225472?(ct[1].t="e",ct[1].v=15):ht===0&&Pt===3489660928?(ct[1].t="e",ct[1].v=42):ct[1].v=0,ct;var br=dr&32768;return dr=(dr&32767)-16446,ct[1].v=(1-br*2)*(Pt*Math.pow(2,dr+32)+ht*Math.pow(2,dr)),ct}function ft(Ue,vt,ct,ht){var Pt=Vt(14);if(Pt.write_shift(2,Ue),Pt.write_shift(1,ct),Pt.write_shift(1,vt),ht==0)return Pt.write_shift(4,0),Pt.write_shift(4,0),Pt.write_shift(2,65535),Pt;var dr=0,br=0,ar=0,Qt=0;return ht<0&&(dr=1,ht=-ht),br=Math.log2(ht)|0,ht/=Math.pow(2,br-31),Qt=ht>>>0,Qt&2147483648||(ht/=2,++br,Qt=ht>>>0),ht-=Qt,Qt|=2147483648,Qt>>>=0,ht*=Math.pow(2,32),ar=ht>>>0,Pt.write_shift(4,ar),Pt.write_shift(4,Qt),br+=16383+(dr?32768:0),Pt.write_shift(2,br),Pt}function tt(Ue,vt){var ct=Ge(Ue);return Ue.l+=vt-14,ct}function Ot(Ue,vt){var ct=at(Ue),ht=Ue.read_shift(4);return ct[1].v=ht>>6,ct}function Xt(Ue,vt){var ct=at(Ue),ht=Ue.read_shift(8,"f");return ct[1].v=ht,ct}function Dr(Ue,vt){var ct=Xt(Ue);return Ue.l+=vt-10,ct}function ir(Ue,vt){return Ue[Ue.l+vt-1]==0?Ue.read_shift(vt,"cstr"):""}function Ir(Ue,vt){var ct=Ue[Ue.l++];ct>vt-1&&(ct=vt-1);for(var ht="";ht.length<ct;)ht+=String.fromCharCode(Ue[Ue.l++]);return ht}function ei(Ue,vt,ct){if(!(!ct.qpro||vt<21)){var ht=Ue.read_shift(1);Ue.l+=17,Ue.l+=1,Ue.l+=2;var Pt=Ue.read_shift(vt-21,"cstr");return[ht,Pt]}}function sr(Ue,vt){for(var ct={},ht=Ue.l+vt;Ue.l<ht;){var Pt=Ue.read_shift(2);if(Pt==14e3){for(ct[Pt]=[0,""],ct[Pt][0]=Ue.read_shift(2);Ue[Ue.l];)ct[Pt][1]+=String.fromCharCode(Ue[Ue.l]),Ue.l++;Ue.l++}}return ct}function yr(Ue,vt){var ct=Vt(5+Ue.length);ct.write_shift(2,14e3),ct.write_shift(2,vt);for(var ht=0;ht<Ue.length;++ht){var Pt=Ue.charCodeAt(ht);ct[ct.l++]=Pt>127?95:Pt}return ct[ct.l++]=0,ct}var vr={0:{n:"BOF",f:XD},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:a},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:q},14:{n:"NUMBER",f:re},15:{n:"LABEL",f:B},16:{n:"FORMULA",f:_e},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:B},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ir},222:{n:"SHEETNAMELP",f:Ir},65535:{n:""}},gr={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:He},23:{n:"NUMBER17",f:Ge},24:{n:"NUMBER18",f:et},25:{n:"FORMULA19",f:tt},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:sr},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Ot},38:{n:"??"},39:{n:"NUMBER27",f:Xt},40:{n:"FORMULA28",f:Dr},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ir},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ei},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:u,book_to_wk3:m,to_workbook:r}}(),GU=/^\s|\s$|[\t\n\r]/;function tO(t,r){if(!r.bookSST)return"";var s=[ys];s[s.length]=Cr("sst",null,{xmlns:xm[0],count:t.Count,uniqueCount:t.Unique});for(var u=0;u!=t.length;++u)if(t[u]!=null){var m=t[u],v="<si>";m.r?v+=m.r:(v+="<t",m.t||(m.t=""),m.t.match(GU)&&(v+=' xml:space="preserve"'),v+=">"+yn(m.t)+"</t>"),v+="</si>",s[s.length]=v}return s.length>2&&(s[s.length]="</sst>",s[1]=s[1].replace("/>",">")),s.join("")}function HU(t){return[t.read_shift(4),t.read_shift(4)]}function WU(t,r){return r||(r=Vt(8)),r.write_shift(4,t.Count),r.write_shift(4,t.Unique),r}var qU=N8;function ZU(t){var r=Zo();or(r,159,WU(t));for(var s=0;s<t.length;++s)or(r,19,qU(t[s]));return or(r,160),r.end()}function XU(t){for(var r=[],s=t.split(""),u=0;u<s.length;++u)r[u]=s[u].charCodeAt(0);return r}function rO(t){var r=0,s,u=XU(t),m=u.length+1,v,T,a,R,O;for(s=Od(m),s[0]=u.length,v=1;v!=m;++v)s[v]=u[v-1];for(v=m-1;v>=0;--v)T=s[v],a=r&16384?1:0,R=r<<1&32767,O=a|R,r=O^T;return r^52811}var KU=function(){function t(m,v){switch(v.type){case"base64":return r(Yc(m),v);case"binary":return r(m,v);case"buffer":return r(fn&&Buffer.isBuffer(m)?m.toString("binary"):D_(m),v);case"array":return r(D1(m),v)}throw new Error("Unrecognized type "+v.type)}function r(m,v){var T=v||{},a=T.dense?[]:{},R=m.match(/\\trowd.*?\\row\b/g);if(!R.length)throw new Error("RTF missing table");var O={s:{c:0,r:0},e:{c:0,r:R.length-1}};return R.forEach(function(B,H){Array.isArray(a)&&(a[H]=[]);for(var q=/\\\w+\b/g,ee=0,re,J=-1;re=q.exec(B);){switch(re[0]){case"\\cell":var _e=B.slice(ee,q.lastIndex-re[0].length);if(_e[0]==" "&&(_e=_e.slice(1)),++J,_e.length){var pe={v:_e,t:"s"};Array.isArray(a)?a[H][J]=pe:a[vn({r:H,c:J})]=pe}break}ee=q.lastIndex}J>O.e.c&&(O.e.c=J)}),a["!ref"]=_s(O),a}function s(m,v){return Vd(t(m,v),v)}function u(m){for(var v=["{\\rtf1\\ansi"],T=Un(m["!ref"]),a,R=Array.isArray(m),O=T.s.r;O<=T.e.r;++O){v.push("\\trowd\\trautofit1");for(var B=T.s.c;B<=T.e.c;++B)v.push("\\cellx"+(B+1));for(v.push("\\pard\\intbl"),B=T.s.c;B<=T.e.c;++B){var H=vn({r:O,c:B});a=R?(m[O]||[])[B]:m[H],!(!a||a.v==null&&(!a.f||a.F))&&(v.push(" "+(a.w||(Jc(a),a.w))),v.push("\\cell"))}v.push("\\pard\\intbl\\row")}return v.join("")+"}"}return{to_workbook:s,to_sheet:t,from_sheet:u}}();function ek(t){for(var r=0,s=1;r!=3;++r)s=s*256+(t[r]>255?255:t[r]<0?0:t[r]);return s.toString(16).toUpperCase().slice(1)}var YU=6,Hc=YU;function r1(t){return Math.floor((t+Math.round(128/Hc)/256)*Hc)}function i1(t){return Math.floor((t-5)/Hc*100+.5)/100}function DT(t){return Math.round((t*Hc+5)/Hc*256)/256}function XS(t){t.width?(t.wpx=r1(t.width),t.wch=i1(t.wpx),t.MDW=Hc):t.wpx?(t.wch=i1(t.wpx),t.width=DT(t.wch),t.MDW=Hc):typeof t.wch=="number"&&(t.width=DT(t.wch),t.wpx=r1(t.width),t.MDW=Hc),t.customWidth&&delete t.customWidth}var JU=96,iO=JU;function n1(t){return t*96/iO}function nO(t){return t*iO/96}function QU(t){var r=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var u=s[0];u<=s[1];++u)t[u]!=null&&(r[r.length]=Cr("numFmt",null,{numFmtId:u,formatCode:yn(t[u])}))}),r.length===1?"":(r[r.length]="</numFmts>",r[0]=Cr("numFmts",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function eV(t){var r=[];return r[r.length]=Cr("cellXfs",null),t.forEach(function(s){r[r.length]=Cr("xf",null,s)}),r[r.length]="</cellXfs>",r.length===2?"":(r[0]=Cr("cellXfs",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function sO(t,r){var s=[ys,Cr("styleSheet",null,{xmlns:xm[0],"xmlns:vt":Bs.vt})],u;return t.SSF&&(u=QU(t.SSF))!=null&&(s[s.length]=u),s[s.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',s[s.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',s[s.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',s[s.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(u=eV(r.cellXfs))&&(s[s.length]=u),s[s.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',s[s.length]='<dxfs count="0"/>',s[s.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',s.length>2&&(s[s.length]="</styleSheet>",s[1]=s[1].replace("/>",">")),s.join("")}function tV(t,r){var s=t.read_shift(2),u=fo(t);return[s,u]}function rV(t,r,s){s||(s=Vt(6+4*r.length)),s.write_shift(2,t),Us(r,s);var u=s.length>s.l?s.slice(0,s.l):s;return s.l==null&&(s.l=s.length),u}function iV(t,r,s){var u={};u.sz=t.read_shift(2)/20;var m=G8(t);m.fItalic&&(u.italic=1),m.fCondense&&(u.condense=1),m.fExtend&&(u.extend=1),m.fShadow&&(u.shadow=1),m.fOutline&&(u.outline=1),m.fStrikeout&&(u.strike=1);var v=t.read_shift(2);switch(v===700&&(u.bold=1),t.read_shift(2)){case 1:u.vertAlign="superscript";break;case 2:u.vertAlign="subscript";break}var T=t.read_shift(1);T!=0&&(u.underline=T);var a=t.read_shift(1);a>0&&(u.family=a);var R=t.read_shift(1);switch(R>0&&(u.charset=R),t.l++,u.color=$8(t),t.read_shift(1)){case 1:u.scheme="major";break;case 2:u.scheme="minor";break}return u.name=fo(t),u}function nV(t,r){r||(r=Vt(25+4*32)),r.write_shift(2,t.sz*20),H8(t,r),r.write_shift(2,t.bold?700:400);var s=0;t.vertAlign=="superscript"?s=1:t.vertAlign=="subscript"&&(s=2),r.write_shift(2,s),r.write_shift(1,t.underline||0),r.write_shift(1,t.family||0),r.write_shift(1,t.charset||0),r.write_shift(1,0),e1(t.color,r);var u=0;return t.scheme=="major"&&(u=1),t.scheme=="minor"&&(u=2),r.write_shift(1,u),Us(t.name,r),r.length>r.l?r.slice(0,r.l):r}var sV=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],v2,oV=sc;function tk(t,r){r||(r=Vt(4*3+8*7+16*1)),v2||(v2=NS(sV));var s=v2[t.patternType];s==null&&(s=40),r.write_shift(4,s);var u=0;if(s!=40)for(e1({auto:1},r),e1({auto:1},r);u<12;++u)r.write_shift(4,0);else{for(;u<4;++u)r.write_shift(4,0);for(;u<12;++u)r.write_shift(4,0)}return r.length>r.l?r.slice(0,r.l):r}function aV(t,r){var s=t.l+r,u=t.read_shift(2),m=t.read_shift(2);return t.l=s,{ixfe:u,numFmtId:m}}function oO(t,r,s){s||(s=Vt(16)),s.write_shift(2,r||0),s.write_shift(2,t.numFmtId||0),s.write_shift(2,0),s.write_shift(2,0),s.write_shift(2,0),s.write_shift(1,0),s.write_shift(1,0);var u=0;return s.write_shift(1,u),s.write_shift(1,0),s.write_shift(1,0),s.write_shift(1,0),s}function Ag(t,r){return r||(r=Vt(10)),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(4,0),r}var lV=sc;function cV(t,r){return r||(r=Vt(51)),r.write_shift(1,0),Ag(null,r),Ag(null,r),Ag(null,r),Ag(null,r),Ag(null,r),r.length>r.l?r.slice(0,r.l):r}function uV(t,r){return r||(r=Vt(12+4*10)),r.write_shift(4,t.xfId),r.write_shift(2,1),r.write_shift(1,+t.builtinId),r.write_shift(1,0),Qv(t.name||"",r),r.length>r.l?r.slice(0,r.l):r}function hV(t,r,s){var u=Vt(2052);return u.write_shift(4,t),Qv(r,u),Qv(s,u),u.length>u.l?u.slice(0,u.l):u}function dV(t,r){if(r){var s=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(u){for(var m=u[0];m<=u[1];++m)r[m]!=null&&++s}),s!=0&&(or(t,615,xl(s)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(u){for(var m=u[0];m<=u[1];++m)r[m]!=null&&or(t,44,rV(m,r[m]))}),or(t,616))}}function fV(t){var r=1;or(t,611,xl(r)),or(t,43,nV({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),or(t,612)}function pV(t){var r=2;or(t,603,xl(r)),or(t,45,tk({patternType:"none"})),or(t,45,tk({patternType:"gray125"})),or(t,604)}function mV(t){var r=1;or(t,613,xl(r)),or(t,46,cV()),or(t,614)}function gV(t){var r=1;or(t,626,xl(r)),or(t,47,oO({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),or(t,627)}function _V(t,r){or(t,617,xl(r.length)),r.forEach(function(s){or(t,47,oO(s,0))}),or(t,618)}function yV(t){var r=1;or(t,619,xl(r)),or(t,48,uV({xfId:0,builtinId:0,name:"Normal"})),or(t,620)}function xV(t){var r=0;or(t,505,xl(r)),or(t,506)}function vV(t){var r=0;or(t,508,hV(r,"TableStyleMedium9","PivotStyleMedium4")),or(t,509)}function wV(t,r){var s=Zo();return or(s,278),dV(s,t.SSF),fV(s),pV(s),mV(s),gV(s),_V(s,r.cellXfs),yV(s),xV(s),vV(s),or(s,279),s.end()}function aO(t,r){if(r&&r.themeXLSX)return r.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var s=[ys];return s[s.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',s[s.length]="<a:themeElements>",s[s.length]='<a:clrScheme name="Office">',s[s.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',s[s.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',s[s.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',s[s.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',s[s.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',s[s.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',s[s.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',s[s.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',s[s.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',s[s.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',s[s.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',s[s.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',s[s.length]="</a:clrScheme>",s[s.length]='<a:fontScheme name="Office">',s[s.length]="<a:majorFont>",s[s.length]='<a:latin typeface="Cambria"/>',s[s.length]='<a:ea typeface=""/>',s[s.length]='<a:cs typeface=""/>',s[s.length]='<a:font script="Jpan" typeface=" "/>',s[s.length]='<a:font script="Hang" typeface=" "/>',s[s.length]='<a:font script="Hans" typeface=""/>',s[s.length]='<a:font script="Hant" typeface=""/>',s[s.length]='<a:font script="Arab" typeface="Times New Roman"/>',s[s.length]='<a:font script="Hebr" typeface="Times New Roman"/>',s[s.length]='<a:font script="Thai" typeface="Tahoma"/>',s[s.length]='<a:font script="Ethi" typeface="Nyala"/>',s[s.length]='<a:font script="Beng" typeface="Vrinda"/>',s[s.length]='<a:font script="Gujr" typeface="Shruti"/>',s[s.length]='<a:font script="Khmr" typeface="MoolBoran"/>',s[s.length]='<a:font script="Knda" typeface="Tunga"/>',s[s.length]='<a:font script="Guru" typeface="Raavi"/>',s[s.length]='<a:font script="Cans" typeface="Euphemia"/>',s[s.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',s[s.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',s[s.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',s[s.length]='<a:font script="Thaa" typeface="MV Boli"/>',s[s.length]='<a:font script="Deva" typeface="Mangal"/>',s[s.length]='<a:font script="Telu" typeface="Gautami"/>',s[s.length]='<a:font script="Taml" typeface="Latha"/>',s[s.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',s[s.length]='<a:font script="Orya" typeface="Kalinga"/>',s[s.length]='<a:font script="Mlym" typeface="Kartika"/>',s[s.length]='<a:font script="Laoo" typeface="DokChampa"/>',s[s.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',s[s.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',s[s.length]='<a:font script="Viet" typeface="Times New Roman"/>',s[s.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',s[s.length]='<a:font script="Geor" typeface="Sylfaen"/>',s[s.length]="</a:majorFont>",s[s.length]="<a:minorFont>",s[s.length]='<a:latin typeface="Calibri"/>',s[s.length]='<a:ea typeface=""/>',s[s.length]='<a:cs typeface=""/>',s[s.length]='<a:font script="Jpan" typeface=" "/>',s[s.length]='<a:font script="Hang" typeface=" "/>',s[s.length]='<a:font script="Hans" typeface=""/>',s[s.length]='<a:font script="Hant" typeface=""/>',s[s.length]='<a:font script="Arab" typeface="Arial"/>',s[s.length]='<a:font script="Hebr" typeface="Arial"/>',s[s.length]='<a:font script="Thai" typeface="Tahoma"/>',s[s.length]='<a:font script="Ethi" typeface="Nyala"/>',s[s.length]='<a:font script="Beng" typeface="Vrinda"/>',s[s.length]='<a:font script="Gujr" typeface="Shruti"/>',s[s.length]='<a:font script="Khmr" typeface="DaunPenh"/>',s[s.length]='<a:font script="Knda" typeface="Tunga"/>',s[s.length]='<a:font script="Guru" typeface="Raavi"/>',s[s.length]='<a:font script="Cans" typeface="Euphemia"/>',s[s.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',s[s.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',s[s.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',s[s.length]='<a:font script="Thaa" typeface="MV Boli"/>',s[s.length]='<a:font script="Deva" typeface="Mangal"/>',s[s.length]='<a:font script="Telu" typeface="Gautami"/>',s[s.length]='<a:font script="Taml" typeface="Latha"/>',s[s.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',s[s.length]='<a:font script="Orya" typeface="Kalinga"/>',s[s.length]='<a:font script="Mlym" typeface="Kartika"/>',s[s.length]='<a:font script="Laoo" typeface="DokChampa"/>',s[s.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',s[s.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',s[s.length]='<a:font script="Viet" typeface="Arial"/>',s[s.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',s[s.length]='<a:font script="Geor" typeface="Sylfaen"/>',s[s.length]="</a:minorFont>",s[s.length]="</a:fontScheme>",s[s.length]='<a:fmtScheme name="Office">',s[s.length]="<a:fillStyleLst>",s[s.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',s[s.length]='<a:gradFill rotWithShape="1">',s[s.length]="<a:gsLst>",s[s.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',s[s.length]="</a:gsLst>",s[s.length]='<a:lin ang="16200000" scaled="1"/>',s[s.length]="</a:gradFill>",s[s.length]='<a:gradFill rotWithShape="1">',s[s.length]="<a:gsLst>",s[s.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',s[s.length]="</a:gsLst>",s[s.length]='<a:lin ang="16200000" scaled="0"/>',s[s.length]="</a:gradFill>",s[s.length]="</a:fillStyleLst>",s[s.length]="<a:lnStyleLst>",s[s.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',s[s.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',s[s.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',s[s.length]="</a:lnStyleLst>",s[s.length]="<a:effectStyleLst>",s[s.length]="<a:effectStyle>",s[s.length]="<a:effectLst>",s[s.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',s[s.length]="</a:effectLst>",s[s.length]="</a:effectStyle>",s[s.length]="<a:effectStyle>",s[s.length]="<a:effectLst>",s[s.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',s[s.length]="</a:effectLst>",s[s.length]="</a:effectStyle>",s[s.length]="<a:effectStyle>",s[s.length]="<a:effectLst>",s[s.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',s[s.length]="</a:effectLst>",s[s.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',s[s.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',s[s.length]="</a:effectStyle>",s[s.length]="</a:effectStyleLst>",s[s.length]="<a:bgFillStyleLst>",s[s.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',s[s.length]='<a:gradFill rotWithShape="1">',s[s.length]="<a:gsLst>",s[s.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',s[s.length]="</a:gsLst>",s[s.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',s[s.length]="</a:gradFill>",s[s.length]='<a:gradFill rotWithShape="1">',s[s.length]="<a:gsLst>",s[s.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',s[s.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',s[s.length]="</a:gsLst>",s[s.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',s[s.length]="</a:gradFill>",s[s.length]="</a:bgFillStyleLst>",s[s.length]="</a:fmtScheme>",s[s.length]="</a:themeElements>",s[s.length]="<a:objectDefaults>",s[s.length]="<a:spDef>",s[s.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',s[s.length]="</a:spDef>",s[s.length]="<a:lnDef>",s[s.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',s[s.length]="</a:lnDef>",s[s.length]="</a:objectDefaults>",s[s.length]="<a:extraClrSchemeLst/>",s[s.length]="</a:theme>",s.join("")}function bV(t,r){return{flags:t.read_shift(4),version:t.read_shift(4),name:fo(t)}}function TV(t){var r=Vt(12+2*t.name.length);return r.write_shift(4,t.flags),r.write_shift(4,t.version),Us(t.name,r),r.slice(0,r.l)}function SV(t){for(var r=[],s=t.read_shift(4);s-- >0;)r.push([t.read_shift(4),t.read_shift(4)]);return r}function EV(t){var r=Vt(4+8*t.length);r.write_shift(4,t.length);for(var s=0;s<t.length;++s)r.write_shift(4,t[s][0]),r.write_shift(4,t[s][1]);return r}function AV(t,r){var s=Vt(8+2*r.length);return s.write_shift(4,t),Us(r,s),s.slice(0,s.l)}function IV(t){return t.l+=4,t.read_shift(4)!=0}function CV(t,r){var s=Vt(8);return s.write_shift(4,t),s.write_shift(4,1),s}function PV(){var t=Zo();return or(t,332),or(t,334,xl(1)),or(t,335,TV({name:"XLDAPR",version:12e4,flags:3496657072})),or(t,336),or(t,339,AV(1,"XLDAPR")),or(t,52),or(t,35,xl(514)),or(t,4096,xl(0)),or(t,4097,za(1)),or(t,36),or(t,53),or(t,340),or(t,337,CV(1)),or(t,51,EV([[1,0]])),or(t,338),or(t,333),t.end()}function lO(){var t=[ys];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function kV(t){var r={};r.i=t.read_shift(4);var s={};s.r=t.read_shift(4),s.c=t.read_shift(4),r.r=vn(s);var u=t.read_shift(1);return u&2&&(r.l="1"),u&8&&(r.a="1"),r}var qp=1024;function cO(t,r){for(var s=[21600,21600],u=["m0,0l0",s[1],s[0],s[1],s[0],"0xe"].join(","),m=[Cr("xml",null,{"xmlns:v":ga.v,"xmlns:o":ga.o,"xmlns:x":ga.x,"xmlns:mv":ga.mv}).replace(/\/>/,">"),Cr("o:shapelayout",Cr("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),Cr("v:shapetype",[Cr("v:stroke",null,{joinstyle:"miter"}),Cr("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:s.join(","),path:u})];qp<t*1e3;)qp+=1e3;return r.forEach(function(v){var T=js(v[0]),a={color2:"#BEFF82",type:"gradient"};a.type=="gradient"&&(a.angle="-180");var R=a.type=="gradient"?Cr("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,O=Cr("v:fill",R,a),B={on:"t",obscured:"t"};++qp,m=m.concat(["<v:shape"+T_({id:"_x0000_s"+qp,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(v[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",O,Cr("v:shadow",null,B),Cr("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Ys("x:Anchor",[T.c+1,0,T.r+1,0,T.c+3,20,T.r+5,20].join(",")),Ys("x:AutoFill","False"),Ys("x:Row",String(T.r)),Ys("x:Column",String(T.c)),v[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),m.push("</xml>"),m.join("")}function uO(t){var r=[ys,Cr("comments",null,{xmlns:xm[0]})],s=[];return r.push("<authors>"),t.forEach(function(u){u[1].forEach(function(m){var v=yn(m.a);s.indexOf(v)==-1&&(s.push(v),r.push("<author>"+v+"</author>")),m.T&&m.ID&&s.indexOf("tc="+m.ID)==-1&&(s.push("tc="+m.ID),r.push("<author>tc="+m.ID+"</author>"))})}),s.length==0&&(s.push("SheetJ5"),r.push("<author>SheetJ5</author>")),r.push("</authors>"),r.push("<commentList>"),t.forEach(function(u){var m=0,v=[];if(u[1][0]&&u[1][0].T&&u[1][0].ID?m=s.indexOf("tc="+u[1][0].ID):u[1].forEach(function(R){R.a&&(m=s.indexOf(yn(R.a))),v.push(R.t||"")}),r.push('<comment ref="'+u[0]+'" authorId="'+m+'"><text>'),v.length<=1)r.push(Ys("t",yn(v[0]||"")));else{for(var T=`Comment:
    `+v[0]+`
`,a=1;a<v.length;++a)T+=`Reply:
    `+v[a]+`
`;r.push(Ys("t",yn(T)))}r.push("</text></comment>")}),r.push("</commentList>"),r.length>2&&(r[r.length]="</comments>",r[1]=r[1].replace("/>",">")),r.join("")}function RV(t,r,s){var u=[ys,Cr("ThreadedComments",null,{xmlns:Bs.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(m){var v="";(m[1]||[]).forEach(function(T,a){if(!T.T){delete T.ID;return}T.a&&r.indexOf(T.a)==-1&&r.push(T.a);var R={ref:m[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+s.tcid++).slice(-12)+"}"};a==0?v=R.id:R.parentId=v,T.ID=R.id,T.a&&(R.personId="{54EE7950-7262-4200-6969-"+("000000000000"+r.indexOf(T.a)).slice(-12)+"}"),u.push(Cr("threadedComment",Ys("text",T.t||""),R))})}),u.push("</ThreadedComments>"),u.join("")}function MV(t){var r=[ys,Cr("personList",null,{xmlns:Bs.TCMNT,"xmlns:x":xm[0]}).replace(/[\/]>/,">")];return t.forEach(function(s,u){r.push(Cr("person",null,{displayName:s,id:"{54EE7950-7262-4200-6969-"+("000000000000"+u).slice(-12)+"}",userId:s,providerId:"None"}))}),r.push("</personList>"),r.join("")}function DV(t){var r={};r.iauthor=t.read_shift(4);var s=Wd(t);return r.rfx=s.s,r.ref=vn(s.s),t.l+=16,r}function OV(t,r){return r==null&&(r=Vt(36)),r.write_shift(4,t[1].iauthor),wm(t[0],r),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r}var LV=fo;function FV(t){return Us(t.slice(0,54))}function NV(t){var r=Zo(),s=[];return or(r,628),or(r,630),t.forEach(function(u){u[1].forEach(function(m){s.indexOf(m.a)>-1||(s.push(m.a.slice(0,54)),or(r,632,FV(m.a)))})}),or(r,631),or(r,633),t.forEach(function(u){u[1].forEach(function(m){m.iauthor=s.indexOf(m.a);var v={s:js(u[0]),e:js(u[0])};or(r,635,OV([v,m])),m.t&&m.t.length>0&&or(r,637,B8(m)),or(r,636),delete m.iauthor})}),or(r,634),or(r,629),r.end()}function zV(t,r){r.FullPaths.forEach(function(s,u){if(u!=0){var m=s.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");m.slice(-1)!=="/"&&Tn.utils.cfb_add(t,m,r.FileIndex[u].content)}})}var hO=["xlsb","xlsm","xlam","biff8","xla"],BV=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function s(u,m,v,T){var a=!1,R=!1;v.length==0?R=!0:v.charAt(0)=="["&&(R=!0,v=v.slice(1,-1)),T.length==0?a=!0:T.charAt(0)=="["&&(a=!0,T=T.slice(1,-1));var O=v.length>0?parseInt(v,10)|0:0,B=T.length>0?parseInt(T,10)|0:0;return a?B+=r.c:--B,R?O+=r.r:--O,m+(a?"":"$")+ho(B)+(R?"":"$")+Qs(O)}return function(m,v){return r=v,m.replace(t,s)}}(),KS=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,YS=function(){return function(r,s){return r.replace(KS,function(u,m,v,T,a,R){var O=GS(T)-(v?0:s.c),B=$S(R)-(a?0:s.r),H=B==0?"":a?B+1:"["+B+"]",q=O==0?"":v?O+1:"["+O+"]";return m+"R"+H+"C"+q})}}();function jV(t,r){return t.replace(KS,function(s,u,m,v,T,a){return u+(m=="$"?m+v:ho(GS(v)+r.c))+(T=="$"?T+a:Qs($S(a)+r.r))})}function UV(t){return t.length!=1}function ms(t){t.l+=1}function mh(t,r){var s=t.read_shift(2);return[s&16383,s>>14&1,s>>15&1]}function dO(t,r,s){var u=2;if(s){if(s.biff>=2&&s.biff<=5)return fO(t);s.biff==12&&(u=4)}var m=t.read_shift(u),v=t.read_shift(u),T=mh(t),a=mh(t);return{s:{r:m,c:T[0],cRel:T[1],rRel:T[2]},e:{r:v,c:a[0],cRel:a[1],rRel:a[2]}}}function fO(t){var r=mh(t),s=mh(t),u=t.read_shift(1),m=t.read_shift(1);return{s:{r:r[0],c:u,cRel:r[1],rRel:r[2]},e:{r:s[0],c:m,cRel:s[1],rRel:s[2]}}}function VV(t,r,s){if(s.biff<8)return fO(t);var u=t.read_shift(s.biff==12?4:2),m=t.read_shift(s.biff==12?4:2),v=mh(t),T=mh(t);return{s:{r:u,c:v[0],cRel:v[1],rRel:v[2]},e:{r:m,c:T[0],cRel:T[1],rRel:T[2]}}}function pO(t,r,s){if(s&&s.biff>=2&&s.biff<=5)return $V(t);var u=t.read_shift(s&&s.biff==12?4:2),m=mh(t);return{r:u,c:m[0],cRel:m[1],rRel:m[2]}}function $V(t){var r=mh(t),s=t.read_shift(1);return{r:r[0],c:s,cRel:r[1],rRel:r[2]}}function GV(t){var r=t.read_shift(2),s=t.read_shift(2);return{r,c:s&255,fQuoted:!!(s&16384),cRel:s>>15,rRel:s>>15}}function HV(t,r,s){var u=s&&s.biff?s.biff:8;if(u>=2&&u<=5)return WV(t);var m=t.read_shift(u>=12?4:2),v=t.read_shift(2),T=(v&16384)>>14,a=(v&32768)>>15;if(v&=16383,a==1)for(;m>524287;)m-=1048576;if(T==1)for(;v>8191;)v=v-16384;return{r:m,c:v,cRel:T,rRel:a}}function WV(t){var r=t.read_shift(2),s=t.read_shift(1),u=(r&32768)>>15,m=(r&16384)>>14;return r&=16383,u==1&&r>=8192&&(r=r-16384),m==1&&s>=128&&(s=s-256),{r,c:s,cRel:m,rRel:u}}function qV(t,r,s){var u=(t[t.l++]&96)>>5,m=dO(t,s.biff>=2&&s.biff<=5?6:8,s);return[u,m]}function ZV(t,r,s){var u=(t[t.l++]&96)>>5,m=t.read_shift(2,"i"),v=8;if(s)switch(s.biff){case 5:t.l+=12,v=6;break;case 12:v=12;break}var T=dO(t,v,s);return[u,m,T]}function XV(t,r,s){var u=(t[t.l++]&96)>>5;return t.l+=s&&s.biff>8?12:s.biff<8?6:8,[u]}function KV(t,r,s){var u=(t[t.l++]&96)>>5,m=t.read_shift(2),v=8;if(s)switch(s.biff){case 5:t.l+=12,v=6;break;case 12:v=12;break}return t.l+=v,[u,m]}function YV(t,r,s){var u=(t[t.l++]&96)>>5,m=VV(t,r-1,s);return[u,m]}function JV(t,r,s){var u=(t[t.l++]&96)>>5;return t.l+=s.biff==2?6:s.biff==12?14:7,[u]}function rk(t){var r=t[t.l+1]&1,s=1;return t.l+=4,[r,s]}function QV(t,r,s){t.l+=2;for(var u=t.read_shift(s&&s.biff==2?1:2),m=[],v=0;v<=u;++v)m.push(t.read_shift(s&&s.biff==2?1:2));return m}function e7(t,r,s){var u=t[t.l+1]&255?1:0;return t.l+=2,[u,t.read_shift(s&&s.biff==2?1:2)]}function t7(t,r,s){var u=t[t.l+1]&255?1:0;return t.l+=2,[u,t.read_shift(s&&s.biff==2?1:2)]}function r7(t){var r=t[t.l+1]&255?1:0;return t.l+=2,[r,t.read_shift(2)]}function i7(t,r,s){var u=t[t.l+1]&255?1:0;return t.l+=s&&s.biff==2?3:4,[u]}function mO(t){var r=t.read_shift(1),s=t.read_shift(1);return[r,s]}function n7(t){return t.read_shift(2),mO(t)}function s7(t){return t.read_shift(2),mO(t)}function o7(t,r,s){var u=(t[t.l]&96)>>5;t.l+=1;var m=pO(t,0,s);return[u,m]}function a7(t,r,s){var u=(t[t.l]&96)>>5;t.l+=1;var m=HV(t,0,s);return[u,m]}function l7(t,r,s){var u=(t[t.l]&96)>>5;t.l+=1;var m=t.read_shift(2);s&&s.biff==5&&(t.l+=12);var v=pO(t,0,s);return[u,m,v]}function c7(t,r,s){var u=(t[t.l]&96)>>5;t.l+=1;var m=t.read_shift(s&&s.biff<=3?1:2);return[c9[m],yO[m],u]}function u7(t,r,s){var u=t[t.l++],m=t.read_shift(1),v=s&&s.biff<=3?[u==88?-1:0,t.read_shift(1)]:h7(t);return[m,(v[0]===0?yO:l9)[v[1]]]}function h7(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function d7(t,r,s){t.l+=s&&s.biff==2?3:4}function f7(t,r,s){if(t.l++,s&&s.biff==12)return[t.read_shift(4,"i"),0];var u=t.read_shift(2),m=t.read_shift(s&&s.biff==2?1:2);return[u,m]}function p7(t){return t.l++,F_[t.read_shift(1)]}function m7(t){return t.l++,t.read_shift(2)}function g7(t){return t.l++,t.read_shift(1)!==0}function _7(t){return t.l++,bm(t)}function y7(t,r,s){return t.l++,YD(t,r-1,s)}function x7(t,r){var s=[t.read_shift(1)];if(r==12)switch(s[0]){case 2:s[0]=4;break;case 4:s[0]=16;break;case 0:s[0]=1;break;case 1:s[0]=2;break}switch(s[0]){case 4:s[1]=lU(t,1)?"TRUE":"FALSE",r!=12&&(t.l+=7);break;case 37:case 16:s[1]=F_[t[t.l]],t.l+=r==12?4:8;break;case 0:t.l+=8;break;case 1:s[1]=bm(t);break;case 2:s[1]=dU(t,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+s[0])}return s}function v7(t,r,s){for(var u=t.read_shift(s.biff==12?4:2),m=[],v=0;v!=u;++v)m.push((s.biff==12?Wd:mU)(t));return m}function w7(t,r,s){var u=0,m=0;s.biff==12?(u=t.read_shift(4),m=t.read_shift(4)):(m=1+t.read_shift(1),u=1+t.read_shift(2)),s.biff>=2&&s.biff<8&&(--u,--m==0&&(m=256));for(var v=0,T=[];v!=u&&(T[v]=[]);++v)for(var a=0;a!=m;++a)T[v][a]=x7(t,s.biff);return T}function b7(t,r,s){var u=t.read_shift(1)>>>5&3,m=!s||s.biff>=8?4:2,v=t.read_shift(m);switch(s.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[u,0,v]}function T7(t,r,s){if(s.biff==5)return S7(t);var u=t.read_shift(1)>>>5&3,m=t.read_shift(2),v=t.read_shift(4);return[u,m,v]}function S7(t){var r=t.read_shift(1)>>>5&3,s=t.read_shift(2,"i");t.l+=8;var u=t.read_shift(2);return t.l+=12,[r,s,u]}function E7(t,r,s){var u=t.read_shift(1)>>>5&3;t.l+=s&&s.biff==2?3:4;var m=t.read_shift(s&&s.biff==2?1:2);return[u,m]}function A7(t,r,s){var u=t.read_shift(1)>>>5&3,m=t.read_shift(s&&s.biff==2?1:2);return[u,m]}function I7(t,r,s){var u=t.read_shift(1)>>>5&3;return t.l+=4,s.biff<8&&t.l--,s.biff==12&&(t.l+=2),[u]}function C7(t,r,s){var u=(t[t.l++]&96)>>5,m=t.read_shift(2),v=4;if(s)switch(s.biff){case 5:v=15;break;case 12:v=6;break}return t.l+=v,[u,m]}var P7=sc,k7=sc,R7=sc;function N_(t,r,s){return t.l+=2,[GV(t)]}function JS(t){return t.l+=6,[]}var M7=N_,D7=JS,O7=JS,L7=N_;function gO(t){return t.l+=2,[XD(t),t.read_shift(2)&1]}var F7=N_,N7=gO,z7=JS,B7=N_,j7=N_,U7=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function V7(t){t.l+=2;var r=t.read_shift(2),s=t.read_shift(2),u=t.read_shift(4),m=t.read_shift(2),v=t.read_shift(2),T=U7[s>>2&31];return{ixti:r,coltype:s&3,rt:T,idx:u,c:m,C:v}}function $7(t){return t.l+=2,[t.read_shift(4)]}function G7(t,r,s){return t.l+=5,t.l+=2,t.l+=s.biff==2?1:4,["PTGSHEET"]}function H7(t,r,s){return t.l+=s.biff==2?4:5,["PTGENDSHEET"]}function W7(t){var r=t.read_shift(1)>>>5&3,s=t.read_shift(2);return[r,s]}function q7(t){var r=t.read_shift(1)>>>5&3,s=t.read_shift(2);return[r,s]}function Z7(t){return t.l+=4,[0,0]}var ik={1:{n:"PtgExp",f:f7},2:{n:"PtgTbl",f:R7},3:{n:"PtgAdd",f:ms},4:{n:"PtgSub",f:ms},5:{n:"PtgMul",f:ms},6:{n:"PtgDiv",f:ms},7:{n:"PtgPower",f:ms},8:{n:"PtgConcat",f:ms},9:{n:"PtgLt",f:ms},10:{n:"PtgLe",f:ms},11:{n:"PtgEq",f:ms},12:{n:"PtgGe",f:ms},13:{n:"PtgGt",f:ms},14:{n:"PtgNe",f:ms},15:{n:"PtgIsect",f:ms},16:{n:"PtgUnion",f:ms},17:{n:"PtgRange",f:ms},18:{n:"PtgUplus",f:ms},19:{n:"PtgUminus",f:ms},20:{n:"PtgPercent",f:ms},21:{n:"PtgParen",f:ms},22:{n:"PtgMissArg",f:ms},23:{n:"PtgStr",f:y7},26:{n:"PtgSheet",f:G7},27:{n:"PtgEndSheet",f:H7},28:{n:"PtgErr",f:p7},29:{n:"PtgBool",f:g7},30:{n:"PtgInt",f:m7},31:{n:"PtgNum",f:_7},32:{n:"PtgArray",f:JV},33:{n:"PtgFunc",f:c7},34:{n:"PtgFuncVar",f:u7},35:{n:"PtgName",f:b7},36:{n:"PtgRef",f:o7},37:{n:"PtgArea",f:qV},38:{n:"PtgMemArea",f:E7},39:{n:"PtgMemErr",f:P7},40:{n:"PtgMemNoMem",f:k7},41:{n:"PtgMemFunc",f:A7},42:{n:"PtgRefErr",f:I7},43:{n:"PtgAreaErr",f:XV},44:{n:"PtgRefN",f:a7},45:{n:"PtgAreaN",f:YV},46:{n:"PtgMemAreaN",f:W7},47:{n:"PtgMemNoMemN",f:q7},57:{n:"PtgNameX",f:T7},58:{n:"PtgRef3d",f:l7},59:{n:"PtgArea3d",f:ZV},60:{n:"PtgRefErr3d",f:C7},61:{n:"PtgAreaErr3d",f:KV},255:{}},X7={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},K7={1:{n:"PtgElfLel",f:gO},2:{n:"PtgElfRw",f:B7},3:{n:"PtgElfCol",f:M7},6:{n:"PtgElfRwV",f:j7},7:{n:"PtgElfColV",f:L7},10:{n:"PtgElfRadical",f:F7},11:{n:"PtgElfRadicalS",f:z7},13:{n:"PtgElfColS",f:D7},15:{n:"PtgElfColSV",f:O7},16:{n:"PtgElfRadicalLel",f:N7},25:{n:"PtgList",f:V7},29:{n:"PtgSxName",f:$7},255:{}},Y7={0:{n:"PtgAttrNoop",f:Z7},1:{n:"PtgAttrSemi",f:i7},2:{n:"PtgAttrIf",f:t7},4:{n:"PtgAttrChoose",f:QV},8:{n:"PtgAttrGoto",f:e7},16:{n:"PtgAttrSum",f:d7},32:{n:"PtgAttrBaxcel",f:rk},33:{n:"PtgAttrBaxcel",f:rk},64:{n:"PtgAttrSpace",f:n7},65:{n:"PtgAttrSpaceSemi",f:s7},128:{n:"PtgAttrIfError",f:r7},255:{}};function J7(t,r,s,u){if(u.biff<8)return sc(t,r);for(var m=t.l+r,v=[],T=0;T!==s.length;++T)switch(s[T][0]){case"PtgArray":s[T][1]=w7(t,0,u),v.push(s[T][1]);break;case"PtgMemArea":s[T][2]=v7(t,s[T][1],u),v.push(s[T][2]);break;case"PtgExp":u&&u.biff==12&&(s[T][1][1]=t.read_shift(4),v.push(s[T][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+s[T][0]}return r=m-t.l,r!==0&&v.push(sc(t,r)),v}function Q7(t,r,s){for(var u=t.l+r,m,v,T=[];u!=t.l;)r=u-t.l,v=t[t.l],m=ik[v]||ik[X7[v]],(v===24||v===25)&&(m=(v===24?K7:Y7)[t[t.l+1]]),!m||!m.f?sc(t,r):T.push([m.n,m.f(t,r,s)]);return T}function e9(t){for(var r=[],s=0;s<t.length;++s){for(var u=t[s],m=[],v=0;v<u.length;++v){var T=u[v];if(T)switch(T[0]){case 2:m.push('"'+T[1].replace(/"/g,'""')+'"');break;default:m.push(T[1])}else m.push("")}r.push(m.join(","))}return r.join(";")}var t9={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function r9(t,r){if(!t&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function _O(t,r,s){if(!t)return"SH33TJSERR0";if(s.biff>8&&(!t.XTI||!t.XTI[r]))return t.SheetNames[r];if(!t.XTI)return"SH33TJSERR6";var u=t.XTI[r];if(s.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":t.XTI[r-1];if(!u)return"SH33TJSERR1";var m="";if(s.biff>8)switch(t[u[0]][0]){case 357:return m=u[1]==-1?"#REF":t.SheetNames[u[1]],u[1]==u[2]?m:m+":"+t.SheetNames[u[2]];case 358:return s.SID!=null?t.SheetNames[s.SID]:"SH33TJSSAME"+t[u[0]][0];case 355:default:return"SH33TJSSRC"+t[u[0]][0]}switch(t[u[0]][0][0]){case 1025:return m=u[1]==-1?"#REF":t.SheetNames[u[1]]||"SH33TJSERR3",u[1]==u[2]?m:m+":"+t.SheetNames[u[2]];case 14849:return t[u[0]].slice(1).map(function(v){return v.Name}).join(";;");default:return t[u[0]][0][3]?(m=u[1]==-1?"#REF":t[u[0]][0][3][u[1]]||"SH33TJSERR4",u[1]==u[2]?m:m+":"+t[u[0]][0][3][u[2]]):"SH33TJSERR2"}}function nk(t,r,s){var u=_O(t,r,s);return u=="#REF"?u:r9(u,s)}function fm(t,r,s,u,m){var v=m&&m.biff||8,T={s:{c:0,r:0},e:{c:0,r:0}},a=[],R,O,B,H=0,q=0,ee,re="";if(!t[0]||!t[0][0])return"";for(var J=-1,_e="",pe=0,ue=t[0].length;pe<ue;++pe){var ie=t[0][pe];switch(ie[0]){case"PtgUminus":a.push("-"+a.pop());break;case"PtgUplus":a.push("+"+a.pop());break;case"PtgPercent":a.push(a.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(R=a.pop(),O=a.pop(),J>=0){switch(t[0][J][1][0]){case 0:_e=ns(" ",t[0][J][1][1]);break;case 1:_e=ns("\r",t[0][J][1][1]);break;default:if(_e="",m.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][J][1][0])}O=O+_e,J=-1}a.push(O+t9[ie[0]]+R);break;case"PtgIsect":R=a.pop(),O=a.pop(),a.push(O+" "+R);break;case"PtgUnion":R=a.pop(),O=a.pop(),a.push(O+","+R);break;case"PtgRange":R=a.pop(),O=a.pop(),a.push(O+":"+R);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":B=Kg(ie[1][1],T,m),a.push(Yg(B,v));break;case"PtgRefN":B=s?Kg(ie[1][1],s,m):ie[1][1],a.push(Yg(B,v));break;case"PtgRef3d":H=ie[1][1],B=Kg(ie[1][2],T,m),re=nk(u,H,m),a.push(re+"!"+Yg(B,v));break;case"PtgFunc":case"PtgFuncVar":var ke=ie[1][0],at=ie[1][1];ke||(ke=0),ke&=127;var He=ke==0?[]:a.slice(-ke);a.length-=ke,at==="User"&&(at=He.shift()),a.push(at+"("+He.join(",")+")");break;case"PtgBool":a.push(ie[1]?"TRUE":"FALSE");break;case"PtgInt":a.push(ie[1]);break;case"PtgNum":a.push(String(ie[1]));break;case"PtgStr":a.push('"'+ie[1].replace(/"/g,'""')+'"');break;case"PtgErr":a.push(ie[1]);break;case"PtgAreaN":ee=V3(ie[1][1],s?{s}:T,m),a.push(y2(ee,m));break;case"PtgArea":ee=V3(ie[1][1],T,m),a.push(y2(ee,m));break;case"PtgArea3d":H=ie[1][1],ee=ie[1][2],re=nk(u,H,m),a.push(re+"!"+y2(ee,m));break;case"PtgAttrSum":a.push("SUM("+a.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":q=ie[1][2];var De=(u.names||[])[q-1]||(u[0]||[])[q],et=De?De.Name:"SH33TJSNAME"+String(q);et&&et.slice(0,6)=="_xlfn."&&!m.xlfn&&(et=et.slice(6)),a.push(et);break;case"PtgNameX":var Ge=ie[1][1];q=ie[1][2];var ft;if(m.biff<=5)Ge<0&&(Ge=-Ge),u[Ge]&&(ft=u[Ge][q]);else{var tt="";if(((u[Ge]||[])[0]||[])[0]==14849||(((u[Ge]||[])[0]||[])[0]==1025?u[Ge][q]&&u[Ge][q].itab>0&&(tt=u.SheetNames[u[Ge][q].itab-1]+"!"):tt=u.SheetNames[q-1]+"!"),u[Ge]&&u[Ge][q])tt+=u[Ge][q].Name;else if(u[0]&&u[0][q])tt+=u[0][q].Name;else{var Ot=(_O(u,Ge,m)||"").split(";;");Ot[q-1]?tt=Ot[q-1]:tt+="SH33TJSERRX"}a.push(tt);break}ft||(ft={Name:"SH33TJSERRY"}),a.push(ft.Name);break;case"PtgParen":var Xt="(",Dr=")";if(J>=0){switch(_e="",t[0][J][1][0]){case 2:Xt=ns(" ",t[0][J][1][1])+Xt;break;case 3:Xt=ns("\r",t[0][J][1][1])+Xt;break;case 4:Dr=ns(" ",t[0][J][1][1])+Dr;break;case 5:Dr=ns("\r",t[0][J][1][1])+Dr;break;default:if(m.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][J][1][0])}J=-1}a.push(Xt+a.pop()+Dr);break;case"PtgRefErr":a.push("#REF!");break;case"PtgRefErr3d":a.push("#REF!");break;case"PtgExp":B={c:ie[1][1],r:ie[1][0]};var ir={c:s.c,r:s.r};if(u.sharedf[vn(B)]){var Ir=u.sharedf[vn(B)];a.push(fm(Ir,T,ir,u,m))}else{var ei=!1;for(R=0;R!=u.arrayf.length;++R)if(O=u.arrayf[R],!(B.c<O[0].s.c||B.c>O[0].e.c)&&!(B.r<O[0].s.r||B.r>O[0].e.r)){a.push(fm(O[1],T,ir,u,m)),ei=!0;break}ei||a.push(ie[1])}break;case"PtgArray":a.push("{"+e9(ie[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":J=pe;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":a.push("");break;case"PtgAreaErr":a.push("#REF!");break;case"PtgAreaErr3d":a.push("#REF!");break;case"PtgList":a.push("Table"+ie[1].idx+"[#"+ie[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(ie));default:throw new Error("Unrecognized Formula Token: "+String(ie))}var sr=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(m.biff!=3&&J>=0&&sr.indexOf(t[0][pe][0])==-1){ie=t[0][J];var yr=!0;switch(ie[1][0]){case 4:yr=!1;case 0:_e=ns(" ",ie[1][1]);break;case 5:yr=!1;case 1:_e=ns("\r",ie[1][1]);break;default:if(_e="",m.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ie[1][0])}a.push((yr?_e:"")+a.pop()+(yr?"":_e)),J=-1}}if(a.length>1&&m.WTF)throw new Error("bad formula stack");return a[0]}function i9(t){if(t==null){var r=Vt(8);return r.write_shift(1,3),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,65535),r}else if(typeof t=="number")return Ld(t);return Ld(0)}function n9(t,r,s,u,m){var v=Fd(r,s,m),T=i9(t.v),a=Vt(6),R=33;a.write_shift(2,R),a.write_shift(4,0);for(var O=Vt(t.bf.length),B=0;B<t.bf.length;++B)O[B]=t.bf[B];var H=Ks([v,T,a,O]);return H}function O1(t,r,s){var u=t.read_shift(4),m=Q7(t,u,s),v=t.read_shift(4),T=v>0?J7(t,v,m,s):null;return[m,T]}var s9=O1,L1=O1,o9=O1,a9=O1,l9={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},yO={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},c9={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function u9(t){var r="of:="+t.replace(KS,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return r.replace(/;/g,"|").replace(/,/g,";")}function h9(t){return t.replace(/\./,"!")}var Jg=typeof Map<"u";function QS(t,r,s){var u=0,m=t.length;if(s){if(Jg?s.has(r):Object.prototype.hasOwnProperty.call(s,r)){for(var v=Jg?s.get(r):s[r];u<v.length;++u)if(t[v[u]].t===r)return t.Count++,v[u]}}else for(;u<m;++u)if(t[u].t===r)return t.Count++,u;return t[m]={t:r},t.Count++,t.Unique++,s&&(Jg?(s.has(r)||s.set(r,[]),s.get(r).push(m)):(Object.prototype.hasOwnProperty.call(s,r)||(s[r]=[]),s[r].push(m))),m}function F1(t,r){var s={min:t+1,max:t+1},u=-1;return r.MDW&&(Hc=r.MDW),r.width!=null?s.customWidth=1:r.wpx!=null?u=i1(r.wpx):r.wch!=null&&(u=r.wch),u>-1?(s.width=DT(u),s.customWidth=1):r.width!=null&&(s.width=r.width),r.hidden&&(s.hidden=!0),r.level!=null&&(s.outlineLevel=s.level=r.level),s}function xO(t,r){if(t){var s=[.7,.7,.75,.75,.3,.3];t.left==null&&(t.left=s[0]),t.right==null&&(t.right=s[1]),t.top==null&&(t.top=s[2]),t.bottom==null&&(t.bottom=s[3]),t.header==null&&(t.header=s[4]),t.footer==null&&(t.footer=s[5])}}function wh(t,r,s){var u=s.revssf[r.z!=null?r.z:"General"],m=60,v=t.length;if(u==null&&s.ssf){for(;m<392;++m)if(s.ssf[m]==null){pD(r.z,m),s.ssf[m]=r.z,s.revssf[r.z]=u=m;break}}for(m=0;m!=v;++m)if(t[m].numFmtId===u)return m;return t[v]={numFmtId:u,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},v}function d9(t,r,s){if(t&&t["!ref"]){var u=Un(t["!ref"]);if(u.e.c<u.s.c||u.e.r<u.s.r)throw new Error("Bad range ("+s+"): "+t["!ref"])}}function f9(t){if(t.length===0)return"";for(var r='<mergeCells count="'+t.length+'">',s=0;s!=t.length;++s)r+='<mergeCell ref="'+_s(t[s])+'"/>';return r+"</mergeCells>"}function p9(t,r,s,u,m){var v=!1,T={},a=null;if(u.bookType!=="xlsx"&&r.vbaraw){var R=r.SheetNames[s];try{r.Workbook&&(R=r.Workbook.Sheets[s].CodeName||R)}catch{}v=!0,T.codeName=b_(yn(R))}if(t&&t["!outline"]){var O={summaryBelow:1,summaryRight:1};t["!outline"].above&&(O.summaryBelow=0),t["!outline"].left&&(O.summaryRight=0),a=(a||"")+Cr("outlinePr",null,O)}!v&&!a||(m[m.length]=Cr("sheetPr",a,T))}var m9=["objects","scenarios","selectLockedCells","selectUnlockedCells"],g9=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function _9(t){var r={sheet:1};return m9.forEach(function(s){t[s]!=null&&t[s]&&(r[s]="1")}),g9.forEach(function(s){t[s]!=null&&!t[s]&&(r[s]="0")}),t.password&&(r.password=rO(t.password).toString(16).toUpperCase()),Cr("sheetProtection",null,r)}function y9(t){return xO(t),Cr("pageMargins",null,t)}function x9(t,r){for(var s=["<cols>"],u,m=0;m!=r.length;++m)(u=r[m])&&(s[s.length]=Cr("col",null,F1(m,u)));return s[s.length]="</cols>",s.join("")}function v9(t,r,s,u){var m=typeof t.ref=="string"?t.ref:_s(t.ref);s.Workbook||(s.Workbook={Sheets:[]}),s.Workbook.Names||(s.Workbook.Names=[]);var v=s.Workbook.Names,T=ba(m);T.s.r==T.e.r&&(T.e.r=ba(r["!ref"]).e.r,m=_s(T));for(var a=0;a<v.length;++a){var R=v[a];if(R.Name=="_xlnm._FilterDatabase"&&R.Sheet==u){R.Ref="'"+s.SheetNames[u]+"'!"+m;break}}return a==v.length&&v.push({Name:"_xlnm._FilterDatabase",Sheet:u,Ref:"'"+s.SheetNames[u]+"'!"+m}),Cr("autoFilter",null,{ref:m})}function w9(t,r,s,u){var m={workbookViewId:"0"};return(((u||{}).Workbook||{}).Views||[])[0]&&(m.rightToLeft=u.Workbook.Views[0].RTL?"1":"0"),Cr("sheetViews",Cr("sheetView",null,m),{})}function b9(t,r,s,u){if(t.c&&s["!comments"].push([r,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var m="",v=t.t,T=t.v;if(t.t!=="z")switch(t.t){case"b":m=t.v?"1":"0";break;case"n":m=""+t.v;break;case"e":m=F_[t.v];break;case"d":u&&u.cellDates?m=Lo(t.v,-1).toISOString():(t=Ko(t),t.t="n",m=""+(t.v=Xo(Lo(t.v)))),typeof t.z>"u"&&(t.z=ss[14]);break;default:m=t.v;break}var a=Ys("v",yn(m)),R={r},O=wh(u.cellXfs,t,u);switch(O!==0&&(R.s=O),t.t){case"n":break;case"d":R.t="d";break;case"b":R.t="b";break;case"e":R.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(u&&u.bookSST){a=Ys("v",""+QS(u.Strings,t.v,u.revStrings)),R.t="s";break}R.t="str";break}if(t.t!=v&&(t.t=v,t.v=T),typeof t.f=="string"&&t.f){var B=t.F&&t.F.slice(0,r.length)==r?{t:"array",ref:t.F}:null;a=Cr("f",yn(t.f),B)+(t.v!=null?a:"")}return t.l&&s["!links"].push([r,t.l]),t.D&&(R.cm=1),Cr("c",a,R)}function T9(t,r,s,u){var m=[],v=[],T=Un(t["!ref"]),a="",R,O="",B=[],H=0,q=0,ee=t["!rows"],re=Array.isArray(t),J={r:O},_e,pe=-1;for(q=T.s.c;q<=T.e.c;++q)B[q]=ho(q);for(H=T.s.r;H<=T.e.r;++H){for(v=[],O=Qs(H),q=T.s.c;q<=T.e.c;++q){R=B[q]+O;var ue=re?(t[H]||[])[q]:t[R];ue!==void 0&&(a=b9(ue,R,t,r))!=null&&v.push(a)}(v.length>0||ee&&ee[H])&&(J={r:O},ee&&ee[H]&&(_e=ee[H],_e.hidden&&(J.hidden=1),pe=-1,_e.hpx?pe=n1(_e.hpx):_e.hpt&&(pe=_e.hpt),pe>-1&&(J.ht=pe,J.customHeight=1),_e.level&&(J.outlineLevel=_e.level)),m[m.length]=Cr("row",v.join(""),J))}if(ee)for(;H<ee.length;++H)ee&&ee[H]&&(J={r:H+1},_e=ee[H],_e.hidden&&(J.hidden=1),pe=-1,_e.hpx?pe=n1(_e.hpx):_e.hpt&&(pe=_e.hpt),pe>-1&&(J.ht=pe,J.customHeight=1),_e.level&&(J.outlineLevel=_e.level),m[m.length]=Cr("row","",J));return m.join("")}function vO(t,r,s,u){var m=[ys,Cr("worksheet",null,{xmlns:xm[0],"xmlns:r":Bs.r})],v=s.SheetNames[t],T=0,a="",R=s.Sheets[v];R==null&&(R={});var O=R["!ref"]||"A1",B=Un(O);if(B.e.c>16383||B.e.r>1048575){if(r.WTF)throw new Error("Range "+O+" exceeds format limit A1:XFD1048576");B.e.c=Math.min(B.e.c,16383),B.e.r=Math.min(B.e.c,1048575),O=_s(B)}u||(u={}),R["!comments"]=[];var H=[];p9(R,s,t,r,m),m[m.length]=Cr("dimension",null,{ref:O}),m[m.length]=w9(R,r,t,s),r.sheetFormat&&(m[m.length]=Cr("sheetFormatPr",null,{defaultRowHeight:r.sheetFormat.defaultRowHeight||"16",baseColWidth:r.sheetFormat.baseColWidth||"10",outlineLevelRow:r.sheetFormat.outlineLevelRow||"7"})),R["!cols"]!=null&&R["!cols"].length>0&&(m[m.length]=x9(R,R["!cols"])),m[T=m.length]="<sheetData/>",R["!links"]=[],R["!ref"]!=null&&(a=T9(R,r),a.length>0&&(m[m.length]=a)),m.length>T+1&&(m[m.length]="</sheetData>",m[T]=m[T].replace("/>",">")),R["!protect"]&&(m[m.length]=_9(R["!protect"])),R["!autofilter"]!=null&&(m[m.length]=v9(R["!autofilter"],R,s,t)),R["!merges"]!=null&&R["!merges"].length>0&&(m[m.length]=f9(R["!merges"]));var q=-1,ee,re=-1;return R["!links"].length>0&&(m[m.length]="<hyperlinks>",R["!links"].forEach(function(J){J[1].Target&&(ee={ref:J[0]},J[1].Target.charAt(0)!="#"&&(re=_n(u,-1,yn(J[1].Target).replace(/#.*$/,""),ln.HLINK),ee["r:id"]="rId"+re),(q=J[1].Target.indexOf("#"))>-1&&(ee.location=yn(J[1].Target.slice(q+1))),J[1].Tooltip&&(ee.tooltip=yn(J[1].Tooltip)),m[m.length]=Cr("hyperlink",null,ee))}),m[m.length]="</hyperlinks>"),delete R["!links"],R["!margins"]!=null&&(m[m.length]=y9(R["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&(m[m.length]=Ys("ignoredErrors",Cr("ignoredError",null,{numberStoredAsText:1,sqref:O}))),H.length>0&&(re=_n(u,-1,"../drawings/drawing"+(t+1)+".xml",ln.DRAW),m[m.length]=Cr("drawing",null,{"r:id":"rId"+re}),R["!drawing"]=H),R["!comments"].length>0&&(re=_n(u,-1,"../drawings/vmlDrawing"+(t+1)+".vml",ln.VML),m[m.length]=Cr("legacyDrawing",null,{"r:id":"rId"+re}),R["!legacy"]=re),m.length>1&&(m[m.length]="</worksheet>",m[1]=m[1].replace("/>",">")),m.join("")}function S9(t,r){var s={},u=t.l+r;s.r=t.read_shift(4),t.l+=4;var m=t.read_shift(2);t.l+=1;var v=t.read_shift(1);return t.l=u,v&7&&(s.level=v&7),v&16&&(s.hidden=!0),v&32&&(s.hpt=m/20),s}function E9(t,r,s){var u=Vt(145),m=(s["!rows"]||[])[t]||{};u.write_shift(4,t),u.write_shift(4,0);var v=320;m.hpx?v=n1(m.hpx)*20:m.hpt&&(v=m.hpt*20),u.write_shift(2,v),u.write_shift(1,0);var T=0;m.level&&(T|=m.level),m.hidden&&(T|=16),(m.hpx||m.hpt)&&(T|=32),u.write_shift(1,T),u.write_shift(1,0);var a=0,R=u.l;u.l+=4;for(var O={r:t,c:0},B=0;B<16;++B)if(!(r.s.c>B+1<<10||r.e.c<B<<10)){for(var H=-1,q=-1,ee=B<<10;ee<B+1<<10;++ee){O.c=ee;var re=Array.isArray(s)?(s[O.r]||[])[O.c]:s[vn(O)];re&&(H<0&&(H=ee),q=ee)}H<0||(++a,u.write_shift(4,H),u.write_shift(4,q))}var J=u.l;return u.l=R,u.write_shift(4,a),u.l=J,u.length>u.l?u.slice(0,u.l):u}function A9(t,r,s,u){var m=E9(u,s,r);(m.length>17||(r["!rows"]||[])[u])&&or(t,0,m)}var I9=Wd,C9=wm;function P9(){}function k9(t,r){var s={},u=t[t.l];return++t.l,s.above=!(u&64),s.left=!(u&128),t.l+=18,s.name=j8(t),s}function R9(t,r,s){s==null&&(s=Vt(84+4*t.length));var u=192;r&&(r.above&&(u&=-65),r.left&&(u&=-129)),s.write_shift(1,u);for(var m=1;m<3;++m)s.write_shift(1,0);return e1({auto:1},s),s.write_shift(-4,-1),s.write_shift(-4,-1),LD(t,s),s.slice(0,s.l)}function M9(t){var r=Ha(t);return[r]}function D9(t,r,s){return s==null&&(s=Vt(8)),$d(r,s)}function O9(t){var r=Gd(t);return[r]}function L9(t,r,s){return s==null&&(s=Vt(4)),Hd(r,s)}function F9(t){var r=Ha(t),s=t.read_shift(1);return[r,s,"b"]}function N9(t,r,s){return s==null&&(s=Vt(9)),$d(r,s),s.write_shift(1,t.v?1:0),s}function z9(t){var r=Gd(t),s=t.read_shift(1);return[r,s,"b"]}function B9(t,r,s){return s==null&&(s=Vt(5)),Hd(r,s),s.write_shift(1,t.v?1:0),s}function j9(t){var r=Ha(t),s=t.read_shift(1);return[r,s,"e"]}function U9(t,r,s){return s==null&&(s=Vt(9)),$d(r,s),s.write_shift(1,t.v),s}function V9(t){var r=Gd(t),s=t.read_shift(1);return[r,s,"e"]}function $9(t,r,s){return s==null&&(s=Vt(8)),Hd(r,s),s.write_shift(1,t.v),s.write_shift(2,0),s.write_shift(1,0),s}function G9(t){var r=Ha(t),s=t.read_shift(4);return[r,s,"s"]}function H9(t,r,s){return s==null&&(s=Vt(12)),$d(r,s),s.write_shift(4,r.v),s}function W9(t){var r=Gd(t),s=t.read_shift(4);return[r,s,"s"]}function q9(t,r,s){return s==null&&(s=Vt(8)),Hd(r,s),s.write_shift(4,r.v),s}function Z9(t){var r=Ha(t),s=bm(t);return[r,s,"n"]}function X9(t,r,s){return s==null&&(s=Vt(16)),$d(r,s),Ld(t.v,s),s}function K9(t){var r=Gd(t),s=bm(t);return[r,s,"n"]}function Y9(t,r,s){return s==null&&(s=Vt(12)),Hd(r,s),Ld(t.v,s),s}function J9(t){var r=Ha(t),s=FD(t);return[r,s,"n"]}function Q9(t,r,s){return s==null&&(s=Vt(12)),$d(r,s),ND(t.v,s),s}function e$(t){var r=Gd(t),s=FD(t);return[r,s,"n"]}function t$(t,r,s){return s==null&&(s=Vt(8)),Hd(r,s),ND(t.v,s),s}function r$(t){var r=Ha(t),s=HS(t);return[r,s,"is"]}function i$(t){var r=Ha(t),s=fo(t);return[r,s,"str"]}function n$(t,r,s){return s==null&&(s=Vt(12+4*t.v.length)),$d(r,s),Us(t.v,s),s.length>s.l?s.slice(0,s.l):s}function s$(t){var r=Gd(t),s=fo(t);return[r,s,"str"]}function o$(t,r,s){return s==null&&(s=Vt(8+4*t.v.length)),Hd(r,s),Us(t.v,s),s.length>s.l?s.slice(0,s.l):s}function a$(t,r,s){var u=t.l+r,m=Ha(t);m.r=s["!row"];var v=t.read_shift(1),T=[m,v,"b"];if(s.cellFormula){t.l+=2;var a=L1(t,u-t.l,s);T[3]=fm(a,null,m,s.supbooks,s)}else t.l=u;return T}function l$(t,r,s){var u=t.l+r,m=Ha(t);m.r=s["!row"];var v=t.read_shift(1),T=[m,v,"e"];if(s.cellFormula){t.l+=2;var a=L1(t,u-t.l,s);T[3]=fm(a,null,m,s.supbooks,s)}else t.l=u;return T}function c$(t,r,s){var u=t.l+r,m=Ha(t);m.r=s["!row"];var v=bm(t),T=[m,v,"n"];if(s.cellFormula){t.l+=2;var a=L1(t,u-t.l,s);T[3]=fm(a,null,m,s.supbooks,s)}else t.l=u;return T}function u$(t,r,s){var u=t.l+r,m=Ha(t);m.r=s["!row"];var v=fo(t),T=[m,v,"str"];if(s.cellFormula){t.l+=2;var a=L1(t,u-t.l,s);T[3]=fm(a,null,m,s.supbooks,s)}else t.l=u;return T}var h$=Wd,d$=wm;function f$(t,r){return r==null&&(r=Vt(4)),r.write_shift(4,t),r}function p$(t,r){var s=t.l+r,u=Wd(t),m=WS(t),v=fo(t),T=fo(t),a=fo(t);t.l=s;var R={rfx:u,relId:m,loc:v,display:a};return T&&(R.Tooltip=T),R}function m$(t,r){var s=Vt(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));wm({s:js(t[0]),e:js(t[0])},s),qS("rId"+r,s);var u=t[1].Target.indexOf("#"),m=u==-1?"":t[1].Target.slice(u+1);return Us(m||"",s),Us(t[1].Tooltip||"",s),Us("",s),s.slice(0,s.l)}function g$(){}function _$(t,r,s){var u=t.l+r,m=zD(t),v=t.read_shift(1),T=[m];if(T[2]=v,s.cellFormula){var a=s9(t,u-t.l,s);T[1]=a}else t.l=u;return T}function y$(t,r,s){var u=t.l+r,m=Wd(t),v=[m];if(s.cellFormula){var T=a9(t,u-t.l,s);v[1]=T,t.l=u}else t.l=u;return v}function x$(t,r,s){s==null&&(s=Vt(18));var u=F1(t,r);s.write_shift(-4,t),s.write_shift(-4,t),s.write_shift(4,(u.width||10)*256),s.write_shift(4,0);var m=0;return r.hidden&&(m|=1),typeof u.width=="number"&&(m|=2),r.level&&(m|=r.level<<8),s.write_shift(2,m),s}var wO=["left","right","top","bottom","header","footer"];function v$(t){var r={};return wO.forEach(function(s){r[s]=bm(t)}),r}function w$(t,r){return r==null&&(r=Vt(6*8)),xO(t),wO.forEach(function(s){Ld(t[s],r)}),r}function b$(t){var r=t.read_shift(2);return t.l+=28,{RTL:r&32}}function T$(t,r,s){s==null&&(s=Vt(30));var u=924;return(((r||{}).Views||[])[0]||{}).RTL&&(u|=32),s.write_shift(2,u),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(1,0),s.write_shift(1,0),s.write_shift(2,0),s.write_shift(2,100),s.write_shift(2,0),s.write_shift(2,0),s.write_shift(2,0),s.write_shift(4,0),s}function S$(t){var r=Vt(24);return r.write_shift(4,4),r.write_shift(4,1),wm(t,r),r}function E$(t,r){return r==null&&(r=Vt(16*4+2)),r.write_shift(2,t.password?rO(t.password):0),r.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(s){s[1]?r.write_shift(4,t[s[0]]!=null&&!t[s[0]]?1:0):r.write_shift(4,t[s[0]]!=null&&t[s[0]]?0:1)}),r}function A$(){}function I$(){}function C$(t,r,s,u,m,v,T){if(r.v===void 0)return!1;var a="";switch(r.t){case"b":a=r.v?"1":"0";break;case"d":r=Ko(r),r.z=r.z||ss[14],r.v=Xo(Lo(r.v)),r.t="n";break;case"n":case"e":a=""+r.v;break;default:a=r.v;break}var R={r:s,c:u};switch(R.s=wh(m.cellXfs,r,m),r.l&&v["!links"].push([vn(R),r.l]),r.c&&v["!comments"].push([vn(R),r.c]),r.t){case"s":case"str":return m.bookSST?(a=QS(m.Strings,r.v,m.revStrings),R.t="s",R.v=a,T?or(t,18,q9(r,R)):or(t,7,H9(r,R))):(R.t="str",T?or(t,17,o$(r,R)):or(t,6,n$(r,R))),!0;case"n":return r.v==(r.v|0)&&r.v>-1e3&&r.v<1e3?T?or(t,13,t$(r,R)):or(t,2,Q9(r,R)):T?or(t,16,Y9(r,R)):or(t,5,X9(r,R)),!0;case"b":return R.t="b",T?or(t,15,B9(r,R)):or(t,4,N9(r,R)),!0;case"e":return R.t="e",T?or(t,14,$9(r,R)):or(t,3,U9(r,R)),!0}return T?or(t,12,L9(r,R)):or(t,1,D9(r,R)),!0}function P$(t,r,s,u){var m=Un(r["!ref"]||"A1"),v,T="",a=[];or(t,145);var R=Array.isArray(r),O=m.e.r;r["!rows"]&&(O=Math.max(m.e.r,r["!rows"].length-1));for(var B=m.s.r;B<=O;++B){T=Qs(B),A9(t,r,m,B);var H=!1;if(B<=m.e.r)for(var q=m.s.c;q<=m.e.c;++q){B===m.s.r&&(a[q]=ho(q)),v=a[q]+T;var ee=R?(r[B]||[])[q]:r[v];if(!ee){H=!1;continue}H=C$(t,ee,B,q,u,r,H)}}or(t,146)}function k$(t,r){!r||!r["!merges"]||(or(t,177,f$(r["!merges"].length)),r["!merges"].forEach(function(s){or(t,176,d$(s))}),or(t,178))}function R$(t,r){!r||!r["!cols"]||(or(t,390),r["!cols"].forEach(function(s,u){s&&or(t,60,x$(u,s))}),or(t,391))}function M$(t,r){!r||!r["!ref"]||(or(t,648),or(t,649,S$(Un(r["!ref"]))),or(t,650))}function D$(t,r,s){r["!links"].forEach(function(u){if(u[1].Target){var m=_n(s,-1,u[1].Target.replace(/#.*$/,""),ln.HLINK);or(t,494,m$(u,m))}}),delete r["!links"]}function O$(t,r,s,u){if(r["!comments"].length>0){var m=_n(u,-1,"../drawings/vmlDrawing"+(s+1)+".vml",ln.VML);or(t,551,qS("rId"+m)),r["!legacy"]=m}}function L$(t,r,s,u){if(r["!autofilter"]){var m=r["!autofilter"],v=typeof m.ref=="string"?m.ref:_s(m.ref);s.Workbook||(s.Workbook={Sheets:[]}),s.Workbook.Names||(s.Workbook.Names=[]);var T=s.Workbook.Names,a=ba(v);a.s.r==a.e.r&&(a.e.r=ba(r["!ref"]).e.r,v=_s(a));for(var R=0;R<T.length;++R){var O=T[R];if(O.Name=="_xlnm._FilterDatabase"&&O.Sheet==u){O.Ref="'"+s.SheetNames[u]+"'!"+v;break}}R==T.length&&T.push({Name:"_xlnm._FilterDatabase",Sheet:u,Ref:"'"+s.SheetNames[u]+"'!"+v}),or(t,161,wm(Un(v))),or(t,162)}}function F$(t,r,s){or(t,133),or(t,137,T$(r,s)),or(t,138),or(t,134)}function N$(t,r){r["!protect"]&&or(t,535,E$(r["!protect"]))}function z$(t,r,s,u){var m=Zo(),v=s.SheetNames[t],T=s.Sheets[v]||{},a=v;try{s&&s.Workbook&&(a=s.Workbook.Sheets[t].CodeName||a)}catch{}var R=Un(T["!ref"]||"A1");if(R.e.c>16383||R.e.r>1048575){if(r.WTF)throw new Error("Range "+(T["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");R.e.c=Math.min(R.e.c,16383),R.e.r=Math.min(R.e.c,1048575)}return T["!links"]=[],T["!comments"]=[],or(m,129),(s.vbaraw||T["!outline"])&&or(m,147,R9(a,T["!outline"])),or(m,148,C9(R)),F$(m,T,s.Workbook),R$(m,T),P$(m,T,t,r),N$(m,T),L$(m,T,s,t),k$(m,T),D$(m,T,u),T["!margins"]&&or(m,476,w$(T["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&M$(m,T),O$(m,T,t,u),or(m,130),m.end()}function B$(t,r){t.l+=10;var s=fo(t);return{name:s}}var j$=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function U$(t){return!t.Workbook||!t.Workbook.WBProps?"false":y8(t.Workbook.WBProps.date1904)?"true":"false"}var V$="][*?/\\".split("");function bO(t,r){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var s=!0;return V$.forEach(function(u){if(t.indexOf(u)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),s}function $$(t,r,s){t.forEach(function(u,m){bO(u);for(var v=0;v<m;++v)if(u==t[v])throw new Error("Duplicate Sheet Name: "+u);if(s){var T=r&&r[m]&&r[m].CodeName||u;if(T.charCodeAt(0)==95&&T.length>22)throw new Error("Bad Code Name: Worksheet"+T)}})}function G$(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var r=t.Workbook&&t.Workbook.Sheets||[];$$(t.SheetNames,r,!!t.vbaraw);for(var s=0;s<t.SheetNames.length;++s)d9(t.Sheets[t.SheetNames[s]],t.SheetNames[s],s)}function TO(t){var r=[ys];r[r.length]=Cr("workbook",null,{xmlns:xm[0],"xmlns:r":Bs.r});var s=t.Workbook&&(t.Workbook.Names||[]).length>0,u={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(j$.forEach(function(a){t.Workbook.WBProps[a[0]]!=null&&t.Workbook.WBProps[a[0]]!=a[1]&&(u[a[0]]=t.Workbook.WBProps[a[0]])}),t.Workbook.WBProps.CodeName&&(u.codeName=t.Workbook.WBProps.CodeName,delete u.CodeName)),r[r.length]=Cr("workbookPr",null,u);var m=t.Workbook&&t.Workbook.Sheets||[],v=0;if(m&&m[0]&&m[0].Hidden){for(r[r.length]="<bookViews>",v=0;v!=t.SheetNames.length&&!(!m[v]||!m[v].Hidden);++v);v==t.SheetNames.length&&(v=0),r[r.length]='<workbookView firstSheet="'+v+'" activeTab="'+v+'"/>',r[r.length]="</bookViews>"}for(r[r.length]="<sheets>",v=0;v!=t.SheetNames.length;++v){var T={name:yn(t.SheetNames[v].slice(0,31))};if(T.sheetId=""+(v+1),T["r:id"]="rId"+(v+1),m[v])switch(m[v].Hidden){case 1:T.state="hidden";break;case 2:T.state="veryHidden";break}r[r.length]=Cr("sheet",null,T)}return r[r.length]="</sheets>",s&&(r[r.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(a){var R={name:a.Name};a.Comment&&(R.comment=a.Comment),a.Sheet!=null&&(R.localSheetId=""+a.Sheet),a.Hidden&&(R.hidden="1"),a.Ref&&(r[r.length]=Cr("definedName",yn(a.Ref),R))}),r[r.length]="</definedNames>"),r.length>2&&(r[r.length]="</workbook>",r[1]=r[1].replace("/>",">")),r.join("")}function H$(t,r){var s={};return s.Hidden=t.read_shift(4),s.iTabID=t.read_shift(4),s.strRelID=MT(t),s.name=fo(t),s}function W$(t,r){return r||(r=Vt(127)),r.write_shift(4,t.Hidden),r.write_shift(4,t.iTabID),qS(t.strRelID,r),Us(t.name.slice(0,31),r),r.length>r.l?r.slice(0,r.l):r}function q$(t,r){var s={},u=t.read_shift(4);s.defaultThemeVersion=t.read_shift(4);var m=r>8?fo(t):"";return m.length>0&&(s.CodeName=m),s.autoCompressPictures=!!(u&65536),s.backupFile=!!(u&64),s.checkCompatibility=!!(u&4096),s.date1904=!!(u&1),s.filterPrivacy=!!(u&8),s.hidePivotFieldList=!!(u&1024),s.promptedSolutions=!!(u&16),s.publishItems=!!(u&2048),s.refreshAllConnections=!!(u&262144),s.saveExternalLinkValues=!!(u&128),s.showBorderUnselectedTables=!!(u&4),s.showInkAnnotation=!!(u&32),s.showObjects=["all","placeholders","none"][u>>13&3],s.showPivotChartFilter=!!(u&32768),s.updateLinks=["userSet","never","always"][u>>8&3],s}function Z$(t,r){r||(r=Vt(72));var s=0;return t&&t.filterPrivacy&&(s|=8),r.write_shift(4,s),r.write_shift(4,0),LD(t&&t.CodeName||"ThisWorkbook",r),r.slice(0,r.l)}function X$(t,r,s){var u=t.l+r;t.l+=4,t.l+=1;var m=t.read_shift(4),v=U8(t),T=o9(t,0,s),a=WS(t);t.l=u;var R={Name:v,Ptg:T};return m<268435455&&(R.Sheet=m),a&&(R.Comment=a),R}function K$(t,r){or(t,143);for(var s=0;s!=r.SheetNames.length;++s){var u=r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[s]&&r.Workbook.Sheets[s].Hidden||0,m={Hidden:u,iTabID:s+1,strRelID:"rId"+(s+1),name:r.SheetNames[s]};or(t,156,W$(m))}or(t,144)}function Y$(t,r){r||(r=Vt(127));for(var s=0;s!=4;++s)r.write_shift(4,0);return Us("SheetJS",r),Us(qv.version,r),Us(qv.version,r),Us("7262",r),r.length>r.l?r.slice(0,r.l):r}function J$(t,r){r||(r=Vt(29)),r.write_shift(-4,0),r.write_shift(-4,460),r.write_shift(4,28800),r.write_shift(4,17600),r.write_shift(4,500),r.write_shift(4,t),r.write_shift(4,t);var s=120;return r.write_shift(1,s),r.length>r.l?r.slice(0,r.l):r}function Q$(t,r){if(!(!r.Workbook||!r.Workbook.Sheets)){for(var s=r.Workbook.Sheets,u=0,m=-1,v=-1;u<s.length;++u)!s[u]||!s[u].Hidden&&m==-1?m=u:s[u].Hidden==1&&v==-1&&(v=u);v>m||(or(t,135),or(t,158,J$(m)),or(t,136))}}function eG(t,r){var s=Zo();return or(s,131),or(s,128,Y$()),or(s,153,Z$(t.Workbook&&t.Workbook.WBProps||null)),Q$(s,t),K$(s,t),or(s,132),s.end()}function tG(t,r,s){return(r.slice(-4)===".bin"?eG:TO)(t)}function rG(t,r,s,u,m){return(r.slice(-4)===".bin"?z$:vO)(t,s,u,m)}function iG(t,r,s){return(r.slice(-4)===".bin"?wV:sO)(t,s)}function nG(t,r,s){return(r.slice(-4)===".bin"?ZU:tO)(t,s)}function sG(t,r,s){return(r.slice(-4)===".bin"?NV:uO)(t)}function oG(t){return(t.slice(-4)===".bin"?PV:lO)()}function aG(t,r){var s=[];return t.Props&&s.push(iU(t.Props,r)),t.Custprops&&s.push(nU(t.Props,t.Custprops)),s.join("")}function lG(){return""}function cG(t,r){var s=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return r.cellXfs.forEach(function(u,m){var v=[];v.push(Cr("NumberFormat",null,{"ss:Format":yn(ss[u.numFmtId])}));var T={"ss:ID":"s"+(21+m)};s.push(Cr("Style",v.join(""),T))}),Cr("Styles",s.join(""))}function SO(t){return Cr("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+YS(t.Ref,{r:0,c:0})})}function uG(t){if(!((t||{}).Workbook||{}).Names)return"";for(var r=t.Workbook.Names,s=[],u=0;u<r.length;++u){var m=r[u];m.Sheet==null&&(m.Name.match(/^_xlfn\./)||s.push(SO(m)))}return Cr("Names",s.join(""))}function hG(t,r,s,u){if(!t||!((u||{}).Workbook||{}).Names)return"";for(var m=u.Workbook.Names,v=[],T=0;T<m.length;++T){var a=m[T];a.Sheet==s&&(a.Name.match(/^_xlfn\./)||v.push(SO(a)))}return v.join("")}function dG(t,r,s,u){if(!t)return"";var m=[];if(t["!margins"]&&(m.push("<PageSetup>"),t["!margins"].header&&m.push(Cr("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&m.push(Cr("Footer",null,{"x:Margin":t["!margins"].footer})),m.push(Cr("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),m.push("</PageSetup>")),u&&u.Workbook&&u.Workbook.Sheets&&u.Workbook.Sheets[s])if(u.Workbook.Sheets[s].Hidden)m.push(Cr("Visible",u.Workbook.Sheets[s].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var v=0;v<s&&!(u.Workbook.Sheets[v]&&!u.Workbook.Sheets[v].Hidden);++v);v==s&&m.push("<Selected/>")}return((((u||{}).Workbook||{}).Views||[])[0]||{}).RTL&&m.push("<DisplayRightToLeft/>"),t["!protect"]&&(m.push(Ys("ProtectContents","True")),t["!protect"].objects&&m.push(Ys("ProtectObjects","True")),t["!protect"].scenarios&&m.push(Ys("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?m.push(Ys("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&m.push(Ys("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(T){t["!protect"][T[0]]&&m.push("<"+T[1]+"/>")})),m.length==0?"":Cr("WorksheetOptions",m.join(""),{xmlns:ga.x})}function fG(t){return t.map(function(r){var s=_8(r.t||""),u=Cr("ss:Data",s,{xmlns:"http://www.w3.org/TR/REC-html40"});return Cr("Comment",u,{"ss:Author":r.a})}).join("")}function pG(t,r,s,u,m,v,T){if(!t||t.v==null&&t.f==null)return"";var a={};if(t.f&&(a["ss:Formula"]="="+yn(YS(t.f,T))),t.F&&t.F.slice(0,r.length)==r){var R=js(t.F.slice(r.length+1));a["ss:ArrayRange"]="RC:R"+(R.r==T.r?"":"["+(R.r-T.r)+"]")+"C"+(R.c==T.c?"":"["+(R.c-T.c)+"]")}if(t.l&&t.l.Target&&(a["ss:HRef"]=yn(t.l.Target),t.l.Tooltip&&(a["x:HRefScreenTip"]=yn(t.l.Tooltip))),s["!merges"])for(var O=s["!merges"],B=0;B!=O.length;++B)O[B].s.c!=T.c||O[B].s.r!=T.r||(O[B].e.c>O[B].s.c&&(a["ss:MergeAcross"]=O[B].e.c-O[B].s.c),O[B].e.r>O[B].s.r&&(a["ss:MergeDown"]=O[B].e.r-O[B].s.r));var H="",q="";switch(t.t){case"z":if(!u.sheetStubs)return"";break;case"n":H="Number",q=String(t.v);break;case"b":H="Boolean",q=t.v?"1":"0";break;case"e":H="Error",q=F_[t.v];break;case"d":H="DateTime",q=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||ss[14]);break;case"s":H="String",q=g8(t.v||"");break}var ee=wh(u.cellXfs,t,u);a["ss:StyleID"]="s"+(21+ee),a["ss:Index"]=T.c+1;var re=t.v!=null?q:"",J=t.t=="z"?"":'<Data ss:Type="'+H+'">'+re+"</Data>";return(t.c||[]).length>0&&(J+=fG(t.c)),Cr("Cell",J,a)}function mG(t,r){var s='<Row ss:Index="'+(t+1)+'"';return r&&(r.hpt&&!r.hpx&&(r.hpx=nO(r.hpt)),r.hpx&&(s+=' ss:AutoFitHeight="0" ss:Height="'+r.hpx+'"'),r.hidden&&(s+=' ss:Hidden="1"')),s+">"}function gG(t,r,s,u){if(!t["!ref"])return"";var m=Un(t["!ref"]),v=t["!merges"]||[],T=0,a=[];t["!cols"]&&t["!cols"].forEach(function(_e,pe){XS(_e);var ue=!!_e.width,ie=F1(pe,_e),ke={"ss:Index":pe+1};ue&&(ke["ss:Width"]=r1(ie.width)),_e.hidden&&(ke["ss:Hidden"]="1"),a.push(Cr("Column",null,ke))});for(var R=Array.isArray(t),O=m.s.r;O<=m.e.r;++O){for(var B=[mG(O,(t["!rows"]||[])[O])],H=m.s.c;H<=m.e.c;++H){var q=!1;for(T=0;T!=v.length;++T)if(!(v[T].s.c>H)&&!(v[T].s.r>O)&&!(v[T].e.c<H)&&!(v[T].e.r<O)){(v[T].s.c!=H||v[T].s.r!=O)&&(q=!0);break}if(!q){var ee={r:O,c:H},re=vn(ee),J=R?(t[O]||[])[H]:t[re];B.push(pG(J,re,t,r,s,u,ee))}}B.push("</Row>"),B.length>2&&a.push(B.join(""))}return a.join("")}function _G(t,r,s){var u=[],m=s.SheetNames[t],v=s.Sheets[m],T=v?hG(v,r,t,s):"";return T.length>0&&u.push("<Names>"+T+"</Names>"),T=v?gG(v,r,t,s):"",T.length>0&&u.push("<Table>"+T+"</Table>"),u.push(dG(v,r,t,s)),u.join("")}function yG(t,r){r||(r={}),t.SSF||(t.SSF=Ko(ss)),t.SSF&&(R1(),k1(t.SSF),r.revssf=M1(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF,r.cellXfs=[],wh(r.cellXfs,{},{revssf:{General:0}}));var s=[];s.push(aG(t,r)),s.push(lG()),s.push(""),s.push("");for(var u=0;u<t.SheetNames.length;++u)s.push(Cr("Worksheet",_G(u,r,t),{"ss:Name":yn(t.SheetNames[u])}));return s[2]=cG(t,r),s[3]=uG(t),ys+Cr("Workbook",s.join(""),{xmlns:ga.ss,"xmlns:o":ga.o,"xmlns:x":ga.x,"xmlns:ss":ga.ss,"xmlns:dt":ga.dt,"xmlns:html":ga.html})}var w2={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function xG(t,r){var s=[],u=[],m=[],v=0,T,a=R3(G3,"n"),R=R3(H3,"n");if(t.Props)for(T=to(t.Props),v=0;v<T.length;++v)(Object.prototype.hasOwnProperty.call(a,T[v])?s:Object.prototype.hasOwnProperty.call(R,T[v])?u:m).push([T[v],t.Props[T[v]]]);if(t.Custprops)for(T=to(t.Custprops),v=0;v<T.length;++v)Object.prototype.hasOwnProperty.call(t.Props||{},T[v])||(Object.prototype.hasOwnProperty.call(a,T[v])?s:Object.prototype.hasOwnProperty.call(R,T[v])?u:m).push([T[v],t.Custprops[T[v]]]);var O=[];for(v=0;v<m.length;++v)ZD.indexOf(m[v][0])>-1||HD.indexOf(m[v][0])>-1||m[v][1]!=null&&O.push(m[v]);u.length&&Tn.utils.cfb_add(r,"/SummaryInformation",K3(u,w2.SI,R,H3)),(s.length||O.length)&&Tn.utils.cfb_add(r,"/DocumentSummaryInformation",K3(s,w2.DSI,a,G3,O.length?O:null,w2.UDI))}function vG(t,r){var s=r||{},u=Tn.utils.cfb_new({root:"R"}),m="/Workbook";switch(s.bookType||"xls"){case"xls":s.bookType="biff8";case"xla":s.bookType||(s.bookType="xla");case"biff8":m="/Workbook",s.biff=8;break;case"biff5":m="/Book",s.biff=5;break;default:throw new Error("invalid type "+s.bookType+" for XLS CFB")}return Tn.utils.cfb_add(u,m,EO(t,s)),s.biff==8&&(t.Props||t.Custprops)&&xG(t,u),s.biff==8&&t.vbaraw&&zV(u,Tn.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),u}var wG={0:{f:S9},1:{f:M9},2:{f:J9},3:{f:j9},4:{f:F9},5:{f:Z9},6:{f:i$},7:{f:G9},8:{f:u$},9:{f:c$},10:{f:a$},11:{f:l$},12:{f:O9},13:{f:e$},14:{f:V9},15:{f:z9},16:{f:K9},17:{f:s$},18:{f:W9},19:{f:HS},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:X$},40:{},42:{},43:{f:iV},44:{f:tV},45:{f:oV},46:{f:lV},47:{f:aV},48:{},49:{f:O8},50:{},51:{f:SV},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:LU},62:{f:r$},63:{f:kV},64:{f:A$},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:sc,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:b$},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:k9},148:{f:I9,p:16},151:{f:g$},152:{},153:{f:q$},154:{},155:{},156:{f:H$},157:{},158:{},159:{T:1,f:HU},160:{T:-1},161:{T:1,f:Wd},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:h$},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:bV},336:{T:-1},337:{f:IV,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:MT},357:{},358:{},359:{},360:{T:1},361:{},362:{f:PU},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:_$},427:{f:y$},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:v$},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:P9},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:p$},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:MT},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:LV},633:{T:1},634:{T:-1},635:{T:1,f:DV},636:{T:-1},637:{f:z8},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:B$},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:I$},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function kr(t,r,s,u){var m=r;if(!isNaN(m)){var v=u||(s||[]).length||0,T=t.next(4);T.write_shift(2,m),T.write_shift(2,v),v>0&&VS(s)&&t.push(s)}}function bG(t,r,s,u){var m=(s||[]).length||0;if(m<=8224)return kr(t,r,s,m);var v=r;if(!isNaN(v)){for(var T=s.parts||[],a=0,R=0,O=0;O+(T[a]||8224)<=8224;)O+=T[a]||8224,a++;var B=t.next(4);for(B.write_shift(2,v),B.write_shift(2,O),t.push(s.slice(R,R+O)),R+=O;R<m;){for(B=t.next(4),B.write_shift(2,60),O=0;O+(T[a]||8224)<=8224;)O+=T[a]||8224,a++;B.write_shift(2,O),t.push(s.slice(R,R+O)),R+=O}}}function z_(t,r,s){return t||(t=Vt(7)),t.write_shift(2,r),t.write_shift(2,s),t.write_shift(2,0),t.write_shift(1,0),t}function TG(t,r,s,u){var m=Vt(9);return z_(m,t,r),KD(s,u||"b",m),m}function SG(t,r,s){var u=Vt(8+2*s.length);return z_(u,t,r),u.write_shift(1,s.length),u.write_shift(s.length,s,"sbcs"),u.l<u.length?u.slice(0,u.l):u}function EG(t,r,s,u){if(r.v!=null)switch(r.t){case"d":case"n":var m=r.t=="d"?Xo(Lo(r.v)):r.v;m==(m|0)&&m>=0&&m<65536?kr(t,2,BU(s,u,m)):kr(t,3,zU(s,u,m));return;case"b":case"e":kr(t,5,TG(s,u,r.v,r.t));return;case"s":case"str":kr(t,4,SG(s,u,(r.v||"").slice(0,255)));return}kr(t,1,z_(null,s,u))}function AG(t,r,s,u){var m=Array.isArray(r),v=Un(r["!ref"]||"A1"),T,a="",R=[];if(v.e.c>255||v.e.r>16383){if(u.WTF)throw new Error("Range "+(r["!ref"]||"A1")+" exceeds format limit A1:IV16384");v.e.c=Math.min(v.e.c,255),v.e.r=Math.min(v.e.c,16383),T=_s(v)}for(var O=v.s.r;O<=v.e.r;++O){a=Qs(O);for(var B=v.s.c;B<=v.e.c;++B){O===v.s.r&&(R[B]=ho(B)),T=R[B]+a;var H=m?(r[O]||[])[B]:r[T];H&&EG(t,H,O,B)}}}function IG(t,r){for(var s=r||{},u=Zo(),m=0,v=0;v<t.SheetNames.length;++v)t.SheetNames[v]==s.sheet&&(m=v);if(m==0&&s.sheet&&t.SheetNames[0]!=s.sheet)throw new Error("Sheet not found: "+s.sheet);return kr(u,s.biff==4?1033:s.biff==3?521:9,ZS(t,16,s)),AG(u,t.Sheets[t.SheetNames[m]],m,s),kr(u,10),u.end()}function CG(t,r,s){kr(t,49,wU({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},s))}function PG(t,r,s){r&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(u){for(var m=u[0];m<=u[1];++m)r[m]!=null&&kr(t,1054,SU(m,r[m],s))})}function kG(t,r){var s=Vt(19);s.write_shift(4,2151),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(2,3),s.write_shift(1,1),s.write_shift(4,0),kr(t,2151,s),s=Vt(39),s.write_shift(4,2152),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(2,3),s.write_shift(1,0),s.write_shift(4,0),s.write_shift(2,1),s.write_shift(4,4),s.write_shift(2,0),QD(Un(r["!ref"]||"A1"),s),s.write_shift(4,4),kr(t,2152,s)}function RG(t,r){for(var s=0;s<16;++s)kr(t,224,J3({numFmtId:0,style:!0},0,r));r.cellXfs.forEach(function(u){kr(t,224,J3(u,0,r))})}function MG(t,r){for(var s=0;s<r["!links"].length;++s){var u=r["!links"][s];kr(t,440,MU(u)),u[1].Tooltip&&kr(t,2048,DU(u))}delete r["!links"]}function DG(t,r){if(r){var s=0;r.forEach(function(u,m){++s<=256&&u&&kr(t,125,FU(F1(m,u),m))})}}function OG(t,r,s,u,m){var v=16+wh(m.cellXfs,r,m);if(r.v==null&&!r.bf){kr(t,513,Fd(s,u,v));return}if(r.bf)kr(t,6,n9(r,s,u,m,v));else switch(r.t){case"d":case"n":var T=r.t=="d"?Xo(Lo(r.v)):r.v;kr(t,515,CU(s,u,T,v));break;case"b":case"e":kr(t,517,IU(s,u,r.v,v,m,r.t));break;case"s":case"str":if(m.bookSST){var a=QS(m.Strings,r.v,m.revStrings);kr(t,253,bU(s,u,a,v))}else kr(t,516,TU(s,u,(r.v||"").slice(0,255),v,m));break;default:kr(t,513,Fd(s,u,v))}}function LG(t,r,s){var u=Zo(),m=s.SheetNames[t],v=s.Sheets[m]||{},T=(s||{}).Workbook||{},a=(T.Sheets||[])[t]||{},R=Array.isArray(v),O=r.biff==8,B,H="",q=[],ee=Un(v["!ref"]||"A1"),re=O?65536:16384;if(ee.e.c>255||ee.e.r>=re){if(r.WTF)throw new Error("Range "+(v["!ref"]||"A1")+" exceeds format limit A1:IV16384");ee.e.c=Math.min(ee.e.c,255),ee.e.r=Math.min(ee.e.c,re-1)}kr(u,2057,ZS(s,16,r)),kr(u,13,za(1)),kr(u,12,za(100)),kr(u,15,Do(!0)),kr(u,17,Do(!1)),kr(u,16,Ld(.001)),kr(u,95,Do(!0)),kr(u,42,Do(!1)),kr(u,43,Do(!1)),kr(u,130,za(1)),kr(u,128,AU()),kr(u,131,Do(!1)),kr(u,132,Do(!1)),O&&DG(u,v["!cols"]),kr(u,512,EU(ee,r)),O&&(v["!links"]=[]);for(var J=ee.s.r;J<=ee.e.r;++J){H=Qs(J);for(var _e=ee.s.c;_e<=ee.e.c;++_e){J===ee.s.r&&(q[_e]=ho(_e)),B=q[_e]+H;var pe=R?(v[J]||[])[_e]:v[B];pe&&(OG(u,pe,J,_e,r),O&&pe.l&&v["!links"].push([B,pe.l]))}}var ue=a.CodeName||a.name||m;return O&&kr(u,574,vU((T.Views||[])[0])),O&&(v["!merges"]||[]).length&&kr(u,229,RU(v["!merges"])),O&&MG(u,v),kr(u,442,JD(ue)),O&&kG(u,v),kr(u,10),u.end()}function FG(t,r,s){var u=Zo(),m=(t||{}).Workbook||{},v=m.Sheets||[],T=m.WBProps||{},a=s.biff==8,R=s.biff==5;if(kr(u,2057,ZS(t,5,s)),s.bookType=="xla"&&kr(u,135),kr(u,225,a?za(1200):null),kr(u,193,aU(2)),R&&kr(u,191),R&&kr(u,192),kr(u,226),kr(u,92,gU("SheetJS",s)),kr(u,66,za(a?1200:1252)),a&&kr(u,353,za(0)),a&&kr(u,448),kr(u,317,NU(t.SheetNames.length)),a&&t.vbaraw&&kr(u,211),a&&t.vbaraw){var O=T.CodeName||"ThisWorkbook";kr(u,442,JD(O))}kr(u,156,za(17)),kr(u,25,Do(!1)),kr(u,18,Do(!1)),kr(u,19,za(0)),a&&kr(u,431,Do(!1)),a&&kr(u,444,za(0)),kr(u,61,xU()),kr(u,64,Do(!1)),kr(u,141,za(0)),kr(u,34,Do(U$(t)=="true")),kr(u,14,Do(!0)),a&&kr(u,439,Do(!1)),kr(u,218,za(0)),CG(u,t,s),PG(u,t.SSF,s),RG(u,s),a&&kr(u,352,Do(!1));var B=u.end(),H=Zo();a&&kr(H,140,OU()),a&&s.Strings&&bG(H,252,yU(s.Strings)),kr(H,10);var q=H.end(),ee=Zo(),re=0,J=0;for(J=0;J<t.SheetNames.length;++J)re+=(a?12:11)+(a?2:1)*t.SheetNames[J].length;var _e=B.length+re+q.length;for(J=0;J<t.SheetNames.length;++J){var pe=v[J]||{};kr(ee,133,_U({pos:_e,hs:pe.Hidden||0,dt:0,name:t.SheetNames[J]},s)),_e+=r[J].length}var ue=ee.end();if(re!=ue.length)throw new Error("BS8 "+re+" != "+ue.length);var ie=[];return B.length&&ie.push(B),ue.length&&ie.push(ue),q.length&&ie.push(q),Ks(ie)}function NG(t,r){var s=r||{},u=[];t&&!t.SSF&&(t.SSF=Ko(ss)),t&&t.SSF&&(R1(),k1(t.SSF),s.revssf=M1(t.SSF),s.revssf[t.SSF[65535]]=0,s.ssf=t.SSF),s.Strings=[],s.Strings.Count=0,s.Strings.Unique=0,eE(s),s.cellXfs=[],wh(s.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var m=0;m<t.SheetNames.length;++m)u[u.length]=LG(m,s,t);return u.unshift(FG(t,u,s)),Ks(u)}function EO(t,r){for(var s=0;s<=t.SheetNames.length;++s){var u=t.Sheets[t.SheetNames[s]];if(!(!u||!u["!ref"])){var m=ba(u["!ref"]);m.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+t.SheetNames[s]+"' extends beyond column IV (255).  Data may be lost.")}}var v=r||{};switch(v.biff||2){case 8:case 5:return NG(t,r);case 4:case 3:case 2:return IG(t,r)}throw new Error("invalid type "+v.bookType+" for BIFF")}function zG(t,r,s,u){for(var m=t["!merges"]||[],v=[],T=r.s.c;T<=r.e.c;++T){for(var a=0,R=0,O=0;O<m.length;++O)if(!(m[O].s.r>s||m[O].s.c>T)&&!(m[O].e.r<s||m[O].e.c<T)){if(m[O].s.r<s||m[O].s.c<T){a=-1;break}a=m[O].e.r-m[O].s.r+1,R=m[O].e.c-m[O].s.c+1;break}if(!(a<0)){var B=vn({r:s,c:T}),H=u.dense?(t[s]||[])[T]:t[B],q=H&&H.v!=null&&(H.h||m8(H.w||(Jc(H),H.w)||""))||"",ee={};a>1&&(ee.rowspan=a),R>1&&(ee.colspan=R),u.editable?q='<span contenteditable="true">'+q+"</span>":H&&(ee["data-t"]=H&&H.t||"z",H.v!=null&&(ee["data-v"]=H.v),H.z!=null&&(ee["data-z"]=H.z),H.l&&(H.l.Target||"#").charAt(0)!="#"&&(q='<a href="'+H.l.Target+'">'+q+"</a>")),ee.id=(u.id||"sjs")+"-"+B,v.push(Cr("td",q,ee))}}var re="<tr>";return re+v.join("")+"</tr>"}var BG='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',jG="</body></html>";function UG(t,r,s){var u=[];return u.join("")+"<table"+(s&&s.id?' id="'+s.id+'"':"")+">"}function AO(t,r){var s=r||{},u=s.header!=null?s.header:BG,m=s.footer!=null?s.footer:jG,v=[u],T=ba(t["!ref"]);s.dense=Array.isArray(t),v.push(UG(t,T,s));for(var a=T.s.r;a<=T.e.r;++a)v.push(zG(t,T,a,s));return v.push("</table>"+m),v.join("")}function IO(t,r,s){var u=s||{},m=0,v=0;if(u.origin!=null)if(typeof u.origin=="number")m=u.origin;else{var T=typeof u.origin=="string"?js(u.origin):u.origin;m=T.r,v=T.c}var a=r.getElementsByTagName("tr"),R=Math.min(u.sheetRows||1e7,a.length),O={s:{r:0,c:0},e:{r:m,c:v}};if(t["!ref"]){var B=ba(t["!ref"]);O.s.r=Math.min(O.s.r,B.s.r),O.s.c=Math.min(O.s.c,B.s.c),O.e.r=Math.max(O.e.r,B.e.r),O.e.c=Math.max(O.e.c,B.e.c),m==-1&&(O.e.r=m=B.e.r+1)}var H=[],q=0,ee=t["!rows"]||(t["!rows"]=[]),re=0,J=0,_e=0,pe=0,ue=0,ie=0;for(t["!cols"]||(t["!cols"]=[]);re<a.length&&J<R;++re){var ke=a[re];if(sk(ke)){if(u.display)continue;ee[J]={hidden:!0}}var at=ke.children;for(_e=pe=0;_e<at.length;++_e){var He=at[_e];if(!(u.display&&sk(He))){var De=He.hasAttribute("data-v")?He.getAttribute("data-v"):He.hasAttribute("v")?He.getAttribute("v"):x8(He.innerHTML),et=He.getAttribute("data-z")||He.getAttribute("z");for(q=0;q<H.length;++q){var Ge=H[q];Ge.s.c==pe+v&&Ge.s.r<J+m&&J+m<=Ge.e.r&&(pe=Ge.e.c+1-v,q=-1)}ie=+He.getAttribute("colspan")||1,((ue=+He.getAttribute("rowspan")||1)>1||ie>1)&&H.push({s:{r:J+m,c:pe+v},e:{r:J+m+(ue||1)-1,c:pe+v+(ie||1)-1}});var ft={t:"s",v:De},tt=He.getAttribute("data-t")||He.getAttribute("t")||"";De!=null&&(De.length==0?ft.t=tt||"z":u.raw||De.trim().length==0||tt=="s"||(De==="TRUE"?ft={t:"b",v:!0}:De==="FALSE"?ft={t:"b",v:!1}:isNaN(Gc(De))?isNaN(w_(De).getDate())||(ft={t:"d",v:Lo(De)},u.cellDates||(ft={t:"n",v:Xo(ft.v)}),ft.z=u.dateNF||ss[14]):ft={t:"n",v:Gc(De)})),ft.z===void 0&&et!=null&&(ft.z=et);var Ot="",Xt=He.getElementsByTagName("A");if(Xt&&Xt.length)for(var Dr=0;Dr<Xt.length&&!(Xt[Dr].hasAttribute("href")&&(Ot=Xt[Dr].getAttribute("href"),Ot.charAt(0)!="#"));++Dr);Ot&&Ot.charAt(0)!="#"&&(ft.l={Target:Ot}),u.dense?(t[J+m]||(t[J+m]=[]),t[J+m][pe+v]=ft):t[vn({c:pe+v,r:J+m})]=ft,O.e.c<pe+v&&(O.e.c=pe+v),pe+=ie}}++J}return H.length&&(t["!merges"]=(t["!merges"]||[]).concat(H)),O.e.r=Math.max(O.e.r,J-1+m),t["!ref"]=_s(O),J>=R&&(t["!fullref"]=_s((O.e.r=a.length-re+J-1+m,O))),t}function CO(t,r){var s=r||{},u=s.dense?[]:{};return IO(u,t,r)}function VG(t,r){return Vd(CO(t,r),r)}function sk(t){var r="",s=$G(t);return s&&(r=s(t).getPropertyValue("display")),r||(r=t.style&&t.style.display),r==="none"}function $G(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var GG=function(){var t=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),r="<office:document-styles "+T_({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+t+"</office:document-styles>";return function(){return ys+r}}(),ok=function(){var t=function(v){return yn(v).replace(/  +/g,function(T){return'<text:s text:c="'+T.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},r=`          <table:table-cell />
`,s=`          <table:covered-table-cell/>
`,u=function(v,T,a){var R=[];R.push('      <table:table table:name="'+yn(T.SheetNames[a])+`" table:style-name="ta1">
`);var O=0,B=0,H=ba(v["!ref"]||"A1"),q=v["!merges"]||[],ee=0,re=Array.isArray(v);if(v["!cols"])for(B=0;B<=H.e.c;++B)R.push("        <table:table-column"+(v["!cols"][B]?' table:style-name="co'+v["!cols"][B].ods+'"':"")+`></table:table-column>
`);var J="",_e=v["!rows"]||[];for(O=0;O<H.s.r;++O)J=_e[O]?' table:style-name="ro'+_e[O].ods+'"':"",R.push("        <table:table-row"+J+`></table:table-row>
`);for(;O<=H.e.r;++O){for(J=_e[O]?' table:style-name="ro'+_e[O].ods+'"':"",R.push("        <table:table-row"+J+`>
`),B=0;B<H.s.c;++B)R.push(r);for(;B<=H.e.c;++B){var pe=!1,ue={},ie="";for(ee=0;ee!=q.length;++ee)if(!(q[ee].s.c>B)&&!(q[ee].s.r>O)&&!(q[ee].e.c<B)&&!(q[ee].e.r<O)){(q[ee].s.c!=B||q[ee].s.r!=O)&&(pe=!0),ue["table:number-columns-spanned"]=q[ee].e.c-q[ee].s.c+1,ue["table:number-rows-spanned"]=q[ee].e.r-q[ee].s.r+1;break}if(pe){R.push(s);continue}var ke=vn({r:O,c:B}),at=re?(v[O]||[])[B]:v[ke];if(at&&at.f&&(ue["table:formula"]=yn(u9(at.f)),at.F&&at.F.slice(0,ke.length)==ke)){var He=ba(at.F);ue["table:number-matrix-columns-spanned"]=He.e.c-He.s.c+1,ue["table:number-matrix-rows-spanned"]=He.e.r-He.s.r+1}if(!at){R.push(r);continue}switch(at.t){case"b":ie=at.v?"TRUE":"FALSE",ue["office:value-type"]="boolean",ue["office:boolean-value"]=at.v?"true":"false";break;case"n":ie=at.w||String(at.v||0),ue["office:value-type"]="float",ue["office:value"]=at.v||0;break;case"s":case"str":ie=at.v==null?"":at.v,ue["office:value-type"]="string";break;case"d":ie=at.w||Lo(at.v).toISOString(),ue["office:value-type"]="date",ue["office:date-value"]=Lo(at.v).toISOString(),ue["table:style-name"]="ce1";break;default:R.push(r);continue}var De=t(ie);if(at.l&&at.l.Target){var et=at.l.Target;et=et.charAt(0)=="#"?"#"+h9(et.slice(1)):et,et.charAt(0)!="#"&&!et.match(/^\w+:/)&&(et="../"+et),De=Cr("text:a",De,{"xlink:href":et.replace(/&/g,"&amp;")})}R.push("          "+Cr("table:table-cell",Cr("text:p",De,{}),ue)+`
`)}R.push(`        </table:table-row>
`)}return R.push(`      </table:table>
`),R.join("")},m=function(v,T){v.push(` <office:automatic-styles>
`),v.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),v.push(`   <number:month number:style="long"/>
`),v.push(`   <number:text>/</number:text>
`),v.push(`   <number:day number:style="long"/>
`),v.push(`   <number:text>/</number:text>
`),v.push(`   <number:year/>
`),v.push(`  </number:date-style>
`);var a=0;T.SheetNames.map(function(O){return T.Sheets[O]}).forEach(function(O){if(O&&O["!cols"]){for(var B=0;B<O["!cols"].length;++B)if(O["!cols"][B]){var H=O["!cols"][B];if(H.width==null&&H.wpx==null&&H.wch==null)continue;XS(H),H.ods=a;var q=O["!cols"][B].wpx+"px";v.push('  <style:style style:name="co'+a+`" style:family="table-column">
`),v.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+q+`"/>
`),v.push(`  </style:style>
`),++a}}});var R=0;T.SheetNames.map(function(O){return T.Sheets[O]}).forEach(function(O){if(O&&O["!rows"]){for(var B=0;B<O["!rows"].length;++B)if(O["!rows"][B]){O["!rows"][B].ods=R;var H=O["!rows"][B].hpx+"px";v.push('  <style:style style:name="ro'+R+`" style:family="table-row">
`),v.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+H+`"/>
`),v.push(`  </style:style>
`),++R}}}),v.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),v.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),v.push(`  </style:style>
`),v.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),v.push(` </office:automatic-styles>
`)};return function(T,a){var R=[ys],O=T_({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),B=T_({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});a.bookType=="fods"?(R.push("<office:document"+O+B+`>
`),R.push($D().replace(/office:document-meta/g,"office:meta"))):R.push("<office:document-content"+O+`>
`),m(R,T),R.push(`  <office:body>
`),R.push(`    <office:spreadsheet>
`);for(var H=0;H!=T.SheetNames.length;++H)R.push(u(T.Sheets[T.SheetNames[H]],T,H));return R.push(`    </office:spreadsheet>
`),R.push(`  </office:body>
`),a.bookType=="fods"?R.push("</office:document>"):R.push("</office:document-content>"),R.join("")}}();function PO(t,r){if(r.bookType=="fods")return ok(t,r);var s=zS(),u="",m=[],v=[];return u="mimetype",Fi(s,u,"application/vnd.oasis.opendocument.spreadsheet"),u="content.xml",Fi(s,u,ok(t,r)),m.push([u,"text/xml"]),v.push([u,"ContentFile"]),u="styles.xml",Fi(s,u,GG(t,r)),m.push([u,"text/xml"]),v.push([u,"StylesFile"]),u="meta.xml",Fi(s,u,ys+$D()),m.push([u,"text/xml"]),v.push([u,"MetadataFile"]),u="manifest.rdf",Fi(s,u,rU(v)),m.push([u,"application/rdf+xml"]),u="META-INF/manifest.xml",Fi(s,u,eU(m)),s}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function s1(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function HG(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):ml(b_(t))}function WG(t,r){e:for(var s=0;s<=t.length-r.length;++s){for(var u=0;u<r.length;++u)if(t[s+u]!=r[u])continue e;return!0}return!1}function gh(t){var r=t.reduce(function(m,v){return m+v.length},0),s=new Uint8Array(r),u=0;return t.forEach(function(m){s.set(m,u),u+=m.length}),s}function qG(t,r,s){var u=Math.floor(s==0?0:Math.LOG10E*Math.log(Math.abs(s)))+6176-20,m=s/Math.pow(10,u-6176);t[r+15]|=u>>7,t[r+14]|=(u&127)<<1;for(var v=0;m>=1;++v,m/=256)t[r+v]=m&255;t[r+15]|=s>=0?0:128}function S_(t,r){var s=r?r[0]:0,u=t[s]&127;e:if(t[s++]>=128&&(u|=(t[s]&127)<<7,t[s++]<128||(u|=(t[s]&127)<<14,t[s++]<128)||(u|=(t[s]&127)<<21,t[s++]<128)||(u+=(t[s]&127)*Math.pow(2,28),++s,t[s++]<128)||(u+=(t[s]&127)*Math.pow(2,35),++s,t[s++]<128)||(u+=(t[s]&127)*Math.pow(2,42),++s,t[s++]<128)))break e;return r&&(r[0]=s),u}function gn(t){var r=new Uint8Array(7);r[0]=t&127;var s=1;e:if(t>127){if(r[s-1]|=128,r[s]=t>>7&127,++s,t<=16383||(r[s-1]|=128,r[s]=t>>14&127,++s,t<=2097151)||(r[s-1]|=128,r[s]=t>>21&127,++s,t<=268435455)||(r[s-1]|=128,r[s]=t/256>>>21&127,++s,t<=34359738367)||(r[s-1]|=128,r[s]=t/65536>>>21&127,++s,t<=4398046511103))break e;r[s-1]|=128,r[s]=t/16777216>>>21&127,++s}return r.slice(0,s)}function nm(t){var r=0,s=t[r]&127;e:if(t[r++]>=128){if(s|=(t[r]&127)<<7,t[r++]<128||(s|=(t[r]&127)<<14,t[r++]<128)||(s|=(t[r]&127)<<21,t[r++]<128))break e;s|=(t[r]&127)<<28}return s}function As(t){for(var r=[],s=[0];s[0]<t.length;){var u=s[0],m=S_(t,s),v=m&7;m=Math.floor(m/8);var T=0,a;if(m==0)break;switch(v){case 0:{for(var R=s[0];t[s[0]++]>=128;);a=t.slice(R,s[0])}break;case 5:T=4,a=t.slice(s[0],s[0]+T),s[0]+=T;break;case 1:T=8,a=t.slice(s[0],s[0]+T),s[0]+=T;break;case 2:T=S_(t,s),a=t.slice(s[0],s[0]+T),s[0]+=T;break;case 3:case 4:default:throw new Error("PB Type ".concat(v," for Field ").concat(m," at offset ").concat(u))}var O={data:a,type:v};r[m]==null?r[m]=[O]:r[m].push(O)}return r}function qs(t){var r=[];return t.forEach(function(s,u){s.forEach(function(m){m.data&&(r.push(gn(u*8+m.type)),m.type==2&&r.push(gn(m.data.length)),r.push(m.data))})}),gh(r)}function ll(t){for(var r,s=[],u=[0];u[0]<t.length;){var m=S_(t,u),v=As(t.slice(u[0],u[0]+m));u[0]+=m;var T={id:nm(v[1][0].data),messages:[]};v[2].forEach(function(a){var R=As(a.data),O=nm(R[3][0].data);T.messages.push({meta:R,data:t.slice(u[0],u[0]+O)}),u[0]+=O}),(r=v[3])!=null&&r[0]&&(T.merge=nm(v[3][0].data)>>>0>0),s.push(T)}return s}function kp(t){var r=[];return t.forEach(function(s){var u=[];u[1]=[{data:gn(s.id),type:0}],u[2]=[],s.merge!=null&&(u[3]=[{data:gn(+!!s.merge),type:0}]);var m=[];s.messages.forEach(function(T){m.push(T.data),T.meta[3]=[{type:0,data:gn(T.data.length)}],u[2].push({data:qs(T.meta),type:2})});var v=qs(u);r.push(gn(v.length)),r.push(v),m.forEach(function(T){return r.push(T)})}),gh(r)}function ZG(t,r){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var s=[0],u=S_(r,s),m=[];s[0]<r.length;){var v=r[s[0]]&3;if(v==0){var T=r[s[0]++]>>2;if(T<60)++T;else{var a=T-59;T=r[s[0]],a>1&&(T|=r[s[0]+1]<<8),a>2&&(T|=r[s[0]+2]<<16),a>3&&(T|=r[s[0]+3]<<24),T>>>=0,T++,s[0]+=a}m.push(r.slice(s[0],s[0]+T)),s[0]+=T;continue}else{var R=0,O=0;if(v==1?(O=(r[s[0]]>>2&7)+4,R=(r[s[0]++]&224)<<3,R|=r[s[0]++]):(O=(r[s[0]++]>>2)+1,v==2?(R=r[s[0]]|r[s[0]+1]<<8,s[0]+=2):(R=(r[s[0]]|r[s[0]+1]<<8|r[s[0]+2]<<16|r[s[0]+3]<<24)>>>0,s[0]+=4)),m=[gh(m)],R==0)throw new Error("Invalid offset 0");if(R>m[0].length)throw new Error("Invalid offset beyond length");if(O>=R)for(m.push(m[0].slice(-R)),O-=R;O>=m[m.length-1].length;)m.push(m[m.length-1]),O-=m[m.length-1].length;m.push(m[0].slice(-R,-R+O))}}var B=gh(m);if(B.length!=u)throw new Error("Unexpected length: ".concat(B.length," != ").concat(u));return B}function cl(t){for(var r=[],s=0;s<t.length;){var u=t[s++],m=t[s]|t[s+1]<<8|t[s+2]<<16;s+=3,r.push(ZG(u,t.slice(s,s+m))),s+=m}if(s!==t.length)throw new Error("data is not a valid framed stream!");return gh(r)}function Rp(t){for(var r=[],s=0;s<t.length;){var u=Math.min(t.length-s,268435455),m=new Uint8Array(4);r.push(m);var v=gn(u),T=v.length;r.push(v),u<=60?(T++,r.push(new Uint8Array([u-1<<2]))):u<=256?(T+=2,r.push(new Uint8Array([240,u-1&255]))):u<=65536?(T+=3,r.push(new Uint8Array([244,u-1&255,u-1>>8&255]))):u<=16777216?(T+=4,r.push(new Uint8Array([248,u-1&255,u-1>>8&255,u-1>>16&255]))):u<=4294967296&&(T+=5,r.push(new Uint8Array([252,u-1&255,u-1>>8&255,u-1>>16&255,u-1>>>24&255]))),r.push(t.slice(s,s+u)),T+=u,m[0]=0,m[1]=T&255,m[2]=T>>8&255,m[3]=T>>16&255,s+=u}return gh(r)}function b2(t,r){var s=new Uint8Array(32),u=s1(s),m=12,v=0;switch(s[0]=5,t.t){case"n":s[1]=2,qG(s,m,t.v),v|=1,m+=16;break;case"b":s[1]=6,u.setFloat64(m,t.v?1:0,!0),v|=2,m+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));s[1]=3,u.setUint32(m,r.indexOf(t.v),!0),v|=8,m+=4;break;default:throw"unsupported cell type "+t.t}return u.setUint32(8,v,!0),s.slice(0,m)}function T2(t,r){var s=new Uint8Array(32),u=s1(s),m=12,v=0;switch(s[0]=3,t.t){case"n":s[2]=2,u.setFloat64(m,t.v,!0),v|=32,m+=8;break;case"b":s[2]=6,u.setFloat64(m,t.v?1:0,!0),v|=32,m+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));s[2]=3,u.setUint32(m,r.indexOf(t.v),!0),v|=16,m+=4;break;default:throw"unsupported cell type "+t.t}return u.setUint32(4,v,!0),s.slice(0,m)}function qu(t){var r=As(t);return S_(r[1][0].data)}function XG(t,r,s){var u,m,v,T;if(!((u=t[6])!=null&&u[0])||!((m=t[7])!=null&&m[0]))throw"Mutation only works on post-BNC storages!";var a=((T=(v=t[8])==null?void 0:v[0])==null?void 0:T.data)&&nm(t[8][0].data)>0||!1;if(a)throw"Math only works with normal offsets";for(var R=0,O=s1(t[7][0].data),B=0,H=[],q=s1(t[4][0].data),ee=0,re=[],J=0;J<r.length;++J){if(r[J]==null){O.setUint16(J*2,65535,!0),q.setUint16(J*2,65535);continue}O.setUint16(J*2,B,!0),q.setUint16(J*2,ee,!0);var _e,pe;switch(typeof r[J]){case"string":_e=b2({t:"s",v:r[J]},s),pe=T2({t:"s",v:r[J]},s);break;case"number":_e=b2({t:"n",v:r[J]},s),pe=T2({t:"n",v:r[J]},s);break;case"boolean":_e=b2({t:"b",v:r[J]},s),pe=T2({t:"b",v:r[J]},s);break;default:throw new Error("Unsupported value "+r[J])}H.push(_e),B+=_e.length,re.push(pe),ee+=pe.length,++R}for(t[2][0].data=gn(R);J<t[7][0].data.length/2;++J)O.setUint16(J*2,65535,!0),q.setUint16(J*2,65535,!0);return t[6][0].data=gh(H),t[3][0].data=gh(re),R}function KG(t,r){if(!r||!r.numbers)throw new Error("Must pass a `numbers` option -- check the README");var s=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var u=ba(s["!ref"]);u.s.r=u.s.c=0;var m=!1;u.e.c>9&&(m=!0,u.e.c=9),u.e.r>49&&(m=!0,u.e.r=49),m&&console.error("The Numbers writer is currently limited to ".concat(_s(u)));var v=o1(s,{range:u,header:1}),T=["~Sh33tJ5~"];v.forEach(function(vt){return vt.forEach(function(ct){typeof ct=="string"&&T.push(ct)})});var a={},R=[],O=Tn.read(r.numbers,{type:"base64"});O.FileIndex.map(function(vt,ct){return[vt,O.FullPaths[ct]]}).forEach(function(vt){var ct=vt[0],ht=vt[1];if(ct.type==2&&ct.name.match(/\.iwa/)){var Pt=ct.content,dr=cl(Pt),br=ll(dr);br.forEach(function(ar){R.push(ar.id),a[ar.id]={deps:[],location:ht,type:nm(ar.messages[0].meta[1][0].data)}})}}),R.sort(function(vt,ct){return vt-ct});var B=R.filter(function(vt){return vt>1}).map(function(vt){return[vt,gn(vt)]});O.FileIndex.map(function(vt,ct){return[vt,O.FullPaths[ct]]}).forEach(function(vt){var ct=vt[0];if(vt[1],!!ct.name.match(/\.iwa/)){var ht=ll(cl(ct.content));ht.forEach(function(Pt){Pt.messages.forEach(function(dr){B.forEach(function(br){Pt.messages.some(function(ar){return nm(ar.meta[1][0].data)!=11006&&WG(ar.data,br[1])})&&a[br[0]].deps.push(Pt.id)})})})}});for(var H=Tn.find(O,a[1].location),q=ll(cl(H.content)),ee,re=0;re<q.length;++re){var J=q[re];J.id==1&&(ee=J)}var _e=qu(As(ee.messages[0].data)[1][0].data);for(H=Tn.find(O,a[_e].location),q=ll(cl(H.content)),re=0;re<q.length;++re)J=q[re],J.id==_e&&(ee=J);for(_e=qu(As(ee.messages[0].data)[2][0].data),H=Tn.find(O,a[_e].location),q=ll(cl(H.content)),re=0;re<q.length;++re)J=q[re],J.id==_e&&(ee=J);for(_e=qu(As(ee.messages[0].data)[2][0].data),H=Tn.find(O,a[_e].location),q=ll(cl(H.content)),re=0;re<q.length;++re)J=q[re],J.id==_e&&(ee=J);var pe=As(ee.messages[0].data);{pe[6][0].data=gn(u.e.r+1),pe[7][0].data=gn(u.e.c+1);var ue=qu(pe[46][0].data),ie=Tn.find(O,a[ue].location),ke=ll(cl(ie.content));{for(var at=0;at<ke.length&&ke[at].id!=ue;++at);if(ke[at].id!=ue)throw"Bad ColumnRowUIDMapArchive";var He=As(ke[at].messages[0].data);He[1]=[],He[2]=[],He[3]=[];for(var De=0;De<=u.e.c;++De){var et=[];et[1]=et[2]=[{type:0,data:gn(De+420690)}],He[1].push({type:2,data:qs(et)}),He[2].push({type:0,data:gn(De)}),He[3].push({type:0,data:gn(De)})}He[4]=[],He[5]=[],He[6]=[];for(var Ge=0;Ge<=u.e.r;++Ge)et=[],et[1]=et[2]=[{type:0,data:gn(Ge+726270)}],He[4].push({type:2,data:qs(et)}),He[5].push({type:0,data:gn(Ge)}),He[6].push({type:0,data:gn(Ge)});ke[at].messages[0].data=qs(He)}ie.content=Rp(kp(ke)),ie.size=ie.content.length,delete pe[46];var ft=As(pe[4][0].data);{ft[7][0].data=gn(u.e.r+1);var tt=As(ft[1][0].data),Ot=qu(tt[2][0].data);ie=Tn.find(O,a[Ot].location),ke=ll(cl(ie.content));{if(ke[0].id!=Ot)throw"Bad HeaderStorageBucket";var Xt=As(ke[0].messages[0].data);for(Ge=0;Ge<v.length;++Ge){var Dr=As(Xt[2][0].data);Dr[1][0].data=gn(Ge),Dr[4][0].data=gn(v[Ge].length),Xt[2][Ge]={type:Xt[2][0].type,data:qs(Dr)}}ke[0].messages[0].data=qs(Xt)}ie.content=Rp(kp(ke)),ie.size=ie.content.length;var ir=qu(ft[2][0].data);ie=Tn.find(O,a[ir].location),ke=ll(cl(ie.content));{if(ke[0].id!=ir)throw"Bad HeaderStorageBucket";for(Xt=As(ke[0].messages[0].data),De=0;De<=u.e.c;++De)Dr=As(Xt[2][0].data),Dr[1][0].data=gn(De),Dr[4][0].data=gn(u.e.r+1),Xt[2][De]={type:Xt[2][0].type,data:qs(Dr)};ke[0].messages[0].data=qs(Xt)}ie.content=Rp(kp(ke)),ie.size=ie.content.length;var Ir=qu(ft[4][0].data);(function(){for(var vt=Tn.find(O,a[Ir].location),ct=ll(cl(vt.content)),ht,Pt=0;Pt<ct.length;++Pt){var dr=ct[Pt];dr.id==Ir&&(ht=dr)}var br=As(ht.messages[0].data);{br[3]=[];var ar=[];T.forEach(function(bi,Ln){ar[1]=[{type:0,data:gn(Ln)}],ar[2]=[{type:0,data:gn(1)}],ar[3]=[{type:2,data:HG(bi)}],br[3].push({type:2,data:qs(ar)})})}ht.messages[0].data=qs(br);var Qt=kp(ct),Ci=Rp(Qt);vt.content=Ci,vt.size=vt.content.length})();var ei=As(ft[3][0].data);{var sr=ei[1][0];delete ei[2];var yr=As(sr.data);{var vr=qu(yr[2][0].data);(function(){for(var vt=Tn.find(O,a[vr].location),ct=ll(cl(vt.content)),ht,Pt=0;Pt<ct.length;++Pt){var dr=ct[Pt];dr.id==vr&&(ht=dr)}var br=As(ht.messages[0].data);{delete br[6],delete ei[7];var ar=new Uint8Array(br[5][0].data);br[5]=[];for(var Qt=0,Ci=0;Ci<=u.e.r;++Ci){var bi=As(ar);Qt+=XG(bi,v[Ci],T),bi[1][0].data=gn(Ci),br[5].push({data:qs(bi),type:2})}br[1]=[{type:0,data:gn(u.e.c+1)}],br[2]=[{type:0,data:gn(u.e.r+1)}],br[3]=[{type:0,data:gn(Qt)}],br[4]=[{type:0,data:gn(u.e.r+1)}]}ht.messages[0].data=qs(br);var Ln=kp(ct),gi=Rp(Ln);vt.content=gi,vt.size=vt.content.length})()}sr.data=qs(yr)}ft[3][0].data=qs(ei)}pe[4][0].data=qs(ft)}ee.messages[0].data=qs(pe);var gr=kp(q),Ue=Rp(gr);return H.content=Ue,H.size=H.content.length,O}function YG(t){return function(s){for(var u=0;u!=t.length;++u){var m=t[u];s[m[0]]===void 0&&(s[m[0]]=m[1]),m[2]==="n"&&(s[m[0]]=Number(s[m[0]]))}}}function eE(t){YG([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function JG(t,r){return r.bookType=="ods"?PO(t,r):r.bookType=="numbers"?KG(t,r):r.bookType=="xlsb"?QG(t,r):eH(t,r)}function QG(t,r){qp=1024,t&&!t.SSF&&(t.SSF=Ko(ss)),t&&t.SSF&&(R1(),k1(t.SSF),r.revssf=M1(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,Jg?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var s=r.bookType=="xlsb"?"bin":"xml",u=hO.indexOf(r.bookType)>-1,m=jD();eE(r=r||{});var v=zS(),T="",a=0;if(r.cellXfs=[],wh(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),T="docProps/core.xml",Fi(v,T,GD(t.Props,r)),m.coreprops.push(T),_n(r.rels,2,T,ln.CORE_PROPS),T="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var R=[],O=0;O<t.SheetNames.length;++O)(t.Workbook.Sheets[O]||{}).Hidden!=2&&R.push(t.SheetNames[O]);t.Props.SheetNames=R}for(t.Props.Worksheets=t.Props.SheetNames.length,Fi(v,T,WD(t.Props)),m.extprops.push(T),_n(r.rels,3,T,ln.EXT_PROPS),t.Custprops!==t.Props&&to(t.Custprops||{}).length>0&&(T="docProps/custom.xml",Fi(v,T,qD(t.Custprops)),m.custprops.push(T),_n(r.rels,4,T,ln.CUST_PROPS)),a=1;a<=t.SheetNames.length;++a){var B={"!id":{}},H=t.Sheets[t.SheetNames[a-1]],q=(H||{})["!type"]||"sheet";switch(q){case"chart":default:T="xl/worksheets/sheet"+a+"."+s,Fi(v,T,rG(a-1,T,r,t,B)),m.sheets.push(T),_n(r.wbrels,-1,"worksheets/sheet"+a+"."+s,ln.WS[0])}if(H){var ee=H["!comments"],re=!1,J="";ee&&ee.length>0&&(J="xl/comments"+a+"."+s,Fi(v,J,sG(ee,J)),m.comments.push(J),_n(B,-1,"../comments"+a+"."+s,ln.CMNT),re=!0),H["!legacy"]&&re&&Fi(v,"xl/drawings/vmlDrawing"+a+".vml",cO(a,H["!comments"])),delete H["!comments"],delete H["!legacy"]}B["!id"].rId1&&Fi(v,VD(T),rm(B))}return r.Strings!=null&&r.Strings.length>0&&(T="xl/sharedStrings."+s,Fi(v,T,nG(r.Strings,T,r)),m.strs.push(T),_n(r.wbrels,-1,"sharedStrings."+s,ln.SST)),T="xl/workbook."+s,Fi(v,T,tG(t,T)),m.workbooks.push(T),_n(r.rels,1,T,ln.WB),T="xl/theme/theme1.xml",Fi(v,T,aO(t.Themes,r)),m.themes.push(T),_n(r.wbrels,-1,"theme/theme1.xml",ln.THEME),T="xl/styles."+s,Fi(v,T,iG(t,T,r)),m.styles.push(T),_n(r.wbrels,-1,"styles."+s,ln.STY),t.vbaraw&&u&&(T="xl/vbaProject.bin",Fi(v,T,t.vbaraw),m.vba.push(T),_n(r.wbrels,-1,"vbaProject.bin",ln.VBA)),T="xl/metadata."+s,Fi(v,T,oG(T)),m.metadata.push(T),_n(r.wbrels,-1,"metadata."+s,ln.XLMETA),Fi(v,"[Content_Types].xml",UD(m,r)),Fi(v,"_rels/.rels",rm(r.rels)),Fi(v,"xl/_rels/workbook."+s+".rels",rm(r.wbrels)),delete r.revssf,delete r.ssf,v}function eH(t,r){qp=1024,t&&!t.SSF&&(t.SSF=Ko(ss)),t&&t.SSF&&(R1(),k1(t.SSF),r.revssf=M1(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,Jg?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var s="xml",u=hO.indexOf(r.bookType)>-1,m=jD();eE(r=r||{});var v=zS(),T="",a=0;if(r.cellXfs=[],wh(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),T="docProps/core.xml",Fi(v,T,GD(t.Props,r)),m.coreprops.push(T),_n(r.rels,2,T,ln.CORE_PROPS),T="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var R=[],O=0;O<t.SheetNames.length;++O)(t.Workbook.Sheets[O]||{}).Hidden!=2&&R.push(t.SheetNames[O]);t.Props.SheetNames=R}t.Props.Worksheets=t.Props.SheetNames.length,Fi(v,T,WD(t.Props)),m.extprops.push(T),_n(r.rels,3,T,ln.EXT_PROPS),t.Custprops!==t.Props&&to(t.Custprops||{}).length>0&&(T="docProps/custom.xml",Fi(v,T,qD(t.Custprops)),m.custprops.push(T),_n(r.rels,4,T,ln.CUST_PROPS));var B=["SheetJ5"];for(r.tcid=0,a=1;a<=t.SheetNames.length;++a){var H={"!id":{}},q=t.Sheets[t.SheetNames[a-1]],ee=(q||{})["!type"]||"sheet";switch(ee){case"chart":default:T="xl/worksheets/sheet"+a+"."+s,Fi(v,T,vO(a-1,r,t,H)),m.sheets.push(T),_n(r.wbrels,-1,"worksheets/sheet"+a+"."+s,ln.WS[0])}if(q){var re=q["!comments"],J=!1,_e="";if(re&&re.length>0){var pe=!1;re.forEach(function(ue){ue[1].forEach(function(ie){ie.T==!0&&(pe=!0)})}),pe&&(_e="xl/threadedComments/threadedComment"+a+"."+s,Fi(v,_e,RV(re,B,r)),m.threadedcomments.push(_e),_n(H,-1,"../threadedComments/threadedComment"+a+"."+s,ln.TCMNT)),_e="xl/comments"+a+"."+s,Fi(v,_e,uO(re)),m.comments.push(_e),_n(H,-1,"../comments"+a+"."+s,ln.CMNT),J=!0}q["!legacy"]&&J&&Fi(v,"xl/drawings/vmlDrawing"+a+".vml",cO(a,q["!comments"])),delete q["!comments"],delete q["!legacy"]}H["!id"].rId1&&Fi(v,VD(T),rm(H))}return r.Strings!=null&&r.Strings.length>0&&(T="xl/sharedStrings."+s,Fi(v,T,tO(r.Strings,r)),m.strs.push(T),_n(r.wbrels,-1,"sharedStrings."+s,ln.SST)),T="xl/workbook."+s,Fi(v,T,TO(t)),m.workbooks.push(T),_n(r.rels,1,T,ln.WB),T="xl/theme/theme1.xml",Fi(v,T,aO(t.Themes,r)),m.themes.push(T),_n(r.wbrels,-1,"theme/theme1.xml",ln.THEME),T="xl/styles."+s,Fi(v,T,sO(t,r)),m.styles.push(T),_n(r.wbrels,-1,"styles."+s,ln.STY),t.vbaraw&&u&&(T="xl/vbaProject.bin",Fi(v,T,t.vbaraw),m.vba.push(T),_n(r.wbrels,-1,"vbaProject.bin",ln.VBA)),T="xl/metadata."+s,Fi(v,T,lO()),m.metadata.push(T),_n(r.wbrels,-1,"metadata."+s,ln.XLMETA),B.length>1&&(T="xl/persons/person.xml",Fi(v,T,MV(B)),m.people.push(T),_n(r.wbrels,-1,"persons/person.xml",ln.PEOPLE)),Fi(v,"[Content_Types].xml",UD(m,r)),Fi(v,"_rels/.rels",rm(r.rels)),Fi(v,"xl/_rels/workbook."+s+".rels",rm(r.wbrels)),delete r.revssf,delete r.ssf,v}function tH(t,r){var s="";switch((r||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":s=Yc(t.slice(0,12));break;case"binary":s=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3),s.charCodeAt(4),s.charCodeAt(5),s.charCodeAt(6),s.charCodeAt(7)]}function kO(t,r){switch(r.type){case"base64":case"binary":break;case"buffer":case"array":r.type="";break;case"file":return O_(r.file,Tn.write(t,{type:fn?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");default:throw new Error("Unrecognized type "+r.type)}return Tn.write(t,r)}function rH(t,r){var s=Ko(r||{}),u=JG(t,s);return iH(u,s)}function iH(t,r){var s={},u=fn?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(r.compression&&(s.compression="DEFLATE"),r.password)s.type=u;else switch(r.type){case"base64":s.type="base64";break;case"binary":s.type="string";break;case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");case"buffer":case"file":s.type=u;break;default:throw new Error("Unrecognized type "+r.type)}var m=t.FullPaths?Tn.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[s.type]||s.type,compression:!!r.compression}):t.generate(s);if(typeof Deno<"u"&&typeof m=="string"){if(r.type=="binary"||r.type=="base64")return m;m=new Uint8Array(P1(m))}return r.password&&typeof encrypt_agile<"u"?kO(encrypt_agile(m,r.password),r):r.type==="file"?O_(r.file,m):r.type=="string"?Zg(m):m}function nH(t,r){var s=r||{},u=vG(t,s);return kO(u,s)}function Ql(t,r,s){s||(s="");var u=s+t;switch(r.type){case"base64":return v_(b_(u));case"binary":return b_(u);case"string":return t;case"file":return O_(r.file,u,"utf8");case"buffer":return fn?eu(u,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(u):Ql(u,{type:"binary"}).split("").map(function(m){return m.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function sH(t,r){switch(r.type){case"base64":return v_(t);case"binary":return t;case"string":return t;case"file":return O_(r.file,t,"binary");case"buffer":return fn?eu(t,"binary"):t.split("").map(function(s){return s.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function ov(t,r){switch(r.type){case"string":case"base64":case"binary":for(var s="",u=0;u<t.length;++u)s+=String.fromCharCode(t[u]);return r.type=="base64"?v_(s):r.type=="string"?Zg(s):s;case"file":return O_(r.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+r.type)}}function RO(t,r){Dj(),G$(t);var s=Ko(r||{});if(s.cellStyles&&(s.cellNF=!0,s.sheetStubs=!0),s.type=="array"){s.type="binary";var u=RO(t,s);return s.type="array",P1(u)}var m=0;if(s.sheet&&(typeof s.sheet=="number"?m=s.sheet:m=t.SheetNames.indexOf(s.sheet),!t.SheetNames[m]))throw new Error("Sheet not found: "+s.sheet+" : "+typeof s.sheet);switch(s.bookType||"xlsb"){case"xml":case"xlml":return Ql(yG(t,s),s);case"slk":case"sylk":return Ql(UU.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"htm":case"html":return Ql(AO(t.Sheets[t.SheetNames[m]],s),s);case"txt":return sH(MO(t.Sheets[t.SheetNames[m]],s),s);case"csv":return Ql(tE(t.Sheets[t.SheetNames[m]],s),s,"\uFEFF");case"dif":return Ql(VU.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"dbf":return ov(jU.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"prn":return Ql($U.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"rtf":return Ql(KU.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"eth":return Ql(eO.from_sheet(t.Sheets[t.SheetNames[m]],s),s);case"fods":return Ql(PO(t,s),s);case"wk1":return ov(Q3.sheet_to_wk1(t.Sheets[t.SheetNames[m]],s),s);case"wk3":return ov(Q3.book_to_wk3(t,s),s);case"biff2":s.biff||(s.biff=2);case"biff3":s.biff||(s.biff=3);case"biff4":return s.biff||(s.biff=4),ov(EO(t,s),s);case"biff5":s.biff||(s.biff=5);case"biff8":case"xla":case"xls":return s.biff||(s.biff=8),nH(t,s);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return rH(t,s);default:throw new Error("Unrecognized bookType |"+s.bookType+"|")}}function oH(t){if(!t.bookType){var r={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},s=t.file.slice(t.file.lastIndexOf(".")).toLowerCase();s.match(/^\.[a-z]+$/)&&(t.bookType=s.slice(1)),t.bookType=r[t.bookType]||t.bookType}}function aH(t,r,s){var u={};return u.type="file",u.file=r,oH(u),RO(t,u)}function lH(t,r,s,u,m,v,T,a){var R=Qs(s),O=a.defval,B=a.raw||!Object.prototype.hasOwnProperty.call(a,"raw"),H=!0,q=m===1?[]:{};if(m!==1)if(Object.defineProperty)try{Object.defineProperty(q,"__rowNum__",{value:s,enumerable:!1})}catch{q.__rowNum__=s}else q.__rowNum__=s;if(!T||t[s])for(var ee=r.s.c;ee<=r.e.c;++ee){var re=T?t[s][ee]:t[u[ee]+R];if(re===void 0||re.t===void 0){if(O===void 0)continue;v[ee]!=null&&(q[v[ee]]=O);continue}var J=re.v;switch(re.t){case"z":if(J==null)break;continue;case"e":J=J==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+re.t)}if(v[ee]!=null){if(J==null)if(re.t=="e"&&J===null)q[v[ee]]=null;else if(O!==void 0)q[v[ee]]=O;else if(B&&J===null)q[v[ee]]=null;else continue;else q[v[ee]]=B&&(re.t!=="n"||re.t==="n"&&a.rawNumbers!==!1)?J:Jc(re,J,a);J!=null&&(H=!1)}}return{row:q,isempty:H}}function o1(t,r){if(t==null||t["!ref"]==null)return[];var s={t:"n",v:0},u=0,m=1,v=[],T=0,a="",R={s:{r:0,c:0},e:{r:0,c:0}},O=r||{},B=O.range!=null?O.range:t["!ref"];switch(O.header===1?u=1:O.header==="A"?u=2:Array.isArray(O.header)?u=3:O.header==null&&(u=0),typeof B){case"string":R=Un(B);break;case"number":R=Un(t["!ref"]),R.s.r=B;break;default:R=B}u>0&&(m=0);var H=Qs(R.s.r),q=[],ee=[],re=0,J=0,_e=Array.isArray(t),pe=R.s.r,ue=0,ie={};_e&&!t[pe]&&(t[pe]=[]);var ke=O.skipHidden&&t["!cols"]||[],at=O.skipHidden&&t["!rows"]||[];for(ue=R.s.c;ue<=R.e.c;++ue)if(!(ke[ue]||{}).hidden)switch(q[ue]=ho(ue),s=_e?t[pe][ue]:t[q[ue]+H],u){case 1:v[ue]=ue-R.s.c;break;case 2:v[ue]=q[ue];break;case 3:v[ue]=O.header[ue-R.s.c];break;default:if(s==null&&(s={w:"__EMPTY",t:"s"}),a=T=Jc(s,null,O),J=ie[T]||0,!J)ie[T]=1;else{do a=T+"_"+J++;while(ie[a]);ie[T]=J,ie[a]=1}v[ue]=a}for(pe=R.s.r+m;pe<=R.e.r;++pe)if(!(at[pe]||{}).hidden){var He=lH(t,R,pe,q,u,v,_e,O);(He.isempty===!1||(u===1?O.blankrows!==!1:O.blankrows))&&(ee[re++]=He.row)}return ee.length=re,ee}var ak=/"/g;function cH(t,r,s,u,m,v,T,a){for(var R=!0,O=[],B="",H=Qs(s),q=r.s.c;q<=r.e.c;++q)if(u[q]){var ee=a.dense?(t[s]||[])[q]:t[u[q]+H];if(ee==null)B="";else if(ee.v!=null){R=!1,B=""+(a.rawNumbers&&ee.t=="n"?ee.v:Jc(ee,null,a));for(var re=0,J=0;re!==B.length;++re)if((J=B.charCodeAt(re))===m||J===v||J===34||a.forceQuotes){B='"'+B.replace(ak,'""')+'"';break}B=="ID"&&(B='"ID"')}else ee.f!=null&&!ee.F?(R=!1,B="="+ee.f,B.indexOf(",")>=0&&(B='"'+B.replace(ak,'""')+'"')):B="";O.push(B)}return a.blankrows===!1&&R?null:O.join(T)}function tE(t,r){var s=[],u=r??{};if(t==null||t["!ref"]==null)return"";var m=Un(t["!ref"]),v=u.FS!==void 0?u.FS:",",T=v.charCodeAt(0),a=u.RS!==void 0?u.RS:`
`,R=a.charCodeAt(0),O=new RegExp((v=="|"?"\\|":v)+"+$"),B="",H=[];u.dense=Array.isArray(t);for(var q=u.skipHidden&&t["!cols"]||[],ee=u.skipHidden&&t["!rows"]||[],re=m.s.c;re<=m.e.c;++re)(q[re]||{}).hidden||(H[re]=ho(re));for(var J=0,_e=m.s.r;_e<=m.e.r;++_e)(ee[_e]||{}).hidden||(B=cH(t,m,_e,H,T,R,v,u),B!=null&&(u.strip&&(B=B.replace(O,"")),(B||u.blankrows!==!1)&&s.push((J++?a:"")+B)));return delete u.dense,s.join("")}function MO(t,r){r||(r={}),r.FS="	",r.RS=`
`;var s=tE(t,r);return s}function uH(t){var r="",s,u="";if(t==null||t["!ref"]==null)return[];var m=Un(t["!ref"]),v="",T=[],a,R=[],O=Array.isArray(t);for(a=m.s.c;a<=m.e.c;++a)T[a]=ho(a);for(var B=m.s.r;B<=m.e.r;++B)for(v=Qs(B),a=m.s.c;a<=m.e.c;++a)if(r=T[a]+v,s=O?(t[B]||[])[a]:t[r],u="",s!==void 0){if(s.F!=null){if(r=s.F,!s.f)continue;u=s.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(s.f!=null)u=s.f;else{if(s.t=="z")continue;if(s.t=="n"&&s.v!=null)u=""+s.v;else if(s.t=="b")u=s.v?"TRUE":"FALSE";else if(s.w!==void 0)u="'"+s.w;else{if(s.v===void 0)continue;s.t=="s"?u="'"+s.v:u=""+s.v}}R[R.length]=r+"="+u}return R}function DO(t,r,s){var u=s||{},m=+!u.skipHeader,v=t||{},T=0,a=0;if(v&&u.origin!=null)if(typeof u.origin=="number")T=u.origin;else{var R=typeof u.origin=="string"?js(u.origin):u.origin;T=R.r,a=R.c}var O,B={s:{c:0,r:0},e:{c:a,r:T+r.length-1+m}};if(v["!ref"]){var H=Un(v["!ref"]);B.e.c=Math.max(B.e.c,H.e.c),B.e.r=Math.max(B.e.r,H.e.r),T==-1&&(T=H.e.r+1,B.e.r=T+r.length-1+m)}else T==-1&&(T=0,B.e.r=r.length-1+m);var q=u.header||[],ee=0;r.forEach(function(J,_e){to(J).forEach(function(pe){(ee=q.indexOf(pe))==-1&&(q[ee=q.length]=pe);var ue=J[pe],ie="z",ke="",at=vn({c:a+ee,r:T+_e+m});O=E_(v,at),ue&&typeof ue=="object"&&!(ue instanceof Date)?v[at]=ue:(typeof ue=="number"?ie="n":typeof ue=="boolean"?ie="b":typeof ue=="string"?ie="s":ue instanceof Date?(ie="d",u.cellDates||(ie="n",ue=Xo(ue)),ke=u.dateNF||ss[14]):ue===null&&u.nullError&&(ie="e",ue=0),O?(O.t=ie,O.v=ue,delete O.w,delete O.R,ke&&(O.z=ke)):v[at]=O={t:ie,v:ue},ke&&(O.z=ke))})}),B.e.c=Math.max(B.e.c,a+q.length-1);var re=Qs(T);if(m)for(ee=0;ee<q.length;++ee)v[ho(ee+a)+re]={t:"s",v:q[ee]};return v["!ref"]=_s(B),v}function hH(t,r){return DO(null,t,r)}function E_(t,r,s){if(typeof r=="string"){if(Array.isArray(t)){var u=js(r);return t[u.r]||(t[u.r]=[]),t[u.r][u.c]||(t[u.r][u.c]={t:"z"})}return t[r]||(t[r]={t:"z"})}return typeof r!="number"?E_(t,vn(r)):E_(t,vn({r,c:s||0}))}function dH(t,r){if(typeof r=="number"){if(r>=0&&t.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var s=t.SheetNames.indexOf(r);if(s>-1)return s;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function fH(){return{SheetNames:[],Sheets:{}}}function pH(t,r,s,u){var m=1;if(!s)for(;m<=65535&&t.SheetNames.indexOf(s="Sheet"+m)!=-1;++m,s=void 0);if(!s||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(u&&t.SheetNames.indexOf(s)>=0){var v=s.match(/(^.*?)(\d+)$/);m=v&&+v[2]||0;var T=v&&v[1]||s;for(++m;m<=65535&&t.SheetNames.indexOf(s=T+m)!=-1;++m);}if(bO(s),t.SheetNames.indexOf(s)>=0)throw new Error("Worksheet with name |"+s+"| already exists!");return t.SheetNames.push(s),t.Sheets[s]=r,s}function mH(t,r,s){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var u=dH(t,r);switch(t.Workbook.Sheets[u]||(t.Workbook.Sheets[u]={}),s){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+s)}t.Workbook.Sheets[u].Hidden=s}function gH(t,r){return t.z=r,t}function OO(t,r,s){return r?(t.l={Target:r},s&&(t.l.Tooltip=s)):delete t.l,t}function _H(t,r,s){return OO(t,"#"+r,s)}function yH(t,r,s){t.c||(t.c=[]),t.c.push({t:r,a:s||"SheetJS"})}function xH(t,r,s,u){for(var m=typeof r!="string"?r:Un(r),v=typeof r=="string"?r:_s(r),T=m.s.r;T<=m.e.r;++T)for(var a=m.s.c;a<=m.e.c;++a){var R=E_(t,T,a);R.t="n",R.F=v,delete R.v,T==m.s.r&&a==m.s.c&&(R.f=s,u&&(R.D=!0))}return t}var Ig={encode_col:ho,encode_row:Qs,encode_cell:vn,encode_range:_s,decode_col:GS,decode_row:$S,split_cell:D8,decode_cell:js,decode_range:ba,format_cell:Jc,sheet_add_aoa:OD,sheet_add_json:DO,sheet_add_dom:IO,aoa_to_sheet:vm,json_to_sheet:hH,table_to_sheet:CO,table_to_book:VG,sheet_to_csv:tE,sheet_to_txt:MO,sheet_to_json:o1,sheet_to_html:AO,sheet_to_formulae:uH,sheet_to_row_object_array:o1,sheet_get_cell:E_,book_new:fH,book_append_sheet:pH,book_set_sheet_visibility:mH,cell_set_number_format:gH,cell_set_hyperlink:OO,cell_set_internal_link:_H,cell_add_comment:yH,sheet_set_array_formula:xH,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function vH(){const[t,r]=zt.useState([]),[s,u]=zt.useState(!0),[m,v]=zt.useState(new Date().getMonth()+1),[T,a]=zt.useState(new Date().getFullYear()),[R,O]=zt.useState("all");zt.useEffect(()=>{B()},[m,T]);const B=async()=>{u(!0);try{const ie=new Date(T,m-1,1),ke=new Date(T,m,0,23,59,59),{data:at}=await Qr.from("profiles").select("*").eq("role","employee"),{data:He}=await Qr.from("time_entries").select("*").gte("clock_in",ie.toISOString()).lte("clock_in",ke.toISOString()),{data:De}=await Qr.from("overtime_hours").select("*").eq("month",m).eq("year",T),et=(ft,tt)=>{const Ot=new Date(ft).getTime(),Xt=new Date(tt).getTime();return Math.max(0,(Xt-Ot)/(1e3*60*60))},Ge=(at||[]).map(ft=>{const tt=(He||[]).filter(Ue=>Ue.user_id===ft.id),Ot=tt.filter(Ue=>Ue.clock_out),Xt=ft.work_hours||8,Dr=ft.overtime_limit||30,ir=new Map;let Ir=0,ei=0;Ot.forEach(Ue=>{const vt=et(Ue.clock_in,Ue.clock_out);ei+=vt;const ct=new Date(Ue.clock_in).toLocaleDateString("pt-BR");new Date(Ue.clock_in).getDay()===0?Ir+=vt:ir.set(ct,(ir.get(ct)||0)+vt)});const sr=Array.from(ir.values()).reduce((Ue,vt)=>Ue+vt,0),yr=ir.size*Xt,gr=Math.max(0,sr-yr)+Ir;return{profile:ft,totalHours:ei,overtimeHours:Math.min(gr,Dr),hourBank:Math.max(0,gr-Dr),entries:tt}});r(Ge)}catch(ie){console.error("Error loading reports:",ie)}finally{u(!1)}},H=(ie,ke)=>{const at=new Date(ie).getTime(),He=new Date(ke).getTime();return Math.max(0,(He-at)/(1e3*60*60))},q=ie=>new Date(ie).getDay()===0,ee=ie=>{var ft;const ke=Ig.book_new(),at=ie.map(tt=>{const Ot=tt.profile.work_hours||8,Xt=tt.entries.filter(ar=>ar.clock_out),Dr=new Map;let ir=0,Ir=0;Xt.forEach(ar=>{const Qt=H(ar.clock_in,ar.clock_out);Ir+=Qt;const Ci=new Date(ar.clock_in).toLocaleDateString("pt-BR");q(ar.clock_in)?ir+=Qt:Dr.set(Ci,(Dr.get(Ci)||0)+Qt)});const ei=Dr.size,sr=Array.from(Dr.values()).reduce((ar,Qt)=>ar+Qt,0),yr=ei*Ot,vr=Math.max(0,sr-yr),gr=vr+ir,Ue=new Set(Xt.filter(ar=>q(ar.clock_in)).map(ar=>new Date(ar.clock_in).toLocaleDateString("pt-BR"))).size,vt=ei+Ue,ct=tt.entries.filter(ar=>ar.clock_in).length,ht=Xt.length,Pt=tt.profile.overtime_limit||30,dr=Math.min(gr,Pt),br=Math.max(0,gr-Pt);return{Nome:tt.profile.full_name,Funo:tt.profile.job_position||"-","Dias Trabalhados":vt,"Dias Normais (Seg-Sb)":ei,"Domingos Trabalhados":Ue,"Total Entradas":ct,"Total Sadas":ht,"Horas Esperadas (Seg-Sb)":Number(yr.toFixed(2)),"Total Horas Trabalhadas":Number(Ir.toFixed(2)),"Horas Normais (Seg-Sb)":Number(sr.toFixed(2)),"Horas Domingo (100%)":Number(ir.toFixed(2)),"Extras Seg-Sb":Number(vr.toFixed(2)),"Total Horas Extras":Number(gr.toFixed(2)),"Horas Extras Pagas":Number(dr.toFixed(2)),"Banco de Horas":Number(br.toFixed(2))}}),He=Ig.json_to_sheet(at);He["!cols"]=[{wch:30},{wch:20},{wch:18},{wch:22},{wch:22},{wch:15},{wch:15},{wch:24},{wch:22},{wch:22},{wch:22},{wch:18},{wch:20},{wch:20},{wch:18}],He["!autofilter"]={ref:`A1:O${at.length+1}`},Ig.book_append_sheet(ke,He,"Resumo Geral");const De=[];ie.forEach(tt=>{const Ot=tt.profile.work_hours||8,Xt=tt.entries.filter(ir=>ir.clock_out),Dr=new Map;Xt.forEach(ir=>{const Ir=new Date(ir.clock_in).toLocaleDateString("pt-BR");Dr.has(Ir)||Dr.set(Ir,[]),Dr.get(Ir).push(ir)}),Dr.forEach(ir=>{const Ir=q(ir[0].clock_in),ei=ir.reduce((vr,gr)=>vr+H(gr.clock_in,gr.clock_out),0);let sr,yr;Ir?(sr=ei,yr="Domingo (100%)"):(sr=Math.max(0,ei-Ot),yr=sr>0?"Extra":"Normal"),ir.sort((vr,gr)=>new Date(vr.clock_in).getTime()-new Date(gr.clock_in).getTime()).forEach(vr=>{const gr=new Date(vr.clock_in),Ue=new Date(vr.clock_out),vt=H(vr.clock_in,vr.clock_out),ct=Ue.toLocaleDateString("pt-BR"),ht=gr.toLocaleDateString("pt-BR"),Pt=ct!==ht,dr=Pt?`${Ue.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})} (${ct})`:Ue.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});De.push({Nome:tt.profile.full_name,Funo:tt.profile.job_position||"-",Data:ht,"Dia da Semana":gr.toLocaleDateString("pt-BR",{weekday:"long"}),Entrada:gr.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),Sada:dr,"Horas da Sesso":Number(vt.toFixed(2)),"Total Horas do Dia":Number(ei.toFixed(2)),"Hora Extra?":Ir||sr>0?"Sim":"No","Horas Extras do Dia":Number(sr.toFixed(2)),Observaes:vr.notes||"-",Tipo:Pt?"Sada no dia seguinte":Ir?"Domingo (100%)":vr.overtime_type==="after_hours"?"Aps Expediente":vr.overtime_type==="weekend"?"Fim de Semana":vr.overtime_type==="holiday"?"Feriado":yr})})})});const et=Ig.json_to_sheet(De);et["!cols"]=[{wch:30},{wch:20},{wch:12},{wch:18},{wch:10},{wch:10},{wch:18},{wch:18},{wch:12},{wch:18},{wch:50},{wch:20}],et["!autofilter"]={ref:`A1:L${De.length+1}`},Ig.book_append_sheet(ke,et,"Detalhamento Completo");const Ge=R==="all"?`Relatorio_Completo_${m.toString().padStart(2,"0")}_${T}.xlsx`:`Relatorio_${(ft=ie[0])==null?void 0:ft.profile.full_name.replace(/\s/g,"_")}_${m.toString().padStart(2,"0")}_${T}.xlsx`;aH(ke,Ge)},re=ie=>{const ke=[`RELATRIO DE PONTO - ${m}/${T}`,"=".repeat(60),"",...ie.map(De=>[`Nome: ${De.profile.full_name}`,`Funo: ${De.profile.job_position||"-"}`,`Total de Horas: ${De.totalHours.toFixed(2)}h`,`Horas Extras (pagas): ${De.overtimeHours.toFixed(2)}h`,`Banco de Horas: ${De.hourBank.toFixed(2)}h`,"-".repeat(60)].join(`
`))].join(`
`),at=new Blob([ke],{type:"text/plain"}),He=document.createElement("a");He.href=URL.createObjectURL(at),He.download=`relatorio_${m}_${T}.txt`,He.click()},J=R==="all"?t:t.filter(ie=>ie.profile.id===R),_e=t.reduce((ie,ke)=>ie+ke.totalHours,0),pe=t.reduce((ie,ke)=>ie+ke.overtimeHours,0),ue=t.reduce((ie,ke)=>ie+ke.hourBank,0);return s?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Relatrios"}),L.jsx("p",{className:"text-gray-600",children:"Acompanhe horas trabalhadas, extras e banco de horas"})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(DS,{className:"w-5 h-5 text-amber-600"}),L.jsx("select",{value:m,onChange:ie=>v(parseInt(ie.target.value)),className:"px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 outline-none",children:Array.from({length:12},(ie,ke)=>L.jsx("option",{value:ke+1,children:new Date(2024,ke).toLocaleString("pt-BR",{month:"long"})},ke+1))})]}),L.jsx("select",{value:T,onChange:ie=>a(parseInt(ie.target.value)),className:"px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 outline-none",children:Array.from({length:5},(ie,ke)=>L.jsx("option",{value:new Date().getFullYear()-ke,children:new Date().getFullYear()-ke},ke))}),L.jsxs("select",{value:R,onChange:ie=>O(ie.target.value),className:"px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 outline-none flex-1 min-w-[200px]",children:[L.jsx("option",{value:"all",children:"Todos os Colaboradores"}),t.map(ie=>L.jsx("option",{value:ie.profile.id,children:ie.profile.full_name},ie.profile.id))]}),L.jsxs("div",{className:"flex space-x-2",children:[L.jsxs("button",{onClick:()=>ee(J),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center space-x-2",children:[L.jsx(CT,{className:"w-4 h-4"}),L.jsx("span",{children:"Excel"})]}),L.jsxs("button",{onClick:()=>re(J),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center space-x-2",children:[L.jsx(ZM,{className:"w-4 h-4"}),L.jsx("span",{children:"TXT"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[L.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Total Horas Empresa"}),L.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[_e.toFixed(1),"h"]})]}),L.jsx(Vc,{className:"w-8 h-8 text-blue-600"})]})}),L.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"Horas Extras (pagas)"}),L.jsxs("p",{className:"text-2xl font-bold text-amber-900",children:[pe.toFixed(1),"h"]})]}),L.jsx(Vc,{className:"w-8 h-8 text-amber-600"})]})}),L.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Banco de Horas"}),L.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[ue.toFixed(1),"h"]})]}),L.jsx(Vc,{className:"w-8 h-8 text-green-600"})]})})]}),L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"bg-gray-50",children:[L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Colaborador"}),L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Funo"}),L.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Total Horas"}),L.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"H. Extras (pagas)"}),L.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Banco de Horas"})]})}),L.jsx("tbody",{className:"divide-y divide-gray-200",children:J.map(ie=>L.jsxs("tr",{className:"hover:bg-gray-50",children:[L.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:ie.profile.full_name}),L.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:ie.profile.job_position||"-"}),L.jsxs("td",{className:"px-4 py-3 text-sm text-gray-800 text-right font-medium",children:[ie.totalHours.toFixed(2),"h"]}),L.jsxs("td",{className:"px-4 py-3 text-sm text-amber-600 text-right font-medium",children:[ie.overtimeHours.toFixed(2),"h"]}),L.jsxs("td",{className:"px-4 py-3 text-sm text-green-600 text-right font-medium",children:[ie.hourBank.toFixed(2),"h"]})]},ie.profile.id))})]})})]})]})}function wH(){const[t,r]=zt.useState([]),[s,u]=zt.useState(null),[m,v]=zt.useState(!0),[T,a]=zt.useState(null);zt.useEffect(()=>{R()},[]);const R=async()=>{try{const{data:H,error:q}=await Qr.from("profiles").select("*").eq("role","employee").order("full_name");if(q)throw q;const ee=[];for(const re of H||[]){const{data:J}=await Qr.from("time_entries").select("id, user_id, clock_in, clock_out, selfie_url, is_overtime, notes").eq("user_id",re.id).not("selfie_url","is",null).order("clock_in",{ascending:!1}).limit(50);J&&J.length>0&&ee.push({profile:re,photos:J})}r(ee)}catch(H){console.error("Error loading photos:",H)}finally{v(!1)}},O=H=>{u(s===H?null:H)},B=H=>new Date(H).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return m?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Registro de Fotos EPIs"}),L.jsx("p",{className:"text-gray-600",children:"Visualize as fotos tiradas pelos colaboradores ao bater ponto"})]}),t.length===0?L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[L.jsx(__,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),L.jsx("p",{className:"text-gray-500",children:"Nenhuma foto registrada ainda"})]}):L.jsx("div",{className:"space-y-4",children:t.map(H=>{var q;return L.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[L.jsxs("button",{onClick:()=>O(H.profile.id),className:"w-full flex items-center justify-between p-6 hover:bg-gray-50 transition",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:(q=H.profile.full_name)==null?void 0:q.charAt(0).toUpperCase()}),L.jsxs("div",{className:"text-left",children:[L.jsx("p",{className:"font-bold text-gray-800 text-lg",children:H.profile.full_name}),L.jsx("p",{className:"text-sm text-gray-600",children:H.profile.job_position||"Colaborador"}),L.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[H.photos.length," fotos registradas"]})]})]}),s===H.profile.id?L.jsx(dj,{className:"w-6 h-6 text-gray-400"}):L.jsx(hj,{className:"w-6 h-6 text-gray-400"})]}),s===H.profile.id&&L.jsx("div",{className:"border-t border-gray-200 p-6 bg-gray-50",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:H.photos.map(ee=>L.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition cursor-pointer",onClick:()=>a(ee.selfie_url),children:[L.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[ee.selfie_url&&L.jsx("img",{src:ee.selfie_url,alt:"Selfie EPI",className:"w-full h-full object-cover"}),ee.is_overtime&&L.jsx("div",{className:"absolute top-2 right-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"Hora Extra"})]}),L.jsxs("div",{className:"p-3",children:[L.jsxs("p",{className:"text-xs font-semibold text-gray-700",children:["Entrada: ",B(ee.clock_in)]}),ee.clock_out&&L.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Sada: ",B(ee.clock_out)]}),ee.notes&&L.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[L.jsx("p",{className:"text-xs font-semibold text-blue-600 mb-1",children:"Observao:"}),L.jsx("p",{className:"text-xs text-gray-700 italic line-clamp-3",children:ee.notes})]})]})]},ee.id))})})]},H.profile.id)})}),T&&L.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>a(null),children:L.jsxs("div",{className:"max-w-4xl max-h-[90vh] relative",children:[L.jsx("img",{src:T,alt:"Selfie EPI Ampliada",className:"max-w-full max-h-[90vh] object-contain rounded-lg"}),L.jsx("button",{onClick:()=>a(null),className:"absolute top-4 right-4 bg-white text-gray-800 rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100 transition",children:""})]})})]})}function a1({isOpen:t,onClose:r,title:s,message:u}){return t?L.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[L.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:r}),L.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6 animate-fade-in",children:[L.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:L.jsx(Kc,{className:"w-5 h-5"})}),L.jsxs("div",{className:"text-center",children:[L.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:s}),u&&L.jsx("p",{className:"text-gray-600 mt-4",children:u}),L.jsx("button",{onClick:r,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"OK"})]})]})]}):null}function bH(){const[t,r]=zt.useState([]),[s,u]=zt.useState(!0),[m,v]=zt.useState(!1),[T,a]=zt.useState(null),[R,O]=zt.useState(""),[B,H]=zt.useState({name:"",plate:"",initial_mileage:0,status:"active"});zt.useEffect(()=>{q()},[]);const q=async()=>{try{const{data:ue,error:ie}=await Qr.from("vehicles").select("*").order("created_at",{ascending:!1});if(ie)throw ie;r(ue||[])}catch(ue){console.error("Error loading vehicles:",ue),O("Erro ao carregar veculos")}finally{u(!1)}},ee=async ue=>{ue.preventDefault(),O("");try{if(T){const{error:ie}=await Qr.from("vehicles").update({name:B.name,plate:B.plate.toUpperCase(),status:B.status}).eq("id",T.id);if(ie)throw ie}else{const{error:ie}=await Qr.from("vehicles").insert({name:B.name,plate:B.plate.toUpperCase(),initial_mileage:B.initial_mileage,current_mileage:B.initial_mileage,status:B.status});if(ie)throw ie}v(!1),a(null),H({name:"",plate:"",initial_mileage:0,status:"active"}),q()}catch(ie){console.error("Error saving vehicle:",ie),O(ie.message||"Erro ao salvar veculo")}},re=ue=>{a(ue),H({name:ue.name,plate:ue.plate,initial_mileage:ue.initial_mileage,status:ue.status}),v(!0)},J=async ue=>{if(confirm("Tem certeza que deseja excluir este veculo?"))try{const{error:ie}=await Qr.from("vehicles").delete().eq("id",ue);if(ie)throw ie;q()}catch(ie){console.error("Error deleting vehicle:",ie),alert("Erro ao excluir veculo")}},_e=ue=>{switch(ue){case"active":return"bg-green-100 text-green-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"inactive":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},pe=ue=>{switch(ue){case"active":return"Ativo";case"maintenance":return"Manuteno";case"inactive":return"Inativo";default:return ue}};return s?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gerenciar Veculos"}),L.jsx("p",{className:"text-gray-600 mt-1",children:"Cadastre e gerencie os veculos da empresa"})]}),L.jsxs("button",{onClick:()=>{a(null),H({name:"",plate:"",initial_mileage:0,status:"active"}),v(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center space-x-2",children:[L.jsx(YM,{className:"w-5 h-5"}),L.jsx("span",{children:"Novo Veculo"})]})]}),R&&L.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center space-x-2",children:[L.jsx(qM,{className:"w-5 h-5"}),L.jsx("span",{children:R})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(ue=>L.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition",children:[L.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:L.jsxs("div",{className:"flex items-center justify-between text-white",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx(IT,{className:"w-8 h-8"}),L.jsxs("div",{children:[L.jsx("h3",{className:"font-bold text-lg",children:ue.name}),L.jsx("p",{className:"text-sm opacity-90",children:ue.plate})]})]}),L.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${_e(ue.status)}`,children:pe(ue.status)})]})}),L.jsxs("div",{className:"p-4 space-y-3",children:[L.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"KM Inicial"}),L.jsx("p",{className:"text-lg font-bold text-gray-900",children:ue.initial_mileage.toLocaleString()})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"KM Atual"}),L.jsx("p",{className:"text-lg font-bold text-blue-600",children:ue.current_mileage.toLocaleString()})]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Total Rodado"}),L.jsxs("p",{className:"text-xl font-bold text-green-600",children:[(ue.current_mileage-ue.initial_mileage).toLocaleString()," km"]})]}),L.jsxs("div",{className:"flex space-x-2 pt-2",children:[L.jsxs("button",{onClick:()=>re(ue),className:"flex-1 bg-blue-50 text-blue-600 py-2 rounded-lg hover:bg-blue-100 transition flex items-center justify-center space-x-1",children:[L.jsx(PT,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Editar"})]}),L.jsxs("button",{onClick:()=>J(ue.id),className:"flex-1 bg-red-50 text-red-600 py-2 rounded-lg hover:bg-red-100 transition flex items-center justify-center space-x-1",children:[L.jsx(bj,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Excluir"})]})]})]})]},ue.id))}),t.length===0&&L.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[L.jsx(IT,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum veculo cadastrado"}),L.jsx("p",{className:"text-gray-600 mb-4",children:"Comece adicionando o primeiro veculo da empresa"}),L.jsx("button",{onClick:()=>v(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition",children:"Adicionar Veculo"})]}),L.jsxs(a1,{isOpen:m,onClose:()=>v(!1),children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:T?"Editar Veculo":"Novo Veculo"}),L.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome/Modelo do Veculo *"}),L.jsx("input",{type:"text",required:!0,value:B.name,onChange:ue=>H({...B,name:ue.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Fiat Uno 2020"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Placa *"}),L.jsx("input",{type:"text",required:!0,value:B.plate,onChange:ue=>H({...B,plate:ue.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent uppercase",placeholder:"Ex: ABC-1234",maxLength:8})]}),!T&&L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quilometragem Inicial *"}),L.jsx("input",{type:"number",required:!0,min:"0",value:B.initial_mileage,onChange:ue=>H({...B,initial_mileage:parseInt(ue.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: 50000"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),L.jsxs("select",{value:B.status,onChange:ue=>H({...B,status:ue.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[L.jsx("option",{value:"active",children:"Ativo"}),L.jsx("option",{value:"maintenance",children:"Em Manuteno"}),L.jsx("option",{value:"inactive",children:"Inativo"})]})]}),L.jsxs("div",{className:"flex space-x-3 pt-4",children:[L.jsx("button",{type:"button",onClick:()=>v(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancelar"}),L.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:T?"Salvar":"Cadastrar"})]})]})]})]})}function TH(){const[t,r]=zt.useState([]),[s,u]=zt.useState([]),[m,v]=zt.useState(!0),[T,a]=zt.useState(!1),[R,O]=zt.useState(!1),[B,H]=zt.useState(""),[q,ee]=zt.useState(null),[re,J]=zt.useState(null),[_e,pe]=zt.useState({vehicle_id:"",date:new Date().toISOString().split("T")[0],mileage:0,liters:0,price_per_liter:0,gas_station:"",location:"",notes:""});zt.useEffect(()=>{ue()},[]);const ue=async()=>{try{const[Ge,ft]=await Promise.all([Qr.from("vehicles").select("*").eq("status","active").order("name"),Qr.from("fuel_records").select(`
            *,
            vehicles(name, plate),
            profiles(full_name)
          `).order("date",{ascending:!1}).limit(50)]);if(Ge.error)throw Ge.error;if(ft.error)throw ft.error;r(Ge.data||[]),u(ft.data||[])}catch(Ge){console.error("Error loading data:",Ge),H("Erro ao carregar dados")}finally{v(!1)}},ie=Ge=>{var tt;const ft=(tt=Ge.target.files)==null?void 0:tt[0];if(ft){ee(ft);const Ot=URL.createObjectURL(ft);J(Ot)}},ke=async Ge=>{const ft=Ge.name.split(".").pop(),Ot=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${ft}`}`,{error:Xt}=await Qr.storage.from("fuel-receipts").upload(Ot,Ge);if(Xt)throw Xt;return Ot},at=async Ge=>{Ge.preventDefault(),H(""),O(!0);try{const{data:{user:ft}}=await Qr.auth.getUser();if(!ft)throw new Error("Usurio no autenticado");let tt=null;q&&(tt=await ke(q));const Ot=_e.liters*_e.price_per_liter,{error:Xt}=await Qr.from("fuel_records").insert({vehicle_id:_e.vehicle_id,employee_id:ft.id,date:new Date(_e.date).toISOString(),mileage:_e.mileage,liters:_e.liters,price_per_liter:_e.price_per_liter,total_value:Ot,gas_station:_e.gas_station,location:_e.location,receipt_url:tt,notes:_e.notes||null});if(Xt)throw Xt;a(!1),He(),ue()}catch(ft){console.error("Error saving fuel record:",ft),H(ft.message||"Erro ao salvar abastecimento")}finally{O(!1)}},He=()=>{pe({vehicle_id:"",date:new Date().toISOString().split("T")[0],mileage:0,liters:0,price_per_liter:0,gas_station:"",location:"",notes:""}),ee(null),J(null)},De=async Ge=>{try{const{data:ft}=await Qr.storage.from("fuel-receipts").createSignedUrl(Ge,3600);ft!=null&&ft.signedUrl&&window.open(ft.signedUrl,"_blank")}catch(ft){console.error("Error viewing receipt:",ft),alert("Erro ao visualizar comprovante")}},et=_e.liters*_e.price_per_liter;return m?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Controle de Combustvel"}),L.jsx("p",{className:"text-gray-600 mt-1",children:"Registre todos os abastecimentos dos veculos"})]}),L.jsxs("button",{onClick:()=>{He(),a(!0)},disabled:t.length===0,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[L.jsx(YM,{className:"w-5 h-5"}),L.jsx("span",{children:"Novo Abastecimento"})]})]}),B&&L.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center space-x-2",children:[L.jsx(qM,{className:"w-5 h-5"}),L.jsx("span",{children:B})]}),t.length===0&&L.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg",children:L.jsx("p",{className:"font-medium",children:"Cadastre um veculo antes de registrar abastecimentos"})}),L.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:L.jsxs("div",{className:"overflow-x-auto",children:[L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{className:"bg-gray-50",children:L.jsxs("tr",{children:[L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Veculo"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"KM"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Litros"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"R$/L"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Posto"}),L.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Comprovante"})]})}),L.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(Ge=>L.jsxs("tr",{className:"hover:bg-gray-50",children:[L.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(Ge.date).toLocaleDateString("pt-BR")}),L.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ge.vehicles.name}),L.jsx("p",{className:"text-xs text-gray-500",children:Ge.vehicles.plate})]})}),L.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Ge.mileage.toLocaleString()}),L.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Ge.liters.toFixed(2),"L"]}),L.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["R$ ",Ge.price_per_liter.toFixed(2)]}),L.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600",children:["R$ ",Ge.total_value.toFixed(2)]}),L.jsx("td",{className:"px-6 py-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-900",children:Ge.gas_station}),L.jsx("p",{className:"text-xs text-gray-500",children:Ge.location})]})}),L.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ge.receipt_url?L.jsxs("button",{onClick:()=>De(Ge.receipt_url),className:"text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[L.jsx(mj,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm",children:"Ver"})]}):L.jsx("span",{className:"text-xs text-gray-400",children:"Sem comprovante"})})]},Ge.id))})]}),s.length===0&&L.jsxs("div",{className:"text-center py-12",children:[L.jsx(Wv,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum abastecimento registrado"}),L.jsx("p",{className:"text-gray-600",children:"Comece adicionando o primeiro abastecimento"})]})]})}),L.jsxs(a1,{isOpen:T,onClose:()=>a(!1),children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Novo Abastecimento"}),L.jsxs("form",{onSubmit:at,className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"col-span-2",children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Veculo *"}),L.jsxs("select",{required:!0,value:_e.vehicle_id,onChange:Ge=>pe({..._e,vehicle_id:Ge.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[L.jsx("option",{value:"",children:"Selecione um veculo"}),t.map(Ge=>L.jsxs("option",{value:Ge.id,children:[Ge.name," - ",Ge.plate," (KM atual: ",Ge.current_mileage,")"]},Ge.id))]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data *"}),L.jsx("input",{type:"date",required:!0,value:_e.date,onChange:Ge=>pe({..._e,date:Ge.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quilometragem *"}),L.jsx("input",{type:"number",required:!0,min:"0",value:_e.mileage||"",onChange:Ge=>pe({..._e,mileage:parseInt(Ge.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ex: 50000"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Litros *"}),L.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:_e.liters||"",onChange:Ge=>pe({..._e,liters:parseFloat(Ge.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ex: 40.50"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preo por Litro *"}),L.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:_e.price_per_liter||"",onChange:Ge=>pe({..._e,price_per_liter:parseFloat(Ge.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ex: 5.49"})]}),et>0&&L.jsxs("div",{className:"col-span-2 bg-green-50 p-4 rounded-lg",children:[L.jsx("p",{className:"text-sm text-gray-700 mb-1",children:"Valor Total"}),L.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["R$ ",et.toFixed(2)]})]}),L.jsxs("div",{className:"col-span-2",children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Posto de Combustvel *"}),L.jsx("input",{type:"text",required:!0,value:_e.gas_station,onChange:Ge=>pe({..._e,gas_station:Ge.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ex: Shell, Ipiranga, Petrobras"})]}),L.jsxs("div",{className:"col-span-2",children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Localizao *"}),L.jsx("input",{type:"text",required:!0,value:_e.location,onChange:Ge=>pe({..._e,location:Ge.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ex: Rodovia BR-101, km 230"})]}),L.jsxs("div",{className:"col-span-2",children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comprovante/Nota Fiscal"}),L.jsx("input",{type:"file",accept:"image/*",onChange:ie,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),re&&L.jsx("div",{className:"mt-2",children:L.jsx("img",{src:re,alt:"Preview",className:"h-32 rounded-lg object-cover"})})]}),L.jsxs("div",{className:"col-span-2",children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observaes"}),L.jsx("textarea",{value:_e.notes,onChange:Ge=>pe({..._e,notes:Ge.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Informaes adicionais..."})]})]}),L.jsxs("div",{className:"flex space-x-3 pt-4",children:[L.jsx("button",{type:"button",onClick:()=>a(!1),disabled:R,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition disabled:opacity-50",children:"Cancelar"}),L.jsx("button",{type:"submit",disabled:R,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:R?"Salvando...":"Salvar Abastecimento"})]})]})]})]})}function SH(){const[t,r]=zt.useState([]),[s,u]=zt.useState("all"),[m,v]=zt.useState(""),[T,a]=zt.useState(""),[R,O]=zt.useState(!0),[B,H]=zt.useState([]);zt.useEffect(()=>{q()},[]),zt.useEffect(()=>{t.length>0&&ee()},[s,m,T,t]);const q=async()=>{try{const{data:ie,error:ke}=await Qr.from("vehicles").select("id, name, plate").order("name");if(ke)throw ke;r(ie||[])}catch(ie){console.error("Error loading vehicles:",ie)}finally{O(!1)}},ee=async()=>{try{O(!0);let ie=Qr.from("fuel_records").select("*, vehicles(name, plate, initial_mileage, current_mileage)");s!=="all"&&(ie=ie.eq("vehicle_id",s)),m&&(ie=ie.gte("date",new Date(m).toISOString())),T&&(ie=ie.lte("date",new Date(T+"T23:59:59").toISOString()));const{data:ke,error:at}=await ie.order("date",{ascending:!1});if(at)throw at;const He={};ke==null||ke.forEach(De=>{const et=De.vehicle_id;He[et]||(He[et]={vehicle_name:De.vehicles.name,vehicle_plate:De.vehicles.plate,total_records:0,total_liters:0,total_spent:0,total_km:De.vehicles.current_mileage-De.vehicles.initial_mileage,avg_consumption:0,avg_price:0,stations:{}});const Ge=He[et];Ge.total_records++,Ge.total_liters+=parseFloat(De.liters),Ge.total_spent+=parseFloat(De.total_value),Ge.stations[De.gas_station]||(Ge.stations[De.gas_station]=0),Ge.stations[De.gas_station]++}),Object.values(He).forEach(De=>{De.total_liters>0&&De.total_km>0&&(De.avg_consumption=De.total_km/De.total_liters),De.total_records>0&&(De.avg_price=De.total_spent/De.total_liters)}),H(Object.values(He))}catch(ie){console.error("Error loading stats:",ie)}finally{O(!1)}},re=B.reduce((ie,ke)=>ie+ke.total_spent,0),J=B.reduce((ie,ke)=>ie+ke.total_liters,0),_e=B.reduce((ie,ke)=>ie+ke.total_records,0),pe=J>0?re/J:0,ue={};return B.forEach(ie=>{Object.entries(ie.stations).forEach(([ke,at])=>{ue[ke]=(ue[ke]||0)+at})}),R?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Relatrios de Combustvel"}),L.jsx("p",{className:"text-gray-600 mt-1",children:"Anlise detalhada de consumo e gastos"})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filtros"}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Veculo"}),L.jsxs("select",{value:s,onChange:ie=>u(ie.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[L.jsx("option",{value:"all",children:"Todos os Veculos"}),t.map(ie=>L.jsxs("option",{value:ie.id,children:[ie.name," - ",ie.plate]},ie.id))]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Inicial"}),L.jsx("input",{type:"date",value:m,onChange:ie=>v(ie.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Final"}),L.jsx("input",{type:"date",value:T,onChange:ie=>a(ie.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[L.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx(xv,{className:"w-8 h-8 opacity-80"}),L.jsx("span",{className:"text-sm opacity-80",children:"Total"})]}),L.jsx("p",{className:"text-3xl font-bold",children:_e}),L.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Abastecimentos"})]}),L.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx(fj,{className:"w-8 h-8 opacity-80"}),L.jsx("span",{className:"text-sm opacity-80",children:"Gastos"})]}),L.jsxs("p",{className:"text-3xl font-bold",children:["R$ ",re.toFixed(2)]}),L.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Total Investido"})]}),L.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx(Wv,{className:"w-8 h-8 opacity-80"}),L.jsx("span",{className:"text-sm opacity-80",children:"Volume"})]}),L.jsxs("p",{className:"text-3xl font-bold",children:[J.toFixed(0),"L"]}),L.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Total Abastecido"})]}),L.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx(Vc,{className:"w-8 h-8 opacity-80"}),L.jsx("span",{className:"text-sm opacity-80",children:"Mdia"})]}),L.jsxs("p",{className:"text-3xl font-bold",children:["R$ ",pe.toFixed(2)]}),L.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Preo Mdio/Litro"})]})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[L.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[L.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2",children:[L.jsx(y_,{className:"w-5 h-5 text-blue-600"}),L.jsx("span",{children:"Postos Mais Utilizados"})]}),L.jsx("div",{className:"space-y-3",children:Object.entries(ue).sort(([,ie],[,ke])=>ke-ie).slice(0,10).map(([ie,ke])=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:L.jsx(Wv,{className:"w-5 h-5 text-blue-600"})}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:ie}),L.jsxs("p",{className:"text-sm text-gray-500",children:[ke," abastecimentos"]})]})]}),L.jsx("div",{className:"text-right",children:L.jsxs("p",{className:"text-lg font-bold text-blue-600",children:[(ke/_e*100).toFixed(0),"%"]})})]},ie))}),Object.keys(ue).length===0&&L.jsxs("div",{className:"text-center py-8 text-gray-500",children:[L.jsx(y_,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),L.jsx("p",{children:"Nenhum posto registrado"})]})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[L.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2",children:[L.jsx(xv,{className:"w-5 h-5 text-green-600"}),L.jsx("span",{children:"Anlise por Veculo"})]}),L.jsx("div",{className:"space-y-4",children:B.map(ie=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-bold text-gray-900",children:ie.vehicle_name}),L.jsx("p",{className:"text-sm text-gray-500",children:ie.vehicle_plate})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",ie.total_spent.toFixed(2)]}),L.jsxs("p",{className:"text-xs text-gray-500",children:[ie.total_records," registros"]})]})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-3 pt-3 border-t border-gray-100",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total KM"}),L.jsx("p",{className:"text-sm font-bold text-gray-900",children:ie.total_km.toLocaleString()})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Litros"}),L.jsxs("p",{className:"text-sm font-bold text-gray-900",children:[ie.total_liters.toFixed(0),"L"]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Mdia km/L"}),L.jsx("p",{className:"text-sm font-bold text-blue-600",children:ie.avg_consumption.toFixed(1)})]})]})]},ie.vehicle_plate))}),B.length===0&&L.jsxs("div",{className:"text-center py-8 text-gray-500",children:[L.jsx(xv,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),L.jsx("p",{children:"Nenhum dado disponvel"})]})]})]})]})}function EH(){const{profile:t}=Ud(),[r,s]=zt.useState([]),[u,m]=zt.useState(""),[v,T]=zt.useState("hours"),[a,R]=zt.useState(0),[O,B]=zt.useState(""),[H,q]=zt.useState(!1),[ee,re]=zt.useState(!1),[J,_e]=zt.useState(""),[pe,ue]=zt.useState(0),[ie,ke]=zt.useState([]),[at,He]=zt.useState(!1);zt.useEffect(()=>{De(),at&&Ge()},[at]),zt.useEffect(()=>{u&&et(u)},[u]);const De=async()=>{try{const{data:tt,error:Ot}=await Qr.from("profiles").select("*").eq("role","employee").order("full_name",{ascending:!0});if(Ot)throw Ot;s(tt||[])}catch(tt){console.error("Error loading employees:",tt)}},et=async tt=>{try{const Ot=new Date,Xt=Ot.getMonth()+1,Dr=Ot.getFullYear(),{data:ir,error:Ir}=await Qr.from("overtime_hours").select("overtime_hours, hour_bank").eq("user_id",tt).eq("month",Xt).eq("year",Dr).maybeSingle();if(Ir)throw Ir;ue((ir==null?void 0:ir.hour_bank)||0)}catch(Ot){console.error("Error loading hour bank:",Ot),ue(0)}},Ge=async()=>{try{const{data:tt,error:Ot}=await Qr.from("hour_bank_adjustments").select(`
          *,
          profiles:user_id(full_name)
        `).order("created_at",{ascending:!1}).limit(50);if(Ot)throw Ot;ke(tt||[])}catch(tt){console.error("Error loading adjustment history:",tt)}},ft=async tt=>{tt.preventDefault(),q(!0),_e(""),re(!1);try{if(!u)throw new Error("Selecione um colaborador");if(a<=0)throw new Error("A quantidade deve ser maior que zero");const Ot=v==="days"?a*24:a;if(Ot>pe)throw new Error(`Banco de horas insuficiente. Disponvel: ${pe.toFixed(2)}h`);const Xt=new Date,Dr=Xt.getMonth()+1,ir=Xt.getFullYear(),{data:Ir}=await Qr.from("overtime_hours").select("hour_bank").eq("user_id",u).eq("month",Dr).eq("year",ir).maybeSingle(),ei=((Ir==null?void 0:Ir.hour_bank)||0)-Ot,{error:sr}=await Qr.from("overtime_hours").update({hour_bank:ei}).eq("user_id",u).eq("month",Dr).eq("year",ir);if(sr)throw sr;const{error:yr}=await Qr.from("hour_bank_adjustments").insert({user_id:u,admin_id:t==null?void 0:t.id,adjustment_type:v,hours_deducted:Ot,reason:O||"Folga concedida"});if(yr)throw yr;re(!0),m(""),R(0),B(""),ue(0),setTimeout(()=>re(!1),5e3)}catch(Ot){_e(Ot.message||"Erro ao processar baixa")}finally{q(!1)}};return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Baixa de Banco de Horas"}),L.jsx("p",{className:"text-gray-600",children:"Conceda folgas e gerencie o banco de horas dos colaboradores"})]}),L.jsxs("button",{onClick:()=>He(!at),className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition",children:[L.jsx(pj,{className:"w-5 h-5"}),L.jsxs("span",{children:[at?"Ocultar":"Ver"," Histrico"]})]})]}),at&&L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Histrico de Baixas"}),ie.length===0?L.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhuma baixa registrada"}):L.jsx("div",{className:"space-y-3",children:ie.map(tt=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("p",{className:"font-semibold text-gray-800",children:tt.profiles.full_name}),L.jsx("span",{className:"text-sm text-gray-500",children:new Date(tt.created_at).toLocaleDateString("pt-BR")})]}),L.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[L.jsxs("span",{className:"text-gray-600",children:[L.jsxs("span",{className:"font-medium text-red-600",children:["-",tt.hours_deducted.toFixed(2),"h"]}),tt.adjustment_type==="days"&&` (${(tt.hours_deducted/24).toFixed(1)} dias)`]}),tt.reason&&L.jsx("span",{className:"text-gray-500 italic",children:tt.reason})]})]},tt.id))})]}),L.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-2xl",children:L.jsxs("form",{onSubmit:ft,className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar Colaborador *"}),L.jsxs("select",{value:u,onChange:tt=>m(tt.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",required:!0,children:[L.jsx("option",{value:"",children:"Escolha um colaborador"}),r.map(tt=>L.jsxs("option",{value:tt.id,children:[tt.full_name," - ",tt.job_position||"Colaborador"]},tt.id))]})]}),u&&L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center space-x-2 text-blue-800",children:[L.jsx(Dd,{className:"w-5 h-5"}),L.jsxs("span",{className:"font-semibold",children:["Banco de Horas Atual: ",pe.toFixed(2),"h"]})]}),pe>0&&L.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Equivalente a ",(pe/24).toFixed(1)," dias"]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Baixa *"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("button",{type:"button",onClick:()=>T("hours"),className:`p-4 rounded-lg border-2 transition ${v==="hours"?"border-amber-500 bg-amber-50":"border-gray-300 bg-white hover:border-amber-300"}`,children:[L.jsx(Dd,{className:`w-8 h-8 mx-auto mb-2 ${v==="hours"?"text-amber-600":"text-gray-400"}`}),L.jsx("p",{className:"font-semibold text-gray-800",children:"Por Horas"}),L.jsx("p",{className:"text-xs text-gray-600",children:"Descontar quantidade exata de horas"})]}),L.jsxs("button",{type:"button",onClick:()=>T("days"),className:`p-4 rounded-lg border-2 transition ${v==="days"?"border-amber-500 bg-amber-50":"border-gray-300 bg-white hover:border-amber-300"}`,children:[L.jsx(DS,{className:`w-8 h-8 mx-auto mb-2 ${v==="days"?"text-amber-600":"text-gray-400"}`}),L.jsx("p",{className:"font-semibold text-gray-800",children:"Por Dias"}),L.jsx("p",{className:"text-xs text-gray-600",children:"Cada dia = 24 horas"})]})]})]}),L.jsxs("div",{children:[L.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Quantidade ",v==="hours"?"de Horas":"de Dias"," *"]}),L.jsx("input",{type:"number",value:a||"",onChange:tt=>R(parseFloat(tt.target.value)||0),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition",placeholder:v==="hours"?"8.0":"1",step:"0.5",min:"0.5",required:!0}),a>0&&L.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v==="hours"?`= ${a}h sero descontadas`:`= ${a*24}h sero descontadas (${a} dias)`})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo (opcional)"}),L.jsx("textarea",{value:O,onChange:tt=>B(tt.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition resize-none",placeholder:"Ex: Folga por banco de horas",rows:3})]}),J&&L.jsxs("div",{className:"bg-red-50 text-red-600 px-4 py-3 rounded-lg text-sm flex items-center justify-between",children:[L.jsx("span",{children:J}),L.jsx("button",{onClick:()=>_e(""),className:"text-red-800 hover:text-red-900",children:L.jsx(Kc,{className:"w-4 h-4"})})]}),ee&&L.jsxs("div",{className:"bg-green-50 text-green-600 px-4 py-3 rounded-lg text-sm flex items-center justify-between",children:[L.jsx("span",{children:"Baixa de banco de horas realizada com sucesso!"}),L.jsx("button",{onClick:()=>re(!1),className:"text-green-800 hover:text-green-900",children:L.jsx(Kc,{className:"w-4 h-4"})})]}),L.jsxs("button",{type:"submit",disabled:H||!u||a<=0,className:"w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 rounded-lg font-semibold hover:from-amber-600 hover:to-orange-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[L.jsx(yj,{className:"w-5 h-5"}),L.jsx("span",{children:H?"Processando...":"Realizar Baixa"})]})]})})]})}function AH(){const[t,r]=zt.useState([]),[s,u]=zt.useState(!0);zt.useEffect(()=>{m()},[]);const m=async()=>{u(!0);try{const{data:R}=await Qr.from("active_sessions").select("user_id, clock_in_time, last_updated"),{data:O}=await Qr.from("profiles").select("id, full_name"),B=[];for(const H of R||[]){const q=O==null?void 0:O.find(re=>re.id===H.user_id),{data:ee}=await Qr.from("time_entries").select("id").eq("user_id",H.user_id).eq("clock_in",H.clock_in_time).is("clock_out",null).maybeSingle();B.push({user_id:H.user_id,full_name:(q==null?void 0:q.full_name)||"Desconhecido",clock_in_time:H.clock_in_time,last_updated:H.last_updated,has_entry:!!ee,is_orphan:!ee})}r(B)}catch(R){console.error("Erro ao carregar sesses:",R)}finally{u(!1)}},v=async(R,O)=>{if(confirm(`Tem certeza que deseja resetar a sesso de ${O}?`))try{await Qr.from("active_sessions").delete().eq("user_id",R),alert("Sesso resetada com sucesso!"),m()}catch(B){alert("Erro ao resetar sesso: "+B.message)}},T=async()=>{const R=t.filter(O=>O.is_orphan);if(R.length===0){alert("No h sesses rfs para limpar.");return}if(confirm(`Encontradas ${R.length} sesses rfs. Deseja limpar todas?`))try{for(const O of R)await Qr.from("active_sessions").delete().eq("user_id",O.user_id);alert(`${R.length} sesses rfs foram limpas!`),m()}catch(O){alert("Erro ao limpar sesses: "+O.message)}};if(s)return L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})});const a=t.filter(R=>R.is_orphan).length;return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Gerenciar Sesses Ativas"}),L.jsx("p",{className:"text-gray-600",children:"Diagnosticar e resolver problemas de sesses travadas"})]}),L.jsxs("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center space-x-2",children:[L.jsx(vj,{className:"w-4 h-4"}),L.jsx("span",{children:"Atualizar"})]})]}),a>0&&L.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg",children:L.jsxs("div",{className:"flex items-start justify-between",children:[L.jsxs("div",{className:"flex items-start space-x-3",children:[L.jsx(v3,{className:"w-6 h-6 text-red-600 mt-0.5"}),L.jsxs("div",{children:[L.jsxs("p",{className:"font-semibold text-red-800",children:[a," ",a===1?"Sesso rf Detectada":"Sesses rfs Detectadas"]}),L.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Estas sesses esto ativas mas sem entrada correspondente no banco. Isso impede os colaboradores de bater ponto."})]})]}),L.jsx("button",{onClick:T,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm",children:"Limpar Todas"})]})}),t.length===0?L.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:L.jsx("p",{className:"text-gray-600",children:"Nenhuma sesso ativa no momento"})}):L.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"bg-gray-50",children:[L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Colaborador"}),L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Entrada"}),L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ltima Atualizao"}),L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),L.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Aes"})]})}),L.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map(R=>L.jsxs("tr",{className:R.is_orphan?"bg-red-50":"hover:bg-gray-50",children:[L.jsx("td",{className:"px-4 py-3 text-sm text-gray-800 font-medium",children:R.full_name}),L.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(R.clock_in_time).toLocaleString("pt-BR")}),L.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(R.last_updated).toLocaleString("pt-BR")}),L.jsx("td",{className:"px-4 py-3 text-sm",children:R.is_orphan?L.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[L.jsx(v3,{className:"w-3 h-3 mr-1"}),"rf (Sem Entrada)"]}):L.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"OK"})}),L.jsx("td",{className:"px-4 py-3 text-sm",children:L.jsxs("button",{onClick:()=>v(R.user_id,R.full_name),className:"text-red-600 hover:text-red-800 font-medium flex items-center space-x-1",children:[L.jsx(Kc,{className:"w-4 h-4"}),L.jsx("span",{children:"Resetar"})]})})]},R.user_id))})]})})]})}function IH(){var R;const[t,r]=zt.useState("dashboard"),[s,u]=zt.useState(!1),{signOut:m,profile:v}=Ud(),T=[{id:"dashboard",label:"Dashboard",icon:gj},{id:"tracking",label:"Acompanhar Colaboradores",icon:y_},{id:"registration",label:"Cadastrar Colaborador",icon:JM},{id:"hour-bank",label:"Baixa de Banco de Horas",icon:_j},{id:"sessions",label:"Gerenciar Sesses",icon:wj},{id:"photos",label:"Registro",icon:__},{id:"reports",label:"Relatrios",icon:ZM},{id:"vehicles",label:"Veculos",icon:IT},{id:"fuel",label:"Abastecimentos",icon:Wv},{id:"fuel-reports",label:"Relatrios de Combustvel",icon:xv}],a=()=>{switch(t){case"dashboard":return L.jsx(w3,{});case"tracking":return L.jsx(Pj,{});case"registration":return L.jsx(kj,{});case"hour-bank":return L.jsx(EH,{});case"sessions":return L.jsx(AH,{});case"photos":return L.jsx(wH,{});case"reports":return L.jsx(vH,{});case"vehicles":return L.jsx(bH,{});case"fuel":return L.jsx(TH,{});case"fuel-reports":return L.jsx(SH,{});default:return L.jsx(w3,{})}};return L.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50",children:[L.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:L.jsx("button",{onClick:()=>u(!s),className:"p-3 bg-white rounded-lg shadow-lg text-gray-800",children:s?L.jsx(Kc,{className:"w-6 h-6"}):L.jsx(KM,{className:"w-6 h-6"})})}),L.jsxs("aside",{className:`fixed top-0 left-0 h-full w-64 bg-white shadow-xl transform transition-transform duration-300 z-40 ${s?"translate-x-0":"-translate-x-full"} lg:translate-x-0`,children:[L.jsx("div",{className:"p-6 border-b border-gray-200",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 p-3 rounded-lg",children:L.jsx(OS,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Ponto Digital"}),L.jsx("p",{className:"text-xs text-gray-600",children:"Admin"})]})]})}),L.jsx("div",{className:"p-4 border-b border-gray-200",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold",children:(R=v==null?void 0:v.full_name)==null?void 0:R.charAt(0).toUpperCase()}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-semibold text-gray-800",children:v==null?void 0:v.full_name}),L.jsx("p",{className:"text-xs text-gray-600",children:"Administrador"})]})]})}),L.jsx("nav",{className:"p-4 space-y-2",children:T.map(O=>{const B=O.icon;return L.jsxs("button",{onClick:()=>{r(O.id),u(!1)},className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition ${t===O.id?"bg-gradient-to-r from-amber-500 to-orange-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[L.jsx(B,{className:"w-5 h-5"}),L.jsx("span",{className:"font-medium text-sm",children:O.label})]},O.id)})}),L.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200",children:L.jsxs("button",{onClick:()=>m(),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition",children:[L.jsx(XM,{className:"w-5 h-5"}),L.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]}),L.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 pt-20 lg:pt-8",children:a()})]})}function CH(){const[t,r]=zt.useState(navigator.onLine);return zt.useEffect(()=>{const s=()=>r(!0),u=()=>r(!1);return window.addEventListener("online",s),window.addEventListener("offline",u),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",u)}},[]),t}const PH="PontoDigitalDB",kH=1,Yl="pendingTimeEntries";class RH{constructor(){this.db=null,this.clearAll=this.clearAllPendingEntries}async init(){return new Promise((r,s)=>{const u=indexedDB.open(PH,kH);u.onerror=()=>s(u.error),u.onsuccess=()=>{this.db=u.result,r()},u.onupgradeneeded=m=>{const v=m.target.result;v.objectStoreNames.contains(Yl)||v.createObjectStore(Yl,{keyPath:"id"})}})}async addPendingEntry(r){return this.db||await this.init(),new Promise((s,u)=>{const T=this.db.transaction([Yl],"readwrite").objectStore(Yl).add(r);T.onsuccess=()=>s(),T.onerror=()=>u(T.error)})}async getPendingEntries(){return this.db||await this.init(),new Promise((r,s)=>{const v=this.db.transaction([Yl],"readonly").objectStore(Yl).getAll();v.onsuccess=()=>r(v.result),v.onerror=()=>s(v.error)})}async removePendingEntry(r){return this.db||await this.init(),new Promise((s,u)=>{const T=this.db.transaction([Yl],"readwrite").objectStore(Yl).delete(r);T.onsuccess=()=>s(),T.onerror=()=>u(T.error)})}async clearAllPendingEntries(){return this.db||await this.init(),new Promise((r,s)=>{const v=this.db.transaction([Yl],"readwrite").objectStore(Yl).clear();v.onsuccess=()=>r(),v.onerror=()=>s(v.error)})}}const Zp=new RH;class MH{constructor(){this.isSyncing=!1}async syncPendingEntries(){if(this.isSyncing)return console.log("Sync already in progress"),{success:0,failed:0};this.isSyncing=!0;let r=0,s=0;try{const u=await Zp.getPendingEntries();if(u.length===0)return console.log("No pending entries to sync"),{success:0,failed:0};console.log(`Syncing ${u.length} pending entries...`);for(const m of u)try{m.type==="clock_in"?await this.syncClockIn(m):m.type==="clock_out"&&await this.syncClockOut(m),await Zp.removePendingEntry(m.id),r++,console.log(`Synced entry ${m.id}`)}catch(v){console.error(`Failed to sync entry ${m.id}:`,v),s++}console.log(`Sync complete: ${r} success, ${s} failed`)}catch(u){console.error("Error during sync:",u)}finally{this.isSyncing=!1}return{success:r,failed:s}}async syncClockIn(r){let s=r.selfie_url;if(r.selfie_url&&r.selfie_url.startsWith("data:image")){const v=r.selfie_url.split(",")[1],T=atob(v),a=new Array(T.length);for(let re=0;re<T.length;re++)a[re]=T.charCodeAt(re);const R=new Uint8Array(a),O=new Blob([R],{type:"image/jpeg"}),B=`${r.user_id}/${Date.now()}.jpg`,{data:H,error:q}=await Qr.storage.from("employee-photos").upload(B,O,{contentType:"image/jpeg",upsert:!1});if(q)throw q;const{data:ee}=Qr.storage.from("employee-photos").getPublicUrl(B);s=ee.publicUrl}const{data:u,error:m}=await Qr.from("time_entries").insert({user_id:r.user_id,clock_in:r.clock_in,location_lat:r.location_lat,location_lng:r.location_lng,selfie_url:s,is_overtime:r.is_overtime,overtime_type:r.overtime_type,notes:r.notes||null}).select().single();if(m)throw m;await Qr.from("active_sessions").upsert({user_id:r.user_id,clock_in_time:r.clock_in,current_lat:r.location_lat,current_lng:r.location_lng,last_updated:new Date().toISOString()})}async syncClockOut(r){const{data:s}=await Qr.from("time_entries").select("*").eq("user_id",r.user_id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(!s)throw console.warn("[SYNC] Sem entrada em aberto para clock_out - limpando sesso ativa se existir"),await Qr.from("active_sessions").delete().eq("user_id",r.user_id),new Error("No active entry found for clock out");const u=new Date(s.clock_in),m=new Date(r.clock_out),v=Math.max(0,(m.getTime()-u.getTime())/(1e3*60*60)),T={clock_out:r.clock_out,total_hours:v};r.notes&&(T.notes=s.notes?`${s.notes}
[SADA] ${r.notes}`:`[SADA] ${r.notes}`);const{error:a}=await Qr.from("time_entries").update(T).eq("id",s.id);if(a)throw console.error("[SYNC] Erro ao atualizar sada:",a),a;const R=new Date(r.clock_out),O=R.getMonth()+1,B=R.getFullYear(),{data:H}=await Qr.from("profiles").select("work_hours, overtime_limit").eq("id",r.user_id).maybeSingle(),q=(H==null?void 0:H.work_hours)||8,ee=(H==null?void 0:H.overtime_limit)||30,{recalculateMonthlyOvertime:re}=await Bd(async()=>{const{recalculateMonthlyOvertime:J}=await import("./overtimeCalculator-BIOboYYF.js");return{recalculateMonthlyOvertime:J}},[]);await re(r.user_id,O,B,q,ee),await Qr.from("active_sessions").delete().eq("user_id",r.user_id)}startAutoSync(){window.addEventListener("online",()=>{console.log("Connection restored, starting sync..."),setTimeout(()=>this.syncPendingEntries(),2e3)}),setInterval(()=>{navigator.onLine&&!this.isSyncing&&this.syncPendingEntries()},6e4)}}const lk=new MH;function ck(){const{user:t,profile:r}=Ud(),s=CH(),[u,m]=zt.useState(!1),[v,T]=zt.useState(null),[a,R]=zt.useState(!1),[O,B]=zt.useState(null),[H,q]=zt.useState(null),[ee,re]=zt.useState(null),[J,_e]=zt.useState(!1),[pe,ue]=zt.useState(""),[ie,ke]=zt.useState(""),[at,He]=zt.useState(!1),[De,et]=zt.useState(!1),[Ge,ft]=zt.useState(0),[tt,Ot]=zt.useState(!1),[Xt,Dr]=zt.useState(!1),[ir,Ir]=zt.useState(""),ei=zt.useRef(null),sr=zt.useRef(null),yr=zt.useRef(null),vr=zt.useCallback(async()=>{try{const fr=await Zp.getPendingEntries();ft(fr.length)}catch(fr){console.error("[SYNC] Erro ao verificar pendncias:",fr)}},[]),gr=zt.useCallback(async()=>{if(t){if(tt){console.log("[SESSION] Verificao j em andamento, ignorando...");return}yr.current&&clearTimeout(yr.current),yr.current=window.setTimeout(async()=>{Ot(!0);try{console.log("[SESSION] Verificando sesso ativa...");const{data:fr,error:Ut}=await Qr.from("active_sessions").select("*").eq("user_id",t.id).maybeSingle();if(Ut){console.error("[SESSION] Erro ao buscar sesso:",Ut),Ot(!1);return}if(fr){console.log("[SESSION] Sesso ativa encontrada:",fr.clock_in_time);const{data:ti,error:si}=await Qr.from("time_entries").select("is_overtime").eq("user_id",t.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(si){console.error("[SESSION] Erro ao buscar entrada:",si),Ot(!1);return}ti?(T(fr),et(ti.is_overtime||!1)):(console.warn("[SESSION] Sesso rf detectada - limpando..."),await Qr.from("active_sessions").delete().eq("user_id",t.id),T(null),et(!1))}else console.log("[SESSION] Nenhuma sesso ativa"),T(null),et(!1)}catch(fr){console.error("[SESSION] Erro inesperado:",fr)}finally{Ot(!1)}},300)}},[t,tt]);zt.useEffect(()=>{if(t)return console.log("[MOUNT] Componente montado, iniciando verificaes..."),gr(),vr(),lk.startAutoSync(),()=>{console.log("[UNMOUNT] Limpando recursos..."),sr.current&&sr.current.getTracks().forEach(fr=>fr.stop()),yr.current&&clearTimeout(yr.current)}},[t]),zt.useEffect(()=>{s&&(console.log("[ONLINE] Voltou online, sincronizando..."),lk.syncPendingEntries().then(()=>{vr(),gr()}))},[s,vr,gr]),zt.useEffect(()=>{if(!v||!r)return;console.log("[AUTO-CLOCKOUT] Iniciando monitoramento...");const fr=setInterval(()=>{ht()},3e4);return()=>{console.log("[AUTO-CLOCKOUT] Parando monitoramento..."),clearInterval(fr)}},[v,r]);const Ue=zt.useCallback(async()=>{if(!(!t||u))try{console.log("[RESET] Resetando sesso..."),m(!0),await Qr.from("active_sessions").delete().eq("user_id",t.id),await Zp.clearAll(),T(null),q(null),ar(),ue("Sesso Resetada"),ke("Sua sesso foi resetada com sucesso. Agora voc pode bater ponto normalmente."),_e(!0),console.log("[RESET] Sesso resetada com sucesso")}catch(fr){console.error("[RESET] Erro ao resetar:",fr),ue("Erro"),ke("Erro ao resetar sesso: "+fr.message),_e(!0)}finally{m(!1)}},[t,u,ar]),vt=()=>{const fr=new Date;return fr.getHours()*60+fr.getMinutes()},ct=fr=>{const[Ut,ti]=fr.split(":").map(Number);return Ut*60+ti},ht=async()=>{if(!r||!v||De)return;const fr=vt(),Ut=r.horario_saida_almoco?ct(r.horario_saida_almoco):null,ti=r.horario_saida?ct(r.horario_saida):null;Ut&&Math.abs(fr-Ut)<=1?await Pt("lunch"):ti&&Math.abs(fr-ti)<=1&&await Pt("end")},Pt=async fr=>{try{const{data:Ut}=await Qr.from("time_entries").select("*").eq("user_id",t==null?void 0:t.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(Ut){const ti=new Date(Ut.clock_in),si=new Date,cn=Math.max(0,(si.getTime()-ti.getTime())/(1e3*60*60));await Qr.from("time_entries").update({clock_out:si.toISOString(),total_hours:cn}).eq("id",Ut.id),await Qr.from("active_sessions").delete().eq("user_id",t==null?void 0:t.id),await gr();const un=fr==="lunch"?"Sada automtica registrada para almoo":"Sada automtica registrada - fim do expediente";ue("Sada Automtica"),ke(un),_e(!0)}}catch(Ut){console.error("Erro no clock-out automtico:",Ut)}},dr=()=>{if(!r)return!1;if(new Date().getDay()===0)return{isOvertime:!0,type:"weekend"};const ti=vt(),si=r.horario_saida_almoco?ct(r.horario_saida_almoco):null,cn=r.horario_volta_almoco?ct(r.horario_volta_almoco):null,un=r.horario_saida?ct(r.horario_saida):null,Xn=si&&cn&&ti>=si&&ti<cn,Vn=un&&ti>=un;return{isOvertime:Xn||Vn,type:Xn?"lunch":"after_hours"}},br=zt.useCallback(async()=>{if(a||sr.current){console.log("[CAMERA] Cmera j est aberta ou em uso, ignorando...");return}if(u){console.log("[CAMERA] Operao em andamento, aguarde...");return}if(re(null),R(!0),console.log("[CAMERA] Iniciando acesso  cmera..."),console.log("[CAMERA] Online:",s),console.log("[CAMERA] Contexto seguro (HTTPS):",window.isSecureContext),console.log("[CAMERA] Navigator.mediaDevices disponvel:",!!navigator.mediaDevices),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){const fr="Cmera no disponvel. Certifique-se de que o app est instalado e voc est usando HTTPS.";console.error("[CAMERA]",fr),re(fr),ar();return}if(!window.isSecureContext){const fr="Cmera requer contexto seguro (HTTPS). Acesse o app via HTTPS ou instale como PWA.";console.error("[CAMERA]",fr),re(fr),ar();return}try{console.log("[CAMERA] Solicitando permisso...");const fr={video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}}},Ut=await navigator.mediaDevices.getUserMedia(fr);console.log("[CAMERA] Permisso concedida, stream obtido:",Ut.id),sr.current=Ut,ei.current&&(ei.current.srcObject=Ut,console.log("[CAMERA] Stream conectado ao elemento de vdeo"))}catch(fr){console.error("[CAMERA] Erro ao acessar cmera:",fr.name,fr.message);let Ut="Erro ao acessar cmera. ";if(fr.name==="NotAllowedError"||fr.name==="PermissionDeniedError")Ut+="Permisso negada. ",/android/i.test(navigator.userAgent)?Ut+="No Android: v em Configuraes > Apps > "+(document.title||"Este App")+" > Permisses e ative a Cmera.":Ut+="Clique no cone de cadeado na barra de endereo e permita o acesso  cmera.";else if(fr.name==="NotFoundError"||fr.name==="DevicesNotFoundError")Ut+="Nenhuma cmera foi encontrada no dispositivo.";else if(fr.name==="NotReadableError"||fr.name==="TrackStartError")Ut+="A cmera est sendo usada por outro app. Feche outros apps que possam estar usando a cmera e tente novamente.";else if(fr.name==="OverconstrainedError"||fr.name==="ConstraintNotSatisfiedError"){Ut+="A cmera do seu dispositivo no suporta as configuraes solicitadas. Tentando com configuraes mais simples...";try{console.log("[CAMERA] Tentando com configuraes simplificadas...");const ti=await navigator.mediaDevices.getUserMedia({video:!0});sr.current=ti,ei.current&&(ei.current.srcObject=ti,console.log("[CAMERA] Sucesso com configuraes simplificadas"));return}catch(ti){console.error("[CAMERA] Falha na segunda tentativa:",ti),Ut="No foi possvel acessar a cmera mesmo com configuraes simplificadas."}}else fr.name==="SecurityError"?Ut+="Erro de segurana. Certifique-se de estar acessando via HTTPS ou usando o app instalado.":Ut+=fr.message||"Verifique as permisses e tente novamente.";re(Ut),ar()}},[a,u,s,ar]),ar=zt.useCallback(()=>{console.log("[CAMERA] Fechando cmera..."),R(!1),re(null),sr.current&&(sr.current.getTracks().forEach(fr=>{fr.stop(),console.log("[CAMERA] Track parado:",fr.kind)}),sr.current=null)},[]),Qt=zt.useCallback(()=>{console.log("[CAMERA] Tirando nova foto..."),q(null),ar()},[ar]),Ci=zt.useCallback(()=>{if(!ei.current){console.log("[CAMERA] Elemento de vdeo no disponvel");return}if(H){console.log("[CAMERA] Foto j capturada, ignorando...");return}console.log("[CAMERA] Capturando foto...");const fr=document.createElement("canvas");fr.width=ei.current.videoWidth,fr.height=ei.current.videoHeight;const Ut=fr.getContext("2d");if(Ut){Ut.drawImage(ei.current,0,0);const ti=fr.toDataURL("image/jpeg",.8);q(ti),ar(),console.log("[CAMERA] Foto capturada com sucesso")}},[H,ar]),bi=()=>new Promise((fr,Ut)=>{if(!navigator.geolocation){Ut(new Error("Geolocalizao no suportada pelo navegador"));return}navigator.geolocation.getCurrentPosition(ti=>{fr({lat:ti.coords.latitude,lng:ti.coords.longitude})},ti=>{let si="Erro ao obter localizao: ";switch(ti.code){case ti.PERMISSION_DENIED:si+="Permisso negada. Clique no cone ao lado da URL e permita a localizao.";break;case ti.POSITION_UNAVAILABLE:si+="Localizao indisponvel. Tente novamente.";break;case ti.TIMEOUT:si+="Tempo esgotado. Tente novamente.";break;default:si+=ti.message||"Erro desconhecido"}Ut(new Error(si))},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e4})}),Ln=async fr=>{if(!H){alert("Por favor, tire uma selfie antes de bater o ponto");return}m(!0);try{let Ut={lat:0,lng:0};try{Ut=await bi(),B(Ut)}catch(Vn){console.warn("Localizao no disponvel:",Vn)}const ti=dr(),si=new Date().toISOString(),cn=(fr==null?void 0:fr.trim())||null;if(!s){const Vn={id:`pending-${Date.now()}`,user_id:t.id,clock_in:si,location_lat:Ut.lat,location_lng:Ut.lng,selfie_url:H,is_overtime:ti.isOvertime,overtime_type:ti.isOvertime?ti.type:null,notes:cn,type:"clock_in",timestamp:Date.now()};await Zp.addPendingEntry(Vn),await vr(),q(null),Ir(""),T({user_id:t.id,clock_in_time:si,current_lat:Ut.lat,current_lng:Ut.lng,last_updated:si}),et(ti.isOvertime),ue("Ponto Salvo Offline"),ke("Seu ponto foi salvo localmente e ser enviado quando houver internet."),_e(!0);return}const{data:un,error:Xn}=await Qr.from("time_entries").insert({user_id:t==null?void 0:t.id,clock_in:si,location_lat:Ut.lat,location_lng:Ut.lng,selfie_url:H,is_overtime:ti.isOvertime,overtime_type:ti.isOvertime?ti.type:null,notes:cn}).select().single();if(Xn)throw Xn;await Qr.from("active_sessions").upsert({user_id:t==null?void 0:t.id,clock_in_time:si,current_lat:Ut.lat,current_lng:Ut.lng,last_updated:new Date().toISOString()}),await gr(),q(null),Ir(""),ti.isOvertime?(ue("Ponto Batido - Hora Extra"),ke(ti.type==="lunch"?"Voc est trabalhando no horrio de almoo. Este perodo ser contado como hora extra.":"Voc est trabalhando aps o expediente. Este perodo ser contado como hora extra.")):(ue("Ponto Batido"),ke("")),_e(!0)}catch(Ut){ue("Erro"),ke("Erro ao bater ponto: "+Ut.message),_e(!0)}finally{m(!1)}},gi=async fr=>{console.log("[CLOCK OUT] Iniciando registro de sada..."),m(!0);try{console.log("[CLOCK OUT] User ID:",t==null?void 0:t.id),console.log("[CLOCK OUT] Online status:",s);const Ut=new Date().toISOString(),ti=(fr==null?void 0:fr.trim())||null;if(!s){console.log("[CLOCK OUT] Modo offline detectado");const zo={id:`pending-out-${Date.now()}`,user_id:t.id,clock_out:Ut,location_lat:0,location_lng:0,selfie_url:"",is_overtime:!1,overtime_type:null,notes:ti,type:"clock_out",timestamp:Date.now(),total_hours:0};await Zp.addPendingEntry(zo),await vr(),T(null),Ir(""),ue("Sada Salva Offline"),ke("Sua sada foi salva localmente e ser enviada quando houver internet."),_e(!0),m(!1);return}console.log("[CLOCK OUT] Buscando ltima entrada em aberto...");const{data:si,error:cn}=await Qr.from("time_entries").select("*").eq("user_id",t==null?void 0:t.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(console.log("[CLOCK OUT] Resultado da busca:",{lastEntry:si,fetchError:cn}),cn)throw console.error("[CLOCK OUT] Erro ao buscar ltima entrada:",cn),new Error("Erro ao buscar registro de entrada: "+cn.message);if(!si)throw console.error("[CLOCK OUT] Nenhuma entrada em aberto encontrada"),new Error("Nenhuma entrada em aberto encontrada. Por favor, registre uma entrada primeiro.");console.log("[CLOCK OUT] Calculando horas trabalhadas...");const un=new Date(si.clock_in),Xn=new Date,Vn=Math.max(0,(Xn.getTime()-un.getTime())/(1e3*60*60));console.log("[CLOCK OUT] Horas trabalhadas:",Vn),console.log("[CLOCK OUT] Atualizando registro no banco...");const Kn={clock_out:Xn.toISOString(),total_hours:Vn};ti&&(Kn.notes=si.notes?`${si.notes}
[SADA] ${ti}`:`[SADA] ${ti}`);const{error:ks}=await Qr.from("time_entries").update(Kn).eq("id",si.id);if(ks)throw console.error("[CLOCK OUT] Erro ao atualizar registro de sada:",ks),new Error("Erro ao registrar sada: "+ks.message);Ir(""),console.log("[CLOCK OUT] Registro atualizado com sucesso!"),console.log("[CLOCK OUT] Recalculando horas extras do ms...");const $n=new Date,os=$n.getMonth()+1,$s=$n.getFullYear(),mo=(r==null?void 0:r.work_hours)||8,Yo=(r==null?void 0:r.overtime_limit)||30,{recalculateMonthlyOvertime:An}=await Bd(async()=>{const{recalculateMonthlyOvertime:zo}=await import("./overtimeCalculator-BIOboYYF.js");return{recalculateMonthlyOvertime:zo}},[]);await An(t.id,os,$s,mo,Yo),console.log("[CLOCK OUT] Removendo sesso ativa...");const{error:xs}=await Qr.from("active_sessions").delete().eq("user_id",t==null?void 0:t.id);xs?console.error("[CLOCK OUT] Erro ao deletar sesso ativa:",xs):console.log("[CLOCK OUT] Sesso ativa removida com sucesso!"),console.log("[CLOCK OUT] Atualizando estado local..."),await gr(),console.log("[CLOCK OUT] Processo finalizado com sucesso!"),ue("Sada Registrada"),ke("Sua sada foi registrada com sucesso!"),_e(!0)}catch(Ut){console.error("[CLOCK OUT] ERRO COMPLETO:",Ut),console.error("[CLOCK OUT] Stack trace:",Ut.stack),ue("Erro ao Registrar Sada"),ke(Ut.message||"Ocorreu um erro desconhecido. Por favor, tente novamente."),_e(!0)}finally{console.log("[CLOCK OUT] Resetando estado de loading..."),m(!1)}};if(a)return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Bater Ponto"}),L.jsx("p",{className:"text-gray-600",children:"Tire uma selfie com o EPI"})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[L.jsx(__,{className:"w-5 h-5 mr-2 text-amber-600"}),"Posicione-se na cmera"]}),L.jsxs("div",{className:"space-y-4",children:[ee?L.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:[L.jsx("p",{className:"font-medium mb-2",children:"Erro ao acessar cmera"}),L.jsx("p",{className:"text-sm",children:ee})]}):L.jsxs("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden",style:{aspectRatio:"4/3"},children:[L.jsx("video",{ref:ei,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),L.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 pointer-events-none",children:L.jsx("p",{className:"text-white text-sm",children:"Carregando cmera..."})})]}),L.jsxs("div",{className:"flex space-x-3",children:[!ee&&L.jsx("button",{onClick:Ci,className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 rounded-lg font-semibold hover:from-amber-600 hover:to-orange-700 transition shadow-lg",children:"Capturar Foto"}),L.jsx("button",{onClick:ar,className:"px-6 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition",children:ee?"Voltar":"Cancelar"})]})]})]})]});const Pi=dr();return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Bater Ponto"}),L.jsx("p",{className:"text-gray-600",children:"Registre sua entrada ou sada"})]}),!s&&L.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg",children:L.jsxs("div",{className:"flex items-center",children:[L.jsx(Sj,{className:"w-5 h-5 text-yellow-600 mr-3"}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-semibold text-yellow-800",children:"Modo Offline"}),L.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Voc est sem internet. Seu ponto ser salvo e sincronizado automaticamente quando voltar online."}),Ge>0&&L.jsxs("p",{className:"text-xs text-yellow-800 mt-2 font-semibold",children:[Ge," ",Ge===1?"registro pendente":"registros pendentes"," de sincronizao"]})]})]})}),s&&Ge>0&&L.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg",children:L.jsxs("div",{className:"flex items-center",children:[L.jsx(Ej,{className:"w-5 h-5 text-blue-600 mr-3 animate-pulse"}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-semibold text-blue-800",children:"Sincronizando..."}),L.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[Ge," ",Ge===1?"registro est":"registros esto"," sendo sincronizado com o servidor."]})]})]})}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[L.jsxs("div",{className:"text-center mb-8",children:[L.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full mb-4",children:L.jsx(Dd,{className:"w-12 h-12 text-white"})}),L.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}),L.jsx("p",{className:"text-gray-600 mt-1",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"})})]}),Pi.isOvertime&&!v&&L.jsxs("div",{className:"mb-6 bg-orange-50 border border-orange-200 rounded-lg p-4",children:[L.jsx("p",{className:"text-sm font-semibold text-orange-800 mb-1",children:"Perodo de Hora Extra"}),L.jsx("p",{className:"text-xs text-orange-600",children:Pi.type==="lunch"?"Voc est no horrio de almoo. Bater ponto agora ser registrado como hora extra.":"Voc est aps o horrio de expediente. Bater ponto agora ser registrado como hora extra."})]}),H&&L.jsxs("div",{className:"mb-6",children:[L.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Selfie capturada:"}),L.jsx("img",{src:H,alt:"Selfie",className:"w-full max-w-sm mx-auto rounded-lg"})]}),v?L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:`border rounded-lg p-4 flex items-center space-x-3 ${De?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[L.jsx("div",{className:`w-3 h-3 rounded-full animate-pulse ${De?"bg-orange-500":"bg-green-500"}`}),L.jsxs("div",{children:[L.jsx("p",{className:`text-sm font-medium ${De?"text-orange-800":"text-green-800"}`,children:De?"Trabalhando (Hora Extra)":"Voc est trabalhando"}),L.jsxs("p",{className:`text-xs ${De?"text-orange-600":"text-green-600"}`,children:["Entrada: ",new Date(v.clock_in_time).toLocaleTimeString("pt-BR")]})]})]}),L.jsxs("button",{onClick:()=>Dr(!0),disabled:u,className:"w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition shadow-lg disabled:opacity-50 flex items-center justify-center space-x-2",children:[L.jsx(y_,{className:"w-5 h-5"}),L.jsx("span",{children:u?"Registrando...":"Registrar Sada"})]}),L.jsx("button",{onClick:()=>{confirm("Tem certeza? Isso ir resetar sua sesso atual. Use apenas se estiver com problemas para bater ponto.")&&Ue()},className:"w-full bg-gray-400 text-white py-2 rounded-lg text-sm hover:bg-gray-500 transition",children:"Resetar Sesso (usar apenas se travado)"})]}):L.jsx("div",{className:"space-y-4",children:H?L.jsxs("div",{className:"space-y-3",children:[L.jsxs("button",{onClick:()=>Dr(!0),disabled:u,className:"w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition shadow-lg disabled:opacity-50 flex items-center justify-center space-x-2",children:[L.jsx(uj,{className:"w-5 h-5"}),L.jsx("span",{children:u?"Registrando...":"Registrar Entrada"})]}),L.jsx("button",{onClick:Qt,className:"w-full bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition",children:"Tirar Outra Foto"})]}):L.jsxs("button",{onClick:br,className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition shadow-lg flex items-center justify-center space-x-2",children:[L.jsx(__,{className:"w-5 h-5"}),L.jsx("span",{children:"Tirar Selfie com EPI"})]})})]}),L.jsx(a1,{isOpen:J,onClose:()=>{_e(!1),(pe==="Ponto Batido"||pe==="Ponto Batido - Hora Extra")&&He(!0)},title:pe,message:ie}),L.jsx(a1,{isOpen:at,onClose:()=>He(!1),title:"Lembrete de Segurana",message:"Verifique seus equipamentos de EPIs para sua segurana e a de seus colegas"}),Xt&&L.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:L.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-4",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gradient-to-br from-blue-100 to-blue-200 mb-4",children:L.jsx(Dd,{className:"h-6 w-6 text-blue-600"})}),L.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Alguma observao sobre o horrio do ponto?"}),L.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Campo opcional. Use para justificar atrasos ou esquecimentos."})]}),L.jsxs("div",{children:[L.jsx("textarea",{value:ir,onChange:fr=>Ir(fr.target.value),placeholder:"Ex: Esqueci de bater o ponto na hora certa, reunio inesperada, etc...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition resize-none",rows:4,maxLength:500}),L.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[ir.length,"/500 caracteres"]})]}),L.jsxs("div",{className:"flex gap-3 pt-2",children:[L.jsx("button",{onClick:()=>{Dr(!1),Ir("")},disabled:u,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200 transition disabled:opacity-50",children:"Cancelar"}),L.jsx("button",{onClick:()=>{Dr(!1),v?gi(ir):Ln(ir)},disabled:u,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition shadow-lg disabled:opacity-50",children:u?"Registrando...":"Confirmar"})]})]})})]})}function DH(){const{user:t,profile:r}=Ud(),[s,u]=zt.useState(0),[m,v]=zt.useState(0),[T,a]=zt.useState(!0),R=(r==null?void 0:r.overtime_limit)||30;zt.useEffect(()=>{O()},[t]);const O=async()=>{if(t)try{const B=new Date,H=B.getMonth()+1,q=B.getFullYear(),{data:ee}=await Qr.from("overtime_hours").select("*").eq("user_id",t.id).eq("month",H).eq("year",q).maybeSingle();ee&&(u(ee.overtime_hours||0),v(ee.hour_bank||0))}catch(B){console.error("Error loading stats:",B)}finally{a(!1)}};return T?L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})}):L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Minhas Horas"}),L.jsx("p",{className:"text-gray-600",children:"Acompanhe suas horas extras e banco de horas"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsx("div",{className:"flex items-center justify-between mb-4",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center",children:L.jsx(Dd,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Horas Extras"}),L.jsxs("p",{className:"text-xs text-gray-500",children:["Limite de ",R,"h/ms"]})]})]})}),L.jsxs("div",{className:"space-y-3",children:[L.jsxs("div",{className:"flex items-end justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-4xl font-bold text-gray-800",children:s.toFixed(1)}),L.jsxs("p",{className:"text-sm text-gray-600",children:["de ",R," horas"]})]}),L.jsx(Vc,{className:"w-8 h-8 text-amber-600"})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:L.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-600 h-3 rounded-full transition-all duration-500",style:{width:`${Math.min(s/R*100,100)}%`}})}),L.jsx("p",{className:"text-xs text-gray-600",children:s>=R?"Limite atingido! Horas adicionais vo para o banco de horas.":`Restam ${(R-s).toFixed(1)} horas at o limite.`})]})]}),L.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[L.jsx("div",{className:"flex items-center justify-between mb-4",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:L.jsx(DS,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Banco de Horas"}),L.jsxs("p",{className:"text-xs text-gray-500",children:["Acima de ",R,"h extras"]})]})]})}),L.jsxs("div",{className:"space-y-3",children:[L.jsxs("div",{className:"flex items-end justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-4xl font-bold text-gray-800",children:m.toFixed(1)}),L.jsx("p",{className:"text-sm text-gray-600",children:"horas acumuladas"})]}),L.jsx(Vc,{className:"w-8 h-8 text-green-600"})]}),L.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[L.jsx("p",{className:"text-sm text-green-800 font-medium mb-1",children:"Como funciona?"}),L.jsxs("p",{className:"text-xs text-green-700",children:["As primeiras ",R,"h extras so pagas. Horas acima disso so acumuladas no banco de horas para voc usar como folga."]})]})]})]})]}),L.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-6 border border-amber-200",children:[L.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-3 flex items-center",children:[L.jsx(Vc,{className:"w-5 h-5 mr-2 text-amber-600"}),"Resumo do Ms"]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Horas Extras"}),L.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[s.toFixed(1),"h"]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Banco de Horas"}),L.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[m.toFixed(1),"h"]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Acumulado"}),L.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[(s+m).toFixed(1),"h"]})]})]})]})]})}function LO(){const[t,r]=zt.useState(null),[s,u]=zt.useState(!1),[m,v]=zt.useState(!1),[T,a]=zt.useState(!1),[R,O]=zt.useState(!1);zt.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){a(!0);return}if(localStorage.getItem("appInstalled")==="true"){a(!0);return}if(localStorage.getItem("installPromptDismissed")==="true")return;const q=/iPhone|iPad|iPod/.test(navigator.userAgent)&&!window.MSStream;O(q);const ee=re=>{re.preventDefault(),r(re),u(!0),setTimeout(()=>{v(!0)},2e3)};return window.addEventListener("beforeinstallprompt",ee),window.addEventListener("appinstalled",()=>{a(!0),u(!1),v(!1),localStorage.setItem("appInstalled","true")}),q&&!window.matchMedia("(display-mode: standalone)").matches&&(u(!0),setTimeout(()=>{v(!0)},2e3)),()=>{window.removeEventListener("beforeinstallprompt",ee)}},[]);const B=async()=>{if(R||!t)return;t.prompt();const{outcome:q}=await t.userChoice;q==="accepted"&&(r(null),u(!1),v(!1),a(!0),localStorage.setItem("appInstalled","true"))},H=()=>{v(!1),localStorage.setItem("installPromptDismissed","true")};return T||!s?null:L.jsxs(L.Fragment,{children:[L.jsx("button",{onClick:()=>v(!0),className:"fixed bottom-6 right-6 z-50 bg-gradient-to-r from-amber-500 to-orange-600 text-white p-4 rounded-full shadow-2xl hover:shadow-3xl transition-all transform hover:scale-110 animate-bounce-slow",title:"Instalar aplicativo",children:L.jsx(CT,{className:"w-6 h-6"})}),m&&L.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4 bg-black bg-opacity-50 animate-fade-in",children:L.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full animate-slide-up",children:[L.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-600 p-6 rounded-t-xl",children:L.jsxs("div",{className:"flex items-start justify-between mb-3",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-14 h-14 bg-white rounded-xl flex items-center justify-center",children:L.jsxs("svg",{className:"w-10 h-10 text-amber-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[L.jsx("circle",{cx:"12",cy:"12",r:"9",strokeWidth:"2"}),L.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),L.jsx("line",{x1:"12",y1:"12",x2:"12",y2:"6",strokeWidth:"2",strokeLinecap:"round"}),L.jsx("line",{x1:"12",y1:"12",x2:"16",y2:"12",strokeWidth:"2",strokeLinecap:"round"})]})}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-white font-bold text-xl",children:"Instalar App"}),L.jsx("p",{className:"text-white text-sm opacity-90",children:"Ponto Digital"})]})]}),L.jsx("button",{onClick:()=>v(!1),className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-1 transition",children:L.jsx(Kc,{className:"w-6 h-6"})})]})}),L.jsxs("div",{className:"p-6",children:[L.jsx("p",{className:"text-gray-700 mb-4 font-medium",children:R?"Adicione  tela inicial para:":"Instale o aplicativo na tela inicial do seu celular para:"}),L.jsxs("div",{className:"space-y-3 mb-6",children:[L.jsxs("div",{className:"flex items-center space-x-3 bg-green-50 p-3 rounded-lg",children:[L.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full flex-shrink-0"}),L.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Acesso rpido com um toque"})]}),L.jsxs("div",{className:"flex items-center space-x-3 bg-blue-50 p-3 rounded-lg",children:[L.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"}),L.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Funciona sem internet"})]}),L.jsxs("div",{className:"flex items-center space-x-3 bg-purple-50 p-3 rounded-lg",children:[L.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0"}),L.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Login salvo automaticamente"})]}),L.jsxs("div",{className:"flex items-center space-x-3 bg-amber-50 p-3 rounded-lg",children:[L.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"}),L.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Abre em tela cheia"})]})]}),R?L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("p",{className:"text-sm font-semibold text-gray-800 mb-3",children:"Como instalar no iPhone/iPad:"}),L.jsxs("ol",{className:"space-y-2 text-sm text-gray-700",children:[L.jsxs("li",{className:"flex items-start",children:[L.jsx("span",{className:"font-bold mr-2",children:"1."}),L.jsxs("span",{children:["Toque no boto ",L.jsx("strong",{children:"Compartilhar"})," (quadrado com seta) no Safari"]})]}),L.jsxs("li",{className:"flex items-start",children:[L.jsx("span",{className:"font-bold mr-2",children:"2."}),L.jsxs("span",{children:["Role para baixo e toque em ",L.jsx("strong",{children:'"Adicionar  Tela Inicial"'})]})]}),L.jsxs("li",{className:"flex items-start",children:[L.jsx("span",{className:"font-bold mr-2",children:"3."}),L.jsxs("span",{children:["Toque em ",L.jsx("strong",{children:'"Adicionar"'})," no canto superior direito"]})]})]})]}),L.jsx("button",{onClick:H,className:"w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold py-4 rounded-lg hover:from-amber-600 hover:to-orange-700 transition shadow-lg",children:"Entendi"})]}):L.jsxs("div",{className:"flex space-x-3",children:[L.jsxs("button",{onClick:B,className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold py-4 rounded-lg hover:from-amber-600 hover:to-orange-700 transition shadow-lg flex items-center justify-center space-x-2",children:[L.jsx(CT,{className:"w-5 h-5"}),L.jsx("span",{children:"Instalar"})]}),L.jsx("button",{onClick:H,className:"px-6 bg-gray-200 text-gray-700 font-semibold py-4 rounded-lg hover:bg-gray-300 transition",children:"Agora No"})]})]})]})})]})}function OH(){var H;const[t,r]=zt.useState("clockin"),[s,u]=zt.useState(!1),[m,v]=zt.useState(!1),{signOut:T,profile:a}=Ud();zt.useEffect(()=>{R()},[]);const R=async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0}),navigator.geolocation.getCurrentPosition(()=>{v(!0)},q=>{console.error("Erro localizao:",q),v(!0)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e4})}catch(q){console.error("Erro cmera:",q)}},O=[{id:"clockin",label:"Bater Ponto",icon:Dd},{id:"stats",label:"Minhas Horas",icon:Vc}],B=()=>{switch(t){case"clockin":return L.jsx(ck,{});case"stats":return L.jsx(DH,{});default:return L.jsx(ck,{})}};return L.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50",children:[L.jsx(LO,{}),L.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:L.jsx("button",{onClick:()=>u(!s),className:"p-3 bg-white rounded-lg shadow-lg text-gray-800",children:s?L.jsx(Kc,{className:"w-6 h-6"}):L.jsx(KM,{className:"w-6 h-6"})})}),L.jsxs("aside",{className:`fixed top-0 left-0 h-full w-64 bg-white shadow-xl transform transition-transform duration-300 z-40 ${s?"translate-x-0":"-translate-x-full"} lg:translate-x-0`,children:[L.jsx("div",{className:"p-6 border-b border-gray-200",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 p-3 rounded-lg",children:L.jsx(OS,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Ponto Digital"}),L.jsx("p",{className:"text-xs text-gray-600",children:"Colaborador"})]})]})}),L.jsx("div",{className:"p-4 border-b border-gray-200",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold",children:(H=a==null?void 0:a.full_name)==null?void 0:H.charAt(0).toUpperCase()}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-semibold text-gray-800",children:a==null?void 0:a.full_name}),L.jsx("p",{className:"text-xs text-gray-600",children:(a==null?void 0:a.job_position)||"Colaborador"})]})]})}),L.jsx("nav",{className:"p-4 space-y-2",children:O.map(q=>{const ee=q.icon;return L.jsxs("button",{onClick:()=>{r(q.id),u(!1)},className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition ${t===q.id?"bg-gradient-to-r from-amber-500 to-orange-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[L.jsx(ee,{className:"w-5 h-5"}),L.jsx("span",{className:"font-medium text-sm",children:q.label})]},q.id)})}),L.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200",children:L.jsxs("button",{onClick:()=>T(),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition",children:[L.jsx(XM,{className:"w-5 h-5"}),L.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]}),L.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 pt-20 lg:pt-8",children:B()})]})}function LH(){const{user:t,profile:r,loading:s}=Ud();return s?L.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-amber-600 mx-auto mb-4"}),L.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando..."})]})}):!t||!r?L.jsx(Aj,{}):r.role==="admin"?L.jsx(IH,{}):L.jsx(OH,{})}function FH(){return L.jsxs(oj,{children:[L.jsx(LH,{}),L.jsx(LO,{})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("Service Worker registrado com sucesso:",t.scope)},t=>{console.log("Falha ao registrar Service Worker:",t)})});bM(document.getElementById("root")).render(L.jsx(zt.StrictMode,{children:L.jsx(FH,{})}));export{Qr as s};
